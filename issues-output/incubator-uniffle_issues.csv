type,issue_url,comment_url,repo_name,id,issue_num,title,user_login,user_id,user_name,user_email,issue_state,created_at,updated_at,body,reactions
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/31,https://api.github.com/repos/apache/incubator-uniffle/issues/31,incubator-uniffle,1294136879,31,404 Not Found,cutiechi,27606234,,superchijinpeng@gmail.com,CLOSED,2022-07-05T10:56:18Z,2022-08-30T03:30:26Z,https://uniffle.apache.org/,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/31/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/31,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GCCJn,incubator-uniffle,1174938215,31,NA,jerryshao,850797,Jerry Shao,jshao@apache.org,NA,2022-07-05T11:12:28Z,2022-07-05T11:12:28Z,We haven't yet built the website for now...,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GCCJn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/31,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JYRD_,incubator-uniffle,1231098111,31,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-30T03:30:26Z,2022-08-30T03:30:26Z,We have built the website now. You can click the link again and see it. I will close the issue.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JYRD_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/37,https://api.github.com/repos/apache/incubator-uniffle/issues/37,incubator-uniffle,1295745879,37,Implement rest api for shuffle server and coordinator,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2022-07-06T12:11:28Z,2023-02-23T02:12:44Z,"We can implement some rest api for the shuffle server and coordinator to get server's status and control server's behavior, and also provide api for the web ui.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/37/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/37,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GXHwf,incubator-uniffle,1180466207,37,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-11T14:15:43Z,2022-07-11T14:15:43Z,There is an activity called Tencent's OpenSourceTalent (https://github.com/Tencent/OpenSourceTalent/issues/28).  The first task is similar to the issue. There will be some students to finish the work. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GXHwf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/37,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V5fOz,incubator-uniffle,1441133491,37,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-23T02:12:44Z,2023-02-23T02:12:44Z,This issue is duplicated to #80 . I'll close it.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V5fOz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/44,https://api.github.com/repos/apache/incubator-uniffle/issues/44,incubator-uniffle,1299112719,44,Introduce the reservedData to support more custom pluggable accessCheckers,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-07-08T14:42:13Z,2022-07-18T15:54:47Z,"### Background
In current implementation, DelegationRssShuffleManager could decide whether to use uniffle or sort shuffle service by calling remote coordinator. The pluggable accessCheckers can be extended in coordinator to support more custom requirements.

### Motivation
When we hope the uniffle can be applied to specified spark jobs to control which shuffle service to use, the mechanism of pluggable accessCheckers is useful. 

We can implement the CustomDelegationRssShuffleManager(like `DelegationRssShuffleManager`)to inject some custom accessInfo and remote call the coordinator which use the custom access policy to decide which spark job use the uniffle shuffle service. However the current codebase dont support inject more accessinfo in client, only have `tags` and `accessid`. So this proposal hopes to introduce the data structure to store more custom extensible requirement.

### Goals
1. Support injecting more custom data in AccessClusterRequest, which can be set in client

### Tasks

- [x] https://github.com/apache/incubator-uniffle/pull/42
- [x] https://github.com/apache/incubator-uniffle/pull/43
- [x] https://github.com/apache/incubator-uniffle/pull/41","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/44/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/44,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GWCIu,incubator-uniffle,1180181038,44,NA,duanmeng,5107360,macduan,duanmeng@outlook.com,NA,2022-07-11T09:39:38Z,2022-07-11T09:39:38Z,"It's a good idea to add a pb message `AccessInfo`, but we also need make sure that the new field in `AccessInfo` is common like `accessId` and `tags`.
IMH It is better to add a plugin feature in the coordinator to add customized checkers to support specific business requirements, not another delegation manager.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GWCIu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/44,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GWEzF,incubator-uniffle,1180191941,44,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-11T09:51:28Z,2022-07-11T09:51:28Z,"As i know the pluggable access checkers have been supported in current implementation of coordinator, which are managed by AccessManager.

And to support customized acess checker, i hope we can introduce a  general pb message in AccessInfo. Feel free to discuss more. @duanmeng ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GWEzF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/44,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GbgFK,incubator-uniffle,1181614410,44,NA,duanmeng,5107360,macduan,duanmeng@outlook.com,NA,2022-07-12T10:54:54Z,2022-07-12T10:54:54Z,">hope we can introduce a general pb message in AccessInfo

We coud add a pb message `AccessInfo` and put it inside the pb message `AccessClusterRequest`. And then make the client can populate these `extraProperties` through spark conf. So that we can inject special access checkers (not part of the code base of uniffle) for business requirements.
```protobuf
message AccessInfo {
  string accessId = 1;
  repeated string tags = 2;
  map<string, string> extraProperties;
}
```
@zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GbgFK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/44,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GynKM,incubator-uniffle,1187672716,44,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-18T15:54:47Z,2022-07-18T15:54:47Z,All done. Close ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GynKM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/48,incubator-uniffle,1300291041,48,[Feature Request] Deploy Uniffle on Kubernetes,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-07-11T06:58:27Z,2022-09-20T06:33:13Z,It's good to have a Kubernetes operator to help us deploy Uniffle on Kubernetes. We can automate our system operations.  This issue track the pull requests about Kubernetes operator.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/48/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HP44l,incubator-uniffle,1195347493,48,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-26T11:13:41Z,2022-07-26T11:13:41Z,@wangao1236 Do you want to help us?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HP44l/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HP5WB,incubator-uniffle,1195349377,48,NA,wangao1236,12544973,jasonawang,908622977@qq.com,NA,2022-07-26T11:15:48Z,2022-07-26T11:15:48Z,"Thanks, I'll submit some PRs about dockerfile and operator of Uniffe. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HP5WB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTblk,incubator-uniffle,1196276068,48,NA,czy006,28348735,ConradJam,jam.gzczy@gmail.com,NA,2022-07-27T05:17:43Z,2022-07-27T05:17:43Z,"I want to join in this issuses dev,I am currently working as an Apache Flink Operator developer, and I believe my experience will be helpful to our project @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTblk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTkPe,incubator-uniffle,1196311518,48,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T06:20:42Z,2022-07-27T06:20:42Z,"> I want to join in this issuses dev,I am currently working as an Apache Flink Operator developer, and I believe my experience will be helpful to our project @jerqi

Thanks, you're welcome. We have developed this feature in our internal company for  a period time. And @wangao1236 is my colleague. He will share our design document and give you some tasks. And you can also review his pull request and give us some advice.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTkPe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkDYU,incubator-uniffle,1200633364,48,NA,wangao1236,12544973,jasonawang,908622977@qq.com,NA,2022-08-01T03:01:53Z,2022-08-01T03:01:53Z,"I have written a design document, please help to review it: https://docs.google.com/document/d/1dlTvC0I-1WDNS6MOZp_0KB6mR3qr-EUiEJ11eeI828g/edit#heading=h.e0k4tcq0il5a
@jerqi @czy006 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkDYU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkE0q,incubator-uniffle,1200639274,48,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-01T03:10:16Z,2022-08-01T03:10:16Z,@wangao1236 Great work!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkE0q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkGCP,incubator-uniffle,1200644239,48,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-01T03:17:21Z,2022-08-01T03:17:21Z,"I have some experience in operator development(our internal elastic Yarn operator), maybe i can join this ticket","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkGCP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkGcD,incubator-uniffle,1200645891,48,NA,wangao1236,12544973,jasonawang,908622977@qq.com,NA,2022-08-01T03:19:29Z,2022-08-01T03:19:29Z,"> I have some experience in operator development(our internal elastic Yarn operator), maybe i can join this ticket

Welcome~","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkGcD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkMqC,incubator-uniffle,1200671362,48,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-01T04:06:15Z,2022-08-01T04:06:15Z,"Left some comments. Thanks for your great work @wangao1236. 

Besides, i want to know which language will be used when implementing this operator? Java or Golang. 
Do we have a POC? Maybe it benefit us to understand your design.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkMqC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/48,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkjoF,incubator-uniffle,1200765445,48,NA,wangao1236,12544973,jasonawang,908622977@qq.com,NA,2022-08-01T06:24:23Z,2022-08-01T06:24:23Z,"> Left some comments. Thanks for your great work @wangao1236.
> 
> Besides, i want to know which language will be used when implementing this operator? Java or Golang. Do we have a POC? Maybe it benefit us to understand your design.

We use golang to develop it. Sorry, there is currently no public POC environment.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkjoF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/50,https://api.github.com/repos/apache/incubator-uniffle/issues/50,incubator-uniffle,1301443274,50,Remove experimental feature with ShuffleUploader,colinmjj,8003795,Colin,colin@apache.org,CLOSED,2022-07-12T02:13:28Z,2022-07-13T02:01:09Z,"ShuffleUploader is an experimental feature which is target to merge and upload data from local disk to remote storage if local disk hasn't enough space.
Currently, `MEMORY_LOCAL_HDFS` is introduced as the common solution for shuffle data storage.
ShuffleUploader is not needed any more, and we also can avoid maintenance this in the future. 
  ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/50/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/54,https://api.github.com/repos/apache/incubator-uniffle/issues/54,incubator-uniffle,1304434715,54,[Code Style] Indentation rules,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2022-07-14T08:21:04Z,2022-07-15T06:44:02Z,"There are 2 indentation styles in the current code base. Which are mostly the same except for line wrapping.
It would be better to have it unified early. How do you think?

### 4 spaces for line wrapping

```java
public static void main(String[] args)
    throws Exception {
  for (int i = 0; i < args.length; i++) {
    System.out.println(""Greeting the "" + i +
        ""-th argument"");
    System.out.println(""hello, "" + args[i]);
  }
}
```

### 2 spaces for line wrapping

```java
public static void main(String[] args)
  throws Exception {
  for (int i = 0; i < args.length; i++) {
    System.out.println(""Greeting the "" + i +
      ""-th argument"");
    System.out.println(""hello, "" + args[i]);
  }
}
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/54/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/54,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GlKtP,incubator-uniffle,1184148303,54,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2022-07-14T08:23:43Z,2022-07-14T08:23:43Z,"Personally I prefer the ""4 spaces"" way, because it differentiates line wrapping with block indents.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GlKtP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/54,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GlZfs,incubator-uniffle,1184208876,54,NA,jerryshao,850797,Jerry Shao,jshao@apache.org,NA,2022-07-14T09:22:37Z,2022-07-14T09:22:37Z,I'm +1 on 4 spaces for line wrapping.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GlZfs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/54,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GpSp6,incubator-uniffle,1185229434,54,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2022-07-15T06:44:02Z,2022-07-15T06:44:02Z,Closed for #56.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5GpSp6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/61,https://api.github.com/repos/apache/incubator-uniffle/issues/61,incubator-uniffle,1311047180,61,Change the default branch name from master to main,frankliee,10219731,,885626704@qq.com,CLOSED,2022-07-20T12:57:32Z,2022-07-22T01:54:54Z," ""master"" may have some unfriendly meanings, as an alternative, many new projects have leveraged ""main"".","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/61/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/61,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5G_I8z,incubator-uniffle,1190956851,61,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-21T02:12:01Z,2022-07-21T02:12:01Z,I think it's not a big problem. Apache Spark and Apache Flink also use the name `master`.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5G_I8z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/61,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5G_LAI,incubator-uniffle,1190965256,61,NA,frankliee,10219731,,885626704@qq.com,NA,2022-07-21T02:26:08Z,2022-07-21T02:26:08Z,"They are old projects, new projects like Gluten/Velox use ""main"", and Github's default branch for new projects are ""main"".","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5G_LAI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/61,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5G_L2W,incubator-uniffle,1190968726,61,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-21T02:32:32Z,2022-07-21T02:32:32Z,There are also many new projects that use the name `master`. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5G_L2W/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/61,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5G_Mum,incubator-uniffle,1190972326,61,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-21T02:39:17Z,2022-07-21T02:39:17Z,"Besides master, words like 'blacklist', 'slave' also shouldn't be used in code to avoid problem. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5G_Mum/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/61,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HBP5D,incubator-uniffle,1191509571,61,NA,jerryshao,850797,Jerry Shao,jshao@apache.org,NA,2022-07-21T13:48:35Z,2022-07-21T13:48:35Z,"I don't think this is a problem,  and we should not spend time on such things.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HBP5D/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/66,https://api.github.com/repos/apache/incubator-uniffle/issues/66,incubator-uniffle,1314616257,66,[Feature Request] Introduce the unique trace id to debug easily,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-07-22T08:15:44Z,2022-07-25T15:45:05Z,"### Motivation
It's hard to analyze which process cost the most time of one remote request in current codebase, due to lacking corresponding trace id in client and server side.

### Plan
Maybe we could introduce the unique trace id which is generated on time/client-machine-id in one remote request, and then record it in client's log. And when requesting remote server, we should populate this to server and make it recorded in server's log.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/66/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/66,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HKtuV,incubator-uniffle,1193991061,66,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-25T12:33:20Z,2022-07-25T12:33:20Z,Will the feature influence the performance?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HKtuV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/66,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HLMsK,incubator-uniffle,1194117898,66,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-25T14:23:27Z,2022-07-25T14:23:27Z,"Maybe it will. But we could introduce new config to enable debug, default is false.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HLMsK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/66,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HLdwX,incubator-uniffle,1194187799,66,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-25T15:17:20Z,2022-07-25T15:17:20Z,"Do Flink have similar trace system? Spark don't have similar trace system. We ever implement this feature, but we don't choose to merge it. We just use that feature to get some information, the complexity which the feature brings is bigger than goodness. For offline system, metrics system may be better choice than trace system. Because although one time rpc is slow,  the average still may be fast. I understand that we should add more Spark Metrics to show the rss's performance.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HLdwX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/66,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HLrlQ,incubator-uniffle,1194244432,66,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-25T15:45:05Z,2022-07-25T15:45:05Z,"Got your point. Metric system is better for performance observation.

And i think i can invest this topic by submitting some PRs later.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HLrlQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/71,incubator-uniffle,1317745644,71,[Improvement]LocalStorage init use multi thread,xianjingfeng,11752250,,,CLOSED,2022-07-26T06:10:00Z,2022-07-29T07:57:40Z,"We have multi disk in a host. If shuffle server exit abnormally, there will be many files need to be clear when shuffle server start again and this operation will cost a lot of time","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/71/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HOxR9,incubator-uniffle,1195054205,71,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-26T06:20:49Z,2022-07-26T06:20:49Z,How much time will it take to execute the operation? Could you provide some concrete data? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HOxR9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HOxnB,incubator-uniffle,1195055553,71,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-26T06:22:43Z,2022-07-26T06:22:43Z,"@xianjingfeng I think clear unnecessary data before start shuffle server by Linux command is a better way, and clear process during shuffle server startup is a backup solution.
I prefer to improve start script to do such thing.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HOxnB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO0Rt,incubator-uniffle,1195066477,71,NA,xianjingfeng,11752250,,,NA,2022-07-26T06:36:33Z,2022-07-26T06:36:33Z,"> How much time will it take to execute the operation? Could you provide some concrete data?

more that 30 seconds per disk, it dependency disk performance and usage.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO0Rt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO1J8,incubator-uniffle,1195070076,71,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-26T06:41:07Z,2022-07-26T06:41:07Z,"> > How much time will it take to execute the operation? Could you provide some concrete data?
> 
> more that 30 seconds per disk, it dependency disk performance and usage.

What's the type of disk that you use? The performance of disk is a little strange. We only delete one directory on every disk, it shouldn't take so much time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO1J8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO2tT,incubator-uniffle,1195076435,71,NA,xianjingfeng,11752250,,,NA,2022-07-26T06:49:20Z,2022-07-26T06:49:20Z,"> > > How much time will it take to execute the operation? Could you provide some concrete data?
> > 
> > 
> > more that 30 seconds per disk, it dependency disk performance and usage.
> 
> What's the type of disk that you use? The performance of disk is a little strange. We only delete one directory on every disk, it shouldn't take so much time.

hdd, about 1T usage per disk","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO2tT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO3na,incubator-uniffle,1195080154,71,NA,xianjingfeng,11752250,,,NA,2022-07-26T06:54:03Z,2022-07-26T06:54:03Z,"> @xianjingfeng I think clear unnecessary data before start shuffle server by Linux command is a better way, and clear process during shuffle server startup is a backup solution. I prefer to improve start script to do such thing.

if do this in start scirpt, we need parse conf file in start script, i think it is heavy for start script and it is difficult to maintain","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO3na/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO38z,incubator-uniffle,1195081523,71,NA,xianjingfeng,11752250,,,NA,2022-07-26T06:55:39Z,2022-07-26T06:55:39Z,"> > > How much time will it take to execute the operation? Could you provide some concrete data?
> > 
> > 
> > more that 30 seconds per disk, it dependency disk performance and usage.
> 
> What's the type of disk that you use? The performance of disk is a little strange. We only delete one directory on every disk, it shouldn't take so much time.

FileUtils.deleteDirectory will delete it's childrens first","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO38z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO6ap,incubator-uniffle,1195091625,71,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-26T07:06:57Z,2022-07-26T07:06:57Z,"> > > > How much time will it take to execute the operation? Could you provide some concrete data?
> > > 
> > > 
> > > more that 30 seconds per disk, it dependency disk performance and usage.
> > 
> > 
> > What's the type of disk that you use? The performance of disk is a little strange. We only delete one directory on every disk, it shouldn't take so much time.
> 
> FileUtils.deleteDirectory will delete it's childrens first

Ok, I got it. It's ok for me to use multi-thread to do cleanup operation.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO6ap/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO-GI,incubator-uniffle,1195106696,71,NA,frankliee,10219731,,885626704@qq.com,NA,2022-07-26T07:24:11Z,2022-07-26T07:24:11Z,"> > > > How much time will it take to execute the operation? Could you provide some concrete data?
> > > 
> > > 
> > > more that 30 seconds per disk, it dependency disk performance and usage.
> > 
> > 
> > What's the type of disk that you use? The performance of disk is a little strange. We only delete one directory on every disk, it shouldn't take so much time.
> 
> FileUtils.deleteDirectory will delete it's childrens first



> > > > How much time will it take to execute the operation? Could you provide some concrete data?
> > > 
> > > 
> > > more that 30 seconds per disk, it dependency disk performance and usage.
> > 
> > 
> > What's the type of disk that you use? The performance of disk is a little strange. We only delete one directory on every disk, it shouldn't take so much time.
> 
> hdd, about 1T usage per disk

How many files are deleted in your disk ?  Uniffle has merged data in each partition, so there will not exist very large number of files. Can you do a simple test by using `rm -rf`？","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HO-GI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HPCyu,incubator-uniffle,1195125934,71,NA,xianjingfeng,11752250,,,NA,2022-07-26T07:44:28Z,2022-07-26T07:44:28Z,"> 



> > > > > How much time will it take to execute the operation? Could you provide some concrete data?
> > > > 
> > > > 
> > > > more that 30 seconds per disk, it dependency disk performance and usage.
> > > 
> > > 
> > > What's the type of disk that you use? The performance of disk is a little strange. We only delete one directory on every disk, it shouldn't take so much time.
> > 
> > 
> > FileUtils.deleteDirectory will delete it's childrens first
> 
> > > > > How much time will it take to execute the operation? Could you provide some concrete data?
> > > > 
> > > > 
> > > > more that 30 seconds per disk, it dependency disk performance and usage.
> > > 
> > > 
> > > What's the type of disk that you use? The performance of disk is a little strange. We only delete one directory on every disk, it shouldn't take so much time.
> > 
> > 
> > hdd, about 1T usage per disk
> 
> How many files are deleted in your disk ? Uniffle has merged data in each partition, so there will not exist very large number of files. Can you do a simple test by using `rm -rf`？

I neither count how many files nor test by using rm -rf , i will try to do this recently","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HPCyu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/71,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdyKq,incubator-uniffle,1198989994,71,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-29T07:57:40Z,2022-07-29T07:57:40Z,solved by pr #72 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdyKq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/73,https://api.github.com/repos/apache/incubator-uniffle/issues/73,incubator-uniffle,1317824413,73,[Improvement] ShuffleBlock should be release when finished reading,xianjingfeng,11752250,,,CLOSED,2022-07-26T07:34:57Z,2022-07-29T03:51:53Z,"We found spark executor is easy be killed by yarn, and i found it is because executor use too mush offheap memory when read shuffle data. 
I found most of offheap memory is used to store uncompressed shuffle Data, and this part of memory will be release only when GC is triggered","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/73/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/73,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdQfW,incubator-uniffle,1198852054,73,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-29T03:51:53Z,2022-07-29T03:51:53Z,solved by pr #74 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdQfW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/76,https://api.github.com/repos/apache/incubator-uniffle/issues/76,incubator-uniffle,1317996860,76,[Improvement] Disallow sendShuffleData if requireBufferId expired,xianjingfeng,11752250,,,CLOSED,2022-07-26T10:00:21Z,2022-08-22T12:37:05Z,"We found shuffle server which under high load is easy encounter `java.lang.OutOfMemoryError: Java heap space` even we allocate more jvm heap memory and less `rss.server.buffer.capacity `

The steps for the exception above:
1. When  shuffle server under high load, `requireBufferId` is easy to expire, and Shuffle server release `usedMemory`
2. Client `sendShuffleData` using a expired  `requireBufferId`, 
3. Shuffle server recive shuffle data and store _in rpc queue_(this part of memory usage was not be added to `usedMemory`)
4. Other clients `requireBuffer`  success because `usedMemory` is enough","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/76/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/76,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTPSB,incubator-uniffle,1196225665,76,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T03:33:16Z,2022-07-27T03:33:16Z,Do you have the solution of the problem?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTPSB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/76,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU57m,incubator-uniffle,1196662502,76,NA,xianjingfeng,11752250,,,NA,2022-07-27T12:26:36Z,2022-07-27T12:26:36Z,"Yes, it is be testing in our production environment. I will watch it for a while. If it's OK, I will create a pr","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU57m/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/76,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYkiv,incubator-uniffle,1197623471,76,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-28T03:49:32Z,2022-07-28T03:49:32Z,Could you share your solution?  We can discuss first.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYkiv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/76,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5He7Bo,incubator-uniffle,1199288424,76,NA,xianjingfeng,11752250,,,NA,2022-07-29T13:30:11Z,2022-07-29T13:30:11Z,"> Could you share your solution? We can discuss first.

1. In server side,  if `requireBufferId ` not found when send data, thrown an exception.
2. In client side, if fail to send data, require buffer again.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5He7Bo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/76,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HjTSs,incubator-uniffle,1200436396,76,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-31T14:28:14Z,2022-07-31T14:28:14Z,cc @colinmjj . There seems not be cases in our production environment. But I think the analysis is correct. What do you think?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HjTSs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/76,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkAtP,incubator-uniffle,1200622415,76,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-08-01T02:39:29Z,2022-08-01T02:39:29Z,"I think @xianjingfeng is right, with current implementation, OOM will happen if `requireBufferId` was expired in Shuffle Server already, this maybe caused by GC, network problem, high workload in shuffle server etc.
It's better to have the limitation to accept the data with `requireBufferId` only to avoid such problem.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HkAtP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/76,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I2tFN,incubator-uniffle,1222299981,76,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T12:37:05Z,2022-08-22T12:37:05Z,closed by #157 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I2tFN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/77,incubator-uniffle,1318016627,77,[Feature Request] Support deploy multiple shuffle servers in a single node ,xianjingfeng,11752250,,,CLOSED,2022-07-26T10:16:07Z,2022-09-27T06:06:54Z,"We have 1.2T memory per host, so we need deploy multiple shuffle servers in a single node.
But current partition assignment policy is not suitable to do that. 
Because partition maybe assign to a same host and client maybe fail if one host down","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/77/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HPwiA,incubator-uniffle,1195313280,77,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-26T10:38:24Z,2022-07-26T10:38:24Z,"As i know, partition assignment policy could be implemented by yourself.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HPwiA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HQaeA,incubator-uniffle,1195485056,77,NA,xianjingfeng,11752250,,,NA,2022-07-26T13:28:23Z,2022-07-26T13:28:23Z,"> As i know, partition assignment policy could be implemented by yourself.

Yes, but not only assignment policy need to be change, such as start script, i will create a pr for this","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HQaeA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTSYv,incubator-uniffle,1196238383,77,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T03:59:15Z,2022-07-27T03:59:15Z,I'm also curious why we need to modify start script?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTSYv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU6Ts,incubator-uniffle,1196664044,77,NA,xianjingfeng,11752250,,,NA,2022-07-27T12:28:07Z,2022-07-27T12:28:07Z,"> I'm also curious why we need to modify start script?

start script will process existence","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU6Ts/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU68j,incubator-uniffle,1196666659,77,NA,xianjingfeng,11752250,,,NA,2022-07-27T12:30:56Z,2022-07-27T12:30:56Z,"If our plan is deploy on k8s, this issue should close? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU68j/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU-wc,incubator-uniffle,1196682268,77,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T12:46:11Z,2022-07-27T12:46:11Z,K8S Deployment can't solve this issue. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU-wc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYfp0,incubator-uniffle,1197603444,77,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-28T03:10:52Z,2022-07-28T03:10:52Z,"> > I'm also curious why we need to modify start script?
> 
> start script will process existence

Yes, this is the limit with current implementation","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYfp0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYgNT,incubator-uniffle,1197605715,77,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-28T03:15:01Z,2022-07-28T03:15:01Z,"> K8S Deployment can't solve this issue.

@xianjingfeng I think you can continue this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYgNT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/77,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5He5Zp,incubator-uniffle,1199281769,77,NA,xianjingfeng,11752250,,,NA,2022-07-29T13:23:40Z,2022-07-29T13:23:40Z,"> > K8S Deployment can't solve this issue.
> 
> @xianjingfeng I think you can continue this.

ok","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5He5Zp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/78,https://api.github.com/repos/apache/incubator-uniffle/issues/78,incubator-uniffle,1318022933,78,[Bug] The metric `grpc_open` sometime incorrect ,xianjingfeng,11752250,,,OPEN,2022-07-26T10:21:32Z,2022-07-27T15:20:00Z,We found the value of `grpc_open` sometime very big(>1000) even no application run in our cluster,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/78/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/78,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTSeK,incubator-uniffle,1196238730,78,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T04:00:02Z,2022-07-27T04:00:02Z,Could you provide more detailed information? Could you add some logs to help us solve this problem?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTSeK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/78,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU-Lf,incubator-uniffle,1196679903,78,NA,xianjingfeng,11752250,,,NA,2022-07-27T12:43:59Z,2022-07-27T12:43:59Z,"No logs, we just found this phenomenon. Maybe  `org.apache.uniffle.common.rpc.MonitoringServerCall#close` not called sometimes. I try to call `decCounter`  in `MonitoringServerCallListener#onComplete/onCancel/onComplete` and it work. But i don't know the real reasion","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU-Lf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/78,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HVAMZ,incubator-uniffle,1196688153,78,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T12:51:47Z,2022-07-27T12:51:47Z,"> No logs, we just found this phenomenon. Maybe `org.apache.uniffle.common.rpc.MonitoringServerCall#close` not called sometimes. I try to call `decCounter` in `MonitoringServerCallListener#onComplete/onCancel/onComplete` and it work. But i don't know the real reasion

I guess that   method `close` could not be called sometimes if there is an exception.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HVAMZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/78,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HVzu-,incubator-uniffle,1196899262,78,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T15:19:59Z,2022-07-27T15:19:59Z,"cc @colinmjj , Do you remember our flaky metric test? I guess that it's caused by this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HVzu-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/79,https://api.github.com/repos/apache/incubator-uniffle/issues/79,incubator-uniffle,1318037708,79,[Improvement] Process don't exit if exec start script using ansible,xianjingfeng,11752250,,,CLOSED,2022-07-26T10:32:20Z,2022-10-23T05:27:21Z,"Process don't exit if exec start script using ansible. Therefore, we can't do batch start operation for this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/79/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/79,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HPxPm,incubator-uniffle,1195316198,79,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-26T10:41:34Z,2022-07-26T10:41:34Z,+1. We have similar problem.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HPxPm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/79,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTSue,incubator-uniffle,1196239774,79,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T04:02:20Z,2022-07-27T04:02:20Z,Did you have the solution of the problem? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTSue/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/79,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU-nK,incubator-uniffle,1196681674,79,NA,xianjingfeng,11752250,,,NA,2022-07-27T12:45:40Z,2022-07-27T12:45:40Z,"Yes, by using nohup","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU-nK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/79,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYkzT,incubator-uniffle,1197624531,79,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-28T03:51:41Z,2022-07-28T03:51:41Z,Do you want to raise a pr?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYkzT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/79,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5He54F,incubator-uniffle,1199283717,79,NA,xianjingfeng,11752250,,,NA,2022-07-29T13:25:37Z,2022-07-29T13:25:37Z,"> Do you want to raise a pr?

yes","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5He54F/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/80,incubator-uniffle,1318040618,80,[Feature Request]  Support shuffle server decommissioned,xianjingfeng,11752250,,,CLOSED,2022-07-26T10:34:54Z,2023-03-10T08:04:53Z,"kill process is not graceful, so we need shuffle server support decommissioned","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/80/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HPxEb,incubator-uniffle,1195315483,80,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-26T10:40:46Z,2022-07-26T10:40:46Z,"+1. Now the decommission could be used by exclude node file in coordinator side.

Besides, the exclude-node-file could be stored in HDFS.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HPxEb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTTJW,incubator-uniffle,1196241494,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T04:05:16Z,2022-07-27T04:05:16Z,"I understand that you need  a `rolling upgrade` feature.  In our plan, we want to  accomplish this feature by k8s operator. For the standalone mode, we don't have the plans,. And it's also necessary to do some surveys about this feature, I think we should have more discuss about this problem.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTTJW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU4bG,incubator-uniffle,1196656326,80,NA,xianjingfeng,11752250,,,NA,2022-07-27T12:20:12Z,2022-07-27T12:20:12Z,"> I understand that you need a `rolling upgrade` feature. In our plan, we want to accomplish this feature by k8s operator. For the standalone mode, we don't have the plans,. And it's also necessary to do some surveys about this feature, I think we should have more discuss about this problem.

Depoly on k8s is a good choice. But one more choice is not a bad thing. Not all teams willing to use k8s . I have create a pr.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HU4bG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HVdpO,incubator-uniffle,1196808782,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T14:06:42Z,2022-07-27T14:06:42Z,Could you write a design doc's (use google doc) ? Because this issue is a little complex.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HVdpO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HVxNC,incubator-uniffle,1196888898,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T15:11:55Z,2022-07-27T15:11:55Z,"If we want to add some interface to control shuffle server's behavior,  we should have a complete design, and we think we need detailed discussions. We ever have similar mind in issue #37 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HVxNC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hbark,incubator-uniffle,1198369508,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-28T16:23:48Z,2022-07-28T16:23:48Z,"Yarn node's decommission. https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html Maybe, we should also realize other system decommission implement.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hbark/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdGbs,incubator-uniffle,1198810860,80,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-29T02:15:54Z,2022-07-29T02:15:54Z,"> Yarn node's decommission. https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html 

Yes. In #85, I follow the rule of YARN decommission mechanism. So i think it's better to control the decommission by coordinator. Feel free to discuss more

> Maybe, we should also realize other system decommission implement.

I looked the HDFS datanode decommission, it's also like YARN decommission. refer: https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsDataNodeAdminGuide.html","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdGbs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hi4vV,incubator-uniffle,1200327637,80,NA,xianjingfeng,11752250,,,NA,2022-07-31T01:34:46Z,2022-07-31T01:34:46Z,"I think we should consider more things, such as
1. Is it easy to use if we deploy on k8s and IP is not fixed?
2. Split-brain. If pass commands through heartbeat, shuffle server may receive different messages meanwhile and how do we ensure correctness. The decommission function can be solved. What about other functions in the future?
3. Compatibility. If pass commands through heartbeat, we need to modify this interface frequently.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hi4vV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HjTb_,incubator-uniffle,1200436991,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-31T14:31:19Z,2022-07-31T14:31:19Z,cc @colinmjj . What do you think? I remember that you want to use coordinator to dispatch the configuration to shuffle servers. It's similar to use coordinator to decommission.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HjTb_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hj_u7,incubator-uniffle,1200618427,80,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-08-01T02:33:11Z,2022-08-01T02:33:11Z,"I think such feature is about command line or some API to manage the behavior of coordinator/shuffle server.
There should be an overall picture to describe how to make this happen.
Besides decommission, how about update some configuration in shuffle server, clear shuffle data(which maybe useful for streaming jog), etc.
All above feature is management related, so I prefer to have a framework which can involve all these things. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hj_u7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M1DWW,incubator-uniffle,1288975766,80,NA,xianjingfeng,11752250,,,NA,2022-10-24T12:40:57Z,2022-10-24T12:40:57Z,"@jerqi @colinmjj  I want to know if you have plan recently.  We have some functions that need to be built on the function of decommission, such as auto scaling We don't want to deviate too much from the community.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M1DWW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M4lhF,incubator-uniffle,1289902149,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-25T02:44:25Z,2022-10-25T02:44:25Z,"> @jerqi @colinmjj I want to know if you have plan recently. We have some functions that need to be built on the function of decommission, such as auto scaling We don't want to deviate too much from the community.

We have no  related plan recently. If you have interest about this topic, we can start a offline meeting to discuss this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M4lhF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M42xH,incubator-uniffle,1289972807,80,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-25T04:44:32Z,2022-10-25T04:44:32Z,"> > @jerqi @colinmjj I want to know if you have plan recently. We have some functions that need to be built on the function of decommission, such as auto scaling We don't want to deviate too much from the community.
> 
> 
> 
> We have no  related plan recently. If you have interest about this topic, we can start a offline meeting to discuss this issue.

+1. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M42xH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5BpG,incubator-uniffle,1290017350,80,NA,xianjingfeng,11752250,,,NA,2022-10-25T05:44:54Z,2022-10-25T05:44:54Z,"> we can start a offline meeting to discuss this issue.

I am looking forward to it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5BpG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5Htg,incubator-uniffle,1290042208,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-25T06:21:11Z,2022-10-25T06:21:11Z,"@zuston @xianjingfeng There are some other issues which we need to discuss, so I will send a email to our dev mail list, and select a proper date to start the meeting.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5Htg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-c_Q,incubator-uniffle,1291440080,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-26T03:15:24Z,2022-10-26T03:15:24Z,@xianjingfeng  I have already send an email https://lists.apache.org/thread/2jlm3fswmsxy619ldyo4px700p3ybnvc. Do you have time at 11 am (UTC +8) Thursday this week?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-c_Q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-rA-,incubator-uniffle,1291497534,80,NA,xianjingfeng,11752250,,,NA,2022-10-26T04:51:47Z,2022-10-26T04:51:47Z,"> @xianjingfeng I have already send an email https://lists.apache.org/thread/2jlm3fswmsxy619ldyo4px700p3ybnvc. Do you have time at 11 am (UTC +8) Thursday this week?

Yes, i have time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-rA-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-52a,incubator-uniffle,1291558298,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-26T06:23:02Z,2022-10-26T06:23:02Z,"> > @xianjingfeng I have already send an email https://lists.apache.org/thread/2jlm3fswmsxy619ldyo4px700p3ybnvc. Do you have time at 11 am (UTC +8) Thursday this week?
> 
> Yes, i have time.

Meeting link is https://meeting.tencent.com/dm/oR95wASCNe91","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-52a/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-85-,incubator-uniffle,1291570814,80,NA,xianjingfeng,11752250,,,NA,2022-10-26T06:40:32Z,2022-10-26T06:40:32Z,"> > > @xianjingfeng I have already send an email https://lists.apache.org/thread/2jlm3fswmsxy619ldyo4px700p3ybnvc. Do you have time at 11 am (UTC +8) Thursday this week?
> > 
> > 
> > Yes, i have time.
> 
> Meeting link is https://meeting.tencent.com/dm/oR95wASCNe91

Get","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-85-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NETnl,incubator-uniffle,1292974565,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-27T04:37:46Z,2022-10-27T04:37:46Z,"Offline Discussion Result:
Coordinator provide admin rest api, Coordinator is only used as proxy, Coordinator redirect the request to shuffle server by rpc.
Currently, we need the api
1. Decommission
2. UpdateConfiguration
3. Upgrade

cc @zuston, you can give your advice for us. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NETnl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-t7o,incubator-uniffle,1375395560,80,NA,xianjingfeng,11752250,,,NA,2023-01-09T10:24:36Z,2023-01-09T10:24:36Z,"Design doc: https://docs.google.com/document/d/1p1PksBN2LJ-OtGEHvdyEuH9b1Mv1aD_exMPl4TNaTs0/edit?usp=sharing
PTAL @jerqi @zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-t7o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-uf0,incubator-uniffle,1375397876,80,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-09T10:26:21Z,2023-01-09T10:26:21Z,"Thanks a lot for proposing this, I will take a look ASSP","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-uf0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-z6P,incubator-uniffle,1375420047,80,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-09T10:46:59Z,2023-01-09T10:46:59Z,"> Design doc: https://docs.google.com/document/d/1p1PksBN2LJ-OtGEHvdyEuH9b1Mv1aD_exMPl4TNaTs0/edit?usp=sharing PTAL @jerqi @zuston

Commented. @xianjingfeng PTAL","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-z6P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UIAfu,incubator-uniffle,1411385326,80,NA,xianjingfeng,11752250,,,NA,2023-02-01T02:57:05Z,2023-02-01T02:57:05Z,"As we discuss in design doc, i will make the following adjustments:
1. Add concrete rest api list in the design doc.
2. Remove token in this design.

Any other suggestions? @jerqi @zuston @advancedxy ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UIAfu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UIAqt,incubator-uniffle,1411386029,80,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-01T02:58:26Z,2023-02-01T02:58:26Z,I'm OK.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UIAqt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UILhq,incubator-uniffle,1411430506,80,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-01T04:02:17Z,2023-02-01T04:02:17Z,"> As we discuss in design doc, i will make the following adjustments:
> 
> 1. Add concrete rest api list in the design doc.
> 2. Remove token in this design.
> 
> Any other suggestions? @jerqi @zuston @advancedxy

+1. Thanks for your effort","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UILhq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/80,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XOgrW,incubator-uniffle,1463421654,80,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-10T08:04:53Z,2023-03-10T08:04:53Z,"Thanks @xianjingfeng for working on this feature.
I'm closing this issue now. Please feel free to reopen it if there is more work.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XOgrW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/81,https://api.github.com/repos/apache/incubator-uniffle/issues/81,incubator-uniffle,1318099136,81,Benchmark: ESS and Uniffle,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-07-26T11:25:19Z,2022-07-28T11:30:45Z,Could the community provide the official benchmark with ESS and uniffle? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/81/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/81,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYeLQ,incubator-uniffle,1197597392,81,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-28T03:00:43Z,2022-07-28T03:00:43Z,@zuston You can refer this [blog](https://cloud.tencent.com/developer/article/1943179) for the benchmark related. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYeLQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/81,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYgZJ,incubator-uniffle,1197606473,81,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-28T03:16:28Z,2022-07-28T03:16:28Z,"Attach the google doc about test result in our internal cluster： https://docs.google.com/document/d/1nmHMBEaa4lHfgQkdlYokTtXt12F5vRJiQ2MCmTQbW6k/edit#heading=h.b1udpb9l28w7

I can't achieve the same result from the blog. Could u help check this? @colinmjj @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYgZJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/81,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYiGB,incubator-uniffle,1197613441,81,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-28T03:29:42Z,2022-07-28T03:29:42Z,"@zuston The benchmark of blog is based on Spark 2.4.6.
If there has no random disk IO problem with ESS, Uniffle is expected has **poor performance** than ESS ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYiGB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/81,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HaFKH,incubator-uniffle,1198019207,81,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-28T11:30:45Z,2022-07-28T11:30:45Z,"Yes, you are right. @colinmjj . I tested in 5TB terasort, ESS directly failed when shuffle read due to 100% diskio. But uniffle looks good.

I have updated latest result in google doc. @colinmjj @jerqi . I think maybe it would be better to attach the result to github issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HaFKH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/86,https://api.github.com/repos/apache/incubator-uniffle/issues/86,incubator-uniffle,1318179372,86,[Feature] Introduce graceful decommission for shuffle server,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-07-26T12:34:44Z,2022-07-27T02:46:37Z,"
When shuffle servers needed to decommission are included in exclude-node-files, we hope shuffle server will exit by its own when all apps finished.


Draft PR: #85

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/86/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/86,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HQMvp,incubator-uniffle,1195428841,86,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-26T12:39:04Z,2022-07-26T12:39:04Z,"Why don't we reuse the issue #80? In my opinion, This is a duplicate issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HQMvp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/86,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTKNH,incubator-uniffle,1196204871,86,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-27T02:46:36Z,2022-07-27T02:46:36Z,Sorry i miss previous issue. Merge this topic to #80 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTKNH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/89,incubator-uniffle,1318996315,89,[Improvement] Add a load policy based on disk performance,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2022-07-27T04:11:59Z,2022-07-29T06:07:27Z,"The current load balancing strategy only considers the available memory, whether to add another strategy based on disk performance.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/89/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTVe_,incubator-uniffle,1196251071,89,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T04:24:34Z,2022-07-27T04:24:34Z,It's ok to add extra strategy.  But we need a good method to tell us whether the strategy is good enough.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTVe_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTm54,incubator-uniffle,1196322424,89,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-07-27T06:37:20Z,2022-07-27T06:37:20Z,"The current idea is to sort the IO cases of available disks by heartbeat when the parameter ""rss.server.health.check.enable"" is turned on, regardless of the number of partitions and memory.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTm54/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTpUn,incubator-uniffle,1196332327,89,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T06:51:47Z,2022-07-27T06:51:47Z,"The idea is acceptable. But there are some questions
1. Why do we need HealthCheck? HealthCheck is an experimental feature now, maybe it's not stable enough. That means that you need do some extra work to improve the feature.
2. Should we add some extra metrics to measure the effect of strategy?  We usually use the memory of server to measure current strategy, we hope every server use similar quantity of memory.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTpUn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTyeb,incubator-uniffle,1196369819,89,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-07-27T07:36:36Z,2022-07-27T07:36:36Z,"1. I think this scheme can only support MEMORY LOCALFILE.
2. Since this HealthCheck collects the information of the local disk, we can use this feature. This health check now defaults to true, which hides some danger because RSS is sensitive to disk IO.  
3. And if there are any problems during the test phase, I will report back promptly.
4. I will use the configured disk capacity of each server as an indicator of the policy.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HTyeb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT0oQ,incubator-uniffle,1196378640,89,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T07:46:15Z,2022-07-27T07:46:15Z,"> 1. I think this scheme can only support MEMORY LOCALFILE.
> 2. Since this HealthCheck collects the information of the local disk, we can use this feature. This health check now defaults to true, which hides some danger because RSS is sensitive to disk IO.
> 3. And if there are any problems during the test phase, I will report back promptly.
> 4. I will use the configured disk capacity of each server as an indicator of the policy.

1. Why do the strategy only support MEMORY_LOCALFILE?  We would like to use MEMORY_LOCALFILE_HDFS in our production environment. Our MEMORY_LOCALFILE_HDFS can use multiple HDFS.
2. The HealthCheck's default value is false now.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT0oQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT6Bi,incubator-uniffle,1196400738,89,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-27T08:09:43Z,2022-07-27T08:09:43Z,"@smallzhongfeng The workload of Shuffle Server depends on a lot of things, eg, Memory, Disk IO, NetworkIO, etc. To simplify the assignment strategy, memory is chosen as the most important metric, because any problem in shuffle server will cause much memory usage. For your case, if there has problem in Disk IO, data won't be flushed as expected, and more and more data will be stored in memory.
Uniffle is kind of producer & consumer model, and memory is the cache, I think we can check the workload according to memory usage and do the assignment.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT6Bi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT7Ib,incubator-uniffle,1196405275,89,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-07-27T08:14:26Z,2022-07-27T08:14:26Z,"I mean the shuffleServer's property isHealthy returns true when ShuffleServer init, but not the HealthCheck's default value.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT7Ib/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT7e_,incubator-uniffle,1196406719,89,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-07-27T08:15:54Z,2022-07-27T08:15:54Z,"@colinmjj I think you are right, but is it possible that memory is allocated normally, but disk IO has problems?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT7e_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT-T9,incubator-uniffle,1196418301,89,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-27T08:27:29Z,2022-07-27T08:27:29Z,"> @colinmjj I think you are right, but is it possible that memory is allocated normally, but disk IO has problems?

I think you're worry about if the shuffle server with abnormal disk will be assigned to job.
Currently, LocalStorageChecker is responsible for such check and will exclude abnormal disk.
But if all disks are broken,  we can improve HealthCheck to handle such problem and exclude the shuffle server during the assignment. Maybe PR is needed for such improvement. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HT-T9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUGyD,incubator-uniffle,1196452995,89,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-07-27T08:58:22Z,2022-07-27T08:58:22Z,Do we need to turn this parameter HealthCheck on by default? This allows for better screening of healthy machines. @colinmjj @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUGyD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUKcV,incubator-uniffle,1196467989,89,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T09:09:55Z,2022-07-27T09:09:55Z,I think we should verify the function `HealCheck` in production environment first before we turn it on. But there are fewer broken disk in our production environment. I prefer use `false` as default value currently.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUKcV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUNt9,incubator-uniffle,1196481405,89,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-07-27T09:22:10Z,2022-07-27T09:22:10Z,"Maybe you are right, but I think we should open it up so that we can verify this situation in more production environments.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUNt9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUXsM,incubator-uniffle,1196522252,89,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-27T09:59:42Z,2022-07-27T09:59:42Z,"> Maybe you are right, but I think we should open it up so that we can verify this situation in more production environments.

You can turn it on when you deploy the shuffle server rather than use `true` as a default value.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUXsM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUaK_,incubator-uniffle,1196532415,89,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-07-27T10:09:22Z,2022-07-27T10:09:22Z,OK.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUaK_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/89,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdfsG,incubator-uniffle,1198914310,89,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-29T06:07:27Z,2022-07-29T06:07:27Z,"> @smallzhongfeng The workload of Shuffle Server depends on a lot of things, eg, Memory, Disk IO, NetworkIO, etc. To simplify the assignment strategy, memory is chosen as the most important metric, because any problem in shuffle server will cause much memory usage. For your case, if there has problem in Disk IO, data won't be flushed as expected, and more and more data will be stored in memory. Uniffle is kind of producer & consumer model, and memory is the cache, I think we can check the workload according to memory usage and do the assignment.

@colinmjj 
One question?
If server A, server B have equal memory, but they have different quantity disks, should we allocate them the same shuffle partitions?
The server which has fewer disks will be more slower. Although we don't allocate extra shuffle partitions to it, when it have processed these partitions, the coordinator will allocate excessive partitions to it, it will be slower again. I think it's meaningful to consider disk performance. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdfsG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/90,https://api.github.com/repos/apache/incubator-uniffle/issues/90,incubator-uniffle,1319348389,90,[Performance Optimization] Improve the speed of writing index file in shuffle server,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-07-27T10:25:57Z,2022-07-28T02:51:48Z,"### Motivation
When I test uniffle performance, i found a huge performance drop due to the low speed of writing index file. Flame graph attached:

![reliao_img_1658917352873](https://user-images.githubusercontent.com/8609142/181224611-faf20e2b-a65a-44ad-ad15-560addf43c85.png)

### Solution
Use the `dataOutputStream = new DataOutputStream(new BufferedOutputStream(fileOutputStream));` in `LocalFileWriter`. Please refer to: https://stackoverflow.com/questions/38439410/java-dataoutputstream-writelong-byte-double-int-speed

### Result

After apply this optimization:
![reliao_img_1658917526994](https://user-images.githubusercontent.com/8609142/181225186-b883658b-ac40-40a2-8cb7-22e154bc3d7f.png)

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/90/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/90,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUnru,incubator-uniffle,1196587758,90,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-27T11:07:34Z,2022-07-27T11:07:34Z,@zuston good catch,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HUnru/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/90,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYc-A,incubator-uniffle,1197592448,90,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-28T02:51:43Z,2022-07-28T02:51:43Z,solved by #91 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYc-A/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/92,https://api.github.com/repos/apache/incubator-uniffle/issues/92,incubator-uniffle,1319458644,92,[Performance Optimization] The huge performance drop due to the method of getBlockIdsByPartitionId,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-07-27T11:59:39Z,2023-02-02T03:00:25Z,"### Background

I found when getting shuffle result, the flame graph show the method of `getBlockIdsByPartitionId` occupy too much time. 
![reliao_img_1658922962790](https://user-images.githubusercontent.com/8609142/181240913-8d38d12e-c62a-453d-a0df-f89a46e1b71a.png)

But i found the default bitmapNum is 1, and the conf of `spark.rss.client.bitmap.splitNum` looks abandoned in future.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/92/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/92,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYZXE,incubator-uniffle,1197577668,92,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-28T02:23:58Z,2022-07-28T02:23:58Z,@colinmjj ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYZXE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/92,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYdr2,incubator-uniffle,1197595382,92,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-28T02:57:05Z,2022-07-28T02:57:05Z,"The performance problem of `getBlockIdsByPartitionId` is a known issue.
With current design, blockId should be stored in shuffle server to support features like block filter, data validation, etc.
Here is the challenge about how to store blockId in shuffle server, and we need consider how to reduce memory cost & have better performance.
The current implementation is target to reduce memory cost in Shuffle Server, but have poor performance when get blockIds, otherwise, GC will be another problem.
I think there should be a lot of works to improve this issue, maybe new design about how to do the data validation & how to store blockIds. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYdr2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/92,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYgoq,incubator-uniffle,1197607466,92,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-28T03:18:42Z,2022-07-28T03:18:42Z,"Got it. If we have the better design on this, i think it will achieve better performance.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYgoq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/95,https://api.github.com/repos/apache/incubator-uniffle/issues/95,incubator-uniffle,1320339643,95,[Performance Optimization] Multiple channels when getting shuffle data in client side,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-07-28T03:23:19Z,2023-01-19T08:22:42Z,"### Motivation
Now the executor only will use the single TCP connection with the specified shuffle server, so when multiple tasks are running concurrently, it will share this channel. Maybe it will reduce the whole throughput. 

Do we have any plan to introduce extra config to allow user to create more channels in client side?

Maybe we should do some performance test to prove this improvement effective. The update will be included in this ticket.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/95/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/95,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYiwv,incubator-uniffle,1197616175,95,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-28T03:35:06Z,2022-07-28T03:35:06Z,"@zuston The current implementation limit the number of connection, because don't want too many connection established between client and shuffle server.
We also plan to improve this by using netty instead of Grpc, not only about throughput but also reduce unnecessary serialization in Grpc. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYiwv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/95,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYjO9,incubator-uniffle,1197618109,95,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-28T03:38:54Z,2022-07-28T03:38:54Z,"Glad to hear this. From the flame graph, due to extra memory-copy, it cost too much time in shuffle server side.

If using the netty to directly manipulate shuffle data bytebuf in off-heap, it may get better performance. 

Besides, do we need to w/r shuffle data to files using nio to match with the netty? Please let me know whether i'm wrong.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYjO9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/95,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYjhd,incubator-uniffle,1197619293,95,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-28T03:41:12Z,2022-07-28T03:41:12Z,"> @zuston The current implementation limit the number of connection, because don't want too many connection established between client and shuffle server. We also plan to improve this by using netty instead of Grpc, not only about throughput but also reduce unnecessary serialization in Grpc.

Could we put this into the 0.7 version plan?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYjhd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/95,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYj1j,incubator-uniffle,1197620579,95,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-07-28T03:43:40Z,2022-07-28T03:43:40Z,"> > @zuston The current implementation limit the number of connection, because don't want too many connection established between client and shuffle server. We also plan to improve this by using netty instead of Grpc, not only about throughput but also reduce unnecessary serialization in Grpc.
> 
> Could we put this into the 0.7 version plan?

Yes, I think so","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HYj1j/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/95,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZXU_,incubator-uniffle,1197831487,95,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-28T08:30:15Z,2022-07-28T08:30:15Z,So do we have a roadmap of version-release/features in github? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZXU_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/95,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZiPH,incubator-uniffle,1197876167,95,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-28T09:10:04Z,2022-07-28T09:10:04Z,"> So do we have a roadmap of version-release/features in github? @jerqi

Not yet. 0.6 version's main feature is to support K8S.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZiPH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/97,https://api.github.com/repos/apache/incubator-uniffle/issues/97,incubator-uniffle,1320584648,97,[Improvement] Introduce config to customize assignment server numbers in client side,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-07-28T08:33:03Z,2022-08-01T12:18:59Z,"### Motivation
Now the assignment number specified by coordinator's conf of `rss.coordinator.shuffle.nodes.max`. But i think it's not suitable for all spark jobs. 

We should introduce new config to let client specify the assignment server number. `rss.coordinator.shuffle.nodes.max` should be as a max limitation of clients' number.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/97/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/97,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZYGd,incubator-uniffle,1197834653,97,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-28T08:33:14Z,2022-07-28T08:33:14Z,Do u think so? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZYGd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/97,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZh99,incubator-uniffle,1197875069,97,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-28T09:09:04Z,2022-07-28T09:09:04Z,Make sense.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZh99/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/97,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdGiB,incubator-uniffle,1198811265,97,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-29T02:16:34Z,2022-07-29T02:16:34Z,I will take it and submit PR later.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdGiB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/97,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdQWl,incubator-uniffle,1198851493,97,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-29T03:50:41Z,2022-07-29T03:50:41Z,PR #100 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HdQWl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/97,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hl8L-,incubator-uniffle,1201128190,97,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-01T12:18:59Z,2022-08-01T12:18:59Z,Solved by #100 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hl8L-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/98,https://api.github.com/repos/apache/incubator-uniffle/issues/98,incubator-uniffle,1320629880,98,[Improvement] Add indicators to judge whether the node is healthy,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,OPEN,2022-07-28T09:09:15Z,2022-08-19T11:51:16Z,"At present, there is only disk i/o in the health detection of the machine. Whether to add the index of memory utilization?  What do u think of that? @jerqi","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/98/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/98,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZinV,incubator-uniffle,1197877717,98,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-28T09:11:33Z,2022-07-28T09:11:33Z,"> At present, there is only disk i/o in the health detection of the machine. Whether to add the index of memory utilization? What do u think of that? @jerqi

A heath check about memory utilization?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HZinV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/101,https://api.github.com/repos/apache/incubator-uniffle/issues/101,incubator-uniffle,1321737371,101,[Improvement] Ignore failure on initializing local storage when setting multiple local storage paths in shuffle server client,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-07-29T04:15:07Z,2022-07-29T11:52:58Z,"### Motivation
 Ignore failure on initializing local storage when setting multiple local storage paths in shuffle server client","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/101/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/101,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hei3L,incubator-uniffle,1199189451,101,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-29T11:52:58Z,2022-07-29T11:52:58Z,Solved by #102 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hei3L/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/106,https://api.github.com/repos/apache/incubator-uniffle/issues/106,incubator-uniffle,1322264524,106,[Improvement] RPC timeout should be set in RPC client,xianjingfeng,11752250,,,CLOSED,2022-07-29T13:37:19Z,2022-08-03T02:49:51Z,"If oom encountered in shuffle server, rpc client will blocked until shuffle server was killed","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/106/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/106,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hf5iz,incubator-uniffle,1199544499,106,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-29T15:31:41Z,2022-07-29T15:31:41Z,"Make sense, do you want to raise a pr?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hf5iz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/106,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh8xc,incubator-uniffle,1200082012,106,NA,xianjingfeng,11752250,,,NA,2022-07-30T03:56:19Z,2022-07-30T03:56:19Z,"> Make sense, do you want to raise a pr?

Yes","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh8xc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/106,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiNEC,incubator-uniffle,1200148738,106,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-07-30T12:25:51Z,2022-07-30T12:25:51Z,"I had met similar problem, but the client side would exit with a timeout, due to using the `blockingStub.withDeadlineAfter(
        RPC_TIMEOUT_DEFAULT_MS, TimeUnit.MILLISECONDS).requireBuffer(rpcRequest);` @jerqi @xianjingfeng ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiNEC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/106,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiOsE,incubator-uniffle,1200155396,106,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-30T13:11:24Z,2022-07-30T13:11:24Z,"> I had met similar problem, but the client side would exit with a timeout, due to using the `blockingStub.withDeadlineAfter( RPC_TIMEOUT_DEFAULT_MS, TimeUnit.MILLISECONDS).requireBuffer(rpcRequest);` @jerqi @xianjingfeng

Some rpc methods don't use  `blockingStub.withDeadlineAfter( RPC_TIMEOUT_DEFAULT_MS, TimeUnit.MILLISECONDS).requireBuffer(rpcRequest)`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiOsE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/106,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Huscq,incubator-uniffle,1203423018,106,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-03T02:49:50Z,2022-08-03T02:49:50Z,Solved by #113 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Huscq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/107,https://api.github.com/repos/apache/incubator-uniffle/issues/107,incubator-uniffle,1322270649,107,"[Improvement] When `registerShuffleServers` fail, we should assign partition again",xianjingfeng,11752250,,,CLOSED,2022-07-29T13:42:51Z,2022-08-02T02:51:38Z,"If registerShuffleServers failed, task will fail and then application will failed","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/107/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/107,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hf2RW,incubator-uniffle,1199531094,107,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-29T15:26:14Z,2022-07-29T15:26:14Z,"Make sense, do you want to raise a pr?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hf2RW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/107,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh8xo,incubator-uniffle,1200082024,107,NA,xianjingfeng,11752250,,,NA,2022-07-30T03:56:25Z,2022-07-30T03:56:25Z,"> Make sense, do you want to raise a pr?

Yes","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh8xo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/107,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HpGFi,incubator-uniffle,1201955170,107,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-02T02:51:38Z,2022-08-02T02:51:38Z,Solved by #115 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HpGFi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/108,incubator-uniffle,1322276852,108,[Improvement] Read shuffle data fail because read index file fail,xianjingfeng,11752250,,,CLOSED,2022-07-29T13:48:24Z,2023-01-12T07:09:38Z,"Every commit calls must success when  `sendCommit` now, this will casue if one shuffle server dead, then application fail","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/108/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hf6YF,incubator-uniffle,1199547909,108,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-29T15:33:03Z,2022-07-29T15:33:03Z,We recommend users to use StorageType MEMORY_LOCALFILE_HDFS or MEMORY_LOCALFILE. The application won't commit data.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hf6YF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh8yv,incubator-uniffle,1200082095,108,NA,xianjingfeng,11752250,,,NA,2022-07-30T03:57:03Z,2022-07-30T03:57:03Z,"> We recommend users to use StorageType MEMORY_LOCALFILE_HDFS or MEMORY_LOCALFILE. The application won't commit data.

So, should we remove `LOCALFILE`?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh8yv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh9ky,incubator-uniffle,1200085298,108,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-30T04:21:27Z,2022-07-30T04:21:27Z,"> > We recommend users to use StorageType MEMORY_LOCALFILE_HDFS or MEMORY_LOCALFILE. The application won't commit data.
> 
> So, should we remove `LOCALFILE`?

It's useful for test code. And if we want to reduce our shuffle server state, it's a good way to commit data although the LOCALFILE storageType don't have a good practice.  So I think we shouldn't remove it currently. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh9ky/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HvZBn,incubator-uniffle,1203605607,108,NA,xianjingfeng,11752250,,,NA,2022-08-03T07:48:45Z,2022-08-03T07:48:45Z,"I found if use `MEMORY_LOCALFILE`, `finishShuffle` will not be called,  and buffer in server side may not flush in time, and than reader will fail because read index file fail. as follows
`Error happened when get shuffle index for appId[application_xxx], shuffleId[3], partitionId[1], Can't find folder /HDATA/2/rssdata/application_xxx/3/1-1`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HvZBn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HvbG_,incubator-uniffle,1203614143,108,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-08-03T07:57:19Z,2022-08-03T07:57:19Z,"> I found if use `MEMORY_LOCALFILE`, `finishShuffle` will not be called, and buffer in server side may not flush in time, and than reader will fail because read index file fail. as follows `Error happened when get shuffle index for appId[application_xxx], shuffleId[3], partitionId[1], Can't find folder /HDATA/2/rssdata/application_xxx/3/1-1`

@xianjingfeng With current implementation, write shuffle data to N shuffle server can handle the situation about shuffle server failed. But it will cost N times storage.  User can make such choice.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HvbG_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HveRR,incubator-uniffle,1203627089,108,NA,xianjingfeng,11752250,,,NA,2022-08-03T08:10:09Z,2022-08-03T08:10:09Z,We had set `spark.rss.data.replica.write=2` and `spark.rss.data.replica=3`.But we found all shuffle server of a partition have not flush in time today and we have found in two applications. It may be easy to encounter when our cluster is not in high load.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HveRR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HvhsQ,incubator-uniffle,1203641104,108,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-08-03T08:24:11Z,2022-08-03T08:24:11Z,"> We had set `spark.rss.data.replica.write=2` and `spark.rss.data.replica=3`.But we found all shuffle server of a partition have not flush in time today and we have found in two applications. It may be easy to encounter when our cluster is not in high load.

what kind of storage type used in your case?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HvhsQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hvifg,incubator-uniffle,1203644384,108,NA,xianjingfeng,11752250,,,NA,2022-08-03T08:27:22Z,2022-08-03T08:27:22Z,"> what kind of storage type used in your case?

MEMORY_LOCALFILE","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hvifg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hvkb2,incubator-uniffle,1203652342,108,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-08-03T08:35:13Z,2022-08-03T08:35:13Z,@frankliee can you do more clarification about how to config  `spark.rss.data.replica.write` & `spark.rss.data.replica.read` ?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hvkb2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HwJua,incubator-uniffle,1203805082,108,NA,frankliee,10219731,,885626704@qq.com,NA,2022-08-03T11:09:46Z,2022-08-03T11:09:46Z,"These configs are come from quorum protocol.
`rss.data.replica` is default replica number of partition.
`rss.data.replica.write` is the minimum replica that writer should write metadata and data successfully. 
`rss.data.replica.read` is the minimum replica that reader should read metadata successfully (data can read from only one replica). 
So the recommended values are (1,1,1) and (3,2,2).
 
These are client-side configs,  and will not change server-side state.
The flush is controlled by server configs, such as memory capacity and watermarks.
  ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HwJua/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0Di-,incubator-uniffle,1204828350,108,NA,xianjingfeng,11752250,,,NA,2022-08-04T06:39:08Z,2022-08-04T06:39:08Z,"So, Is there a problem?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0Di-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SP5t2,incubator-uniffle,1379900278,108,NA,xianjingfeng,11752250,,,NA,2023-01-12T07:09:37Z,2023-01-12T07:09:37Z,Fix by #213 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SP5t2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/109,https://api.github.com/repos/apache/incubator-uniffle/issues/109,incubator-uniffle,1322286501,109,[Improvement] There should be a bounded and blocked queue when sendShuffleData in client side,xianjingfeng,11752250,,,CLOSED,2022-07-29T13:57:02Z,2022-10-23T05:27:41Z,"In `RssShuffleManager`，the `workQueue` of `threadPoolExecutor`is unbounded now. If `sendShuffleData` not fast enough, it will cost a lot of memory","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/109/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/109,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hf37o,incubator-uniffle,1199537896,109,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-29T15:29:05Z,2022-07-29T15:29:05Z,Will it bring any other problems?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hf37o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/109,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh9FE,incubator-uniffle,1200083268,109,NA,xianjingfeng,11752250,,,NA,2022-07-30T04:05:39Z,2022-07-30T04:05:39Z,"> Will it bring any other problems?

It may cause OOM","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh9FE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/109,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh9UG,incubator-uniffle,1200084230,109,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-30T04:14:15Z,2022-07-30T04:14:15Z,We have a class `WriteBufferManager`. The class will control the memory that we can use.  It is strange to cause OOM. I doubt whether it is caused by the issue that pr #67 want to fix.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hh9UG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/109,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiFFV,incubator-uniffle,1200116053,109,NA,xianjingfeng,11752250,,,NA,2022-07-30T08:24:50Z,2022-07-30T08:24:50Z,"May be it is,  i am not sure.  I once found out an application failed due to `requestExecutorMemory` fail. Should we limit memory usage when sending data.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiFFV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/109,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiFRg,incubator-uniffle,1200116832,109,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-30T08:31:20Z,2022-07-30T08:31:20Z,"> May be it is, i am not sure. I once found out an application failed due to `requestExecutorMemory` fail. Should we limit memory usage when sending data.

I think we don't need, because we have `WriteBufferManager`. If our `WriteBufferManager` works well, OOM shouldn't occur. If our `WriteBufferManager` has bug, we should fix it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiFRg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/111,https://api.github.com/repos/apache/incubator-uniffle/issues/111,incubator-uniffle,1322948526,111,[Improvement] Waiting time for executing stop script is too long even if the JVM exits early,xianjingfeng,11752250,,,CLOSED,2022-07-30T09:37:40Z,2022-07-30T10:03:26Z,Waiting time for executing stop script is too long even if the JVM exits early.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/111/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/111,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiIEn,incubator-uniffle,1200128295,111,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-07-30T10:03:26Z,2022-07-30T10:03:26Z,Solved by pr #112 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HiIEn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/114,https://api.github.com/repos/apache/incubator-uniffle/issues/114,incubator-uniffle,1323974606,114,[Improvement] Can we support AE of SPARK2.4,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2022-08-01T07:42:09Z,2024-06-05T06:20:44Z,"At present, Spark does not support AE in version 2.4, should it be supported? Or are there any reasons why it is not supported?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/114/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/114,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hk6QN,incubator-uniffle,1200858125,114,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-08-01T08:05:27Z,2022-08-01T08:05:27Z,"I think AE is an experience feature in Spark 2.4, and it was officially announced in Spark 3.
So it isn't planned to be supported in Spark 2.4 in short term, but anyone is welcome to contribute this feature if interested.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hk6QN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/114,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HlBFC,incubator-uniffle,1200886082,114,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-01T08:28:38Z,2022-08-01T08:28:38Z,AE of Spark 2.4 isn't a complete feature. We shouldn't support it.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HlBFC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/123,https://api.github.com/repos/apache/incubator-uniffle/issues/123,incubator-uniffle,1327102272,123,Improve our test code style,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-08-03T11:50:23Z,2022-08-24T02:46:31Z,"Now, there are many style errors in our test code. Because our checkstyle plugin don't check test code. To enable the plugin, we should fix the style errors of the code first. https://github.com/Tencent/Firestorm/pull/155 pr tells us how enable plugin to check test code style. We should enable the plugin to check test code style in one branch,  fix the style errors module by module and
cherry-pick the fix code in another branch, and raise a fix pr.

 This issue will track the pull requests.
Related prs:
#99 fix common module
#122  fix coordinator module
#131  fix storage module","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/123/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/124,incubator-uniffle,1327991124,124,"[Bug] Blocks read inconsistent: expected xxx blocks, actual xxx blocks",xianjingfeng,11752250,,,CLOSED,2022-08-04T02:42:38Z,2022-11-28T16:04:27Z,"1. If we set `spark.rss.data.replica.write=2` and `spark.rss.data.replica=3`,Data integrity cannot be guaranteed in any one shuffle server. right?
2. But in method `org.apache.uniffle.storage.handler.impl.LocalFileQuorumClientReadHandler#readShuffleData`, it just read from one shuffle server","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/124/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hzl7C,incubator-uniffle,1204707010,124,NA,frankliee,10219731,,885626704@qq.com,NA,2022-08-04T03:15:13Z,2022-08-04T03:15:13Z,"Which version did you use？

Do you set `spark.rss.data.replica.read=2` ?  It ensures the bitmap metadata of blocks to be written to 2 servers.

As long as the read client gets the metadata from the 2 of servers, it can check the integrity of data from any one of server.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hzl7C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HzpPD,incubator-uniffle,1204720579,124,NA,xianjingfeng,11752250,,,NA,2022-08-04T03:42:17Z,2022-08-04T03:42:17Z,"> Do you set `spark.rss.data.replica.read=2`

Yes



> As long as the read client gets the metadata from the 2 of servers, it can check the integrity of data from any one of server.

But this step seems execute before `readShuffleData`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5HzpPD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hzpp5,incubator-uniffle,1204722297,124,NA,xianjingfeng,11752250,,,NA,2022-08-04T03:45:40Z,2022-08-04T03:45:40Z,"> Which version did you use

internal version 0.5.0-snapshot","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hzpp5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hz-u9,incubator-uniffle,1204808637,124,NA,frankliee,10219731,,885626704@qq.com,NA,2022-08-04T06:17:10Z,2022-08-04T06:17:10Z,"> > Do you set `spark.rss.data.replica.read=2`
> 
> Yes
> 
> > As long as the read client gets the metadata from the 2 of servers, it can check the integrity of data from any one of server.
> 
> But this step seems execute before `readShuffleData`

The metadata is acquired in advance, but data integrity check is executed when all blocks have been fetched.
In current implementation, the client will only fetch “the first available” server to avoid the read cost. 
But when the data in this first server is damaged, the final check will report ""read inconsistent"".
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Hz-u9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0CXt,incubator-uniffle,1204823533,124,NA,xianjingfeng,11752250,,,NA,2022-08-04T06:33:29Z,2022-08-04T06:33:29Z,"I know, but the application will fail","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0CXt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0EHl,incubator-uniffle,1204830693,124,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-04T06:42:08Z,2022-08-04T06:42:08Z,"> > > Do you set `spark.rss.data.replica.read=2`
> > 
> > 
> > Yes
> > > As long as the read client gets the metadata from the 2 of servers, it can check the integrity of data from any one of server.
> > 
> > 
> > But this step seems execute before `readShuffleData`
> 
> The metadata is acquired in advance, but data integrity check is executed when all blocks have been fetched. In current implementation, the client will only fetch “the first available” server to avoid the read cost. But when the data in this first server is damaged, the final check will report ""read inconsistent"".

I feel a little unreasonable about this implement. Should we read next shuffle server when the data isn't complete?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0EHl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0FXY,incubator-uniffle,1204835800,124,NA,xianjingfeng,11752250,,,NA,2022-08-04T06:48:20Z,2022-08-04T06:48:20Z,"> I feel a little unreasonable about this implement. Should we read next shuffle server when the data isn't complete?

I am trying to do this, and i think it needs to be fixed with #108 together","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0FXY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0HON,incubator-uniffle,1204843405,124,NA,frankliee,10219731,,885626704@qq.com,NA,2022-08-04T06:57:09Z,2022-08-04T06:57:09Z,"I would be happy to review this PR, and you should avoid to fetch redundancy blocks from the another server (because the spark has consumed this blocks).
Rss has provided some skipping mechanisms for localfile and hdfs.
But I'am worry about memory data. @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0HON/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0H7F,incubator-uniffle,1204846277,124,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-04T07:00:25Z,2022-08-04T07:00:25Z,"> I would be happy to review this PR, and you should avoid to fetch redundancy blocks from the another server (because the spark has consumed this blocks). Rss has provided some skipping mechanisms for localfile and hdfs. But I'am worry about memory data. @jerqi

In my opinion, memory data should also have data skip ability, and our read memory process should be optimized.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0H7F/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0Jin,incubator-uniffle,1204852903,124,NA,xianjingfeng,11752250,,,NA,2022-08-04T07:07:49Z,2022-08-04T07:07:49Z,Get,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0Jin/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0Jst,incubator-uniffle,1204853549,124,NA,frankliee,10219731,,885626704@qq.com,NA,2022-08-04T07:08:33Z,2022-08-04T07:08:33Z,"This will change server's memory storage to add ""index"" like hdfs","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0Jst/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0LJ4,incubator-uniffle,1204859512,124,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-04T07:14:29Z,2022-08-04T07:14:29Z,"> This will change server's memory storage to add ""index"" like hdfs

This problem will should discuss in another issue, we also should have a simple design doc.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H0LJ4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/124,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PPEVm,incubator-uniffle,1329349990,124,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-28T16:04:27Z,2022-11-28T16:04:27Z,closed by #276 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PPEVm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/127,https://api.github.com/repos/apache/incubator-uniffle/issues/127,incubator-uniffle,1328719557,127,[Improvement] Add timeout reconnection in DelegationRssShuffleManager,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2022-08-04T14:25:57Z,2022-08-08T06:06:34Z,"When `DelegationRssShuffleManager` send an `AccessClusterRequest` to the Coordinator, should we increase the logic of overtime resending?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/127/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H2Knr,incubator-uniffle,1205381611,127,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-04T15:03:46Z,2022-08-04T15:03:46Z,"> 

Why do we need this? What's your situation? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H2Knr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H4ha-,incubator-uniffle,1205999294,127,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-05T03:20:25Z,2022-08-05T03:20:25Z,"The reason is that the `ShuffleServer` returns the heartbeat at a frequency of 10s each time. The `Coordinator` filters the `ShuffleServer` whose available memory is lower than the threshold value, which may cause the `ShuffleServer` to be lower than the allocable quantity. In this way, it is pushed down to SSM, add a retry logic and two parameters, retry times and time. Within the user's expected retry time, run on RSS as much as possible.WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H4ha-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H4hu4,incubator-uniffle,1206000568,127,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-05T03:23:14Z,2022-08-05T03:23:14Z,"Similar pr: https://github.com/apache/incubator-uniffle/pull/115 , Could it solve your issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H4hu4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H4kp9,incubator-uniffle,1206012541,127,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-05T03:51:24Z,2022-08-05T03:51:24Z,"> Similar pr: #115 , Could it solve your issue?

My fault. I misunderstand you. The improvement is acceptable for me. Do you want to raise a pr?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H4kp9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H4njZ,incubator-uniffle,1206024409,127,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-05T04:18:29Z,2022-08-05T04:18:29Z,"Sure, I am trying to do this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H4njZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H_B0T,incubator-uniffle,1207704851,127,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-08T06:06:34Z,2022-08-08T06:06:34Z,Solved by #139 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H_B0T/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/133,incubator-uniffle,1330617854,133,[Umbrella] Netty replace Grpc on data transfer,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-08-06T02:49:33Z,2023-07-28T01:56:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.

### Describe the proposal
When we use Grpc, we find that our bottleneck is on Grpc, Grpc brings the cost of data copy and data serialization. We must encounter GC problems when we use Grpc. We should use Netty replace Grpc on data transfer and use off heap memory to reduce GC time.

### Task list

- [x] #582
- [x] #583
- [x] #584
- [x] #585 
- [x] #586 
- [ ] #587 
- [x] #590
- [ ] #591 
- [x] #592 
- [ ] #593
- [x] #596
- [x] #597
- [ ] #639 
- [x] #640
- [x] #711
- [x] #719 
- [x] #720
- [x] #804
### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/133/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K6qfN,incubator-uniffle,1256892365,133,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-24T07:23:20Z,2022-09-24T07:23:20Z,"Could we use grpc zero-copy to solve this problem? 

By the way, Alluxio also use Grpc to transfer data, I think the problem we encountered also exist in Alluxio. We could refer https://dzone.com/articles/moving-from-apache-thrift-to-grpc-a-perspective-fr?utm_medium=tumblr&utm_source=dlvr.it&utm_campaign=Feed%3A%20dzone%2Fintegration","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K6qfN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K-bXK,incubator-uniffle,1257878986,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-26T11:20:07Z,2022-09-26T11:20:07Z,"> Could we use grpc zero-copy to solve this problem?
> 
> By the way, Alluxio also use Grpc to transfer data, I think the problem we encountered also exist in Alluxio. We could refer https://dzone.com/articles/moving-from-apache-thrift-to-grpc-a-perspective-fr?utm_medium=tumblr&utm_source=dlvr.it&utm_campaign=Feed%3A%20dzone%2Fintegration

It seems that it use protobuf to serialize the data. It's not effective enough.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K-bXK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCRM5,incubator-uniffle,1258885945,133,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-27T02:33:09Z,2022-09-27T02:33:09Z,"I haven't look through the full design of GRPC zero-copy and Alluxio's implementation. 
Maybe we could do the POC to test the performance compared with the netty implementation. Overall, it looks easy to extend the zero-copy by GRPC, like this https://github.com/GoogleCloudPlatform/grpc-gcp-java/pull/77

From my perspective, GRPC is the general and cross-language, that means it make possible to implement the shuffle-server by other languages like rust to avoid GC and obtain better memory management in the future.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCRM5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCRyb,incubator-uniffle,1258888347,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-27T02:37:21Z,2022-09-27T02:37:21Z,We have had a POC code about Netty. It will improve 10% performance for Uniffle. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCRyb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCUoG,incubator-uniffle,1258899974,133,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-27T02:53:52Z,2022-09-27T02:53:52Z,"> We have had a POC code about Netty. It will improve 10% performance for Uniffle.

Sounds great! If I have time, I will do a zero-copy POC to compare with netty.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCUoG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LD1Bs,incubator-uniffle,1259294828,133,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-27T10:20:31Z,2022-09-27T10:20:31Z,"After applying the POC of netty, will the problem of #230 exist? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LD1Bs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Mr0nb,incubator-uniffle,1286556123,133,NA,leixm,31424839,Xianming Lei,,NA,2022-10-21T07:15:21Z,2022-10-21T07:15:21Z,"What is the progress of this proposal, maybe I can join the development?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Mr0nb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsKSP,incubator-uniffle,1286644879,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T08:36:58Z,2022-10-21T08:36:58Z,"> What is the progress of this proposal, maybe I can join the development?

We only have some POC code. I don't have much time, if you like , I can assign this issue to you. And I can provide our POC code to you.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsKSP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsLED,incubator-uniffle,1286648067,133,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-21T08:39:56Z,2022-10-21T08:39:56Z,"> > What is the progress of this proposal, maybe I can join the development?
> 
> We only have some POC code. I don't have much time, if you like , I can assign this issue to you. And I can provide our POC code to you.

+1. Could u help make this POC code to another branch.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsLED/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MtiyM,incubator-uniffle,1287007372,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T13:59:18Z,2022-10-21T13:59:18Z,"Commit ID: 4463b80deacbcd47ddc151f8d7750d1e5f035077
git apply patch1  
[netty1.txt](https://github.com/apache/incubator-uniffle/files/9839621/netty1.txt)

git apply patch2 
[netty2.txt](https://github.com/apache/incubator-uniffle/files/9839628/netty2.txt)

After apply the patches, we can get the code
https://github.com/jerqi/incubator-uniffle/tree/netty_poc

According the poc test, we can get 10% performance improvement.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MtiyM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MtjvE,incubator-uniffle,1287011268,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T14:02:21Z,2022-10-21T14:02:21Z,"This poc is based on Uber RSS netty implement, it's better that we can compare the Ali's rss netty implement, Uber's rss netty implement and other RSS netty implement.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MtjvE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MyrpP,incubator-uniffle,1288354383,133,NA,leixm,31424839,Xianming Lei,,NA,2022-10-24T03:10:49Z,2022-10-24T03:10:49Z,"> Commit ID: [4463b80](https://github.com/apache/incubator-uniffle/commit/4463b80deacbcd47ddc151f8d7750d1e5f035077) git apply patch1 [netty1.txt](https://github.com/apache/incubator-uniffle/files/9839621/netty1.txt)
> 
> git apply patch2 [netty2.txt](https://github.com/apache/incubator-uniffle/files/9839628/netty2.txt)
> 
> After apply the patches, we can get the code https://github.com/jerqi/incubator-uniffle/tree/netty_poc
> 
> According the poc test, we can get 10% performance improvement.

Thank you.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MyrpP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5Ir_,incubator-uniffle,1290046207,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-25T06:26:52Z,2022-10-25T06:26:52Z,"@leixm  @zuston Do you want to discuss this issue through a meeting? I will start a meeting to discuss the issue #80, I want to discuss this issue, too. There are some other issues which we need to discuss, so I will send a email to our dev mail list, and select a proper date to start the meeting. You can tell me what time you are free by the email.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5Ir_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5biF,incubator-uniffle,1290123397,133,NA,leixm,31424839,Xianming Lei,,NA,2022-10-25T07:38:41Z,2022-10-25T07:38:41Z,"> @leixm @zuston Do you want to discuss this issue through a meeting? I will start a meeting to discuss the issue #80, I want to discuss this issue, too. There are some other issues which we need to discuss, so I will send a email to our dev mail list, and select a proper date to start the meeting. You can tell me what time you are free by the email.

Let's discuss it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5biF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M6FDe,incubator-uniffle,1290293470,133,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-25T09:57:55Z,2022-10-25T09:57:55Z,"> > @leixm @zuston Do you want to discuss this issue through a meeting? I will start a meeting to discuss the issue #80, I want to discuss this issue, too. There are some other issues which we need to discuss, so I will send a email to our dev mail list, and select a proper date to start the meeting. You can tell me what time you are free by the email.
> 
> Let's discuss it.

+1. Could we have a discussion in this week? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M6FDe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-coT,incubator-uniffle,1291438611,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-26T03:12:49Z,2022-10-26T03:12:49Z,@leixm I have already send an email https://lists.apache.org/thread/2jlm3fswmsxy619ldyo4px700p3ybnvc. Do you have time at 11 am (UTC +8) Thursday this week?  ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-coT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-dRu,incubator-uniffle,1291441262,133,NA,leixm,31424839,Xianming Lei,,NA,2022-10-26T03:16:52Z,2022-10-26T03:16:52Z,"Yes, I'm free at this time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-dRu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-5lB,incubator-uniffle,1291557185,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-26T06:21:24Z,2022-10-26T06:21:24Z,"> Yes, I'm free at this time.

Meeting link is https://meeting.tencent.com/dm/oR95wASCNe91","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-5lB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NERGU,incubator-uniffle,1292964244,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-27T04:32:26Z,2022-10-27T04:32:26Z,"Offline Discussion Result:
We will compare the rpc frameworks of other rss, and @leixm will give a design doc. Next step, we will make the shuffle server will off heap as possible as we can.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NERGU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pp00F,incubator-uniffle,1336364293,133,NA,leixm,31424839,Xianming Lei,,NA,2022-12-04T09:59:15Z,2022-12-04T09:59:15Z,https://docs.google.com/document/d/1srlBlLpJ3hbzd8ru5QaY5aCSLR9M2ttHXmlvcFC-SLg/edit?usp=sharing @jerqi  @zuston  @smallzhongfeng  @smallzhongfeng  Can you help review this design.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pp00F/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pp1Dn,incubator-uniffle,1336365287,133,NA,leixm,31424839,Xianming Lei,,NA,2022-12-04T10:03:43Z,2022-12-04T10:03:43Z,"Currently, we use Uniffle version 0.6.0 internally. When there are tasks running, the GC of Shuffle Server will take up to 40% of the cpu time, and FullGC will appear occasionally.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pp1Dn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pp5ln,incubator-uniffle,1336383847,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-04T11:15:46Z,2022-12-04T11:15:46Z,@leixm Could you give us the authority of the comment for your design doc?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pp5ln/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pp_FG,incubator-uniffle,1336406342,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-04T13:00:44Z,2022-12-04T13:00:44Z,"Thanks @leixm There are some questions.
1. Do you have a POC test? Could you attach test result?
2. Do you compare with other plans, such as Uber, Alibaba RSS, Bytedance RSS. Could we reuse their plan?
3. Do our client need off heap memory to read the data from the server?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pp_FG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrKjR,incubator-uniffle,1336715473,133,NA,leixm,31424839,Xianming Lei,,NA,2022-12-05T04:03:51Z,2022-12-05T04:03:51Z,"1.I did some POC tests, which can significantly reduce GCTime, I will sort out and upload some test results later
2.I made some comparisons. The design we propose is similar to Alibaba RSS. Do you have a better suggestion? I tried to do some tests on each RSS, but I found it difficult to do a specific performance comparison
3.read buffer refers to the memory usage of ShuffleServer, not the client","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrKjR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrLE_,incubator-uniffle,1336717631,133,NA,leixm,31424839,Xianming Lei,,NA,2022-12-05T04:05:46Z,2022-12-05T04:05:46Z,"These RSS have one thing in common, using off-heap memory, their GC time is significantly smaller than Uniffle.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrLE_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrMLK,incubator-uniffle,1336722122,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-05T04:09:41Z,2022-12-05T04:09:41Z,"> 1.I did some POC tests, which can significantly reduce GCTime, I will sort out and upload some test results later 2.I made some comparisons. The design we propose is similar to Alibaba RSS. Do you have a better suggestion? I tried to do some tests on each RSS, but I found it difficult to do a specific performance comparison 3.read buffer refers to the memory usage of ShuffleServer, not the client

Could we have analysis about the every RSS's network transfer? How about poc code which I provide? Do they have the same performance?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrMLK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrMq6,incubator-uniffle,1336724154,133,NA,leixm,31424839,Xianming Lei,,NA,2022-12-05T04:11:34Z,2022-12-05T04:11:34Z,"> @leixm Could you give us the authority of the comment for your design doc?

done, Can you comment now?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrMq6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrM8j,incubator-uniffle,1336725283,133,NA,leixm,31424839,Xianming Lei,,NA,2022-12-05T04:12:36Z,2022-12-05T04:12:36Z,"> > 1.I did some POC tests, which can significantly reduce GCTime, I will sort out and upload some test results later 2.I made some comparisons. The design we propose is similar to Alibaba RSS. Do you have a better suggestion? I tried to do some tests on each RSS, but I found it difficult to do a specific performance comparison 3.read buffer refers to the memory usage of ShuffleServer, not the client
> 
> Could we have analysis about the every RSS's network transfer? How about poc code which I provide? Do they have the same performance?

Any suggestions to measure the performance precisely?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrM8j/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrNzT,incubator-uniffle,1336728787,133,NA,leixm,31424839,Xianming Lei,,NA,2022-12-05T04:16:21Z,2022-12-05T04:16:21Z,"I think we can evaluate whether the performance has improved in two parts. The first part is GC time, which is relatively simple. You can evaluate it by viewing the process through the running time of the app and jstat. The second part is whether serialization/deserialization has improved , this is more complicated. At present, what I think of is to evaluate through transportTime, which includes the serialization/deserialization time of the client, the network transmission time, and the serialization/deserialization time of ShuffleServer","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrNzT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrRYs,incubator-uniffle,1336743468,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-05T04:39:50Z,2022-12-05T04:39:50Z,"> > > 1.I did some POC tests, which can significantly reduce GCTime, I will sort out and upload some test results later 2.I made some comparisons. The design we propose is similar to Alibaba RSS. Do you have a better suggestion? I tried to do some tests on each RSS, but I found it difficult to do a specific performance comparison 3.read buffer refers to the memory usage of ShuffleServer, not the client
> > 
> > 
> > Could we have analysis about the every RSS's network transfer? How about poc code which I provide? Do they have the same performance?
> 
> Any suggestions to measure the performance precisely?

I don't know whether micro benchmark can solve this problem. GC time can only be evaluted when we use several jobs to verify them. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrRYs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrRd-,incubator-uniffle,1336743806,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-05T04:40:31Z,2022-12-05T04:40:31Z,"> > @leixm Could you give us the authority of the comment for your design doc?
> 
> done, Can you comment now?

Yes.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PrRd-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QLDxs,incubator-uniffle,1345076332,133,NA,leixm,31424839,Xianming Lei,,NA,2022-12-10T04:05:09Z,2022-12-10T04:05:09Z,"cc@jerqi  I've included some test data in the design doc, including uniffle, celeborn, bytedance css, uber rss.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QLDxs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QLLlZ,incubator-uniffle,1345108313,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-10T04:24:29Z,2022-12-10T04:24:29Z,"> cc@jerqi I've included some test data in the design doc, including uniffle, celeborn, bytedance css, uber rss.

If we can prove the Celeborn have better performance than Uber RSS. We can continue this our design. We also need to consider that we need use offheap memory to compress/decompress data.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QLLlZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5irT,incubator-uniffle,1407593171,133,NA,advancedxy,807537,,,NA,2023-01-29T08:04:50Z,2023-01-29T08:04:50Z,"Hi, @leixm xianming,  has this issue already been addressed in your internal prod env? Do you any ETA for the PR to be uploaded?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5irT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4TC5,incubator-uniffle,1424044217,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-09T11:33:40Z,2023-02-09T11:33:40Z,"@advancedxy  @jerqi  I have uploaded a POC code, which is helpful to alleviate the problem of FullGC, but many places still need to be optimized. https://github.com/leixm/incubator-uniffle/tree/netty_poc_2","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4TC5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4Tn3,incubator-uniffle,1424046583,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-09T11:36:01Z,2023-02-09T11:36:01Z,"> Hi, @leixm xianming, has this issue already been addressed in your internal prod env? Do you any ETA for the PR to be uploaded?
It is still in the development process and has not been applied to the production environment.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4Tn3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4UDK,incubator-uniffle,1424048330,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-09T11:37:31Z,2023-02-09T11:37:31Z,Can I add some ISSUE? Let's get involved. @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4UDK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4UEx,incubator-uniffle,1424048433,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-09T11:37:38Z,2023-02-09T11:37:38Z,Can I add some ISSUE? Let's get involved. @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4UEx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4UzH,incubator-uniffle,1424051399,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-09T11:40:22Z,2023-02-09T11:40:22Z,"> Can I add some ISSUE? Let's get involved. @jerqi

Yes, you can.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U4UzH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U44v0,incubator-uniffle,1424198644,133,NA,advancedxy,807537,,,NA,2023-02-09T13:33:00Z,2023-02-09T13:33:00Z,"> https://github.com/leixm/incubator-uniffle/tree/netty_poc_2

Great. Do you think is it possible to submit an WIP pr now?

> It is still in the development process and has not been applied to the production environment.

No problem, let's create issues/prs targets your branch and discuss more.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U44v0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U8U5w,incubator-uniffle,1425100400,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-10T02:45:30Z,2023-02-10T02:45:30Z,"After offline discussion, we should involve more people to participate in this issue. @zuston @leixm @advancedxy @kaijchen @smallzhongfeng @xianjingfeng  Maybe we should have a regular meeting to discuss this issue continuously. WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U8U5w/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U8Vml,incubator-uniffle,1425103269,133,NA,xianjingfeng,11752250,,,NA,2023-02-10T02:51:01Z,2023-02-10T02:51:01Z,"> After offline discussion, we should involve more people to participate in this issue. @zuston @leixm @advancedxy @kaijchen @smallzhongfeng @xianjingfeng Maybe we should have a regular meeting to discuss this issue continuously. WDYT?

It is ok for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U8Vml/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U8dhM,incubator-uniffle,1425135692,133,NA,Gustfh,4916765,Gus Nie,,NA,2023-02-10T03:49:59Z,2023-02-10T03:49:59Z,"recently, we also working on this feature, since we found the problem is on the grpc, later we will share our result about this poc.  

+1 for the regular meeting","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U8dhM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U83_y,incubator-uniffle,1425244146,133,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-02-10T06:12:29Z,2023-02-10T06:12:29Z,"> After offline discussion, we should involve more people to participate in this issue. @zuston @leixm @advancedxy @kaijchen @smallzhongfeng @xianjingfeng Maybe we should have a regular meeting to discuss this issue continuously. WDYT?

It is ok for me.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U83_y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U842X,incubator-uniffle,1425247639,133,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-10T06:16:52Z,2023-02-10T06:16:52Z,Let's create a new branch such as `netty` for this feature. So we can collaborate on it before it's ready to be merged into master.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U842X/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9ALk,incubator-uniffle,1425277668,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-10T06:58:11Z,2023-02-10T06:58:11Z,"> After offline discussion, we should involve more people to participate in this issue. @zuston @leixm @advancedxy @kaijchen @smallzhongfeng @xianjingfeng Maybe we should have a regular meeting to discuss this issue continuously. WDYT?

It is ok for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9ALk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9Aof,incubator-uniffle,1425279519,133,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-10T07:00:05Z,2023-02-10T07:00:05Z,"> After offline discussion, we should involve more people to participate in this issue. @zuston @leixm @advancedxy @kaijchen @smallzhongfeng @xianjingfeng Maybe we should have a regular meeting to discuss this issue continuously. WDYT?

+1. Looking forward this. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9Aof/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9A-l,incubator-uniffle,1425280933,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-10T07:01:31Z,2023-02-10T07:01:31Z,"> > https://github.com/leixm/incubator-uniffle/tree/netty_poc_2
> 
> Great. Do you think is it possible to submit an WIP pr now?
> 
> > It is still in the development process and has not been applied to the production environment.
> 
> No problem, let's create issues/prs targets your branch and discuss more.

Should we submit WIP PR first or do a performance test first to prove that the code is valid, then submit WIP PR and continue to complete the code.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9A-l/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9I0Z,incubator-uniffle,1425313049,133,NA,advancedxy,807537,,,NA,2023-02-10T07:32:26Z,2023-02-10T07:32:26Z,"> After offline discussion, we should involve more people to participate in this issue. @zuston @leixm @advancedxy @kaijchen @smallzhongfeng @xianjingfeng Maybe we should have a regular meeting to discuss this issue continuously. WDYT?

sounds good to me. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9I0Z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9XGq,incubator-uniffle,1425371562,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-10T08:04:40Z,2023-02-10T08:04:40Z,"1. @leixm If we use Netty, we can transfer local file with `sendfile` that a zero copy linux api. We can remove read memory. 
It's an important improvement.
2. And maybe we need some benchmark tests. We could set up our benchmark test systems. @LuciferYang Do you give us some advice about benchmark tests? 
3. Reader and writer also need to support to use off heap memory to compress and decompress data.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9XGq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9d8z,incubator-uniffle,1425399603,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-10T08:20:36Z,2023-02-10T08:20:36Z,"Good idea, but the current performance bottleneck is mainly in ShuffleServer, we can improve the throughput of ShuffleServer first.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9d8z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9etD,incubator-uniffle,1425402691,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-10T08:23:40Z,2023-02-10T08:23:40Z,"> Good idea, but the current performance bottleneck is mainly in ShuffleServer, we can improve the throughput of ShuffleServer first.

You misunderstand me. When shuffle server read the local file, we use `sendfile` api to improve our shuffle server performance.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9etD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9fxx,incubator-uniffle,1425407089,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-10T08:27:53Z,2023-02-10T08:27:53Z,"> > Good idea, but the current performance bottleneck is mainly in ShuffleServer, we can improve the throughput of ShuffleServer first.
> 
> You misunderstand me. When shuffle server read the local file, we use `sendfile` api to improve our shuffle server performance.

You are right.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9fxx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9iH7,incubator-uniffle,1425416699,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-10T08:36:41Z,2023-02-10T08:36:41Z,"> 1. @leixm If we use Netty, we can transfer local file with `sendfile` that a zero copy linux api. We can remove read memory.
>    It's an important improvement.
> 2. And maybe we need some benchmark tests. We could set up our benchmark test systems. @LuciferYang Do you give us some advice about benchmark tests?
> 3. Reader and writer also need to support to use off heap memory to compress and decompress data.

These ideas are very good, we can raise issues.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9iH7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHC32,incubator-uniffle,1427910134,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-13T13:05:41Z,2023-02-13T13:05:41Z,"@leixm Have you do some performance tests? 
@advancedxy @Gustfh @smallzhongfeng @zuston @leixm @kaijchen How about every wednesday 10:15 am every week for this issue regular meeting?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHC32/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHLR_,incubator-uniffle,1427944575,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-13T13:28:03Z,2023-02-13T13:28:03Z,"I am doing some tests on the throughput performance of ShuffleServer, but the comparison results are not very good. I found that the performance of ShuffleServer has a lot to do with the disk write performance, and it needs to be better when the disk throughput performance is greater than the ShuffleServer throughput performance. Verify whether the throughput performance of ShuffleServer has improved.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHLR_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHLYL,incubator-uniffle,1427944971,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-13T13:28:19Z,2023-02-13T13:28:19Z,"> @leixm Have you do some performance tests? @advancedxy @Gustfh @smallzhongfeng @zuston @leixm @kaijchen How about every wednesday 10:15 am every week for this issue regular meeting?

It's ok for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHLYL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHLoj,incubator-uniffle,1427946019,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-13T13:29:08Z,2023-02-13T13:29:08Z,@jerqi  Or do you have a better test method to accurately verify the throughput performance of ShuffleServer?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHLoj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHMSR,incubator-uniffle,1427948689,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-13T13:30:58Z,2023-02-13T13:30:58Z,"Or we can write some test codes. After ShuffleServer receives the data, it does not perform disk writing operations, and verifies the throughput performance of ShuffleServer in the scenario where the impact of disk writing is excluded.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VHMSR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLLLB,incubator-uniffle,1428992705,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-14T01:57:48Z,2023-02-14T01:57:48Z,"The performance of disk is limited. Every HDD is 100MB/s. Every SDD is 1GB/s.
Usually we test this with 1TB tpcds and 1TB Terasort. If we can get performance improve, we can merge some prs first.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLLLB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VRg_V,incubator-uniffle,1430654933,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-15T02:13:56Z,2023-02-15T02:13:56Z,"> The performance of disk is limited. Every HDD is 100MB/s. Every SDD is 1GB/s. Usually we test this with 1TB tpcds and 1TB Terasort. If we can get performance improve, we can merge some prs first.

How many ShuffleServer nodes were there in the previous test?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VRg_V/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VRhQC,incubator-uniffle,1430656002,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-15T02:15:43Z,2023-02-15T02:15:43Z,"> > The performance of disk is limited. Every HDD is 100MB/s. Every SDD is 1GB/s. Usually we test this with 1TB tpcds and 1TB Terasort. If we can get performance improve, we can merge some prs first.
> 
> How many ShuffleServer nodes were there in the previous test?

3 - 6 nodes.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VRhQC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VRiOz,incubator-uniffle,1430660019,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-15T02:21:26Z,2023-02-15T02:21:26Z,I will do tpcds test to verify the performance.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VRiOz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VaI_0,incubator-uniffle,1432915956,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-16T11:07:49Z,2023-02-16T11:07:49Z,@leixm  I think we can submit some small prs to our master branch first.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VaI_0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VfOoP,incubator-uniffle,1434249743,133,NA,leixm,31424839,Xianming Lei,,NA,2023-02-17T07:41:59Z,2023-02-17T07:41:59Z,okay.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VfOoP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VmrIz,incubator-uniffle,1436201523,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-20T02:13:07Z,2023-02-20T02:13:07Z,"Meeting link https://meeting.tencent.com/dm/nVx6mxO8vIrc

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VmrIz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZfF22,incubator-uniffle,1501322678,133,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-10T02:49:03Z,2023-04-10T02:49:03Z,"I have some questions regarding the memory management of the shuffle server in the Netty implementation. Specifically, I'm curious about how we store shuffle data in memory. Do we use Netty's ByteBuf or a customized memory pool managed by Uniffle?

Based on my reading of the design document, there are two memory sections allocated for network and shuffle data storage. Would it be accurate to describe them as shared buffers?

I believe that introducing a customized memory pool could potentially address the above issues. Furthermore, this could also benefit the transfer of shuffle data using GRPC.

cc @leixm @advancedxy @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZfF22/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zj_Pf,incubator-uniffle,1502606303,133,NA,advancedxy,807537,,,NA,2023-04-11T02:34:57Z,2023-04-11T02:34:57Z,"> Based on my reading of the design document, there are two memory sections allocated for network and shuffle data storage. Would it be accurate to describe them as shared buffers?

It might be hard to share memory between shuffle data and network transport, but it's possible they are shared in a unified ByteBuffer pool, that means buffers should be released to pool then usable for other uses.

I believe we should do it in baby steps, the netty rpc framework should be introduced first, then the off-heap memory management, then unified memory management and spill. I haven't thought it throughly, but I believe we can learn from the best.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zj_Pf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkA7J,incubator-uniffle,1502613193,133,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-11T02:46:43Z,2023-04-11T02:46:43Z,"> I believe we should do it in baby steps, the netty rpc framework should be introduced first, then the off-heap memory management, then unified memory management and spill. 

Yes. Let's reserve this 

> I haven't thought it throughly, but I believe we can learn from the best.

https://github.com/flink-extended/flink-remote-shuffle is a good example","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkA7J/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkCCH,incubator-uniffle,1502617735,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-11T02:55:50Z,2023-04-11T02:55:50Z,"> > I believe we should do it in baby steps, the netty rpc framework should be introduced first, then the off-heap memory management, then unified memory management and spill.
> 
> Yes. Let's reserve this
> 
> > I haven't thought it throughly, but I believe we can learn from the best.
> 
> https://github.com/flink-extended/flink-remote-shuffle is a good example

If you think it's worth doing, you should set up an issue to track it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkCCH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dPZbJ,incubator-uniffle,1564317385,133,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-05-26T12:27:39Z,2023-05-26T12:27:39Z,How far off is this umbrella feature? I would be interested in taking a look at it as I have faced problems relating to large GC when running large shuffle jobs,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dPZbJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dPpAJ,incubator-uniffle,1564381193,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-26T13:16:46Z,2023-05-26T13:16:46Z,"> How far off is this umbrella feature? I would be interested in taking a look at it as I have faced problems relating to large GC when running large shuffle jobs.

Only two prs. But we should fix some issues. Maybe we can finish this feature at the end of June. What's your company? Do you use Uniffle in the production environment?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dPpAJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/133,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dae_i,incubator-uniffle,1567223778,133,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-29T14:39:29Z,2023-05-29T14:39:29Z,"> How far off is this umbrella feature? I would be interested in taking a look at it as I have faced problems relating to large GC when running large shuffle jobs

Maybe this is helpful for you. https://github.com/apache/incubator-uniffle/issues/674#issuecomment-1454611218","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dae_i/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/134,https://api.github.com/repos/apache/incubator-uniffle/issues/134,incubator-uniffle,1330618280,134,[Improvement] Support more tasks of the application,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-08-06T02:51:56Z,2024-02-20T08:19:51Z,"The current blockId is designed as following:
```
 // BlockId is long and composed by partitionId, executorId and AtomicInteger
 // AtomicInteger is first 19 bit, max value is 2^19 - 1
 // partitionId is next 24 bit, max value is 2^24 - 1
 // taskAttemptId is rest of 20 bit, max value is 2^20 - 1
```
**Why we need blockId?**
It's designed for data check, filter, memory data read, etc.

**Why blockId is designed as above?**
BlockId will be stored in Shuffle server, to reduce memory cost. Roaringbitmap is used to cache it.
According to implementation of Roaringbitmap, the design of BlockId is target to use `BitmapContainer` instead of `ArrayContainer` for memory saving.

**What's the problem of blockId?**
It can't support taskId which is greater than 2^20 - 1

**Proposal**
I think the first 19 bit is too much for atomic int, and we can leverage some of them for taskId.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/134/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/134,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JKbXM,incubator-uniffle,1227470284,134,NA,leixm,31424839,Xianming Lei,,NA,2022-08-25T16:02:10Z,2022-08-25T16:02:10Z,"Currently we can support 2^20 tasks, which is not a small number. If spark.rss.writer.buffer.size is set to the default value of 3m, then the data written by a taskAttempt does not exceed 3m*2^19=1536G It can be guaranteed, how to measure whether AtomicInteger can be reduced? How much can be reduced?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JKbXM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/134,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMZuz,incubator-uniffle,1227987891,134,NA,leixm,31424839,Xianming Lei,,NA,2022-08-26T02:56:46Z,2022-08-26T02:56:46Z,"It looks like taskAttemptId has been modified from 2^20 to 2^21, but the comment for org.apache.uniffle.client.util.ClientUtils has not been modified.
org.apache.uniffle.common.util.Constants
`public static final int TASK_ATTEMPT_ID_MAX_LENGTH = 21;`
`public static final int ATOMIC_INT_MAX_LENGTH = 18;`
org.apache.uniffle.client.util.ClientUtils
`// AtomicInteger is first 19 bit, max value is 2^19 - 1`
`// taskAttemptId is rest of 20 bit, max value is 2^20 - 1`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMZuz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/134,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMfAv,incubator-uniffle,1228009519,134,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-26T03:25:10Z,2022-08-26T03:25:10Z,"> It looks like taskAttemptId has been modified from 2^20 to 2^21, but the comment for org.apache.uniffle.client.util.ClientUtils has not been modified. org.apache.uniffle.common.util.Constants `public static final int TASK_ATTEMPT_ID_MAX_LENGTH = 21;` `public static final int ATOMIC_INT_MAX_LENGTH = 18;` org.apache.uniffle.client.util.ClientUtils `// AtomicInteger is first 19 bit, max value is 2^19 - 1` `// taskAttemptId is rest of 20 bit, max value is 2^20 - 1`

You're right.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMfAv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/134,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMfJv,incubator-uniffle,1228010095,134,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-26T03:26:26Z,2022-08-26T03:26:26Z,"> Currently we can support 2^20 tasks, which is not a small number. If spark.rss.writer.buffer.size is set to the default value of 3m, then the data written by a taskAttempt does not exceed 3m*2^19=1536G It can be guaranteed, how to measure whether AtomicInteger can be reduced? How much can be reduced?

It depends on the production environment application.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMfJv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/134,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yLFwl,incubator-uniffle,1915509797,134,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-01-29T20:29:48Z,2024-01-29T20:29:48Z,"> If spark.rss.writer.buffer.size is set to the default value of 3m, then the data written by a taskAttempt does not exceed 3m*2^19=1536G

You also have to take `spark.rss.writer.buffer.spill.size` (default of 128m) into consideration. Once that amount of memory is occupied by all buffers (one buffer per partition), **all** buffers will be sent to the server, no matter how full the buffer are. If you map to 100,000 partitions you will flush 100,000 buffers each having 1.28 kByte. This will cause high sequence numbers. This will then at most work with 0,64G.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yLFwl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/134,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yN6uG,incubator-uniffle,1916251014,134,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-01-30T07:47:09Z,2024-01-30T07:47:09Z,"> It looks like taskAttemptId has been modified from 2^20 to 2^21

Fixed in #1492.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yN6uG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/135,https://api.github.com/repos/apache/incubator-uniffle/issues/135,incubator-uniffle,1330619466,135,[Improvement] Support to run TPCDS in our integration-test,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2022-08-06T02:59:20Z,2022-11-06T05:00:34Z,It's better to run TPCDS to verify the correctness of our system. It will help us find problems more quickly.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/135/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/135,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nw6u8,incubator-uniffle,1304669116,135,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-05T23:55:19Z,2022-11-05T23:55:19Z,Do you have experience on this? I think this is necessary to do daily benchmark to avoid performance regression,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nw6u8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/135,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NxGDo,incubator-uniffle,1304715496,135,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-06T05:00:34Z,2022-11-06T05:00:34Z,We can't use git action to do daily benchmark. Because the git action machine may have unstable performance. I want to introduce the TPCDS test like https://github.com/apache/spark/blob/master/sql/core/src/test/scala/org/apache/spark/sql/TPCDSQueryTestSuite.scala here.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NxGDo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/136,https://api.github.com/repos/apache/incubator-uniffle/issues/136,incubator-uniffle,1330621092,136,[Improvement][Aqe] Avoid calling `getShuffleResult` multiple times,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-08-06T03:08:30Z,2022-09-09T02:21:45Z,"When we use AQE, we may call `shuffleWriteClient.getShuffleResult` multiple times. But if both partition 1 and partition 2 are on the server A, we call getShuffleResult(partition 1) to get data form server A, and then we call getShuffleResult(partition 2) to get data form server A, it's not necassray. We can get getShuffleResult(partition 1, partition 2) instead. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/136/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/136,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMaTa,incubator-uniffle,1227990234,136,NA,leixm,31424839,Xianming Lei,,NA,2022-08-26T03:01:51Z,2022-08-26T03:01:51Z,"Maybe I can take this ticket, could you assign this to me? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMaTa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/136,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMe9P,incubator-uniffle,1228009295,136,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-26T03:24:38Z,2022-08-26T03:24:38Z,"Thanks, you're welcome.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JMe9P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/136,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5J_qFr,incubator-uniffle,1241424235,136,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-09T02:21:45Z,2022-09-09T02:21:45Z,resolved by #190 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5J_qFr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/137,incubator-uniffle,1330622502,137,[Improvement][AQE] Sort MapId before the data are flushed,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-08-06T03:17:09Z,2022-11-05T06:55:06Z,"When we use aqe, we need use mapId to filter the data which we don't need, If we sort MapId before the data are flushed. We split the data to segments, if a segment don't have the data which we want to read, we will drop the data. If data is sorted by mapId, we can filter more data and mprove our performance.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/137/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JR9Za,incubator-uniffle,1229444698,137,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-28T12:15:21Z,2022-08-28T12:15:21Z,Do we need to sort data by MapID of one partition before flushing data for all jobs? I think no. This will bring unused cost for those non-AQE optimized stages. Maybe we could sort the partition data by MapId when AQE's specified `ShufflePartitionSpec` is applied in first time.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JR9Za/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JSClO,incubator-uniffle,1229465934,137,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-28T14:07:01Z,2022-08-28T14:07:01Z,You are right.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JSClO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L1_iU,incubator-uniffle,1272445076,137,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-09T03:24:32Z,2022-10-09T03:24:32Z,"Do u have implemented this in your internal version? If not, I'm interested on this. @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L1_iU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L1_lY,incubator-uniffle,1272445272,137,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-09T03:26:32Z,2022-10-09T03:26:32Z,No. You can go ahead.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L1_lY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKPcp,incubator-uniffle,1294530345,137,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-28T06:40:26Z,2022-10-28T06:40:26Z,"I propose the design of this issue. https://docs.google.com/document/d/1G0cOFVJbYLf2oX1fiadh7zi2M6DlEcjTQTh4kSkb0LA/edit?usp=sharing 

PTAL @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKPcp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKUsE,incubator-uniffle,1294551812,137,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-28T07:04:55Z,2022-10-28T07:04:55Z,It's better to sort MapId before the data are flushed.It  won't bring too much cost for non-AQE optimized stages.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKUsE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKVWx,incubator-uniffle,1294554545,137,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-28T07:08:09Z,2022-10-28T07:08:09Z,"> It's better to sort MapId before the data are flushed.It won't bring too much cost for non-AQE optimized stages.

Does data need to sort by mapId?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKVWx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKV2y,incubator-uniffle,1294556594,137,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-28T07:10:27Z,2022-10-28T07:10:27Z,"> > It's better to sort MapId before the data are flushed.It won't bring too much cost for non-AQE optimized stages.
> 
> Does data need to sort by mapId?

Yes, we only need local order. If we have local order, we can filter much data effectively.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKV2y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKjIY,incubator-uniffle,1294610968,137,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-28T07:43:58Z,2022-10-28T07:43:58Z,"> > > It's better to sort MapId before the data are flushed.It won't bring too much cost for non-AQE optimized stages.
> > 
> > 
> > Does data need to sort by mapId?
> 
> Yes, we only need local order. If we have local order, we can filter much data effectively.

Emm...  I remember you prefer only sort the index-file instead of data-file, which is mentioned in offline meeting. Do i misunderstand you?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKjIY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKniX,incubator-uniffle,1294629015,137,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-28T07:53:41Z,2022-10-28T07:53:41Z,"> > > > It's better to sort MapId before the data are flushed.It won't bring too much cost for non-AQE optimized stages.
> > > 
> > > 
> > > Does data need to sort by mapId?
> > 
> > 
> > Yes, we only need local order. If we have local order, we can filter much data effectively.
> 
> Emm... I remember you prefer only sort the index-file instead of data-file, which is mentioned in offline meeting. Do i misunderstand you?

Give an example:
We have three buffers to flush, they taskId 1 block, taskId 2 block, taskId 3 block. We should sort them to taskId 1 block, taskId 2 block, taskId 3 block. And then we can flush them to disks.Then we receive taskId 2 block, taskId 6 block, taskId 1 block, we sort them and flush them, so currently the data on the disk should be
taskId 1 block , taskId 2 block, taskId 3 block, taskId 1 block, taskId 2 block, taskId 6 block.
The data only have local order.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NKniX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK0nx,incubator-uniffle,1294682609,137,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-28T08:24:31Z,2022-10-28T08:24:31Z,"> taskId-1 block , taskId-2 block, taskId-3 block, taskId-1 block, taskId-2 block, taskId-6 block.

If one reader want the data from taskId=1, so it still want to read the data segment from `taskId-1 block , taskId-2 block, taskId-3 block, taskId-1 block`. The data of `taskId-2 block, taskId-3 block` is unnecessary for this reader. Right?
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK0nx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK5N2,incubator-uniffle,1294701430,137,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-28T08:35:30Z,2022-10-28T08:35:30Z,"> > taskId-1 block , taskId-2 block, taskId-3 block, taskId-1 block, taskId-2 block, taskId-6 block.
> 
> If one reader want the data from taskId=1, so it still want to read the data segment from `taskId-1 block , taskId-2 block, taskId-3 block, taskId-1 block`. The data of `taskId-2 block, taskId-3 block` is unnecessary for this reader. Right?

Yes. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK5N2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK6qh,incubator-uniffle,1294707361,137,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-28T08:40:39Z,2022-10-28T08:40:39Z,This looks ineffective and it's the same with the original block filter.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK6qh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK7Ml,incubator-uniffle,1294709541,137,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-28T08:42:44Z,2022-10-28T08:42:44Z,"> This looks ineffective and it's the same with the original block filter.

Actually considering random io, It will cost the same time when you read 3 records or 2 records.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK7Ml/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK8kS,incubator-uniffle,1294715154,137,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-28T08:48:05Z,2022-10-28T08:48:05Z,"> > This looks ineffective and it's the same with the original block filter.
> 
> Actually considering random io, It will cost the same time when you read 3 records or 2 records.

Yes. According to the problems mentioned by proposal design motivation section, the key point is a lot of data read by multiple times which depends on split number optimized by AQE. From this view, we should sort the data file.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK8kS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK_qn,incubator-uniffle,1294727847,137,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-28T09:00:08Z,2022-10-28T09:00:08Z,"> > > This looks ineffective and it's the same with the original block filter.
> > 
> > 
> > Actually considering random io, It will cost the same time when you read 3 records or 2 records.
> 
> Yes. According to the problems mentioned by proposal design motivation section, the key point is a lot of data read by multiple times which depends on split number optimized by AQE. From this view, we should sort the data file.

We don't need global order, local order should be enough.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NK_qn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/137,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nmk4M,incubator-uniffle,1301958156,137,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-03T11:22:33Z,2022-11-03T11:22:33Z,#293 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nmk4M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/138,https://api.github.com/repos/apache/incubator-uniffle/issues/138,incubator-uniffle,1330623225,138,[Improvement] Add a integration test case for Spark with MiniYarnCluster,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2022-08-06T03:21:23Z,2023-05-12T13:12:54Z,"We use Spark local mode to write integration test, but we can't cover some cases, such as https://github.com/Tencent/Firestorm/pull/187,  so we should add a integration test case for Spark with MiniYarnCluster","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/138/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/138,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H9jMn,incubator-uniffle,1207317287,138,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-07T02:21:34Z,2022-08-07T02:21:34Z,"Oh, the bug of https://github.com/Tencent/Firestorm/pull/187 is caused by me. 

Maybe I can take this ticket, could u help assign this to me?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H9jMn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/138,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H9lKY,incubator-uniffle,1207325336,138,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-07T03:50:11Z,2022-08-07T03:50:11Z,Thanks.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5H9lKY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/138,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MwnvX,incubator-uniffle,1287814103,138,NA,selectbook,8454350,Luke023434,,NA,2022-10-22T14:44:14Z,2022-10-22T14:44:14Z,"Hello, can I have a try on this issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MwnvX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/138,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Mwoeq,incubator-uniffle,1287817130,138,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-22T14:55:24Z,2022-10-22T14:55:24Z,Feel free to take it. Assign to you.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Mwoeq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/138,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NFHgO,incubator-uniffle,1293187086,138,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-27T08:39:21Z,2022-10-27T08:39:21Z,"@selectbook You can imitate https://github.com/apache/incubator-uniffle/blob/master/integration-test/mr/src/test/java/org/apache/uniffle/test/MRIntegrationTestBase.java, it's enough to run a WordCount test.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NFHgO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/138,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NJnp4,incubator-uniffle,1294367352,138,NA,selectbook,8454350,Luke023434,,NA,2022-10-28T02:33:16Z,2022-10-28T02:33:16Z,"thanks, I will try to finish it in these days","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NJnp4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/142,https://api.github.com/repos/apache/incubator-uniffle/issues/142,incubator-uniffle,1331595779,142,[Improvement] Fine-grained shuffle manager fallback at the shuffle level,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-08-08T09:33:36Z,2022-08-09T06:19:46Z,"### Motivation
Now uniffle's delegation shuffle manager support fallback to sort shuffle manager in app level. We could implement it in shuffle level.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/142/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/142,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDVLx,incubator-uniffle,1208832753,142,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-09T02:14:14Z,2022-08-09T02:14:14Z,Could you help check this feature? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDVLx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/142,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDXlu,incubator-uniffle,1208842606,142,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-09T02:31:05Z,2022-08-09T02:31:05Z,Spark has exchange reuse. It may be very complex for fine-grained shuffle manager fallback.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDXlu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/142,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDYef,incubator-uniffle,1208846239,142,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-09T02:37:48Z,2022-08-09T02:37:48Z,"Sorry, maybe you misunderstand my thought.
I hope if a spark job needs to do two shuffles, it can use the different shuffle manager.
1. Shuffle-ID-0, use the sortShuffleManager due to the unhealthy server nodes by the access policy
2. Shuffle-ID-1, use the rss due to the enough server nodes.

Does this feature effect the spark exchange reuse?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDYef/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/142,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDZj8,incubator-uniffle,1208850684,142,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-09T02:47:21Z,2022-08-09T02:47:21Z,"When we reuse the Shuffle-ID-1, the rss don't have enough server nodes, what will it happen?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDZj8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/142,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDbJU,incubator-uniffle,1208857172,142,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-09T03:01:43Z,2022-08-09T03:01:43Z,"> When we reuse the Shuffle-ID-1, the rss don't have enough server nodes, what will it happen?

I think it should fail because the shuffle data is in died server nodes. 

The exchange reuse you said is to share the written shuffle data for multiple downstream shuffle readers, right?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDbJU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/142,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDdi9,incubator-uniffle,1208867005,142,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-09T03:23:36Z,2022-08-09T03:23:36Z,"> 
> The exchange reuse you said is to share the written shuffle data for multiple downstream shuffle readers, right?

Yes, it also influence the dynamic allocation. SortShuffleManager need ESS to support dynamic allocation, but RssShuffleManager can't work with ESS.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDdi9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/142,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDzMx,incubator-uniffle,1208955697,142,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-09T06:10:43Z,2022-08-09T06:10:43Z,"I have a question that why it will influence the dynamic allocation? Could u help give more detail?

I think a shuffle dependency will hold a shuffle handle(rss or sort handle) which is decided by the method of registerShuffle. This means that a shuffle only will be managed by one shuffle manager(rss or sort) and served for writer or reader. The co-operation dont exist in sort and rss.

> SortShuffleManager need ESS to support dynamic allocation, but RssShuffleManager can't work with ESS.

I dont understand what's the meaning.

Attach the code draft implementation.
### Code Draft
```java
public class DelegationRssShuffleManager implements ShuffleManager {
 
  private ShuffleManager rssShuffleManager;
  private ShuffleManager sortShuffleManager;

   public DelegationRssShuffleManager(SparkConf sparkConf, boolean isDriver) throws Exception {
    this.sparkConf = sparkConf;
    // dont initialize the shuffle manager in the constructor.
  }

 private synchronized ShuffleManager createOrGetShuffleManager(boolean useRss) {
   if (useRss) {
      if (rssShuffleManager != null) {
        return rssShuffleManager;
      } else {
        try {
          final ShuffleManager shuffleManager = new RssShuffleManager(sparkConf, true);
          sparkConf.set(RssSparkConfig.RSS_ENABLED.key(), ""true"");
          LOG.info(""Use RssShuffleManager"");
          this.rssShuffleManager = shuffleManager;
          return rssShuffleManager;
        } catch (Exception exception) {
          LOG.warn(""Fail to create RssShuffleManager, fallback to SortShuffleManager {}"", exception.getMessage());
        }
      }
    }

    if (sortShuffleManager == null) {
      try {
        final ShuffleManager shuffleManager =
            RssSparkShuffleUtils.loadShuffleManager(Constants.SORT_SHUFFLE_MANAGER_NAME, sparkConf, true);
        LOG.info(""Use SortShuffleManager"");
        this.sortShuffleManager = shuffleManager;
      } catch (Exception e) {
        throw new RssException(e.getMessage());
      }
    }
    return sortShuffleManager;
 }
  
  @Override
  public <K, V, C> ShuffleHandle registerShuffle(int shuffleId, ShuffleDependency<K, V, C> dependency) {
    ShuffleManager shuffleManager = createOrGetShuffleManager(tryAccessCluster());
    if (!(shuffleManager instanceof RssShuffleManager)) {
      shuffleIdsUsingSort.add(shuffleId);
    }
    return shuffleManager.registerShuffle(shuffleId, dependency);
  }
  
  @Override
  public <K, V> ShuffleWriter<K, V> getWriter(
      ShuffleHandle handle,
      long mapId,
      TaskContext context,
      ShuffleWriteMetricsReporter metrics) {
    ShuffleManager shuffleManager = createOrGetShuffleManager(handle instanceof RssShuffleHandle);
    return shuffleManager.getWriter(handle, mapId, context, metrics);
  }

   @Override
  public <K, C> ShuffleReader<K, C> getReader(
      ShuffleHandle handle,
      int startPartition,
      int endPartition,
      TaskContext context,
      ShuffleReadMetricsReporter metrics) {
    ShuffleManager shuffleManager = createOrGetShuffleManager(handle instanceof RssShuffleHandle);
    return shuffleManager.getReader(handle,
        startPartition, endPartition, context, metrics);
  }
}
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDzMx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/142,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ID0o-,incubator-uniffle,1208961598,142,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-09T06:19:46Z,2022-08-09T06:19:46Z,You can see https://github.com/apache/incubator-uniffle/blob/master/spark-patches/spark-2.4.6_dynamic_allocation_support.patch,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ID0o-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/143,https://api.github.com/repos/apache/incubator-uniffle/issues/143,incubator-uniffle,1331763107,143,Flaky test HealthCheckCoordinatorGrpcTest on Apple Silicon ,LuciferYang,1475305,YangJie,yangjie01@baidu.com,OPEN,2022-08-08T11:56:51Z,2022-08-13T07:11:39Z,"Run  `mvn clean install ` on Apple Silicon, `HealthCheckCoordinatorGrpcTest` failed as follows:

```
[INFO] Running org.apache.uniffle.test.HealthCheckCoordinatorGrpcTest
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 71.009 s <<< FAILURE! - in org.apache.uniffle.test.HealthCheckCoordinatorGrpcTest
[ERROR] healthCheckTest  Time elapsed: 70.285 s  <<< FAILURE!
org.opentest4j.AssertionFailedError
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:35)
	at org.junit.jupiter.api.Assertions.fail(Assertions.java:115)
	at org.apache.uniffle.test.HealthCheckCoordinatorGrpcTest.healthCheckTest(HealthCheckCoordinatorGrpcTest.java:143)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```

Environment:

```
os: Big Sur 11.4
cpu: Apple M1
java: zulu 1.8.0_322
maven: 3.8.6
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/143/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/143,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IASzu,incubator-uniffle,1208036590,143,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2022-08-08T12:01:59Z,2022-08-08T12:01:59Z,run `mvn clean test -pl integration-test/common -Dtest=HealthCheckCoordinatorGrpcTest` can pass,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IASzu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/143,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ITRVq,incubator-uniffle,1213011306,143,NA,frankliee,10219731,,885626704@qq.com,NA,2022-08-12T11:27:06Z,2022-08-12T11:27:06Z,"I could pass all tests with Zulu JDK on M1.
Do you install Rosetta2 ? (some jars may invoke x86 shared libs)","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ITRVq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/143,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IWUQJ,incubator-uniffle,1213809673,143,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2022-08-13T06:19:18Z,2022-08-13T06:19:18Z,"Rosetta2 is not installed and this is a flaky test

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IWUQJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/143,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IWiCb,incubator-uniffle,1213866139,143,NA,frankliee,10219731,,885626704@qq.com,NA,2022-08-13T06:58:10Z,2022-08-13T06:58:10Z,"Could you reproduce this case or provide more detailed information?

I try this test for many times on M1 with Zulu JDK, but all pass...
I am not sure if there is a relationship with Rosetta2, but I have installed it, this is the only diff.

We have fixed  this flaky test in the old version by increasing the sleep time (3 -> 5).
You could try to increase the value. This flaky test could happen when the machine load is too high.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IWiCb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/144,https://api.github.com/repos/apache/incubator-uniffle/issues/144,incubator-uniffle,1331793345,144,Flaky test RssShuffleUtilsTest,LuciferYang,1475305,YangJie,yangjie01@baidu.com,CLOSED,2022-08-08T12:22:16Z,2022-09-06T14:38:54Z,"run `mvn clean install`

```
[INFO] Running org.apache.uniffle.common.RssShuffleUtilsTest
[ERROR] Tests run: 7, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.356 s <<< FAILURE! - in org.apache.uniffle.common.RssShuffleUtilsTest
[ERROR] testDestroyDirectByteBuffer  Time elapsed: 0.222 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <true> but was: <false>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertTrue.assertTrue(AssertTrue.java:40)
	at org.junit.jupiter.api.AssertTrue.assertTrue(AssertTrue.java:35)
	at org.junit.jupiter.api.Assertions.assertTrue(Assertions.java:179)
	at org.apache.uniffle.common.RssShuffleUtilsTest.testDestroyDirectByteBuffer(RssShuffleUtilsTest.java:72)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```

Environment:
```
os: Big Sur 11.4
cpu: Apple M1
java: zulu 1.8.0_322
maven: 3.8.6
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/144/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/144,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ISoOR,incubator-uniffle,1212842897,144,NA,frankliee,10219731,,885626704@qq.com,NA,2022-08-12T08:05:42Z,2022-08-12T08:05:42Z,"Do you install Rosetta2 ?

I have run this test with Zulu JDK on M1 successfully.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ISoOR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/144,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IWUYH,incubator-uniffle,1213810183,144,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2022-08-13T06:19:37Z,2022-08-13T06:19:37Z,Rosetta2 is not installed and this is a flaky test too,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IWUYH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/144,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jzh_G,incubator-uniffle,1238245318,144,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2022-09-06T14:38:53Z,2022-09-06T14:38:53Z, resolved by #203 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jzh_G/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/146,https://api.github.com/repos/apache/incubator-uniffle/issues/146,incubator-uniffle,1331939896,146,[Improvement] Add the number of unhealthy nodes in CoordinatorMetrics,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2022-08-08T14:15:08Z,2022-08-09T15:23:20Z,"When we turn on HealthCheck, shall we add a new metric for unhealthy node. WDYT? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/146/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/146,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDUsj,incubator-uniffle,1208830755,146,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-09T02:10:33Z,2022-08-09T02:10:33Z,Make sense. Do you want to raise a pr?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IDUsj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/146,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ID3aP,incubator-uniffle,1208972943,146,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-09T06:37:19Z,2022-08-09T06:37:19Z,"Yes, I'm doing now.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ID3aP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/146,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IF-i7,incubator-uniffle,1209526459,146,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-09T15:23:20Z,2022-08-09T15:23:20Z,solved by #147 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IF-i7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/151,incubator-uniffle,1332969308,151,[Improvement] Avoid unnecessary retry in some access checker when using DelegationShuffleManager ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-08-09T09:23:39Z,2022-08-17T11:32:08Z,"The retry mechanism is introduced by #127. But in some access checker, there's no need to retry, like candidates checker. But the health checker maybe need.

So I think we need introduce the `NON_TRANSIENT_ACCESS_DENIED` to avoid retry in some checker to reduce time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/151/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IEexF,incubator-uniffle,1209134149,151,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-09T09:23:52Z,2022-08-09T09:23:52Z,cc @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IEexF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IFGmD,incubator-uniffle,1209297283,151,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-09T12:09:03Z,2022-08-09T12:09:03Z,@smallzhongfeng What do you think?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IFGmD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IFLnj,incubator-uniffle,1209317859,151,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-09T12:28:12Z,2022-08-09T12:28:12Z,"I think this is a parameter setting. If the `retry interval` * `retry times` is greater than the `heartbeat` time passed by the server to the coordinator, the check of `AccessCandidatesChecker` is meaningful. If the`retry interval` * `retry times` is less than the `heartbeat` time of the server, Can be solved by setting the number of retries to 0 ? @zuston","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IFLnj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IFe-r,incubator-uniffle,1209397163,151,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-09T13:40:21Z,2022-08-09T13:40:21Z,"Firstly i think your PR is meaningful for cluster load access checker.  

But in other access checker, sometimes we needn’t retry. So I will introduce a special acess result of `NON_TRANSIENT_ACCESS_DENIED` to avoid retry in some checkers.

### For example
If we enable two checkers
1. when cluster-loader check deny but candidates checker pass, so we need to retry
2. when cluster-loader check pass but candidates check deny, retry isn’t needed
3. when two checks deny, retry isn’t needed","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IFe-r/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIll1,incubator-uniffle,1210210677,151,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-10T06:17:47Z,2022-08-10T06:17:47Z,"I got your point. If you raise a pr, I'm glad to review.@zuston WDYT? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIll1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIw1f,incubator-uniffle,1210256735,151,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-10T07:11:50Z,2022-08-10T07:11:50Z,"A little complex, are there similar mechanisms in the other systems?  In my opinion, we shouldn't retry when we use candidate checker. when we only use health checker, we can retry, we can scale out our RSS at the same time. I doubt whether we need this mechanism?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIw1f/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIyBQ,incubator-uniffle,1210261584,151,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-10T07:17:03Z,2022-08-10T07:17:03Z,"If not having this mechanism, how to handle the multiple checkers retry? 

In our internal env, we will use the multiple checkers, including health checker(need to retry) and customize checker(no need to retry).","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIyBQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIyd4,incubator-uniffle,1210263416,151,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-10T07:18:58Z,2022-08-10T07:18:58Z,"> If not having this mechanism, how to handle the multiple checkers retry?
> 
> In our internal env, we will use the multiple checkers, including health checker(need to retry) and customize checker(no need to retry).

You can choose not to retry.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIyd4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIzX4,incubator-uniffle,1210267128,151,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-10T07:23:01Z,2022-08-10T07:23:01Z,"> > If not having this mechanism, how to handle the multiple checkers retry?
> > In our internal env, we will use the multiple checkers, including health checker(need to retry) and customize checker(no need to retry).
> 
> You can choose not to retry.

No retry is OK. But this will not solve the problem described in the issue #127 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IIzX4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IJKOL,incubator-uniffle,1210360715,151,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-10T08:48:17Z,2022-08-10T08:48:17Z,"Maybe you could choose not to retry when you use multiple checker, because in your description, the scenario of multiple checkers seems to be more dependent on the results of the candidates checker, in this way, it is not enough meaningful to retry, but the default checker is only `AccessClusterloadChecker`, and the issue #127  I proposed is mainly adapted to this checker, when you use this checker, you can choose to retry. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IJKOL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IJnE9,incubator-uniffle,1210478909,151,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-10T10:28:23Z,2022-08-10T10:28:23Z,"But when having multiple checkers, and the apps are in candidates list, for these apps, it need retry.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IJnE9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Iasnh,incubator-uniffle,1214958049,151,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-15T12:30:26Z,2022-08-15T12:30:26Z,So do we need this feature ? cc @jerqi  ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Iasnh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IavnH,incubator-uniffle,1214970311,151,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-15T12:46:16Z,2022-08-15T12:46:16Z,"> So do we need this feature ? cc @jerqi

I  don't think we need so complex retry mechanism ... ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IavnH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/151,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Il4Hr,incubator-uniffle,1217888747,151,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-17T11:32:08Z,2022-08-17T11:32:08Z,OK. Close it.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Il4Hr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/154,incubator-uniffle,1335437262,154,[Improvement] Support Empty assignment to Shuffle Server,rhh777,41908930,haorenhui,haorenhui0911@163.com,CLOSED,2022-08-11T03:52:50Z,2022-11-16T07:02:04Z,"When I tested hudi, I got an error.
this is spark driver log, ERROR: Empty assignment to Shuffle Server
```
52278 [dag-scheduler-event-loop] INFO  org.apache.spark.shuffle.RssShuffleManager  - Generate application id used in rss: spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844
52281 [dag-scheduler-event-loop] ERROR com.tencent.rss.client.impl.ShuffleWriteClientImpl  - Empty assignment to Shuffle Server
52282 [dag-scheduler-event-loop] ERROR com.tencent.rss.client.impl.ShuffleWriteClientImpl  - Error happened when getShuffleAssignments with appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[6], numMaps[0], partitionNumPerRange[1] to coordinator
52283 [dag-scheduler-event-loop] WARN  org.apache.spark.scheduler.DAGScheduler  - Creating new stage failed due to exception - job: 5
com.tencent.rss.common.exception.RssException: Error happened when getShuffleAssignments with appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[6], numMaps[0], partitionNumPerRange[1] to coordinator
        at com.tencent.rss.client.impl.ShuffleWriteClientImpl.throwExceptionIfNecessary(ShuffleWriteClientImpl.java:440)
        at com.tencent.rss.client.impl.ShuffleWriteClientImpl.getShuffleAssignments(ShuffleWriteClientImpl.java:291)
        at org.apache.spark.shuffle.RssShuffleManager.registerShuffle(RssShuffleManager.java:247)
        at org.apache.spark.ShuffleDependency.<init>(Dependency.scala:97)
        at org.apache.spark.rdd.ShuffledRDD.getDependencies(ShuffledRDD.scala:87)
        at org.apache.spark.rdd.RDD.$anonfun$dependencies$2(RDD.scala:264)
        at scala.Option.getOrElse(Option.scala:189)
        at org.apache.spark.rdd.RDD.dependencies(RDD.scala:260)
        at org.apache.spark.scheduler.DAGScheduler.getShuffleDependenciesAndResourceProfiles(DAGScheduler.scala:634)
        at org.apache.spark.scheduler.DAGScheduler.getMissingAncestorShuffleDependencies(DAGScheduler.scala:597)
        at org.apache.spark.scheduler.DAGScheduler.getOrCreateShuffleMapStage(DAGScheduler.scala:394)
        at org.apache.spark.scheduler.DAGScheduler.$anonfun$getOrCreateParentStages$1(DAGScheduler.scala:580)
        at scala.collection.TraversableLike.$anonfun$map$1(TraversableLike.scala:238)
        at scala.collection.mutable.HashSet.foreach(HashSet.scala:79)
        at scala.collection.TraversableLike.map(TraversableLike.scala:238)
        at scala.collection.TraversableLike.map$(TraversableLike.scala:231)
        at scala.collection.mutable.AbstractSet.scala$collection$SetLike$$super$map(Set.scala:48)
        at scala.collection.SetLike.map(SetLike.scala:104)
        at scala.collection.SetLike.map$(SetLike.scala:104)
        at scala.collection.mutable.AbstractSet.map(Set.scala:48)
        at org.apache.spark.scheduler.DAGScheduler.getOrCreateParentStages(DAGScheduler.scala:579)
        at org.apache.spark.scheduler.DAGScheduler.createResultStage(DAGScheduler.scala:564)
        at org.apache.spark.scheduler.DAGScheduler.handleJobSubmitted(DAGScheduler.scala:1115)
        at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:2396)
        at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2388)
        at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2377)
        at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49)
52287 [main] INFO  org.apache.spark.scheduler.DAGScheduler  - Job 5 failed: countByKey at BaseSparkCommitActionExecutor.java:191, took 0.076660 s
```

this is coordinator log , request partitionNum is 0
```
[INFO] 2022-08-11 11:29:49,335 Grpc-301 CoordinatorGrpcService getShuffleAssignments - Request of getShuffleAssignments for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[6], partitionNum[0], partitionNumPerRange[1], replica[1]
```

```
full log
[INFO] 2022-08-11 11:29:26,946 Grpc-267 CoordinatorGrpcService getShuffleAssignments - Request of getShuffleAssignments for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[0], partitionNum[200], partitionNumPerRange[1], replica[1]
[WARN] 2022-08-11 11:29:26,946 Grpc-267 PartitionBalanceAssignmentStrategy assign - Can't get expected servers [13] and found only [3]
[INFO] 2022-08-11 11:29:26,946 Grpc-267 CoordinatorGrpcService logAssignmentResult - Shuffle Servers of assignment for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[0] are [10.1.3.174-19990, 10.1.3.175-19990, 10.1.3.173-19990]
[INFO] 2022-08-11 11:29:27,033 Grpc-270 CoordinatorGrpcService getShuffleAssignments - Request of getShuffleAssignments for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[1], partitionNum[200], partitionNumPerRange[1], replica[1]
[WARN] 2022-08-11 11:29:27,033 Grpc-270 PartitionBalanceAssignmentStrategy assign - Can't get expected servers [13] and found only [3]
[INFO] 2022-08-11 11:29:27,034 Grpc-270 CoordinatorGrpcService logAssignmentResult - Shuffle Servers of assignment for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[1] are [10.1.3.174-19990, 10.1.3.175-19990, 10.1.3.173-19990]
[INFO] 2022-08-11 11:29:37,957 ApplicationManager-0 ApplicationManager statusCheck - Start to check status for 2 applications
[INFO] 2022-08-11 11:29:43,047 Grpc-283 CoordinatorGrpcService getShuffleAssignments - Request of getShuffleAssignments for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[2], partitionNum[200], partitionNumPerRange[1], replica[1]
[WARN] 2022-08-11 11:29:43,048 Grpc-283 PartitionBalanceAssignmentStrategy assign - Can't get expected servers [13] and found only [3]
[INFO] 2022-08-11 11:29:43,048 Grpc-283 CoordinatorGrpcService logAssignmentResult - Shuffle Servers of assignment for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[2] are [10.1.3.174-19990, 10.1.3.175-19990, 10.1.3.173-19990]
[INFO] 2022-08-11 11:29:49,165 Grpc-293 CoordinatorGrpcService getShuffleAssignments - Request of getShuffleAssignments for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[3], partitionNum[200], partitionNumPerRange[1], replica[1]
[WARN] 2022-08-11 11:29:49,166 Grpc-293 PartitionBalanceAssignmentStrategy assign - Can't get expected servers [13] and found only [3]
[INFO] 2022-08-11 11:29:49,166 Grpc-293 CoordinatorGrpcService logAssignmentResult - Shuffle Servers of assignment for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[3] are [10.1.3.174-19990, 10.1.3.175-19990, 10.1.3.173-19990]
[INFO] 2022-08-11 11:29:49,247 Grpc-298 CoordinatorGrpcService getShuffleAssignments - Request of getShuffleAssignments for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[4], partitionNum[200], partitionNumPerRange[1], replica[1]
[WARN] 2022-08-11 11:29:49,247 Grpc-298 PartitionBalanceAssignmentStrategy assign - Can't get expected servers [13] and found only [3]
[INFO] 2022-08-11 11:29:49,247 Grpc-298 CoordinatorGrpcService logAssignmentResult - Shuffle Servers of assignment for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[4] are [10.1.3.174-19990, 10.1.3.175-19990, 10.1.3.173-19990]
[INFO] 2022-08-11 11:29:49,267 Grpc-297 CoordinatorGrpcService getShuffleAssignments - Request of getShuffleAssignments for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[5], partitionNum[200], partitionNumPerRange[1], replica[1]
[WARN] 2022-08-11 11:29:49,267 Grpc-297 PartitionBalanceAssignmentStrategy assign - Can't get expected servers [13] and found only [3]
[INFO] 2022-08-11 11:29:49,268 Grpc-297 CoordinatorGrpcService logAssignmentResult - Shuffle Servers of assignment for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[5] are [10.1.3.174-19990, 10.1.3.175-19990, 10.1.3.173-19990]
[INFO] 2022-08-11 11:29:49,335 Grpc-301 CoordinatorGrpcService getShuffleAssignments - Request of getShuffleAssignments for appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[6], partitionNum[0], partitionNumPerRange[1], replica[1]
[WARN] 2022-08-11 11:29:49,335 Grpc-301 PartitionBalanceAssignmentStrategy assign - Can't get expected servers [13] and found only [3]
[INFO] 2022-08-11 11:30:07,957 ApplicationManager-0 ApplicationManager statusCheck - Start to check status for 2 applications
[INFO] 2022-08-11 11:30:07,957 ApplicationManager-0 ApplicationManager statusCheck - Remove expired application:spark-d7f3e51ca713472e88568db90c91bdea1660187027133
```

Environment:
```
uniffle: firestorm 0.4.1
spark: 3.1.2
hudi: 0.10.0
k8s: v1.21.3
```
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/154/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INnHL,incubator-uniffle,1211527627,154,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-11T03:58:04Z,2022-08-11T03:58:04Z,"When a shuffle have 0 reduce partition, is it a meaningful shuffle?  What's situation? Is it a map only application?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INnHL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INnXE,incubator-uniffle,1211528644,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-08-11T04:00:59Z,2022-08-11T04:00:59Z,"When I look at the RSS Client code, I see that no matter how many partitionNum are requested, an exception is thrown whenever the coordinator returns empty.
https://github.com/apache/incubator-uniffle/blob/master/internal-client/src/main/java/org/apache/uniffle/client/impl/grpc/CoordinatorGrpcClient.java
```
// transform [startPartition, endPartition] -> [server1, server2] to
  // {partition1 -> [server1, server2], partition2 - > [server1, server2]}
  @VisibleForTesting
  public Map<Integer, List<ShuffleServerInfo>> getPartitionToServers(
      GetShuffleAssignmentsResponse response) {
    Map<Integer, List<ShuffleServerInfo>> partitionToServers = Maps.newHashMap();
    List<PartitionRangeAssignment> assigns = response.getAssignmentsList();
    for (PartitionRangeAssignment partitionRangeAssignment : assigns) {
      final int startPartition = partitionRangeAssignment.getStartPartition();
      final int endPartition = partitionRangeAssignment.getEndPartition();
      final List<ShuffleServerInfo> shuffleServerInfos = partitionRangeAssignment
          .getServerList()
          .stream()
          .map(ss -> new ShuffleServerInfo(ss.getId(), ss.getIp(), ss.getPort()))
          .collect(Collectors.toList());
      for (int i = startPartition; i <= endPartition; i++) {
        partitionToServers.put(i, shuffleServerInfos);
      }
    }
    if (partitionToServers.isEmpty()) {
      throw new RssException(""Empty assignment to Shuffle Server"");
    }
    return partitionToServers;
  }
```
Is it possible to verify the partitionNum of the request and the partitionNum of the response, or other operations?
```
// transform [startPartition, endPartition] -> [server1, server2] to
  // {partition1 -> [server1, server2], partition2 - > [server1, server2]}
  @VisibleForTesting
  public Map<Integer, List<ShuffleServerInfo>> getPartitionToServers(RssGetShuffleAssignmentsRequest request,
      GetShuffleAssignmentsResponse response) {
    Map<Integer, List<ShuffleServerInfo>> partitionToServers = Maps.newHashMap();
    List<PartitionRangeAssignment> assigns = response.getAssignmentsList();
    for (PartitionRangeAssignment partitionRangeAssignment : assigns) {
      final int startPartition = partitionRangeAssignment.getStartPartition();
      final int endPartition = partitionRangeAssignment.getEndPartition();
      final List<ShuffleServerInfo> shuffleServerInfos = partitionRangeAssignment
          .getServerList()
          .stream()
          .map(ss -> new ShuffleServerInfo(ss.getId(), ss.getIp(), ss.getPort()))
          .collect(Collectors.toList());
      for (int i = startPartition; i <= endPartition; i++) {
        partitionToServers.put(i, shuffleServerInfos);
      }
    }

    if (request.getPartitionNum() == 0 && partitionToServers.isEmpty()) {
        LOG.warn(""dependency partitionNum is 0"");
    }else if(partitionToServers.isEmpty()){
        throw new RssException(""Empty assignment to Shuffle Server"");
    }
    return partitionToServers;
  }
```
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INnXE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INoE6,incubator-uniffle,1211531578,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-08-11T04:07:37Z,2022-08-11T04:07:37Z,"> When a shuffle have 0 reduce partition, is it a meaningful shuffle? What's situation? Is it a map only application?

emmm, Now I don't know what HUDi does, this is my HUDI test code and UI .
The error occurred during the INSERT phase

```
val conf = new SparkConf()
conf.set(""spark.sql.extensions"",""org.apache.spark.sql.hudi.HoodieSparkSessionExtension"")
conf.set(""spark.serializer"",""org.apache.spark.serializer.KryoSerializer"")
conf.set(""spark.shuffle.manager"",""org.apache.spark.shuffle.RssShuffleManager"")
conf.set(""spark.rss.coordinator.quorum"",""xx.xx.xx.xx:19999"")
conf.set(""spark.rss.storage.type"",""MEMORY_LOCALFILE"")
val session: SparkSession = SparkSession.builder().config(conf).enableHiveSupport().appName(""di_hudi"").getOrCreate()
session.sql(
                """"""
                  |create table if not exists hudi_tb0808_1 (
                  |  id int,
                  |  name string,
                  |  work string
                  |) using hudi
                  |tblproperties (
                  |  type = 'cow',
                  |  primaryKey = 'id',
                  |  preCombineField = 'work'
                  |)
                  |location '/hudi/tmp/xxx1'
                  |"""""".stripMargin)
session.sql(
                s""""""
                   |insert into hudi_tb0808_1 values(${random},'tmp1','hudi_tb0508_1')
                   |"""""".stripMargin)

session.stop()
```
<img width=""2549"" alt=""image"" src=""https://user-images.githubusercontent.com/41908930/184063126-5e029d62-7230-4d2c-82de-2a9c194b010c.png"">

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INoE6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INoia,incubator-uniffle,1211533466,154,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-11T04:11:06Z,2022-08-11T04:11:06Z,Could you click your `job 4` and give me your details of `job 4`? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INoia/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INpVv,incubator-uniffle,1211536751,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-08-11T04:17:37Z,2022-08-11T04:17:37Z,"


> Could you click your `job 4` and give me your details of `job 4`?

<img width=""2558"" alt=""image"" src=""https://user-images.githubusercontent.com/41908930/184063837-4db437ea-978a-4821-9fa8-4b1cab6e1f92.png"">

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5INpVv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IN1zX,incubator-uniffle,1211587799,154,NA,colinmjj,8003795,Colin,colin@apache.org,NA,2022-08-11T06:13:35Z,2022-08-11T06:13:35Z,"@rhh777 from the log `Error happened when getShuffleAssignments with appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[6], numMaps[0], partitionNumPerRange[1] to coordinator`, it's strange that numMaps = 0.
And unexpected zero is come from `dependency.partitioner().numPartitions()`, is it possible to check why zero is returned?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IN1zX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IN3_A,incubator-uniffle,1211596736,154,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-11T06:28:37Z,2022-08-11T06:28:37Z,Is you config option `spark.default.parallelism` zero?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IN3_A/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IN7XG,incubator-uniffle,1211610566,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-08-11T06:48:45Z,2022-08-11T06:48:45Z,"> Is you config option `spark.default.parallelism` zero?

There is no set","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IN7XG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IN7fi,incubator-uniffle,1211611106,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-08-11T06:49:31Z,2022-08-11T06:49:31Z,"> @rhh777 from the log `Error happened when getShuffleAssignments with appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[6], numMaps[0], partitionNumPerRange[1] to coordinator`, it's strange that numMaps = 0. And unexpected zero is come from `dependency.partitioner().numPartitions()`, is it possible to check why zero is returned?

ok, I'll try to debug it
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IN7fi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ISj2a,incubator-uniffle,1212824986,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-08-12T07:41:48Z,2022-08-12T07:41:48Z,"> @rhh777 from the log `Error happened when getShuffleAssignments with appId[spark-8304854d3e234816bba3c3a1e8bd0ade1660188566844], shuffleId[6], numMaps[0], partitionNumPerRange[1] to coordinator`, it's strange that numMaps = 0. And unexpected zero is come from `dependency.partitioner().numPartitions()`, is it possible to check why zero is returned?

In the seemingly and SparkHoodieBloomIndexHelper findMatchingFilesForRecordKeys method, I continue to debug

<img width=""2160"" alt=""image"" src=""https://user-images.githubusercontent.com/41908930/184307014-7dc16728-f999-426e-89c9-47ae2ff623dc.png"">

<img width=""1649"" alt=""image"" src=""https://user-images.githubusercontent.com/41908930/184307446-da6e53ac-2345-417d-af27-0b3f9348363a.png"">


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ISj2a/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ISkw8,incubator-uniffle,1212828732,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-08-12T07:46:31Z,2022-08-12T07:46:31Z,"The previous HUDI version was incorrectly described, it should be 0.10.0 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ISkw8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ISnMh,incubator-uniffle,1212838689,154,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-12T08:00:51Z,2022-08-12T08:00:51Z,Could we ask why this partitioner has no partition in Hudi community? It's tricky that partition has no partition?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ISnMh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JJTQm,incubator-uniffle,1227174950,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-08-25T12:12:05Z,2022-08-25T12:12:05Z,"Sorry for my busy work now, I will further study HUDI when I am free","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JJTQm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OOmOZ,incubator-uniffle,1312449433,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-11-12T10:32:03Z,2022-11-12T10:32:03Z,"When the RDD is Empty, the shuffle is triggered and the **Empty assignment to Shuffle Server**



        val conf = new SparkConf()
        conf.set(""spark.shuffle.manager"",""org.apache.spark.shuffle.RssShuffleManager"")
        conf.set(""spark.rss.coordinator.quorum"",""localhost:19999"")
        conf.set(""spark.rss.storage.type"",""MEMORY_LOCALFILE"")

        val session: SparkSession = SparkSession.builder().config(conf).
                master(""local"").appName(""rss_empty_assignment"").getOrCreate()

        val rdd: RDD[Row] = session.emptyDataFrame.rdd
        val inputRDD: RDD[(String, Int)] = rdd.map((row: Row) => {
            (""rss_empty_assignment"", 1)
        })

        inputRDD.countByKey().foreach(println)
        session.stop()
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OOmOZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OOxHc,incubator-uniffle,1312494044,154,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-12T14:30:29Z,2022-11-12T14:30:29Z,"I got it. According to my understanding, this program should print nothing. Actually we shouldn't request the coordinator when we don't have any partition, we could return the RssShuffleHandle directly. You can see https://github.com/apache/incubator-uniffle/blob/4a3d2be36795df2eaf2edbe75ecc5816bf7eb87a/client-spark/spark2/src/main/java/org/apache/spark/shuffle/RssShuffleManager.java#L204 for more details. Would you like raise a pr to fix this problem?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OOxHc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/154,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OTJMH,incubator-uniffle,1313641223,154,NA,rhh777,41908930,haorenhui,haorenhui0911@163.com,NA,2022-11-14T12:51:34Z,2022-11-14T12:51:34Z,"> I got it. According to my understanding, this program should print nothing. Actually we shouldn't request the coordinator when we don't have any partition, we could return the RssShuffleHandle directly. You can see
> 
> https://github.com/apache/incubator-uniffle/blob/4a3d2be36795df2eaf2edbe75ecc5816bf7eb87a/client-spark/spark2/src/main/java/org/apache/spark/shuffle/RssShuffleManager.java#L204
> 
> for more details. Would you like raise a pr to fix this problem?

ok","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OTJMH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/160,https://api.github.com/repos/apache/incubator-uniffle/issues/160,incubator-uniffle,1342575644,160,Support lower Hadoop versions in client-mr,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-08-18T05:24:16Z,2022-08-18T10:30:16Z,"Currently, uniffle use the default Hadoop version of 2.8.5. 

When using the `./build_distribution.sh --spark2-profile 'spark2' --spark3-mvn '-Dspark.version=2.4.3' --spark3-profile 'spark3' --spark3-mvn '-Dspark.version=3.1.1' -Dhadoop.version=2.6.0`, it will throw exceptions due to some methods and vars not supported in Hadoop 2.6.0.

Some non-compatible params and methods as follows
1. `CallContext`, introduced by >= 2.8.0. 
2. `MRJobConfig.DEFAULT_SHUFFLE_MERGE_PERCENT` introduced by 2.8.0. [ticket link](https://issues.apache.org/jira/browse/MAPREDUCE-6105)
3. `MRApps.getSystemPropertiesToLog` introduced by 2.8.0 [ticket link](https://issues.apache.org/jira/browse/MAPREDUCE-5232)

I think we could use the reflection to be compatible with lower hadoop version.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/160/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/160,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IqUHn,incubator-uniffle,1219052007,160,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-18T05:24:52Z,2022-08-18T05:24:52Z,cc @jerqi @frankliee ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IqUHn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/160,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IqYW0,incubator-uniffle,1219069364,160,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-18T05:58:32Z,2022-08-18T05:58:32Z,And I also found the client-mr is not compatible with Hadoop 3.2.2,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IqYW0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/160,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IqjHT,incubator-uniffle,1219113427,160,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-18T07:05:15Z,2022-08-18T07:05:15Z,What's your company's hadoop version?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IqjHT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/160,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IqkD3,incubator-uniffle,1219117303,160,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-18T07:10:27Z,2022-08-18T07:10:27Z,"1. 2.6.0-cdh5.11.0
2. Hadoop-3.2.2 packaged by bigtop","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IqkD3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/160,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Iqpjy,incubator-uniffle,1219139826,160,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-18T07:37:48Z,2022-08-18T07:37:48Z,I think it's ok for me if we need it in our production environment.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Iqpjy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/160,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IrWXM,incubator-uniffle,1219323340,160,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-18T10:30:16Z,2022-08-18T10:30:16Z,OK. I will go ahead.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IrWXM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/164,incubator-uniffle,1342709993,164,[Improvement] Limit the speed of memory release when drop pending events,xianjingfeng,11752250,,,CLOSED,2022-08-18T08:03:16Z,2022-10-23T05:28:13Z,"In `org.apache.uniffle.server.ShuffleFlushManager#processPendingEvents`,OOM will happen if a large number of events need to be dropped, because `usedMemory` release immediately, but the speed of GC is not fast enough.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/164/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IvljD,incubator-uniffle,1220434115,164,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-19T09:03:30Z,2022-08-19T09:03:30Z,I'm curious about how to find OOM is caused by dropped events.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IvljD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IvsX9,incubator-uniffle,1220462077,164,NA,xianjingfeng,11752250,,,NA,2022-08-19T09:32:05Z,2022-08-19T09:32:05Z,"![screenshot](https://user-images.githubusercontent.com/11752250/185589881-63e2db63-c539-4473-a522-7eb0b0900e86.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IvsX9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ivxhm,incubator-uniffle,1220483174,164,NA,xianjingfeng,11752250,,,NA,2022-08-19T09:54:05Z,2022-08-19T09:54:05Z,"![screenshot2](https://user-images.githubusercontent.com/11752250/185593881-240cb918-d2de-47fd-845a-387866998323.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ivxhm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ivx9W,incubator-uniffle,1220484950,164,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-19T09:56:08Z,2022-08-19T09:56:08Z,https://stackoverflow.com/questions/8719071/is-it-possible-to-get-outofmemoryerror-because-garbage-collection-too-slow I'm not sure the effect of pr.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ivx9W/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ivy6F,incubator-uniffle,1220488837,164,NA,xianjingfeng,11752250,,,NA,2022-08-19T10:00:37Z,2022-08-19T10:00:37Z,"The purpose of this PR is to reserve more time for GC and reduce the speed of receiving data. Maybe this is not a good way, but I feel it is effective.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ivy6F/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IweEL,incubator-uniffle,1220665611,164,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-19T13:14:17Z,2022-08-19T13:14:17Z,"From my understanding, if memory is not enough, it will firstly trigger GC to remove unused objects. This will stop the world. 

After that, when memory is still not enough, it will OOM. 

What do u think so?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IweEL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IwkSL,incubator-uniffle,1220691083,164,NA,xianjingfeng,11752250,,,NA,2022-08-19T13:34:58Z,2022-08-19T13:34:58Z,When to trigger GC? The direct reason for GC is that it is written too fast. Maybe it will be solved after replace grpc with netty in the future.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IwkSL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IwoeC,incubator-uniffle,1220708226,164,NA,xianjingfeng,11752250,,,NA,2022-08-19T13:51:58Z,2022-08-19T13:51:58Z,"@zuston I misunderstood what you said just now. You are right, but GC will not delete all unused objects at once.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5IwoeC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0mtv,incubator-uniffle,1221749615,164,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T03:20:25Z,2022-08-22T03:20:25Z,Could you explain the two diagrams? I can't get your point.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0mtv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I1Qex,incubator-uniffle,1221920689,164,NA,xianjingfeng,11752250,,,NA,2022-08-22T06:45:59Z,2022-08-22T06:45:59Z,"When `total_dropped_event_num` rises rapidly,  `jvm_memory_bytes_used`  rises rapidly at the same time. Does it means that it is triggered by processing pending events?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I1Qex/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I3Qcq,incubator-uniffle,1222444842,164,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T14:31:01Z,2022-08-22T14:31:01Z,"Em......If we can't write data to storage, we will occupy the more memory. It's normal. But the two diagrams can't persuade me that the gc speed lead to OOM.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I3Qcq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/169,incubator-uniffle,1344524085,169,[Feature Request] Support push metrics to Prometheus Pushgateway,xianjingfeng,11752250,,,CLOSED,2022-08-19T14:30:52Z,2022-12-21T11:32:55Z,"The push mode will be more convenient and more real-time. We have implemented it. If necessary, I will create a PR","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/169/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0ib6,incubator-uniffle,1221732090,169,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T02:54:01Z,2022-08-22T02:54:01Z,Why will the push mode be more convenient and more real-time? Could you give some examples? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0ib6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I1Uc8,incubator-uniffle,1221936956,169,NA,xianjingfeng,11752250,,,NA,2022-08-22T07:05:03Z,2022-08-22T07:05:03Z,"1.We need install node exporter in every host, and if not, real-time performance cannot be ensured.
2.We need change the configration of node exporter after we add an instance.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I1Uc8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I1YWd,incubator-uniffle,1221952925,169,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T07:20:49Z,2022-08-22T07:20:49Z,"In our production environment, we use `crontab` to fetch the servers' metrics every minute and push the metrics to our prometheus server. I don't get the difference if we use exporter.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I1YWd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I1b17,incubator-uniffle,1221967227,169,NA,xianjingfeng,11752250,,,NA,2022-08-22T07:35:36Z,2022-08-22T07:35:36Z,"This depends on operation and maintenance. If automation tools is well, it may not be inconvenient.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I1b17/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgPyx,incubator-uniffle,1333853361,169,NA,xianjingfeng,11752250,,,NA,2022-12-01T14:30:43Z,2022-12-01T14:30:43Z,@jerqi Can you share how do you collect metrics in your k8s cluster?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgPyx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgQ8W,incubator-uniffle,1333858070,169,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T14:34:07Z,2022-12-01T14:34:07Z,"> @jerqi Can you share how do you collect metrics in your k8s cluster?

We plan to use a k8s sidecar to collect the metrics.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgQ8W/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgU26,incubator-uniffle,1333874106,169,NA,xianjingfeng,11752250,,,NA,2022-12-01T14:45:59Z,2022-12-01T14:45:59Z,"I think we should support export metrics, like hadoop,hbase etc. Users can implement custom export plugin to export metrics to their monitoring system. WDYT? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgU26/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgX_p,incubator-uniffle,1333886953,169,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T14:54:05Z,2022-12-01T14:54:05Z,"> I think we should support export metrics, like hadoop,hbase etc. Users can implement custom export plugin to export metrics to their monitoring system. WDYT? @jerqi

I'm not familiar with this aspect. If other mature systems have this , I think it will be ok for me. @zuston Do you have some suggestion?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgX_p/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PkR2S,incubator-uniffle,1334910354,169,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-02T08:37:44Z,2022-12-02T08:37:44Z,"The similar mechanism is supported by other systems, like Flink: https://nightlies.apache.org/flink/flink-docs-release-1.13/docs/deployment/metric_reporters/ 

I think this is a good improvement of observability","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PkR2S/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PkR4r,incubator-uniffle,1334910507,169,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-02T08:37:56Z,2022-12-02T08:37:56Z,Let's reopen this? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PkR4r/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PkSKy,incubator-uniffle,1334911666,169,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-02T08:39:17Z,2022-12-02T08:39:17Z,"> Let's reopen this?

OK.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PkSKy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PkT6T,incubator-uniffle,1334918803,169,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-02T08:47:28Z,2022-12-02T08:47:28Z,Should we have a concept of MetricsReporter refer to Flink first?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PkT6T/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/172,incubator-uniffle,1345510444,172,[Feature] Support short-circuit read in local-file,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-08-21T14:57:14Z,2022-08-28T14:15:00Z,"### Motivation
When uniffle shuffle servers are co-located with Yarn nodemanagers, we could use the short-circuit read to improve performance and reduce the overhead.

### How to do
There are two options to solve this
1. Directly read shuffle-data files by client side. 
2. Use the domain socket.

#### Option 1 - Directly read
This is the fastest way, but the local-files' read permission should be open for client side. This maybe have security problem.


#### Option2 - Domain socket
This way could be avoid security problem, but will be slower than above. And its implementation will be complex.

### Conclusion
In my opinion, above two ways could be all supported in uniffle, which could be as different policies for users to choose.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/172/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Iz49n,incubator-uniffle,1221562215,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-21T15:00:01Z,2022-08-21T15:00:01Z,"I think it's necessary feature, what do u think? @jerqi 

Besides, I have implement one policy of `read directly` and want to contribute.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Iz49n/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0h5P,incubator-uniffle,1221729871,172,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T02:48:36Z,2022-08-22T02:48:36Z,I think it's the most important thing that we don't official deployment plan now.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0h5P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0idD,incubator-uniffle,1221732163,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-22T02:54:10Z,2022-08-22T02:54:10Z,Yes. we need a detailed deployment instruction for users in doc. But I dont think this feature depends on the former.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0idD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0iv9,incubator-uniffle,1221733373,172,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T02:56:45Z,2022-08-22T02:56:45Z,"> Yes. we need a detailed deployment instruction for users in doc. But I dont think this feature depends on the former.

Sorry, i means that we don't official  yarn deployment plan now. I think this feature depends yarn.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0iv9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0j6T,incubator-uniffle,1221738131,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-22T03:05:51Z,2022-08-22T03:05:51Z,"Oh, this feature is not bound to Yarn. 
We will deploy shuffle-servers on Yarn nodemanager machine using ansible, instead of using [YARN Applications](https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/WritingYarnApplications.html) to deploy.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0j6T/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0kSC,incubator-uniffle,1221739650,172,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T03:08:14Z,2022-08-22T03:08:14Z,"> ### Motivation
> When uniffle shuffle servers are co-located with Yarn nodemanagers, we could use the short-circuit read to improve performance and reduce the overhead.
> 
> ### How to do
> There are two options to solve this
> 
> 1. Directly read shuffle-data files by client side.
> 2. Use the domain socket.
> 
> #### Option 1 - Directly read
> This is the fastest way, but the local-files' read permission should be open for client side. This maybe have security problem.
> 
> #### Option2 - Domain socket
> This way could be avoid security problem, but will be slower than above. And its implementation will be complex.
> 
> ### Conclusion
> In my opinion, above two ways could be all supported in uniffle, which could be as different policies for users to choose.

Which option do you prefer?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0kSC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0mtH,incubator-uniffle,1221749575,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-22T03:20:21Z,2022-08-22T03:20:21Z,"> Which option do you prefer?

I prefer `directly read` in the initial version. What do u think? Maybe we could reserve the pluggable policy interface to implement for domain socket.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0mtH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0m5X,incubator-uniffle,1221750359,172,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T03:21:32Z,2022-08-22T03:21:32Z,"> > Which option do you prefer?
> 
> I prefer `directly read` in the initial version.

How to know the local directory for Spark client?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0m5X/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0nF1,incubator-uniffle,1221751157,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-22T03:22:58Z,2022-08-22T03:22:58Z,"> How to know the local directory for Spark client?

The stored local path should be retrieved from shuffle server by client side. So we need to add a new grpc api.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0nF1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0n6R,incubator-uniffle,1221754513,172,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T03:28:38Z,2022-08-22T03:28:38Z,"When the taskScheduler allocate task, we don't consider reduce partition distribution,  fewer task can use the feature.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0n6R/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0o4O,incubator-uniffle,1221758478,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-22T03:34:40Z,2022-08-22T03:34:40Z,"> When the taskScheduler allocate task, we don't consider reduce partition distribution, fewer task can use the feature.

If having this feature, maybe we could update the Spark data-locality policy of `preferLocation` for uniffle. Anyway, this is a improvement. Do u think so? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0o4O/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0pf8,incubator-uniffle,1221761020,172,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T03:38:15Z,2022-08-22T03:38:15Z,"> > When the taskScheduler allocate task, we don't consider reduce partition distribution, fewer task can use the feature.
> 
> If having this feature, maybe we could update the Spark data-locality policy of `preferLocation` for uniffle. Anyway, this is a improvement. Do u think so?

Although it's an improvement, if it may bring more complexity and less effectiveness, I prefer not merging it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0pf8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0r9I,incubator-uniffle,1221771080,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-22T03:54:17Z,2022-08-22T03:54:17Z,"Got your thought.

### complexity
This feature only introduces the short-circuit read handler. In my POC, it wont break down the current implementation. Besides, we could introduce the config to control whether to enable this.

### effectiveness
The effectiveness depends on the Spark knowledge about the shuffle-data-locality. I think this can be improved by the later patches for Spark, like Alluxio does. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0r9I/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I847_,incubator-uniffle,1223921407,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-23T11:16:15Z,2022-08-23T11:16:15Z,Do u have some ideas? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I847_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I87Mq,incubator-uniffle,1223930666,172,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-23T11:24:49Z,2022-08-23T11:24:49Z,"> Do u have some ideas? @jerqi

This feature need to increase a new rpc interface. The interfaces are very important. I need to guarantee the compatibility of interfaces. I think this is the biggest complexity which this feature brings. For effectiveness, we don't have data locality, we can't get too much performance improvement. And we have no plans about data locality, if we want to have this feature, we should achieve the feature of data locality.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I87Mq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JR8u5,incubator-uniffle,1229441977,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-28T11:59:14Z,2022-08-28T11:59:14Z,"For your thought, do I need to submit a data-locality shuffle patch about Spark firstly? As I know, we need to change the Spark codebase about `MapOutputTracker.getPreferredLocationsForShuffle` and `ShuffleRowRDD.getPreferredLocations` . When enable RSS, the perferred locations could be gotten from the dep.shuffleHandle(RssShuffleHandle of Uniffle partitionToServers vars). If I'm wrong, plz point out it. Thanks

I still think this is a necessary feature for co-location deployment. Besides this has been implemented by other RSS project.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JR8u5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JSCiu,incubator-uniffle,1229465774,172,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-28T14:06:13Z,2022-08-28T14:06:13Z,"> For your thought, do I need to submit a data-locality shuffle patch about Spark firstly? As I know, we need to change the Spark codebase about `MapOutputTracker.getPreferredLocationsForShuffle` and `ShuffleRowRDD.getPreferredLocations` . When enable RSS, the perferred locations could be gotten from the dep.shuffleHandle(RssShuffleHandle of Uniffle partitionToServers vars). If I'm wrong, plz point out it. Thanks
> 
> I still think this is a necessary feature for co-location deployment. Besides this has been implemented by other RSS project.

Not only the spark patch, but also we need to modify the strategy of coordinator. I know the Bytedance RSS implement this feature, if the cluster is big enough, the feature will be useless.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JSCiu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/172,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JSDIf,incubator-uniffle,1229468191,172,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-08-28T14:15:00Z,2022-08-28T14:15:00Z,"> but also we need to modify the strategy of coordinator

Yes, we’d better to assign shuffle servers with data locality. This is a long way to get the best optimization.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JSDIf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/173,https://api.github.com/repos/apache/incubator-uniffle/issues/173,incubator-uniffle,1345769167,173,[Improvement] ShuffleBufferManager supports triggering flush according to the size of single ShuffleBuffer,leixm,31424839,Xianming Lei,,CLOSED,2022-08-22T03:51:23Z,2022-08-22T11:54:41Z,Should shuffleBufferManager supports triggering flush according to the size of single ShuffleBuffer? so that we can make more full use of disk io without waiting for the buffer to reach _`rss.server.buffer.capacity * rss.server.memory.shuffle.highWaterMark.percentage`_,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/173/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/173,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0rwR,incubator-uniffle,1221770257,173,NA,leixm,31424839,Xianming Lei,,NA,2022-08-22T03:52:38Z,2022-08-22T03:52:38Z,"I think it's necessary feature, what do u think? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0rwR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/173,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0r8c,incubator-uniffle,1221771036,173,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-22T03:54:13Z,2022-08-22T03:54:13Z,"> I think it's necessary feature, what do u think? @jerqi

Agree, Do you want to raise a pr?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0r8c/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/173,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0sPm,incubator-uniffle,1221772262,173,NA,leixm,31424839,Xianming Lei,,NA,2022-08-22T03:56:29Z,2022-08-22T03:56:29Z,"yes, I will create a PR","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5I0sPm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/186,https://api.github.com/repos/apache/incubator-uniffle/issues/186,incubator-uniffle,1348838266,186,[Feature] A better strategy to select remoteStoragePath,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2022-08-24T04:21:01Z,2022-09-07T14:20:15Z,"At present, if we configure multiple HDFS paths, the selected strategy is based on the number of apps, which is relatively simple. My idea is to compare the results based on the ratio of all file sizes under the `remoteStoragePath` and the remaining space under the namespace corresponding to the `remoteStoragePath`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/186/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/186,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JBqUm,incubator-uniffle,1225172262,186,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-24T04:21:33Z,2022-08-24T04:21:33Z,Could you give me some advice? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JBqUm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/186,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JB_w6,incubator-uniffle,1225260090,186,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-24T06:32:12Z,2022-08-24T06:32:12Z,"There are many things to consider about HDFS allocation. 
First, the scale of HDFS cluster. There are more DataNodes, the cluster can provide more IO capability.
Second, the remaining space of HDFS cluster. If a shuffle will use too much space, we should give it a enough HDFS cluster, but we should notice that shuffle is a temporary data, we will delete them after we use them. Shuffle data usually don't require too much space like input data and output data.
Third, if you choose to use HDFS with other users, we also need to care the stability of HDFS cluster. If HDFS cluster have two many retries, we should allocate less application to it.
Fourth, we can't forecast how big the shuffle is when we allocate HDFS cluster to it. So we only assume that the one shuffle with big shuffle is the same as the one with small shuffle, it's absolutely wrong in the production cluster. But I don't have any ideas about it.
Finally, it's ok for me to add a new strategy. But we should separate the mechanism from strategy and have some data in production environment to improve the effectiveness of the strategy. 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JB_w6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/186,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JCHXB,incubator-uniffle,1225291201,186,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-24T07:09:29Z,2022-08-24T07:09:29Z,"Thank you for your detailed explanation. I have no doubt about the first two points, but the third point is that I want to know what you mean by the retry of HDFS cluster. And the fourth point is that we really have no way to know the amount of shuffle data, so the current idea is that if there are no files at the beginning, we can only compare the remaining capacity of the namespace. If there are already shuffle files, Then we can compare the ratio of the size of all the shuffle files and the remaining capacity of the namespace under different HDFS paths.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JCHXB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/186,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JCLBG,incubator-uniffle,1225306182,186,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-24T07:26:11Z,2022-08-24T07:26:11Z,"> Thank you for your detailed explanation. I have no doubt about the first two points, but the third point is that I want to know what you mean by the retry of HDFS cluster. And the fourth point is that we really have no way to know the amount of shuffle data, so the current idea is that if there are no files at the beginning, we can only compare the remaining capacity of the namespace. If there are already shuffle files, Then we can compare the ratio of the size of all the shuffle files and the remaining capacity of the namespace under different HDFS paths.

Third point, sorry... I should give more explanation. If shuffle server fail to  write data to HDFS because HDFS high load, shuffle will retry. If there are many retries about HDFS, it means that HDFS have bad status, we should avoid using it.
Fourth, your solution is  not a perfect solution, it must depend data in the production environment  to prove the  effectiveness. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JCLBG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/186,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JCPoR,incubator-uniffle,1225325073,186,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-24T07:45:31Z,2022-08-24T07:45:31Z,"Yes, we will verify it in the production environment. And thank you again for your advice.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JCPoR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/186,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5J4J0x,incubator-uniffle,1239457073,186,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-07T14:20:14Z,2022-09-07T14:20:14Z,resolved by #192 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5J4J0x/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/189,https://api.github.com/repos/apache/incubator-uniffle/issues/189,incubator-uniffle,1352080660,189,[Feature] Support zstd compression,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-08-26T10:32:23Z,2022-10-26T11:11:03Z,"### Motivation
ZSTD has a good tradeoff between compression ratio and de/compress speed. For reducing the shuffle-data stored size, it's necessary to support this compression algorithm.

### How to do
1. Introduce the abstract interface of de/compress method
2. Support zstd","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/189/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/189,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JN0Ze,incubator-uniffle,1228359262,189,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-08-26T11:04:58Z,2022-08-26T11:04:58Z,Good idea.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JN0Ze/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/189,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NAF18,incubator-uniffle,1291869564,189,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-26T11:10:42Z,2022-10-26T11:10:42Z,"You can raise some other issues for other compression codec , such as snappy, as good first issues. Let more people can join our community more easily.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NAF18/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/189,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NAF7m,incubator-uniffle,1291869926,189,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-26T11:11:03Z,2022-10-26T11:11:03Z,close by #254 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NAF7m/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/194,incubator-uniffle,1356990393,194,[Feature] Support spark 3.2.0,leixm,31424839,Xianming Lei,,CLOSED,2022-08-31T08:29:36Z,2022-09-07T06:01:13Z,"After SPARK-36892, MapOutputTrackerWorker#getMapSizesByExecutorId has been modified to include method names and return parameter types, Java.lang.NoSuchMethodException will be thrown when the RssShuffleManager#getExpectedTasksByExecutorId method is called, The version of our production environment is 3.2.0.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/194/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JeHLv,incubator-uniffle,1232630511,194,NA,leixm,31424839,Xianming Lei,,NA,2022-08-31T08:29:58Z,2022-08-31T08:29:58Z,@jerqi  What do you think?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JeHLv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JeIs_,incubator-uniffle,1232636735,194,NA,leixm,31424839,Xianming Lei,,NA,2022-08-31T08:34:36Z,2022-08-31T08:34:36Z,Maybe we can support spark 3.2.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JeIs_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jfbii,incubator-uniffle,1232976034,194,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-08-31T13:57:58Z,2022-08-31T13:57:58Z,I think it may not be standard to build code by reflection. It may be more appropriate to create different modules and match different spark versions.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jfbii/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jh8Dd,incubator-uniffle,1233633501,194,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-01T01:40:57Z,2022-09-01T01:40:57Z,We already supported Spark 3.2.1. You can see the Spark 3.2 profile.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jh8Dd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jh8uz,incubator-uniffle,1233636275,194,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-01T01:46:48Z,2022-09-01T01:46:48Z,"> I think it may not be standard to build code by reflection. It may be more appropriate to create different modules and match different spark versions.

Just avoid too repeated code.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jh8uz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiMWr,incubator-uniffle,1233700267,194,NA,leixm,31424839,Xianming Lei,,NA,2022-09-01T03:43:13Z,2022-09-01T03:43:13Z,"> We already supported Spark 3.2.1. You can see the Spark 3.2 profile.

Spark 3.2.1 version re-added the getMapSizesByExecutorId method, but currently uniffle does not support spark 3.2.0, there is a simple way to verify, change the spark.version of the spark 3.2 profile from 3.2.1 to 3.2.0, and then run spark3 integration test can be reproduced","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiMWr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiMsV,incubator-uniffle,1233701653,194,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-01T03:46:34Z,2022-09-01T03:46:34Z,"> > We already supported Spark 3.2.1. You can see the Spark 3.2 profile.
> 
> Spark 3.2.1 version re-added the getMapSizesByExecutorId method, but currently uniffle does not support spark 3.2.0, there is a simple way to verify, change the spark.version of the spark 3.2 profile from 3.2.1 to 3.2.0, and then run spark3 integration test can be reproduced

Why not upgrade your spark client version? It's easy to upgrade.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiMsV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiXBc,incubator-uniffle,1233743964,194,NA,leixm,31424839,Xianming Lei,,NA,2022-09-01T05:04:02Z,2022-09-01T05:04:02Z,"> > > We already supported Spark 3.2.1. You can see the Spark 3.2 profile.
> > 
> > 
> > Spark 3.2.1 version re-added the getMapSizesByExecutorId method, but currently uniffle does not support spark 3.2.0, there is a simple way to verify, change the spark.version of the spark 3.2 profile from 3.2.1 to 3.2.0, and then run spark3 integration test can be reproduced
> 
> Why not upgrade your spark client version? It's easy to upgrade.

This is not a problem with the spark client. The exception will be thrown in the Driver process. If we use the current uniffle version, we need to upgrade the spark version of the production environment to 3.2.1.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiXBc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiXKN,incubator-uniffle,1233744525,194,NA,leixm,31424839,Xianming Lei,,NA,2022-09-01T05:04:48Z,2022-09-01T05:04:48Z,"We prefer to support spark3.2.0 in the uniffle client, so the cost will be lower.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiXKN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiZK8,incubator-uniffle,1233752764,194,NA,leixm,31424839,Xianming Lei,,NA,2022-09-01T05:17:24Z,2022-09-01T05:17:24Z,"The main purpose of this issue is to confirm the following two points
1. Uniffle does not support spark3.2.0
2. Should we support spark3.2.0?
Point 1 has been confirmed, I believe that supporting spark 3.2.0 is beneficial to the uniffle community. Some users' production environment is version 3.2.0, but they want to use uniffle to serve their production environment.  We can also give these users a good experience.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiZK8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JimZ3,incubator-uniffle,1233806967,194,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-01T06:32:35Z,2022-09-01T06:32:35Z,"If we want to support Spark 3.2.0, should we add a spark3.2.0 profile? The interface is only removed in the Spark 3.2.0 temporarily wrongly. Is it worth to support Spark 3.2.0?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JimZ3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JirE6,incubator-uniffle,1233826106,194,NA,leixm,31424839,Xianming Lei,,NA,2022-09-01T06:54:11Z,2022-09-01T06:54:11Z,"What you said is correct, maybe we can provide a patch file for users who need to support spark3.2.0 to apply it themselves, which will neither cause code redundancy nor confuse users. Taking a step back, if we don't support it, we can explain in the documentation that spark3.2.0 is not supported to avoid confusion for users.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JirE6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiyCC,incubator-uniffle,1233854594,194,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-01T07:21:25Z,2022-09-01T07:21:25Z,"It seems not friendly for us to use extra patch. I think we can use reflection in our code to support 3.2.0 and add a profile.Spark 3.2.0 may be a special case, it shouldn't bring too much burden. If we need to maintain every minor version, it really bring too much burden.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JiyCC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JtarL,incubator-uniffle,1236642507,194,NA,leixm,31424839,Xianming Lei,,NA,2022-09-05T07:35:17Z,2022-09-05T07:35:17Z,"> I think we can use reflection in our code to support 3.2.0 and add a profile

We can support spark3.2.0 through reflection, but I don't quite understand why profile is needed. Profile cannot control the code logic, it can only be used to control the version of dependencies.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JtarL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtd6Z,incubator-uniffle,1236655769,194,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-05T07:49:42Z,2022-09-05T07:49:42Z,"> > I think we can use reflection in our code to support 3.2.0 and add a profile
> 
> We can support spark3.2.0 through reflection, but I don't quite understand why profile is needed. Profile cannot control the code logic, it can only be used to control the version of dependencies.

We need run the test pipeline with the profile to verify that the Spark version is ok and guarantee the new changes won't break the behavior of the version.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtd6Z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtf3S,incubator-uniffle,1236663762,194,NA,leixm,31424839,Xianming Lei,,NA,2022-09-05T07:58:24Z,2022-09-05T07:58:24Z,Maybe I can raise a new pr to add reflection code?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtf3S/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtg0A,incubator-uniffle,1236667648,194,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-05T08:02:29Z,2022-09-05T08:02:29Z,"> Maybe I can raise a new pr to add reflection code?

OK.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtg0A/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/196,https://api.github.com/repos/apache/incubator-uniffle/issues/196,incubator-uniffle,1358459903,196,Flaky test ShuffleFlushManagerOnKerberizedHdfsTest,kaijchen,5821159,Kaijie Chen,ckj@apache.org,OPEN,2022-09-01T08:29:44Z,2022-11-03T11:07:23Z,"Example of CI failures (both on -Pspark2.3):
https://github.com/apache/incubator-uniffle/runs/8129274621?check_suite_focus=true#step:4:1722
https://github.com/apache/incubator-uniffle/runs/8129689956?check_suite_focus=true#step:4:1722

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 56.754 s <<< FAILURE! - in org.apache.uniffle.server.ShuffleFlushManagerOnKerberizedHdfsTest
Error:  clearTest  Time elapsed: 51.62 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: Unexpected flush process
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:39)
	at org.junit.jupiter.api.Assertions.fail(Assertions.java:134)
	at org.apache.uniffle.server.ShuffleFlushManagerTest.waitForFlush(ShuffleFlushManagerTest.java:343)
	at org.apache.uniffle.server.ShuffleFlushManagerOnKerberizedHdfsTest.clearTest(ShuffleFlushManagerOnKerberizedHdfsTest.java:120)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/196/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/196,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JjGL4,incubator-uniffle,1233937144,196,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-01T08:32:54Z,2022-09-01T08:32:54Z,"Let me take a look. Oh, this test case is introduced by me, and looks the some test cases are not stable.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JjGL4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/196,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JjUn0,incubator-uniffle,1233996276,196,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-01T09:15:39Z,2022-09-01T09:15:39Z,"The stacktrace is as follow

```
2022-09-01 07:31:40,131 ERROR [FlushEventThreadPool] server.ShuffleFlushManager (ShuffleFlushManager.java:flushToFile(209)) - Exception happened when process flush shuffle data for ShuffleDataFlushEvent: eventId=0, appId=complexWriteTest_appId1, shuffleId=1, startPartition=0, endPartition=1
java.lang.RuntimeException: java.io.IOException: Failed on local exception: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)]; Host Details : local host is: ""fv-az489-314/10.1.1.91""; destination host is: ""localhost"":37279; 
	at org.apache.uniffle.storage.common.HdfsStorage.newWriteHandler(HdfsStorage.java:113)
	at org.apache.uniffle.storage.common.AbstractStorage.lambda$getOrCreateWriteHandler$2(AbstractStorage.java:50)
	at java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1660)
	at org.apache.uniffle.storage.common.AbstractStorage.getOrCreateWriteHandler(AbstractStorage.java:50)
	at org.apache.uniffle.server.ShuffleFlushManager.flushToFile(ShuffleFlushManager.java:168)
	at org.apache.uniffle.server.ShuffleFlushManager.lambda$null$0(ShuffleFlushManager.java:100)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
Caused by: java.io.IOException: Failed on local exception: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)]; Host Details : local host is: ""fv-az489-314/10.1.1.91""; destination host is: ""localhost"":37279; 
	at org.apache.hadoop.net.NetUtils.wrapException(NetUtils.java:782)
	at org.apache.hadoop.ipc.Client.getRpcResponse(Client.java:1493)
	at org.apache.hadoop.ipc.Client.call(Client.java:1435)
	at org.apache.hadoop.ipc.Client.call(Client.java:1345)
	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:227)
	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:116)
	at com.sun.proxy.$Proxy68.getFileInfo(Unknown Source)
	at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.getFileInfo(ClientNamenodeProtocolTranslatorPB.java:796)
	at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:409)
	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeMethod(RetryInvocationHandler.java:163)
	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invoke(RetryInvocationHandler.java:155)
	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeOnce(RetryInvocationHandler.java:95)
	at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:346)
	at com.sun.proxy.$Proxy69.getFileInfo(Unknown Source)
	at org.apache.hadoop.hdfs.DFSClient.getFileInfo(DFSClient.java:1649)
	at org.apache.hadoop.hdfs.DistributedFileSystem$27.doCall(DistributedFileSystem.java:1440)
	at org.apache.hadoop.hdfs.DistributedFileSystem$27.doCall(DistributedFileSystem.java:1437)
	at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)
	at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:1437)
	at org.apache.hadoop.fs.FileSystem.exists(FileSystem.java:1437)
	at org.apache.uniffle.storage.handler.impl.HdfsShuffleWriteHandler.initialize(HdfsShuffleWriteHandler.java:89)
	at org.apache.uniffle.storage.handler.impl.HdfsShuffleWriteHandler.<init>(HdfsShuffleWriteHandler.java:81)
	at org.apache.uniffle.storage.common.HdfsStorage.newWriteHandler(HdfsStorage.java:108)
	... 8 more
Caused by: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)]
	at org.apache.hadoop.ipc.Client$Connection$1.run(Client.java:755)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1844)
	at org.apache.hadoop.ipc.Client$Connection.handleSaslConnectionFailure(Client.java:718)
	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:811)
	at org.apache.hadoop.ipc.Client$Connection.access$3500(Client.java:410)
	at org.apache.hadoop.ipc.Client.getConnection(Client.java:1550)
	at org.apache.hadoop.ipc.Client.call(Client.java:1381)
	... 31 more
Caused by: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)]
	at com.sun.security.sasl.gsskerb.GssKrb5Client.evaluateChallenge(GssKrb5Client.java:211)
	at org.apache.hadoop.security.SaslRpcClient.saslConnect(SaslRpcClient.java:406)
	at org.apache.hadoop.ipc.Client$Connection.setupSaslConnection(Client.java:614)
	at org.apache.hadoop.ipc.Client$Connection.access$2200(Client.java:410)
	at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:798)
	at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:794)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1844)
	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:793)
	... 34 more
Caused by: GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)
	at sun.security.jgss.krb5.Krb5Context.initSecContext(Krb5Context.java:772)
	at sun.security.jgss.GSSContextImpl.initSecContext(GSSContextImpl.java:248)
	at sun.security.jgss.GSSContextImpl.initSecContext(GSSContextImpl.java:179)
	at com.sun.security.sasl.gsskerb.GssKrb5Client.evaluateChallenge(GssKrb5Client.java:192)
	... 43 more
Caused by: KrbException: Server not found in Kerberos database (7) - Server not found in Kerberos database
	at sun.security.krb5.KrbTgsRep.<init>(KrbTgsRep.java:73)
	at sun.security.krb5.KrbTgsReq.getReply(KrbTgsReq.java:226)
	at sun.security.krb5.KrbTgsReq.sendAndGetCreds(KrbTgsReq.java:237)
	at sun.security.krb5.internal.CredentialsUtil.serviceCredsSingle(CredentialsUtil.java:477)
	at sun.security.krb5.internal.CredentialsUtil.serviceCreds(CredentialsUtil.java:340)
	at sun.security.krb5.internal.CredentialsUtil.serviceCreds(CredentialsUtil.java:314)
	at sun.security.krb5.internal.CredentialsUtil.acquireServiceCreds(CredentialsUtil.java:169)
	at sun.security.krb5.Credentials.acquireServiceCreds(Credentials.java:490)
	at sun.security.jgss.krb5.Krb5Context.initSecContext(Krb5Context.java:695)
	... 46 more
Caused by: KrbException: Identifier doesn't match expected value (906)
	at sun.security.krb5.internal.KDCRep.init(KDCRep.java:140)
	at sun.security.krb5.internal.TGSRep.init(TGSRep.java:65)
	at sun.security.krb5.internal.TGSRep.<init>(TGSRep.java:60)
	at sun.security.krb5.KrbTgsRep.<init>(KrbTgsRep.java:55)
	... 54 more
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JjUn0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/196,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3fyf,incubator-uniffle,1256062111,196,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-23T10:49:22Z,2022-09-23T10:49:22Z,"> The stacktrace is as follow
> 
> ```
> 2022-09-01 07:31:40,131 ERROR [FlushEventThreadPool] server.ShuffleFlushManager (ShuffleFlushManager.java:flushToFile(209)) - Exception happened when process flush shuffle data for ShuffleDataFlushEvent: eventId=0, appId=complexWriteTest_appId1, shuffleId=1, startPartition=0, endPartition=1
> java.lang.RuntimeException: java.io.IOException: Failed on local exception: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)]; Host Details : local host is: ""fv-az489-314/10.1.1.91""; destination host is: ""localhost"":37279; 
> 	at org.apache.uniffle.storage.common.HdfsStorage.newWriteHandler(HdfsStorage.java:113)
> 	at org.apache.uniffle.storage.common.AbstractStorage.lambda$getOrCreateWriteHandler$2(AbstractStorage.java:50)
> 	at java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1660)
> 	at org.apache.uniffle.storage.common.AbstractStorage.getOrCreateWriteHandler(AbstractStorage.java:50)
> 	at org.apache.uniffle.server.ShuffleFlushManager.flushToFile(ShuffleFlushManager.java:168)
> 	at org.apache.uniffle.server.ShuffleFlushManager.lambda$null$0(ShuffleFlushManager.java:100)
> 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
> 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
> 	at java.lang.Thread.run(Thread.java:750)
> Caused by: java.io.IOException: Failed on local exception: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)]; Host Details : local host is: ""fv-az489-314/10.1.1.91""; destination host is: ""localhost"":37279; 
> 	at org.apache.hadoop.net.NetUtils.wrapException(NetUtils.java:782)
> 	at org.apache.hadoop.ipc.Client.getRpcResponse(Client.java:1493)
> 	at org.apache.hadoop.ipc.Client.call(Client.java:1435)
> 	at org.apache.hadoop.ipc.Client.call(Client.java:1345)
> 	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:227)
> 	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:116)
> 	at com.sun.proxy.$Proxy68.getFileInfo(Unknown Source)
> 	at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.getFileInfo(ClientNamenodeProtocolTranslatorPB.java:796)
> 	at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)
> 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
> 	at java.lang.reflect.Method.invoke(Method.java:498)
> 	at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:409)
> 	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeMethod(RetryInvocationHandler.java:163)
> 	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invoke(RetryInvocationHandler.java:155)
> 	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeOnce(RetryInvocationHandler.java:95)
> 	at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:346)
> 	at com.sun.proxy.$Proxy69.getFileInfo(Unknown Source)
> 	at org.apache.hadoop.hdfs.DFSClient.getFileInfo(DFSClient.java:1649)
> 	at org.apache.hadoop.hdfs.DistributedFileSystem$27.doCall(DistributedFileSystem.java:1440)
> 	at org.apache.hadoop.hdfs.DistributedFileSystem$27.doCall(DistributedFileSystem.java:1437)
> 	at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)
> 	at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:1437)
> 	at org.apache.hadoop.fs.FileSystem.exists(FileSystem.java:1437)
> 	at org.apache.uniffle.storage.handler.impl.HdfsShuffleWriteHandler.initialize(HdfsShuffleWriteHandler.java:89)
> 	at org.apache.uniffle.storage.handler.impl.HdfsShuffleWriteHandler.<init>(HdfsShuffleWriteHandler.java:81)
> 	at org.apache.uniffle.storage.common.HdfsStorage.newWriteHandler(HdfsStorage.java:108)
> 	... 8 more
> Caused by: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)]
> 	at org.apache.hadoop.ipc.Client$Connection$1.run(Client.java:755)
> 	at java.security.AccessController.doPrivileged(Native Method)
> 	at javax.security.auth.Subject.doAs(Subject.java:422)
> 	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1844)
> 	at org.apache.hadoop.ipc.Client$Connection.handleSaslConnectionFailure(Client.java:718)
> 	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:811)
> 	at org.apache.hadoop.ipc.Client$Connection.access$3500(Client.java:410)
> 	at org.apache.hadoop.ipc.Client.getConnection(Client.java:1550)
> 	at org.apache.hadoop.ipc.Client.call(Client.java:1381)
> 	... 31 more
> Caused by: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)]
> 	at com.sun.security.sasl.gsskerb.GssKrb5Client.evaluateChallenge(GssKrb5Client.java:211)
> 	at org.apache.hadoop.security.SaslRpcClient.saslConnect(SaslRpcClient.java:406)
> 	at org.apache.hadoop.ipc.Client$Connection.setupSaslConnection(Client.java:614)
> 	at org.apache.hadoop.ipc.Client$Connection.access$2200(Client.java:410)
> 	at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:798)
> 	at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:794)
> 	at java.security.AccessController.doPrivileged(Native Method)
> 	at javax.security.auth.Subject.doAs(Subject.java:422)
> 	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1844)
> 	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:793)
> 	... 34 more
> Caused by: GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - Server not found in Kerberos database)
> 	at sun.security.jgss.krb5.Krb5Context.initSecContext(Krb5Context.java:772)
> 	at sun.security.jgss.GSSContextImpl.initSecContext(GSSContextImpl.java:248)
> 	at sun.security.jgss.GSSContextImpl.initSecContext(GSSContextImpl.java:179)
> 	at com.sun.security.sasl.gsskerb.GssKrb5Client.evaluateChallenge(GssKrb5Client.java:192)
> 	... 43 more
> Caused by: KrbException: Server not found in Kerberos database (7) - Server not found in Kerberos database
> 	at sun.security.krb5.KrbTgsRep.<init>(KrbTgsRep.java:73)
> 	at sun.security.krb5.KrbTgsReq.getReply(KrbTgsReq.java:226)
> 	at sun.security.krb5.KrbTgsReq.sendAndGetCreds(KrbTgsReq.java:237)
> 	at sun.security.krb5.internal.CredentialsUtil.serviceCredsSingle(CredentialsUtil.java:477)
> 	at sun.security.krb5.internal.CredentialsUtil.serviceCreds(CredentialsUtil.java:340)
> 	at sun.security.krb5.internal.CredentialsUtil.serviceCreds(CredentialsUtil.java:314)
> 	at sun.security.krb5.internal.CredentialsUtil.acquireServiceCreds(CredentialsUtil.java:169)
> 	at sun.security.krb5.Credentials.acquireServiceCreds(Credentials.java:490)
> 	at sun.security.jgss.krb5.Krb5Context.initSecContext(Krb5Context.java:695)
> 	... 46 more
> Caused by: KrbException: Identifier doesn't match expected value (906)
> 	at sun.security.krb5.internal.KDCRep.init(KDCRep.java:140)
> 	at sun.security.krb5.internal.TGSRep.init(TGSRep.java:65)
> 	at sun.security.krb5.internal.TGSRep.<init>(TGSRep.java:60)
> 	at sun.security.krb5.KrbTgsRep.<init>(KrbTgsRep.java:55)
> 	... 54 more
> ```

It occurs again
https://github.com/apache/incubator-uniffle/actions/runs/3111709653/jobs/5044304701
This test is still flaky.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3fyf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/196,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K8gOl,incubator-uniffle,1257374629,196,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-26T01:58:12Z,2022-09-26T01:58:12Z,OK. I think I will fix it in the next days,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K8gOl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/196,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LJi45,incubator-uniffle,1260793401,196,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-28T11:54:01Z,2022-09-28T11:54:01Z,I reproduce this failure due to the DNS lookup failure. I try to fix this failure by adding the hostname into /etc/hosts mapping file.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LJi45/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/196,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nmg4l,incubator-uniffle,1301941797,196,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-03T11:07:23Z,2022-11-03T11:07:23Z,"@zuston Kerberos test seems unstable, I will reopen this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nmg4l/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/198,incubator-uniffle,1361494505,198,[Problem] Inconsistent blocks when reading shuffle data,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-09-05T07:03:43Z,2023-07-20T10:53:40Z,"I found some tasks of spark jobs will throw the exceptions that the inconsistent blocks number. The stacktrace is as follows

```
22/09/03 15:29:21 ERROR Executor: Exception in task 330.0 in stage 9.0 (TID 59001)
org.apache.uniffle.common.exception.RssException: Blocks read inconsistent: expected 30000 blocks, actual 15636 blocks
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.checkProcessedBlockIds(ShuffleReadClientImpl.java:215)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:135)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
```

I didn't find any error/warn log in shuffle server which stored the corresponding partition data. 

We dont set any replica config and directly use the MEMORY_LOCALFILE storageType. Does this exception caused by the disk error?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/198/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtgmc,incubator-uniffle,1236666780,198,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-05T08:01:35Z,2022-09-05T08:01:35Z,It may be a bug of our rss. I ever try to fix the similar problems by https://github.com/apache/incubator-uniffle/pull/40 and https://github.com/Tencent/Firestorm/pull/92. Could you reproduce this problem? Are the missing blocks  disk storage or memory storage?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtgmc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JticV,incubator-uniffle,1236674325,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-05T08:09:43Z,2022-09-05T08:09:43Z,"> Could you reproduce this problem? 

It occurs in our users' jobs and maybe I have to write test spark code to reproduce

> Are the missing blocks disk storage or memory storage?

I dont know which storage's block missing. But I check the request number in shuffle server and the request log entry number in tasks, they are equal.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5JticV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtn_0,incubator-uniffle,1236697076,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-05T08:31:52Z,2022-09-05T08:31:52Z,"> It may be a bug of our rss. I ever try to fix the similar problems by https://github.com/apache/incubator-uniffle/pull/40 and https://github.com/Tencent/Firestorm/pull/92

It looks this problem is not the same as the problem you said. This problem is caused by lacking partial blocks.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jtn_0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jxw5V,incubator-uniffle,1237782101,198,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-09-06T07:47:54Z,2022-09-06T07:47:54Z,"```
22/09/05 20:58:01 INFO impl.HdfsShuffleReadHandler: Read index files hdfs://ns1/tmp/4/308-308/xxxx-19999_0.index for 2 ms
22/09/05 20:58:01 WARN util.RssUtils: Read index data under flow
java.nio.BufferUnderflowException
	at java.nio.Buffer.nextGetIndex(Buffer.java:506)
	at java.nio.HeapByteBuffer.getLong(HeapByteBuffer.java:412)
	at org.apache.uniffle.common.util.RssUtils.transIndexDataToSegments(RssUtils.java:204)
	at org.apache.uniffle.common.util.RssUtils.transIndexDataToSegments(RssUtils.java:188)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:67)
	at org.apache.uniffle.storage.handler.impl.HdfsClientReadHandler.readShuffleData(HdfsClientReadHandler.java:135)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:112)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:140)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:195)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:131)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:100)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:213)
	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
	at scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:409)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage9.sort_addToSorter_0$(Unknown Source)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage9.processNext(Unknown Source)
```
We seem to have the same problem, but the reason for the inconsistent blocks number is that an exception occurred when the index file was read.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jxw5V/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jxzgp,incubator-uniffle,1237792809,198,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-06T07:58:08Z,2022-09-06T07:58:08Z,"> transIndexDataToSegments

It seems that we read incomplete index file.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jxzgp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx0e5,incubator-uniffle,1237796793,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-06T08:02:10Z,2022-09-06T08:02:10Z,"> > transIndexDataToSegments
> 
> It seems that we read incomplete index file.

We should fail fast when encountering BufferUnderflowException instead of ignoring. https://github.com/apache/incubator-uniffle/blob/07f70ed872b87107fc7028577bd9e66d8349fd6c/common/src/main/java/org/apache/uniffle/common/util/RssUtils.java#L224","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx0e5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx1oR,incubator-uniffle,1237801489,198,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-06T08:06:31Z,2022-09-06T08:06:31Z,"For MEMORY_HDFS or MEMORY_LOCALFILE, it's normal to read incomplete index data, so we choose to ignore instead of failing fast. 

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx1oR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx19u,incubator-uniffle,1237802862,198,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-09-06T08:07:43Z,2022-09-06T08:07:43Z,"> We should fail fast when encountering BufferUnderflowException instead of ignoring.

What I am curious about is whether this is caused by the fact that the data of the stream is not flushed normally or the stream is closed abnormally.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx19u/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx2WP,incubator-uniffle,1237804431,198,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-06T08:09:10Z,2022-09-06T08:09:10Z,"> > We should fail fast when encountering BufferUnderflowException instead of ignoring.
> 
> What I am curious about is whether this is caused by the fact that the data of the stream is not flushed normally or the stream is closed abnormally.

Maybe shuffle index is writing..","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx2WP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx30t,incubator-uniffle,1237810477,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-06T08:14:55Z,2022-09-06T08:14:55Z,"> For MEMORY_HDFS or MEMORY_LOCALFILE, it's normal to read incomplete index data, so we choose to ignore instead of failing fast.

Oh, make sense.

> > > We should fail fast when encountering BufferUnderflowException instead of ignoring.
> > 
> > 
> > What I am curious about is whether this is caused by the fact that the data of the stream is not flushed normally or the stream is closed abnormally.
> 
> Maybe shuffle index is writing..

Firstly, maybe we should reproduce this exception that make reader/writer operate this file at the same time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jx30t/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jyxf9,incubator-uniffle,1238046717,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-06T11:57:08Z,2022-09-06T11:57:08Z,"> Revisit: do we need to fail fast?

As I know, the exception of BufferUnderflowException is caused by the incomplete `FileBasedShuffleSegment`. In localfile reader, it will always get the n pieces of  `FileBasedShuffleSegment` and then wont throw the exception. However in HDFS index read, it may return the incomplete data ((this problem will happen when spill data from memory to HDFS, so we also should do similar operation like local index file read). After that, we should do fail fast in https://github.com/apache/incubator-uniffle/blob/07f70ed872b87107fc7028577bd9e66d8349fd6c/common/src/main/java/org/apache/uniffle/common/util/RssUtils.java#L224


> Is inconsistent blocks caused by this `BufferUnderflowException`?

The operation of spilling is a common action for uniffle and it has done the operation of filtering blocks. So this inconsistent blocks means it exist bug when spilling","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Jyxf9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5J4BWb,incubator-uniffle,1239422363,198,NA,leixm,31424839,Xianming Lei,,NA,2022-09-07T13:53:13Z,2022-09-07T13:53:13Z,"Our production environment also had such an exception once, but so far it has not been able to reproduce. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5J4BWb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5J4CEQ,incubator-uniffle,1239425296,198,NA,leixm,31424839,Xianming Lei,,NA,2022-09-07T13:55:19Z,2022-09-07T13:55:19Z,I think maybe the shuffle server is writing this file and the output stream has not been closed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5J4CEQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KFW08,incubator-uniffle,1242918204,198,NA,leixm,31424839,Xianming Lei,,NA,2022-09-11T08:42:01Z,2022-09-11T08:42:01Z,"Can you help me understand #issue_63? @jerqi 
`When we use the storageType MEMORY_HDFS, MEMORY_LOCALFILE_HDFS, after we read data from memory, the data may be flushed to HDFS. So we could read incomplete index data. `
`org.apache.uniffle.storage.handler.impl.HdfsFileWriter#writeIndex` is a complete operation, it looks like it shouldn't write an incomplete index file.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KFW08/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KFW4Z,incubator-uniffle,1242918425,198,NA,leixm,31424839,Xianming Lei,,NA,2022-09-11T08:43:45Z,2022-09-11T08:43:45Z,"In our production environment, certain tasks will have this problem for a certain period of time. I am trying to reproduce this situation and keep the index file and data file.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KFW4Z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMj3z,incubator-uniffle,1244806643,198,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-13T02:08:56Z,2022-09-13T02:08:56Z,"> Can you help me understand #issue_63? @jerqi `When we use the storageType MEMORY_HDFS, MEMORY_LOCALFILE_HDFS, after we read data from memory, the data may be flushed to HDFS. So we could read incomplete index data. ` `org.apache.uniffle.storage.handler.impl.HdfsFileWriter#writeIndex` is a complete operation, it looks like it shouldn't write an incomplete index file.

If you use MEMORY_HDFS or MEMORY_LOCALFILE_HDFS, you can read data from memory and then you will read data from HDFS, but the data of memory may be flushed, so you can read the incomplete data of memory flushed to HDFS.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMj3z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMsPn,incubator-uniffle,1244840935,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-13T03:13:19Z,2022-09-13T03:13:19Z,"After collecting all the failed tasks whose exception is related to `org.apache.uniffle.common.exception.RssException: Blocks read inconsistent`, I found these exception is caused by the `DEADLINE_EXCEEDED` of GRPC remote call, which is caught by the Uniffle and dont throw it. This made us confused and thought it was a w/r bug.

I think I will raise a PR to fix it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMsPn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSEEv,incubator-uniffle,1246249263,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-14T05:23:25Z,2022-09-14T05:23:25Z,"Follow up this problem.

I found the Grpc client sometimes will throw DEADLINE exception like as follows
```
org.apache.uniffle.common.exception.RssException: Failed to read shuffle data with ShuffleServerGrpcClient for host[10.67.67.68], port[21000] due to DEADLINE_EXCEEDED: deadline exceeded after 59.999946594s. [closed=[], committed=[remote_addr=10.67.67.68/10.67.67.68:21000]]
	at org.apache.uniffle.storage.handler.impl.LocalFileClientRemoteReadHandler.readShuffleData(LocalFileClientRemoteReadHandler.java:88)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:83)
	at org.apache.uniffle.storage.handler.impl.LocalFileClientReadHandler.readShuffleData(LocalFileClientReadHandler.java:79)
	at org.apache.uniffle.storage.handler.impl.LocalFileQuorumClientReadHandler.readShuffleData(LocalFileQuorumClientReadHandler.java:79)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:112)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:195)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:131)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:101)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:238)
	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage20.sort_addToSorter_0$(Unknown Source)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage20.processNext(Unknown Source)
	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)
	at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:755)
	at org.apache.spark.sql.execution.RowIteratorFromScala.advanceNext(RowIterator.scala:83)
	at org.apache.spark.sql.execution.joins.SortMergeFullOuterJoinScanner.advancedRight(SortMergeJoinExec.scala:1000)
	at org.apache.spark.sql.execution.joins.SortMergeFullOuterJoinScanner.<init>(SortMergeJoinExec.scala:975)
	at org.apache.spark.sql.execution.joins.SortMergeJoinExec.$anonfun$doExecute$1(SortMergeJoinExec.scala:220)
	at org.apache.spark.rdd.ZippedPartitionsRDD2.compute(ZippedPartitionsRDD.scala:89)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
	at org.apache.spark.scheduler.Task.run(Task.scala:131)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
22/09/13 10:43:48 ERROR ComposedClientReadHandler: Failed to read shuffle data from WARM handler
```



But I found this response has been sent by shuffle server, but the client side still throw exception. What will cause this? Network? GC?

Did you meet similar problems?  @jerqi 
 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSEEv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSNcG,incubator-uniffle,1246287622,198,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-14T06:10:05Z,2022-09-14T06:10:05Z,"> Follow up this problem.
> 
> I found the Grpc client sometimes will throw DEADLINE exception like as follows
> 
> ```
> org.apache.uniffle.common.exception.RssException: Failed to read shuffle data with ShuffleServerGrpcClient for host[10.67.67.68], port[21000] due to DEADLINE_EXCEEDED: deadline exceeded after 59.999946594s. [closed=[], committed=[remote_addr=10.67.67.68/10.67.67.68:21000]]
> 	at org.apache.uniffle.storage.handler.impl.LocalFileClientRemoteReadHandler.readShuffleData(LocalFileClientRemoteReadHandler.java:88)
> 	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:83)
> 	at org.apache.uniffle.storage.handler.impl.LocalFileClientReadHandler.readShuffleData(LocalFileClientReadHandler.java:79)
> 	at org.apache.uniffle.storage.handler.impl.LocalFileQuorumClientReadHandler.readShuffleData(LocalFileQuorumClientReadHandler.java:79)
> 	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:112)
> 	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:195)
> 	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:131)
> 	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:101)
> 	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
> 	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:238)
> 	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
> 	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
> 	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage20.sort_addToSorter_0$(Unknown Source)
> 	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage20.processNext(Unknown Source)
> 	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)
> 	at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:755)
> 	at org.apache.spark.sql.execution.RowIteratorFromScala.advanceNext(RowIterator.scala:83)
> 	at org.apache.spark.sql.execution.joins.SortMergeFullOuterJoinScanner.advancedRight(SortMergeJoinExec.scala:1000)
> 	at org.apache.spark.sql.execution.joins.SortMergeFullOuterJoinScanner.<init>(SortMergeJoinExec.scala:975)
> 	at org.apache.spark.sql.execution.joins.SortMergeJoinExec.$anonfun$doExecute$1(SortMergeJoinExec.scala:220)
> 	at org.apache.spark.rdd.ZippedPartitionsRDD2.compute(ZippedPartitionsRDD.scala:89)
> 	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
> 	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
> 	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
> 	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
> 	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
> 	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
> 	at org.apache.spark.scheduler.Task.run(Task.scala:131)
> 	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)
> 	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)
> 	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)
> 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
> 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
> 	at java.lang.Thread.run(Thread.java:745)
> 22/09/13 10:43:48 ERROR ComposedClientReadHandler: Failed to read shuffle data from WARM handler
> ```
> 
> But I found this response has been sent by shuffle server, but the client side still throw exception. What will cause this? Network? GC?
> 
> Did you meet similar problems? @jerqi

Response may not be sent by shuffle server timely.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSNcG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSZHu,incubator-uniffle,1246335470,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-14T07:05:01Z,2022-09-14T07:05:01Z,"> Response may not be sent by shuffle server timely.

Do we have some ways to avoid this problem?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSZHu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSeQh,incubator-uniffle,1246356513,198,NA,leixm,31424839,Xianming Lei,,NA,2022-09-14T07:27:13Z,2022-09-14T07:27:13Z,"> > Response may not be sent by shuffle server timely.
> 
> Do we have some ways to avoid this problem?

This is the response timeout, which should be caused by the high load of ShuffleServer and slow response.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSeQh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSfMs,incubator-uniffle,1246360364,198,NA,leixm,31424839,Xianming Lei,,NA,2022-09-14T07:31:13Z,2022-09-14T07:31:13Z,"We can increase the rpc timeout, and find the reason for the slow response of the shuffle server.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSfMs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSfwm,incubator-uniffle,1246362662,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-14T07:33:29Z,2022-09-14T07:33:29Z,"> > > Response may not be sent by shuffle server timely.
> > 
> > 
> > Do we have some ways to avoid this problem?
> 
> This is the response timeout, which should be caused by the high load of ShuffleServer and slow response.

But I dont find any exception through the metrics of grpc. How did u locate this problem caused by the high-pressure shuffle server?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSfwm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSgcg,incubator-uniffle,1246365472,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-14T07:36:16Z,2022-09-14T07:36:16Z,"> We can increase the rpc timeout, and find the reason for the slow response of the shuffle server.

It's not a fundamental way of increasing the rpc timeout. And I found the rpc has been accepted by shuffle server(handled log has been shown), maybe it's stucked on sending.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSgcg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSjrv,incubator-uniffle,1246378735,198,NA,leixm,31424839,Xianming Lei,,NA,2022-09-14T07:48:57Z,2022-09-14T07:48:57Z,"> > > > Response may not be sent by shuffle server timely.
> > > 
> > > 
> > > Do we have some ways to avoid this problem?
> > 
> > 
> > This is the response timeout, which should be caused by the high load of ShuffleServer and slow response.
> 
> But I dont find any exception through the metrics of grpc. How did u locate this problem caused by the high-pressure shuffle server?

We had a similar rpc timeout exception before, and the task of running 10T data will appear. The investigation found that it was because the inflush_memory and used_memory were too high, which caused the client to frequently retry to send data and apply for buffer.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSjrv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSkDI,incubator-uniffle,1246380232,198,NA,leixm,31424839,Xianming Lei,,NA,2022-09-14T07:50:26Z,2022-09-14T07:50:26Z,"> > We can increase the rpc timeout, and find the reason for the slow response of the shuffle server.
> 
> It's not a fundamental way of increasing the rpc timeout. And I found the rpc has been accepted by shuffle server(handled log has been shown), maybe it's stucked on sending.

You're right, not only the service response, but also the network io, etc.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSkDI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSnio,incubator-uniffle,1246394536,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-14T08:04:27Z,2022-09-14T08:04:27Z,"> The investigation found that it was because the inflush_memory and used_memory were too high, which caused the client to frequently retry to send data and apply for buffer.

Yes, the failure of requiring memory will also cause this exception, but I didn't find any exception of server about require-memory failed.

Besides, the problem you mentioned I have submit a new PR to fix #218 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSnio/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsDeN,incubator-uniffle,1286616973,198,NA,Gustfh,4916765,Gus Nie,,NA,2022-10-21T08:10:48Z,2022-10-21T08:10:48Z,"we also met this error, but in fact it's rpc timeout, when we in compose client mode, the one time read exception will be catch, then try to read other storage , and if the result is empty, then the exception will be gone. at last client will check the blocks map, found the Inconsistent blocks issue. so am thinking there is exception confuse, some case is not inconsistent blocks issue, just read timeout maybe cased by high load shuffle server.  suggest to change the code to raise another exception for this case to void the confuse","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsDeN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsGqw,incubator-uniffle,1286630064,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-21T08:22:59Z,2022-10-21T08:22:59Z,"> suggest to change the code to raise another exception for this case to void the confuse

+1. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsGqw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsNW6,incubator-uniffle,1286657466,198,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T08:48:13Z,2022-10-21T08:48:13Z,"> we also met this error, but in fact it's rpc timeout, when we in compose client mode, the one time read exception will be catch, then try to read other storage , and if the result is empty, then the exception will be gone. at last client will check the blocks map, found the Inconsistent blocks issue. so am thinking there is exception confuse, some case is not inconsistent blocks issue, just read timeout maybe cased by high load shuffle server. suggest to change the code to raise another exception for this case to void the confuse

+1, you can raise a pr if you have time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsNW6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M4jIa,incubator-uniffle,1289892378,198,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-25T02:28:13Z,2022-10-25T02:28:13Z,"> we also met this error, but in fact it's rpc timeout, when we in compose client mode, the one time read exception will be catch, then try to read other storage , and if the result is empty, then the exception will be gone. at last client will check the blocks map, found the Inconsistent blocks issue. so am thinking there is exception confuse, some case is not inconsistent blocks issue, just read timeout maybe cased by high load shuffle server. suggest to change the code to raise another exception for this case to void the confuse

What you want seems to be implemented in this pr https://github.com/apache/incubator-uniffle/pull/276? Is it right?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M4jIa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M4zEi,incubator-uniffle,1289957666,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-25T04:22:41Z,2022-10-25T04:22:41Z,"> > we also met this error, but in fact it's rpc timeout, when we in compose client mode, the one time read exception will be catch, then try to read other storage , and if the result is empty, then the exception will be gone. at last client will check the blocks map, found the Inconsistent blocks issue. so am thinking there is exception confuse, some case is not inconsistent blocks issue, just read timeout maybe cased by high load shuffle server. suggest to change the code to raise another exception for this case to void the confuse
> 
> 
> 
> What you want seems to be implemented in this pr https://github.com/apache/incubator-uniffle/pull/276? Is it right?

#276 just fix the block inconsistency in multiple replica. I think we just fast fail when encountering rpc timeout in this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M4zEi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hYzAY,incubator-uniffle,1633890328,198,NA,smlHao,3837738,,,NA,2023-07-13T09:28:15Z,2023-07-13T09:28:15Z,"> > > we also met this error, but in fact it's rpc timeout, when we in compose client mode, the one time read exception will be catch, then try to read other storage , and if the result is empty, then the exception will be gone. at last client will check the blocks map, found the Inconsistent blocks issue. so am thinking there is exception confuse, some case is not inconsistent blocks issue, just read timeout maybe cased by high load shuffle server. suggest to change the code to raise another exception for this case to void the confuse
> > 
> > 
> > What you want seems to be implemented in this pr #276? Is it right?
> 
> #276 just fix the block inconsistency in multiple replica. I think we just fast fail when encountering rpc timeout in this issue.

hi, I had meet same error,  my server conf settting rss.storage.type MEMORY_LOCALFILE_HDFS , there is 10 millions records,  spark sql is :  insert into ssb_new.lineorder_partition_sml_parquet_partition9 
select lo_orderkey, lo_linenumber, lo_custkey, 
lo_partkey, lo_suppkey, lo_orderpriority, 
lo_shippriority, lo_quantity, lo_extendedprice, 
lo_ordtotalprice, lo_discount, lo_revenue, 
lo_tax, lo_commitdate, lo_shipmode, lo_supplycost,
lo_orderdate,lo_orderdate  "" +
from ssb_new.lineorder_partition_8 DISTRIBUTE BY lo_orderdate;

Driver logs have Warn log :
                                           2023-07-13 07:02:18,626 [task-result-getter-1] WARN  org.apache.spark.scheduler.TaskSetManager  - Lost task 16.0 in stage 3.0 (TID 949) (182.166.8.117 executor 6): org.apache.uniffle.common.exception.RssException: Failed to read shuffle data from HOT handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:102)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:236)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:162)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:104)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:243)
	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage1.processNext(Unknown Source)
	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)
	at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:760)
	at org.apache.spark.sql.execution.UnsafeExternalRowSorter.sort(UnsafeExternalRowSorter.java:225)
	at org.apache.spark.sql.execution.SortExec.$anonfun$doExecute$1(SortExec.scala:119)
	at org.apache.spark.rdd.RDD.$anonfun$mapPartitionsInternal$2(RDD.scala:890)
	at org.apache.spark.rdd.RDD.$anonfun$mapPartitionsInternal$2$adapted(RDD.scala:890)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:329)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
	at org.apache.spark.scheduler.Task.run(Task.scala:136)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1504)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
	at java.base/java.lang.Thread.run(Unknown Source)
Caused by: org.apache.uniffle.common.exception.RssException: Failed to read in memory shuffle data with ShuffleServerGrpcClient for host[172.100.3.70], port[20000] due to io.grpc.StatusRuntimeException: DEADLINE_EXCEEDED: deadline exceeded after 59.999773883s. [closed=[], committed=[remote_addr=172.100.3.70/172.100.3.70:20000]]
	at org.apache.uniffle.storage.handler.impl.MemoryClientReadHandler.readShuffleData(MemoryClientReadHandler.java:77)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:100)
	... 25 more


There is No FULL GC and  server.out error happened :   警告: Stream Error
io.grpc.netty.shaded.io.netty.handler.codec.http2.Http2Exception$StreamException: Stream closed before write could take place
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.Http2Exception.streamError(Http2Exception.java:172)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.DefaultHttp2RemoteFlowController$FlowState.cancel(DefaultHttp2RemoteFlowController.java:481)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.DefaultHttp2RemoteFlowController$1.onStreamClosed(DefaultHttp2RemoteFlowController.java:105)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.DefaultHttp2Connection.notifyClosed(DefaultHttp2Connection.java:357)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.DefaultHttp2Connection$ActiveStreams.removeFromActiveStreams(DefaultHttp2Connection.java:1007)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.DefaultHttp2Connection$ActiveStreams.deactivate(DefaultHttp2Connection.java:963)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.DefaultHttp2Connection$DefaultStream.close(DefaultHttp2Connection.java:515)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.DefaultHttp2Connection$DefaultStream.close(DefaultHttp2Connection.java:521)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.Http2ConnectionHandler.closeStream(Http2ConnectionHandler.java:613)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.Http2ConnectionHandler.processRstStreamWriteResult(Http2ConnectionHandler.java:894)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.Http2ConnectionHandler.access$1000(Http2ConnectionHandler.java:66)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.Http2ConnectionHandler$4.operationComplete(Http2ConnectionHandler.java:809)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.Http2ConnectionHandler$4.operationComplete(Http2ConnectionHandler.java:806)
	at io.grpc.netty.shaded.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:578)
	at io.grpc.netty.shaded.io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:571)
	at io.grpc.netty.shaded.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:550)
	at io.grpc.netty.shaded.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:491)
	at io.grpc.netty.shaded.io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:616)
	at io.grpc.netty.shaded.io.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:605)
	at io.grpc.netty.shaded.io.netty.util.concurrent.DefaultPromise.trySuccess(DefaultPromise.java:104)
	at io.grpc.netty.shaded.io.netty.util.internal.PromiseNotificationUtil.trySuccess(PromiseNotificationUtil.java:48)
	at io.grpc.netty.shaded.io.netty.channel.ChannelOutboundBuffer.safeSuccess(ChannelOutboundBuffer.java:717)
	at io.grpc.netty.shaded.io.netty.channel.ChannelOutboundBuffer.remove(ChannelOutboundBuffer.java:272)
	at io.grpc.netty.shaded.io.netty.channel.ChannelOutboundBuffer.removeBytes(ChannelOutboundBuffer.java:352)
	at io.grpc.netty.shaded.io.netty.channel.epoll.AbstractEpollStreamChannel.writeBytesMultiple(AbstractEpollStreamChannel.java:305)
	at io.grpc.netty.shaded.io.netty.channel.epoll.AbstractEpollStreamChannel.doWriteMultiple(AbstractEpollStreamChannel.java:510)
	at io.grpc.netty.shaded.io.netty.channel.epoll.AbstractEpollStreamChannel.doWrite(AbstractEpollStreamChannel.java:422)
	at io.grpc.netty.shaded.io.netty.channel.AbstractChannel$AbstractUnsafe.flush0(AbstractChannel.java:949)
	at io.grpc.netty.shaded.io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.flush0(AbstractEpollChannel.java:557)
	at io.grpc.netty.shaded.io.netty.channel.AbstractChannel$AbstractUnsafe.flush(AbstractChannel.java:913)
	at io.grpc.netty.shaded.io.netty.channel.DefaultChannelPipeline$HeadContext.flush(DefaultChannelPipeline.java:1372)
	at io.grpc.netty.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:750)
	at io.grpc.netty.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:742)
	at io.grpc.netty.shaded.io.netty.channel.AbstractChannelHandlerContext.flush(AbstractChannelHandlerContext.java:728)
	at io.grpc.netty.shaded.io.netty.handler.codec.http2.Http2ConnectionHandler.flush(Http2ConnectionHandler.java:189)
	at io.grpc.netty.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:750)
	at io.grpc.netty.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:742)
	at io.grpc.netty.shaded.io.netty.channel.AbstractChannelHandlerContext.flush(AbstractChannelHandlerContext.java:728)
	at io.grpc.netty.shaded.io.netty.channel.DefaultChannelPipeline.flush(DefaultChannelPipeline.java:967)
	at io.grpc.netty.shaded.io.netty.channel.AbstractChannel.flush(AbstractChannel.java:254)
	at io.grpc.netty.shaded.io.grpc.netty.WriteQueue.flush(WriteQueue.java:147)
	at io.grpc.netty.shaded.io.grpc.netty.WriteQueue.access$000(WriteQueue.java:34)
	at io.grpc.netty.shaded.io.grpc.netty.WriteQueue$1.run(WriteQueue.java:46)
	at io.grpc.netty.shaded.io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)
	at io.grpc.netty.shaded.io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:469)
	at io.grpc.netty.shaded.io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:384)
	at io.grpc.netty.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
	at io.grpc.netty.shaded.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.grpc.netty.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)


@zuston @leixm  Hi, I find ShuffleServerNettyHandler.RPC_TIMEOUT  is hard coded by 60000 MILLISECONDS

Do you have ways to find why or slove ?  


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hYzAY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmcNi,incubator-uniffle,1637466978,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-17T06:44:05Z,2023-07-17T06:44:05Z,"The key point is the client request timeout. I think you should check the shuffle-server metric to find out whether the grpc thread pool is enough and grpc blocking queue size is high? 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmcNi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmkEn,incubator-uniffle,1637499175,198,NA,smlHao,3837738,,,NA,2023-07-17T07:13:46Z,2023-07-17T07:13:46Z,"> The key point is the client request timeout. I think you should check the shuffle-server metric to find out whether the grpc thread pool is enough and grpc blocking queue size is high?

@zuston  Hi, Thanks for fast reply !!!  Do you mean check the shuffle-server metric : grpc_server_executor_active_threads and grpc_server_executor_blocking_queue_size ?  need to adjust which key in shuffle-server conf ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmkEn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmlVF,incubator-uniffle,1637504325,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-17T07:18:04Z,2023-07-17T07:18:04Z,Let's see the metric firstly. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmlVF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmnLE,incubator-uniffle,1637511876,198,NA,smlHao,3837738,,,NA,2023-07-17T07:24:21Z,2023-07-17T07:24:21Z,"> Let's see the metric firstly.

ok , I will rerun the sql and check the metrics , thanks !!!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmnLE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmwk_,incubator-uniffle,1637550399,198,NA,smlHao,3837738,,,NA,2023-07-17T07:56:05Z,2023-07-17T07:56:05Z,"> grpc_server_executor_blocking_queue_size

Hi, I rerun the sql, don`t reproduce the error , the metrics dashboard  as  follow:

![image](https://github.com/apache/incubator-uniffle/assets/3837738/fae213bf-3aaa-40d9-bd92-a0399a21a87b)



server.conf  :  
   rss.rpc.server.port 20000
   rss.jetty.http.port 20001
   rss.storage.basePath /app/rss-0.7.1/data
   rss.storage.type MEMORY_LOCALFILE_HDFS
   rss.coordinator.quorum 172.100.3.70:19999,172.100.3.71:19999,172.100.3.72:19999
   rss.server.disk.capacity 50g

   rss.server.flush.thread.alive 5
   rss.server.flush.threadPool.size 10
   rss.server.buffer.capacity 40g
   rss.server.read.buffer.capacity 20g
   rss.server.heartbeat.interval 10000
   rss.rpc.message.max.size 1073741824
   rss.server.preAllocation.expired 120000
   rss.server.commit.timeout 600000
   rss.server.app.expired.withoutHeartbeat 120000
   rss.server.disk.capacity 50g
   rss.server.flush.cold.storage.threshold.size 100g
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmwk_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hnCy7,incubator-uniffle,1637625019,198,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-17T08:48:15Z,2023-07-17T08:48:15Z,"From the dashboard metrics, it looks good. Please attach pictures when this error happens and then ping me. Thanks. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hnCy7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hnGUy,incubator-uniffle,1637639474,198,NA,smlHao,3837738,,,NA,2023-07-17T08:58:35Z,2023-07-17T08:58:35Z,"> From the dashboard metrics, it looks good. Please attach pictures when this error happens and then ping me. Thanks.

@zuston 
ok,I will increase data  and test with same conf setting , see  whether can reproduce the error , if error happend , I will attach pictures. is there other metrics to see ?  thanks !!!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hnGUy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h-Ho6,incubator-uniffle,1643674170,198,NA,smlHao,3837738,,,NA,2023-07-20T10:30:24Z,2023-07-20T10:30:24Z,"> From the dashboard metrics, it looks good. Please attach pictures when this error happens and then ping me. Thanks.

@zuston  hi， when huge table join huge table， shuffle server have blocked threads ， Is it right? 
![image](https://github.com/apache/incubator-uniffle/assets/3837738/44225482-c569-4416-8262-4f3819d84f14)


![image](https://github.com/apache/incubator-uniffle/assets/3837738/df83c9f4-c551-4ae6-b927-ddb061a94b16)

![image](https://github.com/apache/incubator-uniffle/assets/3837738/43c1ec36-67bb-4f93-be3a-c3c20ee81cbb)


the executor have no daemon thread holding and hava no error log
![image](https://github.com/apache/incubator-uniffle/assets/3837738/5bb1b5e0-851c-45d4-9cb3-bb986540a1ff)
![image](https://github.com/apache/incubator-uniffle/assets/3837738/9738ebc4-451f-4e9d-846a-da36d7146668)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h-Ho6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h-N6c,incubator-uniffle,1643699868,198,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-20T10:49:33Z,2023-07-20T10:49:33Z,"> > From the dashboard metrics, it looks good. Please attach pictures when this error happens and then ping me. Thanks.
> 
> @zuston hi， when huge table join huge table， shuffle server have blocked threads ， Is it right? ![image](https://user-images.githubusercontent.com/3837738/254854995-44225482-c569-4416-8262-4f3819d84f14.png)
> 
> ![image](https://user-images.githubusercontent.com/3837738/254855880-df83c9f4-c551-4ae6-b927-ddb061a94b16.png)
> 
> ![image](https://user-images.githubusercontent.com/3837738/254855994-43c1ec36-67bb-4f93-be3a-c3c20ee81cbb.png)
> 
> the executor have no daemon thread holding and hava no error log ![image](https://user-images.githubusercontent.com/3837738/254857254-5bb1b5e0-851c-45d4-9cb3-bb986540a1ff.png) ![image](https://user-images.githubusercontent.com/3837738/254857453-9738ebc4-451f-4e9d-846a-da36d7146668.png)

Could you create a new issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h-N6c/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/198,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h-PmT,incubator-uniffle,1643706771,198,NA,smlHao,3837738,,,NA,2023-07-20T10:53:40Z,2023-07-20T10:53:40Z,"> > > From the dashboard metrics, it looks good. Please attach pictures when this error happens and then ping me. Thanks.
> > 
> > 
> > @zuston hi， when huge table join huge table， shuffle server have blocked threads ， Is it right? ![image](https://user-images.githubusercontent.com/3837738/254854995-44225482-c569-4416-8262-4f3819d84f14.png)
> > ![image](https://user-images.githubusercontent.com/3837738/254855880-df83c9f4-c551-4ae6-b927-ddb061a94b16.png)
> > ![image](https://user-images.githubusercontent.com/3837738/254855994-43c1ec36-67bb-4f93-be3a-c3c20ee81cbb.png)
> > the executor have no daemon thread holding and hava no error log ![image](https://user-images.githubusercontent.com/3837738/254857254-5bb1b5e0-851c-45d4-9cb3-bb986540a1ff.png) ![image](https://user-images.githubusercontent.com/3837738/254857453-9738ebc4-451f-4e9d-846a-da36d7146668.png)
> 
> Could you create a new issue?

ok , thanks !!!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h-PmT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/207,https://api.github.com/repos/apache/incubator-uniffle/issues/207,incubator-uniffle,1366179289,207,Adding Notice file,jerryshao,850797,Jerry Shao,jshao@apache.org,CLOSED,2022-09-08T12:05:21Z,2022-09-14T07:25:42Z,"Notice file is missing in the repo, this should be added like other asf project.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/207/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/209,https://api.github.com/repos/apache/incubator-uniffle/issues/209,incubator-uniffle,1367571021,209,[Feature] Introduce the taskId in the spark client side log,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-09-09T09:45:03Z,2022-09-27T02:24:10Z,"### Motivation
When multiple tasks are running in the same executor at the same time, it will be hard to analysis the rss log belonging to the specified task. To solve this, it's better to make log show task id in the rss client codebase.

### How to do
I think we should directly use the [MDC](https://www.baeldung.com/mdc-in-log4j-2-logback) to put the context info.

### POC screenshot
![image](https://user-images.githubusercontent.com/8609142/189322463-94bfc55b-0082-40aa-828b-88617f43cb28.png)

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/209/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/209,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KA6cU,incubator-uniffle,1241753364,209,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-09T09:47:42Z,2022-09-09T09:47:42Z,What do u think? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KA6cU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/209,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSwtH,incubator-uniffle,1246432071,209,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-14T08:37:17Z,2022-09-14T08:37:17Z,MDC seems heavy for us.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSwtH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/209,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSzjR,incubator-uniffle,1246443729,209,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-14T08:47:25Z,2022-09-14T08:47:25Z,"Could you share me that what are you concerned about most? The cost of refactor or performance?

The  cost of refactor looks easy for me. We just need to inject some infos into MDC which is hold by internal thread local vars. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KSzjR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/209,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KTTVz,incubator-uniffle,1246573939,209,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-14T10:37:22Z,2022-09-14T10:37:22Z,Could we adjust the log4j to print thread ID?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KTTVz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/209,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KTUU-,incubator-uniffle,1246577982,209,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-14T10:40:54Z,2022-09-14T10:40:54Z,"> Could we adjust the log4j to print thread ID?

This way looks a little bit ugly on propagating thread id/ task id in multiple threads when using thread pool.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KTUU-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/209,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KnC_2,incubator-uniffle,1251749878,209,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-20T02:08:34Z,2022-09-20T02:08:34Z,What do u think? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KnC_2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/209,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K-dRX,incubator-uniffle,1257886807,209,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-26T11:27:16Z,2022-09-26T11:27:16Z,"It's a little abstraction for me, maybe you can raise a draft pr and let me look at it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K-dRX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/209,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCP-4,incubator-uniffle,1258880952,209,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-27T02:24:10Z,2022-09-27T02:24:10Z,"> It's a little abstraction for me, maybe you can raise a draft pr and let me look at it.

Yes. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCP-4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/211,incubator-uniffle,1370794300,211,[Feature] User's resources quota,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2022-09-13T03:21:12Z,2022-11-22T02:18:46Z,"At present, we can not limit the user's resources. Maybe we can manually update the number of tasks submitted by the user through a configuration file. When the quota is exceeded, the app will be rejected, and the number of apps of different users can be used to represent resource quotas. What do u think? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/211/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMuvh,incubator-uniffle,1244851169,211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-13T03:28:33Z,2022-09-13T03:28:33Z,"Maybe this could be solved by implementing a custom AccessChecker to limit the users quota, I have done this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMuvh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMvmT,incubator-uniffle,1244854675,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-09-13T03:34:50Z,2022-09-13T03:34:50Z,"At present, the app level is also limited, right?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMvmT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMvw2,incubator-uniffle,1244855350,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-09-13T03:36:01Z,2022-09-13T03:36:01Z,"Because I haven't seen similar PR for the time being, so I create this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMvw2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMwI3,incubator-uniffle,1244856887,211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-13T03:38:48Z,2022-09-13T03:38:48Z,"> At present, the app level is also limited, right?

Yes, I introduce a custom access checker to do following operation
1. Do grey-scale.
2. Add the blacklist for some jobs to fallback ESS.
3. ... 

And so I think the resource quotas limitation could be implemented in custom access checker.

Please let me know If I misunderstand u.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMwI3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMxAe,incubator-uniffle,1244860446,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-09-13T03:45:54Z,2022-09-13T03:45:54Z,"Very coincidentally, our ideas are similar :) .","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMxAe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMzKy,incubator-uniffle,1244869298,211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-13T04:03:59Z,2022-09-13T04:03:59Z,"> Very coincidentally, our ideas are similar :) .

Maybe this is the best practice","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KMzKy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KXt-x,incubator-uniffle,1247731633,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-09-15T08:04:02Z,2022-09-15T08:04:02Z,When will this feature be available? @zuston,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KXt-x/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KXwUD,incubator-uniffle,1247741187,211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-15T08:11:34Z,2022-09-15T08:11:34Z,"I think you misunderstand my thought. I implement the custom access checker to solve the problem you mentioned. You can do similar operations like me. And I think I wont submit this access checker to the uniffle codebase, because maybe it's not  general.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KXwUD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KXymb,incubator-uniffle,1247750555,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-09-15T08:19:09Z,2022-09-15T08:19:09Z,"Well, although I think this may actually have some effect on user isolation, we can try to let users with high priority use more resources. I can understand what you mean.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KXymb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KX10g,incubator-uniffle,1247763744,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-09-15T08:29:28Z,2022-09-15T08:29:28Z,"In fact, we have also achieved it, and completed the launch, the effect is still obvious, the user's resources are effectively managed, and it is easier to calculate the cost of the user's use for billing, so this issue is mentioned.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KX10g/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KuFQV,incubator-uniffle,1253594133,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T11:49:10Z,2022-09-21T11:49:10Z,User quota is ok for us. I think it's the part work of multi-tent user support.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KuFQV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxYsb,incubator-uniffle,1254460187,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-09-22T03:03:26Z,2022-09-22T03:03:26Z,I can raise a pr if needed. @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxYsb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LDHE8,incubator-uniffle,1259106620,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-27T07:36:52Z,2022-09-27T07:36:52Z,"> I can raise a pr if needed. @jerqi

If the pr is large, you could write a design document first.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LDHE8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MCSxi,incubator-uniffle,1275669602,211,NA,Gustfh,4916765,Gus Nie,,NA,2022-10-12T06:42:44Z,2022-10-12T06:42:44Z,"any update? we also have plan to do this. may i ask whats the scope of the quota limit ? is it on single shuffle server ? or for the whole shuffle size. am thinking maybe we can do it as server level quota, so this feature can work with multiple server feature, the shuffle write could write the rest blocks to another server. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MCSxi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MJtGS,incubator-uniffle,1277612434,211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-13T13:26:07Z,2022-10-13T13:26:07Z,"Currently I have no ideas on concrete design. If you want to contribute this feature, it’s better to have a simple design doc for reviewing. @Gustfh 

Do u have some plan to invest this ticket? @smallzhongfeng ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MJtGS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MK_1S,incubator-uniffle,1277951314,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-10-13T17:31:37Z,2022-10-13T17:31:37Z,"In the versions used internally in our company, we use quotas to limit the number of apps that a single user can submit. I don't have much idea about the number of shuffle servers that a single user can use. But I will write a simple document this weekend to discuss whether there are other requirements that can be developed in the future.@jerqi @zuston @Gustfh ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MK_1S/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MUFvH,incubator-uniffle,1280334791,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-10-17T06:07:29Z,2022-10-17T06:07:29Z,"[https://docs.google.com/document/d/1MApSMFQgoS1VAoKbZjomqSRm0iTbSuKG1yvKNlWW65c/edit?usp=sharing](https://docs.google.com/document/d/1MApSMFQgoS1VAoKbZjomqSRm0iTbSuKG1yvKNlWW65c/edit?usp=sharing) If u have time, PTAL @jerqi @zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MUFvH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MUO9v,incubator-uniffle,1280372591,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-17T06:50:27Z,2022-10-17T06:50:27Z,Could you add some diagrams?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MUO9v/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MUT_2,incubator-uniffle,1280393206,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-10-17T07:12:56Z,2022-10-17T07:12:56Z,"OK, I will add later.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MUT_2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MVCDX,incubator-uniffle,1280581847,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-17T09:41:47Z,2022-10-17T09:41:47Z,Could you give us the authority of the `comment`?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MVCDX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MVJcU,incubator-uniffle,1280612116,211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-17T10:06:38Z,2022-10-17T10:06:38Z,"> Could you give us the authority of the `comment`?

+1 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MVJcU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Mf0SX,incubator-uniffle,1283409047,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-10-19T04:28:25Z,2022-10-19T04:28:25Z,"Sorry, I forgot to give you permission, it has been updated.@jerqi @zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Mf0SX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MgNxy,incubator-uniffle,1283513458,211,NA,Gustfh,4916765,Gus Nie,,NA,2022-10-19T06:46:32Z,2022-10-19T06:46:32Z,"so it's user level quota, what if single app produce large shuffle data, then impact other app, for example a app have large shuffle data and also have lots of stage, and running for days, if you enable memory storage, this app's shuffle could live in memory for long times, am wonder should we have a quota for this situation. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MgNxy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MhXOb,incubator-uniffle,1283814299,211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-19T10:55:32Z,2022-10-19T10:55:32Z,"> so it's user level quota, what if single app produce large shuffle data, then impact other app, for example a app have large shuffle data and also have lots of stage, and running for days, if you enable memory storage, this app's shuffle could live in memory for long times, am wonder should we have a quota for this situation.

+1. I think the quota of bytes used by app/hadoop-user also should be involved in the design. And I think the different quota limitation like app-number/storage-bytes could be enabled by user. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MhXOb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsOET,incubator-uniffle,1286660371,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T08:50:51Z,2022-10-21T08:50:51Z,"@smallzhongfeng If you add some extra interfaces, you should describe them in the document.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsOET/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M2g-E,incubator-uniffle,1289359236,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-10-24T17:28:10Z,2022-10-24T17:28:10Z,"> Could you add some diagrams?

I added a simple graphic to illustrate the process of Spark's resource limitation. A more complete pr will be proposed this week.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M2g-E/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M2j-h,incubator-uniffle,1289371553,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-10-24T17:40:47Z,2022-10-24T17:40:47Z,"> so it's user level quota, what if single app produce large shuffle data, then impact other app, for example a app have large shuffle data and also have lots of stage, and running for days, if you enable memory storage, this app's shuffle could live in memory for long times, am wonder should we have a quota for this situation.

This is a good suggestion. I am currently developing it, which may be implemented in the next pr.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M2j-h/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5Ih2,incubator-uniffle,1290045558,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-25T06:25:58Z,2022-10-25T06:25:58Z,"@smallzhongfeng @Gustfh  @zuston Do you want to discuss this issue through a meeting? I will start a meeting to discuss the issue #80, I want to discuss this issue, too. There are some other issues which we need to discuss, so I will send a email to our dev mail list, and select a proper date to start the meeting. You can tell me what time you are free by the email.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5Ih2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-XVE,incubator-uniffle,1291416900,211,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-10-26T02:35:13Z,2022-10-26T02:35:13Z,"Of course, I'm looking forward to it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-XVE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-cto,incubator-uniffle,1291438952,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-26T03:13:19Z,2022-10-26T03:13:19Z,@Gustfh @smallzhongfeng  I have already send an email https://lists.apache.org/thread/2jlm3fswmsxy619ldyo4px700p3ybnvc. Do you have time at 11 am (UTC +8) Thursday this week?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-cto/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-5gI,incubator-uniffle,1291556872,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-26T06:20:55Z,2022-10-26T06:20:55Z,"@smallzhongfeng @Gustfh 

Meeting link is https://meeting.tencent.com/dm/oR95wASCNe91","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-5gI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-8nf,incubator-uniffle,1291569631,211,NA,Gustfh,4916765,Gus Nie,,NA,2022-10-26T06:38:58Z,2022-10-26T06:38:58Z,"ye, we are looking forward to it","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M-8nf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NESAF,incubator-uniffle,1292967941,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-27T04:34:23Z,2022-10-27T04:34:23Z,"Offline Discussion Result:
We should consider the quota of coordinator and the quota of shuffle server .","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NESAF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O2kDf,incubator-uniffle,1322926303,211,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-22T02:18:46Z,2022-11-22T02:18:46Z,close by #311 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O2kDf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/224,https://api.github.com/repos/apache/incubator-uniffle/issues/224,incubator-uniffle,1375452422,224,"[Problem] Fail to init ClientConfManager,dynamic_client.conf is not a file",wfxxh,22764286,wfxxh,not-null@foxmail.com,CLOSED,2022-09-16T06:02:15Z,2022-10-14T05:09:39Z,"I edit the config file as README.

![image](https://user-images.githubusercontent.com/22764286/190567356-e32505c0-e126-4c46-a6cc-1a74f5c15fb4.png)

![image](https://user-images.githubusercontent.com/22764286/190567406-eedc2f0e-6563-4f51-bc0b-9765d368732c.png)

When I start the start Coordinator I get the error
![image](https://user-images.githubusercontent.com/22764286/190567578-35476e61-ee0a-4723-853a-902b0aac7dd4.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/224/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/224,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KcZ4o,incubator-uniffle,1248960040,224,NA,wfxxh,22764286,wfxxh,not-null@foxmail.com,NA,2022-09-16T06:16:11Z,2022-09-16T06:16:11Z,"![image](https://user-images.githubusercontent.com/22764286/190569537-c6b14032-dfe8-4b8a-a292-4a228c37a6dc.png)

It shoud be a hdfs path not a local path","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KcZ4o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/224,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MHPAi,incubator-uniffle,1276964898,224,NA,bigdata-spec,23710717,,,NA,2022-10-13T03:03:04Z,2022-10-13T03:03:04Z,"@wfxxh when I use a hdfs path，there log ：
`[INFO] 2022-10-13 11:00:54,868 main CoordinatorServer main - Start to init coordinator server using config /app/rss/rss/conf/coordinator.conf
[INFO] 2022-10-13 11:00:54,880 main RssUtils getPropertiesFromFile - Load config from /app/rss/rss/conf/coordinator.conf
[INFO] 2022-10-13 11:00:54,955 main CoordinatorServer registerMetrics - Register metrics
[INFO] 2022-10-13 11:00:55,000 main CoordinatorServer registerMetrics - Add metrics servlet
[WARN] 2022-10-13 11:00:55,971 main NativeCodeLoader <clinit> - Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
[INFO] 2022-10-13 11:00:56,225 main ApplicationManager refreshRemoteStorage - Refresh remote storage with hdfs:///tmp/path1,hdfs:///tmp/path2
[ERROR] 2022-10-13 11:00:56,227 main CoordinatorServer <init> - Errors on initializing coordinator server.
java.lang.NullPointerException
        at java.util.concurrent.ConcurrentHashMap.putVal(ConcurrentHashMap.java:1011)
        at java.util.concurrent.ConcurrentHashMap.put(ConcurrentHashMap.java:1006)
        at org.apache.uniffle.coordinator.ApplicationManager.getStorageHost(ApplicationManager.java:278)
        at org.apache.uniffle.coordinator.ApplicationManager.addRemoteStorageMetrics(ApplicationManager.java:263)
        at org.apache.uniffle.coordinator.ApplicationManager.refreshRemoteStorage(ApplicationManager.java:109)
        at org.apache.uniffle.coordinator.ClientConfManager.updateClientConfInternal(ClientConfManager.java:130)
        at org.apache.uniffle.coordinator.ClientConfManager.init(ClientConfManager.java:73)
        at org.apache.uniffle.coordinator.ClientConfManager.<init>(ClientConfManager.java:58)
        at org.apache.uniffle.coordinator.CoordinatorServer.initialization(CoordinatorServer.java:142)
        at org.apache.uniffle.coordinator.CoordinatorServer.<init>(CoordinatorServer.java:61)
        at org.apache.uniffle.coordinator.CoordinatorServer.main(CoordinatorServer.java:79)
`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MHPAi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/224,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MHPhV,incubator-uniffle,1276966997,224,NA,wfxxh,22764286,wfxxh,not-null@foxmail.com,NA,2022-10-13T03:07:01Z,2022-10-13T03:07:01Z,@jiangbiao910 please show your config,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MHPhV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/224,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MNDoJ,incubator-uniffle,1278491145,224,NA,bigdata-spec,23710717,,,NA,2022-10-14T05:09:39Z,2022-10-14T05:09:39Z,"@wfxxh thank you very much，
conf shoud be set  
rss.coordinator.remote.storage.path hdfs://nameservice1/tmp/path1,hdfs://nameservice1/tmp/path2
no 
rss.coordinator.remote.storage.path hdfs:///tmp/path1,hdfs:///tmp/path2
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MNDoJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/228,incubator-uniffle,1377259516,228,"[Problem] Build against Spark 3.2.x,but when I request the Uniffle it does not work,error is ""org.apache.uniffle.com.google.protobuf.GeneratedMessageV3.isStringEmpty(Ljava/lang/Object;)Z""",wfxxh,22764286,wfxxh,not-null@foxmail.com,CLOSED,2022-09-19T01:23:53Z,2022-11-28T03:14:59Z,"I build the Uniffle after read the README, and start the coordnator and shuffle-server success,but when i requset the Uniffle use spark3.2.1, it dose not work ,the error is : org.apache.uniffle.com.google.protobuf.GeneratedMessageV3.isStringEmpty(Ljava/lang/Object;)Z.

when i use the ""rss-client-spark2-0.6.0-snapshot-shaded.jar"" and set spark version to 2.x，it worked.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/228/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KjW6Z,incubator-uniffle,1250782873,228,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2022-09-19T09:26:58Z,2022-09-19T09:26:58Z,What's the build command you used for building Uniffle against spark 3.2.1?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KjW6Z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Km0kl,incubator-uniffle,1251690789,228,NA,wfxxh,22764286,wfxxh,not-null@foxmail.com,NA,2022-09-20T00:01:21Z,2022-09-20T00:01:21Z,"![image](https://user-images.githubusercontent.com/22764286/191139485-e8e4f892-caee-4890-b1d2-4bd55f05685b.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Km0kl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2S4b,incubator-uniffle,1255747099,228,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-23T02:48:30Z,2022-09-23T02:48:30Z,I never met this problem,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2S4b/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N4ICm,incubator-uniffle,1306558630,228,NA,tsface,5295534,yanli,hanily@msn.com,NA,2022-11-08T03:05:15Z,2022-11-08T03:05:15Z,"I had the same problem.
- Compile using community documentation.
- I decompiled the rss-client-spark3-0.6.0-shaded.jar package, and found no `org.apache.uniffle.com.google.protobuf.GeneratedMessageV3.isStringEmpty(Ljava/lang/Object;)Z` method.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N4ICm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N4Nb7,incubator-uniffle,1306580731,228,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-08T03:33:08Z,2022-11-08T03:33:08Z,"> I had the same problem.
> 
> * Compile using community documentation.
> * I decompiled the rss-client-spark3-0.6.0-shaded.jar package, and found no `org.apache.uniffle.com.google.protobuf.GeneratedMessageV3.isStringEmpty(Ljava/lang/Object;)Z` method.

We already shade this jar https://github.com/apache/incubator-uniffle/blob/cf63eae4539264f694760fdf48d882d931ac8e20/client-spark/spark3/pom.xml#L95","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N4Nb7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N4T_N,incubator-uniffle,1306607565,228,NA,tsface,5295534,yanli,hanily@msn.com,NA,2022-11-08T04:16:23Z,2022-11-08T04:16:23Z,"> > I had the same problem.
> > 
> > * Compile using community documentation.
> > * I decompiled the rss-client-spark3-0.6.0-shaded.jar package, and found no `org.apache.uniffle.com.google.protobuf.GeneratedMessageV3.isStringEmpty(Ljava/lang/Object;)Z` method.
> 
> We already shade this jar
> 
> https://github.com/apache/incubator-uniffle/blob/cf63eae4539264f694760fdf48d882d931ac8e20/client-spark/spark3/pom.xml#L95

@jerqi thx!

In version 0.6.0, I specified the `protobuf-java` version as 3.19.2.
Currently, the RSS service is working","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N4T_N/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PF2iG,incubator-uniffle,1326934150,228,NA,a140262,30616687,Melody Yang,,NA,2022-11-25T01:27:17Z,2022-11-25T01:27:17Z,"i am still having the error while running a benchmark application with Spark on k8s Operator. The source code from Uniffle is the latest up to Nov 2022. Please help!

Versions:
RSS version: ""0.7.0-snapshot""
Spark:3.2.0
hadoop-version 3.2.1

Code snippet from my client Dockerfile:
```
# compile RSS client
RUN git clone https://github.com/apache/incubator-uniffle.git /tmp/uniffle
WORKDIR /tmp/uniffle
RUN mvn clean package -Pspark3.2.0 -DskipTests -Dmaven.javadoc.skip=true 
COPY client-spark/spark3/target/shaded/rss-client-spark3-*-shaded.jar  ${SPARK_HOME}/jars/uniffle-rss-client.jar
```

Server side Dockerfile:
```
# compile RSS server
RUN git clone https://github.com/apache/incubator-uniffle.git /tmp/uniffle
WORKDIR /tmp/uniffle
COPY build_distribution.sh .
RUN ./build_distribution.sh --spark3-profile 'spark3.2.0'
```

The error mesage from Spark application logs:
```
22/11/24 13:29:05 DEBUG NettyClientHandler: [id: 0x0364344e, L:/192.168.3.45:57834 - R:rss-coordinator-uniffle-rss-0.uniffle.svc.cluster.local/10.100.241.145:19997] OUTBOUND HEADERS: streamId=89 headers=GrpcHttp2OutboundHeaders[:authority: rss-coordinator-uniffle-rss-0.uniffle.svc.cluster.local:19997, :path: /rss.common.CoordinatorServer/getShuffleAssignments, :method: POST, :scheme: http, content-type: application/grpc, te: trailers, user-agent: grpc-java-netty/1.47.0, grpc-accept-encoding: gzip] streamDependency=0 weight=16 exclusive=false padding=0 endStream=false
    22/11/24 13:29:05 DEBUG NettyClientHandler: [id: 0x0364344e, L:/192.168.3.45:57834 - R:rss-coordinator-uniffle-rss-0.uniffle.svc.cluster.local/10.100.241.145:19997] OUTBOUND RST_STREAM: streamId=89 errorCode=8
    22/11/24 13:30:04 DEBUG PoolingHttpClientConnectionManager: Closing connections idle longer than 60000 MILLISECONDS
    22/11/24 13:30:04 DEBUG PoolingHttpClientConnectionManager: Closing connections idle longer than 60000 MILLISECONDS
    22/11/24 13:30:10 DEBUG NettyClientHandler: [id: 0x0364344e, L:/192.168.3.45:57834 - R:rss-coordinator-uniffle-rss-0.uniffle.svc.cluster.local/10.100.241.145:19997] OUTBOUND HEADERS: streamId=91 headers=GrpcHttp2OutboundHeaders[:authority: rss-coordinator-uniffle-rss-0.uniffle.svc.cluster.local:19997, :path: /rss.common.CoordinatorServer/getShuffleAssignments, :method: POST, :scheme: http, content-type: application/grpc, te: trailers, user-agent: grpc-java-netty/1.47.0, grpc-accept-encoding: gzip] streamDependency=0 weight=16 exclusive=false padding=0 endStream=false
    22/11/24 13:30:10 DEBUG NettyClientHandler: [id: 0x0364344e, L:/192.168.3.45:57834 - R:rss-coordinator-uniffle-rss-0.uniffle.svc.cluster.local/10.100.241.145:19997] OUTBOUND RST_STREAM: streamId=91 errorCode=8
    22/11/24 13:31:04 DEBUG PoolingHttpClientConnectionManager: Closing connections idle longer than 60000 MILLISECONDS
    22/11/24 13:31:04 DEBUG PoolingHttpClientConnectionManager: Closing connections idle longer than 60000 MILLISECONDS
    22/11/24 13:31:15 DEBUG NettyClientHandler: [id: 0x0364344e, L:/192.168.3.45:57834 - R:rss-coordinator-uniffle-rss-0.uniffle.svc.cluster.local/10.100.241.145:19997] OUTBOUND HEADERS: streamId=93 headers=GrpcHttp2OutboundHeaders[:authority: rss-coordinator-uniffle-rss-0.uniffle.svc.cluster.local:19997, :path: /rss.common.CoordinatorServer/getShuffleAssignments, :method: POST, :scheme: http, content-type: application/grpc, te: trailers, user-agent: grpc-java-netty/1.47.0, grpc-accept-encoding: gzip] streamDependency=0 weight=16 exclusive=false padding=0 endStream=false
    22/11/24 13:31:15 ERROR AdaptiveSparkPlanExec: Exception in cancelling query stage: ShuffleQueryStage 23
+- ReusedExchange [c_customer_sk#14226, c_customer_id#14227, c_first_name#14234, c_last_name#14235, c_preferred_cust_flag#14236, c_birth_country#14240, c_login#14241, c_email_address#14242], Exchange hashpartitioning(c_customer_sk#412, 200), ENSURE_REQUIREMENTS, [id=#3167]

    org.apache.uniffle.common.exception.RssException: registerShuffle failed!
	at org.apache.spark.shuffle.RssShuffleManager.registerShuffle(RssShuffleManager.java:328)
	at org.apache.spark.ShuffleDependency.<init>(Dependency.scala:99)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec$.prepareShuffleDependency(ShuffleExchangeExec.scala:395)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.shuffleDependency$lzycompute(ShuffleExchangeExec.scala:173)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.shuffleDependency(ShuffleExchangeExec.scala:167)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.mapOutputStatisticsFuture$lzycompute(ShuffleExchangeExec.scala:143)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.mapOutputStatisticsFuture(ShuffleExchangeExec.scala:139)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeLike.$anonfun$submitShuffleJob$1(ShuffleExchangeExec.scala:68)
	at org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:222)
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
	at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:219)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeLike.submitShuffleJob(ShuffleExchangeExec.scala:68)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeLike.submitShuffleJob$(ShuffleExchangeExec.scala:67)
	at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.submitShuffleJob(ShuffleExchangeExec.scala:115)
	at org.apache.spark.sql.execution.adaptive.ShuffleQueryStageExec.shuffleFuture$lzycompute(QueryStageExec.scala:170)
	at org.apache.spark.sql.execution.adaptive.ShuffleQueryStageExec.shuffleFuture(QueryStageExec.scala:170)
	at org.apache.spark.sql.execution.adaptive.ShuffleQueryStageExec.cancel(QueryStageExec.scala:183)
	at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$cleanUpAndThrowException$1(AdaptiveSparkPlanExec.scala:723)
	at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$cleanUpAndThrowException$1$adapted(AdaptiveSparkPlanExec.scala:718)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:253)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1(TreeNode.scala:254)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreach$1$adapted(TreeNode.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreach(TreeNode.scala:254)
	at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.cleanUpAndThrowException(AdaptiveSparkPlanExec.scala:718)
	at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$getFinalPhysicalPlan$5(AdaptiveSparkPlanExec.scala:265)
	at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$getFinalPhysicalPlan$5$adapted(AdaptiveSparkPlanExec.scala:254)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$getFinalPhysicalPlan$1(AdaptiveSparkPlanExec.scala:254)
	at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:775)
	at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.getFinalPhysicalPlan(AdaptiveSparkPlanExec.scala:226)
	at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.withFinalPlanUpdate(AdaptiveSparkPlanExec.scala:365)
	at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.executeCollect(AdaptiveSparkPlanExec.scala:338)
	at org.apache.spark.sql.Dataset.collectFromPlan(Dataset.scala:3715)
	at org.apache.spark.sql.Dataset.$anonfun$collect$1(Dataset.scala:2971)
	at org.apache.spark.sql.Dataset.$anonfun$withAction$1(Dataset.scala:3706)
	at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$5(SQLExecution.scala:103)
	at org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:163)
	at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$1(SQLExecution.scala:90)
	at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:775)
	at org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:64)
	at org.apache.spark.sql.Dataset.withAction(Dataset.scala:3704)
	at org.apache.spark.sql.Dataset.collect(Dataset.scala:2971)
	at com.databricks.spark.sql.perf.Query.$anonfun$doBenchmark$10(Query.scala:122)
	at com.databricks.spark.sql.perf.Benchmarkable.measureTimeMs(Benchmarkable.scala:114)
	at com.databricks.spark.sql.perf.Benchmarkable.measureTimeMs$(Benchmarkable.scala:112)
	at com.databricks.spark.sql.perf.Query.measureTimeMs(Query.scala:29)
	at com.databricks.spark.sql.perf.Query.doBenchmark(Query.scala:121)
	at com.databricks.spark.sql.perf.Benchmarkable$$anon$1.run(Benchmarkable.scala:78)
Caused by: java.lang.NoSuchMethodError: org.apache.uniffle.com.google.protobuf.GeneratedMessageV3.isStringEmpty(Ljava/lang/Object;)Z
	at org.apache.uniffle.proto.RssProtos$GetShuffleServerRequest.getSerializedSize(RssProtos.java:31666)
	at io.grpc.protobuf.lite.ProtoInputStream.available(ProtoInputStream.java:108)
	at io.grpc.internal.MessageFramer.getKnownLength(MessageFramer.java:205)
	at io.grpc.internal.MessageFramer.writePayload(MessageFramer.java:137)
	at io.grpc.internal.AbstractStream.writeMessage(AbstractStream.java:65)
	at io.grpc.internal.ForwardingClientStream.writeMessage(ForwardingClientStream.java:37)
	at io.grpc.internal.RetriableStream$1SendMessageEntry.runWith(RetriableStream.java:552)
	at io.grpc.internal.RetriableStream.delayOrExecute(RetriableStream.java:529)
	at io.grpc.internal.RetriableStream.sendMessage(RetriableStream.java:556)
	at io.grpc.internal.ClientCallImpl.sendMessageInternal(ClientCallImpl.java:520)
	at io.grpc.internal.ClientCallImpl.sendMessage(ClientCallImpl.java:506)
	at io.grpc.stub.ClientCalls.asyncUnaryRequestCall(ClientCalls.java:317)
	at io.grpc.stub.ClientCalls.futureUnaryCall(ClientCalls.java:227)
	at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:154)
	at org.apache.uniffle.proto.CoordinatorServerGrpc$CoordinatorServerBlockingStub.getShuffleAssignments(CoordinatorServerGrpc.java:829)
	at org.apache.uniffle.client.impl.grpc.CoordinatorGrpcClient.doGetShuffleAssignments(CoordinatorGrpcClient.java:178)
	at org.apache.uniffle.client.impl.grpc.CoordinatorGrpcClient.getShuffleAssignments(CoordinatorGrpcClient.java:248)
	at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.getShuffleAssignments(ShuffleWriteClientImpl.java:410)
	at org.apache.spark.shuffle.RssShuffleManager.lambda$registerShuffle$0(RssShuffleManager.java:316)
	at org.apache.uniffle.common.util.RetryUtils.retry(RetryUtils.java:54)
	at org.apache.uniffle.common.util.RetryUtils.retry(RetryUtils.java:31)
	at org.apache.spark.shuffle.RssShuffleManager.registerShuffle(RssShuffleManager.java:315)
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PF2iG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PF6l3,incubator-uniffle,1326950775,228,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-25T02:10:14Z,2022-11-25T02:10:14Z,@leixm @smallzhongfeng @tsface Is there this problem? Do we need a pr to fix this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PF6l3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PGE0v,incubator-uniffle,1326992687,228,NA,a140262,30616687,Melody Yang,,NA,2022-11-25T03:42:48Z,2022-11-25T03:42:48Z,"the server & coordinator configurations are using the github's [example](https://github.com/apache/incubator-uniffle/blob/master/deploy/kubernetes/operator/examples/configuration.yaml) except my own coordinator and  storage path shown as below, Spark configure is here:
```
apiVersion: ""sparkoperator.k8s.io/v1beta2""
kind: SparkApplication
metadata:
  name: spark-benchmark
spec:
  type: Scala
  mode: cluster
  image: xxxx/uniffle-spark-benchmark:3.2.0
  sparkVersion: 3.2.0
  mainClass: .....
  mainApplicationFile: .....
  arguments:  .....
  sparkConf:
    ""spark.network.timeout"": ""2000s""
    ""spark.executor.heartbeatInterval"": ""300s"" 
    ""spark.serializer"": ""org.apache.spark.serializer.KryoSerializer""
    # Enable RSS
    ""spark.shuffle.manager"": ""org.apache.spark.shuffle.RssShuffleManager""
    ""spark.rss.coordinator.quorum"": ""rss-coordinator-uniffle-rss-0.uniffle.svc.cluster.local:19997,rss-coordinator-uniffle-rss-1.uniffle.svc.cluster.local:19997""
    ""spark.rss.storage.type"": ""MEMORY_LOCALFILE""
    ""spark.rss.remote.storage.path"": ""/rss1/rssdata,/rss2/rssdata""
  driver:
  .....
  executor:
  ...
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PGE0v/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKbCN,incubator-uniffle,1328132237,228,NA,tsface,5295534,yanli,hanily@msn.com,NA,2022-11-26T23:36:05Z,2022-11-26T23:36:05Z,"> @leixm @smallzhongfeng @tsface Is there this problem? Do we need a pr to fix this issue?

@jerqi 
Currently, i have only tested version 0.6.0. 
Like I mentioned above, I just specified the `protobuf-java` version as `3.19.2` in the pom file.

I checked the compile-time log, and I guessed that it was caused by the unspecified version of `protobuf-java` when compiling the shade jar package of the `rss-client-spark3` module.

I can upgrade to the latest version, if the problem still exists, I will try to submit a PR.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKbCN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKgc1,incubator-uniffle,1328154421,228,NA,leixm,31424839,Xianming Lei,,NA,2022-11-27T02:14:22Z,2022-11-27T02:14:22Z,"> > @leixm @smallzhongfeng @tsface Is there this problem? Do we need a pr to fix this issue?
> 
> @jerqi Currently, i have only tested version 0.6.0. Like I mentioned above, I just specified the `protobuf-java` version as `3.19.2` in the pom file.
> 
> I checked the compile-time log, and I guessed that it was caused by the unspecified version of `protobuf-java` when compiling the shade jar package of the `rss-client-spark3` module.
> 
> I can upgrade to the latest version, if the problem still exists, I will try to submit a PR.

You're right, it's a problem, we avoid this problem by excluding protobuf-java in the internal version, like:
`client-spark/spark3/pom.xml`
```xml
        <dependency>
            <groupId>org.apache.spark</groupId>
            <artifactId>spark-core_${scala.binary.version}</artifactId>
            <version>${spark.version}</version>
            <scope>provided</scope>
            <exclusions>
                <exclusion>
                    <groupId>com.google.protobuf</groupId>
                    <artifactId>protobuf-java</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKgc1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKgsC,incubator-uniffle,1328155394,228,NA,leixm,31424839,Xianming Lei,,NA,2022-11-27T02:21:54Z,2022-11-27T02:21:54Z,You can submit a new pr to fix this issue. @tsface ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKgsC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKkA3,incubator-uniffle,1328169015,228,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-27T04:26:44Z,2022-11-27T04:26:44Z,Thanks @tsface @leixm ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKkA3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/228,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PLvxC,incubator-uniffle,1328479298,228,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-28T03:14:59Z,2022-11-28T03:14:59Z,@a140262 The fix pr have been merged into the master branch.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PLvxC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/229,https://api.github.com/repos/apache/incubator-uniffle/issues/229,incubator-uniffle,1377685176,229,Negative value of preAllocatedSize,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-09-19T09:45:08Z,2022-12-27T11:22:29Z,"I found sometimes the value of  `preAllocatedSize` is negative in the shuffle server log, which makes me confused. Maybe this problem is caused by race condition.


![reliao_img_1663580756793](https://user-images.githubusercontent.com/8609142/190991597-67a17de6-6253-4db9-91c4-4e8fddb8816b.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/229/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/229,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KniYU,incubator-uniffle,1251878420,229,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-20T06:02:27Z,2022-09-20T06:02:27Z,It's abnormal. It should be caused by some bugs.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KniYU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/229,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtiC1,incubator-uniffle,1253449909,229,NA,xianjingfeng,11752250,,,NA,2022-09-21T09:32:32Z,2022-09-21T09:32:32Z,"We have found this problem before, and it has not occurred since #159 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtiC1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/229,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtmPi,incubator-uniffle,1253467106,229,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-21T09:48:39Z,2022-09-21T09:48:39Z,"> We have found this problem before, and it has not occurred since #159

#159 has been applied in our internal uniffle cluster, but it still occurred.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtmPi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/229,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Kt00D,incubator-uniffle,1253526787,229,NA,xianjingfeng,11752250,,,NA,2022-09-21T10:45:52Z,2022-09-21T10:45:52Z,"If the `requireBufferId` just expires when writing data, it may occurred. Maybe we need to introduce locks when memory be released.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Kt00D/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/230,https://api.github.com/repos/apache/incubator-uniffle/issues/230,incubator-uniffle,1378763499,230,Possible memory leak in shuffle-server,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-09-20T03:25:22Z,2023-02-02T02:56:59Z,"### Background

I found the metric size of `res`  is too large when using the command of `top` to inspect the shuffle-server process, which has been excluded in the cluster and no app runs on it.

When I dump the jvm heap, I found the heap size is normal. But it has too many netty `PooledUnsafeDirectByteBuf` objects, it this normal?

![image](https://user-images.githubusercontent.com/8609142/191160103-1ee4719d-db81-410d-838f-97b40075ffcf.png)


### Shuffle-server startup Environment
`XMX_SIZE=30g` specified in rss-env.sh
RES using command of top = 55g

![image](https://user-images.githubusercontent.com/8609142/191160294-9ab64262-b63c-4648-a737-de57002fa3c6.png)


We have made the shuffle-servers colocate with the Yarn nodemangers. So we hope the used memory of shuffle-server could be limited by using the JVM options `-XX:MaxDirectMemorySize` or other netty config.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/230/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/230,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KnM2l,incubator-uniffle,1251790245,230,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-20T03:26:47Z,2022-09-20T03:26:47Z,Could u help check whether this is a problem? Or give me some ideas? @jerqi Thanks.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KnM2l/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/230,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsSth,incubator-uniffle,1253124961,230,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T02:20:58Z,2022-09-21T02:20:58Z,Maybe we could remove grpc.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsSth/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/232,https://api.github.com/repos/apache/incubator-uniffle/issues/232,incubator-uniffle,1378912861,232,Minimize required configs to work out of the box,kaijchen,5821159,Kaijie Chen,ckj@apache.org,OPEN,2022-09-20T06:56:05Z,2023-07-25T08:49:49Z,"Provide optimized default values when a field in config file is missing,
so it's easier for inexperienced users to try and experiment with this project.

For example:
If the `rss.storage.type` field is missing , it may defaults to `MEMORY_LOCALFILE_HDFS`.
Currently, it throws `NullPointerException: Name is null`.

In summary, let's try make the default settings work out of the box.
Please refer to how easy it is to setup a single node cluster for HDFS or Spark.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/232/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/232,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsSbE,incubator-uniffle,1253123780,232,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T02:18:44Z,2022-09-21T02:18:44Z,"Ok, we can give more configurations a default value.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsSbE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/232,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtueV,incubator-uniffle,1253500821,232,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-21T10:19:02Z,2022-09-21T10:19:02Z,Make sense ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtueV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/232,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MHikD,incubator-uniffle,1277044995,232,NA,bigdata-spec,23710717,,,NA,2022-10-13T05:20:52Z,2022-10-13T05:20:52Z,"@kaijchen @zuston @jerqi  When I deploy  Coordinator Server from master  , it throws `[ERROR] 2022-10-13 11:22:04,116 main CoordinatorServer <init> - Errors on initializing coordinator server.
java.lang.NullPointerException
        at java.util.concurrent.ConcurrentHashMap.putVal(ConcurrentHashMap.java:1011)
        at java.util.concurrent.ConcurrentHashMap.put(ConcurrentHashMap.java:1006)
        at org.apache.uniffle.coordinator.ApplicationManager.getStorageHost(ApplicationManager.java:278)
        at org.apache.uniffle.coordinator.ApplicationManager.addRemoteStorageMetrics(ApplicationManager.java:263)
        at org.apache.uniffle.coordinator.ApplicationManager.refreshRemoteStorage(ApplicationManager.java:109)
        at org.apache.uniffle.coordinator.ClientConfManager.updateClientConfInternal(ClientConfManager.java:130)
        at org.apache.uniffle.coordinator.ClientConfManager.init(ClientConfManager.java:73)
        at org.apache.uniffle.coordinator.ClientConfManager.<init>(ClientConfManager.java:58)
        at org.apache.uniffle.coordinator.CoordinatorServer.initialization(CoordinatorServer.java:142)
        at org.apache.uniffle.coordinator.CoordinatorServer.<init>(CoordinatorServer.java:61)
        at org.apache.uniffle.coordinator.CoordinatorServer.main(CoordinatorServer.java:79)
` 
How to solve the problem？","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MHikD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/232,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MHsXb,incubator-uniffle,1277085147,232,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-13T06:18:59Z,2022-10-13T06:18:59Z,"Please attach your coordinator.conf file @jiangbiao910 
The conf of `rss.coordinator.dynamicClientConf.enabled` default value is false.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MHsXb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/232,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MNDOl,incubator-uniffle,1278489509,232,NA,bigdata-spec,23710717,,,NA,2022-10-14T05:07:03Z,2022-10-14T05:07:03Z,"@zuston conf shoud be set  
rss.coordinator.remote.storage.path hdfs://nameservice1/tmp/path1,hdfs://nameservice1/tmp/path2
no 
rss.coordinator.remote.storage.path hdfs:///tmp/path1,hdfs:///tmp/path2
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MNDOl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/232,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iT917,incubator-uniffle,1649401211,232,NA,smlHao,3837738,,,NA,2023-07-25T08:49:49Z,2023-07-25T08:49:49Z,"> Ok, we can give more configurations a default value.

@jerqi  Hi,  I have a question ,  there are 3 conf file can set rss.storage.type ， 
         (1) spark-default.conf as uniffle client 
         (2) $RSS_HOME/conf/server.conf
       （3 $RSS_HOME/conf/server.conf
  where can I set the path on hdfs if  rss.storage.type is MEMORY_LOCALFILE_HDFS ?  rss.storage.basePath is  local disk path the shuffle server be deployed ? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iT917/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/233,incubator-uniffle,1379071090,233,[Problem] The shuffle server memory not release,wfxxh,22764286,wfxxh,not-null@foxmail.com,OPEN,2022-09-20T09:05:01Z,2022-09-21T09:48:24Z,"uniffle version: 0.6.0, I deploy on k8s,but the shuffle server  memory not release ,even my spark application is stop it does not release too
my server config is below:
> rss.rpc.server.port 19999
rss.jetty.http.port 19998
rss.rpc.executor.size 2000
rss.storage.type MEMORY_LOCALFILE_HDFS
rss.coordinator.quorum 10.100.41.162:19999
rss.server.disk.capacity 50g
rss.storage.basePath /home/data
rss.server.flush.thread.alive 1
rss.server.flush.threadPool.size 10
rss.server.buffer.capacity 4g
rss.server.read.buffer.capacity 2g
rss.server.heartbeat.timeout 60000
rss.server.heartbeat.interval 10000
rss.rpc.message.max.size 1073741824
rss.server.preAllocation.expired 120000
rss.server.commit.timeout 600000
rss.server.app.expired.withoutHeartbeat 120000
rss.server.flush.cold.storage.threshold.size 128m

![image](https://user-images.githubusercontent.com/22764286/191216608-f04adaca-81fd-4a73-919d-0ea36f0657bc.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/233/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsSMg,incubator-uniffle,1253122848,233,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T02:17:17Z,2022-09-21T02:17:17Z,JVM can occupy the memory although they don't process any data.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsSMg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsS1Q,incubator-uniffle,1253125456,233,NA,wfxxh,22764286,wfxxh,not-null@foxmail.com,NA,2022-09-21T02:21:50Z,2022-09-21T02:21:50Z,"But when the memory is full, the shuffle server pod restart,this case my spark application faild","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsS1Q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsTcs,incubator-uniffle,1253127980,233,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T02:26:46Z,2022-09-21T02:26:46Z,Why do the shuffle server restart? There should be some information in the logs or stdout.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsTcs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsU-A,incubator-uniffle,1253134208,233,NA,wfxxh,22764286,wfxxh,not-null@foxmail.com,NA,2022-09-21T02:38:38Z,2022-09-21T02:38:38Z,"It is restart by k8s, reason is memory is too high.I think if memory release ,it will not be appear","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsU-A/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ksel5,incubator-uniffle,1253173625,233,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T03:59:00Z,2022-09-21T03:59:00Z,"> It is restart by k8s, reason is memory is too high.I think if memory release ,it will not be appear

Maybe we should give more memory to the pod.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ksel5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsuYH,incubator-uniffle,1253238279,233,NA,wfxxh,22764286,wfxxh,not-null@foxmail.com,NA,2022-09-21T05:53:45Z,2022-09-21T05:53:45Z,"It is 32G now,I can not give more ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsuYH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KswGr,incubator-uniffle,1253245355,233,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T06:04:51Z,2022-09-21T06:04:51Z,You can adjust the parameter of memory in the `bin/rss-env.sh` and conf/server.conf.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KswGr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsyQL,incubator-uniffle,1253254155,233,NA,wfxxh,22764286,wfxxh,not-null@foxmail.com,NA,2022-09-21T06:17:00Z,2022-09-21T06:17:00Z,XMX_SIZE ? it is 30G now.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KsyQL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ks_u_,incubator-uniffle,1253309375,233,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T07:23:14Z,2022-09-21T07:23:14Z,"> XMX_SIZE ? it is 30G now.

Could you reduce the value?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ks_u_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtBrD,incubator-uniffle,1253317315,233,NA,wfxxh,22764286,wfxxh,not-null@foxmail.com,NA,2022-09-21T07:31:27Z,2022-09-21T07:31:27Z,I have reduced it to 8G，but the pod restart too,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtBrD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/233,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtmKO,incubator-uniffle,1253466766,233,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T09:48:23Z,2022-09-21T09:48:23Z,"> I have reduced it to 8G，but the pod restart too

Does the server restart because of the same reason? You give the pod 32G memory, XMX_SIZE is 8G, don't it?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KtmKO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/234,incubator-uniffle,1380676907,234,Introduce rejection mechanism when coordinator server is starting,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-09-21T10:11:27Z,2022-10-11T09:49:34Z,"### Background
When changing some coordinator's conf and then restart, coordinator will accept client `getAssignment` request immediately, but it will serve for jobs request based on the partial registered shuffle-servers, which will make some jobs gotten not enough required shuffle-servers and then slow the running speed.

I think we should make coordinator wait for more than one shuffle-server heartbeat interval before serving for client. During out-of-service, requests from client will fallback to slave coordinator.

Besides, I think this rejection mechanism could be enabled by the coordinator conf.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/234/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ktsuh,incubator-uniffle,1253493665,234,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-21T10:12:05Z,2022-09-21T10:12:05Z,PTAL @jerqi,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ktsuh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KuDDy,incubator-uniffle,1253585138,234,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-21T11:40:45Z,2022-09-21T11:40:45Z,How do we judge whether to get enough shuffle servers? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KuDDy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KuUMO,incubator-uniffle,1253655310,234,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-21T12:43:07Z,2022-09-21T12:43:07Z,"> How do we judge whether to get enough shuffle servers?

Wait until reaching the shuffle server heartbeat interval, default 10s","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KuUMO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxR5F,incubator-uniffle,1254432325,234,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-22T02:23:57Z,2022-09-22T02:23:57Z,"> > How do we judge whether to get enough shuffle servers?
> 
> Wait until reaching the shuffle server heartbeat interval, default 10s

Maybe one heartbeat interval is not enough, we can't wait for any servers in special case. How do the yarn resourcemanager to process this problem? I suggest that we should pend the requests instead of rejection when we start the coordinator.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxR5F/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxV7M,incubator-uniffle,1254448844,234,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-22T02:49:02Z,2022-09-22T02:49:02Z,"Got your thought. 

> How do the yarn resourcemanager to process this problem?

In HA resourcemanagers, there is no such problems due to the mechanism of failing back to standby active RM by zookeeper. Let's talk about it in single-one resourcemanager or hadoop namenode. As I know, the namenode will enter in the safe mode when starting it will exit until enough block reports from datanode have been accepted. Refer to : https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html

> I suggest that we should pend the requests instead of rejection when we start the coordinator.

Pending will slow down the apps. I think we should make the request falling back to another coordinator. Maybe the heartbeat interval waiting when starting is a good tradeoff, this will be an indicator whether to exit the safe mode for coordinator.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxV7M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxdYC,incubator-uniffle,1254479362,234,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-22T03:37:27Z,2022-09-22T03:37:27Z,"> Got your thought.
> 
> > How do the yarn resourcemanager to process this problem?
> 
> In HA resourcemanagers, there is no such problems due to the mechanism of failing back to standby active RM by zookeeper. Let's talk about it in single-one resourcemanager or hadoop namenode. As I know, the namenode will enter in the safe mode when starting it will exit until enough block reports from datanode have been accepted. Refer to : https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html
> 
> > I suggest that we should pend the requests instead of rejection when we start the coordinator.
> 
> Pending will slow down the apps. I think we should make the request falling back to another coordinator. Maybe the heartbeat interval waiting when starting is a good tradeoff, this will be an indicator whether to exit the safe mode for coordinator.

It means that we shouldn't restart the two coordinators during the short time. It's a little difficult for K8S controller to select a proper interval to restart them.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxdYC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxwgD,incubator-uniffle,1254557699,234,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-22T05:48:41Z,2022-09-22T05:48:41Z,"Now is the single coordinator process maintained in single POD or shared StatefulSet? If using single POD, it's not a problem. If using the shared statefulset, maybe we should kill single pod which managed by statefuset one by one by operator. 

@wangao1236 Could u help give some background knowledge? 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KxwgD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyK-l,incubator-uniffle,1254666149,234,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-22T08:00:31Z,2022-09-22T08:00:31Z,"> Now is the single coordinator process maintained in single POD or shared StatefulSet? If using single POD, it's not a problem. If using the shared statefulset, maybe we should kill single pod which managed by statefuset one by one by operator.
> 
> @wangao1236 Could u help give some background knowledge?

Coordinator use two deployments.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyK-l/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyLVR,incubator-uniffle,1254667601,234,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-22T08:01:28Z,2022-09-22T08:01:28Z,I think this design is not friendly for automation deployment. It's my doubt.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyLVR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyOic,incubator-uniffle,1254680732,234,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-22T08:13:18Z,2022-09-22T08:13:18Z,"> I think this design is not friendly for automation deployment. It's my doubt.

The coordinator deployment could be controlled to start by operator, this is not the problem. Right?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyOic/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyPg8,incubator-uniffle,1254684732,234,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-22T08:17:09Z,2022-09-22T08:17:09Z,"> > I think this design is not friendly for automation deployment. It's my doubt.
> 
> The coordinator deployment could be controlled to start by operator, this is not the problem. Right?

It's ok for our k8s operator. But if other users use another automation deployment mechanism, it may cause problems.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyPg8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyQuQ,incubator-uniffle,1254689680,234,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-22T08:21:59Z,2022-09-22T08:21:59Z,"> > > I think this design is not friendly for automation deployment. It's my doubt.
> > 
> > 
> > The coordinator deployment could be controlled to start by operator, this is not the problem. Right?
> 
> It's ok for our k8s operator. But if other users use another automation deployment mechanism, it may cause problems.

Got it. Maybe we could disable this mechanism default and add some docs to describe more","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5KyQuQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LB_QY,incubator-uniffle,1258812440,234,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-27T00:18:31Z,2022-09-27T00:18:31Z,Any ideas on this? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LB_QY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCNhi,incubator-uniffle,1258870882,234,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-27T02:08:22Z,2022-09-27T02:08:22Z,"> Any ideas on this? @jerqi

It's ok for me if we disable this mechanism by default. Is it a safe mode for coordinator?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCNhi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCP2T,incubator-uniffle,1258880403,234,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-27T02:23:18Z,2022-09-27T02:23:18Z,Naming is difficult. Safe mode/ Recovery mode?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5LCP2T/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/234,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L9jcD,incubator-uniffle,1274427139,234,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-11T09:49:33Z,2022-10-11T09:49:33Z,Solved in https://github.com/apache/incubator-uniffle/pull/247. Close this issue.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L9jcD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/239,incubator-uniffle,1383237094,239,[Problem] RssUtils#transIndexDataToSegments should consider the length of the data file,leixm,31424839,Xianming Lei,,CLOSED,2022-09-23T03:03:28Z,2022-10-27T06:28:48Z,"Recently, we found that the following exception occurred occasionally in the production environment - `Blocks read inconsistent: expectedxxxxxx`. After investigation, we found that there seem to be some problems with the client's read hdfs.
The following is some information about cluster related configuration and troubleshooting:
Environment
1. rss.client.read.buffer.size=14m
2. storageType=MEMORY_HDFS
3. io.file.buffer.size=65536(core-site.xml on ShuffleServer)


We investigate abnormal partition files to see what ShuffleServer/Client does at various points in time, 
The result is as follows.

1. 2022-09-20 00:45:07 Partition data file creation on hdfs
2. 2022-09-20 00:45:12 End flush the first batch of 1690 blocks and close outputstream, At this point the size of the data file is 63101342
3. 2022-09-20 01:26:56 ShuffleServer append partition data file(second batch)
4. 2022-09-20 01:27:12 ShuffleServer getInMemory returns a total of 310 blocks
5. 2022-09-20 01:27:13 The following exceptions appear in sequence: **Read index data under flow, read data file EOFException(**with offset[58798659], length[4743511]**), and Blocks read inconsistent**, and the task retries four times within 10 seconds or fails, which eventually causes the app attempt to fail
6. 2022-09-20 01:27:37 End flush the remaining 310 blocks and close outputstream

Read segments

1. offset=0, length=14709036
2. offset=14709036, length=14698098
3. offset=29407134, length=14700350
4. offset=44107484, length=14691175
5. offset=58798659, length=4743511

The key point of the problem is that the data file has only 63101342 bytes, but at this time, it has to read 4743511 bytes from the 58798659 offset, which eventually leads to OEFException,And at this time, the block from offset 58798659 to offset 63101342 will be discarded, Eventually lead to block missing.

Another question is, why are there more blocks displayed in the index file than in the data file? This depends on the buffer of the hdfs client. If the data is currently being flushed, we cannot guarantee that the number of blocks in the index is the same as the number of blocks in the data.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/239/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2Utv,incubator-uniffle,1255754607,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T03:06:40Z,2022-09-23T03:06:40Z,Can you take a look at the problem I described. @jerqi @smallzhongfeng  @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2Utv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2WoX,incubator-uniffle,1255762455,239,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-23T03:24:21Z,2022-09-23T03:24:21Z,"> If the data is currently being flushed, we cannot guarantee that the number of blocks in the index is the same as the number of blocks in the data.

@leixm  Yes, you are right. Please refer to #204 . but this PR wont solve your problems you mentioned, it just make fail fast and log some exception for analysis.

Let revisit this problem, as I know, the reading sequence of client will from memory -> localfile to hdfs, that means the incomplete data reading won't affect the result. 

For example, the partial memory shuffle data is being flushed to HDFS or in the flushing queue, it also will get from the read client side. Although the index file in HDFS is incomplete, the partial data has been accepted from memory. So this is not a problem due to block deduplication mechanism.

So the problems you mentioned make me confused, there should be no problem with the design of reading, there may be some bugs.

By the way, I have also encountered inconsistent block problems, but we are using the memory_localfile mode, which is caused by the instability of grpc service, refer to #198 

Feel free to discuss more. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2WoX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2Yvn,incubator-uniffle,1255771111,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T03:48:39Z,2022-09-23T03:48:39Z,"The key point of the problem is that the data file has only 63101342 bytes, but at this time, it has to read 4743511 bytes from the 58798659 offset, which eventually leads to OEFException,And at this time, **the block from offset 58798659 to offset 63101342 will be discarded**, Eventually lead to block missing.
**Any block after offset 63101342 will not cause block missing, and any block before offset 63101342 will cause block missing.**","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2Yvn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2ZTI,incubator-uniffle,1255773384,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T03:55:10Z,2022-09-23T03:55:10Z,"The last read segment contains two parts of blocks, [offset= 58798659, length=4302684] and [offset=63101343, length=440827], because the data in the second part triggers EOFException, causing the data in the first part to be discarded, Eventually lead to block missing.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2ZTI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2Zhb,incubator-uniffle,1255774299,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T03:57:18Z,2022-09-23T03:57:18Z,"org.apache.uniffle.storage.handler.impl.HdfsFileReader#read
```
  public byte[] read(long offset, int length) {
    try {
      fsDataInputStream.seek(offset);
      byte[] buf = new byte[length];
      fsDataInputStream.readFully(buf);
      return buf;
    } catch (Exception e) {
      LOG.warn(""Can't read data for path:"" + path + "" with offset[""
          + offset + ""], length["" + length + ""]"", e);
    }
    return new byte[0];
  }
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2Zhb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2Zyb,incubator-uniffle,1255775387,239,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-23T04:00:39Z,2022-09-23T04:00:39Z,"> org.apache.uniffle.storage.handler.impl.HdfsFileReader#read
> 
> ```
>   public byte[] read(long offset, int length) {
>     try {
>       fsDataInputStream.seek(offset);
>       byte[] buf = new byte[length];
>       fsDataInputStream.readFully(buf);
>       return buf;
>     } catch (Exception e) {
>       LOG.warn(""Can't read data for path:"" + path + "" with offset[""
>           + offset + ""], length["" + length + ""]"", e);
>     }
>     return new byte[0];
>   }
> ```

So we should process EOFException in this case.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2Zyb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2a6r,incubator-uniffle,1255780011,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T04:10:40Z,2022-09-23T04:10:40Z,"![image](https://user-images.githubusercontent.com/31424839/191890674-5d409183-f994-405d-9ca6-0a264ea3e9d0.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2a6r/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2bVQ,incubator-uniffle,1255781712,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T04:14:12Z,2022-09-23T04:14:12Z,"We can get the length of the data file before transIndexDataToSegments and pass it to the transIndexDataToSegments method. When transIndexDataToSegments divides the read segment, Total length cannot exceed the actual length of the data file, so that no OEFException will be generated.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2bVQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2t59,incubator-uniffle,1255857789,239,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-09-23T06:56:30Z,2022-09-23T06:56:30Z,"@leixm Thanks for your explanation, got your thought.

Could we directly get the expected data in `HdfsFileReader.read()` by analyzing the file size and required length from index.file ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K2t59/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K22pk,incubator-uniffle,1255893604,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T07:44:20Z,2022-09-23T07:44:20Z,"You are right, we need to know how much data can be read before HdfsFileReader#read, and then read the corresponding data through HdfsFileReader#read, but how much data can be read is currently obtained by parsing the index file , I think the actual amount of data that can be read needs to be considered in the process of parsing the index file, so as to avoid EOFException. 
Just like the last block in the picture above, when parsing the index file, it is found that there is no such block according to the length of the data file, and this block should not be added to the segment at this time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K22pk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K23Xt,incubator-uniffle,1255896557,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T07:48:06Z,2022-09-23T07:48:06Z,"> @leixm Thanks for your explanation, got your thought.
> 
> Could we directly get the expected data in `HdfsFileReader.read()` by analyzing the file size and required length from index.file ?

@zuston The HdfsFileReader.read method seems to be used to read the file content of the specified offset and length, which is not considered here Sophisticated read logic could be better
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K23Xt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K25Nf,incubator-uniffle,1255904095,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T07:57:15Z,2022-09-23T07:57:15Z,"> Maybe i can raise a pr to fix it? @zuston  

Please go ahead. Thanks in advance ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K25Nf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3Ay3,incubator-uniffle,1255935159,239,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-23T08:30:59Z,2022-09-23T08:30:59Z,Maybe local file will occur this similar problems.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3Ay3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3BBh,incubator-uniffle,1255936097,239,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-09-23T08:32:05Z,2022-09-23T08:32:05Z,"> You are right, we need to know how much data can be read before HdfsFileReader#read, and then read the corresponding data through HdfsFileReader#read, but how much data can be read is currently obtained by parsing the index file , I think the actual amount of data that can be read needs to be considered in the process of parsing the index file, so as to avoid EOFException. Just like the last block in the picture above, when parsing the index file, it is found that there is no such block according to the length of the data file, and this block should not be added to the segment at this time.

Could we catch the EOFException and return the data directly?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3BBh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3FUs,incubator-uniffle,1255953708,239,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T08:52:06Z,2022-09-23T08:52:06Z,"> > You are right, we need to know how much data can be read before HdfsFileReader#read, and then read the corresponding data through HdfsFileReader#read, but how much data can be read is currently obtained by parsing the index file , I think the actual amount of data that can be read needs to be considered in the process of parsing the index file, so as to avoid EOFException. Just like the last block in the picture above, when parsing the index file, it is found that there is no such block according to the length of the data file, and this block should not be added to the segment at this time.
> 
> Could we catch the EOFException and return the data directly?

I will try to test whether the read data is placed in buf after fsDataInputStream.readFully throws an EOFException. If there is data in buf at this time, we can return directly.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3FUs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MrLPG,incubator-uniffle,1286386630,239,NA,leixm,31424839,Xianming Lei,,NA,2022-10-21T02:46:04Z,2022-10-21T02:46:04Z,"> > You are right, we need to know how much data can be read before HdfsFileReader#read, and then read the corresponding data through HdfsFileReader#read, but how much data can be read is currently obtained by parsing the index file , I think the actual amount of data that can be read needs to be considered in the process of parsing the index file, so as to avoid EOFException. Just like the last block in the picture above, when parsing the index file, it is found that there is no such block according to the length of the data file, and this block should not be added to the segment at this time.
> 
> Could we catch the EOFException and return the data directly?

It doesn't seem feasible, because we also need to get the correct bufferSegments, if an EOFEXception is thrown, we don't know which bufferSegments are complete.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MrLPG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MrNhZ,incubator-uniffle,1286395993,239,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T03:02:16Z,2022-10-21T03:02:16Z,"> > > You are right, we need to know how much data can be read before HdfsFileReader#read, and then read the corresponding data through HdfsFileReader#read, but how much data can be read is currently obtained by parsing the index file , I think the actual amount of data that can be read needs to be considered in the process of parsing the index file, so as to avoid EOFException. Just like the last block in the picture above, when parsing the index file, it is found that there is no such block according to the length of the data file, and this block should not be added to the segment at this time.
> > 
> > 
> > Could we catch the EOFException and return the data directly?
> 
> It doesn't seem feasible, because we also need to get the correct bufferSegments, if an EOFEXception is thrown, we don't know which bufferSegments are complete.

I can't get your point. Why don't we know which bufferSegments are complete?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MrNhZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MrTlg,incubator-uniffle,1286420832,239,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T03:46:59Z,2022-10-21T03:46:59Z,"When we encounter EOFException, we have read some index data, we can return the data that we have read.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MrTlg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MrVBC,incubator-uniffle,1286426690,239,NA,leixm,31424839,Xianming Lei,,NA,2022-10-21T03:59:12Z,2022-10-21T03:59:12Z,"> When we encounter EOFException, we have read some index data, we can return the data that we have read.

DataSkippableReadHandler#readShuffleData return ShuffleDataResult, ShuffleDataResult includes two properties, data and bufferSegments, so we will return the block of bufferSegments to be larger than data.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MrVBC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MvsGY,incubator-uniffle,1287569816,239,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-22T01:15:42Z,2022-10-22T01:15:42Z,"> > When we encounter EOFException, we have read some index data, we can return the data that we have read.
> 
> DataSkippableReadHandler#readShuffleData return ShuffleDataResult, ShuffleDataResult includes two properties, data and bufferSegments, so we will return the block of bufferSegments to be larger than data.

ok","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MvsGY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/240,https://api.github.com/repos/apache/incubator-uniffle/issues/240,incubator-uniffle,1383621646,240,Flaky test GetShuffleReportForMultiPartTest,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-09-23T10:48:17Z,2022-09-23T14:19:00Z,"The test is still flaky 
org.apache.uniffle.test.GetShuffleReportForMultiPartTest
https://github.com/apache/incubator-uniffle/actions/runs/3111709653/jobs/5044305025
@leixm Could you take a look at it?
[test-reports-spark3.zip](https://github.com/apache/incubator-uniffle/files/9632979/test-reports-spark3.zip)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/240/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/240,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3jPY,incubator-uniffle,1256076248,240,NA,leixm,31424839,Xianming Lei,,NA,2022-09-23T11:06:05Z,2022-09-23T11:06:05Z,I will follow up on this. @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5K3jPY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/244,https://api.github.com/repos/apache/incubator-uniffle/issues/244,incubator-uniffle,1387001954,244,Flaky Test: CoordinatorGrpcTest.rpcMetricsTest,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-09-27T03:00:49Z,2023-10-20T09:11:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

CoordinatorGrpcTest.rpcMetricsTest

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3126470728/attempts/1

### Parent issue



### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/244/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/244,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L9jPJ,incubator-uniffle,1274426313,244,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-11T09:48:51Z,2022-10-11T09:48:51Z,Closed. Solved in https://github.com/apache/incubator-uniffle/pull/256,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L9jPJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/244,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5poqk2,incubator-uniffle,1772267830,244,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-10-20T08:02:09Z,2023-10-20T08:02:09Z,"There is another test error related to CoordinatorGrpcTest.(https://github.com/apache/incubator-uniffle/actions/runs/6584732533/job/17889841948?pr=1250) I don’t think it is necessary to open another issue. Let’s discuss it here.

```
[INFO] Running org.apache.uniffle.test.CoordinatorGrpcTest
Error:  Tests run: 6, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 23.078 s <<< FAILURE! - in org.apache.uniffle.test.CoordinatorGrpcTest
Error:  rpcMetricsTest  Time elapsed: 1.07 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <true> but was: <false>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertTrue.assertTrue(AssertTrue.java:40)
	at org.junit.jupiter.api.AssertTrue.assertTrue(AssertTrue.java:35)
	at org.junit.jupiter.api.Assertions.assertTrue(Assertions.java:179)
	at org.apache.uniffle.test.CoordinatorGrpcTest.rpcMetricsTest(CoordinatorGrpcTest.java:344)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	...
```

I reproduce this problem when increase ""rss.server.heartbeat.interval"" and sleep before assign oldValue.
We can not guarantee that two more heartbeat. I can only guarantee that two or more heartbeat after wait two shuffle server register.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5poqk2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/257,https://api.github.com/repos/apache/incubator-uniffle/issues/257,incubator-uniffle,1402765221,257,[Bug] No data can be read from ShuffleServer when the reduce task number exceeds 1024,fpkgithub,22984063,aboy,,CLOSED,2022-10-10T08:09:34Z,2022-10-19T02:23:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I run some hive sql , No data can be read from ShuffleServer when the reduce task number exceeds 1024, but sql result State is  SUCCEEDED . At the same time, the sql result count in the original way is inconsistent with that in the uniffle. The relevant logs and codes are as follows.

## Hive Sql


![image](https://user-images.githubusercontent.com/22984063/194813378-acaeb7da-9500-4676-8159-36b1666e1702.png)

## Reduce Task 
reduce task Id <1024
```
2022-10-09 21:22:25,121 INFO [main] org.apache.hadoop.mapred.ReduceTask: Using ShuffleConsumerPlugin: org.apache.hadoop.mapreduce.task.reduce.RssShuffle@533377b
2022-10-09 21:22:28,447 INFO [main] org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient: GetInMemoryShuffleData from 10.156.174.33:19999 for appId[appattempt_1665305651155_5705_000001], shuffleId[0], partitionId[19] cost 329 ms
...
2022-10-09 21:22:28,876 INFO [main] org.apache.uniffle.client.impl.ShuffleReadClientImpl: blockIdBitmap.Size=2293, pendingBlockIds.Size=0, bufferSegmentQueue.Size=0
2022-10-09 21:22:28,878 INFO [main] org.apache.uniffle.client.impl.ShuffleReadClientImpl: Metrics for shuffleId[0], partitionId[19], read data cost 380 ms, copy data cost 0 ms, crc check cost 7 ms
2022-10-09 21:22:28,878 INFO [main] org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler: Client read 2293 blocks [ hot:2293 warm:0 cold:0 frozen:0 ]
2022-10-09 21:22:28,878 INFO [main] org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler: Client read 971918 bytes [ hot:971918 warm:0 cold:0 frozen:0 ]
2022-10-09 21:22:28,878 INFO [main] org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler: Client read 1372670 uncompressed bytes [ hot:1372670 warm:0 cold:0 frozen:0 ]

```

reduce task Id >= 1024
```
2022-09-28 11:46:04,379 INFO [main] org.apache.hadoop.mapred.ReduceTask: Using ShuffleConsumerPlugin: org.apache.hadoop.mapreduce.task.reduce.RssShuffle@10fde30a
2022-09-28 11:46:05,060 INFO [main] org.apache.uniffle.client.impl.ShuffleReadClientImpl: Metrics for shuffleId[0], partitionId[2003], read data cost 0 ms, copy data cost 0 ms, crc check cost 0 ms
2022-09-28 11:46:05,061 INFO [main] org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler: Client read 0 blocks [ hot:0 warm:0 cold:0 frozen:0 ]
2022-09-28 11:46:05,061 INFO [main] org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler: Client read 0 bytes [ hot:0 warm:0 cold:0 frozen:0 ]
2022-09-28 11:46:05,061 INFO [main] org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler: Client read 0 uncompressed bytes [ hot:0 warm:0 cold:0 frozen:0 ]
```

## Client Code
At ShuffleReadClientImpl#readShuffleBlockData, When  reduce task exceed 1024 blockIdBitmap is empty

### org.apache.uniffle.client.impl.ShuffleReadClientImpl#readShuffleBlockData
```java
  @Override
  public CompressedShuffleBlock readShuffleBlockData() {

    LOG.info(""blockIdBitmap.Size="" + blockIdBitmap.getLongCardinality() + "", pendingBlockIds.Size="" + pendingBlockIds.getLongCardinality()
            + "", bufferSegmentQueue.Size="" + bufferSegmentQueue.size());

    // empty data expected, just return null
    if (blockIdBitmap.isEmpty()) {
      LOG.info(""blockIdBitmap empty , so return null ..."");
      return null;
    }

    // All blocks are processed, so just return
    if (pendingBlockIds.isEmpty()) {
      return null;
    }

    // if need request new data from shuffle server
    if (bufferSegmentQueue.isEmpty()) {
      if (read() <= 0) {
        return null;
      }
    }

    // get next buffer segment
    BufferSegment bs = null;

    // blocks in bufferSegmentQueue may be from different partition in range partition mode,
    // or may be from speculation task, filter them and just read the necessary block
   
    ...

    // current segment hasn't data, try next segment
    return readShuffleBlockData();
  }
```

### log
```shell
2022-10-09 21:23:21,530 INFO [org.apache.hadoop.mapreduce.TaskPauseMonitor$Monitor@376a312c] org.apache.hadoop.mapreduce.TaskPauseMonitor: Starting JVM pause monitor
2022-10-09 21:23:21,539 INFO [main] org.apache.hadoop.mapred.ReduceTask: Using ShuffleConsumerPlugin: org.apache.hadoop.mapreduce.task.reduce.RssShuffle@3383649e
2022-10-09 21:23:22,065 INFO [main] org.apache.uniffle.client.impl.ShuffleWriteClientImpl: getShuffleResult#appId=appattempt_1665305651155_5705_000001, shuffleId=0, partitionId=2003, shuffleServerInfoSet.Size=1
2022-10-09 21:23:22,065 INFO [main] org.apache.uniffle.client.impl.ShuffleWriteClientImpl: getShuffleResult#star ss getBlockIdBitmap=10.156.175.32
2022-10-09 21:23:23,799 INFO [main] org.apache.uniffle.client.impl.ShuffleWriteClientImpl: getShuffleResult#10.156.175.32:ss get blockIdBitmapOfServer.Size=0
2022-10-09 21:23:23,799 INFO [main] org.apache.uniffle.client.impl.ShuffleWriteClientImpl: getShuffleResult# break, ss=10.156.175.32
2022-10-09 21:23:23,799 INFO [main] org.apache.uniffle.client.impl.ShuffleWriteClientImpl: getShuffleResult#blockIdBitmap.Size=0
2022-10-09 21:23:23,915 INFO [main] org.apache.uniffle.client.impl.ShuffleReadClientImpl: blockIdBitmap.Size=0, pendingBlockIds.Size=0, bufferSegmentQueue.Size=0
2022-10-09 21:23:23,916 INFO [main] org.apache.uniffle.client.impl.ShuffleReadClientImpl: blockIdBitmap empty , so return null ...
2022-10-09 21:23:23,916 INFO [main] org.apache.uniffle.client.impl.ShuffleReadClientImpl: Metrics for shuffleId[0], partitionId[2003], read data cost 0 ms, copy data cost 0 ms, crc check cost 0 ms
2022-10-09 21:23:23,916 INFO [main] org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler: Client read 0 blocks [ hot:0 warm:0 cold:0 frozen:0 ]
2022-10-09 21:23:23,916 INFO [main] org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler: Client read 0 bytes [ hot:0 warm:0 cold:0 frozen:0 ]
2022-10-09 21:23:23,916 INFO [main] org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler: Client read 0 uncompressed bytes [ hot:0 warm:0 cold:0 frozen:0 ]
```



## ShuffleServer 
At ShuffleTaskManager#getBlockIdsByPartitionId  code logic, By adding log and code analysis
- when reduce task Id(partition) less than 1024, requestPartitions can found contain blockId 
- when reduce task Id(partition) exceed 1024,   requestPartitions cann't found contain blockId 

### org.apache.uniffle.server.ShuffleTaskManager#getBlockIdsByPartitionId
```java
  // filter the specific partition blockId in the bitmap to the resultBitmap
  protected Roaring64NavigableMap getBlockIdsByPartitionId(Set<Integer> requestPartitions,
      Roaring64NavigableMap bitmap, Roaring64NavigableMap resultBitmap) {
    LOG.info(""getBlockIdsByPartitionId# start requestPartitions=""+ requestPartitions.toString()+ "", bitmap.size="" + bitmap.getLongCardinality());
    int findPartitionIdOKCount = 0;
    int findPartitionIdFailCount = 0;
    int partitionNum = Integer.parseInt(requestPartitions.toString().replace(""["", """").replace(""]"", """"));
    LongIterator iter = bitmap.getLongIterator();
    long mask = (1L << Constants.PARTITION_ID_MAX_LENGTH) - 1;
    while (iter.hasNext()) {
      long blockId = iter.next();
      int partitionId = Math.toIntExact((blockId >> Constants.TASK_ATTEMPT_ID_MAX_LENGTH) & mask);
      if (requestPartitions.contains(partitionId)) {
        resultBitmap.addLong(blockId);
        findPartitionIdOKCount++;
      }else{
        findPartitionIdFailCount++;
      }
    }
    LOG.info(""getBlockIdsByPartitionId# end requestPartitions=""+ requestPartitions.toString()
            + "", resultBitmap.size="" + resultBitmap.getLongCardinality()
            + "", findPartitionIdOKCount=""+ findPartitionIdOKCount
            + "", findPartitionIdFailCount="" + findPartitionIdFailCount);
    return resultBitmap;
  }

```

### log

- requestPartitions=[74]  return successful
```
## getShuffleResult
[INFO] 2022-10-09 21:22:26,035 Grpc-512 ShuffleTaskManager getBlockIdsByPartitionId - getBlockIdsByPartitionId# start requestPartitions=[74], bitmap.size=1546249
[INFO] 2022-10-09 21:22:26,063 Grpc-512 ShuffleTaskManager getBlockIdsByPartitionId - getBlockIdsByPartitionId# end requestPartitions=[74], resultBitmap.size=2292, findPartitionIdOKCount=2292, findPartitionIdFailCount=1543957

## getMemoryShuffleData
[INFO] 2022-10-09 21:22:26,465 Grpc-464 ShuffleServerGrpcService getMemoryShuffleData - Successfully getInMemoryShuffleData cost 1 ms with 962828 bytes shuffle data for appId[appattempt_1665305651155_5705_000001], shuffleId[0], partitionId[74]
```

- requestPartitions=[2003] return failed
``` 
[INFO] 2022-10-09 21:23:23,728 Grpc-1478 ShuffleTaskManager getBlockIdsByPartitionId - getBlockIdsByPartitionId# start requestPartitions=[2003], bitmap.size=1546249
[INFO] 2022-10-09 21:23:23,785 Grpc-1478 ShuffleTaskManager getBlockIdsByPartitionId - getBlockIdsByPartitionId# end requestPartitions=[2003], resultBitmap.size=0, findPartitionIdOKCount=0, findPartitionIdFailC
ount=1546249
```





### Affects Version(s)

uniffle:  0.7.0-snapshot
hadoop version: 2.8.4

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

```yaml
## shuffle server config
rss.rpc.server.port 19999
rss.jetty.http.port 19998
rss.rpc.executor.size 2000
# it should be configed the same as in coordinator
rss.storage.type MEMORY_LOCALFILE_HDFS
 
rss.coordinator.quorum coordinator-01:19999,coordinator-02:19999,coordinator-03:19999
 
# local storage path for shuffle server
rss.storage.basePath /mnt/storage00/hadoop/uniffle-ss/rss_data,/mnt/storage01/hadoop/uniffle-ss/rss_data,/mnt/storage02/hadoop/uniffle-ss/rss_data,/mnt/storage03/hadoop/uniffle-ss/rss_data
# it's better to config thread num according to local disk num
rss.server.flush.thread.alive 20 
rss.server.flush.threadPool.size 20
rss.server.buffer.capacity 40gb
rss.server.read.buffer.capacity 20gb
rss.server.heartbeat.timeout 60000
rss.server.heartbeat.interval 10000
rss.rpc.message.max.size 1073741824
rss.server.preAllocation.expired 120000
rss.server.commit.timeout 600000
rss.server.app.expired.withoutHeartbeat 120000
# note: the default value of rss.server.flush.cold.storage.threshold.size is 64m
# there will be no data written to DFS if set it as 100g even rss.storage.type=MEMORY_LOCALFILE_HDFS
# please set proper value if DFS is used, eg, 64m, 128m.
rss.server.flush.cold.storage.threshold.size 64m
 
rss.server.health.check.enable true
rss.server.disk.capacity 400gb
```


### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!


### Reason Cause
org.apache.hadoop.mapreduce.RssMRUtils#getBlockId
```
  public static long getBlockId(int partitionId, long taskAttemptId, int nextSeqNo) {
    long attemptId = taskAttemptId >> (Constants.PARTITION_ID_MAX_LENGTH + Constants.TASK_ATTEMPT_ID_MAX_LENGTH);
    if (attemptId < 0 || attemptId > MAX_ATTEMPT_ID) {
      throw new RuntimeException(""Can't support attemptId ["" + attemptId
          + ""], the max value should be "" + MAX_ATTEMPT_ID);
    }
    long  atomicInt = (nextSeqNo << MAX_ATTEMPT_LENGTH) + attemptId;
    if (atomicInt < 0 || atomicInt > Constants.MAX_SEQUENCE_NO) {
      throw new RuntimeException(""Can't support sequence ["" + atomicInt
          + ""], the max value should be "" + Constants.MAX_SEQUENCE_NO);
    }
    if (partitionId < 0 || partitionId > Constants.MAX_PARTITION_ID) {
      throw new RuntimeException(""Can't support partitionId[""
          + partitionId + ""], the max value should be "" + Constants.MAX_PARTITION_ID);
    }
    long taskId = taskAttemptId - (attemptId
        << (Constants.PARTITION_ID_MAX_LENGTH + Constants.TASK_ATTEMPT_ID_MAX_LENGTH));
    if (taskId < 0 ||  taskId > Constants.MAX_TASK_ATTEMPT_ID) {
      throw new RuntimeException(""Can't support taskId[""
          + taskId + ""], the max value should be "" + Constants.MAX_TASK_ATTEMPT_ID);
    }
    return (atomicInt << (Constants.PARTITION_ID_MAX_LENGTH + Constants.TASK_ATTEMPT_ID_MAX_LENGTH))
        + (partitionId << Constants.TASK_ATTEMPT_ID_MAX_LENGTH) + taskId;
  }
```
BlockId = atomicInt + partitionId + taskAttemptId,
BlockId Length = ATOMIC_INT_MAX_LENGTH + PARTITION_ID_MAX_LENGTH + TASK_ATTEMPT_ID_MAX_LENGTH = 18+24+21 =63

**partitionId type is int**
int partitionId is 32 bit, when partitionId >=1024, partitionId << Constants.TASK_ATTEMPT_ID_MAX_LENGTH will overflow(11+21>=32)

partitionId = 1022 = 1111111110（10 bit）
partitionId = 1023 = 1111111111（10 bit）
partitionId = 1024 = 10000000000（11 bit）
...

so we should change partitionId type to long(64 bit)


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/257/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/257,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L4An4,incubator-uniffle,1272973816,257,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-10T08:40:48Z,2022-10-10T08:40:48Z,cc @leixm Could you help me take a look at this issue.  PR https://github.com/apache/incubator-uniffle/pull/190 modify this place's logic.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L4An4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/257,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L4CRB,incubator-uniffle,1272980545,257,NA,leixm,31424839,Xianming Lei,,NA,2022-10-10T08:46:04Z,2022-10-10T08:46:04Z,I will follow up on this. @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L4CRB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/257,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L4DBc,incubator-uniffle,1272983644,257,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-10T08:48:22Z,2022-10-10T08:48:22Z,"> I will follow up on this. @jerqi

@fpkgithub seems  that he has found solution to fix this issue. If you have time, you can help me review his pr.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L4DBc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/257,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L4H89,incubator-uniffle,1273003837,257,NA,fpkgithub,22984063,aboy,,NA,2022-10-10T09:04:23Z,2022-10-10T09:04:23Z,"> > I will follow up on this. @jerqi
> 
> @fpkgithub seems that he has found solution to fix this issue. If you have time, you can help me review his pr.

Sure, I've been looking at this logic recently

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5L4H89/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/263,incubator-uniffle,1408690563,263,[Improvement] Introduce statestore of shuffle-server for upgrading quickly,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-10-14T03:11:27Z,2022-11-08T10:55:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the cluster of shuffle-servers is hard to update quickly. In the on-premise deployment, we have to write the custom ansible playbook to do rolling update, and the upgrading process is too long.

The rolling update process has two steps:
1. Add the exclude shuffle-servers id into exclude node file which should be recognized by coordinator and no long assigned
2. Waiting the all apps to finished in these excluded shuffle-servers.

Because the shutdown of shuffle-server will lose all app state and cleanup the datafile, we have to handle with care. 

If we could store the all state into levelDB or rockdb or localfile(Like Yarn Nodemanager), maybe it will benefit for us to restart quickly and wont make app fail.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/263/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MMxb7,incubator-uniffle,1278416635,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-14T03:13:34Z,2022-10-14T03:13:34Z,"@jerqi @frankliee @colinmjj @kaijchen Feel free to discuss more. I met such problems in our internal uniffle upgrading, so propose this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MMxb7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MNQ8o,incubator-uniffle,1278545704,263,NA,frankliee,10219731,,885626704@qq.com,NA,2022-10-14T06:31:16Z,2022-10-14T06:31:16Z,"Besides from state store, we also need to wait the shuffle servers to flush their memory data to local or hdfs files","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MNQ8o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MReO3,incubator-uniffle,1279648695,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-15T03:45:54Z,2022-10-15T03:45:54Z,"> Besides from state store, we also need to wait the shuffle servers to flush their memory data to local or hdfs files

Yes, this should be involved in design. Besides, the client should wait instead of connection failure when the corresponding server is restarting.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MReO3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MUOpu,incubator-uniffle,1280371310,263,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-17T06:48:43Z,2022-10-17T06:48:43Z,It will bring much complexity.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MUOpu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MU-Ex,incubator-uniffle,1280565553,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-17T09:33:12Z,2022-10-17T09:33:12Z,"> It will bring much complexity.

Currently, it will cost several days to rolling update the shuffle-server. The cluster number is now 200+. This limits our rapid development and upgrade. 

Could u share some experience about tencent upgrade solutions?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MU-Ex/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MVA8X,incubator-uniffle,1280577303,263,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-17T09:38:54Z,2022-10-17T09:38:54Z,"> > It will bring much complexity.
> 
> Currently, it will cost several days to rolling update the shuffle-server. The cluster number is now 200+. This limits our rapid development and upgrade.
> 
> Could u share some experience about tencent upgrade solutions?

We have fewer nodes because our shuffle server occupy the entire machine. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MVA8X/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MVCj2,incubator-uniffle,1280583926,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-17T09:43:32Z,2022-10-17T09:43:32Z,"> > > It will bring much complexity.
> > 
> > 
> > Currently, it will cost several days to rolling update the shuffle-server. The cluster number is now 200+. This limits our rapid development and upgrade.
> > Could u share some experience about tencent upgrade solutions?
> 
> We have fewer nodes because our shuffle server occupy the entire machine.

Got it. We will expand the cluster to 500+ in the future. So the upgrade is the big problem for us.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MVCj2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MZlu6,incubator-uniffle,1281776570,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-18T03:47:52Z,2022-10-18T03:47:52Z,Does the Uniffle community need this feature? @jerqi @frankliee ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MZlu6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MbUiY,incubator-uniffle,1282230424,263,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-18T11:23:00Z,2022-10-18T11:23:00Z,It's useful feature but it's a little complex. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MbUiY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MhUdT,incubator-uniffle,1283802963,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-19T10:45:36Z,2022-10-19T10:45:36Z,I think the complexity is acceptable compared to the ease of upgrading it brings,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MhUdT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsOwG,incubator-uniffle,1286663174,263,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T08:53:24Z,2022-10-21T08:53:24Z,"OK, I think it's more convenient that we shutdown the shuffle servers for a period of time. All the applications use ess , we upgrade all the shuffle servers, we let  the applications use the rss again.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsOwG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsS3I,incubator-uniffle,1286680008,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-21T09:08:50Z,2022-10-21T09:08:50Z,"> OK, I think it's more convenient that we shutdown the shuffle servers for a period of time. All the applications use ess , we upgrade all the shuffle servers, we let the applications use the rss again.

Emm... I practiced by your way and it also have to wait all apps finished which will cost 1 Days(due to some ML jobs). 

Besides In our co-location environment(Uniffle ShuffleServer on NodeManager), this is acceptable and I introduce the safemode to reject all newer assignment from newly app in our internal uniffle version.

But if the spark job is running on the k8s pod of less local disk or no ESS, how to upgrade? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsS3I/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsUdJ,incubator-uniffle,1286686537,263,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T09:15:05Z,2022-10-21T09:15:05Z,"> > OK, I think it's more convenient that we shutdown the shuffle servers for a period of time. All the applications use ess , we upgrade all the shuffle servers, we let the applications use the rss again.
> 
> Emm... I practiced by your way and it also have to wait all apps finished which will cost 1 Days(due to some ML jobs).
> 
> Besides In our co-location environment(Uniffle ShuffleServer on NodeManager), this is acceptable and I introduce the safemode to reject all newer assignment from newly app in our internal uniffle version.
> 
> But if the spark job is running on the k8s pod of less local disk or no ESS, how to upgrade?

You're right. StateStore is useful. But if you does some poc, it have great effective, or you use this feature in your environment, it's acceptable. This feature is a big feature, we should be careful. It might be more suitable to merge this feature when Uniffle are more stable.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsUdJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsXlv,incubator-uniffle,1286699375,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-21T09:27:08Z,2022-10-21T09:27:08Z,"Agree with u about its big change. So I revisit this problem do we really need a statestore? Make a big change just for upgrading? Actually the shuffle-servers' state only be valid in short period which depends on jobs lifetime.

So I think we only need a mechanism  triggered by external call to let shuffle-server dump all its state to localfile/leveldb. After that, the shuffle-server could be restarted and recover from external localfile state. This change may be not big and acceptable.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MsXlv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MtcOz,incubator-uniffle,1286980531,263,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-21T13:43:04Z,2022-10-21T13:43:04Z,"> Agree with u about its big change. So I revisit this problem do we really need a statestore? Make a big change just for upgrading? Actually the shuffle-servers' state only be valid in short period which depends on jobs lifetime.
> 
> So I think we only need a mechanism triggered by external call to let shuffle-server dump all its state to localfile/leveldb. After that, the shuffle-server could be restarted and recover from external localfile state. This change may be not big and acceptable.

More reasonable. But if we need a extra api for shuffle server,  we should consider it with https://github.com/apache/incubator-uniffle/issues/80","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MtcOz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NqACQ,incubator-uniffle,1302855824,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-04T01:40:55Z,2022-11-04T01:40:55Z,"I think I will take this issue that dumping all state when shuffle-server is triggered by external call. If you don't have any idea, I will go ahead and propose a design. @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NqACQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NqEP4,incubator-uniffle,1302873080,263,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-04T02:16:33Z,2022-11-04T02:16:33Z,"I hope the behavior can be managed by our admin api, you can go ahead with your plan, but please make compatible design with admin api.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NqEP4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N5ykF,incubator-uniffle,1306994949,263,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-08T10:37:38Z,2022-11-08T10:37:38Z,"I think the shuffle-server will follow the next steps when upgrading

### Dump and stop
1. Stop the grpc server to avoid extra data sent or got (client will have to hold on waiting and retry due to the connection refused failure)
2. Make its state unhealthy, which should be recognized by coordinator to avoid extra assignments
3. Dumping all state to file

### Restore
1. Restore state from the file
2. Start the grpc server to be in service

I want to use `kryo` to serialize the partial state into file, and then recover from it. Do you have some good ideas on it? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N5ykF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/263,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N53pO,incubator-uniffle,1307015758,263,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-08T10:55:18Z,2022-11-08T10:55:18Z,"> I think the shuffle-server will follow the next steps when upgrading
> 
> ### Dump and stop
> 1. Stop the grpc server to avoid extra data sent or got (client will have to hold on waiting and retry due to the connection refused failure)
> 2. Make its state unhealthy, which should be recognized by coordinator to avoid extra assignments
> 3. Dumping all state to file
> 
> ### Restore
> 1. Restore state from the file
> 2. Start the grpc server to be in service
> 
> I want to use `kryo` to serialize the partial state into file, and then recover from it. Do you have some good ideas on it? @jerqi

You should also consider timeout of heartbeat will delete the shuffle. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N53pO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/273,https://api.github.com/repos/apache/incubator-uniffle/issues/273,incubator-uniffle,1414868913,273,[Bug] Get shuffle result failed caused by concurrent calls to registerShuffle,leixm,31424839,Xianming Lei,,CLOSED,2022-10-19T12:17:26Z,2022-10-21T08:15:03Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The registerShuffle interface of ShuffleServer receives an empty remoteStoragePath, which eventually causes getShuffleResult to fail.

What is even more strange is that the registration of the same shuffle needs to be registered with a total of 15 ShuffleServers, and **only one ShuffleServer has an empty remoteStoragePath passed in**.

**Why does ShuffleServer receive an empty remoteStoragePath?**
org.apache.spark.shuffle.RssShuffleManager#registerShuffle will set the path in remoteStorage to an empty string(as below code), In a concurrent scenario, one thread is setting remoteStorage to an empty string, and another thread is using remoteStorage, which will eventually cause getShuffleResult to fail.
`remoteStorage = new RemoteStorageInfo(sparkConf.get(RssSparkConfig.RSS_REMOTE_STORAGE_PATH.key(), """"));`

getShuffleResult exception stack:
```
[ERROR] 2022-10-19 02:59:51,672 Grpc-997 HdfsStorageManager getStorageByAppId - Can't find HDFS storage for appId[application_1664275719770_10420755_1666119585202]
[ERROR] 2022-10-19 02:59:51,672 Grpc-997 ShuffleServerGrpcService getShuffleResult - Error happened when get shuffle result for appId[application_1664275719770_10420755_1666119585202], shuffleId[4], partitionId[13]
java.lang.NullPointerException
        at org.apache.uniffle.server.ShuffleTaskManager.getFinishedBlockIds(ShuffleTaskManager.java:281)
        at org.apache.uniffle.server.ShuffleServerGrpcService.getShuffleResult(ShuffleServerGrpcService.java:361)
        at org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:923)
        at io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        at io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        at io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        at io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:352)
        at io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:866)
        at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:745)
        
```

### Affects Version(s)

0.6.0

### Uniffle Server Log Output

```logtalk
Abnormal ShuffleServer:
[INFO] 2022-10-19 02:59:46,066 Grpc-215 ShuffleServerGrpcService registerShuffle - Get register request for appId[application_1664275719770_10420755_1666119585202], shuffleId[4], remoteStorage[] with 66 partition ranges

Normal ShuffleServer:
[INFO] 2022-10-19 02:59:47,385 Grpc-974 ShuffleServerGrpcService registerShuffle - Get register request for appId[application_1664275719770_10420755_1666119585202], shuffleId[4], remoteStorage[hdfs://xxxxxxx/tmp/rss/shuffle_data] with 67 partition ranges
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/273/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MhxOa,incubator-uniffle,1283920794,273,NA,leixm,31424839,Xianming Lei,,NA,2022-10-19T12:18:04Z,2022-10-19T12:18:04Z,@zuston  @jerqi  Can you help take a look at this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MhxOa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MlKeo,incubator-uniffle,1284810664,273,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-10-20T02:10:53Z,2022-10-20T02:10:53Z,"Nice catch. 

If the `registerShuffle` was called in driver concurrently, the exception will happen. I think the lifecycle of `remoteStorage` var could be scoped in the method of `registerShuffle`. Right? @leixm ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MlKeo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MlWlI,incubator-uniffle,1284860232,273,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-20T03:19:36Z,2022-10-20T03:19:36Z,Good catch.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MlWlI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MlmOS,incubator-uniffle,1284924306,273,NA,leixm,31424839,Xianming Lei,,NA,2022-10-20T04:57:18Z,2022-10-20T04:57:18Z,"> Nice catch.
> 
> If the `registerShuffle` was called in driver concurrently, the exception will happen. I think the lifecycle of `remoteStorage` var could be scoped in the method of `registerShuffle`. Right? @leixm

Yes, you are right.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5MlmOS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/277,https://api.github.com/repos/apache/incubator-uniffle/issues/277,incubator-uniffle,1420543512,277,[FEATURE] Add Dutch language support to website,hursittarcan,75273616,Hursit Tarcan,,CLOSED,2022-10-24T09:42:32Z,2023-12-25T18:03:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

I would love to contribute to this project by translating the website to Dutch. 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/277/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/278,https://api.github.com/repos/apache/incubator-uniffle/issues/278,incubator-uniffle,1421775888,278,[Improvement] Filter blocks by `taskIdBitmap` before read shuffle data,xianjingfeng,11752250,,,CLOSED,2022-10-25T03:14:16Z,2022-10-25T07:12:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

I found that when we use AQE, every task will read data from all partitions, and just filter blocks by `taskIdBitmap` only when processing data files, it will lead to read redundant data from suffle server.

### How should we improve?

Filter blocks by `taskIdBitmap` before read shuffle data

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/278/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/278,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M4qhg,incubator-uniffle,1289922656,278,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-10-25T03:19:18Z,2022-10-25T03:19:18Z,I already have this optimization. https://github.com/apache/incubator-uniffle/blob/47effb25044780013ff51cc516261464435b5829/client/src/main/java/org/apache/uniffle/client/impl/ShuffleReadClientImpl.java#L101,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M4qhg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/278,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5P_R,incubator-uniffle,1290076113,278,NA,xianjingfeng,11752250,,,NA,2022-10-25T07:01:08Z,2022-10-25T07:01:08Z,"Well, but there are similar problems with reading from memory storage. I  want to solve it with #129 together.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5M5P_R/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/279,https://api.github.com/repos/apache/incubator-uniffle/issues/279,incubator-uniffle,1421935315,279,Flaky Test: ClientConfManagerHdfsTest,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2022-10-25T06:35:50Z,2023-01-29T11:11:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 18.644 s <<< FAILURE! - in org.apache.uniffle.test.ClientConfManagerHdfsTest
Error:  test  Time elapsed: 17.917 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <abc> but was: <null>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:182)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:177)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:1141)
	at org.apache.uniffle.test.ClientConfManagerHdfsTest.createAndRunClientConfManagerCases(ClientConfManagerHdfsTest.java:86)
	at org.apache.uniffle.test.ClientConfManagerHdfsTest.test(ClientConfManagerHdfsTest.java:46)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4036194515/jobs/6938623599#step:6:3189

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/279/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/279,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5sco,incubator-uniffle,1407633192,279,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-29T11:11:33Z,2023-01-29T11:11:33Z,Looks like it's caused by arbitrary `Thread.sleep()`.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5sco/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/282,https://api.github.com/repos/apache/incubator-uniffle/issues/282,incubator-uniffle,1425172852,282,[FEATURE]  Add a period local storage cleaner thread ,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-10-27T07:35:52Z,2022-11-25T13:24:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Because we don't use strict lock strategy, we will delete some shuffle data normally. If we use strict lock strategy, the performance will be bad. So we want to add  a period local storage cleaner thread.  The thread examine which application is in the disk and judge whether the app exists the memory data structure `ShuffleTaskManager#shuffleTaskInfos`. If memory data structure don't exist, we will delete the data in the disk.

### Motivation

Reduce the garbage data. The data won't be deleted unless the shuffle server is restarted.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/282/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/282,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NJefi,incubator-uniffle,1294329826,282,NA,sfwang218,16055211,,wangshifa@58.com,NA,2022-10-28T01:57:57Z,2022-10-28T01:57:57Z,Could you assign this issue to me? I want to try,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NJefi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/282,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrWRL,incubator-uniffle,1319986251,282,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-18T13:20:09Z,2022-11-18T13:20:09Z,"@sfwang218 Will you continue this issue? If you need some help, I'm pleased to give you a hand.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrWRL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/282,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OzVlE,incubator-uniffle,1322080580,282,NA,sfwang218,16055211,,wangshifa@58.com,NA,2022-11-21T13:39:10Z,2022-11-21T13:39:10Z,"> @sfwang218 Will you continue this issue? If you need some help, I'm pleased to give you a hand.

Sorry, I'm busy recently, Could you give me some suggestion? I will do it this week.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OzVlE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/282,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Oz0MF,incubator-uniffle,1322205957,282,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-21T15:08:13Z,2022-11-21T15:08:13Z,"We can modify the ShuffleTaskManger and LocalStorageManager to implement this function.
For ShuffleTaskManager, you can see  the method `removeResourcesByShuffleIds`, we can refer to it and then add a daemon thread.
For LocalStorageManager, you can add a interface `checkLeakShuffleData(Collection<String> appIds)` for StorageManager. LocalStorageManager implement this interface.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Oz0MF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/282,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O5fMv,incubator-uniffle,1323692847,282,NA,sfwang218,16055211,,wangshifa@58.com,NA,2022-11-22T13:38:05Z,2022-11-22T13:38:05Z,"> We can modify the ShuffleTaskManger and LocalStorageManager to implement this function. For ShuffleTaskManager, you can see the method `removeResourcesByShuffleIds`, we can refer to it and then add a daemon thread. For LocalStorageManager, you can add a interface `checkLeakShuffleData(Collection<String> appIds)` for StorageManager. LocalStorageManager implement this interface.

I think this way does not work, because the appId is a already removed from memory data structure ShuffleTaskManager#shuffleTaskInfos, and we can only parse the appid from the Storage file directory,
and then Compare with ShuffleTaskManager#shuffleTaskInfos.
I'm doing it in this way.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O5fMv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/282,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O5tiG,incubator-uniffle,1323751558,282,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-22T14:19:22Z,2022-11-22T14:19:22Z,"



> > We can modify the ShuffleTaskManger and LocalStorageManager to implement this function. For ShuffleTaskManager, you can see the method `removeResourcesByShuffleIds`, we can refer to it and then add a daemon thread. For LocalStorageManager, you can add a interface `checkLeakShuffleData(Collection<String> appIds)` for StorageManager. LocalStorageManager implement this interface.
> 
> I think this way does not work, because the appId is a already removed from memory data structure ShuffleTaskManager#shuffleTaskInfos, and we can only parse the appid from the Storage file directory, and then Compare with ShuffleTaskManager#shuffleTaskInfos. I'm doing it in this way.

Yes, you're right.
You should pass current memory appIds to storageManager by a method `checkLeakShuffleData(Collection<String> appIds)`, storageManager check disks and parse disk appIds. and then storagemanager compare disk appIds and memory appIds. StorageManager remove disk appIds which don't exist in memory appIds.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O5tiG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/283,https://api.github.com/repos/apache/incubator-uniffle/issues/283,incubator-uniffle,1425205925,283,[FEATURE] Support snappy,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-10-27T08:03:05Z,2022-11-06T07:33:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support snappy to de/compress shuffle-data

### Motivation

The issue of #189 has introduce the abstract interface to support more codecs to match more requirements. This issue is to support snappy.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/283/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/283,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NxFgO,incubator-uniffle,1304713230,283,NA,amaliujia,1938382,Rui Wang,,NA,2022-11-06T04:36:11Z,2022-11-06T04:36:11Z,Proposing a PR for this issue: https://github.com/apache/incubator-uniffle/pull/304,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NxFgO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/285,https://api.github.com/repos/apache/incubator-uniffle/issues/285,incubator-uniffle,1426521389,285,[Improvement] Only Use HDFS and LOCALFILE storageType in the test,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-10-28T02:23:46Z,2022-11-29T14:58:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

HDFS and LOCALFILE storageType have poor performance, but they are useful for tests. We don't recommend to use them.

### How should we improve?

We add a config option `rss.test.mode.enable`, default value is false. When we use HDFS or LOCALFILE storageType in the client or shuffle server, we should throw an exception if `rss.test.mode.enable` is false.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/285/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/286,https://api.github.com/repos/apache/incubator-uniffle/issues/286,incubator-uniffle,1426527331,286,[FEATURE] MR support slow start,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2022-10-28T02:29:12Z,2023-04-04T01:47:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, MR on RSS don't support slow start. We can support this feature.

### Motivation

Slow start will improve performance. For 1T terasort, 1w map, 1k reduce, the feature will improve 13% performance.

### Describe the solution

Remove the logic that we forbid the slow start.
Modify the logic of reduce, let reduce can fetch the meta data multiple times. The related logic is in the class `RssEventFetcher`
A big question is how to avoid reading too much duplicate data.

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/286/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/286,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZFuGr,incubator-uniffle,1494671787,286,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-04-03T16:59:45Z,2023-04-03T16:59:45Z,"Is this an important issue ?
And How Spark support 'non-slow start' ?
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZFuGr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/286,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZH0t0,incubator-uniffle,1495223156,286,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-04T01:47:47Z,2023-04-04T01:47:47Z,"> Is this an important issue ? And How Spark support 'non-slow start' ?

It's important issue for MR. Origin Spark don't support slow start.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZH0t0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/287,https://api.github.com/repos/apache/incubator-uniffle/issues/287,incubator-uniffle,1426583425,287,[Improvement] Add k8s Operator pipeline,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-10-28T03:13:12Z,2022-11-18T13:10:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

K8S Operator is complete, but we don't have the pipeline to run the test

### How should we improve?

The pipeline configuration is in the https://github.com/apache/incubator-uniffle/tree/master/.github/workflows
If you want to run the operator tests, you can run
mvn package -Pkubernetes


### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/287/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/288,https://api.github.com/repos/apache/incubator-uniffle/issues/288,incubator-uniffle,1426584846,288,[FEATURE]  Operator support PVC,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-10-28T03:14:22Z,2024-06-20T02:17:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Operator support PVC

### Motivation

More flexible

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/288/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/289,https://api.github.com/repos/apache/incubator-uniffle/issues/289,incubator-uniffle,1426586417,289,[FEATURE] Operator support annotation,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-10-28T03:15:36Z,2024-06-25T03:32:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Operator support annotation

### Motivation

More flexible

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/289/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/290,https://api.github.com/repos/apache/incubator-uniffle/issues/290,incubator-uniffle,1426587793,290,[FEATURE]  Make RpcNodePort and HttpNodePort optional,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-10-28T03:16:42Z,2022-11-07T03:22:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Make RpcNodePort and HttpNodePort optional

### Motivation

More flexible

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/290/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/290,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NyK7V,incubator-uniffle,1304997589,290,NA,amaliujia,1938382,Rui Wang,,NA,2022-11-07T02:16:51Z,2022-11-07T02:16:51Z,Sending this PR for this issue https://github.com/apache/incubator-uniffle/pull/305,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NyK7V/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/291,https://api.github.com/repos/apache/incubator-uniffle/issues/291,incubator-uniffle,1427189882,291,[FEATURE] Async Reader,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2022-10-28T12:27:10Z,2023-03-31T01:46:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We synchronize to  read the data. If we asynchronize to read the data. We could improve our performance.

### Motivation

Improve the performance.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/291/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/291,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RRg3s,incubator-uniffle,1363545580,291,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-23T02:14:24Z,2022-12-23T02:14:24Z,"This means we should support prefetch when reading the data, which looks similar with the tensorflow data prefetch mechanism. And this feature could improve the performance for reduce-side. 

cc @advancedxy @jerqi. Could we pin this to be as the next release feature?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RRg3s/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/291,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Y4YQu,incubator-uniffle,1491174446,291,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-31T01:46:26Z,2023-03-31T01:46:26Z,"To address the issue, we will take the following steps:

1. Support async reading with a single thread to fetch data, as the current client handler is not thread-safe. #603 
2. Make the client handler thread-safe to enable multiple threads to fetch remote data. #785 
3. Introduce memory management aligned with Spark's memory management.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Y4YQu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/297,https://api.github.com/repos/apache/incubator-uniffle/issues/297,incubator-uniffle,1434626246,297,[Bug] Potenial data lost when local storage meets high-watermark ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-03T13:02:01Z,2022-11-05T06:10:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When enable the MEMORY_LOCALFILE storage type in uniffle shuffle-server(it has the 4 disks), the first event of (appId:x,shuffleId:x,partition:1) is flushing from memory to localfile.
But when selecting the storage in `LocalStorageManager`, the disk selected by `localStorages.get(ShuffleStorageUtils.getStorageIndex(localStorages.size(),event.getAppId(),event.getShuffleId(),event.getStartPartition())` is corrupted maybe due to reaching high-watermark (suppose disk0 is corrupted), and so it will fallback to use the disk1.

But the second event of (appId:x,shuffleId:x,partition:1) is flushing, the disk0 has been repaired. It means the second event's data will be flushed to disk0.

And the reading client will fetch the disk0 data directly and ignore data in disk1, that will lost some data for App.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

Currently the storage event data flushed is determined by the hash of appId&shuffleId&partitionId and localstorages size, it's a static strategy. That means we should store the state of flushing storages for one partition to solve the corrupted storage problem.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/297/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/297,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NnBze,incubator-uniffle,1302076638,297,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-03T13:04:51Z,2022-11-03T13:04:51Z,"It's better to introduce dynamic storage selection mechanism to solve this

@jerqi PTAL, I just read the code to find this problem, If I'm wrong, please tell me. Thanks","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NnBze/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/297,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NnFvQ,incubator-uniffle,1302092752,297,NA,xianjingfeng,11752250,,,NA,2022-11-03T13:10:52Z,2022-11-03T13:10:52Z,Maybe we should merge data in disk0 and disk1?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NnFvQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/297,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NnIO_,incubator-uniffle,1302102975,297,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-03T13:16:59Z,2022-11-03T13:16:59Z,"> Maybe we should merge data in disk0 and disk1?

It is OK but firstly we should know the partial data in other storage. Right? This should be considered in detail.

By the way, when reviewing your PR #281 and then surfing this part, I found this bug ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NnIO_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/297,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NqudL,incubator-uniffle,1303045963,297,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-04T06:56:46Z,2022-11-04T06:56:46Z,"How do we determine that disk is broken?
I think the disk can't be read or written. So I don't think this is a bug.
So we should let the application fail fast. But I already have multiple replicas, so it's unnecessary to fail fast.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NqudL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/297,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ns5XU,incubator-uniffle,1303614932,297,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-04T14:10:37Z,2022-11-04T14:10:37Z,"> How do we determine that disk is broken?

I think you are right. The broken disk is marked as corrupted due to the checking of read and write. It wont happen in my above description.

But I think it's necessary to add some test case to keep this logic and I will do this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ns5XU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/297,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nv9vQ,incubator-uniffle,1304419280,297,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-05T06:10:57Z,2022-11-05T06:10:57Z,close by #298 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nv9vQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/299,https://api.github.com/repos/apache/incubator-uniffle/issues/299,incubator-uniffle,1436795430,299,[Improvement] Make config type of RSS_STORAGE_TYPE as enum,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-05T03:48:33Z,2023-08-07T03:42:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Make config type of `RSS_STORAGE_TYPE` in `RssBaseConf` as enum

### How should we improve?

The enum type of config option is introduced in #199, follow this PR to fix the storage type config

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/299/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/299,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OBajP,incubator-uniffle,1308993743,299,NA,selectbook,8454350,Luke023434,,NA,2022-11-09T16:09:38Z,2022-11-09T16:09:38Z,"is it change to something like this?

public static final ConfigOption<StorageType> RSS_STORAGE_TYPE = ConfigOptions
      .key(""rss.storage.type"")
      .enumType(StorageType.class)
      .noDefaultValue()
      .withDescription(""Data storage for remote shuffle service"");
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OBajP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/299,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OBi4f,incubator-uniffle,1309027871,299,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-09T16:34:46Z,2022-11-09T16:34:46Z,"> is it change to something like this?
> 
> public static final ConfigOption RSS_STORAGE_TYPE = ConfigOptions .key(""rss.storage.type"") .enumType(StorageType.class) .noDefaultValue() .withDescription(""Data storage for remote shuffle service"");

Yes, do you want to submit a PR?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OBi4f/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/299,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OBnWA,incubator-uniffle,1309046144,299,NA,selectbook,8454350,Luke023434,,NA,2022-11-09T16:49:18Z,2022-11-09T16:49:18Z,"> > is it change to something like this?
> > public static final ConfigOption RSS_STORAGE_TYPE = ConfigOptions .key(""rss.storage.type"") .enumType(StorageType.class) .noDefaultValue() .withDescription(""Data storage for remote shuffle service"");
> 
> Yes, do you want to submit a PR?

yes i will fix this","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OBnWA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/299,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ODkhd,incubator-uniffle,1309558877,299,NA,amaliujia,1938382,Rui Wang,,NA,2022-11-09T23:57:41Z,2022-11-09T23:57:41Z,I looked this a bit. I thought this requires a good amount of refactoring. For example you might need to move `StorageType.class` to `common` module.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ODkhd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/300,https://api.github.com/repos/apache/incubator-uniffle/issues/300,incubator-uniffle,1436796560,300,[Improvement] Make config type of RSS_CLIENT_TYPE as enum,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-05T03:53:44Z,2022-11-28T01:55:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Make config type of RSS_CLIENT_TYPE as enum

### How should we improve?

The enum type of config option is introduced in https://github.com/apache/incubator-uniffle/pull/199, follow this PR to fix the RSS_CLIENT_TYPE config

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/300/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/300,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OM00A,incubator-uniffle,1311984896,300,NA,selectbook,8454350,Luke023434,,NA,2022-11-11T17:42:13Z,2022-11-11T17:42:13Z,"Because the change of this issue involves only one class change, I want to use this to verify whether my thinking is correct","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OM00A/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/301,https://api.github.com/repos/apache/incubator-uniffle/issues/301,incubator-uniffle,1437018246,301,[Subtask] [Improvement][AQE][LocalOrder] Merge continuous ShuffleDataSegment into single one,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-05T12:28:12Z,2022-11-07T03:59:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Currently, the LocalOrderSegmentSplitter will split the index file into multiple shuffleDataSegments. But the split scope is limited in the range of local order.

For example:
The blocks are as follow
```
block-a (taskId-1)
block-b (taskId-2)
block-c (taskId-1)
block-d (taskId-2)
```

When the reader want to get  the range of taskIds: [1, 3), the strategy will return two shuffleDataSegments. But we'd better to merge them into single one to reduce the network interaction times, because they are continuous.

### Parent issue

#137 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/301/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/302,https://api.github.com/repos/apache/incubator-uniffle/issues/302,incubator-uniffle,1437019763,302,[Subtask][Improvement][AQE][LocalOder] Introduce the new MergedShuffleDataSegment to reduce number of rpc,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-11-05T12:34:51Z,2023-05-23T03:20:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Currently, when using the `LocalOrderSegmentSplitter`, it will split multiple `ShuffleDataSegment` by three factors.

1. taskId in [startMapId, endMapId) taskIds bitmap
2. ShuffleDataSegment size should < readBufferSize
3. ShuffleDataSegment's blocks should be continuous

In some cases, these requirements will make the data size very small (<14M). So we could combine some ShuffleDataSegment to single one data-fetching request to reduce the RPC interaction number.

### Parent issue

#137 

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/302/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/302,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NwjJQ,incubator-uniffle,1304572496,302,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-05T15:57:00Z,2022-11-05T15:57:00Z,Maybe global order will be a better solution for this case.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5NwjJQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/302,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nw6er,incubator-uniffle,1304668075,302,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-05T23:50:34Z,2022-11-05T23:50:34Z,"Yes, maybe we should introduce global order to compare with other distribution types in different data size

but this pr is still meaningful for local order","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nw6er/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/306,https://api.github.com/repos/apache/incubator-uniffle/issues/306,incubator-uniffle,1437801587,306,[FEATURE] Introduce dynamic disk selection for one partition in LOCALFILE ,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-11-07T05:47:49Z,2024-11-16T14:15:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Introduce the dynamic disk selection for one partition in LOCALFILE, especially when some disks reached the high-watermark.

### Motivation

Currently, when mounting multiple disks in shuffle-server and using the MEMORY_LOCALFILE storage type, one app has a very large partition data and its selected disk reaches the high watermark, it will preserve the data into  the memory. This will make some app hard to get the memory.

### Describe the solution

Maybe we should let the its partial big partition data store to the another disk.

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/306/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/306,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nyr08,incubator-uniffle,1305132348,306,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-07T06:08:43Z,2022-11-07T06:08:43Z,"If you use MEMORY_LOCALFILE_HDFS, it won't be a big problem.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nyr08/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/306,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nyvap,incubator-uniffle,1305147049,306,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-07T06:32:48Z,2022-11-07T06:32:48Z,"> If you use MEMORY_LOCALFILE_HDFS, it won't be a big problem.

Yes. This is an optional solution.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Nyvap/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/306,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N0u1v,incubator-uniffle,1305668975,306,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-07T14:07:40Z,2022-11-07T14:07:40Z,Actually we ever use raid disk to solve this problem when we only have localfile mode.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5N0u1v/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/306,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2se1,incubator-uniffle,2480588725,306,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-11-16T14:15:38Z,2024-11-16T14:15:38Z,@jerqi As the raid disk has been tested and shown that there is performance degradation while using `raid0/LVM`. I will pick this issue up to implement a multiply disk store approach for one partition.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2se1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/309,https://api.github.com/repos/apache/incubator-uniffle/issues/309,incubator-uniffle,1445009366,309,[FEATURE] Support ShuffleServer latency metrics,leixm,31424839,Xianming Lei,,CLOSED,2022-11-11T06:43:01Z,2022-11-16T10:02:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

When the ShuffleServer load is high, we cannot directly judge whether the client read and write has been greatly affected according to the metrics.


### Motivation

Accurately determine whether the current service load has caused a large delay to the client's read and write.

### Describe the solution

Delay monitoring is divided into two parts. The first part is the delay of ShuffleServer processing logic. Here we can directly add metrics. The second part is before ShuffleServer processing logic, including network delay and rpc queue waiting time.

For the second part, maybe we can record the timestamp of the request before the client initiates the read and write request, and include this timestamp in the request. When ShuffleServer receives the request it can know how long the delay time is and record it in the metrics of ShuffleServer, maybe grpc also supports related implementations.

We can measure the processing delay of the current ShuffleServer through some monitoring indicators such as p95 and p99.

### Additional context

No

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/309/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/309,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OKLx1,incubator-uniffle,1311292533,309,NA,leixm,31424839,Xianming Lei,,NA,2022-11-11T06:44:32Z,2022-11-11T06:44:32Z,@jerqi  @zuston  Do you think this feature needs to be supported?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OKLx1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/309,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OKNsd,incubator-uniffle,1311300381,309,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-11T06:56:25Z,2022-11-11T06:56:25Z,"For batch process system, throughout in specific time may be more important than latency. The latency may be related to amount of data, too. It's ok for me to support some latency metrics.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OKNsd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/309,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OLZU3,incubator-uniffle,1311610167,309,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-11T11:59:56Z,2022-11-11T11:59:56Z,"Sounds great! Previously I introduce some grpc metrics to measure the pressure, but it's not effective.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OLZU3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/309,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OYlOY,incubator-uniffle,1315066776,309,NA,leixm,31424839,Xianming Lei,,NA,2022-11-15T09:57:35Z,2022-11-15T09:57:35Z,"> For batch process system, throughout in specific time may be more important than latency. The latency may be related to amount of data, too. It's ok for me to support some latency metrics.

You are right, but if the latency continues to be high for a long time, it will affect the task, slow down or even cause the task to fail. We can judge whether it may have affected the task according to the fluctuation of latency.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OYlOY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/309,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OYmLJ,incubator-uniffle,1315070665,309,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-15T10:00:46Z,2022-11-15T10:00:46Z,"> > For batch process system, throughout in specific time may be more important than latency. The latency may be related to amount of data, too. It's ok for me to support some latency metrics.
> 
> You are right, but if the latency continues to be high for a long time, it will affect the task, slow down or even cause the task to fail. We can judge whether it may have affected the task according to the fluctuation of latency.

Ok, you can go ahead.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OYmLJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/312,https://api.github.com/repos/apache/incubator-uniffle/issues/312,incubator-uniffle,1446302908,312,[Improvement] [AQE] Introduce new partition data distribution of global order,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-11-12T07:15:11Z,2022-11-12T07:15:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In #293, it introduces the new partition data distribution abstraction. And for AQE skew optimization, it introduce the LOCAL ORDER mode to improve the validity of filtering data and speed up the reads.

But I think it may be not effective especially when shuffle-server's memory is too small that will cause fragmentation problems.

So basing on this assumption, I think maybe for some scenarios, global order of single partition data may be a better solution.

### How should we improve?

## Design
1. Introduce the global order mode in current data distribution
2. Do some performance benchmark for local order and global order

## Global Order details

Shuffle server will know the shuffle reading start only when the first reader reaches. That means the sorting will be started in this time, and other readers will be hang until the sorting finish.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/312/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/313,https://api.github.com/repos/apache/incubator-uniffle/issues/313,incubator-uniffle,1446304021,313,[Improvement] Support ZSTD in the spark2.x version,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-11-12T07:18:57Z,2023-01-05T10:03:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In PR of #254, the ZSTD is introduced in uniffle. But in this implementation, it only support the jobs of spark3.x .

So we should make it compatible with the spark 2.x

### How should we improve?

We should do some compatibility work for the spark 2.x and 3.x ZSTD version

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/313/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/313,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RwLFB,incubator-uniffle,1371582785,313,NA,a-li,7497012,,,NA,2023-01-05T00:31:25Z,2023-01-05T00:31:25Z,"I want to give this a shot. @zuston Could you provide me with some tips/pointers to get started? In addition, how do I go about manually testing this?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RwLFB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/313,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rxzlr,incubator-uniffle,1372010859,313,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-05T10:02:32Z,2023-01-05T10:02:32Z,"This problem will happen when enable ZSTD compression of uniffle in Spark 2.x, which is caused by the incompatible interface of different version ZSTD. In uniffle, ZSTD version is 1.5.2-3, but Spark 2.x built-in version is 1.3.2-2 (https://github.com/apache/spark/blob/807e0a484d1de767d1f02bd8a622da6450bdf940/pom.xml#L586).

And I think this problem could be fixed by using the reflection to be compatible with older interface of ZSTD.

Feel free to discuss more. @a-li ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rxzlr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/316,https://api.github.com/repos/apache/incubator-uniffle/issues/316,incubator-uniffle,1446313737,316,[Improvement] Remove the PartitionRange ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-12T07:47:51Z,2023-02-02T02:57:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the partitionRange is not used in spark/mr. Let's remove this to reduce the complexity

### How should we improve?

Delete all related code.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/316/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/316,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OOauU,incubator-uniffle,1312402324,316,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-12T07:51:49Z,2022-11-12T07:51:49Z,This is mentioned in offline discussion @jerqi . ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OOauU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/316,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPzd6,incubator-uniffle,1346320250,316,NA,advancedxy,807537,,,NA,2022-12-12T11:31:54Z,2022-12-12T11:31:54Z,"Let's not pursue this for now? I may have ideas on how to reduce small I/Os when involved in many small tasks scenario, it may require partition range to merge small I/Os.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPzd6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/316,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QP0D_,incubator-uniffle,1346322687,316,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-12T11:34:10Z,2022-12-12T11:34:10Z,"> Let's not pursue this for now? I may have ideas on how to reduce small I/Os when involved in many small tasks scenario, it may require partition range to merge small I/Os.

OK.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QP0D_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/316,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOeSw,incubator-uniffle,1413080240,316,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-02T02:57:59Z,2023-02-02T02:57:59Z,Closed. Feel free to open if having any problem.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOeSw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/317,https://api.github.com/repos/apache/incubator-uniffle/issues/317,incubator-uniffle,1446322814,317,[FEATURE] Introduce the general remote fs access layer,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-12T07:58:14Z,2023-02-02T03:00:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, we use the Hadoop filesystem interface to be interactive with S3/OBS/HDFS/COS, maybe this will make uniffle 
bound to Hadoop ecosystem. 

In my opinion, when deploying uniffle into the K8s and directly use the s3 as the backend storage, there is not necessary to use the Hadoop api to visit S3.

So we should introduce the general fs access layer to unify all fs visit, including HDFS/S3, like flink does.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/317/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/317,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OOfEi,incubator-uniffle,1312420130,317,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-12T09:10:49Z,2022-11-12T09:10:49Z,I have some concern about some low performance operations about object storage such as `Append` operation and `List` operation. Maybe we need extra optimization.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OOfEi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/317,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOele,incubator-uniffle,1413081438,317,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-02T03:00:09Z,2023-02-02T03:00:09Z,This issue may be related with the support of object store. Let's track this in https://github.com/apache/incubator-uniffle/issues/391,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOele/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/321,https://api.github.com/repos/apache/incubator-uniffle/issues/321,incubator-uniffle,1447313257,321,[Umbrella] Support Tez Client,baitian77,14013778,,,CLOSED,2022-11-14T03:21:09Z,2023-07-17T16:42:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Now, uniffle support Spark and MR client，but does not support tez.


### Task list
1. Design document
- [x]  #337
2. Dependent apache-tez code changes & pr
- [x]  #831 
- [x] #832 
3. client-tez common
- [x]  #747
- [x]  #872  
- [x]  #894 
- [x]  #915 
- [x]  #916 
- [x]  #919 
4. client-tez AM
- [x]  #819 
- [x]  #918 
5. client-tez shuffle read
- [x] #854 
- [x] #920 
- [x] #922  
- [x] #929 
- [x] #935 
6. client-tez shuffle write 
- [x]  #855 
- [x]  #930
- [x]   #943  
- [x]   #944 


### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/321/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/321,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OQ5Ev,incubator-uniffle,1313050927,321,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-14T03:36:20Z,2022-11-14T03:36:20Z,Thanks! It's a really great work!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OQ5Ev/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/321,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OQ7pO,incubator-uniffle,1313061454,321,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-14T04:01:48Z,2022-11-14T04:01:48Z,Looking forward to this feature!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OQ7pO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/321,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cA6l7,incubator-uniffle,1543743867,321,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-05-11T10:29:58Z,2023-05-11T10:29:58Z,Could we indicate which PR is the first PR ?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cA6l7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/321,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fLNVd,incubator-uniffle,1596773725,321,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-19T08:50:10Z,2023-06-19T08:50:10Z,"cc @BsoBird If you have interest about Tez on rss, you can focus on this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fLNVd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/321,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gahWk,incubator-uniffle,1617565092,321,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-03T07:54:37Z,2023-07-03T07:54:37Z,Finished.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gahWk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/321,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hqYT8,incubator-uniffle,1638499580,321,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-17T16:42:01Z,2023-07-17T16:42:01Z,@Lobo2008 @microeastcowboy  @XiaoqiMa  Uniffle is a remote shuffle service. Maybe you have interest about MapReduce on Uniffle and Tez on Uniffle.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hqYT8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/323,https://api.github.com/repos/apache/incubator-uniffle/issues/323,incubator-uniffle,1447755504,323,[Bug] Log host path access denied when UID is different from GID,a140262,30616687,Melody Yang,,CLOSED,2022-11-14T10:06:19Z,2022-11-16T08:40:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

My Spark application's UID is different from GroupID, ie. use `999:1000` to access /data/rssadmin. In the [init container command](https://github.com/apache/incubator-uniffle/blob/e6b4260aa54a9ffda30ec02fa050be1c108e8a9f/deploy/kubernetes/operator/pkg/controller/util/util.go#L214), why do you setup the permission via `GID:GID` instead of the format of `UID:GID` for the host paths? 
The pod securityContext I set is:
```
    securityContext:
      runAsUser: 999
      fsGroup: 1000
```

Both coordinator and server pods threw the permission error:
```
/data/rssadmin/rss/bin/start-coordinator.sh: line 73: /data/rssadmin/rss/logs/coordinator.out: Permission denied
AND
/data/rssadmin/rss/bin/start-shuffle-server.sh: line 96: /data/rssadmin/rss/logs/shuffle_server.out: Permission denied
```



### Affects Version(s)

0.7.0-snapshot

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/323/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/323,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OSx4C,incubator-uniffle,1313545730,323,NA,wangao1236,12544973,jasonawang,908622977@qq.com,NA,2022-11-14T11:37:50Z,2022-11-14T11:37:50Z,"Sorry, this part of the feature does have a bug. Because there are so many arguments in SecurityContext, we initially used fsgroup for convenience and assumed that uid and gid were the same by default. We will correct this as soon as possible, or we really appreciate that you can help to submit a PR? @a140262 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OSx4C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/323,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od-xd,incubator-uniffle,1316482141,323,NA,wangao1236,12544973,jasonawang,908622977@qq.com,NA,2022-11-16T07:11:13Z,2022-11-16T07:11:13Z,"@a140262  have modified it for time reasons, thanks for pointing this out. If possible, we would really appreciate your help in reviewing.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od-xd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/328,https://api.github.com/repos/apache/incubator-uniffle/issues/328,incubator-uniffle,1450973114,328,[Improvement] Cleanup unused shuffle servers after stage completed,xianjingfeng,11752250,,,CLOSED,2022-11-16T06:39:47Z,2022-11-18T01:41:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

If there are many stages in one applicaiton, spark driver will send heartbeat to every shuffle servers, and it may cause app expired in shuffle server side. And if we support decommission in the future, it will cause shuffle difficult to exit.

### How should we improve?

Cleanup unused shuffle servers after stage completed

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/328/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/328,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od66W,incubator-uniffle,1316466326,328,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-16T06:54:59Z,2022-11-16T06:54:59Z,"Spark has a mechanism called `ExchangeReuse`. It means that we can use the older stage' shuffle data.
We have already a pr https://github.com/apache/incubator-uniffle/pull/249, I don't know whether this pr can solve your problem.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od66W/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/328,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od7vN,incubator-uniffle,1316469709,328,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-16T06:58:10Z,2022-11-16T06:58:10Z,"Have you joined our `Wechat` group? You can scan the QR code
![bcde7855d24455ec870a45a3f70df3c0](https://user-images.githubusercontent.com/8159038/202109313-1b2f86c5-35a4-4ed2-8122-066315b812e0.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od7vN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/328,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od9nH,incubator-uniffle,1316477383,328,NA,xianjingfeng,11752250,,,NA,2022-11-16T07:06:32Z,2022-11-16T07:06:32Z,"> Spark has a mechanism called `ExchangeReuse`. It means that we can use the older stage' shuffle data. We have already a pr #249, I don't know whether this pr can solve your problem.

#249 will clean the older stage' shuffle data, and it will not clean shuffle servers in shuffleServerInfoSet, right?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od9nH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/328,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od9q9,incubator-uniffle,1316477629,328,NA,xianjingfeng,11752250,,,NA,2022-11-16T07:06:48Z,2022-11-16T07:06:48Z,"> Have you joined our `Wechat` group?

No, how to join it?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od9q9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/328,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od9zf,incubator-uniffle,1316478175,328,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-16T07:07:23Z,2022-11-16T07:07:23Z,"> > Spark has a mechanism called `ExchangeReuse`. It means that we can use the older stage' shuffle data. We have already a pr #249, I don't know whether this pr can solve your problem.
> 
> #249 will clean the older stage' shuffle data, and it will not clean shuffle servers in shuffleServerInfoSet, right?

Yes. you're right.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od9zf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/328,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od-Bw,incubator-uniffle,1316479088,328,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-16T07:08:08Z,2022-11-16T07:08:08Z,"> > Have you joined our `Wechat` group?
> 
> No, how to join it?

You can scan the QR code
![bcde7855d24455ec870a45a3f70df3c0](https://user-images.githubusercontent.com/8159038/202109313-1b2f86c5-35a4-4ed2-8122-066315b812e0.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Od-Bw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/328,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OeEN3,incubator-uniffle,1316504439,328,NA,xianjingfeng,11752250,,,NA,2022-11-16T07:28:21Z,2022-11-16T07:28:21Z,"> > > Spark has a mechanism called `ExchangeReuse`. It means that we can use the older stage' shuffle data. We have already a pr #249, I don't know whether this pr can solve your problem.
> > 
> > 
> > #249 will clean the older stage' shuffle data, and it will not clean shuffle servers in shuffleServerInfoSet, right?
> 
> Yes. you're right.

So it is ok if we cleanup unused shuffle servers?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OeEN3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/328,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OeFCd,incubator-uniffle,1316507805,328,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-16T07:31:23Z,2022-11-16T07:31:23Z,"> > > > Spark has a mechanism called `ExchangeReuse`. It means that we can use the older stage' shuffle data. We have already a pr #249, I don't know whether this pr can solve your problem.
> > > 
> > > 
> > > #249 will clean the older stage' shuffle data, and it will not clean shuffle servers in shuffleServerInfoSet, right?
> > 
> > 
> > Yes. you're right.
> 
> So it is ok if we cleanup unused shuffle servers?

Yes, if we already removed the shuffle data in those shuffle servers, we can remove the shuffle servers in the shuffleServerInfoSet.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OeFCd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/329,https://api.github.com/repos/apache/incubator-uniffle/issues/329,incubator-uniffle,1450982676,329,[Improvement] Catch NPE in `org.apache.uniffle.server.ShuffleTaskManager#addFinishedBlockIds`,xianjingfeng,11752250,,,CLOSED,2022-11-16T06:49:24Z,2022-11-16T11:05:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

`reportShuffleResult` after app expired in shuffle server  will throw NPE.

`[ERROR] 2022-11-16 08:34:17,365 Grpc-36 ShuffleServerGrpcService reportShuffleResult - Error happened when report shuffle result for appId[application_1662640300316_225642511668556895849], shuffleId[18], taskAttemptId[58606]
 java.lang.NullPointerException`

### How should we improve?

If app expired, thrown a runtime exception with message

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/329/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/333,https://api.github.com/repos/apache/incubator-uniffle/issues/333,incubator-uniffle,1452989412,333,[FEATURE] Expose metrics of TOP10 app bytes in one shuffle server,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-17T09:17:26Z,2024-01-12T05:47:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

 It's better to expose metrics of TOP10 app bytes in one shuffle server, especially when reaching the high watermark of disk.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/333/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Oqmzm,incubator-uniffle,1319791846,333,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-18T10:07:26Z,2022-11-18T10:07:26Z,cc @jerqi @kaijchen Do you have some suggestion on this? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Oqmzm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Oq4ih,incubator-uniffle,1319864481,333,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-18T11:13:40Z,2022-11-18T11:13:40Z,What can the metrics tell us? Which problems do you want to solve?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Oq4ih/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OriH7,incubator-uniffle,1320034811,333,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-18T14:03:45Z,2022-11-18T14:03:45Z,"> What can the metrics tell us? Which problems do you want to solve?

When reaching the high watermark, we could kill the max data size  app to keep other apps stability ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OriH7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrkHW,incubator-uniffle,1320042966,333,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2022-11-18T14:09:55Z,2022-11-18T14:09:55Z,I think it's ok to include this metrics if it doen't introduce noticeable overhead.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrkHW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Orluu,incubator-uniffle,1320049582,333,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-18T14:15:30Z,2022-11-18T14:15:30Z,"> I think it's ok to include this metrics if it doen't introduce noticeable overhead.

I think it won’t. The aggregated data of single app used bytes has been collected in current codebase, we just need to expose","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Orluu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PLPjM,incubator-uniffle,1328347340,333,NA,amaliujia,1938382,Rui Wang,,NA,2022-11-27T21:47:59Z,2022-11-27T21:47:59Z,"Given this is a starter issue, do you mind sharing some key code pointers to help understand the workflow of the shuffle server that collects then observes the app bytes?

I assume it cannot be limited to only TOP 10 since the metrics will change and there always a need to sort?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PLPjM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PLlJf,incubator-uniffle,1328435807,333,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-28T02:08:56Z,2022-11-28T02:08:56Z,"> Given this is a starter issue, do you mind sharing some key code pointers to help understand the workflow of the shuffle server that collects then observes the app bytes?
> 
> I assume it cannot be limited to only TOP 10 since the metrics will change and there always a need to sort?

Sorry, I must correct the above conversation that `The aggregated data of single app used bytes has been collected in current codebase` is wrong. 

We have to collect all the app's write bytes in `ShuffleTaskManager.shuffleTaskInfos`. When method of `updateCachedBlockIds` is triggered, the size of written bytes should be updated in App's `ShuffleTaskInfo`.

After that, we could expose these top10 metrics by sorting these shuffleTaskInfos through extra api uri, like xxxx:19999/metrics/app.

Do you think so? Maybe my idea is not right, feel free to discuss more ~ @amaliujia 
If you are interested in this issue, I will assign this to you.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PLlJf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pq7nv,incubator-uniffle,1336654319,333,NA,amaliujia,1938382,Rui Wang,,NA,2022-12-05T02:41:34Z,2022-12-05T02:41:34Z,@zuston could you give me some feedback on my WIP PR to see if I am on the right direction: https://github.com/apache/incubator-uniffle/pull/387,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pq7nv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/337,https://api.github.com/repos/apache/incubator-uniffle/issues/337,incubator-uniffle,1454393349,337,[FEATURE] Support Tez Client Design,bin41215,74609438,,,CLOSED,2022-11-18T03:53:45Z,2023-07-05T06:43:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We have made a design about support tez,  details are in this document.
https://docs.google.com/document/d/1__mOXmtqTX5hKFhVjg4VVwT0a7yosFAwO9koGZMHdQg/edit?usp=sharing

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/337/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/337,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Opj4M,incubator-uniffle,1319517708,337,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-18T04:07:42Z,2022-11-18T04:07:42Z,Could you give us the authority of the comment for your design doc?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Opj4M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/337,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Opknv,incubator-uniffle,1319520751,337,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-18T04:12:40Z,2022-11-18T04:12:40Z,"Maybe we can reuse https://github.com/apache/incubator-uniffle/issues/321, you can attach the design doc in the issue #321 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Opknv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/337,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PzQpH,incubator-uniffle,1338837575,337,NA,bin41215,74609438,,,NA,2022-12-06T06:26:38Z,2022-12-06T06:26:38Z,"Sorry, I was working on something else the other day; I just responded to something in the docs.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PzQpH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/337,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P0HNg,incubator-uniffle,1339061088,337,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-06T09:58:09Z,2022-12-06T09:58:09Z,"cc @zuston We will have online meeting to discuss some design details this Thursday at 7:00 pm (UTC +8). If someone has interest, you can tell me. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P0HNg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/339,incubator-uniffle,1454743913,339,[Improvement] Optimize retry logic in `ShuffleServerGrpcClient#sendShuffleData`,xianjingfeng,11752250,,,CLOSED,2022-11-18T09:08:10Z,2022-11-27T09:04:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Now in `org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient#sendShuffleData`, it will retry to send to one shuffle server for a long time and fail after reach `rss.client.send.check.timeout.ms`. Exception as follows:

`Timeout: Task[2852_0] failed because 200 blocks can't be sent to shuffle server in 600000 ms.`

This will cause that client will not send data to other servers.

### How should we improve?

1. Don't retry in `requirePreAllocation` and just retry in upper level
2. Set the default value of `rss.client.retry.max` to a smaller value, such as 10.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/339/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OqY_v,incubator-uniffle,1319735279,339,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-18T09:13:49Z,2022-11-18T09:13:49Z,Maybe this has been optimized in #332 . cc  @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OqY_v/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OquA9,incubator-uniffle,1319821373,339,NA,xianjingfeng,11752250,,,NA,2022-11-18T10:35:46Z,2022-11-18T10:35:46Z,"It seems not. This issue describes that when there are multiple replicas, if the first server can't be written, we should switch to other servers as soon as possible.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OquA9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrixY,incubator-uniffle,1320037464,339,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-18T14:05:44Z,2022-11-18T14:05:44Z,"Make sense. 

But this may be hard to control. If you have some ideas, please go ahead","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrixY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrpBp,incubator-uniffle,1320063081,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-18T14:24:26Z,2022-11-18T14:24:26Z,I don't suggest that we modify the default value. Because we should verify the parameters in our production environment with huge amount of data first.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrpBp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OwnjG,incubator-uniffle,1321367750,339,NA,xianjingfeng,11752250,,,NA,2022-11-21T02:27:53Z,2022-11-21T02:27:53Z,"> I don't suggest that we modify the default value. Because we should verify the parameters in our production environment with huge amount of data first.

But the current default value is obviously unreasonable.
`rss.client.send.check.timeout.ms=600000`  `rss.client.retry.max=100`  `rss.client.retry.interval.max=10000`
It will not send data to other servers if the first server blocked.
And after #159, it will retry 300 times","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OwnjG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Owntt,incubator-uniffle,1321368429,339,NA,xianjingfeng,11752250,,,NA,2022-11-21T02:29:13Z,2022-11-21T02:29:13Z,"> Make sense.
> 
> But this may be hard to control. If you have some ideas, please go ahead

I just change the default value and adjust the retry logic introduced by #159 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Owntt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OzCzn,incubator-uniffle,1322003687,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-21T12:38:25Z,2022-11-21T12:38:25Z,"> > I don't suggest that we modify the default value. Because we should verify the parameters in our production environment with huge amount of data first.
> 
> But the current default value is obviously unreasonable. `rss.client.send.check.timeout.ms=600000` `rss.client.retry.max=100` `rss.client.retry.interval.max=10000` It will not send data to other servers if the first server blocked. And after #159, it will retry 300 times

Is it ok for single replica?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OzCzn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O5w_g,incubator-uniffle,1323765728,339,NA,xianjingfeng,11752250,,,NA,2022-11-22T14:30:01Z,2022-11-22T14:30:01Z,"> Is it ok for single replica?

Yes. But I think we usually use multiple replicas.If the user is not familiar with this mechanism, he will think that fault tolerance can be achieved without modifying other configurations.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O5w_g/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PHOIm,incubator-uniffle,1327292966,339,NA,xianjingfeng,11752250,,,NA,2022-11-25T10:21:54Z,2022-11-25T10:21:54Z,Do you have any better ideas? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PHOIm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PISmW,incubator-uniffle,1327573398,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-25T14:39:53Z,2022-11-25T14:39:53Z,Do you want to solve to avoid sending too much data to a heavy load server?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PISmW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PId9W,incubator-uniffle,1327619926,339,NA,xianjingfeng,11752250,,,NA,2022-11-25T15:17:12Z,2022-11-25T15:17:12Z,"> Do you want to solve to avoid sending too much data to a heavy load server?

No, i just want to solve that when the first shuffle server can't be written, we can send data to another one.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PId9W/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PImRT,incubator-uniffle,1327653971,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-25T15:58:38Z,2022-11-25T15:58:38Z,How can we judge whether the server is writable?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PImRT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJyMA,incubator-uniffle,1327964928,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T02:38:16Z,2022-11-26T02:38:16Z,"> How can we judge whether the server is writable?

We can set a timeout to per server. The current problem is that there is only the timeout for block sending and the time to send data to one server is bigger than the timeout for block sending","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJyMA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJzrx,incubator-uniffle,1327971057,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-26T03:27:35Z,2022-11-26T03:27:35Z,"> > How can we judge whether the server is writable?
> 
> We can set a timeout to per server. The current problem is that there is only the timeout for block sending and the time to send data to one server is bigger than the timeout for block sending

Could we add a config option for multi replicas timeout? If we use multi replicas, we could use this timeout.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJzrx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ5vY,incubator-uniffle,1327995864,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T07:11:37Z,2022-11-26T07:11:37Z,"> Could we add a config option for multi replicas timeout? If we use multi replicas, we could use this timeout.

It's a little complicated. How about set real timeout to  `rss.client.send.check.timeout.ms *  2` if `rss.data.replica.skip.enabled=true`

Another problems:
1. Before #159 it will retry 100 times, but it will retry 300 times after it. Should we set `rss.client.retry.max=33` for recovery it?
2.  
> `rss.client.send.check.timeout.ms=600000` `rss.client.retry.max=100` `rss.client.retry.interval.max=10000`

100 * 10000 = 1000000 > 600000,  This default values seems unreasonable.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ5vY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ53t,incubator-uniffle,1327996397,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-26T07:16:21Z,2022-11-26T07:16:21Z,"> > Could we add a config option for multi replicas timeout? If we use multi replicas, we could use this timeout.
> 
> It's a little complicated. How about set real timeout to `rss.client.send.check.timeout.ms * 2` if `rss.data.replica.skip.enabled=true`
> 
> Another problems:
> 
> 1. Before [[ISSUE-76] Disallow sendShuffleData if requireBufferId expired #159](https://github.com/apache/incubator-uniffle/pull/159) it will retry 100 times, but it will retry 300 times after it. Should we set `rss.client.retry.max=33` for recovery it?
> 
> > `rss.client.send.check.timeout.ms=600000` `rss.client.retry.max=100` `rss.client.retry.interval.max=10000`
> 
> 100 * 10000 = 1000000 > 600000, This default values seems unreasonable.

Could we add some retry strategy? When we encounter some exception, we won't retry.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ53t/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ6eG,incubator-uniffle,1327998854,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T07:37:56Z,2022-11-26T07:37:56Z,"> Could we add some retry strategy? When we encounter some exception, we won't retry.

It will not retry if some exception encountered in `requirePreAllocation`, it just retry when server has no buffer.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ6eG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ6w8,incubator-uniffle,1328000060,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-26T07:48:51Z,2022-11-26T07:48:51Z,"<img width=""596"" alt=""企业微信截图_42660f61-94f9-4f06-87ce-1e87ecb0859b"" src=""https://user-images.githubusercontent.com/8159038/204078265-dbe47223-df60-4a8e-827e-7b122e89e07f.png"">
If we use multi replicas and then we encounter rpc exception, it seems that we shouldn't retry.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ6w8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ7QP,incubator-uniffle,1328002063,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T08:03:14Z,2022-11-26T08:03:14Z,"> If we use multi replicas and then we encounter rpc exception, it seems that we shouldn't retry.

How about if there is a problem with the client network.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ7QP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ7uh,incubator-uniffle,1328004001,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-26T08:17:24Z,2022-11-26T08:17:24Z,"> > If we use multi replicas and then we encounter rpc exception, it seems that we shouldn't retry.
> 
> How about if there is a problem with the client network.

Em.... it seems better that we reduce the retry times. Evenly, retry times could be less than 33. For online service, 1 retryTimes is enough. For our production, service usually will happen full gc. It may last 20s. For multi replicas, you could give a better advice.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ7uh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ8eH,incubator-uniffle,1328007047,339,NA,advancedxy,807537,,,NA,2022-11-26T08:40:29Z,2022-11-26T08:40:29Z,"On the other side, besides to reduce retry times, the client could send the same data to different shuffle server concurrently? Other shuffle system does that.

However it may require large effort of refactoring and the network bandwidth and shuffle data usage doubled. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ8eH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ81P,incubator-uniffle,1328008527,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T08:53:17Z,2022-11-26T08:53:17Z,"> the client could send the same data to different shuffle server concurrently?

It has done this. you can see
https://github.com/apache/incubator-uniffle/blob/57a834b083d9dae291091e4f2359d060ba30abe0/client/src/main/java/org/apache/uniffle/client/impl/ShuffleWriteClientImpl.java#L240-L258","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ81P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ85C,incubator-uniffle,1328008770,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T08:55:30Z,2022-11-26T08:55:30Z,"> Em.... it seems better that we reduce the retry times. Evenly, retry times could be less than 33. For online service, 1 retryTimes is enough. For our production, service usually will happen full gc. It may last 20s. For multi replicas, you could give a better advice.

`rss.client.retry.max` is just for `requirePreAllocation` and it just retry when server has no buffer.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ85C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ9hu,incubator-uniffle,1328011374,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-26T09:11:43Z,2022-11-26T09:11:43Z,Does it waste too much time that we still retry `requirePreAllocation` because of no buffer?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ9hu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ9sR,incubator-uniffle,1328012049,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T09:17:16Z,2022-11-26T09:17:16Z,"> Does it waste too much time that we still retry `requirePreAllocation` because of no buffer?

Yes. Because it is very common that there is no buffer, so we should retry for a few times. Maybe 33 is too many, i think 10 is enough","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ9sR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ-Lo,incubator-uniffle,1328014056,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-26T09:33:47Z,2022-11-26T09:33:47Z,Maybe It's better that  use the timeout `rss.client.send.check.timeout.ms * replicateWrite`. RetryTimes use `rss.client.retry.max / replicateWrite`. Or other formulas.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ-Lo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ-YX,incubator-uniffle,1328014871,339,NA,advancedxy,807537,,,NA,2022-11-26T09:40:01Z,2022-11-26T09:40:01Z,"> > the client could send the same data to different shuffle server concurrently?
> 
> It has done this. you can see
> 
> https://github.com/apache/incubator-uniffle/blob/57a834b083d9dae291091e4f2359d060ba30abe0/client/src/main/java/org/apache/uniffle/client/impl/ShuffleWriteClientImpl.java#L240-L258

Thanks for pointing out that. I did a quick look at the shuffle write client code, it seems that the `sendShuffleData` process is blocked by the first round to the primary shuffle servers. I think rather to reduce the `rss.client.send.check.timeout.ms` settings(-> which causes task retry), how about refactor `sendShuffleDataAsync` to return early and the second round of `sendShuffleDataAsync` could start asap.

The purpose of sending data concurrently is that once a request finished, the whole sending process would finish, which avoids busy/flaky servers.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ-YX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ-pO,incubator-uniffle,1328015950,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T09:48:55Z,2022-11-26T09:48:55Z,"> rss.client.send.check.timeout.ms * replicateWrite

`rss.client.send.check.timeout.ms * 2`,  because it will send two rounds no matter how many replica.
And i am ok for this logic. 


> > `rss.client.send.check.timeout.ms=600000` `rss.client.retry.max=100` `rss.client.retry.interval.max=10000`
> 
> 100 * 10000 = 1000000 > 600000, This default values seems unreasonable.

But we should also solve this problem first.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ-pO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ-7C,incubator-uniffle,1328017090,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T09:58:49Z,2022-11-26T09:58:49Z,"> Thanks for pointing out that. I did a quick look at the shuffle write client code, it seems that the `sendShuffleData` process is blocked by the first round to the primary shuffle servers. I think rather to reduce the `rss.client.send.check.timeout.ms` settings(-> which causes task retry), how about refactor `sendShuffleDataAsync` to return early and the send round of `sendShuffleDataAsync` could start asap.
> 
> The purpose of sending data concurrently is that once a request finished, the whole sending process would finish, which avoids busy/flaky servers.

 `rss.client.send.check.timeout.ms` is for limit the max time to finish send blocks to all replicas. And how to let it return early is what we need discuss.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ-7C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ_3R,incubator-uniffle,1328020945,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-26T10:27:32Z,2022-11-26T10:27:32Z,"> 
> > > `rss.client.send.check.timeout.ms=600000` `rss.client.retry.max=100` `rss.client.retry.interval.max=10000`
> > 
> > 
> > 100 * 10000 = 1000000 > 600000, This default values seems unreasonable.
> 
> But we should also solve this problem first.

Should we reduce `rss.client.retry.max` and `rss.client.retry.interval.max=10000` according to write replicas?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PJ_3R/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKASm,incubator-uniffle,1328022694,339,NA,xianjingfeng,11752250,,,NA,2022-11-26T10:41:31Z,2022-11-26T10:41:31Z,"> > > > `rss.client.send.check.timeout.ms=600000` `rss.client.retry.max=100` `rss.client.retry.interval.max=10000`
> > > 
> > > 
> > > 100 * 10000 = 1000000 > 600000, This default values seems unreasonable.
> > 
> > 
> > But we should also solve this problem first.
> 
> Should we reduce `rss.client.retry.max` and `rss.client.retry.interval.max=10000` according to write replicas?

I think it is ok.  And i think we should remove `rss.client.send.check.timeout.ms`, we can just control by `rss.client.retry.max` and `rss.client.retry.interval.max`. Otherwise, it's too complex and diffcult to control.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKASm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKLW-,incubator-uniffle,1328068030,339,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-26T15:41:11Z,2022-11-26T15:41:11Z,"> > > > > `rss.client.send.check.timeout.ms=600000` `rss.client.retry.max=100` `rss.client.retry.interval.max=10000`
> > > > 
> > > > 
> > > > 100 * 10000 = 1000000 > 600000, This default values seems unreasonable.
> > > 
> > > 
> > > But we should also solve this problem first.
> > 
> > 
> > Should we reduce `rss.client.retry.max` and `rss.client.retry.interval.max=10000` according to write replicas?
> 
> I think it is ok. And i think we should remove `rss.client.send.check.timeout.ms`, we can just control by `rss.client.retry.max` and `rss.client.retry.interval.max`. Otherwise, it's too complex and diffcult to control.

Could we check  `rss.client.send.check.timeout.ms`? If   `rss.client.send.check.timeout.ms` is less than `rss.client.retry.max * rss.client.retry.interval.max`, we throw an exception.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKLW-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/339,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKhwe,incubator-uniffle,1328159774,339,NA,xianjingfeng,11752250,,,NA,2022-11-27T03:03:23Z,2022-11-27T03:03:23Z,"> Could we check `rss.client.send.check.timeout.ms`? If `rss.client.send.check.timeout.ms` is less than `rss.client.retry.max * rss.client.retry.interval.max`, we throw an exception.

I’m ok","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PKhwe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/341,incubator-uniffle,1454824421,341,[FEATURE]  Support rack awareness,xianjingfeng,11752250,,,CLOSED,2022-11-18T10:07:26Z,2024-06-05T07:25:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support rack awareness for better performence.

### Motivation

If our tasks and shuffle servers are not in same rack or same data center,the load of the network switch will be very high, and the performance will be greatly affected. So we need support that the tasks send data to the closest shuffle servers as much as possible.

### Describe the solution

1. Assign rack information to each shuffle server and each compute nodes(such as Yarn Nodemanager/Kubernetes Node). We can store this information to hdfs or other external storage and manage by coordinator.
2. Implement a new `AssignmentStrategy`  that assign nodes in different racks as much as possible.
3. Client get its own rack information from coordinator and send data to the closest shuffle servers as much as possible.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/341/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Oqoce,incubator-uniffle,1319798558,341,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-18T10:13:20Z,2022-11-18T10:13:20Z,"Thanks for proposing this issue. I think it's necessary for the bigger uniffle cluster located in multiple DCs or racks. 

And currently maybe you could use the `tag` to indicate one kind of shuffle-servers but the spark jobs also should be specified the one `tag` . cc @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Oqoce/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrMWh,incubator-uniffle,1319945633,341,NA,xianjingfeng,11752250,,,NA,2022-11-18T12:41:35Z,2022-11-18T12:41:35Z,"> And currently maybe you could use the `tag` to indicate one kind of shuffle-servers

1. I know this feature. For us, it is better to use multiple clusters than tags.
2. Usually, we can't limit all task of one job to run in same rack or same DC.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrMWh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrVPl,incubator-uniffle,1319982053,341,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-18T13:15:55Z,2022-11-18T13:15:55Z,"> 2. Usually, we can't limit all task of one job to run in same rack or same DC.

But all map tasks will send the reduce task to one shuffle server.  I can't get your point. Why don't the `tag` solve your problems?

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrVPl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrXbm,incubator-uniffle,1319991014,341,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-18T13:24:36Z,2022-11-18T13:24:36Z,Could you give us an example?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrXbm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OreT8,incubator-uniffle,1320019196,341,NA,xianjingfeng,11752250,,,NA,2022-11-18T13:50:41Z,2022-11-18T13:50:41Z,"> But all map tasks will send the reduce task to one shuffle server

Not always. if we have 3 blocks(1 replicat) and 3 servers and we can send 1 block to each server.

> I can't get your point. Why don't the `tag` solve your problems?

If we have a job with 3 tasks: (task-1: rack-1, task-2: rack-2, task-3: rack-3)
And 3 servers with same `tag`: (server-1: rack-1, server-2: rack-2, server-3: rack-3)
And 3 blocks
task-1 send block-1 to server-2
task-2 send block-2 to server-3
task-3 send block-3 to server-1
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OreT8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrkrD,incubator-uniffle,1320045251,341,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-18T14:11:46Z,2022-11-18T14:11:46Z,"Emm.. A little tip, the `tag` is bound to job level. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OrkrD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OvbwJ,incubator-uniffle,1321057289,341,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-20T07:13:01Z,2022-11-20T07:13:01Z,"Maybe I got your point. If we have rack1, rack2, rack3. Rack2 may have lower latency than rack3 for rack1. If we have tasks in rack1, rack1 don't have free shuffle server, we should allocate rack2's shuffle server to the tasks. Tag can't be compared. Maybe @xianjingfeng want to introduce comparable properties to our scheduler strategy. Do I get your point?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OvbwJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Owjpx,incubator-uniffle,1321351793,341,NA,xianjingfeng,11752250,,,NA,2022-11-21T02:04:00Z,2022-11-21T02:04:00Z,"> Maybe I got your point. If we have rack1, rack2, rack3. Rack2 may have lower latency than rack3 for rack1. If we have tasks in rack1, rack1 don't have free shuffle server, we should allocate rack2's shuffle server to the tasks. Tag can't be compared. Maybe @xianjingfeng want to introduce comparable properties to our scheduler strategy. Do I get your point?

I am not sure. 
1.  `AssignmentStrategy` will assign nodes from different racks to a stage.
2.  When task send data to shuffle servers, it will send to the server in the same rack with it first.
3.  When task read data from shuffle servers, it will read from the server in the same rack with it first.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Owjpx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Owj5E,incubator-uniffle,1321352772,341,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-21T02:05:11Z,2022-11-21T02:05:11Z,"> > Maybe I got your point. If we have rack1, rack2, rack3. Rack2 may have lower latency than rack3 for rack1. If we have tasks in rack1, rack1 don't have free shuffle server, we should allocate rack2's shuffle server to the tasks. Tag can't be compared. Maybe @xianjingfeng want to introduce comparable properties to our scheduler strategy. Do I get your point?
> 
> I am not sure.
> 
> 1. `AssignmentStrategy` will assign nodes from different racks to a stage.
> 2. When task send data to shuffle servers, it will send to the server in the same rack with it first.
> 3. When task read data from shuffle servers, it will read from the server in the same rack with it first.

Is this a feature for multiple replicas?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Owj5E/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Owkaw,incubator-uniffle,1321354928,341,NA,xianjingfeng,11752250,,,NA,2022-11-21T02:08:08Z,2022-11-21T02:08:08Z,"> Is this a feature for multiple replicas?

Yes","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Owkaw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OzCW4,incubator-uniffle,1322001848,341,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-21T12:37:42Z,2022-11-21T12:37:42Z,"You'd better give us a simple design doc, refer to https://docs.google.com/document/d/1G0cOFVJbYLf2oX1fiadh7zi2M6DlEcjTQTh4kSkb0LA/edit?usp=sharing","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OzCW4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O5xNq,incubator-uniffle,1323766634,341,NA,xianjingfeng,11752250,,,NA,2022-11-22T14:30:40Z,2022-11-22T14:30:40Z,"> You'd better give us a simple design doc, refer to https://docs.google.com/document/d/1G0cOFVJbYLf2oX1fiadh7zi2M6DlEcjTQTh4kSkb0LA/edit?usp=sharing

I will","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O5xNq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6AGDwx,incubator-uniffle,2149071921,341,NA,xianjingfeng,11752250,,,NA,2024-06-05T07:25:53Z,2024-06-05T07:25:53Z,"Since we used LZ4, our network pressure has going down. And we now support reassign server for one partition. Use single replica seems is a better choice. So support rack awareness is unnecessary.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6AGDwx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/342,https://api.github.com/repos/apache/incubator-uniffle/issues/342,incubator-uniffle,1456541504,342,[Improvement] Check Spark Serializer type,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-11-19T15:26:55Z,2024-10-25T01:26:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Spark have multiple serializers. We support the spark serializer which  supportsRelocationOfSerializedObjects.  
You can see https://github.com/apache/spark/blob/25849684b78cca6651e25d6efc9644a576e7e20f/core/src/main/scala/org/apache/spark/serializer/Serializer.scala#L98
 
Spark have three kinds of serializer
org.apache.spark.serializer.JavaSerializer
org.apache.spark.sql.execution.UnsafeRowSerializer
org.apache.spark.serializer.KryoSerializer
Only org.apache.spark.serializer.JavaSerializer don't support RelocationOfSerializedObjects.
So when we find the parameters to use `org.apache.spark.serializer.JavaSerializer`, We should throw an exception, similar code that you can refer to https://github.com/apache/incubator-uniffle/blob/d09b40b90b8db613dbd346e0cd91f70f3950b430/client-spark/spark2/src/main/java/org/apache/spark/shuffle/RssShuffleManager.java#L141






### How should we improve?

check Serializer whether support  supportsRelocationOfSerializedObjects, if not, throw an exception.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/342/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/342,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6RO-Wz,incubator-uniffle,2436621747,342,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-10-25T01:26:46Z,2024-10-25T01:26:46Z,@jerqi Thanks to create this issue and we encountered this issue. Could you explain a bit more about why Uniffle cannot support a serializer which don't support `RelocationOfSerializedObjects`?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6RO-Wz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/343,https://api.github.com/repos/apache/incubator-uniffle/issues/343,incubator-uniffle,1456580121,343,[Improvement] Shade Netty Native lib,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-11-19T17:06:48Z,2023-06-10T04:01:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Our Netty only shade jar package, never shade netty package, If we use multiple version Netty, our client may be influenced.

### How should we improve?

We can refer to 
https://github.com/apache/spark/pull/24502
https://github.com/apache/incubator-celeborn/pull/908

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/343/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/343,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5drgOQ,incubator-uniffle,1571685264,343,NA,cchung100m,6762509,Neo Chien,,NA,2023-06-01T09:29:52Z,2023-06-01T09:29:52Z,"Hi @jerqi 

Do we still have this issue?  I'd like to work on it if yes.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5drgOQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/343,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dsCE6,incubator-uniffle,1571823930,343,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-01T10:56:36Z,2023-06-01T10:56:36Z,"> Hi @jerqi
> 
> Do we still have this issue? I'd like to work on it if yes.

Yes. You can go ahead.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dsCE6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/346,https://api.github.com/repos/apache/incubator-uniffle/issues/346,incubator-uniffle,1457483378,346,[Bug] `indexWriter` don't close if exception thrown when close `dataWriter ` in `HdfsShuffleWriteHandler`,xianjingfeng,11752250,,,CLOSED,2022-11-21T07:59:20Z,2022-11-22T15:28:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I found there are many threads in shuffle server as follows:

```
""DataStreamer for file /uniffle/data/application_1662640300316_231973311668726143398/4/138-138/10.xx.xx.xx-59999_0.index block BP-150738345-10.xx.xx.xx-1553601482353:blk_4236218692_3237686719"" #1062624
daemon prio=5 os_prio=0 tid=0x00007fb184030000 nid=0x1b323 in Object.wait() [0x00007faf48d0f000]
java.lang.Thread.State: TIMED_WAITING (on object monitor)
at java.lang.Object.wait(Native Method)
at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:417)
- locked <0x00007fba52000f90> (a java.util.LinkedList)

Locked ownable synchronizers:
- None
```

And all `DataStreamer` is for index file.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/346/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/346,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OyM3K,incubator-uniffle,1321782730,346,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-21T09:49:02Z,2022-11-21T09:49:02Z,Good catch!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5OyM3K/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/348,https://api.github.com/repos/apache/incubator-uniffle/issues/348,incubator-uniffle,1459526350,348,[Improvement] Periodically output a list of running apps in coordinator side,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-22T09:57:51Z,2023-02-02T02:55:50Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Periodically output a list of running apps in coordinator side, for better finding the running apps to analyze

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/348/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/348,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O4X0B,incubator-uniffle,1323400449,348,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-22T09:58:33Z,2022-11-22T09:58:33Z,Feel free to pick up this ~,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O4X0B/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/348,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O4sIj,incubator-uniffle,1323483683,348,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-22T10:54:42Z,2022-11-22T10:54:42Z,There may be many applications in the production environment. It's a risky operation.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O4sIj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/352,incubator-uniffle,1461177567,352,[Bug] inconsistent blocks number,lixy529,11569306,,,CLOSED,2022-11-23T07:14:29Z,2023-07-26T08:07:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Many tasks tasks of spark jobs will throw the exceptions that the inconsistent blocks number. The stacktrace is as follows:


org.apache.spark.SparkException: Job aborted due to stage failure: Task 2 in stage 9.0 failed 6 times, most recent failure: Lost task 2.5 in stage 9.0 (TID 7653, BJLFRZ-10k-152-228.hadoop.jd.local, executor 159): org.apache.uniffle.common.exception.RssException: Blocks read inconsistent: expected 7 blocks, actual 0 blocks
    at org.apache.uniffle.client.impl.ShuffleReadClientImpl.checkProcessedBlockIds(ShuffleReadClientImpl.java:215)
    at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:135)
    at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
    at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:227)
    at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
    at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:458)
    at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage6.processNext(Unknown Source)
    at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)
    at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:768)
    at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:458)
    at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:134)
    at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
    at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)
    at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)
    at org.apache.spark.scheduler.Task.run(Task.scala:129)
    at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:467)
    at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1478)
    at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:470)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
    at java.lang.Thread.run(Thread.java:745)

Driver stacktrace:
    at org.apache.spark.scheduler.DAGScheduler.failJobAndIndependentStages(DAGScheduler.scala:2083)
    at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2(DAGScheduler.scala:2032)
    at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2$adapted(DAGScheduler.scala:2031)
    at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
    at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
    at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
    at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:2031)
    at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1(DAGScheduler.scala:979)
    at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1$adapted(DAGScheduler.scala:979)
    at scala.Option.foreach(Option.scala:407)
    at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:979)
    at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:2263)
    at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2212)
    at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2201)
    at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49)
Caused by: org.apache.uniffle.common.exception.RssException: Blocks read inconsistent: expected 7 blocks, actual 0 blocks
    at org.apache.uniffle.client.impl.ShuffleReadClientImpl.checkProcessedBlockIds(ShuffleReadClientImpl.java:215)
    at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:135)
    at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
    at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:227)
    at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
    at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:458)
    at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage6.processNext(Unknown Source)
    at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)
    at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:768)
    at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:458)
    at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:134)
    at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
    at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)

### Affects Version(s)

0.6.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

```yaml
rss.coordinator.quorum=xxx:19999,xxx:19999,xxx:19999
rss.jetty.http.port=19998
rss.prometheus.push.enabled=true
rss.prometheus.uniffle.cluster.name=test100
rss.rpc.executor.size=2000
rss.rpc.message.max.size=1073741824
rss.rpc.server.port=19999
rss.server.app.expired.withoutHeartbeat=120000
rss.server.buffer.capacity=30g
rss.server.commit.timeout=600000
rss.server.flush.cold.storage.threshold.size=64m
rss.server.flush.thread.alive=5
rss.server.flush.threadPool.size=10
rss.server.heartbeat.interval=10000
rss.server.heartbeat.timeout=60000
rss.server.localstorage.initialize.max.fail.number=6
rss.server.preAllocation.expired=120000
rss.server.read.buffer.capacity=15g
rss.storage.type=MEMORY_HDFS
```


### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/352/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O9Lqx,incubator-uniffle,1324661425,352,NA,xianjingfeng,11752250,,,NA,2022-11-23T07:42:44Z,2022-11-23T07:42:44Z,Maybe #276 is help for you. Coming soon.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O9Lqx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O-Ft3,incubator-uniffle,1324899191,352,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-23T11:18:42Z,2022-11-23T11:18:42Z,Could you try to use the master code?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O-Ft3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PDPvb,incubator-uniffle,1326250971,352,NA,lixy529,11569306,,,NA,2022-11-24T10:24:52Z,2022-11-24T10:24:52Z,"> Maybe #276 is help for you. Coming soon.

The patch has been updated. The problem still exists.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PDPvb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PDQF6,incubator-uniffle,1326252410,352,NA,lixy529,11569306,,,NA,2022-11-24T10:26:13Z,2022-11-24T10:26:13Z,"> Could you try to use the master code?

Let me try","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PDQF6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PD36I,incubator-uniffle,1326415496,352,NA,lixy529,11569306,,,NA,2022-11-24T12:55:38Z,2022-11-24T12:55:38Z,"> Could you try to use the master code?

The same problem exists with the master version.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PD36I/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PD5Rl,incubator-uniffle,1326421093,352,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-24T13:00:50Z,2022-11-24T13:00:50Z,Could you give me the shuffle server's log? What's your shuffle data size and job's concurrency? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PD5Rl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PD7mR,incubator-uniffle,1326430609,352,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-24T13:08:13Z,2022-11-24T13:08:13Z,"Maybe you should give me the executor's logs, too.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PD7mR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfTRo,incubator-uniffle,1333605480,352,NA,lixy529,11569306,,,NA,2022-12-01T11:15:14Z,2022-12-01T11:15:14Z,"Problems with the company's HADOOP version,
Now it is resolved.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfTRo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZkSU,incubator-uniffle,1650869396,352,NA,smlHao,3837738,,,NA,2023-07-26T02:16:27Z,2023-07-26T02:16:27Z,"> Problems with the company's HADOOP version, Now it is resolved.

@lixy529 @jerqi  

 I meet same error,  build uniffle   must match HADOOP version ?  
company's HADOOP version is 3.3.4,  the build command should be  ./build_distribution.sh --hadoop-profile hadoop3.3 ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZkSU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZks2,incubator-uniffle,1650871094,352,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-26T02:18:48Z,2023-07-26T02:18:48Z,We don't verify the Hadoop version 3.3. We only verify the Hadoop version 3.2.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZks2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZo-s,incubator-uniffle,1650888620,352,NA,smlHao,3837738,,,NA,2023-07-26T02:42:49Z,2023-07-26T02:42:49Z,"> We don't verify the Hadoop version 3.3. We only verify the Hadoop version 3.2.

@jerqi  thanks !!!   have another 2 questions need your help :
            1、if hadoop version is 3.3,  no matter whether it's correct or not ，the build command should be ./build_distribution.sh --hadoop-profile hadoop3.3 ?

          2、want to  write shuffle data into hdfs ， my conf is correct ？ 
                client.conf : 
                                 spark.shuffle.manager=org.apache.spark.shuffle.RssShuffleManager
                                 spark.rss.coordinator.quorum=172.100.3.70:19999,172.100.3.71:19999,172.100.3.72:19999
                                 spark.rss.storage.type=MEMORY_LOCALFILE_HDFS
                                 spark.rss.remote.storage.path=hdfs://ns1/rss/data

                coordinator.conf:
                                           rss.coordinator.quorum 172.100.3.70:19999,172.100.3.71:19999,172.100.3.72:19999
                                           rss.rpc.server.port 19999
                                           rss.jetty.http.port 19998
                                           rss.coordinator.server.heartbeat.timeout 30000
                                           rss.coordinator.app.expired 60000
                                           rss.coordinator.shuffle.nodes.max 3
                                           rss.coordinator.exclude.nodes.file.path file:///app/rss-0.7.1/conf/exclude_nodes

                     server.conf：
                                          rss.rpc.server.port 20000
                                          rss.jetty.http.port 20001
                                          rss.storage.basePath /app/rss-0.7.1/data
                                          rss.storage.type MEMORY_LOCALFILE_HDFS
                                          rss.coordinator.quorum 172.100.3.70:19999,172.100.3.71:19999,172.100.3.72:19999
            ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZo-s/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZpnT,incubator-uniffle,1650891219,352,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-26T02:46:26Z,2023-07-26T02:46:26Z,"> > We don't verify the Hadoop version 3.3. We only verify the Hadoop version 3.2.
> 
> @jerqi thanks !!! have another 2 questions need your help : 1、if hadoop version is 3.3, no matter whether it's correct or not ，the build command should be ./build_distribution.sh --hadoop-profile hadoop3.3 ?
> 
> ```
>       2、want to  write shuffle data into hdfs ， my conf is correct ？ 
>             client.conf : 
>                              spark.shuffle.manager=org.apache.spark.shuffle.RssShuffleManager
>                              spark.rss.coordinator.quorum=172.100.3.70:19999,172.100.3.71:19999,172.100.3.72:19999
>                              spark.rss.storage.type=MEMORY_LOCALFILE_HDFS
>                              spark.rss.remote.storage.path=hdfs://ns1/rss/data
> 
>             coordinator.conf:
>                                        rss.coordinator.quorum 172.100.3.70:19999,172.100.3.71:19999,172.100.3.72:19999
>                                        rss.rpc.server.port 19999
>                                        rss.jetty.http.port 19998
>                                        rss.coordinator.server.heartbeat.timeout 30000
>                                        rss.coordinator.app.expired 60000
>                                        rss.coordinator.shuffle.nodes.max 3
>                                        rss.coordinator.exclude.nodes.file.path file:///app/rss-0.7.1/conf/exclude_nodes
> 
>                  server.conf：
>                                       rss.rpc.server.port 20000
>                                       rss.jetty.http.port 20001
>                                       rss.storage.basePath /app/rss-0.7.1/data
>                                       rss.storage.type MEMORY_LOCALFILE_HDFS
>                                       rss.coordinator.quorum 172.100.3.70:19999,172.100.3.71:19999,172.100.3.72:19999
> ```

1. Yes
2. Ok for me. ` rss.coordinator.shuffle.nodes.max` is a little small.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZpnT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZwx6,incubator-uniffle,1650920570,352,NA,smlHao,3837738,,,NA,2023-07-26T03:26:13Z,2023-07-26T03:26:13Z,"
@jerqi  thanks !!!

> rss.coordinator.shuffle.nodes.max is a little small.
      only deployed them in 3 machines,   every machine  had deployed one coordinator server and shuffle server ， if don`t increase machine  and shuffle server instances，only increase  coordinator server instances  is useful ?
     
     

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iZwx6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iah_u,incubator-uniffle,1651122158,352,NA,smlHao,3837738,,,NA,2023-07-26T07:21:05Z,2023-07-26T07:21:05Z,"> @jerqi thanks !!!
> 
> > rss.coordinator.shuffle.nodes.max is a little small.
> > only deployed them in 3 machines,   every machine  had deployed one coordinator server and shuffle server ， if don`t increase machine  and shuffle server instances，only increase  coordinator server instances  is useful ?

@jerqi  Could you help me explain this ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iah_u/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iapy4,incubator-uniffle,1651154104,352,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-26T07:43:37Z,2023-07-26T07:43:37Z,"> > @jerqi thanks !!!
> > > rss.coordinator.shuffle.nodes.max is a little small.
> > > only deployed them in 3 machines,   every machine  had deployed one coordinator server and shuffle server ， if don`t increase machine  and shuffle server instances，only increase  coordinator server instances  is useful ?
> 
> @jerqi Could you help me explain this ?

We should increase server instances.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iapy4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/352,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iayQi,incubator-uniffle,1651188770,352,NA,smlHao,3837738,,,NA,2023-07-26T08:07:06Z,2023-07-26T08:07:06Z,"> > > @jerqi thanks !!!
> > > > rss.coordinator.shuffle.nodes.max is a little small.
> > > > only deployed them in 3 machines,   every machine  had deployed one coordinator server and shuffle server ， if don`t increase machine  and shuffle server instances，only increase  coordinator server instances  is useful ?
> > 
> > 
> > @jerqi Could you help me explain this ?
> 
> We should increase server instances.

@jerqi  got it , thanks !!!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iayQi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/353,https://api.github.com/repos/apache/incubator-uniffle/issues/353,incubator-uniffle,1461222303,353,[Bug][AQE][LocalOrder] Incorrect check of discontinuous blocks  ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-23T07:49:10Z,2022-11-24T06:54:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I think we misunderstand the [startMapIndex, endMapIndex). the index is not the map task id, which only indicate the range of the succeed map task ids set. 

So that means. if the range is [0, 5), it only indicate the number of tasks is 5. And the task id list may be as follows:

`[task-1, task-3, task-9, task-15, task-16]`

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/353/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/353,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O9M62,incubator-uniffle,1324666550,353,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-23T07:49:23Z,2022-11-23T07:49:23Z,PTAL @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O9M62/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/353,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O9SUc,incubator-uniffle,1324688668,353,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-23T08:13:40Z,2022-11-23T08:13:40Z,I have told you this problem. They're related although they're not same. Now we don't have other mechanism to know mapIndex.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5O9SUc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/356,https://api.github.com/repos/apache/incubator-uniffle/issues/356,incubator-uniffle,1462832519,356,[Improvement] Make the startup of QuotaManager a configuration item,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2022-11-24T06:33:00Z,2022-11-26T07:00:34Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Avoid invalid startup of QuataManager.

### How should we improve?

Whether `AccessQuotaChecker` is configured for the `rss.coordinator.access.checkers` parameter controls the startup of the `QuotaManager`

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/356/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/356,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PCXOV,incubator-uniffle,1326019477,356,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-11-24T06:40:28Z,2022-11-24T06:40:28Z,cc @jerqi @xianjingfeng Do you have any other good suggestion?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PCXOV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/356,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PCX9T,incubator-uniffle,1326022483,356,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-24T06:44:34Z,2022-11-24T06:44:34Z,"> cc @jerqi @xianjingfeng Do you have any other good suggestion?

It's ok for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PCX9T/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/356,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PGlaJ,incubator-uniffle,1327126153,356,NA,xianjingfeng,11752250,,,NA,2022-11-25T07:56:01Z,2022-11-25T07:56:01Z,"> cc @jerqi @xianjingfeng Do you have any other good suggestion?

It's ok for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PGlaJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/363,https://api.github.com/repos/apache/incubator-uniffle/issues/363,incubator-uniffle,1465718238,363,[Improvement] Make the coordinator client managed by CoordinatorClientFactory singleton,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-28T02:53:45Z,2023-12-25T02:09:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We should make the coordinator client managed by `CoordinatorClientFactory` singleton like the `ShuffleServerClientFactory` does. 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/363/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/363,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fG3cb,incubator-uniffle,1595635483,363,NA,cchung100m,6762509,Neo Chien,,NA,2023-06-17T05:52:24Z,2023-06-17T05:52:24Z,"Hi @zuston 

It's been a while since this issue existed and I'd like to help it if nobody is working on it currently.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fG3cb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/363,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fG4Mn,incubator-uniffle,1595638567,363,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-06-17T06:03:02Z,2023-06-17T06:03:02Z,Feel free to pick up,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fG4Mn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/363,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u0Swt,incubator-uniffle,1859202093,363,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-12-17T15:28:03Z,2023-12-17T15:28:03Z,How about let's me try and contribute the issue if no body try it.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u0Swt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/366,https://api.github.com/repos/apache/incubator-uniffle/issues/366,incubator-uniffle,1466094234,366,Flaky Test: HealthCheckCoordinatorGrpcTest#healthCheckTest,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2022-11-28T09:33:51Z,2023-03-10T12:21:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 17.388 s <<< FAILURE! - in org.apache.uniffle.test.HealthCheckCoordinatorGrpcTest
Error:  healthCheckTest  Time elapsed: 16.174 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <false> but was: <true>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertFalse.assertFalse(AssertFalse.java:40)
	at org.junit.jupiter.api.AssertFalse.assertFalse(AssertFalse.java:35)
	at org.junit.jupiter.api.Assertions.assertFalse(Assertions.java:227)
	at org.apache.uniffle.test.HealthCheckCoordinatorGrpcTest.healthCheckTest(HealthCheckCoordinatorGrpcTest.java:129)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)

```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3562833470/jobs/5985718121#step:4:3114

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/366/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/366,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPrjJ,incubator-uniffle,1463728329,366,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-10T12:21:08Z,2023-03-10T12:21:08Z,closed by #707,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPrjJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/367,https://api.github.com/repos/apache/incubator-uniffle/issues/367,incubator-uniffle,1466097415,367,Flaky Test: ShuffleFlushManagerOnKerberizedHdfsTest,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2022-11-28T09:36:14Z,2022-11-28T09:37:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 57.336 s <<< FAILURE! - in org.apache.uniffle.server.ShuffleFlushManagerOnKerberizedHdfsTest
Error:  clearTest  Time elapsed: 51.15 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: Unexpected flush process
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:39)
	at org.junit.jupiter.api.Assertions.fail(Assertions.java:134)
	at org.apache.uniffle.server.ShuffleFlushManagerTest.waitForFlush(ShuffleFlushManagerTest.java:354)
	at org.apache.uniffle.server.ShuffleFlushManagerOnKerberizedHdfsTest.clearTest(ShuffleFlushManagerOnKerberizedHdfsTest.java:120)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3562833470/jobs/5985718121#step:6:2905

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/367/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/367,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PM66S,incubator-uniffle,1328787090,367,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2022-11-28T09:37:08Z,2022-11-28T09:37:08Z,Duplicated with #196 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PM66S/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/368,https://api.github.com/repos/apache/incubator-uniffle/issues/368,incubator-uniffle,1466166337,368,Flaky Test: WriteAndReadMetricsTest,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-11-28T10:21:40Z,2023-01-29T06:05:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

WriteAndReadMetricsTest

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3561366125/jobs/5986509018

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/368/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/368,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5djZ,incubator-uniffle,1407572185,368,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-29T06:05:04Z,2023-01-29T06:05:04Z,"This issue duplicates with #409.
Closing this because #409 is more detailed.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5djZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/369,https://api.github.com/repos/apache/incubator-uniffle/issues/369,incubator-uniffle,1467339537,369,[Improvement]  Exception should not be thrown if some blocks are corrupted,xianjingfeng,11752250,,,CLOSED,2022-11-29T02:10:08Z,2022-11-29T08:19:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

If some blocks are corrupted, exception will be thrown as follow.

`Unexpected crc value for blockId[448790975], expected:285387211, actual:2273523473`

Maybe other replicas are not corrupted, so exception should not  be thrown here.

### How should we improve?

Just print logs if  block is corrupted.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/369/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/369,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PRgYO,incubator-uniffle,1329989134,369,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-29T02:19:38Z,2022-11-29T02:19:38Z,"For single replica, it will help us fail fast.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PRgYO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/371,https://api.github.com/repos/apache/incubator-uniffle/issues/371,incubator-uniffle,1467505850,371,Flaky Test: PartitionBalanceCoordinatorGrpcTest,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-11-29T06:05:14Z,2023-07-11T08:23:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 4.239 s <<< FAILURE! - in org.apache.uniffle.test.PartitionBalanceCoordinatorGrpcTest
Error:  getShuffleAssignmentsTest  Time elapsed: 3.24 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <20001> but was: <20002>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:527)
	at org.apache.uniffle.test.PartitionBalanceCoordinatorGrpcTest.getShuffleAssignmentsTest(PartitionBalanceCoordinatorGrpcTest.java:98)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3570753180/jobs/6002010978
https://github.com/apache/incubator-uniffle/actions/runs/4516940829/jobs/7955749162?pr=759
https://github.com/apache/incubator-uniffle/actions/runs/5517393179/jobs/10059951405?pr=1002
### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/371/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/372,incubator-uniffle,1467521113,372,[Improvement] Mark app data lost when encountering events dropped,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-11-29T06:21:22Z,2022-11-30T06:42:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When shuffle-server encounters disk problems and triggers the mechanism of dropping events, we should mark the app data lost.

After then, we could reject the write/read requests by these apps to make job fast fail. 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/372/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSGFN,incubator-uniffle,1330143565,372,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-29T06:21:51Z,2022-11-29T06:21:51Z,@xianjingfeng @jerqi PTAL. I think this is an improvement.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSGFN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSGXG,incubator-uniffle,1330144710,372,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-29T06:23:43Z,2022-11-29T06:23:43Z,"> @xianjingfeng @jerqi PTAL. I think this is an improvement.
 
For multi replicas, it won't be suitable. Because one replica don't need store complete data for multi replicas.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSGXG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSGtV,incubator-uniffle,1330146133,372,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-29T06:25:56Z,2022-11-29T06:25:56Z,"> > @xianjingfeng @jerqi PTAL. I think this is an improvement.
> 
> For multi replicas, it won't be suitable. Because one replica don't need store complete data for multi replicas.

I missed this point. So maybe we need to make job fast fail only when single replica is enabled? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSGtV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSIKx,incubator-uniffle,1330152113,372,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-29T06:35:26Z,2022-11-29T06:35:26Z,"> > > @xianjingfeng @jerqi PTAL. I think this is an improvement.
> > 
> > 
> > For multi replicas, it won't be suitable. Because one replica don't need store complete data for multi replicas.
> 
> I missed this point. So maybe we need to make job fast fail only when single replica is enabled?

Server don't have replica concept.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSIKx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PX_Zd,incubator-uniffle,1331689053,372,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-30T06:11:09Z,2022-11-30T06:11:09Z,We could populate this replica concept into ShuffleTaskInfo when client registers to shuffle-server.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PX_Zd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYB_u,incubator-uniffle,1331699694,372,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-30T06:28:05Z,2022-11-30T06:28:05Z,"We should be careful about involving the replica concept in server. Especially, we need modify rpc proto. I think this will be an important concept. How to development the concept in the future? This is what we need to think of?
It's better to ask @xianjingfeng for some advice. Because he has more business needs about production environment on multi replicas.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYB_u/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYCcd,incubator-uniffle,1331701533,372,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-30T06:31:04Z,2022-11-30T06:31:04Z,Feel free to discuss more. Now we also suffer from the problem of single partition data too large and need this to make job fast fail to improve stability.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYCcd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYDak,incubator-uniffle,1331705508,372,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-30T06:37:28Z,2022-11-30T06:37:28Z,"> Feel free to discuss more. Now we also suffer from the problem of single partition data too large and need this to make job fast fail to improve stability.

For huge shuffle, we really recommend to use MEMORY_LOCALFILE_HDFS. You can use a large value `rss.server.flush.cold.storage.threshold.size` to reduce the data size of shuffle which were written to HDFS.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYDak/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYDqT,incubator-uniffle,1331706515,372,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-30T06:39:08Z,2022-11-30T06:39:08Z,"> > Feel free to discuss more. Now we also suffer from the problem of single partition data too large and need this to make job fast fail to improve stability.
> 
> For huge shuffle, we really recommend to use MEMORY_LOCALFILE_HDFS. You can use a large value `rss.server.flush.cold.storage.threshold.size` to reduce the data size of shuffle which were written to HDFS.

Yes. I have to evaluate this proposal of `MEMORY_LOCALFILE_HDFS`. 

Anyway, this issue is still reasonable.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYDqT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYELg,incubator-uniffle,1331708640,372,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-30T06:42:34Z,2022-11-30T06:42:34Z,"> Anyway, this issue is still reasonable.

Yes. you're right. 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYELg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/372,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYEMn,incubator-uniffle,1331708711,372,NA,xianjingfeng,11752250,,,NA,2022-11-30T06:42:41Z,2022-11-30T06:42:41Z,I think it is possible that both disk and hdfs can't be write. Maybe because of the network or GC. I am ok if just for one replica. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PYEMn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/373,https://api.github.com/repos/apache/incubator-uniffle/issues/373,incubator-uniffle,1467558358,373,[Improvement] Optimize local disk selection strategy,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-11-29T07:04:31Z,2024-11-16T14:20:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

I want to raise this issue to improve stability when using MEMORY_LOCALFILE storage type. Maybe some issues will be as sub-tasks in this improvement.

The first improvement is to avoid all apps fail when single disk capacity reaches high-watermark. We could do below optimizations.

1. Introduce the metrics of TOP10 apps which use the number of written bytes #333 . 
2. Introduce the free space & total space metrics of every local disk
3. Introduce the pluggable disk selection strategy. Currently the disk will be selected based on the hash. Free-capacity based strategy should be supported.
4. Allow app write data to another disk when encountering the corresponding disk reaching high-watermark #306 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/373/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSN2U,incubator-uniffle,1330175380,373,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-11-29T07:05:57Z,2022-11-29T07:05:57Z,"PTAL @jerqi @xianjingfeng @leixm @smallzhongfeng @kaijchen 

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSN2U/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PTPiX,incubator-uniffle,1330444439,373,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-29T10:55:09Z,2022-11-29T10:55:09Z,3. We choose hash selection strategy. Because we want to reduce the size of meta data which  we need maintain in the memory.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PTPiX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXwzO,incubator-uniffle,1331629262,373,NA,xianjingfeng,11752250,,,NA,2022-11-30T04:26:57Z,2022-11-30T04:26:57Z,3. Can we use Consistent Hashing?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXwzO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QHCAl,incubator-uniffle,1344020517,373,NA,advancedxy,807537,,,NA,2022-12-09T08:50:21Z,2022-12-09T08:50:21Z,"> Introduce the pluggable disk selection strategy. Currently the disk will be selected based on the hash. Free-capacity based strategy should be supported.

Agreed. Currently the hash based strategy may cause unbalanced disk I/Os among different disks as app's shuffle patterns may vary dramatically.  Capacity and disk-stats based strategy is very nice to have.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QHCAl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QWhxN,incubator-uniffle,1348082765,373,NA,advancedxy,807537,,,NA,2022-12-13T09:51:53Z,2022-12-13T09:51:53Z,"> Introduce the free space & total space metrics of every local disk

@zuston how do you plan to collect these metrics? By using `df`, or any other fancy ways?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QWhxN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2tN6,incubator-uniffle,2480591738,373,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-11-16T14:19:59Z,2024-11-16T14:19:59Z,Interesting feature,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2tN6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/375,incubator-uniffle,1467663091,375,[Improvement]  HDFS_URI will be null if we run a single UT method.,xianjingfeng,11752250,,,CLOSED,2022-11-29T08:36:55Z,2022-11-30T04:23:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

HDFS_URI will be null if we run a single UT method.
https://github.com/apache/incubator-uniffle/blob/c503f8f8ee522f67551652c5821cc1a7feb92ef7/integration-test/common/src/test/java/org/apache/uniffle/test/ShuffleServerWithMemLocalHdfsTest.java#L59

Several other UTs have the same problem.

### How should we improve?

Assign value in `setupServers`

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/375/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSorG,incubator-uniffle,1330285254,375,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-29T08:48:13Z,2022-11-29T08:48:13Z,Could you give a way to reproduce the problem?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PSorG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PTKGP,incubator-uniffle,1330422159,375,NA,xianjingfeng,11752250,,,NA,2022-11-29T10:35:53Z,2022-11-29T10:35:53Z,"![sc-20221129181224](https://user-images.githubusercontent.com/11752250/204506904-b5e40816-34d4-48a3-a9ad-43175408a79d.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PTKGP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PTfsd,incubator-uniffle,1330510621,375,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-29T11:53:15Z,2022-11-29T11:53:15Z,"I can't reproduce it
<img width=""592"" alt=""企业微信截图_d2c7b81e-33b0-4067-ae64-ee6be96f5e39"" src=""https://user-images.githubusercontent.com/8159038/204522141-260d0ff8-bcdf-4544-9439-cc98387f8ff6.png"">
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PTfsd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXgYZ,incubator-uniffle,1331562009,375,NA,xianjingfeng,11752250,,,NA,2022-11-30T02:20:41Z,2022-11-30T02:20:41Z,"> I can't reproduce it 

Not run `ShuffleServerWithMemLocalHdfsTest`.
Try to run `ShuffleServerWithMemLocalHdfsTest.memoryLocalFileHDFSReadWithFilterTest`
It only appears when execute a single method
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXgYZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXgow,incubator-uniffle,1331563056,375,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-30T02:22:42Z,2022-11-30T02:22:42Z,"> > I can't reproduce it
> 
> Not run `ShuffleServerWithMemLocalHdfsTest`. Try to run `ShuffleServerWithMemLocalHdfsTest.memoryLocalFileHDFSReadWithFilterTest` It only appears when execute a single method

This is the result that I run `ShuffleServerWithMemLocalHdfsTest.memoryLocalFileHDFSReadWithFilterTest`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXgow/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXiX9,incubator-uniffle,1331570173,375,NA,xianjingfeng,11752250,,,NA,2022-11-30T02:36:02Z,2022-11-30T02:36:02Z,"It seems that different IDE versions have different results.:thinking: Mine is IDEA 2022.2.3
Start command as follow
```shell
/usr/local/jdk18/bin/java -ea -ea -Xmx3g -Didea.test.cyclic.buffer.size=1048576 -javaagent:xxx/lib/idea_rt.jar=35244:xxx/idea-IU-222.4345.14/bin -Dfile.encoding=UTF-8 -classpath xxx.jar com.intellij.rt.junit.JUnitStarter -ideVersion5 -junit5 org.apache.uniffle.test.ShuffleServerWithMemLocalHdfsTest,memoryLocalFileHDFSReadWithFilterTest
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXiX9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXiij,incubator-uniffle,1331570851,375,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-30T02:37:21Z,2022-11-30T02:37:21Z,Could the maven reproduce this problem?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXiij/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXjrA,incubator-uniffle,1331575488,375,NA,xianjingfeng,11752250,,,NA,2022-11-30T02:45:19Z,2022-11-30T02:45:19Z,"> Could the maven reproduce this problem?

```shell
mvn -Dtest=org.apache.uniffle.test.ShuffleServerWithMemLocalHdfsTest#memoryLocalFileHDFSReadWithFilterTest test
```
This is ok.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXjrA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXj2M,incubator-uniffle,1331576204,375,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-30T02:46:41Z,2022-11-30T02:46:41Z,"> > Could the maven reproduce this problem?
> 
> ```shell
> mvn -Dtest=org.apache.uniffle.test.ShuffleServerWithMemLocalHdfsTest#memoryLocalFileHDFSReadWithFilterTest test
> ```
> 
> This is ok.

I guess this problem is related to IDEA.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXj2M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXj5q,incubator-uniffle,1331576426,375,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-30T02:47:07Z,2022-11-30T02:47:07Z,So I think we should close this issue.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXj5q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXkqn,incubator-uniffle,1331579559,375,NA,xianjingfeng,11752250,,,NA,2022-11-30T02:53:21Z,2022-11-30T02:53:21Z,I think we should consider if it is reasonable first. Whether `@BeforeAll` of parent class is always execure before the assignment of static variables.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXkqn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXmgS,incubator-uniffle,1331587090,375,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-30T03:06:18Z,2022-11-30T03:06:18Z,I think that there is no problem about grammar.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PXmgS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/376,https://api.github.com/repos/apache/incubator-uniffle/issues/376,incubator-uniffle,1468327773,376,[Bug] Concurrency problems may occur when the ApplicationManager registerApplicationInfo,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2022-11-29T16:13:30Z,2022-12-03T13:21:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```
appAndTime.remove(uuidFromApp);
appAndTime.put(appId, currentTimeMillis);
```
In the process of `registerApplicationInfo` in `ApplicationManager`, we need to remove the uuid and re insert it into the registered appId. This process is not atomic and may cause concurrency problems.
```
int currentAppNum = appAndTimes.size();
if (currentAppNum >= defaultAppNum) {
    ...
}
```
When `AccessQuotaChecker` getting `appAndTimes.size()`, it may be the number of apps before putting appId after removing uuid.


### Affects Version(s)

0.7.0

### Uniffle Server Log Output

[ERROR] 2022-11-29 17:57:39,386 Grpc-199 AccessAppQuotaChecker check - Denied by AccessAppQuotaChecker => User: xxxx, current app num is: 104, default app num is: 80. We will reject this app[uuid=468366284-108712]

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/376/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/376,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PZOUk,incubator-uniffle,1332012324,376,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-11-30T11:32:38Z,2022-11-30T11:32:38Z,Good catch.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PZOUk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/378,incubator-uniffle,1470890326,378,[Improvement] Optimize data flushing and memory usage for huge partitions to improve stability ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-01T08:27:52Z,2023-01-27T09:06:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

### Background 

In our internal uniffle cluster, when using the storage type of `MEMORY_LOCALFILE,` the partial single huge partitions make disk reach high watermark, which make whole shuffle-server out-of-service due to full memory occupation.

### Possible solutions
1. ~~Using the storage type of `MEMORY_LOCALFILE_HDFS` with the fallback strategy of `LocalStorageManagerFallbackStrategy`. #235~~
> ~~After testing this mechanism, I found some bugs which make fallback invalid.~~
2. ~~Introduce the new strategy of dynamic disk selection #373~~
3. ~~Introduce partition size based strategy to flush single huge partition data to HDFS~~

~~Currently, I prefer `3th` solution. In which, we could use cold storage(HDFS) when cumulative size of a particular partition is above a specific threshold(like 50g?). Actually, if exclude the partial huge partitions, the disk free ratio of whole shuffle-server is 20%-30%.~~

#### Reasons
1. ~~We could avoid hotspot of a single shuffle server, which could use HDFS to distribute pressure.~~
2. ~~Especially useful when disk spaces of shuffle servers are limited, which cannot hold a super large shuffle partition.~~
3. ~~Compared with `1th` solution, it is more restrained for HDFS use and will not cause greater pressure. (Actually we don't want to accept much shuffle-data to HDFS with 3 replicas)~~
4. ~~Compared with 2th solution, it is more effective and have better performance.~~
5. ~~Only downgrade storage of partial huge partition jobs to HDFS, which is effective, especially when the HDFS cluster performance is not good.~~

### Final solution
The solution of handling huge partitions is to make it flush to HDFS directly and limit memory usage, all subtasks are as follows.

1. Speed up flushing partition data to HDFS. 
    - [x] #396
2. Introduce the memory usage limitation for huge partitions
    - [x] #458
    - [x] #471 
    - [x] #494 
    - [x] #505 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/378/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pefr_,incubator-uniffle,1333394175,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-01T08:29:40Z,2022-12-01T08:29:40Z,"After discussing with my mentor, I raise a new proposal. Feel free to discuss more. @xianjingfeng @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pefr_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PelM8,incubator-uniffle,1333416764,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T08:48:11Z,2022-12-01T08:48:11Z,"> After discussing with my mentor, I raise a new proposal. Feel free to discuss more. @xianjingfeng @jerqi

What's the advantage of this strategy compared with current strategy?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PelM8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PemFn,incubator-uniffle,1333420391,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-01T08:49:44Z,2022-12-01T08:49:44Z,"> > After discussing with my mentor, I raise a new proposal. Feel free to discuss more. @xianjingfeng @jerqi
> 
> What's the advantage of this strategy compared with current strategy?

Reasons have been attached. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PemFn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PemHM,incubator-uniffle,1333420492,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T08:49:47Z,2022-12-01T08:49:47Z,My concern about this strategy is that we need to maintain more partition meta. Will it give more gc pressure? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PemHM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PemzE,incubator-uniffle,1333423300,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T08:50:59Z,2022-12-01T08:50:59Z,"> > > After discussing with my mentor, I raise a new proposal. Feel free to discuss more. @xianjingfeng @jerqi
> > 
> > 
> > What's the advantage of this strategy compared with current strategy?
> 
> Reasons have been attached.

Current strategy have picked the most partition to HDFS. You can see our implement.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PemzE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Peoiw,incubator-uniffle,1333430448,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-01T08:54:15Z,2022-12-01T08:54:15Z,"Yes, I have tested this implementation. But it looks invalid when fallback to HDFS. But this is not a big problem.

The key of proposal is to avoid too much data into HDFS, we don't want to accept shuffle data 3 replica in HDFS. And sometimes, the performance is not good.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Peoiw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Peun_,incubator-uniffle,1333455359,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T09:12:35Z,2022-12-01T09:12:35Z,"> Yes, I have tested this implementation. But it looks invalid when fallback to HDFS. But this is not a big problem.
> 
> The key of proposal is to avoid too much data into HDFS, we don't want to accept shuffle data 3 replica in HDFS. And sometimes, the performance is not good.

You can set the data replica with hadoop configuration. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Peun_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pex39,incubator-uniffle,1333468669,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-01T09:23:37Z,2022-12-01T09:23:37Z,This will bring a great burden to the HDFS ops,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pex39/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pey4G,incubator-uniffle,1333472774,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T09:27:14Z,2022-12-01T09:27:14Z,"> This will bring a great burden to the HDFS ops

You misunderstand me. The replica num is a client configuration. We just modify the Spark's client. You can see https://github.com/apache/incubator-uniffle/blob/884921b6d7c5452f6f3548ebc87840071c6be81f/proto/src/main/proto/Rss.proto#L422 for details.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pey4G/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pezo_,incubator-uniffle,1333475903,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-01T09:29:47Z,2022-12-01T09:29:47Z,Let me take a look.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pezo_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfNLL,incubator-uniffle,1333580491,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T10:57:43Z,2022-12-01T10:57:43Z,"The data which was written to HDFS must be higher than a data size. If we write small data size, it will influence the performance of HDFS.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfNLL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfQOf,incubator-uniffle,1333592991,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-01T11:05:50Z,2022-12-01T11:05:50Z,"> The data which was written to HDFS must be higher than a data size. If we write small data size, it will influence the performance of HDFS.

I know this, so I hope to use hdfs as little as possible, only open for those huge partition data.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfQOf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfRin,incubator-uniffle,1333598375,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T11:09:40Z,2022-12-01T11:09:40Z,"If you write the data which partition size > 50G && event > 64MB, I feel that it's ok.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfRin/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pf-6k,incubator-uniffle,1333784228,378,NA,xianjingfeng,11752250,,,NA,2022-12-01T13:38:56Z,2022-12-01T13:38:56Z,"In our production environment the disk is enough in most of the time. And it is difficult to set the threshold of partition size, and this will result in reduced disk usage. So we prefer to write hdfs when the disk is full.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pf-6k/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P_Dq4,incubator-uniffle,1341930168,378,NA,ChengbingLiu,5031567,Chengbing Liu,lcbabc123cn@163.com,NA,2022-12-08T03:16:59Z,2022-12-08T03:16:59Z,"@jerqi Here is our scenario:

We co-located Uniffle shuffle servers with our YARN NodeManagers. Therefore the shuffle servers have limited memory (10-20 GB) and limited disk space (1-5 TB). However, there can be as many as 1k shuffle tasks on a shuffle server at the same time, with each task takes up only 1~2MB memory on the average.

When a super large shuffle partition comes in, one of the disks quickly reaches its high watermark and memory starts to flush directly to HDFS. Since each task has only a small size (1-2MB) in the memory, it could flush(append) to HDFS with only 1~2MB at a time even if the configured flush threshold `rss.server.flush.cold.storage.threshold.size` is 64MB.

IMO, the flush threshold works only with two preconditions:
1. The shuffle server has enough memory compared to concurrent shuffle tasks (otherwise the threshold may not be reached)
2. The shuffle server has enough disk space (otherwise small partitions may fallback to cold storage)

If either condition is not met, it's better to have another machanism to better utilize the limited memory/disk resources, instead of wasting them on a uncommonly large partition.

Please correct me if I'm wrong.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P_Dq4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P_GDg,incubator-uniffle,1341939936,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-08T03:31:02Z,2022-12-08T03:31:02Z,"> @jerqi Here is our scenario:
> 
> We co-located Uniffle shuffle servers with our YARN NodeManagers. Therefore the shuffle servers have limited memory (10-20 GB) and limited disk space (1-5 TB). However, there can be as many as 1k shuffle tasks on a shuffle server at the same time, with each task takes up only 1~2MB memory on the average.
> 
> When a super large shuffle partition comes in, one of the disks quickly reaches its high watermark and memory starts to flush directly to HDFS. Since each task has only a small size (1-2MB) in the memory, it could flush(append) to HDFS with only 1~2MB at a time even if the configured flush threshold `rss.server.flush.cold.storage.threshold.size` is 64MB.
> 
> IMO, the flush threshold works only with two preconditions:
> 
> 1. The shuffle server has enough memory compared to concurrent shuffle tasks (otherwise the threshold may not be reached)
> 2. The shuffle server has enough disk space (otherwise small partitions may fallback to cold storage)
> 
> If either condition is not met, it's better to have another machanism to better utilize the limited memory/disk resources, instead of wasting them on a uncommonly large partition.
> 
> Please correct me if I'm wrong.

Yes, you're right. But if we only write 2MB to HDFS directly, the HDFS will have poor performance.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P_GDg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QBwaT,incubator-uniffle,1342637715,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-08T12:13:55Z,2022-12-08T12:13:55Z,"> In our production environment the disk is enough in most of the time. And it is difficult to set the threshold of partition size, and this will result in reduced disk usage. So we prefer to write hdfs when the disk is full.

Yes, this is difficult to set the threshold of partition size. I still think existing mechanism is hard to solve the huge single partition, especially in our scenario mentioned by @ChengbingLiu . I want to share some practices that wants to solve this problem but failed.

## First case: 

I enable the storage type of MEMORY_LOCALFILE_HDFS and the conf of `rss.server.flush.cold.storage.threshold.size` is 100G. The buffer capacity is 10GB. The storage fallback strategy is `LocalStorageFallbackStrategy.`

When a huge single partition came and quickly it made the disk reach the high-watermark, it started to flush HDFS directly. However, unfortunately, because this huge partition occupies a large space in memory(6GB), the shuffle dataFlushEvent is large, which leads to the need to spend a longer time to consume. And this will cause other jobs to be unable to write data normally. The picture is shown below.

![ss1](https://user-images.githubusercontent.com/8609142/206440724-358272bd-14db-434a-93a7-4c79af39414d.png)


## Second case:

After above practice, I set the `rss.server.flush.cold.storage.threshold.size` to 128M, which means the partition buffer once reaches the 128M, it will directly flush to HDFS. 

However, unfortunately, this still is useless. Although the huge partition will generate several dataFlushEvents waiting to be flushed to a single HDFS file, but its writerHandler will hold the write lock to write one by one. So this will cause the flush thread pool busy but the writing speed is still slow.

1. And this also will cause other jobs to be unable to write data normally. 
2. Especially, when in one shuffle-server,  there are not many partitions, it will cause the local disk always empty. This is unreasonable.

The case's picture is shown below.

![ss2](https://user-images.githubusercontent.com/8609142/206442011-56beb683-c088-4ef1-8a7d-4f2c384d6d4d.png)


## Possible solution
The above problem is hard to avoid in production environment. I think we need to introduce new strategy to solve. The following solutions are just draft

1. Introduce the blacklist of a app based on its flushed size, once reached, shuffle-server will let it allow to get limited memory and flush data to HDFS directly
2. Client could get the multiple candidates(multiple shuffle-servers for one partition, not multiple replica). Once written failed in one shuffle-server, it could write data to another shuffle-server, which will distribute the huge data pressure to uniffle cluster. After all, the overall disk utilization rate of the cluster is relatively low

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QBwaT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QB4UC,incubator-uniffle,1342670082,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-08T12:40:14Z,2022-12-08T12:40:14Z,"Maybe we could introduce multi-thread writing HDFS. If the file is too big, we could split them to multiple files. ByteDance CSS have similar concept. If file exceed the size, we will open and write another file.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QB4UC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QF_Ld,incubator-uniffle,1343746781,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-09T02:11:37Z,2022-12-09T02:11:37Z,"> Maybe we could introduce multi-thread writing HDFS. If the file is too big, we could split them to multiple files. 

Yes. The key of problem is the low speed of writing single one data file. 

> ByteDance CSS have similar concept. If file exceed the size, we will open and write another file.

Let me take a look. But I think writing another file is not a good solution, which wont improve the writing concurrency for multiple same partition events.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QF_Ld/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QGDFg,incubator-uniffle,1343762784,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-09T02:32:12Z,2022-12-09T02:32:12Z,"> > Maybe we could introduce multi-thread writing HDFS. If the file is too big, we could split them to multiple files.
> 
> Yes. The key of problem is the low speed of writing single one data file.
> 
> > ByteDance CSS have similar concept. If file exceed the size, we will open and write another file.
> 
> Let me take a look. But I think writing another file is not a good solution, which wont improve the writing concurrency for multiple same partition events.

I mean that we can write multiple files at the same time.
We can tryLock the file lock, we have multiple locks, if we succeed to tryLock, we can write the file. If we fail to tryLock, we will retry another file lock.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QGDFg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QGEfD,incubator-uniffle,1343768515,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-09T02:41:55Z,2022-12-09T02:41:55Z,"> I mean that we can write multiple files at the same time.
We can tryLock the file lock, we have multiple locks, if we succeed to tryLock, we can write the file. If we fail to tryLock, we will retry another file lock.

Got it. It's an optional solution, the flush speed could improve based on (HDFS speed) * (file number). 

And I think we also need to limit the huge partition app's writing speed to avoid affecting other jobs.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QGEfD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QGE4C,incubator-uniffle,1343770114,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-09T02:44:54Z,2022-12-09T02:44:54Z,"> > I mean that we can write multiple files at the same time.
> > We can tryLock the file lock, we have multiple locks, if we succeed to tryLock, we can write the file. If we fail to tryLock, we will retry another file lock.
> 
> Got it. It's an optional solution, the flush speed could improve based on (HDFS speed) * (file number).
> 
> And I think we also need to limit the huge partition app's writing speed to avoid affecting other jobs.

VIP Shop have similarly minds. cc @Gustfh ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QGE4C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QGltK,incubator-uniffle,1343904586,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-09T06:21:38Z,2022-12-09T06:21:38Z,"> > I mean that we can write multiple files at the same time.
> > We can tryLock the file lock, we have multiple locks, if we succeed to tryLock, we can write the file. If we fail to tryLock, we will retry another file lock.
> 
> Got it. It's an optional solution, the flush speed could improve based on (HDFS speed) * (file number).
> 

I feel that it's necessary. Because it will be too slow that the server only use single thread to flush a large partition although we have multiple servers.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QGltK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QG1t1,incubator-uniffle,1343970165,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-09T07:55:34Z,2022-12-09T07:55:34Z,"> I feel that it's necessary. Because it will be too slow that the server only use single thread to flush a large partition although we have multiple servers.

Make sense. I think I will do this optimization.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QG1t1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QH8j-,incubator-uniffle,1344260350,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-09T12:39:49Z,2022-12-09T12:39:49Z,"> > I feel that it's necessary. Because it will be too slow that the server only use single thread to flush a large partition although we have multiple servers.
> 
> Make sense. I think I will do this optimization.

Draft a PR #396 .

For this PR, it only solve the problem mentioned  by second case. But if the `ShuffleDataFlushEvent` is so huge(5G) to HDFS, it's still handled by single one thread. So we also need to generate multiple events from huge `ShuffleDataFlushEvent` to improve writing speed when flushing to HDFS.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QH8j-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RHLGZ,incubator-uniffle,1360834969,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-21T04:16:37Z,2022-12-21T04:16:37Z,"> Introduce the blacklist of a app based on its flushed size, once reached, shuffle-server will let it allow to get limited memory and flush data to HDFS directly

If the huge partition has the high writing speed and the speed of flushing is slow, the most memory will be occupied by huge partition's app. For ensuring the other apps stability, I prefer limiting the memory usage for huge partition. WDYT? @jerqi  cc @advancedxy ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RHLGZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R3SYx,incubator-uniffle,1373447729,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-06T10:30:50Z,2023-01-06T10:30:50Z,"This issue will track all the optimizations of huge partition, and all sub-tasks will be connected with this. The solution of handling huge partitions is to make it flush to HDFS directly and limit memory usage, all subtasks are as follows.

1. Speed up flushing partition data to HDFS. 
    - [x] https://github.com/apache/incubator-uniffle/pull/396
2. Introduce the memory usage limitation for huge partitions
    - [x] https://github.com/apache/incubator-uniffle/pull/458
    - [x] #471 
    - [x] #494 
    - [x] #505 
    - [ ] Introduce storage selector strategy(to support huge partition flushed to HDFS directly) in MultipleStorageManager to replace fallback strategy
3. Support split huge event into smaller multiple events concurrently to speed up flushing


cc @jerqi @advancedxy I will create some subtasks of issues and PRs, feel free to discuss more.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R3SYx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R3bE_,incubator-uniffle,1373483327,378,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-06T11:12:56Z,2023-01-06T11:12:56Z,"> This issue will track all the optimizations of huge partition, and all sub-tasks will be connected with this. The solution of handling huge partitions is to make it flush to HDFS directly and limit memory usage, all subtasks are as follows.
> 
> 1. Speed up flushing partition data to HDFS.
>    
>    * [x]  [Support writing multi files of single partition to improve speed in HDFS storage #396](https://github.com/apache/incubator-uniffle/pull/396)
> 2. Introduce the memory usage limitation for huge partitions
>    
>    * [ ]  Record every partition data size in `ShuffleTaskInfo`
>    * [ ]  Introduce storage selector strategy(to support huge partition flushed to HDFS directly) in MultipleStorageManager to replace fallback strategy
>    * [ ]  Introduce more metrics to monitor huge partitions and so on
> 3. Support split huge event into smaller multiple events concurrently to speed up flushing
> 
> cc @jerqi @advancedxy I will create some subtasks of issues and PRs, feel free to discuss more.

It's ok for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R3bE_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SDZ7j,incubator-uniffle,1376624355,378,NA,advancedxy,807537,,,NA,2023-01-10T02:06:42Z,2023-01-10T02:06:42Z,"> This issue will track all the optimizations of huge partition, and all sub-tasks will be connected with this. The solution of handling huge partitions is to make it flush to HDFS directly and limit memory usage, all subtasks are as follows.
> 
> 1. Speed up flushing partition data to HDFS.
>    
>    * [x]  [Support writing multi files of single partition to improve speed in HDFS storage #396](https://github.com/apache/incubator-uniffle/pull/396)
> 2. Introduce the memory usage limitation for huge partitions
>    
>    * [x]  [[ISSUE-378][HugePartition][Part-1] Record every partition data size for one app #458](https://github.com/apache/incubator-uniffle/pull/458)
>    * [ ]  Introduce storage selector strategy(to support huge partition flushed to HDFS directly) in MultipleStorageManager to replace fallback strategy
>    * [ ]  Introduce more metrics to monitor huge partitions and so on
> 3. Support split huge event into smaller multiple events concurrently to speed up flushing
> 
> cc @jerqi @advancedxy I will create some subtasks of issues and PRs, feel free to discuss more.

Missed this comment. LGTM.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SDZ7j/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/378,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T0Qif,incubator-uniffle,1406208159,378,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-27T09:06:35Z,2023-01-27T09:06:35Z,Closed. Feel free to open it if having any problem.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T0Qif/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/380,incubator-uniffle,1471110719,380,[Bug] Overlook fallback when data-flush event enters into pending queue,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-01T11:02:27Z,2022-12-08T11:41:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When using the storage type of `MEMORY_LOCALFILE_HDFS` and enable the fallback strategy of `LocalStorageManagerFallbackStrategy`, it will still fail when one disk reached high watermark.

After digging into the code, I found it is caused by the cache in MultiStorageManager when invoking the selectStorage in the method of `ShuffleFlushManager.processPendingEvents`, that make it lost the chance to use the fallback.

But after removing this cache, I still found it still fail, because this pending event's retries time always=0, so it will make fallback failed. 

So I rethink this pending queue. Do we really need this in multiple storage? I think perhaps not, we could remove this pending queue mechanism when multiple storage manager is enabled. Of course, it's still meaningful for single storage manager.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/380/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfPH2,incubator-uniffle,1333588470,380,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-01T11:03:13Z,2022-12-01T11:03:13Z,@xianjingfeng I found the fallback strategy is invalid. Could you help check this? CC @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfPH2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfQGu,incubator-uniffle,1333592494,380,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T11:05:31Z,2022-12-01T11:05:31Z,"> @xianjingfeng I found the fallback strategy is invalid. Could you help check this? CC @jerqi

I agree that we remove the pending queue. Because the concept is involved because we need to implement the function of HDFS upload.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfQGu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfQnV,incubator-uniffle,1333594581,380,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-01T11:06:55Z,2022-12-01T11:06:55Z,">  Of course, it's still meaningful for single storage manager.

Do you agree this? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfQnV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfR_4,incubator-uniffle,1333600248,380,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T11:11:08Z,2022-12-01T11:11:08Z,"> > Of course, it's still meaningful for single storage manager.
> 
> Do you agree this?

It seems that there is little impact. It's a little complicated. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfR_4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfbOZ,incubator-uniffle,1333638041,380,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-01T11:42:00Z,2022-12-01T11:42:00Z,@xianjingfeng WDYT?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PfbOZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgCul,incubator-uniffle,1333799845,380,NA,xianjingfeng,11752250,,,NA,2022-12-01T13:52:11Z,2022-12-01T13:52:11Z,I agree to remove the pending queue. We can retry write directly when we use single storage manager.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PgCul/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pjbni,incubator-uniffle,1334688226,380,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-02T02:33:48Z,2022-12-02T02:33:48Z,"Let's rethink the pending queue for single storage manager. 

If the single disk is corrupted or free space is full, all events will be pushed to the pending queue, events could re-enter into flush queue once disk becomes healthy within the pending timeout. I don't know the initial design reason of this. But I think it could avoid events being dropped as much as possible, especially when disk is temporary out-of-service.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pjbni/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PjcGj,incubator-uniffle,1334690211,380,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-02T02:37:24Z,2022-12-02T02:37:24Z,"> Let's rethink the pending queue for single storage manager.
> 
> If the single disk is corrupted or free space is full, all events will be pushed to the pending queue, events could re-enter into flush queue once disk becomes healthy within the pending timeout. I don't know the initial design reason of this. But I think it could avoid events being dropped as much as possible, especially when disk is temporary out-of-service.

Agree. If you insist on this, we could keep this feature. I just want to simplify this process.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PjcGj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/380,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QBkZd,incubator-uniffle,1342588509,380,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-08T11:41:44Z,2022-12-08T11:41:44Z,Fixed by #383 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QBkZd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/381,https://api.github.com/repos/apache/incubator-uniffle/issues/381,incubator-uniffle,1471430305,381,[Improvement] Should we must set JAVA_HOME and HADOOP_HOME in rss-env.sh,xianjingfeng,11752250,,,CLOSED,2022-12-01T14:38:49Z,2023-06-19T14:36:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Sometimes, we have already set JAVA_HOME  and HADOOP_HOME in our system, So should we must set JAVA_HOME and HADOOP_HOME in rss-env.sh?
https://github.com/apache/incubator-uniffle/blob/897613b8022ea73d5664904bbf43fc27f93505cc/bin/rss-env.sh#L24-L25

### How should we improve?

If `JAVA_HOME` or `HADOOP_HOME`  have not be set when start server, we can just tell the users to set it.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/381/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/381,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PjZK_,incubator-uniffle,1334678207,381,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-02T02:15:19Z,2022-12-02T02:15:19Z,"If we dont want to use HDFS storage, `HADOOP_HOME` is not necessary.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PjZK_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/381,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pja6X,incubator-uniffle,1334685335,381,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-02T02:28:30Z,2022-12-02T02:28:30Z,"> If we dont want to use HDFS storage, `HADOOP_HOME` is not necessary.

No. We need Hadoop jar to load some Coordniator's Configurations. It's necessary..","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pja6X/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/381,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pjb0S,incubator-uniffle,1334689042,381,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-02T02:35:17Z,2022-12-02T02:35:17Z,"> > If we dont want to use HDFS storage, `HADOOP_HOME` is not necessary.
> 
> No. We need Hadoop jar to load some Coordniator's Configurations. It's necessary..

My fault. You are right. All Hadoop filesystem operations rely on this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pjb0S/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/381,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eiWEo,incubator-uniffle,1586061608,381,NA,cchung100m,6762509,Neo Chien,,NA,2023-06-11T07:53:23Z,2023-06-11T07:53:23Z,"Hi @xianjingfeng 

It's been a while since this issue existing and I'd like to help it if nobody is working on it currently.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eiWEo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/384,https://api.github.com/repos/apache/incubator-uniffle/issues/384,incubator-uniffle,1472257449,384,[Improvement] Make coordinator class more organized,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-02T03:30:01Z,2022-12-06T07:39:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the class in coordinator package are all in single folder. We should make coordinator class more organized, and split them into different folders by their correlation.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/384/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/384,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PjjPM,incubator-uniffle,1334719436,384,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-02T03:33:03Z,2022-12-02T03:33:03Z,cc @smallzhongfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PjjPM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/384,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PjjbK,incubator-uniffle,1334720202,384,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-02T03:34:44Z,2022-12-02T03:34:44Z,"Oh. I encounter the github bug, which creates multiple duplicate issues.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PjjbK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/384,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pjtav,incubator-uniffle,1334761135,384,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-02T04:50:31Z,2022-12-02T04:50:31Z,"Sounds great. I think it is reasonable. At present, there are many classes of coordinator, including checkers, server selection strategy, etc. we can make a unified classification.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pjtav/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/384,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pj137,incubator-uniffle,1334795771,384,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-02T05:55:20Z,2022-12-02T05:55:20Z,Do you want to pick up this issue? @smallzhongfeng I could assign to you ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pj137/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/384,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pj6r7,incubator-uniffle,1334815483,384,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-02T06:25:17Z,2022-12-02T06:25:17Z,"Ok, let me come and please assign it to me. @zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pj6r7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/385,https://api.github.com/repos/apache/incubator-uniffle/issues/385,incubator-uniffle,1472257501,385,[Improvement] Make coordinator class more organized,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-02T03:30:07Z,2022-12-02T03:44:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the class in coordinator package are all in single folder. We should make coordinator class more organized, and split them into different folders by their correlation.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/385/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/385,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pjkft,incubator-uniffle,1334724589,385,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-02T03:44:02Z,2022-12-02T03:44:02Z,Closed due to duplication with https://github.com/apache/incubator-uniffle/issues/384,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pjkft/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/388,incubator-uniffle,1478005353,388,Flaky Test: GrpcServerTest#testGrpcExecutorPool,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-06T02:44:22Z,2023-07-19T07:01:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 4.137 s <<< FAILURE! - in org.apache.uniffle.common.GrpcServerTest
Error:  testGrpcExecutorPool  Time elapsed: 4.054 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <0.0> but was: <1.0>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:70)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:65)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:885)
	at org.apache.uniffle.common.GrpcServerTest.testGrpcExecutorPool(GrpcServerTest.java:83)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3625931180/jobs/6114463345

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/388/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PykoL,incubator-uniffle,1338657291,388,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-06T02:49:18Z,2022-12-06T02:49:18Z,Is `Flaky test` a good first issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PykoL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pyk6P,incubator-uniffle,1338658447,388,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-06T02:51:20Z,2022-12-06T02:51:20Z,Emm... Good question. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Pyk6P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PylGk,incubator-uniffle,1338659236,388,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-06T02:52:47Z,2022-12-06T02:52:47Z,"> Emm... Good question.

I feel it's difficult to fix flaky test.  WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PylGk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PylMe,incubator-uniffle,1338659614,388,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-06T02:53:31Z,2022-12-06T02:53:31Z,"If it's easy to fix, we should fix the flaky test immediately.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PylMe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PylrT,incubator-uniffle,1338661587,388,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-06T02:57:14Z,2022-12-06T02:57:14Z,"> > Emm... Good question.
> 
> I feel it's difficult to fix flaky test. WDYT?

Yes. Maybe if we have the clear fix solution or small easy features, it could be mark it as good first issue. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5PylrT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hMVi5,incubator-uniffle,1630623929,388,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-11T11:06:39Z,2023-07-11T11:06:39Z,"This problem still exists (https://github.com/apache/incubator-uniffle/actions/runs/5518411958/jobs/10062325314?pr=982).

The testGrpcExecutorPool has two state, then verify the metrics.
First state :  assert the metrics when two thread has already run, but the third thread is not running.
Second state: assert the metrics when all thread is done.

I think the problem is that we can't make sure to enter first state. Because the three thread only sleep 200ms, in this patch sleep 120ms to enter the first state, the mistake is only 80ms, it is too short.
In my laptop, I change 120ms to 190ms, the probability of reproduce this problem will be increased.

So I think two way to solve this problem:
(a) increased thread sleep time from 200ms to 1000ms
(b) do  not verify the first state.

@jerqi @zuston how about you?



 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hMVi5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hMXlz,incubator-uniffle,1630632307,388,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-11T11:13:10Z,2023-07-11T11:13:10Z,"> This problem still exists (https://github.com/apache/incubator-uniffle/actions/runs/5518411958/jobs/10062325314?pr=982).
> 
> The testGrpcExecutorPool has two state, then verify the metrics. First state : assert the metrics when two thread has already run, but the third thread is not running. Second state: assert the metrics when all thread is done.
> 
> I think the problem is that we can't make sure to enter first state. Because the three thread only sleep 200ms, in this patch sleep 120ms to enter the first state, the mistake is only 80ms, it is too short. In my laptop, I change 120ms to 190ms, the probability of reproduce this problem will be increased.
> 
> So I think two way to solve this problem: (a) increased thread sleep time from 200ms to 1000ms (b) do not verify the first state.
> 
> @jerqi @zuston how about you?

I prefer solution a.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hMXlz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h116I,incubator-uniffle,1641504392,388,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-19T06:40:32Z,2023-07-19T06:40:32Z,"> This problem still exists (https://github.com/apache/incubator-uniffle/actions/runs/5518411958/jobs/10062325314?pr=982).
> 
> The testGrpcExecutorPool has two state, then verify the metrics. First state : assert the metrics when two thread has already run, but the third thread is not running. Second state: assert the metrics when all thread is done.
> 
> I think the problem is that we can't make sure to enter first state. Because the three thread only sleep 200ms, in this patch sleep 120ms to enter the first state, the mistake is only 80ms, it is too short. In my laptop, I change 120ms to 190ms, the probability of reproduce this problem will be increased.
> 
> So I think two way to solve this problem: (a) increased thread sleep time from 200ms to 1000ms (b) do not verify the first state.
> 
> @jerqi @zuston how about you?

@zhengchenyu There is a fix. https://github.com/apache/incubator-uniffle/pull/1023","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h116I/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/388,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h17Z3,incubator-uniffle,1641526903,388,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-19T07:01:07Z,2023-07-19T07:01:07Z,"@jerqi  OK, #1023 is a great work indeed. Wait the condition is more reliable than reset the sleep time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5h17Z3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/389,incubator-uniffle,1481245316,389,[Improvement] Make codec to be a singleton.,xianjingfeng,11752250,,,CLOSED,2022-12-07T07:45:07Z,2023-04-25T09:48:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Codec will be created for many times.  We should make codec to be a singleton.

https://github.com/apache/incubator-uniffle/blob/8847ece10a21800e5deb608441fcc6129a6b841d/common/src/main/java/org/apache/uniffle/common/compression/Codec.java#L29-L40

### How should we improve?

Make codec to be a singleton.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/389/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P53gT,incubator-uniffle,1340569619,389,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-07T08:20:26Z,2022-12-07T08:20:26Z,Will it be thread safe?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P53gT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P55vA,incubator-uniffle,1340578752,389,NA,xianjingfeng,11752250,,,NA,2022-12-07T08:28:09Z,2022-12-07T08:28:09Z,"> Will it be thread safe?

Yes. In fact, the underlying codec is also a singleton.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P55vA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P5-CS,incubator-uniffle,1340596370,389,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-07T08:45:37Z,2022-12-07T08:45:37Z,cc @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P5-CS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P6AJn,incubator-uniffle,1340605031,389,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T08:54:28Z,2022-12-07T08:54:28Z,The zstd and snappy codec looks OK of singleton. But LZ4Codec looks unsupported.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P6AJn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P6Dt0,incubator-uniffle,1340619636,389,NA,xianjingfeng,11752250,,,NA,2022-12-07T09:07:27Z,2022-12-07T09:07:27Z,"> But LZ4Codec looks unsupported.

It seems that LZ4Codec is also singleton
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P6Dt0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XwLMU,incubator-uniffle,1472246548,389,NA,tobehardest,88612778,Yikun Chen,,NA,2023-03-16T15:56:01Z,2023-03-16T15:56:01Z,"I'm a newbie and I want to try to solve this problem, is it possible?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XwLMU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xwc6m,incubator-uniffle,1472319142,389,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-16T16:37:28Z,2023-03-16T16:37:28Z,I assign this issue to you. You can have a try.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xwc6m/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xwgkv,incubator-uniffle,1472334127,389,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-16T16:46:26Z,2023-03-16T16:46:26Z,"> The zstd and snappy codec looks OK of singleton. But LZ4Codec looks unsupported.

https://github.com/lz4/lz4-java/issues/82 Lz4 is thread safe. So it could be an singleton.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xwgkv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aLbVQ,incubator-uniffle,1512944976,389,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-18T11:49:58Z,2023-04-18T11:49:58Z,"> I'm a newbie and I want to try to solve this problem, is it possible?

Do you need any help from me?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aLbVQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5amyQ-,incubator-uniffle,1520116798,389,NA,tobehardest,88612778,Yikun Chen,,NA,2023-04-24T13:01:07Z,2023-04-24T13:01:07Z,"> > I'm a newbie and I want to try to solve this problem, is it possible?
> 
> Do you need any help from me?
Maybe i need.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5amyQ-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/389,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5anSum,incubator-uniffle,1520249766,389,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-24T14:17:45Z,2023-04-24T14:17:45Z,"> > > I'm a newbie and I want to try to solve this problem, is it possible?
> > 
> > 
> > Do you need any help from me?
> > Maybe i need.

@tobehardest Do you know Singleton pattern?  There is an example https://github.com/apache/incubator-uniffle/blob/master/internal-client/src/main/java/org/apache/uniffle/client/factory/ShuffleManagerClientFactory.java . You can refer to it.

The document is also useful for newbie. https://github.com/apache/incubator-uniffle/blob/master/CONTRIBUTING.md","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5anSum/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/390,https://api.github.com/repos/apache/incubator-uniffle/issues/390,incubator-uniffle,1481263287,390,[Improvement] Print more infos after read finished,xianjingfeng,11752250,,,CLOSED,2022-12-07T07:54:52Z,2022-12-10T07:49:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, we do not know how much data the client read from each server and how much data read from all server(include skipped data)

### How should we improve?

1. Print  how much data the client read from each server.
2. Print how much data read from all server(include skipped data)

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/390/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/391,incubator-uniffle,1481360713,391,[FEATURE]  Expect to support the filesystem not implementing the append-mode.,yuyang733,4209464,Yang Yu,yuyang_733@163.com,OPEN,2022-12-07T08:48:10Z,2023-01-16T06:36:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Cloud object storage and its corresponding accelerated cache are widely used in storage-computing separation architecture.  
But many of them may not implement the append-mode or the write amplification of the append-mode will be tricky.

Is it possible to consider supporting the way of independently storing each block as a data file at the same time?

### Motivation

Cloud object storage and its corresponding accelerated cache are widely used in storage-computing separation architecture.  
But many of them may not implement the append-mode or the write amplification of the append-mode will be tricky.

### Describe the solution

The initially envisaged solution is to implement a non-append abstract storage type, such as: `AbstractObjectStorageWriteHandler`, `AbstractObjectStorageReadHandler`, and `AbstractObjectDeleteHandler`,  and Implement the basic interface required by RSS in it. 

The implementation of the `read`, `write`, and `delete` interfaces placed in the specific storage layer can be implemented by subclasses.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/391/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7JGx,incubator-uniffle,1340903857,391,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T12:34:56Z,2022-12-07T12:34:56Z,"Do you mean that one dataFlushEvent could directly write a new single oss file? If so, how to maintain the index file? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7JGx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7LgO,incubator-uniffle,1340913678,391,NA,yuyang733,4209464,Yang Yu,yuyang_733@163.com,NA,2022-12-07T12:44:04Z,2022-12-07T12:44:04Z,"> Do you mean that one dataFlushEvent could directly write a new single oss file? If so, how to maintain the index file?

Aren't several blocks appended to a data file at present?  I want to write a block into a single data file, so it corresponds to an index file. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7LgO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7LwV,incubator-uniffle,1340914709,391,NA,yuyang733,4209464,Yang Yu,yuyang_733@163.com,NA,2022-12-07T12:44:56Z,2022-12-07T12:44:56Z,"> Do you mean that one dataFlushEvent could directly write a new single oss file? If so, how to maintain the index file?

Supply a way that supports the non-append storage.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7LwV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7Lxd,incubator-uniffle,1340914781,391,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T12:44:59Z,2022-12-07T12:44:59Z,"Could u help give a data layout picture, which includes the relations of data block and oss file name. 

Besides, we should also consider how to support the local_order in object store. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7Lxd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7MN9,incubator-uniffle,1340916605,391,NA,yuyang733,4209464,Yang Yu,yuyang_733@163.com,NA,2022-12-07T12:46:42Z,2022-12-07T12:46:42Z,"> Could u help give a data layout picture, which includes the relations of data block and oss file name.
> 
> Besides, we should also consider how to support the local_order in object store.

Okay, I will provide a design gram to describe it later.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7MN9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7MdH,incubator-uniffle,1340917575,391,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T12:47:36Z,2022-12-07T12:47:36Z,"> Aren't several blocks appended to a data file at present? 

Yes. I know it’s better to avoid using the append mode to improve the performance. But if the data layout is changed, do we need a index file? In the local file or HDFS storage type, the index file will maintain the relation of block offset in the single one file. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7MdH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7M9x,incubator-uniffle,1340919665,391,NA,yuyang733,4209464,Yang Yu,yuyang_733@163.com,NA,2022-12-07T12:49:36Z,2022-12-07T12:49:36Z,"> > Aren't several blocks appended to a data file at present?
> 
> Yes. I know it’s better to avoid using the append mode to improve the performance. But if the data layout is changed, do we need a index file? In the local file or HDFS storage type, the index file will maintain the relation of block offset in the single one file.

Great, thanks for reminding me, the index file seems to be not needed anymore.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7M9x/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7N8C,incubator-uniffle,1340923650,391,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T12:53:16Z,2022-12-07T12:53:16Z,"I have another question that will we directly use the object store api or to use the hadoop filesystem api to support this? 

If it is the former, maybe it’s better to introduce the uniffle dedicated filesystem api to wrap different concrete filesystems, also including the cos. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7N8C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7Omf,incubator-uniffle,1340926367,391,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T12:55:48Z,2022-12-07T12:55:48Z,"> the index file seems to be not needed anymore.

Emm.. Maybe not. If having no a index structure, it means we don’t a global view to find files we needed in object store, especially for local order. 

WDYT? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7Omf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7T2V,incubator-uniffle,1340947861,391,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-07T13:13:10Z,2022-12-07T13:13:10Z,Every data file should have index file.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7T2V/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7XEN,incubator-uniffle,1340961037,391,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T13:21:48Z,2022-12-07T13:21:48Z,"> Every data file should have index file.

The performance will not be good, as we have to read all index files in one time for doing split segments. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7XEN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7Xf4,incubator-uniffle,1340962808,391,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-07T13:23:16Z,2022-12-07T13:23:16Z,"> > Every data file should have index file.
> 
> The performance will not be good, as we have to read all index files in one time for doing split segments.

We can read only one index file.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7Xf4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7X9r,incubator-uniffle,1340964715,391,NA,yuyang733,4209464,Yang Yu,yuyang_733@163.com,NA,2022-12-07T13:24:57Z,2022-12-07T13:24:57Z,"> I have another question that will we directly use the object store api or to use the hadoop filesystem api to support this?
> 
> If it is the former, maybe it’s better to introduce the uniffle dedicated filesystem api to wrap different concrete filesystems, also including the cos.

In fact, Can an abstract storage layer be provided in uniffle, and each manufacturer implements the necessary storage interface?

It does not care whether the concrete class uses the native API (such as S3, etc) or the HCFS file system.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7X9r/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P73sK,incubator-uniffle,1341094666,391,NA,advancedxy,807537,,,NA,2022-12-07T15:01:53Z,2022-12-07T15:01:53Z,"> In fact, Can an abstract storage layer be provided in uniffle, and each manufacturer implements the necessary storage interface?

It may require a detailed design doc to illustrate your idea and proposal.

In fact, I believe uniffle(and other RSS systems also) makes a big assumption of filesystem capability, such as append support, if we want to support new storages and dropping append requirement, we should reconsider the data layout patterns and all the features it required such as read operation, data distribution, etc. cc @zuston and @LuciferYang.

P.S: I think it's nice to have object store as a new storage type supported, we just need to think it throughly, make sure it doesn't introduce too much complexity, and maintain the flexibility to extend more storages.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P73sK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P_Qfc,incubator-uniffle,1341982684,391,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2022-12-08T04:28:22Z,2022-12-08T04:28:22Z,"Thanks for ping me @advancedxy I am not very familiar with object storage, but I think it is better to design it separately to avoid incompatibility of data layout and negative impact on the performance of the current implementation","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P_Qfc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Sd26W,incubator-uniffle,1383558806,391,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-16T06:36:25Z,2023-01-16T06:36:25Z,"Any update on this? @yuyang733 cc @jerqi @advancedxy 

If object store is supported, I will use this to store huge partition to reduce HDFS pressure for iQiyi. And this is an important feature for uniffle","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Sd26W/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/392,incubator-uniffle,1481363002,392,[Bug] Cleanup the data of localStorageChecker's file to cause shuffle-server unhealthy,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-07T08:49:25Z,2022-12-08T11:36:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

This bug is caused by #357 

```
[INFO] 2022-12-07 16:27:51,411 leakShuffleDataChecker ShuffleTaskManager checkLeakShuffleData - Start check leak shuffle data
[INFO] 2022-12-07 16:27:51,416 leakShuffleDataChecker LocalFileDeleteHandler delete - Delete shuffle data for appId[check] with /data1/uniffle/data/check cost 0 ms
[INFO] 2022-12-07 16:27:51,420 leakShuffleDataChecker LocalFileDeleteHandler delete - Delete shuffle data for appId[check] with /data2/uniffle/data/check cost 0 ms
[INFO] 2022-12-07 16:27:51,420 leakShuffleDataChecker LocalFileDeleteHandler delete - Delete shuffle data for appId[check] with /data3/uniffle/data/check cost 0 ms
[INFO] 2022-12-07 16:27:51,420 leakShuffleDataChecker LocalFileDeleteHandler delete - Delete shuffle data for appId[check] with /data4/uniffle/data/check cost 0 ms
[INFO] 2022-12-07 16:27:51,420 leakShuffleDataChecker ShuffleTaskManager checkLeakShuffleData - Finish check leak shuffle data
[ERROR] 2022-12-07 16:27:51,685 HealthCheckService LocalStorageChecker checkStorageReadAndWrite - Storage read and write error
java.io.FileNotFoundException: /data4/uniffle/data/check/test (No such file or directory)
        at java.io.FileInputStream.open0(Native Method)
        at java.io.FileInputStream.open(FileInputStream.java:195)
        at java.io.FileInputStream.<init>(FileInputStream.java:138)
        at org.apache.uniffle.server.LocalStorageChecker$StorageInfo.checkStorageReadAndWrite(LocalStorageChecker.java:180)
        at org.apache.uniffle.server.LocalStorageChecker.checkIsHealthy(LocalStorageChecker.java:73)
        at org.apache.uniffle.server.HealthCheck.check(HealthCheck.java:84)
        at org.apache.uniffle.server.HealthCheck.lambda$new$0(HealthCheck.java:70)
        at java.lang.Thread.run(Thread.java:745)
[INFO] 2022-12-07 16:27:51,685 HealthCheckService LocalStorageChecker checkIsHealthy - shuffle server become unhealthy
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/392/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P5_E4,incubator-uniffle,1340600632,392,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T08:50:05Z,2022-12-07T08:50:05Z,cc @jerqi @sfwang218 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P5_E4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P5_yw,incubator-uniffle,1340603568,392,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-07T08:53:07Z,2022-12-07T08:53:07Z,Good catch!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P5_yw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P6Alu,incubator-uniffle,1340606830,392,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T08:56:13Z,2022-12-07T08:56:13Z,"> Good catch!

Yes, no pain no gain. 

This bug causes the online cluster out-of-service due to too many servers unhealthy","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P6Alu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7KAR,incubator-uniffle,1340907537,392,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T12:38:14Z,2022-12-07T12:38:14Z,"I think this is could be fixed by adding the `check` appName as a whitelist to ignore cleaning it. 

But I think this is a little bit tricky. WFYT? @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7KAR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7K1L,incubator-uniffle,1340910923,392,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-07T12:41:34Z,2022-12-07T12:41:34Z,"> I think this is could be fixed by adding the `check` appName as a whitelist to ignore cleaning it.
> 
> But I think this is a little bit tricky. WFYT? @jerqi

Can we check whether filename start with ""application""?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7K1L/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7PS1,incubator-uniffle,1340929205,392,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-07T12:58:25Z,2022-12-07T12:58:25Z,It’s better for me,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7PS1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7dJj,incubator-uniffle,1340985955,392,NA,xianjingfeng,11752250,,,NA,2022-12-07T13:41:30Z,2022-12-07T13:41:30Z,"> Can we check whether filename start with ""application""?

Not always start with ""application"". Such as spark on k8s. @jerqi @zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7dJj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7f7L,incubator-uniffle,1340997323,392,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-07T13:50:50Z,2022-12-07T13:50:50Z,"> > Can we check whether filename start with ""application""?
> 
> Not always start with ""application"". Such as spark on k8s. @jerqi @zuston

Yes, maybe we should have a file name white list.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7f7L/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7yq7,incubator-uniffle,1341074107,392,NA,advancedxy,807537,,,NA,2022-12-07T14:46:54Z,2022-12-07T14:46:54Z,"> > > Can we check whether filename start with ""application""?
> > 
> > 
> > Not always start with ""application"". Such as spark on k8s. @jerqi @zuston
> 
> Yes, maybe we should have a file name white list.

Why not make the check dir to be `$storageDir/.check`, a hidden dir in unix system.  `checkAndClearLeakShuffleData` shall not touch this dir/file. 
cc @zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P7yq7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P_A0B,incubator-uniffle,1341918465,392,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-08T03:04:42Z,2022-12-08T03:04:42Z,Sounds great! @advancedxy I will do a quick fix.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5P_A0B/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/392,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QBjAk,incubator-uniffle,1342582820,392,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-08T11:36:52Z,2022-12-08T11:36:52Z,Fixed by #393 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QBjAk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/397,https://api.github.com/repos/apache/incubator-uniffle/issues/397,incubator-uniffle,1488513848,397,[DOCS] Add more usage examples of quota,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-10T14:02:34Z,2023-03-08T02:52:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

_No response_

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/397/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/397,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QLzbH,incubator-uniffle,1345271495,397,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-10T14:03:22Z,2022-12-10T14:03:22Z,I can't get any examples to use quota limitation @smallzhongfeng . Could you help add some docs about this? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QLzbH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/397,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QL5D3,incubator-uniffle,1345294583,397,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-10T16:01:18Z,2022-12-10T16:01:18Z,"For our company, users' tasks are submitted through the same platform, so many tasks may have performance bottlenecks. We will configure the parameters of rss to submit app to the uniffle cluster. However, once the rss parameters are configured, users generally do not modify them. Therefore, user may backtrack the task for a month or a whole year, and when submitting more app at the same time, other online app may be affected. Therefore, we limit users' apps to allow users to submit certain app to uniffle in batches, and the excessive app will be submitted to ESS.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QL5D3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/398,incubator-uniffle,1491278519,398,[Improvement] Allow split huge data ShuffleDataFlushEvent to multiple small events,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-12-12T08:18:33Z,2022-12-15T08:22:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

[Improvement] Allow split huge data ShuffleDataFlushEvent to multiple small events.

As the problem mentioned by https://github.com/apache/incubator-uniffle/issues/378#issuecomment-1344260350, the small event will benefit more after the PR of #396 is applied.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/398/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QO1xe,incubator-uniffle,1346067550,398,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-12T08:18:42Z,2022-12-12T08:18:42Z,cc @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QO1xe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPAzC,incubator-uniffle,1346112706,398,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-12T08:56:31Z,2022-12-12T08:56:31Z,Could we avoid huge event by using this pr https://github.com/apache/incubator-uniffle/pull/176 ?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPAzC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPBSq,incubator-uniffle,1346114730,398,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-12T08:58:18Z,2022-12-12T08:58:18Z,"> Could we avoid huge event by using this pr #176 ?

Yes. But I don't hope so, detailed reason could be found in https://github.com/apache/incubator-uniffle/issues/378#issuecomment-1342637715 of second case.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPBSq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPBvT,incubator-uniffle,1346116563,398,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-12T08:59:59Z,2022-12-12T08:59:59Z,"> > Could we avoid huge event by using this pr #176 ?
> 
> Yes. But I don't hope so, detailed reason could be found in [#378 (comment)](https://github.com/apache/incubator-uniffle/issues/378#issuecomment-1342637715) of second case.

I can't get your point.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPBvT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPFOc,incubator-uniffle,1346130844,398,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-12T09:09:19Z,2022-12-12T09:09:19Z,"If the single buffer flush mechanism is enabled, it will be applied all partition data. But when the memory is free and the concurrent apps number is small, there is unnecessary to flush data to localfile or disk. In my view, it will make the local disk free if the single buffer flush size  > cold storage threshold size. And it will make memory free  if the single buffer flush size  < cold storage threshold size. 

Overall, this mechanism will not make full use of memory and then leads to performance regression.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QPFOc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYEw1,incubator-uniffle,1348488245,398,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-13T12:50:43Z,2022-12-13T12:50:43Z,"We find that it won't matter. Because if we write data to storage, and then we read the data quickly, the data may be in the page cache. It has similar performance with the data in memory. Single buffer mechnism can make full use of network card.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYEw1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qe6so,incubator-uniffle,1350282024,398,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-14T02:35:57Z,2022-12-14T02:35:57Z,"> Because if we write data to storage, and then we read the data quickly, the data may be in the page cache.

But in the most cases, the read wont happen quickly after writing, especially for many tasks.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qe6so/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfFCJ,incubator-uniffle,1350324361,398,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-14T03:13:07Z,2022-12-14T03:13:07Z,"> > Because if we write data to storage, and then we read the data quickly, the data may be in the page cache.
> 
> But in the most cases, the read wont happen quickly after writing, especially for many tasks.

Maybe we should some tests prove the effect.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfFCJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfNCd,incubator-uniffle,1350357149,398,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-14T03:51:02Z,2022-12-14T03:51:02Z,I have tested in our online cluster https://github.com/apache/incubator-uniffle/issues/378#issuecomment-1342637715.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfNCd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfnjR,incubator-uniffle,1350465745,398,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-14T06:21:18Z,2022-12-14T06:21:18Z,"> I have tested in our online cluster [#378 (comment)](https://github.com/apache/incubator-uniffle/issues/378#issuecomment-1342637715).

The test don't have the pr https://github.com/apache/incubator-uniffle/commit/d3aa5dc81bfb9bc63a5a93e2d31f0871cbf573b6","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfnjR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfqEd,incubator-uniffle,1350476061,398,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-14T06:29:05Z,2022-12-14T06:29:05Z,"It's still useless after #396. Single huge event only can be handled by single thread to flush to HDFS, which don't benefit from concurrent written mechanism.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfqEd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qfrzu,incubator-uniffle,1350483182,398,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-14T06:35:42Z,2022-12-14T06:35:42Z,"> It's still useless after #396. Single huge event only can be handled by single thread to flush to HDFS, which don't benefit from concurrent written mechanism.

If you use single buffer limit at the same time, you will benefit the feature.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qfrzu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoLDP,incubator-uniffle,1352708303,398,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-15T08:22:06Z,2022-12-15T08:22:06Z,"> If you use single buffer limit at the same time, you will benefit the feature.

I know this, but I don't hope all large buffer flush to persist storage, especially for having enough free memory.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoLDP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/402,https://api.github.com/repos/apache/incubator-uniffle/issues/402,incubator-uniffle,1491654065,402,Flaky Test: QuorumTest#case1,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-12T11:36:02Z,2022-12-15T02:07:49Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.uniffle.test.QuorumTest
Error:  Tests run: 14, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 66.607 s <<< FAILURE! - in org.apache.uniffle.test.QuorumTest
Error:  case1  Time elapsed: 3.278 s  <<< ERROR!
org.apache.uniffle.common.exception.RssException: Get shuffle result is failed for appId[case1], shuffleId[0]
	at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.getShuffleResult(ShuffleWriteClientImpl.java:548)
	at org.apache.uniffle.test.QuorumTest.case1(QuorumTest.java:317)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)

[INFO] Running org.apache.uniffle.test.ShuffleServerWithLocalOfExceptionTest
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.701 s - in org.apache.uniffle.test.ShuffleServerWithLocalOfExceptionTest
[INFO] 
[INFO] Results:
[INFO] 
Error:  Errors: 
Error:    QuorumTest.case1:317 » Rss Get shuffle result is failed for appId[case1], shuf...
[INFO] 
Error:  Tests run: 61, Failures: 0, Errors: 1, Skipped: 1
[INFO] 
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3674994553/jobs/6213874153

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/402/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/402,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qj9Ok,incubator-uniffle,1351603108,402,NA,Rembrant777,61581888,Rembrandt,nanachi1027@163.com,NA,2022-12-14T15:13:54Z,2022-12-14T15:13:54Z,"
Hi, I think reproduced this problem on local env (profile = spark 2.3) (I suppose so). Can you assign this issue to me? 
![Screen Shot 2022-12-14 at 11 10 22 PM](https://user-images.githubusercontent.com/61581888/207633343-b761c124-e32d-4dc6-92b7-9923a8eb46c1.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qj9Ok/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/402,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QkZi0,incubator-uniffle,1351719092,402,NA,Rembrant777,61581888,Rembrandt,nanachi1027@163.com,NA,2022-12-14T16:20:40Z,2022-12-14T16:20:40Z,"I suppose that the main reason caused this test case failure is `rss.server.app.expired.withoutHeartbeat`'s value is too small. 

It can be re-produced by adding a breakpoint on the client side(block client response immediately), when the server side's `ShuffleTaskManager`#`expiredAppCleanupExecutorService` detects that time is up and the app gets expired it will invoke `removeResources` method to remove the application(appId[case1]). 

When the client tries to fetch a partition/block data from an expired application it only receives an error message with the required data fields blank and finally throws an exception. 

Here are the  error logs from the server side: 
```
2022-12-14 23:56:45,238 INFO  [clearResourceThread] server.ShuffleTaskManager (ShuffleTaskManager.java:removeResources(477)) - Start remove resource for appId[case1]
2022-12-14 23:56:45,238 ERROR [clearResourceThread] server.ShuffleTaskManager (ShuffleTaskManager.java:lambda$new$3(136)) - Exception happened when clear resource for expired application
java.lang.NullPointerException
	at org.apache.uniffle.server.ShuffleTaskManager.removeResources(ShuffleTaskManager.java:479)
	at org.apache.uniffle.server.ShuffleTaskManager.lambda$new$3(ShuffleTaskManager.java:130)
	at java.lang.Thread.run(Thread.java:748)
```
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QkZi0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/405,https://api.github.com/repos/apache/incubator-uniffle/issues/405,incubator-uniffle,1493235773,405,[Improvement] HDD friendly deployment,advancedxy,807537,,,OPEN,2022-12-13T02:56:07Z,2022-12-13T03:45:52Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

### Motivation
Due to Uniffle's multi-storage design, it's crucial that the second storages perform well.
![RSS Arch](https://github.com/apache/incubator-uniffle/blob/master/docs/asset/rss_architecture.png?raw=true)

Currently, the recommend deploy choices are `MEMORY_LOCALFILE`, `MEMORY_HDFS` and `MEMORY_LOCALFILE_HDFS`, and such deployments are used in production in `iQiyi`, `Didi`, `Tencent`, etc. 

For `MEMORY_HDFS` deployment, it might be suitable for large shuffle. Due to HDFS' I/O model, it may not handle small shuffles very well. Therefore, `MEMORY_LOCALFILE` and `MEMORY_LOCALFILE_HDFS` are the de facto choices to cover most shuffle scenarios.

The storage choice of `LOCALFILE` could be traditional HDD disks, or SSD or higher-speed NVMe SSDs.  The SSD storages are preferred. However due to its cost and hardware constraints, SSD cannot be deployed widely.

Therefore, I'd like to propose some improvements to Uniffle's HDD deployment, make it more widely applicable.

### How should we improve?

1. Reduce small I/Os of local storages:
    - The flush strategy of shuffle server could be improved, to wait for more shuffle data before flush to disk.
    - Leverages range partition to merge multiple partition's shuffle data in one file.
    - Defer flush of index file, which normally causes a small I/O.
2. I/O capability report, the shuffle worker shall report the local storage's hard drive type: HDD, SSD, etc and the disk numbers.
3. Better balancing strategy in coordinate and shuffle worker side:
    - coordinate side: partition size/throughput aware assignment to balancing workload in shuffle workers.
    - shuffle server side: distributes workload evenly to leverages multiple HDD disks. A new disk selection strategy should be deployed and I/O stats aware. cc @zuston 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/405/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/405,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QVBU-,incubator-uniffle,1347687742,405,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-13T03:14:22Z,2022-12-13T03:14:22Z,"> Leverages range partition to merge multiple partition's shuffle data in one file.

I heard from @jerqi that the range partition should be removed in the future. 

> I/O capability report, the shuffle worker shall report the local storage's hard drive type: HDD, SSD, etc and the disk numbers.

If owning this, I think we could support different local storages in single uniffle cluster.
For example, shuffle-server-1 has the HDD, but shuffle-server-2 uses the SSD. We could make single app use  the same local storage to avoid w/r speed gap.

> shuffle server side: distributes workload evenly to leverages multiple HDD disks. A new disk selection strategy should be deployed and I/O stats aware

This is useful. +1","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QVBU-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/405,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QVFEv,incubator-uniffle,1347703087,405,NA,advancedxy,807537,,,NA,2022-12-13T03:45:52Z,2022-12-13T03:45:52Z,"> I heard from @jerqi that the range partition should be removed in the future.

Yeah, maybe. If more experiments are done and we find range partition cannot merge small I/Os effectively. Then, we can remove range partition for sure.

> If owning this, I think we could support different local storages in single uniffle cluster.
For example, shuffle-server-1 has the HDD, but shuffle-server-2 uses the SSD. We could make single app use the same local storage to avoid w/r speed gap.

Mixed storage deployment in single uniffle cluster is also on the table. I will open a new issue to describe this scenario. I believe mixed deployments, especially SSD shuffle workers would be beneficial for high priority and valued spark/mr applications. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QVFEv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/407,incubator-uniffle,1493281331,407,[FEATURE]  Cache index files on the server side,xianjingfeng,11752250,,,OPEN,2022-12-13T03:36:54Z,2024-11-16T14:46:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

If we use AQE, index files will be read many times. So we should cache it in memory.

### Motivation

For better performance and lower disk io.

### Describe the solution

1. Cache it. Free discussion on specific details.
2. Filter index data before return to the clients.

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/407/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QVEHC,incubator-uniffle,1347699138,407,NA,xianjingfeng,11752250,,,NA,2022-12-13T03:37:28Z,2022-12-13T03:37:28Z,PTAL @jerqi @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QVEHC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QWFzA,incubator-uniffle,1347968192,407,NA,advancedxy,807537,,,NA,2022-12-13T09:01:30Z,2022-12-13T09:01:30Z,"Do you observe any performance issue for this case?

If the index file is only accessed few times(say 1,2 times), there's no need to cache this file. And normally, the linux system will have file cache to speed up file access.

If the shuffle server is indeed influenced by this problem, I believe we may need an IndexFileAccessManager to trigger the index file caching and manage eviction.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QWFzA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QXJN2,incubator-uniffle,1348244342,407,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-13T11:19:30Z,2022-12-13T11:19:30Z,"I think this will bring some memory pressure, especially for some huge partitions.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QXJN2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYLl5,incubator-uniffle,1348516217,407,NA,xianjingfeng,11752250,,,NA,2022-12-13T13:13:00Z,2022-12-13T13:13:00Z,"> Do you observe any performance issue for this case?

No, I just think this should be an optimization point.


> If the index file is only accessed few times(say 1,2 times), there's no need to cache this file. 

We can just cache the partitions of applicaitions which enable AQE
>And normally, the linux system will have file cache to speed up file access.

But linux system will cache the data file too.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYLl5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYOZ8,incubator-uniffle,1348527740,407,NA,xianjingfeng,11752250,,,NA,2022-12-13T13:21:16Z,2022-12-13T13:21:16Z,"> I think this will bring some memory pressure, especially for some huge partitions.

 I had counted the files of a server in our production environment. About 10M of data on average generates 1K index file. It means that if we have 10T data, there are about 1G index files. If we compress the index before store it in memory, i think it's acceptable.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYOZ8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYkqa,incubator-uniffle,1348618906,407,NA,advancedxy,807537,,,NA,2022-12-13T13:56:53Z,2022-12-13T13:56:53Z,"> We can just cache the partitions of applicaitions which enable AQE

AQE is enabled by default in later spark versions such as Spark 3.3 and also it may turned on by default in some production envs. So I believe by simply cache index file for all the AQE applications might not be sufficient. The cache behavior might still be triggered by access pattern.

Also another question, in which cases AQE would trigger reading the same partition many times?  I know the `OptimizeSkewedJoin` would split the same partition into multiple parts, and therefore trigger the behavior you described. 
Is there any other cases?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYkqa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfDn0,incubator-uniffle,1350318580,407,NA,xianjingfeng,11752250,,,NA,2022-12-14T03:08:03Z,2022-12-14T03:08:03Z,"> Also another question, in which cases AQE would trigger reading the same partition many times? I know the `OptimizeSkewedJoin` would split the same partition into multiple parts, and therefore trigger the behavior you described.
> Is there any other cases?

rebalance","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfDn0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfMge,incubator-uniffle,1350354974,407,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-14T03:48:47Z,2022-12-14T03:48:47Z,"> About 10M of data on average generates 1K index file. It means that if we have 10T data, there are about 1G index files.

Emm... It's too big. For huge partition, 200G data size is normal.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfMge/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfPCl,incubator-uniffle,1350365349,407,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-14T04:03:06Z,2022-12-14T04:03:06Z,"Besides, we'd better to have a unified memory manager in shuffle-server if using this cache.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfPCl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfgeX,incubator-uniffle,1350436759,407,NA,advancedxy,807537,,,NA,2022-12-14T05:54:04Z,2022-12-14T05:54:04Z,"> > Also another question, in which cases AQE would trigger reading the same partition many times? I know the `OptimizeSkewedJoin` would split the same partition into multiple parts, and therefore trigger the behavior you described.
> > Is there any other cases?
> 
> rebalance

could you elaborate it a bit more? Do you mean `OptimizeSkewInRebalancePartitions`? I just checked the code and I believe the optimization rule is only applied when user rebalances output and there's indeed some skew partitions.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QfgeX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qf9ro,incubator-uniffle,1350556392,407,NA,xianjingfeng,11752250,,,NA,2022-12-14T07:42:55Z,2022-12-14T07:42:55Z,"> Emm... It's too big. For huge partition, 200G data size is normal.

I mean even if we cache all the local index files, we won't use too much memory. I think 3g is enough for most servers.  For us, the bottleneck is the network and disk, not the memory.

> Besides, we'd better to have a unified memory manager in shuffle-server if using this cache.

You are right. And I think we should do this after #133 .
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qf9ro/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qf-j_,incubator-uniffle,1350559999,407,NA,xianjingfeng,11752250,,,NA,2022-12-14T07:45:45Z,2022-12-14T07:45:45Z,"> Do you mean `OptimizeSkewInRebalancePartitions`? I just checked the code and I believe the optimization rule is only applied when user rebalances output and there's indeed some skew partitions.

Yes. Reduce task will read all index files of all partitions. You can try to run a job and trace the logs.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qf-j_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgxHt,incubator-uniffle,1350767085,407,NA,advancedxy,807537,,,NA,2022-12-14T09:58:34Z,2022-12-14T09:58:34Z,"> Yes. Reduce task will read all index files of all partitions. You can try to run a job and trace the logs.

This doesn't seem right. Do you have a minimal reproduce job to reproduce this case?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgxHt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qi_mB,incubator-uniffle,1351350657,407,NA,xianjingfeng,11752250,,,NA,2022-12-14T13:25:54Z,2022-12-14T13:25:54Z,"> This doesn't seem right. Do you have a minimal reproduce job to reproduce this case?

https://github.com/apache/spark/blob/0fd1f85f16502d1d4222cf3d7abfd5e2b86464e6/sql/core/src/test/scala/org/apache/spark/sql/execution/adaptive/AdaptiveQueryExecSuite.scala#L228","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qi_mB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpBTJ,incubator-uniffle,1352930505,407,NA,xianjingfeng,11752250,,,NA,2022-12-15T11:33:31Z,2022-12-15T11:33:31Z,"If we cache it, we don't even need to flush it to the disk. @zuston @jerqi @advancedxy ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpBTJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpP1L,incubator-uniffle,1352990027,407,NA,advancedxy,807537,,,NA,2022-12-15T12:28:24Z,2022-12-15T12:28:24Z,"> https://github.com/apache/spark/blob/0fd1f85f16502d1d4222cf3d7abfd5e2b86464e6/sql/core/src/test/scala/org/apache/spark/sql/execution/adaptive/AdaptiveQueryExecSuite.scala#L228

I didn't get a change to reproduce this case. I will do it in this week. 

I still think it should be cached when necessary and selectively. 

> If we cache it, we don't even need to flush it to the disk

Well, I'm for this idea as I'd like to reduce small I/Os to disk as much as possible. But memory is still an important factor to consider, as we want to deploy Uniffle shuffle server with smaller memory, say 32GB or 48GB.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpP1L/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpUDB,incubator-uniffle,1353007297,407,NA,xianjingfeng,11752250,,,NA,2022-12-15T12:45:12Z,2022-12-15T12:45:12Z,"> Well, I'm for this idea as I'd like to reduce small I/Os to disk as much as possible. But memory is still an important factor to consider, as we want to deploy Uniffle shuffle server with smaller memory, say 32GB or 48GB.

This feature can be optional.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpUDB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpXvC,incubator-uniffle,1353022402,407,NA,xianjingfeng,11752250,,,NA,2022-12-15T12:56:05Z,2022-12-15T12:56:05Z,"> > https://github.com/apache/spark/blob/0fd1f85f16502d1d4222cf3d7abfd5e2b86464e6/sql/core/src/test/scala/org/apache/spark/sql/execution/adaptive/AdaptiveQueryExecSuite.scala#L228
> 
> I didn't get a change to reproduce this case. I will do it in this week.
> 
> I still think it should be cached when necessary and selectively.



You can see this method and pay attention to `startMapIndex` `endMapIndex` `startPartition` `endPartition` when debug the above ut
https://github.com/apache/spark/blob/0fd1f85f16502d1d4222cf3d7abfd5e2b86464e6/core/src/main/scala/org/apache/spark/shuffle/sort/SortShuffleManager.scala#L124
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpXvC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/407,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2veh,incubator-uniffle,2480600993,407,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-11-16T14:45:24Z,2024-11-16T14:45:24Z,"Is it possible to store index into rocksdb as rocksdb is well known to store meta data for some distributed storage system, e.g. Alluxio, Ozone.

Or we can store index file into a distributed KV store, for example TIKV?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2veh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/408,https://api.github.com/repos/apache/incubator-uniffle/issues/408,incubator-uniffle,1493289727,408,Flaky Test: ShuffleBufferManagerTest#bufferSizeTest,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-13T03:45:13Z,2023-02-27T08:17:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.uniffle.server.buffer.ShuffleBufferManagerTest
Error:  Tests run: 8, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 3.473 s <<< FAILURE! - in org.apache.uniffle.server.buffer.ShuffleBufferManagerTest
Error:  bufferSizeTest  Time elapsed: 0.535 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <0> but was: <288>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:166)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:161)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:628)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.bufferSizeTest(ShuffleBufferManagerTest.java:428)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3681854053/jobs/6228951081

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/408/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/408,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5WyO,incubator-uniffle,1407544462,408,NA,xianjingfeng,11752250,,,NA,2023-01-29T02:49:23Z,2023-01-29T02:49:23Z,"@zuston `ShuffleBufferManagerTest#waitForFlush` seems not applicable in this UT. because `updateCommittedBlockIds` is invoked before `event.doCleanup()`. I have no good idea to fix it. Do you have any good ideas?

https://github.com/apache/incubator-uniffle/blob/33c4fe4208b640a71d4ecbb2f9ad3f20f4ba1cc9/server/src/main/java/org/apache/uniffle/server/ShuffleFlushManager.java#L211-L233","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5WyO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/408,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V0rww,incubator-uniffle,1439874096,408,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-22T11:37:22Z,2023-02-22T11:37:22Z,Another failed tests: https://github.com/apache/incubator-uniffle/actions/runs/4242048090/jobs/7373054242,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V0rww/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/408,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V0_QU,incubator-uniffle,1439953940,408,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-22T12:41:00Z,2023-02-22T12:41:00Z,"> @zuston `ShuffleBufferManagerTest#waitForFlush` seems not applicable in this UT. because `updateCommittedBlockIds` is invoked before `event.doCleanup()`. I have no good idea to fix it. Do you have any good ideas?
> 
> https://github.com/apache/incubator-uniffle/blob/33c4fe4208b640a71d4ecbb2f9ad3f20f4ba1cc9/server/src/main/java/org/apache/uniffle/server/ShuffleFlushManager.java#L211-L233

If this test don't have good solution, we can disable this test first to reduce the failure of CI. Or we can rewrite this test.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V0_QU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/408,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WHwJx,incubator-uniffle,1444872817,408,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-25T01:28:31Z,2023-02-25T01:28:31Z,How about sleep a while to wait `event.doCleanUp` being invoked? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WHwJx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/409,https://api.github.com/repos/apache/incubator-uniffle/issues/409,incubator-uniffle,1493291604,409,Flaky Test: WriteAndReadMetricsTest#test,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-12-13T03:47:08Z,2023-02-08T14:14:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 20.532 s <<< FAILURE! - in org.apache.uniffle.test.WriteAndReadMetricsTest
Error:  test  Time elapsed: 17.767 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <55> but was: <51>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:182)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:177)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:1141)
	at org.apache.uniffle.test.SparkIntegrationTestBase.verifyTestResult(SparkIntegrationTestBase.java:116)
	at org.apache.uniffle.test.SparkIntegrationTestBase.run(SparkIntegrationTestBase.java:63)
	at org.apache.uniffle.test.WriteAndReadMetricsTest.test(WriteAndReadMetricsTest.java:39)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
```

### Actions URL

1. https://github.com/apache/incubator-uniffle/actions/runs/3681962312/jobs/6229151235
2. https://github.com/apache/incubator-uniffle/actions/runs/4081935743/jobs/7035772792

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/409/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/409,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UzCZf,incubator-uniffle,1422665311,409,NA,advancedxy,807537,,,NA,2023-02-08T14:14:54Z,2023-02-08T14:14:54Z,https://github.com/apache/incubator-uniffle/actions/runs/4124778567/jobs/7124459442 another instance of this flaky test.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UzCZf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/410,https://api.github.com/repos/apache/incubator-uniffle/issues/410,incubator-uniffle,1493693968,410,[FEATURE] Support the hot reload of coordinator's configuration `rss.coordinator.shuffle.nodes.max`,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2022-12-13T08:31:06Z,2023-02-10T06:30:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

`rss.coordinator.shuffle.nodes.max` don't support hot reload. It's not friendly for operation.

### Motivation

It will be more friendly for operation

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/410/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/410,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QWTOa,incubator-uniffle,1348023194,410,NA,advancedxy,807537,,,NA,2022-12-13T09:22:16Z,2022-12-13T09:22:16Z,"Maybe we can extend this issue title to a bit more generic: `support hot reload of Uniffle configurations`? It can be used in both shuffle server and coordinator side, but mainly for coordinator.

Once uniffle supports deployments on K8S, it's common to hot-reload configurations backend by using `ConfigMap`.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QWTOa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/410,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Re4-w,incubator-uniffle,1367052208,410,NA,advancedxy,807537,,,NA,2022-12-29T03:44:26Z,2022-12-29T03:44:26Z,"@jerqi Do you have time for this issue. I'd like this feature to be merged in our next release, such as 0.6.1 or 0.7.0","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Re4-w/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/410,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Uw0xc,incubator-uniffle,1422085212,410,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-08T06:32:48Z,2023-02-08T06:32:48Z,I will finish this issue this week.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Uw0xc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/412,https://api.github.com/repos/apache/incubator-uniffle/issues/412,incubator-uniffle,1493791483,412,[Improvement] Coordinate support mixed storage shuffle servers,advancedxy,807537,,,OPEN,2022-12-13T09:17:56Z,2022-12-13T09:36:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

After the https://github.com/apache/incubator-uniffle/issues/405 is finished, shuffle server would report its capability to coordinator, such as
- disk quota
- disk iops(by HDD/SSD)
- disk number
- server thread number 
etc.

The coordinator should support such mixed deployments, and assign workload based on shuffle worker's capability. In this way, one uniffle cluster could scale up to handle more traffic with commodity servers and also support high priority apps with specialized hardware, such as server with SSD disks.

### How should we improve?

- implement new assignment strategy to support:
  - more affinity settings: such as prefer, required semantics
  - load awareness assignments
- necessary changes to modify corresponding RPC interfaces.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/412/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/412,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QWbUD,incubator-uniffle,1348056323,412,NA,advancedxy,807537,,,NA,2022-12-13T09:36:00Z,2022-12-13T09:36:00Z,"Once this feature is completed, the coordinator may support shuffle workers with different storage types: such as `MEMORY_LOCALFILE` and `MEMORY_HDFS`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QWbUD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/413,https://api.github.com/repos/apache/incubator-uniffle/issues/413,incubator-uniffle,1494044997,413,[Improvement] Introduce storage manager selection strategy for MultipleStorageManager,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-12-13T11:29:23Z,2022-12-13T13:40:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In current codebase, it has introduced the storageManager fallback strategy. But I think it's not general.

For example: I want to use the coldStorageManager directly for some specific apps, which are low priority or own a huge partition.

So I think the selection strategy will solve above problems, and at the same time, it also could cover the fallback mechanism.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/413/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/413,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QXVa8,incubator-uniffle,1348294332,413,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-13T11:30:39Z,2022-12-13T11:30:39Z,WDYT @jerqi @xianjingfeng @advancedxy ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QXVa8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/413,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QXZ-J,incubator-uniffle,1348312969,413,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-13T11:36:10Z,2022-12-13T11:36:10Z,It's ok for me.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QXZ-J/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/413,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYP6K,incubator-uniffle,1348533898,413,NA,xianjingfeng,11752250,,,NA,2022-12-13T13:23:29Z,2022-12-13T13:23:29Z,It's ok for me too.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYP6K/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/413,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYcnZ,incubator-uniffle,1348585945,413,NA,advancedxy,807537,,,NA,2022-12-13T13:40:29Z,2022-12-13T13:40:29Z,"Looks fine to me.  Just one thought: when implementing such strategy, let’s keep mixed shuffle servers in mind. Mixed shuffle server means: some shuffle servers use Memory_hdfs, others use Memory_localfile, or ssd vs hdd, etc.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QYcnZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/414,https://api.github.com/repos/apache/incubator-uniffle/issues/414,incubator-uniffle,1494053140,414,[FEATURE] Support max concurrency specified by client side in HDFS storage,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-13T11:33:48Z,2023-04-28T00:41:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

The HDFS storage support writing single partition concurrently in #396, but the max concurrency config is based on the server side config. If we introduce the client side config to override the server config, it will be more flexible.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/414/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/414,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bAW5t,incubator-uniffle,1526820461,414,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-28T00:41:20Z,2023-04-28T00:41:20Z,#815 Done.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bAW5t/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/416,https://api.github.com/repos/apache/incubator-uniffle/issues/416,incubator-uniffle,1494057795,416,[Improvement] Support initializing HdfsShuffleWriteHandler lazily in PooledHdfsShuffleWriteHandler,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-13T11:36:44Z,2023-04-17T05:53:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The HDFS storage support writing single partition concurrently in https://github.com/apache/incubator-uniffle/pull/396, and it will init the maxConcurrency * HdfsShuffleWriteHandlers directly. There is no need for some apps.

So I hope it could be initialized lazily.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/416/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/416,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDCSE,incubator-uniffle,1510745220,416,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-17T05:53:37Z,2023-04-17T05:53:37Z,done #816 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDCSE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/417,https://api.github.com/repos/apache/incubator-uniffle/issues/417,incubator-uniffle,1495595068,417,[Improvement] Eliminate raw use of parameterized class,advancedxy,807537,,,CLOSED,2022-12-14T03:47:29Z,2023-05-28T09:25:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When I'm browsing the Uniffle codebase,  a lot of raw use of parameterized class occurred, especially in test classes.

For instance, the `iterator` parameter and `product2` variable is raw use of parameterized class
https://github.com/apache/incubator-uniffle/blob/66c752fe3ecd6d4979d3539fe22265d4239156a9/client-spark/common/src/test/java/org/apache/spark/shuffle/reader/AbstractRssReaderTest.java#L51-L63

### How should we improve?

Eliminate the raw use of parameterized class as much as possible.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/417/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/417,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cWWAQ,incubator-uniffle,1549361168,417,NA,cchung100m,6762509,Neo Chien,,NA,2023-05-16T09:58:19Z,2023-05-16T09:58:19Z,"Hi @advancedxy 

I'd like to handle this issue if you agreed. Thank you.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cWWAQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/417,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cWnzP,incubator-uniffle,1549434063,417,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-16T10:51:12Z,2023-05-16T10:51:12Z,I assigned to you.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cWnzP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/418,https://api.github.com/repos/apache/incubator-uniffle/issues/418,incubator-uniffle,1495848157,418,[Improvement] Add until.CreateTempDir,advancedxy,807537,,,CLOSED,2022-12-14T06:40:50Z,2023-01-17T08:48:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

minor: just for cleaner code. 
We can introduce some goodie utilities from Spark side, such as `util.CreateTempDir` and replace duplicate code in various test classes. For instance:
```
    File tmpDir = Files.createTempDir();
    tmpDir.deleteOnExit();
```

### How should we improve?

By cherry-pick some utility class from Spark or introduce spark-network-common as a dep.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/418/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/418,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QftTc,incubator-uniffle,1350489308,418,NA,advancedxy,807537,,,NA,2022-12-14T06:41:38Z,2022-12-14T06:41:38Z,Let's open this for discussion. I currently don't have a good way to handle this case.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QftTc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/418,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RZLtA,incubator-uniffle,1365556032,418,NA,advancedxy,807537,,,NA,2022-12-27T02:14:45Z,2022-12-27T02:14:45Z,"For unit test purpose, I think it's better to use JUnit's `@TempDir` annotation.
Therefore, this issue needs to be closed.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RZLtA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/419,https://api.github.com/repos/apache/incubator-uniffle/issues/419,incubator-uniffle,1495959750,419,[Subtask] Introduce a new configuration to control the flush threshold for local storage,advancedxy,807537,,,CLOSED,2022-12-14T07:41:47Z,2022-12-28T07:03:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

After the new configuration is introduced, the shuffle server could pick shuffle data selectively and flush bigger I/Os first.

This issue may also introduce a flush strategy interface to make it extensible.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/405

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/419/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/420,https://api.github.com/repos/apache/incubator-uniffle/issues/420,incubator-uniffle,1496017125,420,[Improvement]  Should we remove `taskAttemptId` in FileBasedShuffleSegment,xianjingfeng,11752250,,,OPEN,2022-12-14T08:12:39Z,2023-03-25T02:38:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We can calculate the taskAttemptId from the blockId, so should we remove it?

https://github.com/apache/incubator-uniffle/blob/66c752fe3ecd6d4979d3539fe22265d4239156a9/storage/src/main/java/org/apache/uniffle/storage/common/FileBasedShuffleSegment.java#L30

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/420/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/420,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgIpb,incubator-uniffle,1350601307,420,NA,xianjingfeng,11752250,,,NA,2022-12-14T08:13:31Z,2022-12-14T08:13:31Z,cc @jerqi @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgIpb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/420,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgRto,incubator-uniffle,1350638440,420,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-14T08:38:31Z,2022-12-14T08:38:31Z,"> cc @jerqi @zuston

Maybe it's useful for https://github.com/apache/incubator-uniffle/issues/134","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgRto/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/420,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgUZq,incubator-uniffle,1350649450,420,NA,xianjingfeng,11752250,,,NA,2022-12-14T08:46:23Z,2022-12-14T08:46:23Z,"> Maybe it's useful for #134

I don't get your point.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgUZq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/420,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgWs6,incubator-uniffle,1350658874,420,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-14T08:52:55Z,2022-12-14T08:52:55Z,"> > Maybe it's useful for #134
> 
> I don't get your point.

I recommend that we don't remove `taskAttemptId` now, maybe it's useful in the future.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QgWs6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/420,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qgs5r,incubator-uniffle,1350749803,420,NA,xianjingfeng,11752250,,,NA,2022-12-14T09:48:01Z,2022-12-14T09:48:01Z,"> I recommend that we don't remove `taskAttemptId` now, maybe it's useful in the future.

But remove it will reduce the index file size and useful for #407.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qgs5r/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/420,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ybvp3,incubator-uniffle,1483668087,420,NA,xianjingfeng,11752250,,,NA,2023-03-25T01:39:54Z,2023-03-25T01:39:54Z,"I want use similar idea as #749 to solve fix this issue. I will make it as a cilent configration. WDYT? @jerqi @zuston .
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ybvp3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/420,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Yb0yy,incubator-uniffle,1483689138,420,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-25T02:38:19Z,2023-03-25T02:38:19Z,"> I want use similar idea as #749 to solve fix this issue. I will make it as a cilent configration. WDYT? @jerqi @zuston .

Make sense. But you’d better to implement after #749 merged","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Yb0yy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/423,https://api.github.com/repos/apache/incubator-uniffle/issues/423,incubator-uniffle,1497837885,423,[Improvement] Avoid selecting storage which has reached the high watermark ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-15T05:58:53Z,2022-12-27T02:12:52Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In current codebase, it's possible to select the local storage of reaching the high watermark in `LocalStorageManager.` 

This strategy is unreasonable. And it makes many apps fallback to HDFS, because they select one high watermark  storage.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/423/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/423,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qnwiv,incubator-uniffle,1352599727,423,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-15T06:05:06Z,2022-12-15T06:05:06Z,cc @advancedxy Maybe this is related with the local disk capacity-based selection strategy. And I think I will raise a PR to solve above problem. The new selection strategy doesn't seem to have conflict with this.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qnwiv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/423,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qo3tF,incubator-uniffle,1352891205,423,NA,advancedxy,807537,,,NA,2022-12-15T10:56:55Z,2022-12-15T10:56:55Z,Looks good to me.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qo3tF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/423,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpnWo,incubator-uniffle,1353086376,423,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-15T13:41:00Z,2022-12-15T13:41:00Z,"After finishing this feature, I will introduce the feature of multiple disk selection for one partition, mentioned by https://github.com/apache/incubator-uniffle/issues/306. WDYT? @advancedxy cc @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QpnWo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/423,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RZLhy,incubator-uniffle,1365555314,423,NA,advancedxy,807537,,,NA,2022-12-27T02:12:51Z,2022-12-27T02:12:51Z,This is covered by #424 .,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RZLhy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/425,incubator-uniffle,1497871346,425,[Improvement] Separate HDFS and LocalDisk flush thread pool,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-15T06:31:41Z,2023-07-13T06:18:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The writing speed gap is obvious in HDFS and local disk, it's better to avoid sharing the same thread pool.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/425/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoKdP,incubator-uniffle,1352705871,425,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-15T08:19:28Z,2022-12-15T08:19:28Z,cc @advancedxy @xianjingfeng @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoKdP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoN9o,incubator-uniffle,1352720232,425,NA,xianjingfeng,11752250,,,NA,2022-12-15T08:34:10Z,2022-12-15T08:34:10Z,Not only separate HDFS and local disk. I think we should add a priority thread pool too.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoN9o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoOle,incubator-uniffle,1352722782,425,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-15T08:36:47Z,2022-12-15T08:36:47Z,"It's ok for me. We should have a clear design, I event have similar idea , but I can't give reasonable abstraction.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoOle/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RHaF1,incubator-uniffle,1360896373,425,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-21T06:08:21Z,2022-12-21T06:08:21Z,"> I think we should add a priority thread pool too.

Could you help describe more? @xianjingfeng ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RHaF1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RH28b,incubator-uniffle,1361014555,425,NA,xianjingfeng,11752250,,,NA,2022-12-21T08:40:28Z,2022-12-21T08:40:28Z,"> > I think we should add a priority thread pool too.
> 
> Could you help describe more? @xianjingfeng

In our production environment, some jobs are important and need to be handled first.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RH28b/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RH3Qv,incubator-uniffle,1361015855,425,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-21T08:41:49Z,2022-12-21T08:41:49Z,"> In our production environment, some jobs are important and need to be handled first.

Make sense.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RH3Qv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RIm5h,incubator-uniffle,1361210977,425,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-21T11:42:57Z,2022-12-21T11:42:57Z,"If you have interest on this, feel free to pick it up @xianjingfeng ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RIm5h/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RIyPT,incubator-uniffle,1361257427,425,NA,xianjingfeng,11752250,,,NA,2022-12-21T12:32:30Z,2022-12-21T12:32:30Z,"> If you have interest on this, feel free to pick it up @xianjingfeng

I don't have time recently, because I have other tasks. If no one is willing to do it, I will do it when I am free next year.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RIyPT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/425,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOdAu,incubator-uniffle,1413074990,425,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-02T02:48:59Z,2023-02-02T02:48:59Z,"> I don't have time recently, because I have other tasks. If no one is willing to do it, I will do it when I am free next year.

Feel free to take this If you will @xianjingfeng. And I think this is a valuable improvement.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOdAu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/426,https://api.github.com/repos/apache/incubator-uniffle/issues/426,incubator-uniffle,1497969222,426,[Bug] preAllocatedSize could be negative in corner cases,advancedxy,807537,,,CLOSED,2022-12-15T08:00:43Z,2022-12-30T09:19:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Notice `preAllocatedSize` could be negative in prod server logs

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[INFO] 2022-12-15 10:11:50,921 Grpc-*** ShuffleBufferManager flushIfNecessary - Start to flush with usedMemory[88*******], preAllocatedSize[-4969120], inFlushSize[0]
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

I did some investigation, there's some race conditions to update the `preAllocatedSize` field.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/426/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoGcR,incubator-uniffle,1352689425,426,NA,xianjingfeng,11752250,,,NA,2022-12-15T08:03:54Z,2022-12-15T08:03:54Z,Duplicate issue #229,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoGcR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoHke,incubator-uniffle,1352694046,426,NA,advancedxy,807537,,,NA,2022-12-15T08:08:22Z,2022-12-15T08:08:22Z,"> Duplicate issue #229

Thanks for pointing it out. I indeed searched the issues before creating this one. Seems the search result doesn't show up #229.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5QoHke/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhybL,incubator-uniffle,1367811787,426,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-30T09:19:35Z,2022-12-30T09:19:35Z,closed by #428 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhybL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/430,incubator-uniffle,1499579662,430,Flaky Test: AppBalanceSelectStorageStrategyTest#selectStorageTest,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-16T04:46:35Z,2022-12-28T09:44:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 8.293 s <<< FAILURE! - in org.apache.uniffle.coordinator.strategy.storage.AppBalanceSelectStorageStrategyTest
Error:  selectStorageTest  Time elapsed: 2.038 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <hdfs://path2> but was: <hdfs://path1>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:182)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:177)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:1141)
	at org.apache.uniffle.coordinator.strategy.storage.AppBalanceSelectStorageStrategyTest.selectStorageTest(AppBalanceSelectStorageStrategyTest.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3710032877/jobs/6289187657

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/430/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qt3XY,incubator-uniffle,1354200536,430,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-16T04:47:00Z,2022-12-16T04:47:00Z,PTAL @smallzhongfeng . Thanks~,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qt3XY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q19gh,incubator-uniffle,1356322849,430,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-17T16:19:18Z,2022-12-17T16:19:18Z,Where can I see logs printed? I remember that @jerqi can collect some logs before. @zuston,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q19gh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q1--b,incubator-uniffle,1356328859,430,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-17T16:41:14Z,2022-12-17T16:41:14Z,"I read the code. I think it is when the `detectStorageScheduler` reads and writes the hdfs file `hdfs://path2 `An exception occurred, which caused the `AppBalanceSelectStorageStrategy.pickStorage` to filter `hdfs://path2`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q1--b/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3MJN,incubator-uniffle,1356644941,430,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-18T03:15:59Z,2022-12-18T03:15:59Z,"> https://github.com/apache/incubator-uniffle/actions/runs/3710032877/jobs/6289187657

You could get the output log from https://github.com/apache/incubator-uniffle/suites/9900991081/artifacts/478415001.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3MJN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3MPA,incubator-uniffle,1356645312,430,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-18T03:16:12Z,2022-12-18T03:16:12Z,"> I read the code. I think it is when the `detectStorageScheduler` reads and writes the hdfs file `hdfs://path2 `An exception occurred, which caused the `AppBalanceSelectStorageStrategy.pickStorage` to filter `hdfs://path2`

Could you help fix this? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3MPA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3hZj,incubator-uniffle,1356732003,430,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-18T08:21:57Z,2022-12-18T08:21:57Z,"`2022-12-16 03:33:48,729 ERROR [detectStoragesScheduler-0] storage.AppBalanceSelectStorageStrategy (AppBalanceSelectStorageStrategy.java:detectStorage(99)) - Storage read and write error, we will not use this remote path hdfs://path2=RankValue{costTime=9223372036854775807, appNum=0, isHealthy=false}.` This may happen occasionally. I will mark it as a healthy path to prevent this `hdfs://path2` filtered.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3hZj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3hik,incubator-uniffle,1356732580,430,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-18T08:23:45Z,2022-12-18T08:23:45Z,"> > I read the code. I think it is when the `detectStorageScheduler` reads and writes the hdfs file `hdfs://path2 `An exception occurred, which caused the `AppBalanceSelectStorageStrategy.pickStorage` to filter `hdfs://path2`
> 
> Could you help fix this?

Yes, I will fix it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3hik/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3oZU,incubator-uniffle,1356760660,430,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-18T09:51:58Z,2022-12-18T09:51:58Z,Solved by https://github.com/apache/incubator-uniffle/pull/438,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Q3oZU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RILMX,incubator-uniffle,1361097495,430,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-21T09:55:15Z,2022-12-21T09:55:15Z,"This bug still exist. 

https://github.com/apache/incubator-uniffle/actions/runs/3747690721/jobs/6364186080

cc @smallzhongfeng ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RILMX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RIkZU,incubator-uniffle,1361200724,430,NA,advancedxy,807537,,,NA,2022-12-21T11:32:29Z,2022-12-21T11:32:29Z,"https://github.com/apache/incubator-uniffle/actions/runs/3748813166/jobs/6366578125#step:6:2551 another case here, probably related.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RIkZU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/430,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rc02J,incubator-uniffle,1366510985,430,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-28T09:43:02Z,2022-12-28T09:43:02Z,"> https://github.com/apache/incubator-uniffle/suites/9900991081/artifacts/478415001.

Could  you tell me how to get the log of a test? @zuston @advancedxy 

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rc02J/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/433,https://api.github.com/repos/apache/incubator-uniffle/issues/433,incubator-uniffle,1499841563,433,Flaky Test: HealthCheckCoordinatorGrpcTest#healthCheckTest,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-16T09:06:55Z,2023-03-10T12:20:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 17.304 s <<< FAILURE! - in org.apache.uniffle.test.HealthCheckCoordinatorGrpcTest
Error:  healthCheckTest  Time elapsed: 16.133 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <false> but was: <true>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertFalse.assertFalse(AssertFalse.java:40)
	at org.junit.jupiter.api.AssertFalse.assertFalse(AssertFalse.java:35)
	at org.junit.jupiter.api.Assertions.assertFalse(Assertions.java:227)
	at org.apache.uniffle.test.HealthCheckCoordinatorGrpcTest.healthCheckTest(HealthCheckCoordinatorGrpcTest.java:129)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3711009399/jobs/6291022787

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/433/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/433,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPrS1,incubator-uniffle,1463727285,433,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-10T12:20:10Z,2023-03-10T12:20:10Z,closed by #707,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPrS1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/434,https://api.github.com/repos/apache/incubator-uniffle/issues/434,incubator-uniffle,1499986137,434,[Improvement] New utility method to cover dynamic class loading in RSSUtils,advancedxy,807537,,,CLOSED,2022-12-16T10:41:42Z,2023-08-07T15:40:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?
New utility method to cover dynamic class loading.

_Originally posted by @xianjingfeng in https://github.com/apache/incubator-uniffle/pull/415#discussion_r1050526428_

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!

      ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/434/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/434,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jWn2K,incubator-uniffle,1666874762,434,NA,pegasas,13224827,John Huang,pegasashjy@gmail.com,NA,2023-08-06T14:15:01Z,2023-08-06T14:15:01Z,"It seems this issue has clear roadmap for first good issue.
Could you please assign me this issue? Thanks.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jWn2K/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/434,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jWqfh,incubator-uniffle,1666885601,434,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-06T14:51:41Z,2023-08-06T14:51:41Z,"> It seems this issue has clear roadmap for first good issue. Could you please assign me this issue? Thanks.

Yes, thanks. Assigned to you.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jWqfh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/436,https://api.github.com/repos/apache/incubator-uniffle/issues/436,incubator-uniffle,1500164692,436,[FEATURE] Support concurrent write to multiple local disks for one partition,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-16T12:56:39Z,2024-11-26T02:18:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support concurrent write to multiple local disks for one partition to speed up local writing, like https://github.com/apache/incubator-uniffle/pull/396.

This ticket should be based on https://github.com/apache/incubator-uniffle/pull/435

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/436/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/437,https://api.github.com/repos/apache/incubator-uniffle/issues/437,incubator-uniffle,1500177029,437,[Improvement] Dynamic generating configuration docs for uniffle web-site,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-12-16T13:06:45Z,2022-12-16T13:06:55Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The uniffle configuration often change, we could introduce the github-action to fetch the uniffle configurations to generate the web-site page.

But I don't how to deployment process of web site.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/437/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/437,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qv7FJ,incubator-uniffle,1354740041,437,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-16T13:06:55Z,2022-12-16T13:06:55Z,cc @kaijchen ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Qv7FJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/440,incubator-uniffle,1503975958,440,[Improvement] Reuse HDFS client FSDataOutputStream to avoid extra overhead,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-20T04:38:24Z,2023-02-02T03:01:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In `HdfsShuffleWriteHandler,` it will always create the instance of `HdfsFileWriter` to write data, in which, the  FSDataOutputStream will connect or close with remote NN. 

There is no need to close every time, we could reuse this to speed up.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/440/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RAlto,incubator-uniffle,1359108968,440,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-20T10:02:03Z,2022-12-20T10:02:03Z,How to process when we fail to write HDFS?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RAlto/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RAmcy,incubator-uniffle,1359111986,440,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-20T10:04:14Z,2022-12-20T10:04:14Z,"> How to process when we fail to write HDFS?

Invalidate this cache.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RAmcy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RA1nj,incubator-uniffle,1359174115,440,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-20T10:52:30Z,2022-12-20T10:52:30Z,"If you don't close, you can't guarantee that the data is safe. you can't delete the memory data.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RA1nj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RA7a0,incubator-uniffle,1359197876,440,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-20T11:11:59Z,2022-12-20T11:11:59Z,"> If you don't close, you can't guarantee that the data is safe. you can't delete the memory data.

The operation of `flush` can't guarantee this? 

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RA7a0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RA8rx,incubator-uniffle,1359203057,440,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-20T11:16:37Z,2022-12-20T11:16:37Z,"> > If you don't close, you can't guarantee that the data is safe. you can't delete the memory data.
> 
> The operation of `flush` can't guarantee this?

The cost of flush operation is similar to the operation close. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RA8rx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RA9M7,incubator-uniffle,1359205179,440,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-20T11:18:38Z,2022-12-20T11:18:38Z,"> The cost of flush operation is similar to the operation close.

But this could avoid re-creating with the datanode when flushing events again. Right? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RA9M7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RG0px,incubator-uniffle,1360743025,440,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-21T02:37:38Z,2022-12-21T02:37:38Z,"> > The cost of flush operation is similar to the operation close.
> 
> But this could avoid re-creating with the datanode when flushing events again. Right?

If the data is flushed successfully, but the data is close unsuccessfully, how to process this case?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RG0px/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RG4UA,incubator-uniffle,1360758016,440,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-21T02:43:24Z,2022-12-21T02:43:24Z,"> If the data is flushed successfully, but the data is close unsuccessfully, how to process this case?

If it could be read by downstream reducer once flushed, we could accept its close failure. But I'm not sure whether the  flushing operation could guarantee the visibility","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RG4UA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RH1bi,incubator-uniffle,1361008354,440,NA,xianjingfeng,11752250,,,NA,2022-12-21T08:34:30Z,2022-12-21T08:34:30Z,"Not every events will flush to hdfs. In our production environment, the probability that  flush to hdfs is less than 1 in 1000. So i think if this feature is required, it can be used as an option.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RH1bi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/440,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RH2AE,incubator-uniffle,1361010692,440,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-21T08:36:47Z,2022-12-21T08:36:47Z,"> Not every events will flush to hdfs. In our production environment, the probability that flush to hdfs is less than 1 in 1000. So i think if this feature is required, it can be used as an option.

Yes. Actually, I don't know the real performance improvement for this feature, maybe I won't raise a PR to solve","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RH2AE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/442,https://api.github.com/repos/apache/incubator-uniffle/issues/442,incubator-uniffle,1505676719,442,Flaky Test: QuotaManagerTest#testDetectUserResource,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-21T04:03:45Z,2022-12-30T09:17:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 3, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 3.614 s <<< FAILURE! - in org.apache.uniffle.coordinator.QuotaManagerTest
Error:  testDetectUserResource  Time elapsed: 1.57 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <null> but was: <30>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:182)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:177)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:541)
	at org.apache.uniffle.coordinator.QuotaManagerTest.testDetectUserResource(QuotaManagerTest.java:95)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutInvocation.proceed(TimeoutInvocation.java:46)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3746246955/jobs/6361411867

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/442/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/442,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Re1bk,incubator-uniffle,1367037668,442,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-29T02:46:31Z,2022-12-29T02:46:31Z,Could you tell me how to get the log of a test?  I need fix this. @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Re1bk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/442,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfIP8,incubator-uniffle,1367114748,442,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-29T07:07:04Z,2022-12-29T07:07:04Z,"Follow these steps:
1. Click the url of https://github.com/apache/incubator-uniffle/actions/runs/3746246955/jobs/6361411867
2. Click the button of summary, it will render to the summary page
3. Find the Artifacts, and then download it. 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfIP8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/442,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfPgb,incubator-uniffle,1367144475,442,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-29T08:13:28Z,2022-12-29T08:13:28Z,"> Follow these steps:
> 
> 1. Click the url of https://github.com/apache/incubator-uniffle/actions/runs/3746246955/jobs/6361411867
> 2. Click the button of summary, it will render to the summary page
> 3. Find the Artifacts, and then download it.

Great! Thanks a lot.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfPgb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/442,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfPhX,incubator-uniffle,1367144535,442,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-29T08:13:33Z,2022-12-29T08:13:33Z,"`org.opentest4j.AssertionFailedError: expected: <null> but was: <30>` 
It is said here that the expectation is null, but it is actually 30. However, the expected value of my code is 30. I feel a little confused
```
assertEquals(user3, 30);
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfPhX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/442,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhYPo,incubator-uniffle,1367704552,442,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-30T03:30:00Z,2022-12-30T03:30:00Z,"@jerqi @zuston At present, it seems that this is not the problem of the code I wrote. WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhYPo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/442,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rhh0B,incubator-uniffle,1367743745,442,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-30T06:05:18Z,2022-12-30T06:05:18Z,"> `org.opentest4j.AssertionFailedError: expected: <null> but was: <30>` It is said here that the expectation is null, but it is actually 30. However, the expected value of my code is 30. I feel a little confused
> 
> ```
> assertEquals(user3, 30);
> ```

user3 is set null value.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rhh0B/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/442,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhkEb,incubator-uniffle,1367752987,442,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2022-12-30T06:39:24Z,2022-12-30T06:39:24Z,"> > `org.opentest4j.AssertionFailedError: expected: <null> but was: <30>` It is said here that the expectation is null, but it is actually 30. However, the expected value of my code is 30. I feel a little confused
> > ```
> > assertEquals(user3, 30);
> > ```
> 
> user3 is set null value.
```
2022-12-21 03:52:53,270 ERROR [UpdateDefaultApp-0] coordinator.QuotaManager (QuotaManager.java:detectUserResource(94)) - Can't find this file hdfs://localhost:40055/quotaFile.properties
```
This is the reason why user3 is null, because the update of quota file failed. I'll fix this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhkEb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/442,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhyP8,incubator-uniffle,1367811068,442,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-30T09:17:53Z,2022-12-30T09:17:53Z,closed by #453 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhyP8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/443,https://api.github.com/repos/apache/incubator-uniffle/issues/443,incubator-uniffle,1505781452,443,[Improvement] refactor getPartitionRange to calculate range directly,advancedxy,807537,,,CLOSED,2022-12-21T06:31:52Z,2022-12-28T07:39:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

ShuffleStorageUtils.getPartitionRange is not performant...

It could be calculated directly in O(1).. However current impl is about O(n) where n is the number of partition ranges. when partition range size =1, n is corresponding to partition numbers.

### How should we improve?

refactor `ShuffleStorageUtils.getPartitionRange` to calculate range directly.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/443/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/443,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RHd8C,incubator-uniffle,1360912130,443,NA,advancedxy,807537,,,NA,2022-12-21T06:35:02Z,2022-12-21T06:35:02Z,"Related context: https://github.com/apache/incubator-uniffle/pull/424#discussion_r1050655270

I would leave it open until next week, so someone who want to make a contribution, can start with this small improvement.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RHd8C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/443,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RUhgK,incubator-uniffle,1364334602,443,NA,a-li,7497012,,,NA,2022-12-23T21:05:13Z,2022-12-23T21:05:13Z,Hey I’m looking to contribute to Uniffle and would like to try to do this task.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RUhgK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/443,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RU985,incubator-uniffle,1364451129,443,NA,advancedxy,807537,,,NA,2022-12-24T03:28:43Z,2022-12-24T03:28:43Z,"@a-li thanks, I’ve assigned it to you","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RU985/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/446,incubator-uniffle,1508793156,446,[FEATURE][Spark] Support partial sort and combine for reducing shuffle data size,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2022-12-23T02:24:17Z,2024-02-06T08:38:55Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In spark client, currently uniffle don't support merge for some ops supporting combine  to reduce data size. Due to this, in some cases, it will cause unnecessary network and performance regression.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/446/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RRh-8,incubator-uniffle,1363550140,446,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-23T02:25:47Z,2022-12-23T02:25:47Z,"I encounter this problem in our online jobs, but I don't dig into it. Anyway, from my side, this feature is an improvement.

cc @xianjingfeng @advancedxy @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RRh-8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RRqG-,incubator-uniffle,1363583422,446,NA,advancedxy,807537,,,NA,2022-12-23T03:46:42Z,2022-12-23T03:46:42Z,"You mean map side combine? 

Well, last time I checked, uniffle don't do any combine, just create a combined value for each record.

If we are going to support this feature, maybe a lot of client side code should be rewrote...😇","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RRqG-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RRu-0,incubator-uniffle,1363603380,446,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-23T04:23:55Z,2022-12-23T04:23:55Z,"> You mean map side combine?

Yes

> If we are going to support this feature, maybe a lot of client side code should be rewrote...😇

Yes. 🙆","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RRu-0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxefL,incubator-uniffle,1925572555,446,NA,KnightChess,20125927,,wlqfzs507@gmail.com,NA,2024-02-04T04:02:21Z,2024-02-04T04:02:21Z,we also have this demand. I met in hudi table which will use `countByKey` to evaluation work load.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxefL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxeso,incubator-uniffle,1925573416,446,NA,KnightChess,20125927,,wlqfzs507@gmail.com,NA,2024-02-04T04:05:53Z,2024-02-04T04:05:53Z,any plan to support it?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxeso/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxiq4,incubator-uniffle,1925589688,446,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-04T05:43:44Z,2024-02-04T05:43:44Z,"> any plan to support it?

haven't. If you want this, feel free to discuss more","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxiq4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yyEgA,incubator-uniffle,1925728256,446,NA,KnightChess,20125927,,wlqfzs507@gmail.com,NA,2024-02-04T12:11:39Z,2024-02-04T12:11:39Z,"how about use `ExternalAppendOnlyMap` to archive it, but it's may spill to disk, we can add a param to controll it. And I think if map side can be combine, it will reduce shuffle data and reduce data skew problems","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yyEgA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yyFlF,incubator-uniffle,1925732677,446,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-02-04T12:29:02Z,2024-02-04T12:29:02Z,"ExternalAppendOnlyMap is used to handle huge data, I think it is not necessary. We can sort and combine in memory, then serialize the records. I did it in #1239 (developing) by this way. But I bind only the use of the remote merge feature.

I afraid that the proportion of being combined may be not high, since we use pipelined shuffle in rss, only partial record will be combined. 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yyFlF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yzdC1,incubator-uniffle,1926090933,446,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-05T01:59:49Z,2024-02-05T01:59:49Z,The client and server side merge are all needed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yzdC1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-M0p,incubator-uniffle,1928908073,446,NA,KnightChess,20125927,,wlqfzs507@gmail.com,NA,2024-02-06T07:11:49Z,2024-02-06T07:11:49Z,"I think the merging should work on the client side, not on the RSS server. It maximizes the utilization of executor resources, rather than placing the computation burden on the RSS server, whose resources are shared and need to ensure stability and the normal operation of core services.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-M0p/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-M9X,incubator-uniffle,1928908631,446,NA,KnightChess,20125927,,wlqfzs507@gmail.com,NA,2024-02-06T07:12:20Z,2024-02-06T07:12:20Z,"And furthermore, I think the RSS server is best left to handle data transmission efficiently without any content processing. It should return whatever it receives from user tasks. All data content processing is preferably performed by the executors, allowing the RSS server to focus solely on efficient shuffle transmission. What do you think?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-M9X/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-O9c,incubator-uniffle,1928916828,446,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-02-06T07:19:54Z,2024-02-06T07:19:54Z,"@KnightChess 

If you think RSS sever should not handle any content, you can save the shuffle date to 3rd remote filesystem, and read the shuffle data from this filesystem.

What is your purpose of using remote shuffle service?

For me, the main purpose for remote merge in shuffle side is that application will not use any local file as shuffle storage, then we can realize the separation of storage and computing, then support hybrid deployment.

Then Remote merge is optional function.  And If we merge on server side, we can reduce the resource usage of executor, then add the resource to shuffle server. That's not a problem.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-O9c/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-nBs,incubator-uniffle,1929015404,446,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-06T08:34:13Z,2024-02-06T08:34:13Z,"> I think the merging should work on the client side, not on the RSS server.

I think the zheng's design motivation is not same with you @KnightChess , if you want this, client merge design is OK for me, that is not conflict with remote merge. Right @zhengchenyu ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-nBs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/446,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-o0h,incubator-uniffle,1929022753,446,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-02-06T08:38:54Z,2024-02-06T08:38:54Z,"Well, yes. I'm just offering a suggestion, sort in memory. There is no conflict!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y-o0h/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/448,https://api.github.com/repos/apache/incubator-uniffle/issues/448,incubator-uniffle,1511374004,448,[Subtask] Shuffle server shall report its local storage capability,advancedxy,807537,,,CLOSED,2022-12-27T02:28:06Z,2023-01-11T02:45:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

the shuffle worker shall report the local storage's hard drive type: HDD, SSD, etc and the disk numbers.

### Parent issue

#405

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/448/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/448,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RsNHW,incubator-uniffle,1370542550,448,NA,advancedxy,807537,,,NA,2023-01-04T06:46:39Z,2023-01-04T06:46:39Z,Related design doc: https://docs.google.com/document/d/1JcXJxwmJWCtNMWb8bS9LdcKz2x7kqSyxDjKt3BcPZmk/edit?usp=sharing,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RsNHW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/451,https://api.github.com/repos/apache/incubator-uniffle/issues/451,incubator-uniffle,1513446556,451,[Improvement] Read HDFS data files with random sequence to distribute pressure,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2022-12-29T07:03:53Z,2023-01-03T08:26:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In PR #396 to support concurrently writing single partition's data into multiple HDFS files, it's better to randomly read HDFS data files to distribute stress in client side.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/451/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfH78,incubator-uniffle,1367113468,451,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-29T07:04:27Z,2022-12-29T07:04:27Z,PTAL @advancedxy @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfH78/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfQDK,incubator-uniffle,1367146698,451,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2022-12-29T08:17:15Z,2022-12-29T08:17:15Z,I'm not sure that it can bring much performance improvement.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfQDK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfUjD,incubator-uniffle,1367165123,451,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-29T08:56:15Z,2022-12-29T08:56:15Z,"> I'm not sure that it can bring much performance improvement.

To reduce the datanode pressure from multiple readers, especially for 1 replica.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RfUjD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhX_g,incubator-uniffle,1367703520,451,NA,advancedxy,807537,,,NA,2022-12-30T03:24:45Z,2022-12-30T03:24:45Z,"> To reduce the datanode pressure from multiple readers, especially for 1 replica.

Normally, there should be only one reader to read one/multiple partition file(s)? 

Do you encounter this case in prod.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhX_g/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhYH-,incubator-uniffle,1367704062,451,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2022-12-30T03:27:29Z,2022-12-30T03:27:29Z,"If this is a huge skewed partition, there are many readers to handle this partition.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5RhYH-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/455,https://api.github.com/repos/apache/incubator-uniffle/issues/455,incubator-uniffle,1518568900,455,[Improvement]  Lazily create `uncompressedData`,xianjingfeng,11752250,,,CLOSED,2023-01-04T08:49:45Z,2023-01-06T10:43:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

This part as follows will cost much memory if we use AQE. We should create `uncompressedData` lazily.
https://github.com/apache/incubator-uniffle/blob/9572b8423fff8f3dfa52411dae1caa4d33f08663/client-spark/common/src/main/java/org/apache/spark/shuffle/reader/RssShuffleDataIterator.java#L73-L78

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/455/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/455,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rsi9G,incubator-uniffle,1370632006,455,NA,xianjingfeng,11752250,,,NA,2023-01-04T08:50:05Z,2023-01-04T08:50:05Z,PTAL @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rsi9G/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/455,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rs-vy,incubator-uniffle,1370745842,455,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-04T10:26:55Z,2023-01-04T10:26:55Z,"Nice catch, could you help fix this? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Rs-vy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/455,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R3U7P,incubator-uniffle,1373458127,455,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-06T10:43:01Z,2023-01-06T10:43:01Z,closed by #457 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R3U7P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/456,https://api.github.com/repos/apache/incubator-uniffle/issues/456,incubator-uniffle,1518578708,456,[Improvement] Avoid removeResources for multiple times,xianjingfeng,11752250,,,CLOSED,2023-01-04T08:57:20Z,2023-01-10T02:38:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

If `removeResources` take to much time. NPE will be thrown as follows.

```shell
[ERROR] 2022-12-30 00:43:28,403 clearResourceThread ShuffleTaskManager lambda$new$3 - Exception happened when clear resource for expired application
java.lang.NullPointerException
        at org.apache.uniffle.server.ShuffleTaskManager.removeResources(ShuffleTaskManager.java:479)
        at org.apache.uniffle.server.ShuffleTaskManager.lambda$new$3(ShuffleTaskManager.java:130)
        at java.lang.Thread.run(Thread.java:745)

```

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/456/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/456,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R3MEw,incubator-uniffle,1373421872,456,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-06T10:02:47Z,2023-01-06T10:02:47Z,"Nice catch, could you help fix this? If not, you could give some points to fix and mark it as `good first issue`. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R3MEw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/456,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SDfQL,incubator-uniffle,1376646155,456,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-10T02:38:43Z,2023-01-10T02:38:43Z,Fixed by #459 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SDfQL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/460,incubator-uniffle,1524873531,460,[Improvement]  Exit on OutOfMemoryError,xianjingfeng,11752250,,,CLOSED,2023-01-09T03:30:03Z,2023-12-21T07:05:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

At present, if OutOfMemoryError is encountered, server will not exit.

### How should we improve?

Add `-XX:+ExitOnOutOfMemoryError` and `-XX:+CrashOnOutOfMemoryError` to JVM argments.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/460/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R9dbW,incubator-uniffle,1375065814,460,NA,xianjingfeng,11752250,,,NA,2023-01-09T03:30:57Z,2023-01-09T03:30:57Z,PTAL @jerqi @zuston @advancedxy ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R9dbW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R9d7D,incubator-uniffle,1375067843,460,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-09T03:36:57Z,2023-01-09T03:36:57Z,"> PTAL @jerqi @zuston @advancedxy

Do we need dump the memory when OOM occurs？","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R9d7D/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R9vaH,incubator-uniffle,1375139463,460,NA,xianjingfeng,11752250,,,NA,2023-01-09T06:03:06Z,2023-01-09T06:03:06Z,"> > PTAL @jerqi @zuston @advancedxy
> 
> Do we need dump the memory when OOM occurs？

The dump file maybe too big and disk space may be not enough to store it. So users should specify the path to store it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R9vaH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R9xyV,incubator-uniffle,1375149205,460,NA,advancedxy,807537,,,NA,2023-01-09T06:12:43Z,2023-01-09T06:12:43Z,"> > > PTAL @jerqi @zuston @advancedxy
> > 
> > 
> > Do we need dump the memory when OOM occurs？
> 
> The dump file maybe too big and disk space may be not enough to store it. So users should specify the path to store it.

+1 from my side. oom dump should be an opt-in feature. The bin/start-shuffle-server.sh may handle that as a cli argument or env variable.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R9xyV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-0x4,incubator-uniffle,1375423608,460,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-09T10:50:20Z,2023-01-09T10:50:20Z,"> The bin/start-shuffle-server.sh may handle that as a cli argument or env variable.

Good idea. This should be supported.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-0x4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X7q-s,incubator-uniffle,1475260332,460,NA,AdarshRawat1,100958893,Adarsh Rawat,23391097@geu.ac.in,NA,2023-03-19T13:40:29Z,2023-03-19T13:40:29Z,Requesting permission to contribute to this feature. . Can you please advise on how I can get involved? Thanks,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X7q-s/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X7rdY,incubator-uniffle,1475262296,460,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-19T13:48:29Z,2023-03-19T13:48:29Z,"> Requesting permission to contribute to this feature. . Can you please advise on how I can get involved? Thanks

I assigned this issue to you.
@AdarshRawat1 You can refer to https://github.com/apache/incubator-uniffle/blob/master/CONTRIBUTING.md
If you have any question, you can ask me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X7rdY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X75VD,incubator-uniffle,1475319107,460,NA,AdarshRawat1,100958893,Adarsh Rawat,23391097@geu.ac.in,NA,2023-03-19T16:52:03Z,2023-03-19T16:52:03Z,"> > Requesting permission to contribute to this feature. . Can you please advise on how I can get involved? Thanks
> 
> I assigned this issue to you. @AdarshRawat1 You can refer to https://github.com/apache/incubator-uniffle/blob/master/CONTRIBUTING.md If you have any question, you can ask me.

@jerqi Could you kindly provide me with additional resources and guidance [files to change, tests to perform], please?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X75VD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X8lq-,incubator-uniffle,1475500734,460,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-20T01:59:29Z,2023-03-20T01:59:29Z,"1 files to change

https://github.com/apache/incubator-uniffle/blob/master/bin/start-coordinator.sh
https://github.com/apache/incubator-uniffle/blob/master/bin/start-shuffle-server.sh

 2 test to perform
You build package and unzip it, set environment variable (JAVA_HOME and HADOOP_HOME) and run the cmd
`sh bin/start-shuffle-server.sh` and `sh bin/start-coordinator.sh`. If the process start successfully, the change is ok.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X8lq-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aLbvR,incubator-uniffle,1512946641,460,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-18T11:50:51Z,2023-04-18T11:50:51Z,@AdarshRawat1 Do you need any other help from me?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aLbvR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aLfCJ,incubator-uniffle,1512960137,460,NA,AdarshRawat1,100958893,Adarsh Rawat,23391097@geu.ac.in,NA,2023-04-18T11:59:08Z,2023-04-18T11:59:08Z,"> @AdarshRawat1 Do you need any other help from me?

 @jerqi  I’m currently occupied with my mid-term exams. Once I’m done with them, I’ll address this issue. I would appreciate your valuable guidance at that time. Thank you. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aLfCJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUwAF,incubator-uniffle,1666383877,460,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T04:25:57Z,2023-08-05T04:25:57Z,"> > @AdarshRawat1 Do you need any other help from me?
> 
> @jerqi I’m currently occupied with my mid-term exams. Once I’m done with them, I’ll address this issue. I would appreciate your valuable guidance at that time. Thank you.

@AdarshRawat1 Do you want to continue this issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUwAF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jU1RJ,incubator-uniffle,1666405449,460,NA,AdarshRawat1,100958893,Adarsh Rawat,23391097@geu.ac.in,NA,2023-08-05T06:06:06Z,2023-08-05T06:06:06Z,@jerqi I deeply regret the delay and will commence work on it today. I look forward to receiving your guidance throughout the process.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jU1RJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jamUl,incubator-uniffle,1667917093,460,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-07T14:00:46Z,2023-08-07T14:00:46Z,"> @jerqi I deeply regret the delay and will commence work on it today. I look forward to receiving your guidance throughout the process.

OK. I will give some guidance.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jamUl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/460,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jbRA-,incubator-uniffle,1668091966,460,NA,AdarshRawat1,100958893,Adarsh Rawat,23391097@geu.ac.in,NA,2023-08-07T15:28:10Z,2023-08-07T15:28:10Z,"@jerqi I apologize, but I'm unable to work on this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jbRA-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/461,https://api.github.com/repos/apache/incubator-uniffle/issues/461,incubator-uniffle,1524887851,461,[FEATURE] Spark 3.3 support,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-01-09T03:59:13Z,2023-01-10T11:04:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support Spark 3.3 in Uniffle.

### Motivation

Spark 3.3 has been released in Jun 16, 2022.
Users are going to migrate to Spark 3.3 sooner or later.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/461/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/461,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-W8R,incubator-uniffle,1375301393,461,NA,advancedxy,807537,,,NA,2023-01-09T09:08:39Z,2023-01-09T09:08:39Z,"Would you like to submit a PR here? Or do you encounter some issues?

I was expected we can simply use spark 3.2 support to run spark 3.3 apps as Spark 3.3 doesn't change the APIs..","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-W8R/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/461,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-X6f,incubator-uniffle,1375305375,461,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-09T09:11:20Z,2023-01-09T09:11:20Z,"> Would you like to submit a PR here? Or do you encounter some issues?

I'm not sure.

> I was expected we can simply use spark 3.2 support to run spark 3.3 apps as Spark 3.3 doesn't change the APIs..

In this case, we should add test profile for Spark 3.3 and enable them in CI.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-X6f/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/461,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-0fo,incubator-uniffle,1375422440,461,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-09T10:49:18Z,2023-01-09T10:49:18Z,Make sense.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-0fo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/461,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-_Lj,incubator-uniffle,1375466211,461,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-09T11:15:21Z,2023-01-09T11:15:21Z,Plus: we may need to create a patch for spark 3.3 in https://github.com/apache/incubator-uniffle/tree/master/spark-patches,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R-_Lj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/461,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R_D_M,incubator-uniffle,1375485900,461,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-09T11:26:13Z,2023-01-09T11:26:13Z,"I'm not sure if I added the profile correctly, seems spark 3.3 requires some test code change:
https://github.com/kaijchen/incubator-uniffle/actions/runs/3873117861/jobs/6602763685#step:8:8","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R_D_M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/461,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SFKX5,incubator-uniffle,1377084921,461,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-10T11:04:13Z,2023-01-10T11:04:13Z,Closed by #463.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SFKX5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/462,https://api.github.com/repos/apache/incubator-uniffle/issues/462,incubator-uniffle,1525723849,462,[Umbrella] Better K8S operator support,advancedxy,807537,,,OPEN,2023-01-09T14:40:11Z,2024-06-25T03:32:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

To support deployment on K8S natively and smoothly, we may have to add the following support:
1. expose more fields in operator's CRD, such as `RuntimeClassName`, `Tolerations`, `Annotation` and `Affinity`, etc. Therefore the shuffle server cloud be deployed more flexible
2. LogHostPath and HostPathMounts may be refactored to be supplied by container runtime. As shuffle server may be deployed on mixed nodes, the `HostPathMounts` can be different on different hosts.
3. Add an cli binary to hide details of RSS operations: rolling upgrade, restart, fully upgrade and gray version etc. 
4. vpc template support 
5. service and network refinement:
   - shuffle server is a network traffic heavy application, it's not wise to use service to proxy external client's read/write request to shuffle server
   - coordinators' deployment may need some refine, in current arch, the replicate of coordinator can only one 1. Otherwise, there would be a brain split problem.
6. various bug fixes, such as init-containers resource request/limit.
### Task list

- [x] add more fileds in CRD, such as #469 #545
- [x] #288 
- [x] #289 
- [x] #496 
- [x] #522 
- [x] #524 

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/462/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/462,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R_-Jw,incubator-uniffle,1375724144,462,NA,advancedxy,807537,,,NA,2023-01-09T14:40:36Z,2023-01-09T14:40:36Z,cc @wangao1236 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5R_-Jw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/465,https://api.github.com/repos/apache/incubator-uniffle/issues/465,incubator-uniffle,1527197087,465,[FEATURE] Dynamic allocation support for Spark 3.3,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-01-10T11:06:49Z,2024-06-05T06:20:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Create a patch for spark 3.3 in https://github.com/apache/incubator-uniffle/tree/master/spark-patches

Verify the result.

### Motivation

Support Spark 3.3

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/465/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/468,https://api.github.com/repos/apache/incubator-uniffle/issues/468,incubator-uniffle,1528365906,468,[Improvement] Put unavailable shuffle servers to the end of the server list when sending shuffle data,xianjingfeng,11752250,,,CLOSED,2023-01-11T03:31:33Z,2023-01-31T09:06:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

If we use multiple replicas and the first shuffle server becomes unavailable, sending data will take a lot of time. Because the client will always send to the first shuffle server firstly.

### How should we improve?

If sending data to shuffle server failed, put it to the end of the server list before sending data.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/468/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/468,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SJcMr,incubator-uniffle,1378206507,468,NA,advancedxy,807537,,,NA,2023-01-11T03:49:58Z,2023-01-11T03:49:58Z,"> If we use multiple replicas and the first shuffle server becomes unavailable 

`shuffle server becomes unavailable` means the shuffle server goes down or the memory consumption on shuffle server is too high?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SJcMr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/468,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SJycC,incubator-uniffle,1378297602,468,NA,xianjingfeng,11752250,,,NA,2023-01-11T06:31:20Z,2023-01-11T06:31:20Z,"> > If we use multiple replicas and the first shuffle server becomes unavailable
> 
> `shuffle server becomes unavailable` means the shuffle server goes down or the memory consumption on shuffle server is too high?

Shuffle server goes down or other reasons for temporary unavailable. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SJycC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/469,https://api.github.com/repos/apache/incubator-uniffle/issues/469,incubator-uniffle,1528423090,469,[FEATURE] Operator supports adding labels to rss pods.,wangao1236,12544973,jasonawang,908622977@qq.com,CLOSED,2023-01-11T04:44:14Z,2023-02-02T07:55:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Operator supports adding labels to rss pods.

### Motivation

More flexible.
Parent issue: #462 

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/469/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/472,https://api.github.com/repos/apache/incubator-uniffle/issues/472,incubator-uniffle,1530183080,472,Flaky Test: LocalFileServerReadHandlerTest#testDataInconsistent,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-01-12T06:32:36Z,2023-01-12T07:50:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1.862 s <<< FAILURE! - in org.apache.uniffle.storage.handler.impl.LocalFileServerReadHandlerTest
Error:  testDataInconsistent  Time elapsed: 1.861 s  <<< ERROR!
java.lang.NullPointerException
	at org.apache.uniffle.storage.handler.impl.LocalFileHandlerTestBase.calcSegmentBytes(LocalFileHandlerTestBase.java:139)
	at org.apache.uniffle.storage.handler.impl.LocalFileServerReadHandlerTest.testDataInconsistent(LocalFileServerReadHandlerTest.java:80)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3891086394/jobs/6640903029

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/472/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/472,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SP_-5,incubator-uniffle,1379925945,472,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-12T07:41:47Z,2023-01-12T07:41:47Z,This is due to `LocalFileHandlerTest` and `LocalFileServerReadHandlerTest` sharing a common state in `LocalFileHandlerTestBase#ATOMIC_LONG`,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SP_-5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/475,https://api.github.com/repos/apache/incubator-uniffle/issues/475,incubator-uniffle,1530223862,475,"[Improvement] It's unnecessary to use ConcurrentHashMap for ""partitionToBlockIds"" in RssShuffleWriter",jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,CLOSED,2023-01-12T07:16:51Z,2023-01-16T15:06:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For RssShuffleWriter, each task has unique instance of RssShuffleWriter. Thus, there is only one thread access its field, ""partitionToBlockIds"". It's inappropriate to use ConcurrentHashMap and ConcurrentHashSet like below.
`
this.partitionToBlockIds = Maps.newConcurrentMap();

partitionToBlockIds.putIfAbsent(partitionId, Sets.newConcurrentHashSet());
`

### How should we improve?

We can just use simple HashMap and HashSet which avoid unnecessary locks.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/475/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/475,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQZ--,incubator-uniffle,1380032446,475,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-12T09:22:54Z,2023-01-12T09:22:54Z,Will it bring too much cost?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQZ--/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/475,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQb3h,incubator-uniffle,1380040161,475,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-01-12T09:29:25Z,2023-01-12T09:29:25Z,"> Will it bring too much cost?

I cannot tell how much cost it is. But you can imagine we need to get lock first before each map operation in each shuffle write partition. And it's counter-intuitive to use lock whilst it's unnecessary. We should avoid lock as much as possible.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQb3h/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/475,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQenz,incubator-uniffle,1380051443,475,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-12T09:39:06Z,2023-01-12T09:39:06Z,"If there is no thread conflicts, the lock operation only cost ns.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQenz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/475,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQl4k,incubator-uniffle,1380081188,475,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-01-12T09:59:04Z,2023-01-12T09:59:04Z,"> If there is no thread conflicts, the clock operation only cost ns.

maybe. There is other potential side-effect, like flushing CPU buffer to memory due to lock involved. So, it's better to avoid lock.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQl4k/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/475,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SRFa6,incubator-uniffle,1380210362,475,NA,advancedxy,807537,,,NA,2023-01-12T11:48:25Z,2023-01-12T11:48:25Z,"I'm in favor of this.  The following code path doesn't need a ConcurrentHashMap as well.
https://github.com/apache/incubator-uniffle/blob/ddf83843a9fbce8155d159815c351b16eb5a9704/client/src/main/java/org/apache/uniffle/client/impl/ShuffleWriteClientImpl.java#L476","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SRFa6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/475,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SU3I6,incubator-uniffle,1381200442,475,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-01-13T01:38:27Z,2023-01-13T01:38:27Z,"> I'm in favor of this. The following code path doesn't need a ConcurrentHashMap as well.
> 
> https://github.com/apache/incubator-uniffle/blob/ddf83843a9fbce8155d159815c351b16eb5a9704/client/src/main/java/org/apache/uniffle/client/impl/ShuffleWriteClientImpl.java#L476

I just re-checked the code. It's different case since the shuffleWriteClientImpl instance is created in RssshuffleManager and shared by different threads. So, it's reasonable to use concurrenthashmp here.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SU3I6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/475,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SU5e3,incubator-uniffle,1381210039,475,NA,advancedxy,807537,,,NA,2023-01-13T01:51:51Z,2023-01-13T01:51:51Z,"The groupedPartitions is a local variable, it will never be used across threads?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SU5e3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/475,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SU6Am,incubator-uniffle,1381212198,475,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-01-13T01:54:46Z,2023-01-13T01:54:46Z,"> The groupedPartitions is a local variable, it will never be used across threads?

correct. let me fix it along with RssShuffleWriter.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SU6Am/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/476,https://api.github.com/repos/apache/incubator-uniffle/issues/476,incubator-uniffle,1530307763,476,"[FEATURE] Respect ""spark.shuffle.compress"" configuration in Uniffle",jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,CLOSED,2023-01-12T08:33:00Z,2023-02-08T06:30:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In Spark, there is a configuration, ""spark.shuffle.compress"", to control if we should compress shuffled data. It defaults to true. But Uniffle always compresses shuffled data without respecting the configuration. Uniffle should respect it to be more align with vanilla Spark.

### Motivation

We should let user decide if compress can be applied since some workloads are not compress friendly which otherwise can avoid useless CPU cycles.

### Describe the solution

We can check ""spark.shuffle.compress"" configuration in WriteBufferManager and RssShuffleDataIterator before compressing and decompressing.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/476/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQZ2u,incubator-uniffle,1380031918,476,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-12T09:22:29Z,2023-01-12T09:22:29Z,Some compress algorithms which  Uniffle supports may be different from Spark's.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQZ2u/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQev7,incubator-uniffle,1380051963,476,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-01-12T09:39:31Z,2023-01-12T09:39:31Z,"> Some compress algorithms which Uniffle supports may be different from Spark's.

It's not related to Spark's compress alg. since rss shuffle manager are separated from Spark's shuffle manager. But it's about whether you want to give user a choice to decide compress or not. It seems that there is a delegationShuffleManager which delegates to Spark's default shuffle manager in some cases. It may cause inconsistency among shuffle managers in regard to the compress configuration.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQev7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQ1_p,incubator-uniffle,1380147177,476,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-12T10:52:28Z,2023-01-12T10:52:28Z,"> > Some compress algorithms which Uniffle supports may be different from Spark's.
> 
> It's not related to Spark's compress alg. since rss shuffle manager are separated from Spark's shuffle manager. But it's about whether you want to give user a choice to decide compress or not. It seems that there is a delegationShuffleManager which delegates to Spark's default shuffle manager in some cases. It may cause inconsistency among shuffle managers in regard to the compress configuration.

Ok, I get your point.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SQ1_p/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SRCrQ,incubator-uniffle,1380199120,476,NA,advancedxy,807537,,,NA,2023-01-12T11:37:23Z,2023-01-12T11:37:23Z,"I believe Uniffle uses `org.apache.uniffle.common.compression.Codec.NOOP` to disable compress. But it's never used in production and may have other hidden issues. cc @zuston.

I'm also in favor of respect compute engine's shuffle options. I just did a quick overview the codec' usage and seems that it's only used in client side. Maybe we should reconsider this part, just let the client(MR or Spark) delegates its compression codec to Spark's or MR's.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SRCrQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SRDHQ,incubator-uniffle,1380200912,476,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-12T11:39:09Z,2023-01-12T11:39:09Z,"> I believe Uniffle uses org.apache.uniffle.common.compression.Codec.NOOP to disable compress. But it's never used in production and may have other hidden issues. cc @zuston.

NOOP is just for test now.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SRDHQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Uw0Xn,incubator-uniffle,1422083559,476,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-08T06:30:24Z,2023-02-08T06:30:24Z,closed by #495 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Uw0Xn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/477,https://api.github.com/repos/apache/incubator-uniffle/issues/477,incubator-uniffle,1530606427,477,[FEATURE] Support stage recompute for Spark clients,advancedxy,807537,,,OPEN,2023-01-12T12:10:59Z,2023-08-24T09:23:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Once `Uniffle`'s shuffle data read fails, the spark client has its chance to recompute the whole stage.

### Motivation

In a distributed cluster with large number of shuffler servers, it's common for some node to go down, such as:
1. node crash/maintenance due to hardware failures or security patches
2. Pod eviction if deployed in a k8s environment
3. vm/spot instance eviction if deployed in a cloud environment

Uniffle already has provide a mechanism to overcome this issue: the quorum protocol. But it requires multiple replica of the same shuffle data, which increases the network traffic and memory pressure on shuffle server.  And the E2E performance may be degraded due to the replication.

I'd like to provide a new way to alleviate the potential node failure(in rare chance). Once the whole stage could be recompute, the Spark App could be resilient to shuffle server node failure.

### Describe the solution

TBD.

A design doc would be added later

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/477/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VFYuG,incubator-uniffle,1427475334,477,NA,advancedxy,807537,,,NA,2023-02-13T07:33:46Z,2023-02-13T07:33:46Z,"I wrote up a design doc for this issue: https://docs.google.com/document/d/1OGswqDDQ52rpw5Lat-FpEGDfX1T6EFXYLC7L0G5O4WE/edit?usp=sharing

@zuston @xianjingfeng @jerqi could you mind do some design review?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VFYuG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VSN_5,incubator-uniffle,1430839289,477,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-02-15T06:45:16Z,2023-02-15T06:45:16Z,@advancedxy I have some comments in the design doc. Please grant me 'comment' permission. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VSN_5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VSfEg,incubator-uniffle,1430909216,477,NA,advancedxy,807537,,,NA,2023-02-15T08:05:25Z,2023-02-15T08:05:25Z,"> @advancedxy I have some comments in the design doc. Please grant me 'comment' permission.

Changed the default permission from viewer to commenter. Please try to refresh it and check whether you have comment permission or not.

I thought viewer already has the comment permission","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VSfEg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hqb3l,incubator-uniffle,1638514149,477,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-17T16:51:38Z,2023-07-17T16:51:38Z,@YutingWang98 Uniffle is a remote shuffle service. We have supported stage retry. Maybe you have interest about it.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hqb3l/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kz0c1,incubator-uniffle,1691305781,477,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-08-24T09:09:11Z,2023-08-24T09:09:11Z,What is remaining on this particular issue Spark side and are there any docs on how this is enabled?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kz0c1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kz6E2,incubator-uniffle,1691328822,477,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-24T09:23:51Z,2023-08-24T09:23:51Z,"> What is remaining on this particular issue Spark side and are there any docs on how this is enabled?

Wait for the pr https://github.com/apache/incubator-uniffle/pull/1129
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kz6E2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/479,https://api.github.com/repos/apache/incubator-uniffle/issues/479,incubator-uniffle,1530707687,479,[Improvement] [Operator] better build system support,advancedxy,807537,,,CLOSED,2023-01-12T13:23:30Z,2023-01-30T08:06:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

1. support RSS operator build on M1 MacBook Pro
2. docker-build and docker-push defaults to docker.io?
3. Commit new code-generated changes
4. replace alpine with Google's distroless containers since alpine uses `musl`, which is hard to used glibc related program

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/479/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/479,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SU_c_,incubator-uniffle,1381234495,479,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-13T02:28:09Z,2023-01-13T02:28:09Z,"2  We would better not do this because binary image release also need a vote process to release the binary image.
4  It seems that we don't use alpine.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SU_c_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/479,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SVBOi,incubator-uniffle,1381241762,479,NA,advancedxy,807537,,,NA,2023-01-13T02:40:04Z,2023-01-13T02:40:04Z,"> 2 We would better not do this because binary image release also need a vote process to release the binary image.
> 4 It seems that we don't use alpine.

For 2, I don’t mean we should release a docker image now, rather have a better default settings that make build-docker works without setting registry explicitly.  We can consider releasing office image when there’s more people asking it.
For 4, the dockerfile uses alpine.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SVBOi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/479,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SVCKf,incubator-uniffle,1381245599,479,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-13T02:46:46Z,2023-01-13T02:46:46Z,"> > 2 We would better not do this because binary image release also need a vote process to release the binary image.
> > 4 It seems that we don't use alpine.
> 
> For 2, I don’t mean we should release a docker image now, rather have a better default settings that make build-docker works without setting registry explicitly. We can consider releasing office image when there’s more people asking it. For 4, the dockerfile uses alpine.

We use `openjdk:8-jdk-slim`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SVCKf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/479,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T7q0z,incubator-uniffle,1408150835,479,NA,advancedxy,807537,,,NA,2023-01-30T08:06:32Z,2023-01-30T08:06:32Z,Fixed  by #491 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T7q0z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/483,https://api.github.com/repos/apache/incubator-uniffle/issues/483,incubator-uniffle,1531735662,483,Flaky Test: ShuffleServerFaultToleranceTest#testReadFaultTolerance,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-01-13T05:36:33Z,2023-03-10T16:06:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.929 s <<< FAILURE! - in org.apache.uniffle.test.ShuffleServerFaultToleranceTest
Error:  testReadFaultTolerance  Time elapsed: 0.152 s  <<< ERROR!
java.lang.NullPointerException
	at org.apache.uniffle.client.TestUtils.validateResult(TestUtils.java:66)
	at org.apache.uniffle.test.ShuffleServerFaultToleranceTest.testReadFaultTolerance(ShuffleServerFaultToleranceTest.java:131)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3908347548/jobs/6678420762

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/483/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/483,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Sechv,incubator-uniffle,1383712879,483,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-16T09:14:07Z,2023-01-16T09:14:07Z,"It's weird that this test fails so often in CI.
https://github.com/apache/incubator-uniffle/actions/runs/3928645075

But It's hard to reproduce it locally.
<img width=""783"" alt=""image"" src=""https://user-images.githubusercontent.com/5821159/212640922-bca848b6-da75-4faa-8b78-2fd545008991.png"">

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Sechv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/483,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SegaN,incubator-uniffle,1383728781,483,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-16T09:25:14Z,2023-01-16T09:25:14Z,I suspect the multiple test cases sequence will cause different test result rather than running multiple times for one test,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SegaN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/483,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SjrCE,incubator-uniffle,1385083012,483,NA,advancedxy,807537,,,NA,2023-01-17T09:25:10Z,2023-01-17T09:25:10Z,"https://github.com/apache/incubator-uniffle/actions/runs/3937625492/jobs/6735376117 there's another instance about this case...

I think maybe we need to priority the fix to this issue... @kaijchen do you have some time to investigate this issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SjrCE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/483,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XHHaI,incubator-uniffle,1461483144,483,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-09T07:37:25Z,2023-03-09T07:37:25Z,Could you help fix this? @smallzhongfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XHHaI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/484,https://api.github.com/repos/apache/incubator-uniffle/issues/484,incubator-uniffle,1531900319,484,[Bug] HdfsStorageManager#appIdToStorages data lost when removing resources for partial shuffleIds,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-01-13T08:25:22Z,2023-01-17T02:03:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

[Bug] HdfsStorageManager#appIdToStorages data lost when removing resources for partial shuffleIds

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/484/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/487,https://api.github.com/repos/apache/incubator-uniffle/issues/487,incubator-uniffle,1534384717,487,[Improvement] Java 8 syntax helps with code readability improvements,iwangjie,23075587,Na Meng,345127857@qq.com,CLOSED,2023-01-16T06:40:58Z,2023-01-16T08:45:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Can be replaced with the lambda referenced by the method. Method references are easier to understand and read and unify than lambda.

### How should we improve?

I will submit the changed PR

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/487/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/489,https://api.github.com/repos/apache/incubator-uniffle/issues/489,incubator-uniffle,1534461777,489,[Improvement] We can simplify and standardize some of the code,iwangjie,23075587,Na Meng,345127857@qq.com,CLOSED,2023-01-16T07:59:08Z,2023-01-16T09:38:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

ConfigUtils.java
HdfsFileWriter.java
HdfsShuffleReadHandler.java
PartitionBalanceAssignmentStrategy.java
RetryUtils.java
RssFetcher.java
RssShuffleReader.java
ShuffleServer.java
ShuffleTaskManager.java
SortWriteBufferManager.java

Unnecessary transformations and reusable calls in these classes

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/489/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/493,https://api.github.com/repos/apache/incubator-uniffle/issues/493,incubator-uniffle,1535690218,493,[Improvement] Replace putIfAbsent with computeIfAbsent in some critical paths,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-01-17T02:26:17Z,2023-05-13T03:20:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

This problem is mentioned by previous PR https://github.com/apache/incubator-uniffle/pull/481#discussion_r1070752457.

The invoking of `putIfAbsent` will always call its value if it's a time-consuming operation. So we'd better replace putIfAbsent with computeIfAbsent in some critical paths.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/493/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/493,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T7qhb,incubator-uniffle,1408149595,493,NA,advancedxy,807537,,,NA,2023-01-30T08:05:33Z,2023-01-30T08:05:33Z,https://github.com/apache/incubator-uniffle/issues/519 these two issues should be considered together,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T7qhb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/493,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UXXFu,incubator-uniffle,1415410030,493,NA,Pushkarmondal,116779860,Pushkar Mondal,,NA,2023-02-03T09:04:37Z,2023-02-03T09:04:37Z,"is this issue resolved?
Hey how can I contribute to this ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UXXFu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/493,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5b7Z6n,incubator-uniffle,1542299303,493,NA,cchung100m,6762509,Neo Chien,,NA,2023-05-10T14:20:09Z,2023-05-10T14:20:09Z,"Hi @zuston 

I'd like to handle this issue if you agreed.  Thank you.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5b7Z6n/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/493,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5b-38c,incubator-uniffle,1543208732,493,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-05-11T02:08:17Z,2023-05-11T02:08:17Z,@cchung100m Assigned. Thanks in advance,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5b-38c/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/496,https://api.github.com/repos/apache/incubator-uniffle/issues/496,incubator-uniffle,1537492846,496,[Subtask][operator] set init-container's resource request,advancedxy,807537,,,CLOSED,2023-01-18T06:56:54Z,2023-01-31T07:12:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

uniffle's rss operator generate init-container without resource requirement, which normally could be acceptable. 
But when deployed to namespace with resource quota, every pod should set its resource request, otherwise the controller could reject the pod creation.

Therefore rss operator should set coordinator and shuffle server's init-container with resource request inferred.

<img width=""1732"" alt=""image"" src=""https://user-images.githubusercontent.com/807537/213104431-33e4699c-7173-4743-a4c8-7516b578a26f.png"">


### Parent issue

#462 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/496/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/496,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Sp3sC,incubator-uniffle,1386707714,496,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-18T09:02:11Z,2023-01-18T09:02:11Z,"Do you mean uniffle should set the default resource request? like that

![image](https://user-images.githubusercontent.com/8609142/213128323-dd4a05d3-24de-4b23-bec3-d996f7c6389e.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Sp3sC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/496,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SqOd_,incubator-uniffle,1386801023,496,NA,advancedxy,807537,,,NA,2023-01-18T10:11:05Z,2023-01-18T10:11:05Z,"> Do you mean uniffle should set the default resource request? like that
> 
> ![image](https://user-images.githubusercontent.com/8609142/213128323-dd4a05d3-24de-4b23-bec3-d996f7c6389e.png)

Yes and no. 

- Yeah: uniffle's coordinator and shuffle server's init-container(auto appended by operator) should has non-empty resource field. 
- No: rss operator don't need to set a default resource request.  https://github.com/apache/incubator-uniffle/blob/master/deploy/kubernetes/operator/api/uniffle/v1alpha1/remoteshuffleservice_types.go#L225 rss crd already defines the resource field. The auto-generated init-container should inherit this requirement.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5SqOd_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/497,https://api.github.com/repos/apache/incubator-uniffle/issues/497,incubator-uniffle,1537660231,497,[Improvement] Rethink the config of 'rss.server.write.slow.threshold',zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-01-18T09:20:28Z,2023-01-19T03:11:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The 'rss.server.write.slow.threshold' config option is intent to indicate the writing slow operations by summarizing writing time. But unfortunately, for huge event(single flush data event size reaches 10g) and different storage type(HDFS), it's not convincing.

I prefer to choosing the writing speed to indicate writing slow operation.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/497/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/497,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOuzk,incubator-uniffle,1396370660,497,NA,advancedxy,807537,,,NA,2023-01-19T02:44:39Z,2023-01-19T02:44:39Z,"> writing speed 

+1. However we should approach this with a compatible way. something like:
1. introduce new configuration item: `slowSpeed. threshold` and deprecating the old configuration.
2. warning use of old configuration. 
3. Remove the old configuration in two or three version later, meanwhile make sure the configuration works well

Also, the writing speed threshold might be different for different storages.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOuzk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/497,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOyg2,incubator-uniffle,1396385846,497,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-19T03:11:48Z,2023-01-19T03:11:48Z,">  However we should approach this with a compatible way. something like:

Yes. Currently Uniffle don't introduce the deprecated annotation shown in the doc yet. Let's open a new issue to track this.

> Also, the writing speed threshold might be different for different storages.

Sounds good. It's better to distinguish different storage.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOyg2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/498,https://api.github.com/repos/apache/incubator-uniffle/issues/498,incubator-uniffle,1537683681,498,[Improvement] Extend event size threshold metric configuration to any number of levels,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-01-18T09:37:35Z,2023-01-19T02:41:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In current codebase, it has three levels metrics of `rss.server.event.size.threshold.l1/l2/l3`, but this is not enough for production env. 

We hope to extend event size threshold metric configuration to any number of levels, like introducing a new config option: 
`rss.server.event.size.threshold.level.ranges=20k,1m,10m,100m,1g,10g,` which could cover the multiple levels for better configuring the writing threads number or single buffer flush size.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/498/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/498,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOuI2,incubator-uniffle,1396367926,498,NA,advancedxy,807537,,,NA,2023-01-19T02:39:14Z,2023-01-19T02:39:14Z,"> rss.server.event.size.threshold.level.ranges=20k,1m,10m,100m,1g,10g

So, you want to generate metric name dynamically, something like `rss.server.event.size.threshold.{20k,1g}`? 
I agree the fixed three level is limited and we should extend it. The problem is how much flexibility exposed to end user without confusing them.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOuI2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/498,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOued,incubator-uniffle,1396369309,498,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-19T02:41:54Z,2023-01-19T02:41:54Z,"> So, you want to generate metric name dynamically, something like rss.server.event.size.threshold.{20k,1g}?

Not accurate. Metrics will be exposed like: event_size_range_0_20k, event_size_range_20k_1m ....","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOued/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/502,https://api.github.com/repos/apache/incubator-uniffle/issues/502,incubator-uniffle,1548452869,502,Flaky Test: QuorumTest#case5,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-01-19T03:16:36Z,2023-01-19T03:34:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.uniffle.test.AccessCandidatesCheckerHdfsTest
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 10.841 s - in org.apache.uniffle.test.AccessCandidatesCheckerHdfsTest
[INFO] Running org.apache.uniffle.test.CoordinatorGrpcTest
[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 19.744 s - in org.apache.uniffle.test.CoordinatorGrpcTest
[INFO] Running org.apache.uniffle.test.ShuffleServerConcurrentWriteOfHdfsTest
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 8.722 s - in org.apache.uniffle.test.ShuffleServerConcurrentWriteOfHdfsTest
[INFO] Running org.apache.uniffle.test.ShuffleServerWithHdfsTest
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 4.363 s - in org.apache.uniffle.test.ShuffleServerWithHdfsTest
[INFO] Running org.apache.uniffle.test.ShuffleWithRssClientTest
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 75.436 s - in org.apache.uniffle.test.ShuffleWithRssClientTest
[INFO] Running org.apache.uniffle.test.DiskErrorToleranceTest
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 13.069 s - in org.apache.uniffle.test.DiskErrorToleranceTest
[INFO] Running org.apache.uniffle.test.ShuffleServerGrpcTest
Warning:  Tests run: 7, Failures: 0, Errors: 0, Skipped: 1, Time elapsed: 26.458 s - in org.apache.uniffle.test.ShuffleServerGrpcTest
[INFO] Running org.apache.uniffle.test.QuorumTest
Error:  Tests run: 14, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 66.687 s <<< FAILURE! - in org.apache.uniffle.test.QuorumTest
Error:  case5{File}  Time elapsed: 2.658 s  <<< ERROR!
org.apache.uniffle.common.exception.RssException: Get shuffle result is failed for appId[case5], shuffleId[0]
	at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.getShuffleResult(ShuffleWriteClientImpl.java:550)
	at org.apache.uniffle.test.QuorumTest.case5(QuorumTest.java:502)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3954858017/jobs/6772624759

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/502/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/502,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOzJ7,incubator-uniffle,1396388475,502,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-19T03:17:10Z,2023-01-19T03:17:10Z,This pr's test failed. https://github.com/apache/incubator-uniffle/actions/runs/3954858017 cc @kaijchen ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TOzJ7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/502,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TO1Ku,incubator-uniffle,1396396718,502,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-19T03:34:27Z,2023-01-19T03:34:27Z,"@zuston thanks for reporting this issue. I'm not sure what's happened, have you seen this failure before #492?
<img width=""768"" alt=""100x QuorumTest#case5"" src=""https://user-images.githubusercontent.com/5821159/213349218-d9239a28-3518-4cc2-9bfb-eec0dfdf1dd7.png"">
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TO1Ku/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/503,incubator-uniffle,1548592236,503,[Bug] Frequent and long lasting full GCs when there are too many partitions on a shuffle server,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-01-19T06:35:39Z,2023-02-02T11:55:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I found the full GC occurs when there are too many partitions on a shuffle server, and the duration could be 20s+.

Env: 
1. using java8
2. xmx=30g, buffer-capacity=10g, read-capacity=10g
3. from the metric dashboard, during peek hours, there are 20k partitions in a shuffle-server, but disk used capacity ratio is 0.1-0.2

I guess the object creating or allocation request speed is greater than the gc speed, which causes the STW.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

```yaml
We use the default g1 GC configuration.
```


### Uniffle Engine Configurations

_No response_

### Additional context

### Possible solutions
1. Garbage collector changes to CMS
2. Expand the uniffle cluster by adding more shuffle-servers
3. If one shuffle-server has partition number exceeding the threshold, we should make it fallback to ess.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/503/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TPPS0,incubator-uniffle,1396503732,503,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-19T06:36:33Z,2023-01-19T06:36:33Z,"@leixm @xianjingfeng Do you encounter similar problems? 

cc @advancedxy @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TPPS0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TPXl-,incubator-uniffle,1396537726,503,NA,advancedxy,807537,,,NA,2023-01-19T07:15:21Z,2023-01-19T07:15:21Z,"> 1. Garbage collector changes to CMS
> 2. Expand the uniffle cluster by adding more shuffle-servers
> 3. If one shuffle-server has partition number exceeding the threshold, we should make it fallback to ess.

If possible, you could also scale-up the shuffle-server, let's say, bump the maxHeapSize to 60G.

For 1, I doubt its effectiveness. But you experiment report is much appreciated.
For 2, this could always be a simple and direct solution.
For 3, you mean coordinator reject the app upon app startup or at app's stage level? Stage level fallback is a big change. Itself may deserve a issue and a design doc.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TPXl-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TPXxx,incubator-uniffle,1396538481,503,NA,advancedxy,807537,,,NA,2023-01-19T07:16:22Z,2023-01-19T07:16:22Z,"> from the metric dashboard, during peek hours, there are 20k partitions in a shuffle-server, but disk used capacity ratio is 0.1-0.2

If possible, could you share more data, such as, average partition size, min/max partition size, disk capacity, how many disks per shuffle server?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TPXxx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TPmyN,incubator-uniffle,1396599949,503,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-19T08:21:12Z,2023-01-19T08:21:12Z,"> bump the maxHeapSize to 60G.

It's impossible for us, shuffle-servers are colocated with nodemanager.

> For 1, I doubt its effectiveness. But you experiment report is much appreciated.

I do a comparison experiment which shows CMS is more stable. But this should be observed more long to prove this.

> For 2, this could always be a simple and direct solution.
For 3, you mean coordinator reject the app upon app startup or at app's stage level? Stage level fallback is a big change. Itself may deserve a issue and a design doc.

App's stage level is enough, but stage level will be better. Currently, let's introduce this config to reject app when using delegate rss shuffle manager.

> If possible, could you share more data, such as, average partition size, min/max partition size, disk capacity, how many disks per shuffle server?

average partition size, min/max partition size, these metrics can't be collected in current codebase, but I will add it firstly in our internal version. 

single disk capacity: 1TB, 4disk per shuffle server. From the dashboard, disk is not the root cause.

By the way, if the netty is introduced, I think this is not a problem in the future.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5TPmyN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T4T3Q,incubator-uniffle,1407270352,503,NA,xianjingfeng,11752250,,,NA,2023-01-28T03:11:26Z,2023-01-28T03:11:26Z,"> @leixm @xianjingfeng Do you encounter similar problems?

I haven't found this situation yet.
xmx=80g, buffer-capacity=40g, read-capacity=20g","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T4T3Q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5iuR,incubator-uniffle,1407593361,503,NA,advancedxy,807537,,,NA,2023-01-29T08:05:56Z,2023-01-29T08:05:56Z,"> By the way, if the netty is introduced, I think this is not a problem in the future.

Yeah, I just pinged xianming in #133 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5iuR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJIgU,incubator-uniffle,1411680276,503,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-01T08:50:17Z,2023-02-01T08:50:17Z,"> > @leixm @xianjingfeng Do you encounter similar problems?
> 
> I haven't found this situation yet. xmx=80g, buffer-capacity=40g, read-capacity=20g

I don't enable the single buffer flush. And I found this occurrence of full GC is always along with the huge partition appearance although I have switched GC to CMS. 

So I guess the big memory shuffleBlock reference of huge partition is released but gc throughout is slower than receiving data speed and then gc happened.

Based on this guess, I will enable the single buffer flush to avoid this problem. Could you help give some advice? @advancedxy @xianjingfeng @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJIgU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJf-r,incubator-uniffle,1411776427,503,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-01T09:57:06Z,2023-02-01T09:57:06Z,"> > > @leixm @xianjingfeng Do you encounter similar problems?
> > 
> > 
> > I haven't found this situation yet. xmx=80g, buffer-capacity=40g, read-capacity=20g
> 
> I don't enable the single buffer flush. And I found this occurrence of full GC is always along with the huge partition appearance although I have switched GC to CMS.
> 
> So I guess the big memory shuffleBlock reference of huge partition is released but gc throughout is slower than receiving data speed and then gc happened.
> 
> Based on this guess, I will enable the single buffer flush to avoid this problem. Could you help give some advice? @advancedxy @xianjingfeng @jerqi

What's your size of read buffer?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJf-r/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJjjb,incubator-uniffle,1411791067,503,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-01T10:03:37Z,2023-02-01T10:03:37Z,"> I found the full GC occurs when there are too many partitions on a shuffle server, and the duration could be 20s+.

> Env:

> using java8
> xmx=30g, buffer-capacity=10g, read-capacity=10g

10g","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJjjb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJwuF,incubator-uniffle,1411844997,503,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-01T10:41:40Z,2023-02-01T10:41:40Z,"> > I found the full GC occurs when there are too many partitions on a shuffle server, and the duration could be 20s+.
> 
> > Env:
> 
> > using java8
> > xmx=30g, buffer-capacity=10g, read-capacity=10g
> 
> 10g

What's your client's size of read buffer?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJwuF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJ0Hu,incubator-uniffle,1411858926,503,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-01T10:52:58Z,2023-02-01T10:52:58Z,"> What's your client's size of read buffer?

14m","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJ0Hu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJ6zu,incubator-uniffle,1411886318,503,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-01T11:12:30Z,2023-02-01T11:12:30Z,"> > What's your client's size of read buffer?
> 
> 14m

OK, if we use a bigger read buffer size, it will cause more GC.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UJ6zu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOVXs,incubator-uniffle,1413043692,503,NA,xianjingfeng,11752250,,,NA,2023-02-02T02:02:40Z,2023-02-02T02:02:40Z,"> > > @leixm @xianjingfeng Do you encounter similar problems?
> > 
> > 
> > I haven't found this situation yet. xmx=80g, buffer-capacity=40g, read-capacity=20g
> 
> I don't enable the single buffer flush. And I found this occurrence of full GC is always along with the huge partition appearance although I have switched GC to CMS.
> 
> So I guess the big memory shuffleBlock reference of huge partition is released but gc throughout is slower than receiving data speed and then gc happened.
> 
> Based on this guess, I will enable the single buffer flush to avoid this problem. Could you help give some advice? @advancedxy @xianjingfeng @jerqi

The size of RPC queue is unlimited, is it possible relate to this?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOVXs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOYQu,incubator-uniffle,1413055534,503,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-02T02:17:45Z,2023-02-02T02:17:45Z,"> The size of RPC queue is unlimited, is it possible relate to this?

Maybe. But from the metric dashboard, the GC is always along with the huge partition appearance. I will share some metrics of one shuffle-server.

__CMS single GC cost 20s__
![image](https://user-images.githubusercontent.com/8609142/216214614-7080b6ea-3c81-438f-8924-ce3959d5728b.png)

![image](https://user-images.githubusercontent.com/8609142/216214694-77cba0df-aebf-4bcb-b868-0d6680e27dcf.png)
![image](https://user-images.githubusercontent.com/8609142/216214700-4aeb9c7b-6a5d-4d99-96ec-dc56684b5fe8.png)
![image](https://user-images.githubusercontent.com/8609142/216214707-038bfd6e-b808-4dcf-a30a-09fe29fc2c75.png)


From this metric, I think the single buffer flush may solve this problem.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UOYQu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/503,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UQiG-,incubator-uniffle,1413620158,503,NA,advancedxy,807537,,,NA,2023-02-02T11:55:57Z,2023-02-02T11:55:57Z,"> > The size of RPC queue is unlimited, is it possible relate to this?
> 
> Maybe. But from the metric dashboard, the GC is always along with the huge partition appearance. I will share some metrics of one shuffle-server.
> 
> **CMS single GC cost 20s** ![image](https://user-images.githubusercontent.com/8609142/216214614-7080b6ea-3c81-438f-8924-ce3959d5728b.png)
> 
> ![image](https://user-images.githubusercontent.com/8609142/216214694-77cba0df-aebf-4bcb-b868-0d6680e27dcf.png) ![image](https://user-images.githubusercontent.com/8609142/216214700-4aeb9c7b-6a5d-4d99-96ec-dc56684b5fe8.png) ![image](https://user-images.githubusercontent.com/8609142/216214707-038bfd6e-b808-4dcf-a30a-09fe29fc2c75.png)
> 
> From this metric, I think the single buffer flush may solve this problem.

<img width=""917"" alt=""image"" src=""https://user-images.githubusercontent.com/807537/216317369-a41ea271-2861-4899-9b15-0c670dcd04a8.png"">
Seems like the pre-allocation is also failed when the huge partition is arriving.  I think this should match your speculation, shuffle server just cannot gc data quicker than the shuffle server. 

> I will enable the single buffer flush to avoid this problem

Single buffer flush should have some effect.
 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UQiG-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/507,https://api.github.com/repos/apache/incubator-uniffle/issues/507,incubator-uniffle,1550486441,507,Flaky Test: ShuffleBufferManagerTest#cacheShuffleDataTest,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-01-20T08:37:08Z,2023-01-29T09:49:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 10, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 5.848 s <<< FAILURE! - in org.apache.uniffle.server.buffer.ShuffleBufferManagerTest
Error:  cacheShuffleDataTest  Time elapsed: 1.694 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <0> but was: <-3>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:527)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.cacheShuffleDataTest(ShuffleBufferManagerTest.java:307)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/3965932842/jobs/6796171397

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/507/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/509,https://api.github.com/repos/apache/incubator-uniffle/issues/509,incubator-uniffle,1556511175,509,Flaky Test: ShuffleBufferManagerTest#shuffleFlushThreshold,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-01-25T11:47:36Z,2023-01-29T11:01:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 10, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 5.198 s <<< FAILURE! - in org.apache.uniffle.server.buffer.ShuffleBufferManagerTest
Error:  shuffleFlushThreshold  Time elapsed: 1.035 s  <<< FAILURE!
Error:  Failures: 
Error:    ShuffleBufferManagerTest.shuffleFlushThreshold:603 expected: <159> but was: <105>
Error:  Tests run: 70, Failures: 1, Errors: 0, Skipped: 0
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4005292106/jobs/6875476922

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/509/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/512,https://api.github.com/repos/apache/incubator-uniffle/issues/512,incubator-uniffle,1560772123,512,[Bug] Golang CI failed,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-01-28T09:01:53Z,2023-01-29T03:58:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```
# golang.org/x/sys/unix
Error: /home/runner/go/pkg/mod/golang.org/x/sys@v0.4.0/unix/syscall.go:83:16: undefined: unsafe.Slice
Error: /home/runner/go/pkg/mod/golang.org/x/sys@v0.4.0/unix/syscall_linux.go:2270:9: undefined: unsafe.Slice
Error: /home/runner/go/pkg/mod/golang.org/x/sys@v0.4.0/unix/syscall_unix.go:118:7: undefined: unsafe.Slice
Error: /home/runner/go/pkg/mod/golang.org/x/sys@v0.4.0/unix/sysvshm_unix.go:33:7: undefined: unsafe.Slice

```
Detailed info could be found in https://github.com/apache/incubator-uniffle/actions/runs/4031027397/jobs/6930075459

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/512/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/512,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T4mNp,incubator-uniffle,1407345513,512,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-28T09:02:35Z,2023-01-28T09:02:35Z,@advancedxy @wangao1236 could you help check this? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T4mNp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/512,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T4tt6,incubator-uniffle,1407376250,512,NA,advancedxy,807537,,,NA,2023-01-28T11:13:06Z,2023-01-28T11:13:06Z,"Did this happen without any related change? And is it consistent?

Seems like my pr for better build system has not been merged yet.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T4tt6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/512,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T47Kt,incubator-uniffle,1407431341,512,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-28T16:17:55Z,2023-01-28T16:17:55Z,"It says ""note: module requires Go 1.17"" here:
https://github.com/apache/incubator-uniffle/actions/runs/4031027397/jobs/6930075459#step:6:3421

It's probably caused by transitive dependency of this package:
https://pkg.go.dev/golang.org/x/sys@v0.4.0/unix","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T47Kt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/512,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T47Yt,incubator-uniffle,1407432237,512,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-01-28T16:22:47Z,2023-01-28T16:22:47Z,"The easiest fix is to bump golang to 1.17 and update the go.mod.
@jerqi Is it OK to bump the golang version?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T47Yt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/512,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5WPG,incubator-uniffle,1407542214,512,NA,advancedxy,807537,,,NA,2023-01-29T02:34:00Z,2023-01-29T02:34:00Z,"> It says ""note: module requires Go 1.17"" here: https://github.com/apache/incubator-uniffle/actions/runs/4031027397/jobs/6930075459#step:6:3421
> 
> It's probably caused by transitive dependency of this package: https://pkg.go.dev/golang.org/x/sys@v0.4.0/unix

Yeah, It's mostly caused by upstream changes. This is more than just bump go versions. Let me address this in #479. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T5WPG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/514,https://api.github.com/repos/apache/incubator-uniffle/issues/514,incubator-uniffle,1561092710,514,Flaky Test: ShuffleServerGrpcTest#clearResourceTest,xianjingfeng,11752250,,,CLOSED,2023-01-29T02:22:25Z,2023-01-29T06:39:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
org.opentest4j.AssertionFailedError: expected: <0> but was: <1>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:527)
	at org.apache.uniffle.test.ShuffleServerGrpcTest.clearResourceTest(ShuffleServerGrpcTest.java:162)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4034605585/jobs/6935945287

### Parent issue

#1733

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/514/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/519,https://api.github.com/repos/apache/incubator-uniffle/issues/519,incubator-uniffle,1561886463,519,[Improvement] Speed up ConcurrentHashMap#computeIfAbsent,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-01-30T07:20:41Z,2023-03-27T13:30:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

According to the bug mentioned in https://bugs.openjdk.org/browse/JDK-8161372, we could check the key existence before invoking `computeIfAbsent`, especially for the critical path like `ShuffleTaskManager#refreshAppId`.

The detailed fix could refer to https://juejin.cn/post/7094561581631012878

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/519/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/519,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T7gwB,incubator-uniffle,1408109569,519,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-30T07:20:57Z,2023-01-30T07:20:57Z,cc @kaijchen @advancedxy @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T7gwB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/519,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T7qGr,incubator-uniffle,1408147883,519,NA,advancedxy,807537,,,NA,2023-01-30T08:04:18Z,2023-01-30T08:04:18Z,"Ouch, does `putIfAbsent` has similar issue under JDK 8?

If `putIfAbsent` doesn't have this problem, I believe we should prefer `putIfAbsent` for simple cases to improve readability. 

Otherwise, I'm opt for this solution.

BTW, https://cwiki.apache.org/confluence/display/HADOOP/Hadoop+Java+Versions JDK 1.8 seems to be lasting for a long time since only hadoop 3.3 supports JDK11 in runtime.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T7qGr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/519,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UDPQv,incubator-uniffle,1410135087,519,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-01-31T10:46:05Z,2023-01-31T10:46:05Z,"> Ouch, does putIfAbsent has similar issue under JDK 8?

From its implementation, it also has similar problems. 

> BTW, https://cwiki.apache.org/confluence/display/HADOOP/Hadoop+Java+Versions JDK 1.8 seems to be lasting for a long time since only hadoop 3.3 supports JDK11 in runtime.

Yes. 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UDPQv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/522,https://api.github.com/repos/apache/incubator-uniffle/issues/522,incubator-uniffle,1561962517,522,[Subtask] pass RSS_IP env to coordinator container,advancedxy,807537,,,CLOSED,2023-01-30T08:23:37Z,2023-01-31T07:10:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Pass the podIP of coordinator as RSS_IP to coordinator's container env.

This is how shuffle server detects its RSS_IP.

### Parent issue

#462 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/522/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/524,https://api.github.com/repos/apache/incubator-uniffle/issues/524,incubator-uniffle,1561994647,524,[Improvement] [operator] rss operator could delete upgrading RSS cluster,advancedxy,807537,,,CLOSED,2023-01-30T08:50:06Z,2023-02-02T03:33:37Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?
Currently, RSS operator only delete RSS cluster when it's under running or pending state, see
https://github.com/apache/incubator-uniffle/blob/e6b4260aa54a9ffda30ec02fa050be1c108e8a9f/deploy/kubernetes/operator/pkg/controller/controller/rss.go#L357-L360

It's too restrictive, RSS operator could delete the upgrading RSS cluster.

This is a subtask of #462 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/524/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/525,https://api.github.com/repos/apache/incubator-uniffle/issues/525,incubator-uniffle,1562339510,525,[Subtask][operator] svc generation refinement,advancedxy,807537,,,CLOSED,2023-01-30T12:19:53Z,2023-02-06T07:08:37Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

We should reconsider the service generated by RSS operator as it may not make too much sense.
Current behavior for RSS to generate svcs:
1. generate NodePort service for coordinator, which is mandatory
   * the svc is passed to shuffle server as coordinator address
   * it requires RSS configuration must defines RPCNodePort and HTTPNodePort, which is restrictive and cost node ports
2. NodePort svc is generated for shuffle server if node port is supplied
3. headless svc is generated for shuffle server.

There are some ways to improves this situation:
1. since coordinator and shuffle server are both in the k8s cluster, there's no need to use ClusterIP/NodePort for shuffle server to connect with coordinator. Therefore headless svcs should be created for coordinators, and passed to shuffle server
2. it's pointless to generate svc for shuffle server as it should be accessed directly per node.
3. for inter-cluster only workload, there's no need for coordinator to expose NodePort. Therefore NodePort configuration in RSS should be optional rather mandatory.
4. to expose RSS cluster deployed on K8S to external compute resource, such as a yarn cluster, then coordinator and shuffle server should both be deployed with hostnetwork. The service part is preferred with LoadBalance.

### Parent issue

#462 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/525/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/525,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T9FLR,incubator-uniffle,1408520913,525,NA,advancedxy,807537,,,NA,2023-01-30T12:20:06Z,2023-01-30T12:20:06Z,cc @wangao1236 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5T9FLR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/526,https://api.github.com/repos/apache/incubator-uniffle/issues/526,incubator-uniffle,1562387807,526,Flaky Test: LowestIOSampleCostSelectStorageStrategyTest#selectStorageTest,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-01-30T12:48:17Z,2023-02-03T07:11:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 19.844 s <<< FAILURE! - in org.apache.uniffle.coordinator.strategy.storage.LowestIOSampleCostSelectStorageStrategyTest
Error:  selectStorageTest  Time elapsed: 7.611 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <hdfs://p2> but was: <hdfs://p1>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:182)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:177)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:1141)
	at org.apache.uniffle.coordinator.strategy.storage.LowestIOSampleCostSelectStorageStrategyTest.selectStorageTest(LowestIOSampleCostSelectStorageStrategyTest.java:138)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4043459641/jobs/6952402959#step:6:2486

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/526/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/526,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UBju1,incubator-uniffle,1409694645,526,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-01-31T03:25:44Z,2023-01-31T03:25:44Z,cc. @smallzhongfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UBju1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/526,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UP9rA,incubator-uniffle,1413470912,526,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-02-02T10:07:42Z,2023-02-02T10:07:42Z,Thanks ping me. I will fix this.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UP9rA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/529,https://api.github.com/repos/apache/incubator-uniffle/issues/529,incubator-uniffle,1563964461,529,[Bug] [operator] dependent object could not be gced when rss object is deleted,advancedxy,807537,,,CLOSED,2023-01-31T09:36:14Z,2023-02-02T11:36:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When the rss object is deleted via kubectl 
```
kubectl  -n xxx_ns delete rss ${rss_cluster_name}
```
The corresponding resources created by this CRD should also be gced/deleted. However, in the current codebase, only the
RSS Shuffle Server is removed. Other objects such as coordinator, configmap, svc are kept in K8S.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/529/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/529,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UC4oV,incubator-uniffle,1410042389,529,NA,advancedxy,807537,,,NA,2023-01-31T09:36:58Z,2023-01-31T09:36:58Z,ping @wangao1236. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UC4oV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/532,https://api.github.com/repos/apache/incubator-uniffle/issues/532,incubator-uniffle,1564171438,532,[Umbrella] Use SpotBugs to improve code quality,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-01-31T11:58:11Z,2024-01-12T02:28:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

SpotBugs is a program which uses static analysis to look for bugs in Java code.

SpotBugs checks for more than 400 bug patterns. Bug descriptions can be found [here](https://spotbugs.readthedocs.io/en/latest/bugDescriptions.html)


For example: https://github.com/apache/incubator-uniffle/pull/527

### Task list

* [x] DM_NUMBER_CTOR
* [ ] EI_EXPOSE_REP
* [ ] EI_EXPOSE_REP2
* [ ] EI_EXPOSE_STATIC_REP2
* [ ] IS2_INCONSISTENT_SYNC
* [ ] MS_EXPOSE_REP
* [ ] MS_PKGPROTECT
* [ ] MS_CANNOT_BE_FINAL
* [x] REC_CATCH_EXCEPTION
* [x] RV_RETURN_VALUE_IGNORED_BAD_PRACTICE
* [x] SC_START_IN_CTOR
* [ ] SE_BAD_FIELD
* [ ] SWL_SLEEP_WITH_LOCK_HELD
* [ ] THROWS_METHOD_THROWS_RUNTIMEEXCEPTION
* [ ] THROWS_METHOD_THROWS_CLAUSE_BASIC_EXCEPTION
* [ ] THROWS_METHOD_THROWS_CLAUSE_THROWABLE
* [x] URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD
* [x] UWF_UNWRITTEN_PUBLIC_OR_PROTECTED_FIELD

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/532/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/533,https://api.github.com/repos/apache/incubator-uniffle/issues/533,incubator-uniffle,1565306076,533,[Improvement] Avoid remove buffer multiple times when clear resource for expired application,xianjingfeng,11752250,,,CLOSED,2023-02-01T02:16:42Z,2023-02-02T06:10:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When some appIds remove resources take too much time, `ShuffleBufferManager#removeBufferByShuffleId` will be invoked multiple times for one appId. This will cause memory to be released multiple times. This issue is similar to #459

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/533/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/542,https://api.github.com/repos/apache/incubator-uniffle/issues/542,incubator-uniffle,1567778029,542,[Improvement] Ensure that the elements of `StatusCode` and `RssProtos.StatusCode` are the same ,xianjingfeng,11752250,,,CLOSED,2023-02-02T10:33:57Z,2023-02-02T12:44:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Ensure that the elements of `StatusCode` and `RssProtos.StatusCode` are the same 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/542/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/545,https://api.github.com/repos/apache/incubator-uniffle/issues/545,incubator-uniffle,1569170489,545,[Subtask] [operator] expose more fields for RSS,advancedxy,807537,,,CLOSED,2023-02-03T03:58:21Z,2023-02-06T07:32:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

> expose more fields in operator's CRD, such as RuntimeClassName, Tolerations, Annotation and Affinity, etc. Therefore the shuffle server cloud be deployed more flexible

Quoted from parent issue.

### Parent issue

#462

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/545/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/545,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UVOfR,incubator-uniffle,1414850513,545,NA,advancedxy,807537,,,NA,2023-02-03T03:59:32Z,2023-02-03T03:59:32Z,"@wangao1236 ao, would I assign this issue to you?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UVOfR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/545,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UVO4c,incubator-uniffle,1414852124,545,NA,wangao1236,12544973,jasonawang,908622977@qq.com,NA,2023-02-03T04:00:35Z,2023-02-03T04:00:35Z,"Ok, I'll do it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UVO4c/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/545,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UjqaQ,incubator-uniffle,1418634896,545,NA,advancedxy,807537,,,NA,2023-02-06T07:32:41Z,2023-02-06T07:32:41Z,Closed via #548 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UjqaQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/546,https://api.github.com/repos/apache/incubator-uniffle/issues/546,incubator-uniffle,1569277096,546,[Improvement]  Replace `ResponseStatusCode` to  `StatusCode`.,xianjingfeng,11752250,,,CLOSED,2023-02-03T06:07:59Z,2023-02-03T12:14:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The elements of `ResponseStatusCode` and `StatusCode` are same. We can replace`ResponseStatusCode` to  `StatusCode`.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/546/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/550,https://api.github.com/repos/apache/incubator-uniffle/issues/550,incubator-uniffle,1569570277,550,Flaky Test: GetReaderTest#test,kaijchen,5821159,Kaijie Chen,ckj@apache.org,OPEN,2023-02-03T09:57:30Z,2023-02-03T09:57:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 4.855 s <<< FAILURE! - in org.apache.uniffle.test.GetReaderTest
Error:  test  Time elapsed: 3.845 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <2> but was: <0>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:527)
	at org.apache.uniffle.test.GetReaderTest.test(GetReaderTest.java:150)

```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4082833774/jobs/7037648782#step:6:4432

### Parent issue

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/550/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/551,incubator-uniffle,1571796913,551,[Improvement][Style] add autolink to issues in PR title and commit msg,advancedxy,807537,,,CLOSED,2023-02-06T02:37:33Z,2023-02-16T12:58:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

It's common and considered best practice to be able to click links to corresponding issues/PRs/tickets in the commit msg. To achieve this features, Github's autolinked references and links[^1] are used. 

For example, Spark uses this feature to autolink Jiras. 
<img width=""1251"" alt=""image"" src=""https://user-images.githubusercontent.com/807537/216869357-205d4cfb-7a37-47a4-beba-fef632399e57.png"">

Since Uniffle are using Github Issues to track issues/request/improvements, etc. The issue is effective the same as the Jira ticket.

I'd like to propose an suggestion to improve the code context experience: add autolink to issues in PR title and commit msg.

[^1]: https://docs.github.com/en/get-started/writing-on-github/working-with-advanced-formatting/autolinked-references-and-urls

### How should we improve?

1. Let's decide which form to include autolinks:
   - [#xxx], the simple form, https://github.com/apache/incubator-uniffle/commit/cf9afab471a9595d8298ebd65c4d25c080ad4bbf
     <img width=""956"" alt=""image"" src=""https://user-images.githubusercontent.com/807537/216869878-3023c60d-b64c-46eb-a631-47c8dd6eb915.png""> 
   - [ISSUE #xxx] prefixed with the `ISSUE`
2. Enforce the pr title check.  Every PR should have an issue linked. 
    There's an exception rule for this: PR title prefixed with [Minor]/[MINOR] can be excused for this enforcement check.




### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/551/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui1k7,incubator-uniffle,1418418491,551,NA,advancedxy,807537,,,NA,2023-02-06T02:38:00Z,2023-02-06T02:38:00Z,@kaijchen @zuston @jerqi @felixcheung WDYT?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui1k7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui245,incubator-uniffle,1418423865,551,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-06T02:45:28Z,2023-02-06T02:45:28Z,Can we use the apache style like `[UNIFFLE-120][Test] Fix msg` ? And the `uniffle-120 `could be linked to github issue by https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/managing-repository-settings/configuring-autolinks-to-reference-external-resources,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui245/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui4Cs,incubator-uniffle,1418428588,551,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-06T02:53:57Z,2023-02-06T02:53:57Z,"`UNIFFLE-120` may be confusing, because it's usually a Jira id.
Currently I would not recommend Jira because the self registration is limited. We wish to make new contributors easier to join the project.
For how to configure the autolink, see https://cwiki.apache.org/confluence/display/INFRA/Git+-+.asf.yaml+features","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui4Cs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui4cP,incubator-uniffle,1418430223,551,NA,advancedxy,807537,,,NA,2023-02-06T02:56:31Z,2023-02-06T02:56:31Z,"> Can we use the apache style like `[UNIFFLE-120][Test] Fix msg` ? And the `uniffle-120 `could be linked to github issue by https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/managing-repository-settings/configuring-autolinks-to-reference-external-resources

No. The asf doesn't expose the configurations to external resource except JIRA which is already been closed for public registration.

I'd like to use `[ISSUE-#xxx]`, but it seems Github doesn't recognize that. You have to use `[ISSUE #XXX]` or `[Uniffle #xxx]` or just `[#xxx]`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui4cP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui6pJ,incubator-uniffle,1418439241,551,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-06T03:08:52Z,2023-02-06T03:08:52Z,"I would suggest omit issue id in the title, and just add it in the PR description.

```
### Why this change needed?

Fix #123
```

The PR title could be `[module][type] description`.

Modules:
Info of who (module owner) should review this pr.

* `coordinator`
* `server`
* `client`
* `operator`
* `*`: all
* etc

Types:
Implies the urgency, the review time required, and whether should be backported to release branches.

* `feature`: (new feature for the user, not a new feature for build script)
* `fix`: (bug fix for the user, not a fix to a build script)
* `docs`: (changes to the documentation)
* `style`: (formatting, missing semi colons, etc; no production code change)
* `refactor`: (refactoring production code, eg. renaming a variable)
* `test`: (adding missing tests, refactoring tests; no production code change)
* `chore`: (updating grunt tasks etc; no production code change)","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ui6pJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UjBKY,incubator-uniffle,1418465944,551,NA,advancedxy,807537,,,NA,2023-02-06T03:45:20Z,2023-02-06T03:45:20Z,"> I would suggest omit issue id in the title, and just add it in the PR description.
> 
> ```
> ### Why this change needed?
> 
> Fix #123
> ```
> 

The point to add issue id in the title is that we can links to issues and commits in Github's ecosystem. In most cases, only title is displayed for commits. 

Another benefit to include issue id in PR title(included in commit title automatically) is the commit is also linked to the issue.
See https://github.com/apache/incubator-uniffle/issues/545 for example

<img width=""993"" alt=""image"" src=""https://user-images.githubusercontent.com/807537/216879283-c4bdb453-46dd-422f-a5a3-75c95431671f.png"">


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UjBKY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UjCZ8,incubator-uniffle,1418471036,551,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-06T03:53:29Z,2023-02-06T03:53:29Z,"> The point to add issue id in the title is that we can links to issues and commits in Github's ecosystem. In most cases, only title is displayed for commits.

My point is, by just looking at the issue id, you don't get any information. 
When looking at commit history, you got interested by the scope and type of the change first.
Then you start to looking for why it's needed, and find the related issue.

Just click the 3 dots, you could see it the description.

<img width=""642"" alt=""image"" src=""https://user-images.githubusercontent.com/5821159/216879627-99b96924-c86e-4d3f-83ec-0a6f880d1836.png"">
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UjCZ8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UjD0e,incubator-uniffle,1418476830,551,NA,advancedxy,807537,,,NA,2023-02-06T04:04:23Z,2023-02-06T04:04:23Z,"> > The point to add issue id in the title is that we can links to issues and commits in Github's ecosystem. In most cases, only title is displayed for commits.
> 
> My point is, by just looking at the issue id, you don't get any information. 

No, the auto-linked issues is clickable. You can jump to the issue page by simply looking at the title just as you can jump to the pr page.
<img width=""1331"" alt=""image"" src=""https://user-images.githubusercontent.com/807537/216881209-5f0784d5-e1a9-4ec6-91de-2da3bcdd4e93.png"">



","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UjD0e/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UwvJ5,incubator-uniffle,1422062201,551,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-08T06:05:53Z,2023-02-08T06:05:53Z,It's ok for me.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UwvJ5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UxpzW,incubator-uniffle,1422302422,551,NA,advancedxy,807537,,,NA,2023-02-08T09:36:12Z,2023-02-08T09:36:12Z,"<img width=""1206"" alt=""image"" src=""https://user-images.githubusercontent.com/807537/217491266-e19f71f6-e9e2-4798-8183-de8a907a6501.png"">

@kaijchen @zuston does this demonstrate the benefits of autolinks? 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UxpzW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UxqDj,incubator-uniffle,1422303459,551,NA,advancedxy,807537,,,NA,2023-02-08T09:37:03Z,2023-02-08T09:37:03Z,"> kaijchen zuston jerqi felixcheung WDYT?

also cc @xianjingfeng which was pointed to a wrong one.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UxqDj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Uxrdg,incubator-uniffle,1422309216,551,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-08T09:41:30Z,2023-02-08T09:41:30Z,"It's OK for me, thanks for your effort. @advancedxy ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Uxrdg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ux-80,incubator-uniffle,1422389044,551,NA,xianjingfeng,11752250,,,NA,2023-02-08T10:41:43Z,2023-02-08T10:41:43Z,"> > kaijchen zuston jerqi felixcheung WDYT?
> 
> also cc @xianjingfeng which was pointed to a wrong one.

It's OK for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ux-80/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UyHXa,incubator-uniffle,1422423514,551,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-08T11:09:35Z,2023-02-08T11:09:35Z,"Seems the following format is preferred now?

```
[#123] feat: add xxx feature
[#124] fix: exception in xxx 
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UyHXa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UyOkH,incubator-uniffle,1422452999,551,NA,advancedxy,807537,,,NA,2023-02-08T11:34:48Z,2023-02-08T11:34:48Z,"> Seems the following format is preferred now?
> 
> ```
> [#123] feat: add xxx feature
> [#124] fix: exception in xxx 
> ```

It's preferred to use conventional commits. But I don't think all the committers are ready for this. Let's keep it as a personal preference for a while? If everyone agrees with conventional commits, we can also enforces this.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UyOkH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UyO8D,incubator-uniffle,1422454531,551,NA,advancedxy,807537,,,NA,2023-02-08T11:36:00Z,2023-02-08T11:36:00Z,"Also FYI, I add an exception rule:
<img width=""816"" alt=""image"" src=""https://user-images.githubusercontent.com/807537/217518921-ebea8591-8fec-4fda-816b-4a83d6e991f2.png"">
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UyO8D/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UyTh5,incubator-uniffle,1422473337,551,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-08T11:52:13Z,2023-02-08T11:52:13Z,"How about combine issue ID and [semantic commit message][1] ?

```
[<issue>] <type>(<scope>): <subject>
```

For example:
```
[#123] feat(operator): support xxx
[MINOR] refactor: fix typo in variable name
[#233] fix: check null before xxx
[MINOR] chore(deps): bump grpc to xxx
```

[1]: https://gist.github.com/joshbuchea/6f47e86d2510bce28f8e7f42ae84c716","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5UyTh5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/551,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9Bjq,incubator-uniffle,1425283306,551,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-10T07:04:05Z,2023-02-10T07:04:05Z,"Hi everyone, I've edited existing open PR titles (to show examples to new PR). How do you think?

<img width=""732"" alt=""screenshot"" src=""https://user-images.githubusercontent.com/5821159/218024535-ac1a4c96-57a5-42cd-bd21-30148df4e5a5.png"">
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9Bjq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/552,https://api.github.com/repos/apache/incubator-uniffle/issues/552,incubator-uniffle,1572014001,552,[DOCS] RSSShuffleManager requires objection relocation serializer,advancedxy,807537,,,CLOSED,2023-02-06T06:48:47Z,2023-02-08T05:08:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

RSSShuffleManager requires serializer to support relocation of serialized objects which doesn't include JavaSerializer.

However Spark uses `JavaSerializer` by default, we should document this limitation.

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

Some warning message should also be updated.

This is related to https://github.com/apache/incubator-uniffle/pull/344

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/552/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/553,https://api.github.com/repos/apache/incubator-uniffle/issues/553,incubator-uniffle,1572035157,553,[Improvement] Close coordinator client when DelegationRSSShuffleManager fallback to SortShuffleManager,advancedxy,807537,,,OPEN,2023-02-06T07:06:26Z,2023-02-06T07:06:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When `DelegationRSSShuffleManager` falls back to `SortShuffleManager`, the coordinator clients is not closed.

The clients should be closed when RSS is not used.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/553/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/554,https://api.github.com/repos/apache/incubator-uniffle/issues/554,incubator-uniffle,1572395338,554,[FEATURE] rss storage base path could be inferred from env,advancedxy,807537,,,CLOSED,2023-02-06T11:25:32Z,2023-02-08T08:02:22Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, shuffle server's storage base path is controlled and fixed by the config option `RSS_STORAGE_BASE_PATH`.

However, when RSS is deployed on K8S, or on yarn as an app or with mixed types of shuffle servers, the base storage path could not be determined pre-start. We should support retrieve base paths from env.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/554/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/559,https://api.github.com/repos/apache/incubator-uniffle/issues/559,incubator-uniffle,1574385278,559,[Improvement] refactor RssUtilsTest.setEnv by leverage EnvironmentVariables system stub,advancedxy,807537,,,CLOSED,2023-02-07T13:58:03Z,2023-02-08T05:36:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently `setEnv` is defined as below
```
  @SuppressWarnings(""unchecked"")
  public static void setEnv(String key, String value) {
    try {
      Map<String, String> env = System.getenv();
      Class<?> cl = env.getClass();
      Field field = cl.getDeclaredField(""m"");
      field.setAccessible(true);
      Map<String, String> writableEnv = (Map<String, String>) field.get(env);
      if (value != null) {
        writableEnv.put(key, value);
      } else {
        writableEnv.remove(key);
      }
    } catch (Exception e) {
      throw new IllegalStateException(""Failed to set environment variable"", e);
    }
  }
```

which is not idiomatic Java. We should use https://www.baeldung.com/java-system-stubs#3-junit-5-environment-variables instead.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/559/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/562,https://api.github.com/repos/apache/incubator-uniffle/issues/562,incubator-uniffle,1575660394,562,[Improvement] Sleep with lock held in ShuffleTaskManager,kaijchen,5821159,Kaijie Chen,ckj@apache.org,OPEN,2023-02-08T08:02:03Z,2023-02-08T08:02:03Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Sleep at line 257 with lock held:

https://github.com/apache/incubator-uniffle/blob/24ea73cf8b4d9a9a270bd2ca798b571a2b8b4917/server/src/main/java/org/apache/uniffle/server/ShuffleTaskManager.java#L235-L269

### How should we improve?

Can we avoid polling here?
For example: use `lock.await()`.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/562/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/564,https://api.github.com/repos/apache/incubator-uniffle/issues/564,incubator-uniffle,1576141334,564,[Improvement] Integration test for operator,advancedxy,807537,,,CLOSED,2023-02-08T13:38:12Z,2023-03-14T02:09:17Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We should run integration test for operator on CI/github actions

### How should we improve?

add integration tests by leverage KIND or minukube.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/564/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/564,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Uy2AQ,incubator-uniffle,1422614544,564,NA,advancedxy,807537,,,NA,2023-02-08T13:38:34Z,2023-02-08T13:38:34Z,"@wangao1236 ao, could I assign this issue to you?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Uy2AQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/564,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U8rzU,incubator-uniffle,1425194196,564,NA,wangao1236,12544973,jasonawang,908622977@qq.com,NA,2023-02-10T05:28:57Z,2023-02-10T05:28:57Z,"Okay, I'll take care of that.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U8rzU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/567,https://api.github.com/repos/apache/incubator-uniffle/issues/567,incubator-uniffle,1577319564,567,[FEATURE] Add the shuffle server metric about used memory when reading,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-02-09T06:27:14Z,2023-02-09T09:26:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

[FEATURE] Add the shuffle server metric about used memory when reading

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/567/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/569,https://api.github.com/repos/apache/incubator-uniffle/issues/569,incubator-uniffle,1577356664,569,[Improvement] better operation support for RSS operator,advancedxy,807537,,,OPEN,2023-02-09T07:05:09Z,2023-02-09T07:05:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

1. add cli support to update/upgrading/rolling upgrade rss clusters.
2. [maybe] helm charts support for rss operator and the rss cluster

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/569/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/569,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U3GOs,incubator-uniffle,1423729580,569,NA,advancedxy,807537,,,NA,2023-02-09T07:05:18Z,2023-02-09T07:05:18Z,cc @wangao1236 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U3GOs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/571,https://api.github.com/repos/apache/incubator-uniffle/issues/571,incubator-uniffle,1577390114,571,[Improvement] Don't delete base storage path if it's already an empty dir,advancedxy,807537,,,CLOSED,2023-02-09T07:34:45Z,2023-02-09T08:57:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Skip delete base storage if it's already an empty dir.

### How should we improve?

When deploying on containerized environment, such as K8S. base path maybe mounted by the platform, and it cannot be removed.

When the base directory is already an empty dir, we don't have to rm the directory and recreated again.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/571/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/575,https://api.github.com/repos/apache/incubator-uniffle/issues/575,incubator-uniffle,1578079163,575,[Improvement] Refactor ComposedClientReadHandler,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-02-09T15:12:22Z,2023-02-10T03:47:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In ComposedClientReadHandler, storage tiers are represented in int values, and it uses a lot of switch-case to get the corresponding handler.

This is error prone and difficult to understand.

### How should we improve?

Represent storage tier as enum, and get handlers by EnumMap.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/575/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/576,https://api.github.com/repos/apache/incubator-uniffle/issues/576,incubator-uniffle,1578180059,576,Flaky Test: AppBalanceSelectStorageStrategyTest#storageCounterMulThreadTest,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-02-09T16:07:10Z,2023-02-23T01:53:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 2, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 31.991 s <<< FAILURE! - in org.apache.uniffle.coordinator.strategy.storage.AppBalanceSelectStorageStrategyTest
Error:  storageCounterMulThreadTest  Time elapsed: 21.899 s  <<< ERROR!
java.util.concurrent.TimeoutException: storageCounterMulThreadTest() timed out after 20 seconds
	at org.junit.jupiter.engine.extension.TimeoutInvocation.createTimeoutException(TimeoutInvocation.java:70)
	at org.junit.jupiter.engine.extension.TimeoutInvocation.proceed(TimeoutInvocation.java:59)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
	Suppressed: java.lang.InterruptedException: sleep interrupted
		at java.lang.Thread.sleep(Native Method)
		at org.apache.uniffle.coordinator.strategy.storage.AppBalanceSelectStorageStrategyTest.storageCounterMulThreadTest(AppBalanceSelectStorageStrategyTest.java:137)
		at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
		at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
		at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
		at java.lang.reflect.Method.invoke(Method.java:498)
		at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
		at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
		at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
		at org.junit.jupiter.engine.extension.TimeoutInvocation.proceed(TimeoutInvocation.java:46)
		... 62 more
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4135550008/jobs/7148169635#step:6:2495

### Parent issue

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/576/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/576,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VzmwA,incubator-uniffle,1439591424,576,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-02-22T08:13:30Z,2023-02-22T08:13:30Z,"It only takes about 15s to run on my local network. I'm not sure how long it will take on the GA. Maybe we should set this threshold higher, WDYT? @kaijchen 

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VzmwA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/576,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vzrgq,incubator-uniffle,1439610922,576,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-22T08:25:16Z,2023-02-22T08:25:16Z,"@smallzhongfeng sure. GitHub action runners may be slower than your local machine.
It would be best if you can make the test faster to complete. But increasing timeout is also OK.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vzrgq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/580,https://api.github.com/repos/apache/incubator-uniffle/issues/580,incubator-uniffle,1579005202,580,[Umbrella] Improve CI workflows,kaijchen,5821159,Kaijie Chen,ckj@apache.org,OPEN,2023-02-10T05:23:30Z,2023-02-20T09:45:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

The current CI can be improved in many aspects.
The goal is to make CI cleaner, faster and more informative.

### Task list

- [x] cache maven repositories
- [x] create a standalone workflow for k8s operator
- [ ] standardize profile names, i.e. `-Pspark3` is actually `-Pspark3.1`
- [x] split tests into UT and IT
- [ ] reduce time cost of IT
- [ ] run IT in parallel
- [ ] do not repeat common tests (UT)
- [ ] reuse compiled artifacts
- [ ] parallel build, i.e. `mvn -T` (reverted by #631)
- [ ] parallel test, make sure no resources race in tests

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/580/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/582,https://api.github.com/repos/apache/incubator-uniffle/issues/582,incubator-uniffle,1579109131,582,[Subtask] [Netty] Implementation of basic framework.,leixm,31424839,Xianming Lei,,CLOSED,2023-02-10T07:07:07Z,2023-05-15T03:01:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Implementation of basic framework is used for netty to replace grpc, mainly including Encoder and Decoder, and we can't affect the existing grpc framework.
The document link is as follows:
https://docs.google.com/document/d/1srlBlLpJ3hbzd8ru5QaY5aCSLR9M2ttHXmlvcFC-SLg/edit?usp=sharing

### Parent issue

https://github.com/apache/incubator-uniffle/issues/133

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/582/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/582,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cNztD,incubator-uniffle,1547123523,582,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-15T03:01:42Z,2023-05-15T03:01:42Z,Closed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cNztD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/583,https://api.github.com/repos/apache/incubator-uniffle/issues/583,incubator-uniffle,1579113441,583,[Subtask] [Netty] Rewrite the serialization/deserialization protocol of each interface in ShuffleServer,leixm,31424839,Xianming Lei,,CLOSED,2023-02-10T07:09:29Z,2023-05-15T03:01:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Rewrite the grpc interface in ShuffleServer.
The document link address is as follows:
https://docs.google.com/document/d/1srlBlLpJ3hbzd8ru5QaY5aCSLR9M2ttHXmlvcFC-SLg/edit?usp=sharing

### Parent issue

https://github.com/apache/incubator-uniffle/issues/133

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/583/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/583,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cNzn9,incubator-uniffle,1547123197,583,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-15T03:01:19Z,2023-05-15T03:01:19Z,Closed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cNzn9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/584,https://api.github.com/repos/apache/incubator-uniffle/issues/584,incubator-uniffle,1579120562,584,[Subtask] [Netty] Implementation of client connection management,leixm,31424839,Xianming Lei,,CLOSED,2023-02-10T07:15:03Z,2023-04-03T03:28:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

To realize the connection management of the client, such as [https://github.com/apache/spark/blob/master/common/network-common/src/main/java/org/apache/spark/network/client/TransportClientFactory.java](url).
The document link address is as follows:
https://docs.google.com/document/d/1srlBlLpJ3hbzd8ru5QaY5aCSLR9M2ttHXmlvcFC-SLg/edit?usp=sharing

### Parent issue

https://github.com/apache/incubator-uniffle/issues/133

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/584/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/584,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYi4N,incubator-uniffle,1449274893,584,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-03-01T03:21:08Z,2023-03-01T03:21:08Z,"assgin for me,thx","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYi4N/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/584,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X1iZI,incubator-uniffle,1473652296,584,NA,leixm,31424839,Xianming Lei,,NA,2023-03-17T10:53:23Z,2023-03-17T10:53:23Z,@xumanbu  Can you submit a PR?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X1iZI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/584,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X-ONl,incubator-uniffle,1475928933,584,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-03-20T09:58:23Z,2023-03-20T09:58:23Z,"> @xumanbu Can you submit a PR?

I will submit a PR in this week.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X-ONl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/585,https://api.github.com/repos/apache/incubator-uniffle/issues/585,incubator-uniffle,1579120806,585,[Subtask] [Netty] Startup script supports setting MaxDirectMemory,leixm,31424839,Xianming Lei,,CLOSED,2023-02-10T07:15:11Z,2023-03-08T07:26:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

The startup script supports setting Xmx and MaxDirectMemory according to whether netty is enabled.
The document link address is as follows:
https://docs.google.com/document/d/1srlBlLpJ3hbzd8ru5QaY5aCSLR9M2ttHXmlvcFC-SLg/edit?usp=sharing

### Parent issue

https://github.com/apache/incubator-uniffle/issues/133

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/585/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/586,https://api.github.com/repos/apache/incubator-uniffle/issues/586,incubator-uniffle,1579122348,586,[Subtask] [Netty] Support ShuffleServer to use off-heap memory to manage shuffle data,leixm,31424839,Xianming Lei,,CLOSED,2023-02-10T07:16:03Z,2023-07-26T14:49:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

ShuffleServer supports using off-heap memory to manage shuffle data and reduce gc time.
The document link address is as follows:
https://docs.google.com/document/d/1srlBlLpJ3hbzd8ru5QaY5aCSLR9M2ttHXmlvcFC-SLg/edit?usp=sharing

### Parent issue

https://github.com/apache/incubator-uniffle/issues/133

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/586/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/586,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hCN-t,incubator-uniffle,1627971501,586,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-10T02:13:58Z,2023-07-10T02:13:58Z,@summaryzb We use ShufflePartitionedBlock#ByteBuf to implement offheap memory manager. You need ensure how to avoid allocating heap memory for ByteBuf.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hCN-t/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/586,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hDjKB,incubator-uniffle,1628320385,586,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-07-10T06:28:18Z,2023-07-10T06:28:18Z,ok，I‘m working on it,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hDjKB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/586,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iMJ2_,incubator-uniffle,1647353279,586,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-24T07:22:13Z,2023-07-24T07:22:13Z,@summaryzb Any progress?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iMJ2_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/586,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5idwW7,incubator-uniffle,1651967419,586,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-26T14:49:06Z,2023-07-26T14:49:06Z,Finished.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5idwW7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/587,https://api.github.com/repos/apache/incubator-uniffle/issues/587,incubator-uniffle,1579123761,587,[Subtask] [Netty] Coordinator supports netty,leixm,31424839,Xianming Lei,,OPEN,2023-02-10T07:17:06Z,2023-02-10T09:34:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Rewrite the grpc interface in Coordinator using a custom serialization/deserialization protocol.
The document link address is as follows:
https://docs.google.com/document/d/1srlBlLpJ3hbzd8ru5QaY5aCSLR9M2ttHXmlvcFC-SLg/edit?usp=sharing

### Parent issue

https://github.com/apache/incubator-uniffle/issues/133

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/587/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/587,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9F3k,incubator-uniffle,1425300964,587,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-10T07:20:54Z,2023-02-10T07:20:54Z,Why do we need modify the coordinator?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9F3k/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/587,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9G0p,incubator-uniffle,1425304873,587,NA,leixm,31424839,Xianming Lei,,NA,2023-02-10T07:23:48Z,2023-02-10T07:23:48Z,"The communication protocols of the coordinator and the shuffleserver are different, which looks a bit weird. Of course, this is not a high priority.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9G0p/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/587,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9g1k,incubator-uniffle,1425411428,587,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-10T08:31:21Z,2023-02-10T08:31:21Z,"> The communication protocols of the coordinator and the shuffleserver are different, which looks a bit weird. Of course, this is not a high priority.

We only need to replace data transfer api like Spark. Spark use Rpc and Netty at the same time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9g1k/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/587,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9hOP,incubator-uniffle,1425413007,587,NA,leixm,31424839,Xianming Lei,,NA,2023-02-10T08:32:52Z,2023-02-10T08:32:52Z,It's ok for me.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U9hOP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/587,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U94YW,incubator-uniffle,1425507862,587,NA,advancedxy,807537,,,NA,2023-02-10T09:34:33Z,2023-02-10T09:34:33Z,"This should be a low priority task. If we have enough time and resource, we could replace gRPC with netty.

> We only need to replace data transfer api like Spark. Spark use Rpc and Netty at the same time.

To clarify a bit: in my understanding, spark only uses netty to rpc service.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5U94YW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/589,https://api.github.com/repos/apache/incubator-uniffle/issues/589,incubator-uniffle,1579214669,589,[Bug] Incorrect report of partition size to spark driver,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-02-10T08:13:40Z,2023-02-21T03:08:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In shuffle writer side, the writer will report its partitions size to driver when invoking the `stop` method in `RssShuffleWriter`. But it looks writer will report the every partition compressed size, which will cause incorrect optimization by AQE.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/589/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/589,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLR_-,incubator-uniffle,1429020670,589,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-14T02:32:03Z,2023-02-14T02:32:03Z,PTAL @advancedxy @jerqi @xianjingfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLR_-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/589,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLT2e,incubator-uniffle,1429028254,589,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-14T02:43:36Z,2023-02-14T02:43:36Z,"I look at Spark code. Origin Spark also use compressed data length, too.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLT2e/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/589,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLV-9,incubator-uniffle,1429036989,589,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-14T02:57:52Z,2023-02-14T02:57:52Z,"> I look at Spark code. Origin Spark also use compressed data length, too.

You are right. But I think this is wrong, and spark also has similar problem.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLV-9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/589,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLWzi,incubator-uniffle,1429040354,589,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-14T03:01:36Z,2023-02-14T03:01:36Z,"> > I look at Spark code. Origin Spark also use compressed data length, too.
> 
> You are right. But I think this is wrong, and spark also has similar problem.

We should keep same behaviour with Spark. If you think it's a bug, you should modify it in the Spark first.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VLWzi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/589,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VsvT8,incubator-uniffle,1437791484,589,NA,advancedxy,807537,,,NA,2023-02-21T02:58:44Z,2023-02-21T02:58:44Z,"> But it looks writer will report the every partition compressed size, which will cause incorrect optimization by AQE.

Do you have a concrete case that AQE doesn't work as expected?  For that case, is vanilla spark worked as expected?

> You are right. But I think this is wrong, and spark also has similar problem.

I believe you could file a jira to Spark and discuss the possibility of add an additional field of uncompressed size of shuffle data with the Spark community.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VsvT8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/589,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VsxB2,incubator-uniffle,1437798518,589,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-21T03:08:02Z,2023-02-21T03:08:02Z,"> Do you have a concrete case that AQE doesn't work as expected? For that case, is vanilla spark worked as expected?

I haven't do some experiments to confirm this. Maybe dedicated test case is enough.

> I believe you could file a jira to Spark and discuss the possibility of add an additional field of uncompressed size of shuffle data with the Spark community.

Yes. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VsxB2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/590,https://api.github.com/repos/apache/incubator-uniffle/issues/590,incubator-uniffle,1579255747,590,[Subtask] [Netty] Support zero copy to read local file,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-02-10T08:37:39Z,2023-06-14T03:59:22Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

We use zero copy api to read data and send the data to network. We can refer to Spark, Kafka, etc system.
We should remove read memory.

### Parent issue

#133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/590/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/590,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VY77A,incubator-uniffle,1432600256,590,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-02-16T06:40:41Z,2023-02-16T06:40:41Z,"Could you assign this to me? I'm trying to make changes here. @jerqi 

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VY77A/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/590,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5W3ovc,incubator-uniffle,1457425372,590,NA,leixm,31424839,Xianming Lei,,NA,2023-03-07T02:52:16Z,2023-03-07T02:52:16Z,"@jerqi  @smallzhongfeng This PR will rely on Netty's Encoder support, After completing the Basic framework, I will implement the relevant Encoder, like:
https://github.com/apache/incubator-celeborn/blob/main/common/src/main/java/org/apache/celeborn/common/network/protocol/MessageEncoder.java
https://github.com/apache/incubator-celeborn/blob/main/common/src/main/java/org/apache/celeborn/common/network/protocol/MessageWithHeader.java
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5W3ovc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/590,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ahSfy,incubator-uniffle,1518675954,590,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-22T14:42:07Z,2023-04-22T14:42:07Z,@smallzhongfeng Encoder and Decoder is ready. You can continue this issue.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ahSfy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/591,https://api.github.com/repos/apache/incubator-uniffle/issues/591,incubator-uniffle,1579260336,591,[Subtask] [Netty] Benchmark for Netty data transfer,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-02-10T08:41:10Z,2023-02-10T09:48:52Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Netty data transfer need to care performance. We need to care about performance. We should set up performance tests for our project. We can refer to Spark.

### Parent issue

#133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/591/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/592,https://api.github.com/repos/apache/incubator-uniffle/issues/592,incubator-uniffle,1579264896,592,[Subtask] [Netty] Reader support off heap memory to decompress data,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-02-10T08:44:26Z,2023-05-10T14:48:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

We read the offheap data from Netty. We should use offheap memory to decompress data.

### Parent issue

#133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/592/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/592,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYizl,incubator-uniffle,1449274597,592,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-03-01T03:20:30Z,2023-03-01T03:20:30Z,"assgin for me,thx","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYizl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/592,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5b7jky,incubator-uniffle,1542338866,592,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-10T14:48:13Z,2023-05-10T14:48:13Z,Have finished.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5b7jky/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/593,https://api.github.com/repos/apache/incubator-uniffle/issues/593,incubator-uniffle,1579269583,593,[Subtask] [Netty] Writer support off heap memory to compress data,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-02-10T08:48:17Z,2023-05-10T08:44:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Writer support off heap memory to compress data. And we use the off heap memory to send data.

### Parent issue

#133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/593/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/593,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYi1g,incubator-uniffle,1449274720,593,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-03-01T03:20:46Z,2023-03-01T03:20:46Z,"assgin for me,thx","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYi1g/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/593,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5akOOn,incubator-uniffle,1519444903,593,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-24T06:10:48Z,2023-04-24T06:10:48Z,Only some parts have been finished. Reopen.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5akOOn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/596,https://api.github.com/repos/apache/incubator-uniffle/issues/596,incubator-uniffle,1582295350,596,[Subtask] [Netty] Use off heap memory to read HDFS data,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-02-13T12:51:16Z,2023-04-13T08:36:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

We need to use off heap memory to read HDFS data to reduce GC.

### Parent issue

#133

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/596/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/596,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZXT6I,incubator-uniffle,1499283080,596,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-06T15:52:10Z,2023-04-06T15:52:10Z,Method `read` can use ByteBuffer to read data. https://hadoop.apache.org/docs/current/api/org/apache/hadoop/fs/FSDataInputStream.html,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZXT6I/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/597,https://api.github.com/repos/apache/incubator-uniffle/issues/597,incubator-uniffle,1582301377,597,[Subtask] [Netty] Add UnsafeUtil class to allocate and release offheap memory,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-02-13T12:55:49Z,2023-04-08T15:02:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Add UnsafeUtil class to allocate and release offheap memory, we need make JDK 8, JDK 11, JDK 17 work well. We can refer to Spark's related implement.

### Parent issue

#133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/597/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/597,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zdg3P,incubator-uniffle,1500909007,597,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-08T15:02:42Z,2023-04-08T15:02:42Z,We can use ByteBuf to manage Unsafe memory. It has a method `release`. We don't need to consider to add an unsafeUtil.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zdg3P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/600,https://api.github.com/repos/apache/incubator-uniffle/issues/600,incubator-uniffle,1585111060,600,[Improvement] replace openjdk with alternatives as shuffle server's base image,advancedxy,807537,,,CLOSED,2023-02-15T02:33:45Z,2023-02-21T02:33:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Quote from `https://hub.docker.com/_/openjdk`
> This image is officially deprecated and all users are recommended to find and use suitable replacements ASAP. Some examples of other Official Image alternatives (listed in alphabetical order with no intentional or implied preference):
> 
> [amazoncorretto](https://hub.docker.com/_/amazoncorretto)
[eclipse-temurin](https://hub.docker.com/_/eclipse-temurin)
[ibm-semeru-runtimes](https://hub.docker.com/_/ibm-semeru-runtimes)
[ibmjava](https://hub.docker.com/_/ibmjava)
[sapmachine](https://hub.docker.com/_/sapmachine)
See [docker-library/openjdk#505](https://github.com/docker-library/openjdk/issues/505) for more information.

I believe we should replace openjdk with alternatives, `eclipse-temurin` sounds like a good fit.
Another catch about this: we should also make the base image as a docker build arg.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/600/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/604,https://api.github.com/repos/apache/incubator-uniffle/issues/604,incubator-uniffle,1585903377,604,[Umbrella] Slow integration tests,kaijchen,5821159,Kaijie Chen,ckj@apache.org,OPEN,2023-02-15T13:55:51Z,2023-02-18T06:11:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Some integration tests are taking too long to execute, maybe we can improve them by tweaking configuration, reduce the sleep time, or reduce the workload.

### Task list

- [ ] Time elapsed: 249.674 s - in org.apache.uniffle.test.LargeSorterTest
- [ ] Time elapsed: 239.197 s - in org.apache.uniffle.test.WordCountTest
- [ ] Time elapsed: 235.059 s - in org.apache.uniffle.test.SecondarySortTest
- [ ] Time elapsed: 174.062 s - in org.apache.uniffle.test.RepartitionWithMemoryRssTest
- [ ] Time elapsed: 74.901 s - in org.apache.uniffle.test.ShuffleWithRssClientTest
- [ ] Time elapsed: 66.122 s - in org.apache.uniffle.test.RepartitionWithLocalFileRssTest
- [ ] Time elapsed: 48.638 s - in org.apache.uniffle.test.QuorumTest
- [ ] Time elapsed: 38.97 s - in org.apache.uniffle.test.AQESkewedJoinTest


### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/604/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/604,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vj-4u,incubator-uniffle,1435495982,604,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-18T06:11:00Z,2023-02-18T06:11:00Z,+1. I also doubt whether the mini hdfs startup is the main factor ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vj-4u/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/610,https://api.github.com/repos/apache/incubator-uniffle/issues/610,incubator-uniffle,1587094907,610,Flaky Test: RssShuffleWriterTest#writeTest,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-02-16T06:21:05Z,2023-02-25T03:10:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 3, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 17.413 s <<< FAILURE! - in org.apache.spark.shuffle.writer.RssShuffleWriterTest
Error:  writeTest  Time elapsed: 2.387 s  <<< ERROR!
java.util.ConcurrentModificationException
	at java.util.HashMap$HashIterator.nextNode(HashMap.java:1469)
	at java.util.HashMap$KeyIterator.next(HashMap.java:1493)
	at java.util.AbstractSet.removeAll(AbstractSet.java:174)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.checkBlockSendResult(RssShuffleWriter.java:303)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.checkBlockSendResult(RssShuffleWriter.java:289)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.writeImpl(RssShuffleWriter.java:194)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)

[INFO] 
[INFO] Results:
[INFO] 
Error:  Errors: 
Error:    RssShuffleWriterTest.writeTest » ConcurrentModification
[INFO] 
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4191190002/jobs/7265371289

### Parent issue

#1733

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/610/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/610,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VY8kg,incubator-uniffle,1432602912,610,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-16T06:44:36Z,2023-02-16T06:44:36Z,Tip: We have enabled `mvn -T1C` in CI. Maybe it's due to some shared static objects.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VY8kg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/610,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VZv2d,incubator-uniffle,1432812957,610,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-16T09:53:09Z,2023-02-16T09:53:09Z,Yes. Maybe it uses the same sparkContext,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VZv2d/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/610,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VZw1u,incubator-uniffle,1432817006,610,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-16T09:56:20Z,2023-02-16T09:56:20Z,"If it is hard to fix and fails often, we can revert the `-T1C` option.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VZw1u/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/610,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VZzDF,incubator-uniffle,1432826053,610,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-16T10:02:18Z,2023-02-16T10:02:18Z,OK,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VZzDF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/610,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WIIDu,incubator-uniffle,1444970734,610,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-25T03:10:09Z,2023-02-25T03:10:09Z,"> If it is hard to fix and fails often, we can revert the `-T1C` option.

This has been reverted, let's close this. cc @kaijchen ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WIIDu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/611,incubator-uniffle,1587121237,611,[Umbrella] Release 0.7.0,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-02-16T06:48:00Z,2023-04-11T02:27:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Release Apache Uniffle 0.7.0

### Task list

- [x] Bump `master` to `0.8.0-SNAPSHOT`.
- [x] Checkout `branch-0.7`.
- [x] Tag and release `0.7.0-rc1`.
    - [x] Backport necessary fixes from `master` to `branch-0.7`.
    - [x] Bump project version to `0.7.0` in `branch-0.7`.
    - [x] (GitHub) Tag `0.7.0-rc1`.
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.7.0-rc1/`.
    - [x] Post release note on [Uniffle website][1].
    - [x] Vote on dev@uniffle.apache.org
    - [ ] Vote on general@incubator.apache.org
- [x] Tag and release `0.7.0-rc2` (optional).
    - [x] Cancel the `0.7.0-rc1` vote on corresponding mailing lists.
    - [x] Backport necessary fixes from `master` to `branch-0.7`.
    - [x] (GitHub) Tag `0.7.0-rc2`.
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.7.0-rc2/`.
    - [x] Update release note on [Uniffle website][1].
    - [x] Vote on dev@uniffle.apache.org
    - [x] Vote on general@incubator.apache.org
- [x] Tag and release `0.7.0`.
    - [x] (SVN) Move the artifacts under `dev/.../0.7.0-rc?` to `release/.../0.7.0` (by PPMC).
    - [x] (GitHub) Tag `0.7.0` to `0.7.0-rc?` and upload the artifacts.
    - [x] Update download link on [Uniffle website][1].
    - [x] Bump project version to `0.7.1-SNAPSHOT` in `branch-0.7`
    - [x] Post an announcement on general@incubator.apache.org

[1]: https://github.com/apache/incubator-uniffle-website

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/611/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VY924,incubator-uniffle,1432608184,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-16T06:52:11Z,2023-02-16T06:52:11Z,I don't know why the step of `Bump master to 0.8.0-SNAPSHOT` is the final step ? It looks unrelated with the tag creating,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VY924/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VY_nh,incubator-uniffle,1432615393,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-16T07:01:04Z,2023-02-16T07:01:04Z,"> I don't know why the step of `Bump master to 0.8.0-SNAPSHOT` is the final step ? It looks unrelated with the tag creating

Make sense, updated.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VY_nh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VecaD,incubator-uniffle,1434044035,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-17T03:24:31Z,2023-02-17T03:24:31Z,"Do we have a release guide? like https://linkis.apache.org/zh-CN/community/how-to-release/

I'm not familiar with Apache release.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VecaD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vee5V,incubator-uniffle,1434054229,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-17T03:43:10Z,2023-02-17T03:43:10Z,"> Do we have a release guide? like https://linkis.apache.org/zh-CN/community/how-to-release/

I don't think there is one yet. You can reference this link, and ask any questions in the current thread.

Cc @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vee5V/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoBWh,incubator-uniffle,1436554657,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-20T08:42:11Z,2023-02-20T08:42:11Z,How to deploy my gpg key to uniffle svn? Here: https://dist.apache.org/repos/dist/dev/incubator/uniffle/KEYS @kaijchen . ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoBWh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoBs_,incubator-uniffle,1436556095,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-20T08:43:28Z,2023-02-20T08:43:28Z,"> How to deploy my gpg key to uniffle svn? Here: https://dist.apache.org/repos/dist/dev/incubator/uniffle/KEYS

Need help from PPMC, Cc @jerqi.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoBs_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoFo1,incubator-uniffle,1436572213,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-20T08:57:38Z,2023-02-20T08:57:38Z,"> Need help from PPMC, Cc @jerqi.

OK

Besides, need I do the mvn deploy operation? Or @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoFo1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoHFs,incubator-uniffle,1436578156,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-20T09:01:34Z,2023-02-20T09:01:34Z,"> Besides, need I do the mvn deploy operation?

AFAIK, no need for now.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoHFs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VpZa2,incubator-uniffle,1436915382,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-20T12:21:22Z,2023-02-20T12:21:22Z,@zuston I've updated the checklist in the issue description.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VpZa2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WM3m4,incubator-uniffle,1446214072,611,NA,advancedxy,807537,,,NA,2023-02-27T12:07:44Z,2023-02-27T12:07:44Z,"Hi, what's the status of 0.7.0 release?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WM3m4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WS1Vr,incubator-uniffle,1447777643,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T08:37:17Z,2023-02-28T08:37:17Z,"> Hi, what's the status of 0.7.0 release?

I'm working on this. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WS1Vr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTF6U,incubator-uniffle,1447845524,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T09:26:31Z,2023-02-28T09:26:31Z,I have drafted the release. could you help check this? https://github.com/apache/incubator-uniffle/releases/tag/untagged-e126c5971ca7ac9e1d6d @advancedxy @kaijchen @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTF6U/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTH82,incubator-uniffle,1447853878,611,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-28T09:32:52Z,2023-02-28T09:32:52Z,"> I have drafted the release. could you help check this? https://github.com/apache/incubator-uniffle/releases/tag/untagged-e126c5971ca7ac9e1d6d @advancedxy @kaijchen @jerqi

https://github.com/apache/incubator-uniffle/pull/322
https://github.com/apache/incubator-uniffle/pull/307
https://github.com/apache/incubator-uniffle/pull/249
The three prs should be highlighted, too.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTH82/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTIAj,incubator-uniffle,1447854115,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-28T09:33:03Z,2023-02-28T09:33:03Z,"> I have drafted the release. could you help check this? https://github.com/apache/incubator-uniffle/releases/tag/untagged-e126c5971ca7ac9e1d6d @advancedxy @kaijchen @jerqi

Please bump version in `branch-0.7` to `0.7.0`.
Also, it's recommended to push a tag manually.

```bash
git checkout branch-0.7
git tag v0.7.0
git push origin v0.7.0
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTIAj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTKW8,incubator-uniffle,1447863740,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T09:40:27Z,2023-02-28T09:40:27Z,"> > I have drafted the release. could you help check this? https://github.com/apache/incubator-uniffle/releases/tag/untagged-e126c5971ca7ac9e1d6d @advancedxy @kaijchen @jerqi
> 
> Please bump version in `branch-0.7` to `0.7.0`. Also, it's recommended to push a tag manually.
> 
> ```shell
> git checkout branch-0.7
> git tag v0.7.0
> git push origin v0.7.0
> ```

OK. Do we need to set a rc version? @kaijchen ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTKW8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTLof,incubator-uniffle,1447868959,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T09:43:57Z,2023-02-28T09:43:57Z,"Besides, does the source tarballs need to upload to apache svn before voting this release?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTLof/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTL8z,incubator-uniffle,1447870259,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-28T09:44:53Z,2023-02-28T09:44:53Z,"> OK. Do we need to set a rc version?

No, because if everything goes well, `0.7.0-rc1` will become `0.7.0`.

> Besides, does the source tarballs need to upload to apache svn before voting this release?

Yes, the tarball should be named ~~`apache-uniffle-0.7.0-rc1-incubating-src.tar.gz`.~~
Edit:`apache-uniffle-0.7.0-incubating-src.tar.gz` under `0.7.0-rc1` directory.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTL8z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTM16,incubator-uniffle,1447873914,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T09:47:35Z,2023-02-28T09:47:35Z,"> Yes, the tarball should be named apache-uniffle-0.7.0-rc1-incubating-src.tar.gz.

OK. Could you tell me the steps or commands to build this tarball? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTM16/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTNGd,incubator-uniffle,1447874973,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-28T09:48:24Z,2023-02-28T09:48:24Z,"> Yes, the tarball should be named apache-uniffle-0.7.0-rc1-incubating-src.tar.gz.

Sorry, no `rc1` in tarball name, see https://dist.apache.org/repos/dist/dev/incubator/uniffle/0.6.1-rc2/","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTNGd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTNWb,incubator-uniffle,1447875995,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T09:49:05Z,2023-02-28T09:49:05Z,"> > Yes, the tarball should be named apache-uniffle-0.7.0-rc1-incubating-src.tar.gz.
> 
> OK. Could you tell me the steps or commands to build this tarball?

And how to upload this? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTNWb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTOZ9,incubator-uniffle,1447880317,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T09:52:18Z,2023-02-28T09:52:18Z,I heard from @jerqi that we just need to do source release.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTOZ9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTOaV,incubator-uniffle,1447880341,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-28T09:52:19Z,2023-02-28T09:52:19Z,"> OK. Could you tell me the steps or commands to build this tarball?

Since we are making source release only, you can use `git-archive` to create the tarball.

```bash
git archive --format=tar.gz --prefix=apache-uniffle-0.7.0-incubating-src/ v0.7.0-rc1 > apache-uniffle-0.7.0-incubating-src.tar.gz
```

> And how to upload this?

Put the tarball, checksum and signature in SVN, and upload it.
See: https://linkis.apache.org/zh-CN/community/how-to-release/#3-%E5%8F%91%E5%B8%83apache-svn%E4%BB%93%E5%BA%93","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTOaV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTOtT,incubator-uniffle,1447881555,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-28T09:53:13Z,2023-02-28T09:53:13Z,You can also refer to https://kvrocks.apache.org/community/create-a-release,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTOtT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTbi6,incubator-uniffle,1447934138,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T10:28:25Z,2023-02-28T10:28:25Z,"> Yes, the tarball should be named apache-uniffle-0.7.0-rc1-incubating-src.tar.gz.
Edit:apache-uniffle-0.7.0-incubating-src.tar.gz under 0.7.0-rc1 directory.

Done https://dist.apache.org/repos/dist/dev/incubator/uniffle/","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTbi6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTl1M,incubator-uniffle,1447976268,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-28T10:59:20Z,2023-02-28T10:59:20Z,"> Done https://dist.apache.org/repos/dist/dev/incubator/uniffle/

Artifacts looks good, but version in `pom.xml` should be changed to `0.7.0`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTl1M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTmaq,incubator-uniffle,1447978666,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-28T11:00:50Z,2023-02-28T11:00:50Z,"> ```shell
> git checkout branch-0.7
> git tag v0.7.0
> git push origin v0.7.0
> ```

Tag should be `v0.7.0-rc1` in this case. Wrong tag `v0.7.0` is removed.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTmaq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTnjX,incubator-uniffle,1447983319,611,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-28T11:03:54Z,2023-02-28T11:03:54Z,You don't change the pom.xml 's version t0 0.7.0.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTnjX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTsX4,incubator-uniffle,1448003064,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T11:17:45Z,2023-02-28T11:17:45Z,"> You don't change the pom.xml 's version t0 0.7.0.

Got it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTsX4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTwm_,incubator-uniffle,1448020415,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T11:29:49Z,2023-02-28T11:29:49Z,"> > You don't change the pom.xml 's version t0 0.7.0.
> 
> Got it.

Updated","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTwm_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WT1XS,incubator-uniffle,1448039890,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T11:44:00Z,2023-02-28T11:44:00Z,"> > I have drafted the release. could you help check this? https://github.com/apache/incubator-uniffle/releases/tag/untagged-e126c5971ca7ac9e1d6d @advancedxy @kaijchen @jerqi
> 
> #322 #307 #249 The three prs should be highlighted, too.

Updated. https://github.com/apache/incubator-uniffle/releases/tag/untagged-b70804300bb45088ec43","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WT1XS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WT2xT,incubator-uniffle,1448045651,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-28T11:48:37Z,2023-02-28T11:48:37Z,@zuston please refer to the task list in https://github.com/apache/incubator-uniffle/issues/611#issue-1587121237,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WT2xT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WT3jt,incubator-uniffle,1448048877,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-28T11:51:19Z,2023-02-28T11:51:19Z,"> @zuston please refer to the task list in [#611 (comment)](https://github.com/apache/incubator-uniffle/issues/611#issue-1587121237)

Thanks. I will do remaining tasks tomorrow","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WT3jt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYb33,incubator-uniffle,1449246199,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-01T02:41:17Z,2023-03-01T02:41:17Z,I have sent the vote email to dev@uniffle.apache.org cc @kaijchen ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYb33/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYd24,incubator-uniffle,1449254328,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-01T02:54:49Z,2023-03-01T02:54:49Z,"> I have sent the vote email to [dev@uniffle.apache.org](mailto:dev@uniffle.apache.org)

Thanks. 

> Comparing to 0.6.1, a bug fix of memory leak is included:

Minor versions are not like patch versions, the changes may be too many to describe in a sentence.
Maybe you can include the link to the (proposed) release note instead when voting in the incubator mailing list.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYd24/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYgCC,incubator-uniffle,1449263234,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-01T03:04:24Z,2023-03-01T03:04:24Z,"> Minor versions are not like patch versions, the changes may be too many to describe in a sentence.
Maybe you can include the link to the (proposed) release note instead when voting in the incubator mailing list.


It's my fault, I forget changing this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYgCC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYmly,incubator-uniffle,1449290098,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-01T03:50:16Z,2023-03-01T03:50:16Z,"I forgot deleting the pom.xml.versionBackup files, so do I need to cancel this vote and revote the rc-2 version after fixing? @kaijchen ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYmly/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WY2hd,incubator-uniffle,1449355357,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-01T05:05:32Z,2023-03-01T05:05:32Z,"> I forgot deleting the pom.xml.versionBackup files, so do I need to cancel this vote and revote the rc-2 version after fixing? @kaijchen

Yes, but no need to be hurry. You can give one or two days to let people check for other problems, and fix them together in `rc2`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WY2hd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WwW3K,incubator-uniffle,1455517130,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-06T06:13:11Z,2023-03-06T06:13:11Z,@zuston I think it's a good time to fix the problems and release the RC2.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WwW3K/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XANcX,incubator-uniffle,1459672855,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-08T07:44:13Z,2023-03-08T07:44:13Z,"> @zuston I think it's a good time to fix the problems and release the RC2.

Done. The vote mail has been sent","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XANcX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xf6I1,incubator-uniffle,1467982389,611,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-14T12:08:20Z,2023-03-14T12:08:20Z,@zuston Do we need rc3?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xf6I1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkbbf,incubator-uniffle,1469167327,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-15T01:51:56Z,2023-03-15T01:51:56Z,"> @zuston Do we need rc3?

Let's make rc2 as release version directly? WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkbbf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkh-R,incubator-uniffle,1469194129,611,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-15T02:16:29Z,2023-03-15T02:16:29Z,"> > @zuston Do we need rc3?
> 
> Let's make rc2 as release version directly? WDYT?

We should release rc3, we don't get enough votes because of flaky tests.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkh-R/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkk6x,incubator-uniffle,1469206193,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-15T02:32:09Z,2023-03-15T02:32:09Z,"> We should release rc3, we don't get enough votes because of flaky tests.

OK.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkk6x/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XuVLF,incubator-uniffle,1471763141,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-16T11:18:18Z,2023-03-16T11:18:18Z,"I have checked the branch-0.7 latest commits, it looks all flaky test fixes are all cherry picked. I want to release 0.7-rc3","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XuVLF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XuWOM,incubator-uniffle,1471767436,611,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-16T11:20:44Z,2023-03-16T11:20:44Z,"> I have checked the branch-0.7 latest commits, it looks all flaky test fixes are all cherry picked. I want to release 0.7-rc3

Let's release 0.7-rc3.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XuWOM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xuk24,incubator-uniffle,1471827384,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-16T12:01:44Z,2023-03-16T12:01:44Z,"> > I have checked the branch-0.7 latest commits, it looks all flaky test fixes are all cherry picked. I want to release 0.7-rc3
> 
> Let's release 0.7-rc3.

Done","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xuk24/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YKCjp,incubator-uniffle,1479026921,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-22T07:18:05Z,2023-03-22T07:18:05Z,Is it time to release 0.7.0 ?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YKCjp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YKC6R,incubator-uniffle,1479028369,611,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-22T07:20:00Z,2023-03-22T07:20:00Z,"> Is it time to release 0.7.0 ?

We need to vote on https://lists.apache.org/list.html?general@incubator.apache.org","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YKC6R/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlBzW,incubator-uniffle,1486101718,611,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-28T02:06:15Z,2023-03-28T02:06:15Z,"> Is it time to release 0.7.0 ?

@zuston Remind, we should start to vote in the incubator.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlBzW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgO50,incubator-uniffle,1501621876,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-10T09:52:54Z,2023-04-10T09:52:54Z,All done. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgO50/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgZFN,incubator-uniffle,1501663565,611,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-10T10:39:07Z,2023-04-10T10:39:07Z,"@zuston You forget bump version to 0.7.1-SNAPSHOT in branch-0.7.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgZFN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgliY,incubator-uniffle,1501714584,611,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-10T11:29:41Z,2023-04-10T11:29:41Z,"> @zuston You forget bump version to 0.7.1-SNAPSHOT in branch-0.7.

Done.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgliY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/611,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zj-BY,incubator-uniffle,1502601304,611,NA,advancedxy,807537,,,NA,2023-04-11T02:27:55Z,2023-04-11T02:27:55Z,"> All done.

Thanks, great work. 🎉 .","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zj-BY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/612,https://api.github.com/repos/apache/incubator-uniffle/issues/612,incubator-uniffle,1587141662,612,Flaky Test: ShuffleTaskManagerTest#removeShuffleDataWithHdfsTest,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-02-16T07:04:02Z,2023-02-25T01:49:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 14, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 85.858 s <<< FAILURE! - in org.apache.uniffle.server.ShuffleTaskManagerTest
Error:  removeShuffleDataWithHdfsTest  Time elapsed: 15.048 s  <<< ERROR!
java.lang.RuntimeException: Shuffle data commit timeout for 10000 ms
	at org.apache.uniffle.server.ShuffleTaskManager.commitShuffle(ShuffleTaskManager.java:259)
	at org.apache.uniffle.server.ShuffleTaskManagerTest.removeShuffleDataWithHdfsTest(ShuffleTaskManagerTest.java:427)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4191298244/jobs/7265939805

### Parent issue

#1733

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/612/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/612,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WH2Pq,incubator-uniffle,1444897770,612,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-25T01:49:29Z,2023-02-25T01:49:29Z,"Detailed info:

```
2023-02-16 06:57:00,663 INFO  [main] buffer.ShuffleBufferManager (ShuffleBufferManager.java:pickFlushedShuffle(500)) - Finish flush pick with 67 bytes
SLF4J: Failed toString() invocation on an object of type [org.apache.uniffle.server.ShuffleDataFlushEvent]
Reported exception:
java.lang.NullPointerException
	at org.apache.uniffle.server.ShuffleDataFlushEvent.toString(ShuffleDataFlushEvent.java:163)
	at org.slf4j.helpers.MessageFormatter.safeObjectAppend(MessageFormatter.java:277)
	at org.slf4j.helpers.MessageFormatter.deeplyAppendParameter(MessageFormatter.java:249)
	at org.slf4j.helpers.MessageFormatter.arrayFormat(MessageFormatter.java:211)
	at org.slf4j.helpers.MessageFormatter.arrayFormat(MessageFormatter.java:161)
	at org.slf4j.helpers.MessageFormatter.format(MessageFormatter.java:124)
	at org.slf4j.impl.Log4jLoggerAdapter.error(Log4jLoggerAdapter.java:516)
	at org.apache.uniffle.server.ShuffleFlushManager.flushToFile(ShuffleFlushManager.java:186)
	at org.apache.uniffle.server.ShuffleFlushManager.processEvent(ShuffleFlushManager.java:157)
	at org.apache.uniffle.server.ShuffleFlushManager.lambda$processNextEvent$0(ShuffleFlushManager.java:148)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WH2Pq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/613,https://api.github.com/repos/apache/incubator-uniffle/issues/613,incubator-uniffle,1587160611,613,Flaky Test: SimpleClusterManagerTest#updateExcludeNodesTest,xianjingfeng,11752250,,,CLOSED,2023-02-16T07:16:49Z,2023-02-21T15:16:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

Error:  Errors: 
Error:    SimpleClusterManagerTest.updateExcludeNodesTest:238 » ConditionTimeout Conditi...

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4191398213/jobs/7265789812

### Parent issue

#1733

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/613/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/615,https://api.github.com/repos/apache/incubator-uniffle/issues/615,incubator-uniffle,1587301854,615,[Improvement] Reduce task binary by removing 'partitionToServers' from RssShuffleHandle,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,CLOSED,2023-02-16T09:06:38Z,2023-03-14T02:02:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Both map and reduce tasks reference RssShuffleHandle wrapping 'partitionToServers' which is usually relatively far bigger than original task binary. E.g., we have  a shuffle with 10,000 partitions. The 'patitionToServers' could easily reach to 250,000 bytes assuming each map entry has size of 25 bytes.

Large task binary causes long task delay and task serialization time.  We can replace it with something else like a mapping function to map partitions to shuffle servers.


### How should we improve?

Instead, we can replace 'partitionToServers' with something else like a mapping function which map parition ID to shuffle servers. We only get shuffle servers once from the first shuffle task and cache them for later shuffle tasks with same shuffle ID per executor. 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/615/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/615,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VeyNv,incubator-uniffle,1434133359,615,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-02-17T05:44:34Z,2023-02-17T05:44:34Z,"As tested with 10,000 partitions and 2 shuffle servers, binary size of vanilla spark task is about 4KB. whilst Rss shuffle task is more than 670KB.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VeyNv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/615,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VgLOk,incubator-uniffle,1434497956,615,NA,advancedxy,807537,,,NA,2023-02-17T11:17:57Z,2023-02-17T11:17:57Z,":+1:, thanks, this is good for optimization. And I believe once the stage recompute is finished, we will have a communication layer between executor and driver, that would be much easier to reduce task binary size.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VgLOk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/615,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VuGkG,incubator-uniffle,1438148870,615,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-02-21T09:32:57Z,2023-02-21T09:32:57Z,@advancedxy  _[PR](https://github.com/apache/incubator-uniffle/pull/637)_ is ready. please help reivew.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VuGkG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/618,https://api.github.com/repos/apache/incubator-uniffle/issues/618,incubator-uniffle,1587793066,618,[Improvement] wrong HADOOP_URL in deploy/kubernetes/docker/build.sh,advancedxy,807537,,,CLOSED,2023-02-16T14:37:13Z,2023-02-17T07:29:37Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Only archived apache released are hosted under `https://archive.apache.org/dist`, latest versions of Hadoop would be hosted under `https://dlcdn.apache.org/hadoop/core/`
So if users want to build rss-server-image with the latest Hadoop. The archive may be not found.

Another issues about this: it would be appreciated to use mirror urls to download hadoop archives especially for people in China.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/618/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/625,incubator-uniffle,1589182740,625,[Improvement] Package sun.security.krb5 is not visible in Java 11 and 17,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-02-17T11:04:40Z,2023-03-15T14:18:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Sun Kerberos binding, i.e. package `sun.security.krb5` is blocking us to build Uniffle in Java 11 and Java 17.

```sh
# With JDK 11
mvn package -Djava.version=11

# With JDK 17
mvn package -Djava.version=17
```

### How should we improve?

> Apache Kerby, as an [Apache Directory](http://directory.apache.org/) sub project, is a Java Kerberos binding. It provides a rich, intuitive and interoperable implementation, library, KDC and various facilities that integrates PKI, OTP and token (OAuth2) as desired in modern environments such as cloud, Hadoop and mobile.

We can replace `sun.security.krb5` by [Apache Kerby](https://github.com/apache/directory-kerby).

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/625/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vsrm5,incubator-uniffle,1437776313,625,NA,advancedxy,807537,,,NA,2023-02-21T02:31:40Z,2023-02-21T02:31:40Z,"@zuston would you like to take a look at this? 

@kaijchen would you also post some compiling failure logs when with JDK 11 or JDK 17?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vsrm5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VsvKo,incubator-uniffle,1437790888,625,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-21T02:58:01Z,2023-02-21T02:58:01Z,"> @zuston would you like to take a look at this?

Yes. But I don't have much time in this month, perhaps next month.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VsvKo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vsv-x,incubator-uniffle,1437794225,625,NA,advancedxy,807537,,,NA,2023-02-21T03:02:14Z,2023-02-21T03:02:14Z,"> > @zuston would you like to take a look at this?
> 
> Yes. But I don't have much time in this month, perhaps next month.

No worries. It's not urgent.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vsv-x/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VtL1n,incubator-uniffle,1437908327,625,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-21T06:06:44Z,2023-02-21T06:06:44Z,"> would you also post some compiling failure logs when with JDK 11 or JDK 17?

https://github.com/kaijchen/incubator-uniffle/actions/runs/4228912219/jobs/7344901292#step:5:2884

```
Error:  Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.7.0:compile (default-compile) on project rss-common: Compilation failure
Error:  /home/runner/work/incubator-uniffle/incubator-uniffle/common/src/main/java/org/apache/uniffle/common/security/HadoopSecurityContext.java:[59,18] error: package sun.security.krb5 is not visible
Error:    (package sun.security.krb5 is declared in module java.security.jgss, which does not export it to the unnamed module)
Error:  -> [Help 1]
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VtL1n/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V6SIp,incubator-uniffle,1441341993,625,NA,slfan1989,55643692,,,NA,2023-02-23T08:04:01Z,2023-02-23T08:04:01Z,@kaijchen Can you assign this to me?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V6SIp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V6Sqr,incubator-uniffle,1441344171,625,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-23T08:05:20Z,2023-02-23T08:05:20Z,"> @kaijchen Can you assign this to me?

Assigned, thanks for taking this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V6Sqr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V6S08,incubator-uniffle,1441344828,625,NA,slfan1989,55643692,,,NA,2023-02-23T08:05:44Z,2023-02-23T08:05:44Z,@kaijchen Thank you very much!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V6S08/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XWvRp,incubator-uniffle,1465578601,625,NA,slfan1989,55643692,,,NA,2023-03-13T06:22:36Z,2023-03-13T06:22:36Z,"I read this part of the code carefully, and I summarized the relevant information as follows:

We have 2 ways to solve the issue.
- Remove `sun.security.krb5.Config.refresh();` code.
- Add `--add-exports java.security.jgss/sun.security.krb5=ALL-UNNAMED` in the pom.xml of the project.

> Remove `sun.security.krb5.Config.refresh();` code.

The code is based on the hadoop trunk branch. The code is different from hadoop-2.8.5, but this does not affect the conclusion.

1. From my personal point of view, this part of the code can be removed, because this part of the code should only work when the location of the `krb5.conf` configuration file changes in the same JVM.  
2. We can find that when using `loginUserFromKeytabAndReturnUGI`, `refreshKrb5Config=true` will be added by default. Because the `refreshKrb5Config=true` parameter is set to true, if the content of `krb5.conf` changes, it will be automatically reloaded.  But if the location of `krb5.conf` changes during the running of the program, this part of the logic will have no effect. 
3. I think we should not modify the location of `krb5.conf` during the running of the program. If the location of `krb5.conf` will not change, I think we can remove `sun.security.krb5.Config.refresh();`

> RefreshKrb5Config=true, The code call is as follows:

```
UserGroupInformation#loginUserFromKeytabAndReturnUGI
    \--> UserGroupInformation#doSubjectLogin
          \--> HadoopConfiguration#new HadoopLoginContext()
                \--> HadoopLoginContext#constructor
                      \-->  LoginContext#constructor#init
                           \--> LoginContext#constructor#init#getAppConfigurationEntry(name);
                                \--> HadoopConfiguration#getAppConfigurationEntry
```
We use `UserGroupInformation.loginUserFromKeytabAndReturnUGI(principal, keytabFile)` to verify the identity of the user and ensure that legitimate users can access HDFS.  We can find that `refreshKrb5Config=true` is added when initializing access to Kerberos configuration in the Hadoop code.

UserGroupInformation#loginUserFromKeytabAndReturnUGI
```
public
  static UserGroupInformation loginUserFromKeytabAndReturnUGI(String user,
                                  String path
                                  ) throws IOException {
    if (!isSecurityEnabled())
      return UserGroupInformation.getCurrentUser();

    LoginParams params = new LoginParams();
    params.put(LoginParam.PRINCIPAL, user);
    params.put(LoginParam.KEYTAB, path);
    return doSubjectLogin(null, params);
  }
```

UserGroupInformation#doSubjectLogin
```
private static UserGroupInformation doSubjectLogin(
      Subject subject, LoginParams params) throws IOException {
    ensureInitialized();
    // initial default login.
    if (subject == null && params == null) {
      params = LoginParams.getDefaults();
    }
    HadoopConfiguration loginConf = new HadoopConfiguration(params);
    try {
      // *****
      // We need to focus on this code
      // *****
      HadoopLoginContext login = newLoginContext(
        authenticationMethod.getLoginAppName(), subject, loginConf);
      login.login();
      UserGroupInformation ugi = new UserGroupInformation(login.getSubject());
      // attach login context for relogin unless this was a pre-existing
      // subject.
      if (subject == null) {
        params.put(LoginParam.PRINCIPAL, ugi.getUserName());
        ugi.setLogin(login);
        ugi.setLastLogin(Time.now());
      }
      return ugi;
    } catch (LoginException le) {
      KerberosAuthException kae =
        new KerberosAuthException(FAILURE_TO_LOGIN, le);
      if (params != null) {
        kae.setPrincipal(params.get(LoginParam.PRINCIPAL));
        kae.setKeytabFile(params.get(LoginParam.KEYTAB));
        kae.setTicketCacheFile(params.get(LoginParam.CCACHE));
      }
      throw kae;
    }
  }
```

HadoopConfiguration#new HadoopLoginContext()
```
private static HadoopLoginContext
  newLoginContext(String appName, Subject subject,
                  HadoopConfiguration loginConf)
      throws LoginException {
    // Temporarily switch the thread's ContextClassLoader to match this
    // class's classloader, so that we can properly load HadoopLoginModule
    // from the JAAS libraries.
    Thread t = Thread.currentThread();
    ClassLoader oldCCL = t.getContextClassLoader();
    t.setContextClassLoader(HadoopLoginModule.class.getClassLoader());
    try {
      return new HadoopLoginContext(appName, subject, loginConf);
    } finally {
      t.setContextClassLoader(oldCCL);
    }
  }
```

HadoopLoginContext#constructor
```
HadoopLoginContext(String appName, Subject subject,
                       HadoopConfiguration conf) throws LoginException {
      super(appName, subject, null, conf);
      this.appName = appName;
      this.conf = conf;
    }
```

LoginContext#constructor(Configuration config is HadoopConfiguration)
```
public LoginContext(String name, Subject subject,
                        CallbackHandler callbackHandler,
                        Configuration config) throws LoginException {
        this.config = config;
        if (config != null) {
            creatorAcc = java.security.AccessController.getContext();
        }
        // 
        init(name);
        if (subject != null) {
            this.subject = subject;
            subjectProvided = true;
        }
        if (callbackHandler == null) {
            loadDefaultCallbackHandler();
        } else if (creatorAcc == null) {
            this.callbackHandler = new SecureCallbackHandler
                                (java.security.AccessController.getContext(),
                                callbackHandler);
        } else {
            this.callbackHandler = callbackHandler;
        }
    }
```

LoginContext#constructor#init#getAppConfigurationEntry
```
private void init(String name) throws LoginException {

        .....

        // get the LoginModules configured for this application
        // We can view HadoopConfiguration's getAppConfigurationEntry.
        AppConfigurationEntry[] entries = config.getAppConfigurationEntry(name);
        if (entries == null) {

            if (sm != null && creatorAcc == null) {
                sm.checkPermission(new AuthPermission
                                (""createLoginContext."" + OTHER));
            }

            entries = config.getAppConfigurationEntry(OTHER);
            if (entries == null) {
                MessageFormat form = new MessageFormat(ResourcesMgr.getString
                        (""No.LoginModules.configured.for.name""));
                Object[] source = {name};
                throw new LoginException(form.format(source));
            }
        }
        moduleStack = new ModuleInfo[entries.length];
        for (int i = 0; i < entries.length; i++) {
            // clone returned array
            moduleStack[i] = new ModuleInfo
                                (new AppConfigurationEntry
                                        (entries[i].getLoginModuleName(),
                                        entries[i].getControlFlag(),
                                        entries[i].getOptions()),
                                null);
        }
        .....
    }
```

> add --add-exports java.security.jgss/sun.security.krb5=ALL-UNNAMED

after `JDK11`, package `sun.security.krb5` is not visible. I refer to `hbase` and `flink`.  These two projects added `--add-exports java.security.jgss/sun.security.krb5=ALL-UNNAMED` when compiling maven, which can ensure that the compilation passes. 

> no need to use apache kerby

`Apache Kerby` is a good project, which is used in the code of `Hadoop MiniKDC`, but only in test classes. When Hadoop performs Kerberos authentication, it is still implemented based on Java `JAAS`. We rely on hadoop for kerberos authentication, there should be no need to use `Apache Kerby`.  `Hbase` and `Flink` also have the need to verify `Kerberos`, but without using `Apache Kerby,` I think we can also directly rely on hadoop without using Apache Kerby.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XWvRp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XXkR2,incubator-uniffle,1465795702,625,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-13T09:32:22Z,2023-03-13T09:32:22Z,cc @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XXkR2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XXlTC,incubator-uniffle,1465799874,625,NA,slfan1989,55643692,,,NA,2023-03-13T09:35:28Z,2023-03-13T09:35:28Z,"> cc @zuston

@jerqi @zuston @kaijchen I still need to add some information. after the information is completed, please help to review it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XXlTC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XcwR4,incubator-uniffle,1467155576,625,NA,slfan1989,55643692,,,NA,2023-03-14T00:16:17Z,2023-03-14T00:16:17Z,"@jerqi @zuston @kaijchen Can you please check my comment above? Thank you so much!

I think adding `--add-exports java.security.jgss/sun.security.krb5=ALL-UNNAMED` in the pom file is a better option. But I still want to ask `sun.security.krb5.Config.refresh();` the purpose of this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XcwR4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XdDlo,incubator-uniffle,1467234664,625,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-14T02:09:24Z,2023-03-14T02:09:24Z,"Wow, really thanks for your great work. @slfan1989 

> no need to use apache kerby

+1. 

> But I still want to ask sun.security.krb5.Config.refresh(); the purpose of this.

This part of code is introduced in #184 . If I remember correctly, this is just for unit test to simulate setting the profile w/o, because all tests run in one JVM.

If test cases could pass, I prefer removing this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XdDlo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/625,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XdJdA,incubator-uniffle,1467258688,625,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-14T02:32:14Z,2023-03-14T02:32:14Z,"> But I still want to ask `sun.security.krb5.Config.refresh();` the purpose of this.

Thanks @slfan1989 for the investigation, +1 for this proposal. I'll change the title of this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XdJdA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/626,https://api.github.com/repos/apache/incubator-uniffle/issues/626,incubator-uniffle,1589203949,626,[Improvement] run CIs based on paths changed,advancedxy,807537,,,CLOSED,2023-02-17T11:20:30Z,2023-02-20T10:54:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For JVM only related changes, we don't have to run k8s/operator build. We can leverage https://github.com/dorny/paths-filter#examples to achieve this.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/626/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/626,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoAQO,incubator-uniffle,1436550158,626,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-02-20T08:37:51Z,2023-02-20T08:37:51Z,Ref #580.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VoAQO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/627,https://api.github.com/repos/apache/incubator-uniffle/issues/627,incubator-uniffle,1589236324,627,[Bug] operator should set coordinator and shuffle server's ports to the spec rather a fixed value,advancedxy,807537,,,CLOSED,2023-02-17T11:48:54Z,2023-02-20T12:27:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

As reported by https://github.com/apache/incubator-uniffle/discussions/620, it's related to code:
```
func generateMainContainerPorts(rss *unifflev1alpha1.RemoteShuffleService) []corev1.ContainerPort {
	ports := []corev1.ContainerPort{
		{
			ContainerPort: controllerconstants.ContainerCoordinatorRPCPort,
			Protocol:      corev1.ProtocolTCP,
		},
		{
			ContainerPort: controllerconstants.ContainerCoordinatorHTTPPort,
			Protocol:      corev1.ProtocolTCP,
		},
	}
	ports = append(ports, rss.Spec.Coordinator.Ports...)
	return ports
}
```
The coordinator and shuffle server's container port is fixed to the default constants. It should matches the port specified in the RSS spec.



### Affects Version(s)

master,0.7.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/627/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/627,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VgTT4,incubator-uniffle,1434531064,627,NA,advancedxy,807537,,,NA,2023-02-17T11:50:32Z,2023-02-17T11:50:32Z,"There's another problem about the operator:
```
func GenerateAddresses(rss *unifflev1alpha1.RemoteShuffleService) string {
	var names []string
	for i := 0; i < int(*rss.Spec.Coordinator.Count); i++ {
		name := GenerateNameByIndex(rss, i)
		serviceName := appendHeadless(name)
		current := fmt.Sprintf(""%v:%v"", serviceName, controllerconstants.ContainerShuffleServerRPCPort)
		names = append(names, current)
	}
	return strings.Join(names, "","")
}
```
It uses wrong constants, and it should also be updated to use the port in the spec.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VgTT4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/630,https://api.github.com/repos/apache/incubator-uniffle/issues/630,incubator-uniffle,1591245051,630,[FEATURE] Disable the localShuffleRead in Spark client,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-02-20T06:46:18Z,2023-02-21T11:14:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

The conf of `spark.sql.adaptive.localShuffleReader.enabled` should be false when using uniffle.

We'd better to disable it by default in `RssShuffleManager`

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/630/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/630,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VnfoM,incubator-uniffle,1436416524,630,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-20T06:46:43Z,2023-02-20T06:46:43Z,PTAL @jerqi @advancedxy ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VnfoM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/630,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vo7uO,incubator-uniffle,1436793742,630,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-20T11:26:08Z,2023-02-20T11:26:08Z,Ok for me.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vo7uO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/630,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VsrWE,incubator-uniffle,1437775236,630,NA,advancedxy,807537,,,NA,2023-02-21T02:29:32Z,2023-02-21T02:29:32Z,+1 for this. And it's better to add some explanation how local shuffle reader work and why it's better to turn off this optimization when using RssShuffleManager.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VsrWE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/632,https://api.github.com/repos/apache/incubator-uniffle/issues/632,incubator-uniffle,1591513588,632,[Bug] rss spec's volume doesn't take an effect,advancedxy,807537,,,CLOSED,2023-02-20T09:55:27Z,2023-02-21T08:02:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

There's a field called `Volumes` in rss spec, but it's never used to generate coordinator and shuffle server's pod spec.

Therefore,  user(admin) cannot configure volumes to mount additional settings

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/632/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/635,https://api.github.com/repos/apache/incubator-uniffle/issues/635,incubator-uniffle,1592748947,635,[Improvement] Enable LOCAL_ORDER for Spark AQE by default,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-02-21T04:12:45Z,2023-02-23T01:50:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the local_order data distribution type should be activated explicitly. It's better to enable it when using AQE by default.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/635/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/635,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vs7hq,incubator-uniffle,1437841514,635,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-21T04:24:47Z,2023-02-21T04:24:47Z,cc @jerqi @advancedxy ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vs7hq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/635,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VtZnA,incubator-uniffle,1437964736,635,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-21T07:17:10Z,2023-02-21T07:17:10Z,+1,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VtZnA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/635,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vt-eR,incubator-uniffle,1438115729,635,NA,advancedxy,807537,,,NA,2023-02-21T09:10:53Z,2023-02-21T09:10:53Z,"> Currently, the local_order data distribution type should be activated explicitly. It's better to enable it when using AQE by default.

SGTM.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Vt-eR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/639,https://api.github.com/repos/apache/incubator-uniffle/issues/639,incubator-uniffle,1594410670,639,[Subtask] [Netty] Separate the send port and receive port,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-02-22T03:49:00Z,2023-02-22T03:49:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

We should separate the send port and receive port. It may give us better performance.

### Parent issue

#133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/639/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/640,https://api.github.com/repos/apache/incubator-uniffle/issues/640,incubator-uniffle,1594412080,640,[Subtask] [Netty] Metrics system,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-02-22T03:51:17Z,2023-07-28T02:39:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

We should more Netty metrics to ensure our system load. 

### Parent issue

#133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/640/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/640,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYi2h,incubator-uniffle,1449274785,640,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-03-01T03:20:53Z,2023-03-01T03:20:53Z,"assgin for me,thx","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WYi2h/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/642,https://api.github.com/repos/apache/incubator-uniffle/issues/642,incubator-uniffle,1594524185,642,[Improvement] better default shuffle server configuration ,advancedxy,807537,,,CLOSED,2023-02-22T06:17:26Z,2023-02-27T13:42:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

1. `rss.server.buffer.capacity` could have a default settings, `JVM MaxHeapSize` * some factor
2. `rss.server.read.buffer.capacity` is similar with `rss.server.buffer.capacity`

Otherwise, once the max heap size of shuffle server is changed, users/admins have to reconfigure these two buffer settings.

----
1. `rss.server.disk.capacity` is -1(by default), shuffle server uses the total space of one disk, which seems operation unfriendly. Shuffle server should reserve some partition of disk space and not use all the disks, such as at most 95% the capacity. 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/642/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/642,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VzPdc,incubator-uniffle,1439496028,642,NA,advancedxy,807537,,,NA,2023-02-22T06:19:29Z,2023-02-22T06:19:29Z,"cc @jerqi, WDYT? would you like to refine this settings?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VzPdc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/642,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VzSZA,incubator-uniffle,1439508032,642,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-02-22T06:35:11Z,2023-02-22T06:35:11Z,"> cc @jerqi, WDYT? would you like to refine this settings?

OK","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VzSZA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/642,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WIHqU,incubator-uniffle,1444969108,642,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-25T03:02:17Z,2023-02-25T03:02:17Z,"> rss.server.disk.capacity is -1(by default), shuffle server uses the total space of one disk, which seems operation unfriendly. Shuffle server should reserve some partition of disk space and not use all the disks, such as at most 95% the capacity.
 
I think this config as a ratio value will be better, the current concrete disk capacity is not flexible especially for heterogeneous storage.  @advancedxy ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WIHqU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/642,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WINnK,incubator-uniffle,1444993482,642,NA,advancedxy,807537,,,NA,2023-02-25T04:55:37Z,2023-02-25T04:55:37Z,"> > rss.server.disk.capacity is -1(by default), shuffle server uses the total space of one disk, which seems operation unfriendly. Shuffle server should reserve some partition of disk space and not use all the disks, such as at most 95% the capacity.
> 
> I think this config as a ratio value will be better, the current concrete disk capacity is not flexible especially for heterogeneous storage. @advancedxy

:+1.  Sound good to me. But the fixed capacity has its own use cases, I will not remove this configuration, rather add a ratio configuration then use it preferably.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WINnK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/643,https://api.github.com/repos/apache/incubator-uniffle/issues/643,incubator-uniffle,1594539765,643,[Improvement]feat(operator): allow update replica of rss shuffle server when upgrading,advancedxy,807537,,,OPEN,2023-02-22T06:33:24Z,2023-02-22T06:34:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, rss operator performances the upgrading of StateFullSet of shuffle server incrementally and only updates the rss object from upgrading to running when the sts is ready.

However for increasing replica of shuffle server, there might be cases that the replica is too large that K8S cluster doesn't have enough resources to scheduling all the shuffle server, which means sts can never be ready, which makes the rss object hanging in the `upgrading` status forever.

From the webhook side of rss operator, it forbids any update to an `upgrading` rss object. 

Considering these two facts together, rss obejct could be ended up in `upgrading` state and there's currently no way to change that from the rss object side.

### How should we improve?

I'd like to propose that allowing modify replica of shuffle server even when the rss object is upgrading.  Therefore, admins of rss cluster could decrease the replica and makes the rss object entering the running state.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/643/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/643,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VzSOy,incubator-uniffle,1439507378,643,NA,advancedxy,807537,,,NA,2023-02-22T06:34:17Z,2023-02-22T06:34:17Z,"cc @wangao1236, do you have more input on this? And if possible, would you like to work on this when you have some time?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5VzSOy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/645,https://api.github.com/repos/apache/incubator-uniffle/issues/645,incubator-uniffle,1594926612,645,[Improvement] feat(operator):  Support for custom initialization parameters.,crain-cn,45311215,Yu Zhao,china.crain@gmail.com,CLOSED,2023-02-22T11:20:22Z,2023-03-05T12:12:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

I want to support the InitFlags method in main.go, which can modify the Options setting of the Manager to customize many properties.

### How should we improve?

We should add an InitFlags method in main.go, and then use flag package to set default parameters to accept command-line arguments. This allows users to customize various startup parameters and configurations easily.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/645/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/645,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WKe1t,incubator-uniffle,1445588333,645,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-02-27T02:35:45Z,2023-02-27T02:35:45Z,PTAL @advancedxy @wangao1236 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WKe1t/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/645,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WLZNL,incubator-uniffle,1445827403,645,NA,advancedxy,807537,,,NA,2023-02-27T07:20:33Z,2023-02-27T07:20:33Z,"From the issue description, I don't quite get what you want to archive. The main.go for controller and webhook already handles flag parsing. 

But you are always welcome to submit a PR, and let's discuss there.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WLZNL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/645,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WLtYb,incubator-uniffle,1445910043,645,NA,crain-cn,45311215,Yu Zhao,china.crain@gmail.com,NA,2023-02-27T08:33:15Z,2023-02-27T08:33:15Z,"> From the issue description, I don't quite get what you want to archive. The main.go for controller and webhook already handles flag parsing.
> 
> But you are always welcome to submit a PR, and let's discuss there.

Only the parameters in Config are configured, and parameters in ctrl.Options such as SyncPeriod, Namespace, and RetryPeriod cannot be modified.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WLtYb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/645,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WNFht,incubator-uniffle,1446271085,645,NA,advancedxy,807537,,,NA,2023-02-27T12:50:49Z,2023-02-27T12:50:49Z,"> > From the issue description, I don't quite get what you want to archive. The main.go for controller and webhook already handles flag parsing.
> > But you are always welcome to submit a PR, and let's discuss there.
> 
> Only the parameters in Config are configured, and parameters in ctrl.Options such as SyncPeriod, Namespace, and RetryPeriod cannot be modified.

I see. SGTM.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WNFht/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/645,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTEXK,incubator-uniffle,1447839178,645,NA,crain-cn,45311215,Yu Zhao,china.crain@gmail.com,NA,2023-02-28T09:21:53Z,2023-02-28T09:21:53Z,"> 



> > > From the issue description, I don't quite get what you want to archive. The main.go for controller and webhook already handles flag parsing.
> > > But you are always welcome to submit a PR, and let's discuss there.
> > 
> > 
> > Only the parameters in Config are configured, and parameters in ctrl.Options such as SyncPeriod, Namespace, and RetryPeriod cannot be modified.
> 
> I see. SGTM.

Submitted.   #670 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WTEXK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/647,https://api.github.com/repos/apache/incubator-uniffle/issues/647,incubator-uniffle,1594982262,647,[Bug] Multiple Coordinator call method `detectStorage`,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-02-22T12:00:54Z,2023-02-23T01:35:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

If we have multiple coordinators, they detect the same path, we delete and create the same file, they will influence each other.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/647/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/649,https://api.github.com/repos/apache/incubator-uniffle/issues/649,incubator-uniffle,1595522429,649,[Improvement] Remove mini-cluster in `ClientConfManagerTest`,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2023-02-22T17:37:35Z,2023-02-23T07:16:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Because the current path detection is triggered manually, we do not need to manually write the file to mini-cluster. We can remove the dependency of this mini-cluster in Coordinator. And we can reduce the initialization time of the mini-cluster.

.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/649/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/649,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V5n7a,incubator-uniffle,1441169114,649,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-02-23T03:22:38Z,2023-02-23T03:22:38Z,"cc @kaijchen This fix can reduce the time of GA.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5V5n7a/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/655,https://api.github.com/repos/apache/incubator-uniffle/issues/655,incubator-uniffle,1598249143,655,[Improvement] polish start-coordinator.sh,advancedxy,807537,,,CLOSED,2023-02-24T09:24:41Z,2023-02-24T10:04:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

1. add gc log for coordinator
2. makes heap size configurable 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/655/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/659,https://api.github.com/repos/apache/incubator-uniffle/issues/659,incubator-uniffle,1599514107,659,[Bug] NPE of underStorage in ShuffleDataFlushEvent#toString,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-02-25T02:49:03Z,2023-02-25T08:51:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In some test cases, the `underStorage` of `ShuffleDataFlushEvent` may be null, so NPE of `underStorage` in `toString` should be fixed.

Like: https://github.com/apache/incubator-uniffle/blob/18c738ea60b32c733f7f7b23b09ad6b0d83a116d/server/src/main/java/org/apache/uniffle/server/ShuffleFlushManager.java#L184-L189.

If the storage is null, the log operation will throw exception due to NPE of underStorage.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/659/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/661,https://api.github.com/repos/apache/incubator-uniffle/issues/661,incubator-uniffle,1599521462,661,[FEATURE] Introduce the general client conf for mr/spark,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-02-25T03:07:08Z,2023-03-30T08:21:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Introduce the general client conf for mr/spark
1. Introduce the class of `RssClientConf` to set the general configOptions for mr/spark
2. Introduce the class of `RssSparkClientConf` to set the spark exclusive `configOptions` and to construct the RssConf from the `SparkConf`
3. Introduce the class of `RssMRClientConf`

I proposed a PR #200 before, but it looks this part needs to do much changes.

### Motivation

Now in mr/spark client conf, we don't obey the rule of uniffle `configOptions`. It causes the some problems as follows

1. When introducing the client general conf, we have to write three times in `RssSparkConfig`/ `RssClientConfig` / `RssMRConfig`. Actually there is no need to leave dirty works for developers.
2. If when introducing a general method for MR/Spark and need to some configs from Rss client conf. In current implementation, we have to introduce extra class for method's params. If we having the general RssClientConf, it will benifit more.


### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/661/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/661,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WLaG4,incubator-uniffle,1445831096,661,NA,advancedxy,807537,,,NA,2023-02-27T07:24:06Z,2023-02-27T07:24:06Z,I'm for this idea. `RssSparkConfig` and `RssMRConfig` should be subclass of `RssClientConfig`.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WLaG4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/661,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YzYjy,incubator-uniffle,1489864946,661,NA,advancedxy,807537,,,NA,2023-03-30T08:00:28Z,2023-03-30T08:00:28Z,"@zuston would you like to work on this? 

I feel the pain when implementing stage recomputing for spark clients.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YzYjy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/661,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YzfUO,incubator-uniffle,1489892622,661,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-30T08:21:01Z,2023-03-30T08:21:01Z,"> @zuston would you like to work on this?
> 
> I feel the pain when implementing stage recomputing for spark clients.

This issue is not of high priority. I'm curious about the pain you mentioned.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YzfUO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/665,https://api.github.com/repos/apache/incubator-uniffle/issues/665,incubator-uniffle,1600728283,665,[Improvement] Keep consistent with vanilla spark when key or value is null,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-02-27T08:41:29Z,2023-02-27T09:17:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Handle when key or value is null in one record. like this:

```
23/02/27 15:43:06 ERROR Executor: Exception in task 31.3 in stage 2.0 (TID 2067)
java.lang.NullPointerException
	at org.apache.spark.shuffle.writer.WriteBufferManager.addRecord(WriteBufferManager.java:116)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.doWrite(RssShuffleWriter.java:211)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:170)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)
	at org.apache.spark.scheduler.Task.run(Task.scala:131)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
23/02/27 15:43:06 INFO YarnCoarseGrainedExecutorBackend: Got assigned task 2302
23/02/27 15:43:06 INFO Executor: Running task 409.0 in stage 2.0 (TID 2302)
```

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/665/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/667,https://api.github.com/repos/apache/incubator-uniffle/issues/667,incubator-uniffle,1600733182,667,[Flaky Test] QuorumTest#case7,xianjingfeng,11752250,,,OPEN,2023-02-27T08:45:37Z,2025-01-08T01:57:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 14, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 50.169 s <<< FAILURE! - in org.apache.uniffle.test.QuorumTest
Error:  case7  Time elapsed: 2.6 s  <<< ERROR!
org.apache.uniffle.common.exception.RssException: Failed to read shuffle data from WARM handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:102)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:112)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:236)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:162)
	at org.apache.uniffle.test.QuorumTest.case7(QuorumTest.java:588)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:[725](https://github.com/apache/incubator-uniffle/actions/runs/4279773833/jobs/7450823023#step:6:726))
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: org.apache.uniffle.common.exception.RssException: Failed to read shuffle index for appId[case7], shuffleId[0], partitionId[0]
	at org.apache.uniffle.storage.handler.impl.LocalFileClientReadHandler.readShuffleIndex(LocalFileClientReadHandler.java:92)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:70)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:100)
	... 73 more
Caused by: io.grpc.StatusRuntimeException: DEADLINE_EXCEEDED: deadline exceeded after 0.199922799s. [closed=[], committed=[remote_addr=10.1.0.7/10.1.0.7:20003]]
	at io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCalls.java:271)
	at io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:252)
	at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:165)
	at org.apache.uniffle.proto.ShuffleServerGrpc$ShuffleServerBlockingStub.getLocalShuffleIndex(ShuffleServerGrpc.java:814)
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.getShuffleIndex(ShuffleServerGrpcClient.java:612)
	at org.apache.uniffle.storage.handler.impl.LocalFileClientReadHandler.readShuffleIndex(LocalFileClientReadHandler.java:90)
	... 75 more
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4279773833/jobs/7450823023

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/667/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/667,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZkxSL,incubator-uniffle,2576553099,667,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2025-01-08T01:56:59Z,2025-01-08T01:56:59Z,"Who can help to fix this UT? If not, shall we disable this UT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZkxSL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/668,https://api.github.com/repos/apache/incubator-uniffle/issues/668,incubator-uniffle,1602530342,668,[Improvement] Introduce thread pool for sending app heartbeat,xianjingfeng,11752250,,,CLOSED,2023-02-28T07:48:05Z,2023-03-19T09:59:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In the current logic. if one applicaiton need to sends heartbeat to many shuffle servers, applicaiton will be expired in some shuffle servers.

https://github.com/apache/incubator-uniffle/blob/4fd9cad07e2943d7f3fa8b2010a43e90520325ff/client/src/main/java/org/apache/uniffle/client/impl/ShuffleWriteClientImpl.java#L669-L682

### How should we improve?

Introduce thread pool for sending app heartbeat

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/668/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/668,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X7Yzn,incubator-uniffle,1475185895,668,NA,xianjingfeng,11752250,,,NA,2023-03-19T09:59:06Z,2023-03-19T09:59:06Z,"My mistake, it it already using the thread pool.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X7Yzn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/669,https://api.github.com/repos/apache/incubator-uniffle/issues/669,incubator-uniffle,1602538549,669,[Improvement]  Refresh application when reading memory data,xianjingfeng,11752250,,,CLOSED,2023-02-28T07:55:37Z,2023-03-19T11:15:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In the current logic, application will not be refreshed when reading memory data. In this case, If timeout occurs when spark driver sends heartbeat to shuffle server, the application will be expired.

### How should we improve?

Refresh application when reading memory data.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/669/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/671,https://api.github.com/repos/apache/incubator-uniffle/issues/671,incubator-uniffle,1603478054,671,[FEATURE] Metrics of the number of apps submitted by users,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2023-02-28T17:20:43Z,2023-03-03T12:21:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

If the user selects quotaManager, the metrics of the number of apps submitted by different users will be added to the coordinator metrics.

### Motivation

If quota is set, we can record the number of apps being submitted by different users through metrics.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/671/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/674,incubator-uniffle,1606069658,674,[Improvement] Use ByteString#asReadOnlyByteBuffer to reduce the memory allocation and GC pressure,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-03-02T04:02:12Z,2023-07-10T09:57:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In our production environment, the shuffle server is always stopped due to the full GC. After increasing more memory, it still occurs, that makes me confused. So I suspect some abusing memory exists in uniffle.

After digging into the Grpc service api of `sendShuffleData`, I found something is abnormal. Please see this part code.

https://github.com/apache/incubator-uniffle/blob/1fbdfe576f0a164f173cbff9ad83dccccb909ee2/server/src/main/java/org/apache/uniffle/server/ShuffleServerGrpcService.java#L751-L769

The byte[] will always be created in the invoking of `block.getData().toByteArray()`, which will cause GC if receiving data speed is high. And this has been proved in our dashboard

Besides, the byte[] will be created when reading shuffle data in memory, which may be not the main factor to trigger this. Anyway, it also should be fixed.

### How should we improve?

We could use the `block.getData().asReadOnlyByteBuffer()` to replace `toByteArray` to avoid unnecessary memory allocation.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/674/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WgJXA,incubator-uniffle,1451267520,674,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-02T04:03:05Z,2023-03-02T04:03:05Z,I think this is a critical problem for Uniffle and I will fix this ASAP. cc @jerqi @advancedxy @xianjingfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WgJXA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WmEpa,incubator-uniffle,1452821082,674,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-03T01:52:29Z,2023-03-03T01:52:29Z,Will it block the release of version 0.7?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WmEpa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WnLcq,incubator-uniffle,1453111082,674,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-03T07:46:23Z,2023-03-03T07:46:23Z,"> Will it block the release of version 0.7?

No.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WnLcq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WnWOX,incubator-uniffle,1453155223,674,NA,advancedxy,807537,,,NA,2023-03-03T08:28:19Z,2023-03-03T08:28:19Z,"> We could use the block.getData().asReadOnlyByteBuffer() to replace toByteArray to avoid unnecessary memory allocation.

This sounds good to me. Do you apply this in your prod env or not?

However I believe it would require some careful management when this data is reused.  It won't be released until the data is flushed.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WnWOX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ws5sS,incubator-uniffle,1454611218,674,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-04T07:20:12Z,2023-03-04T07:20:12Z,"> This sounds good to me. Do you apply this in your prod env or not?

No. 

I have to say after applying this optimization, the GC pause is still serious in my point to point writing benchmark. So maybe this is not the main problem. Anyway, this is still an improvement.

BTW, I want to share the benchmark result and I think uniffle's users will benefit from this.

Shuffle server environment
1. XMX 20G
2. buffer capacity 10G
3. read capacity 5G

Shuffle Writer program
1. using spark to write shuffle data with 20 executors. Single executor will total write 1G, and each time write 14M

| Java version | ShuffleServer GC  | Max pause time | ThroughOutput |
| ------------- | ------------- | ------------- | ------------- | 
| 8  | G1  | 30s | 0.3 |
| 11  | G1  | 2.5s | 0.8 |
| 18  | G1  | 2.5s | 0.8 |
| 18  | ZGC  | 0.2ms | 0.99997 |

It's amazing for me. I think we should drop java8 version","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ws5sS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WuqlT,incubator-uniffle,1455073619,674,NA,advancedxy,807537,,,NA,2023-03-05T12:10:19Z,2023-03-05T12:10:19Z,"> > This sounds good to me. Do you apply this in your prod env or not?
> 
> No.
> 
> I have to say after applying this optimization, the GC pause is still serious in my point to point writing benchmark. So maybe this is not the main problem. Anyway, this is still an improvement.
> 
> BTW, I want to share the benchmark result and I think uniffle's users will benefit from this.
> 
> Shuffle server environment
> 
> 1. XMX 20G
> 2. buffer capacity 10G
> 3. read capacity 5G
> 
> Shuffle Writer program
> 
> 1. using spark to write shuffle data with 20 executors. Single executor will total write 1G, and each time write 14M
> 
> Java version	ShuffleServer GC	Max pause time	ThroughOutput
> 8	G1	30s	0.3
> 11	G1	2.5s	0.8
> 18	G1	2.5s	0.8
> 18	ZGC	0.2ms	0.99997
> It's amazing for me. I think we should drop java8 version

Is there any parameter turning for Java 8 to achieve similar performance gain like Java 11?
As we discussed earlier, Hadoop 2 and various Hadoop 3 versions support java 8 only, https://cwiki.apache.org/confluence/display/HADOOP/Hadoop+Java+Versions, I don't think we can drop Java 8 support. I believe that's why Spark still supports Java 8.

So I believe we cannot simply change the default JDK version to 11 as you proposed in #683. However, it's always possible to build rss-server with alternative JDK 11 based images.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WuqlT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WuvcL,incubator-uniffle,1455093515,674,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-05T13:33:19Z,2023-03-05T13:33:19Z,"> Is there any parameter turning for Java 8 to achieve similar performance gain like Java 11?

I don’t apply any param turning

> So I believe we cannot simply change the default JDK version to 11 as you proposed in https://github.com/apache/incubator-uniffle/pull/683. However, it's always possible to build rss-server with alternative JDK 11 based images.

Yes, we don’t directly drop java8. But we’d better to recommend using java11 or higher version, especially for shuffle server and avoid performance issues for users. 

Maybe this should be underlined in the readme.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WuvcL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WuzgM,incubator-uniffle,1455110156,674,NA,advancedxy,807537,,,NA,2023-03-05T14:38:08Z,2023-03-05T14:38:08Z,"> I don’t apply any param turning

Could you do some gc parameter turning if possible since we are going to use Java 1.8 for a long time?

> Yes, we don’t directly drop java8. But we’d better to recommend using java11 or higher version, especially for shuffle server and avoid performance issues for users.
Maybe this should be underlined in the readme.

I'm fine for promoting Java 11 use especially for shuffle server without HDFS storage used.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WuzgM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XCPox,incubator-uniffle,1460206129,674,NA,advancedxy,807537,,,NA,2023-03-08T14:05:27Z,2023-03-08T14:05:27Z,"It occurred to me that Uniffle only uses hdfs client, It might be possible to use JDK 11 to run 3.x hadoop's hdfs client. 

But I didn't see any article about this setup... 😭 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XCPox/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XF23U,incubator-uniffle,1461153236,674,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-09T02:00:41Z,2023-03-09T02:00:41Z,"> It occurred to me that Uniffle only uses hdfs client, It might be possible to use JDK 11 to run 3.x hadoop's hdfs client.
> 
> But I didn't see any article about this setup... 😭

I have upgraded to JDK11 in uniffle shuffle-server, and it works well with 3.1.1 hdfs client. 

And I have tested the JAVA17, but it failed due to kerberos.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XF23U/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XF3H7,incubator-uniffle,1461154299,674,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-09T02:02:06Z,2023-03-09T02:02:06Z,"JDK11 has been supported in hadoop 3.3.3, refer to: https://issues.apache.org/jira/browse/HADOOP-15338","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XF3H7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGHF_,incubator-uniffle,1461219711,674,NA,advancedxy,807537,,,NA,2023-03-09T03:38:02Z,2023-03-09T03:38:02Z,"> JDK11 has been supported in hadoop 3.3.3, refer to: https://issues.apache.org/jira/browse/HADOOP-15338

Yeah, I know.  But Hadoop 3.3.3 was released about one year ago which means it wasn't widely adopted or used.

> I have upgraded to JDK11 in uniffle shuffle-server, and it works well with 3.1.1 hdfs client.

This is good news. is it pretty smooth that not even configuration changes are needed? Or we need to do some tricks to make it work?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGHF_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGO0s,incubator-uniffle,1461251372,674,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-09T04:13:18Z,2023-03-09T04:13:18Z,"> This is good news. is it pretty smooth that not even configuration changes are needed? Or we need to do some tricks to make it work?

Nothing is needed to change.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGO0s/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XIF-W,incubator-uniffle,1461739414,674,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-09T10:20:44Z,2023-03-09T10:20:44Z,"Share some performance test thoughts about using the point-point tests to find performance problems.
1. For this case, I wrote a spark job to directly create some mock data to write to single shuffle-server by using `ShuffleServerGrpcClient` directly, rather than leveraging spark own shuffle mechanism, which has too long process.

I think some important features or improvements could be tested by above way, this is more controllable.

 WDYT? @advancedxy  
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XIF-W/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/674,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hEtVn,incubator-uniffle,1628624231,674,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-10T09:57:01Z,2023-07-10T09:57:01Z,Mark this as a good first issue. Feel free to pick up!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hEtVn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/675,https://api.github.com/repos/apache/incubator-uniffle/issues/675,incubator-uniffle,1606619050,675,[Bug] StorageInfo isCorrupted state can't turn into true by LocalStorageChecker mark corrupted ,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2023-03-02T11:21:05Z,2023-03-03T12:16:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

 LocalStorageChecker checker storage can't be write when storage disk full LocalStorageChecker checker storage unhealthy,and mark storage is corrupted. the storage can not be used never, although the disk space release in future.
 
[https://github.com/apache/incubator-uniffle/blob/master/server/src/main/java/org/apache/uniffle/server/LocalStorageChecker.java](url)

```    for (StorageInfo storageInfo : storageInfos) {
      if (!storageInfo.checkStorageReadAndWrite()) {
        storageInfo.markCorrupted();
        corruptedDirs++;
        continue;
      }
```

fix code may like blow :
```    for (StorageInfo storageInfo : storageInfos) {
      if (!storageInfo.checkStorageReadAndWrite()) {
        storageInfo.markCorrupted(true);
        corruptedDirs++;
        continue;
      }else{
        storageInfo.markCorrupted(false);
      }
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/675/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/675,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wh3XB,incubator-uniffle,1451718081,675,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-02T11:28:10Z,2023-03-02T11:28:10Z,"If the disk have bad tracks, it may cause that we write successfully sometimes, it write unsuccessffully. So we don't turn the disk to uncorrupted although the disk can write successfully.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wh3XB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/675,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WmbGZ,incubator-uniffle,1452913049,675,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-03-03T03:35:17Z,2023-03-03T03:35:17Z,agree.. disk space enough should be avioded in check storage read and write. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WmbGZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/678,https://api.github.com/repos/apache/incubator-uniffle/issues/678,incubator-uniffle,1608130947,678,[Improvement] Write hdfs files asynchronously when `detectStorage`,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2023-03-03T07:56:27Z,2023-03-06T08:51:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Write files to hdfs asynchronously.

### How should we improve?

Reduce the time of `detectStorage`



### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/678/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/679,https://api.github.com/repos/apache/incubator-uniffle/issues/679,incubator-uniffle,1608209969,679,[Improvement] [coordinator]dynamic assign strategy server num by shuffle partition num,xumanbu,9135743,xumanbu,manbu.feng@163.com,OPEN,2023-03-03T08:54:54Z,2023-03-11T13:06:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

assgin shuffle server num by shuffle partition num.  
[PartitionBalanceAssignmentStrategy.java](https://github.com/apache/incubator-uniffle/blob/master/coordinator/src/main/java/org/apache/uniffle/coordinator/strategy/assignment/PartitionBalanceAssignmentStrategy.java)

### How should we improve?

_No response_

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/679/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/679,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wtmhj,incubator-uniffle,1454794851,679,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-04T16:29:50Z,2023-03-04T16:29:50Z,We have similar mechism. You can extract an attraction and add your strategy. You can see that https://github.com/apache/incubator-uniffle/pull/322,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wtmhj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/681,https://api.github.com/repos/apache/incubator-uniffle/issues/681,incubator-uniffle,1608229204,681,[FEATURE] collect shuffle server storage usage by appllication_id for troubleshooting  ,xumanbu,9135743,xumanbu,manbu.feng@163.com,OPEN,2023-03-03T09:07:51Z,2023-03-11T13:06:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

How do we know each app shuffle data in shuffle server? I think wo need collect shuffle server storage usage by appllication_id

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/681/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/681,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wnj-o,incubator-uniffle,1453211560,681,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-03T09:14:27Z,2023-03-03T09:14:27Z,"+1. These meta info has been included in `ShuffleTaskInfo`, we just need to expose them to metrics or other ways.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wnj-o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/681,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wtly1,incubator-uniffle,1454791861,681,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-04T16:20:13Z,2023-03-04T16:20:13Z,It's ok for me. @zuston could help you review this pr.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wtly1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/681,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wuzk0,incubator-uniffle,1455110452,681,NA,advancedxy,807537,,,NA,2023-03-05T14:39:15Z,2023-03-05T14:39:15Z,"> +1. These meta info has been included in `ShuffleTaskInfo`, we just need to expose them to metrics or other ways.

I think an app_id label for each related metrics is a good way to go.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wuzk0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/682,https://api.github.com/repos/apache/incubator-uniffle/issues/682,incubator-uniffle,1608267118,682,[Improvement] a backpressure limiter for shuffle client send data ,xumanbu,9135743,xumanbu,manbu.feng@163.com,OPEN,2023-03-03T09:32:04Z,2023-03-11T13:06:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

in our production daily operation, a server is often oom crash case by traffic too high.in order to protect shuffle server,   add client send data limiter may be is a good solution.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/682/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/682,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wnve4,incubator-uniffle,1453258680,682,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-03T09:52:13Z,2023-03-03T09:52:13Z,"Could you help describe more that there is already a mechanism of requiring buffer before sending data, why the problem you mentioned happen?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wnve4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/682,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WtmVw,incubator-uniffle,1454794096,682,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-04T16:27:45Z,2023-03-04T16:27:45Z,"Do you mean `com.netflix.concurrency-limits`? We have ever a try, but it don't take effect.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WtmVw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/685,https://api.github.com/repos/apache/incubator-uniffle/issues/685,incubator-uniffle,1609745002,685,[Bug]  Probloms of `RequireUpperBoundDeps`,xianjingfeng,11752250,,,CLOSED,2023-03-04T12:00:09Z,2023-12-05T07:13:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The following message is output after executing  ./build_distribution.sh

```
[WARNING] Rule 0: org.apache.maven.plugins.enforcer.RequireUpperBoundDeps failed with message:
Failed while enforcing RequireUpperBoundDeps. The error(s) are [
Require upper bound dependencies error for com.google.protobuf:protobuf-java:3.19.2 paths to dependency are:
+-org.apache.uniffle:rss-integration-common-test:0.8.0-SNAPSHOT
  +-org.apache.uniffle:shuffle-server:0.8.0-SNAPSHOT
    +-io.grpc:grpc-protobuf:1.47.0
      +-com.google.protobuf:protobuf-java:3.19.2
and
+-org.apache.uniffle:rss-integration-common-test:0.8.0-SNAPSHOT
  +-org.apache.uniffle:rss-common:0.8.0-SNAPSHOT
    +-org.apache.uniffle:rss-proto:0.8.0-SNAPSHOT
      +-com.google.protobuf:protobuf-java-util:3.19.6
        +-com.google.protobuf:protobuf-java:3.19.6
and
+-org.apache.uniffle:rss-integration-common-test:0.8.0-SNAPSHOT
  +-org.apache.uniffle:shuffle-server:0.8.0-SNAPSHOT
    +-io.grpc:grpc-protobuf:1.47.0
      +-com.google.api.grpc:proto-google-common-protos:2.0.1
        +-com.google.protobuf:protobuf-java:3.13.0
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/685/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/685,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WtTjn,incubator-uniffle,1454717159,685,NA,xianjingfeng,11752250,,,NA,2023-03-04T12:04:07Z,2023-03-04T12:04:07Z,Would you help to fix this problom? @kaijchen  And i think workflow should cover this case.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WtTjn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/685,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wtf3K,incubator-uniffle,1454767562,685,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-04T15:00:59Z,2023-03-04T15:00:59Z,"> Would you help to fix this problom? @kaijchen And i think workflow should cover this case.

I have no problem building it. Please run `maven clean` and remove anything in `~/.m2/repository/org/apache/uniffle/`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Wtf3K/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/685,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WuR7h,incubator-uniffle,1454972641,685,NA,xianjingfeng,11752250,,,NA,2023-03-05T03:02:23Z,2023-03-05T03:02:23Z,"> > Would you help to fix this problom? @kaijchen And i think workflow should cover this case.
> 
> I have no problem building it. Please run `maven clean` and remove anything in `~/.m2/repository/org/apache/uniffle/`

I just tried it, the problem still exists. Could it be a maven version issue?
Maven version: 3.6.1","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WuR7h/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/685,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WubXP,incubator-uniffle,1455011279,685,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-05T07:18:06Z,2023-03-05T07:18:06Z,"> I just tried it, the problem still exists. Could it be a maven version issue?
> Maven version: 3.6.1

I'm using maven 3.6.3.
Full build log: https://paste.ubuntu.com/p/YSzJyCCs3B/","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5WubXP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/685,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YcVRM,incubator-uniffle,1483822156,685,NA,xianjingfeng,11752250,,,NA,2023-03-25T13:21:01Z,2023-03-25T13:21:01Z,"I have try different devices and different maven version, but neither work. I had to modify the dependency file.
Is it just me having this problem? 😂  cc @jerqi @zuston @advancedxy  @smallzhongfeng
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YcVRM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/685,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YdM2l,incubator-uniffle,1484049829,685,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-26T10:04:10Z,2023-03-26T10:04:10Z,I encounter the same problem with maven 3.6.1. It's ok for me to use 3.6.3.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YdM2l/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/685,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YhF7R,incubator-uniffle,1485070033,685,NA,xianjingfeng,11752250,,,NA,2023-03-27T13:03:34Z,2023-03-27T13:03:34Z,"> I encounter the same problem with maven 3.6.1. It's ok for me to use 3.6.3.

3.6.3 does work now, but 3.3.9 and 3.6.1 don't. It seems that versions below 3.6 have this problem. Should we fix this issue? Just modify dependency file.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YhF7R/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/685,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YhM1j,incubator-uniffle,1485098339,685,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-27T13:31:51Z,2023-03-27T13:31:51Z,We can use a maven wrapper.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YhM1j/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/691,https://api.github.com/repos/apache/incubator-uniffle/issues/691,incubator-uniffle,1613518635,691,[Flaky Test] CoordinatorMetricsTest#testCoordinatorMetrics  ,xianjingfeng,11752250,,,CLOSED,2023-03-07T13:56:43Z,2023-03-09T03:56:03Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test
```
Error:  Tests run: 4, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 1.421 s <<< FAILURE! - in org.apache.uniffle.coordinator.metric.CoordinatorMetricsTest
Error:  testCoordinatorMetrics  Time elapsed: 0.019 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <10> but was: <12>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:527)
	at org.apache.uniffle.coordinator.metric.CoordinatorMetricsTest.testCoordinatorMetrics(CoordinatorMetricsTest.java:92)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
```
### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4354707689/jobs/7610349067

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/691/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/691,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5W-f1o,incubator-uniffle,1459223912,691,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-03-08T02:50:56Z,2023-03-08T02:50:56Z,"This may be caused by the added indicators of 
```
app_num{user_name=""user3"",} 1.0
app_num{user_name=""user4"",} 2.0
```
Here I think quota should be turned off first in the indicator detection ut.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5W-f1o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/691,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5W-gHT,incubator-uniffle,1459225043,691,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-03-08T02:51:38Z,2023-03-08T02:51:38Z,Let me fix it. : -),"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5W-gHT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/695,https://api.github.com/repos/apache/incubator-uniffle/issues/695,incubator-uniffle,1614727506,695,[Improvement] Huge partition optimization on local disk,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-03-08T06:27:11Z,2023-04-04T00:10:17Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In #378, we have discussed the huge partition problems. And the final solution is to make it flush to HDFS directly and limit memory usage. 

But for some users only using `MEMORY_LOCALFILE` storage type, it's useless. So this issue is to track the huge partition optimization on local disk.


### How should we improve?

## SubTasks
1. Support flushing single partition to multiple disks
2. Support pluggable local disk selection strategy
3. Support dynamic assignment of shuffle server, especially when the disk of server is full
4. ...

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/695/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/695,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5W_-ln,incubator-uniffle,1459612007,695,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-08T06:29:20Z,2023-03-08T06:29:20Z,"We could use more MEMORY_LOCALFILE_HDFS, HDFS have more capacity to process the problems.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5W_-ln/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/695,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGAE2,incubator-uniffle,1461190966,695,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-09T02:53:50Z,2023-03-09T02:53:50Z,"> We could use more MEMORY_LOCALFILE_HDFS, HDFS have more capacity to process the problems.

Yes, I think so. But users like VIP shop hope this optimization could be applied in local disk. Could you help ping? Let's discuss more.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGAE2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/695,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGAeB,incubator-uniffle,1461192577,695,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-09T02:56:25Z,2023-03-09T02:56:25Z,@xumanbu @Gustfh,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGAeB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/695,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZFG3D,incubator-uniffle,1494511043,695,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-04-03T15:12:24Z,2023-04-03T15:12:24Z,"> > We could use more MEMORY_LOCALFILE_HDFS, HDFS have more capacity to process the problems.
> 
> Yes, I think so. But users like VIP shop hope this optimization could be applied in local disk. Could you help ping? Let's discuss more.

use hdfs can solve capacity issues, but hdfs write rate is slower than ssd, the memory will be full quickly in large data written. 
in my mind if we use hdfs storage,uniffle client should have backpressure to limit client write rate.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZFG3D/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/695,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZHkRd,incubator-uniffle,1495155805,695,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-04T00:10:16Z,2023-04-04T00:10:16Z,"> > > We could use more MEMORY_LOCALFILE_HDFS, HDFS have more capacity to process the problems.
> > 
> > 
> > Yes, I think so. But users like VIP shop hope this optimization could be applied in local disk. Could you help ping? Let's discuss more.
> 
> use hdfs can solve capacity issues, but hdfs write rate is slower than ssd, the memory will be full quickly in large data written. in my mind if we use hdfs storage,uniffle client should have backpressure to limit client write rate.

Yes, it does. Please see https://github.com/apache/incubator-uniffle/blob/master/docs/server_guide.md#huge-partition-optimization","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZHkRd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/697,https://api.github.com/repos/apache/incubator-uniffle/issues/697,incubator-uniffle,1615010708,697,[Bug] NoClassDefFoundError: org/apache/directory/api/util/Strings in DefaultStorageMediaProvider,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-03-08T10:10:11Z,2023-03-08T10:58:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

NoClassDefFoundError: org/apache/directory/api/util/Strings in DefaultStorageMediaProvider

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/697/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/701,https://api.github.com/repos/apache/incubator-uniffle/issues/701,incubator-uniffle,1616338094,701,[Flaky Test] ShuffleServerFaultToleranceTest#testReadFaultTolerance,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2023-03-09T03:31:25Z,2023-03-09T03:40:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1.014 s <<< FAILURE! - in org.apache.uniffle.test.ShuffleServerFaultToleranceTest
Error:  testReadFaultTolerance  Time elapsed: 0.222 s  <<< ERROR!
java.lang.NullPointerException
	at org.apache.uniffle.client.TestUtils.validateResult(TestUtils.java:66)
	at org.apache.uniffle.test.ShuffleServerFaultToleranceTest.testReadFaultTolerance(ShuffleServerFaultToleranceTest.java:125)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:[725](https://github.com/apache/incubator-uniffle/actions/runs/4370690355/jobs/7645845268#step:6:726))
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4370690355/jobs/7645845268

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/701/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/701,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGGfn,incubator-uniffle,1461217255,701,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-03-09T03:33:49Z,2023-03-09T03:33:49Z,This ut failure occurs frequently. PTAL @jerqi @kaijchen ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGGfn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/701,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGHXe,incubator-uniffle,1461220830,701,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-09T03:39:49Z,2023-03-09T03:39:49Z,"duplicated with #483, closing this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XGHXe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/706,https://api.github.com/repos/apache/incubator-uniffle/issues/706,incubator-uniffle,1618673364,706,[Improvement] Fine-grained memory control for spark client,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-03-10T09:53:00Z,2023-03-28T11:02:49Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

1. #714 
2. Introduce dedicated `memoryConsumer` when fetching remote data, especially for after supporting async read. #291 
3. ...

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/706/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/706,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPAUY,incubator-uniffle,1463551256,706,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-10T09:54:57Z,2023-03-10T09:54:57Z,"And I also find that some apps in our production failed due to requiring memory failed, but it works well with ESS, although the available memory is less in ESS.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPAUY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/706,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPB5U,incubator-uniffle,1463557716,706,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-10T09:59:30Z,2023-03-10T09:59:30Z,cc @jerqi @advancedxy ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPB5U/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/706,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPDps,incubator-uniffle,1463564908,706,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-10T10:04:09Z,2023-03-10T10:04:09Z,Ok for me.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPDps/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/706,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPFNW,incubator-uniffle,1463571286,706,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-10T10:08:34Z,2023-03-10T10:08:34Z,"> And I also find that some apps in our production failed due to requiring memory failed, but it works well with ESS, although the available memory is less in ESS.

And the available memory is tight, could we support append record to temp files and at the final step, send them to remote shuffle-server, rather than using memory to hold them.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XPFNW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/708,https://api.github.com/repos/apache/incubator-uniffle/issues/708,incubator-uniffle,1618876724,708,"[Flaky Test] ShuffleKerberizedHdfsStorageUtilsTest failed when hostname is not ""localhost""",kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-03-10T12:07:22Z,2023-03-10T13:52:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 7.856 s <<< FAILURE! - in org.apache.uniffle.storage.util.ShuffleKerberizedHdfsStorageUtilsTest
[ERROR] testUploadFile{File}  Time elapsed: 0.044 s  <<< ERROR!
java.lang.IllegalArgumentException: Wrong FS: hdfs://localhost:40981/test, expected: hdfs://devcloud:40981
	at org.apache.hadoop.fs.FileSystem.checkPath(FileSystem.java:665)
	at org.apache.hadoop.hdfs.DistributedFileSystem.getPathName(DistributedFileSystem.java:214)
	at org.apache.hadoop.hdfs.DistributedFileSystem$27.doCall(DistributedFileSystem.java:1440)
	at org.apache.hadoop.hdfs.DistributedFileSystem$27.doCall(DistributedFileSystem.java:1437)
	at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)
	at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:1437)
	at org.apache.hadoop.fs.FileSystem.isFile(FileSystem.java:1463)
	at org.apache.uniffle.storage.handler.impl.HdfsFileWriter.initStream(HdfsFileWriter.java:59)
	at org.apache.uniffle.storage.handler.impl.HdfsFileWriter.<init>(HdfsFileWriter.java:54)
	at org.apache.uniffle.storage.util.ShuffleHdfsStorageUtilsTest.createAndRunCases(ShuffleHdfsStorageUtilsTest.java:57)
	at org.apache.uniffle.storage.util.ShuffleKerberizedHdfsStorageUtilsTest.testUploadFile(ShuffleKerberizedHdfsStorageUtilsTest.java:39)
```

### Actions URL

Run locally

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/708/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/711,https://api.github.com/repos/apache/incubator-uniffle/issues/711,incubator-uniffle,1619932082,711,[Subtask] [Netty] Add Netty port information for Shuffle Server,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-03-11T08:33:38Z,2023-03-15T11:38:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Shuffle Server need an extra port for Netty Server to use, We need to add it.

### Parent issue

#133

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/711/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/715,https://api.github.com/repos/apache/incubator-uniffle/issues/715,incubator-uniffle,1621080702,715,[Bug] problems of RssMapOutputCollector,zhaobing001,34642138,zhaobing,,CLOSED,2023-03-13T09:32:36Z,2023-05-19T06:50:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The connection between the client and shufflerserver is not closed. As a result, the maptask container does not exit.
1.map container does not exit when reduce is running
2.When cluster resources are used up and some maps are not allocated, am waits for a one-minute timeout, kills the completed map container, and allocates resources to other maps

error log like:
2023-03-11 02:42:16,826 INFO [Ping Checker] org.apache.hadoop.yarn.util.AbstractLivelinessMonitor: Expired:attempt_1676901654399_1531374_m_000190_0 Timed out after 60 secs

In the close method of the RssMapOutputCollector, closing the shuffle client solves this problem



### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/715/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/715,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XYC-k,incubator-uniffle,1465921444,715,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-13T10:57:51Z,2023-03-13T10:57:51Z,Is it an occasional case?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XYC-k/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/715,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XYePW,incubator-uniffle,1466033110,715,NA,zhaobing001,34642138,zhaobing,,NA,2023-03-13T12:13:06Z,2023-03-13T12:13:06Z,"> 

An inevitable case","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XYePW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/715,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XYero,incubator-uniffle,1466034920,715,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-13T12:14:16Z,2023-03-13T12:14:16Z,Could you raise a pr to fix this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XYero/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/715,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5coYff,incubator-uniffle,1554089951,715,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-19T06:50:08Z,2023-05-19T06:50:08Z,closed by #882,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5coYff/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/716,https://api.github.com/repos/apache/incubator-uniffle/issues/716,incubator-uniffle,1623117678,716,[Improvement] Need support for imagePullSecrets while applying full-restart full-upgrade or deploying coordinator or shuffle server,vinayakmalik95,18426293,Vinayak Malik,,CLOSED,2023-03-14T09:55:46Z,2023-03-28T02:04:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

while applying the webhook.yaml under the Kind: Deployment

I can use imagePullSecrets
example:

kind: Deployment
apiVersion: apps/v1
metadata:
name: rss-webhook
namespace: rss-system
spec:
strategy:
rollingUpdate:
maxSurge: 1
maxUnavailable: 2
type: RollingUpdate
selector:
matchLabels:
app: rss-webhook
replicas: 1
template:
metadata:
labels:
app: rss-webhook
service: rss-webhook
spec:
serviceAccountName: rss-webhook
containers:
- name: rss-webhook
image: xyz/rss-webhook:0.8.0-SNAPSHOT
command:
- ""./webhook""
args:
- ""--ignore-rss=false""
- ""--v=4""
ports:
- containerPort: 9876
protocol: TCP
imagePullPolicy: ""Always""
env:
- name: POD_NAME
valueFrom:
fieldRef:
apiVersion: v1
fieldPath: metadata.name
- name: POD_NAMESPACE
valueFrom:
fieldRef:
apiVersion: v1
fieldPath: metadata.namespace
- name: NODE_NAME
valueFrom:
fieldRef:
fieldPath: spec.nodeName
resources:
requests:
cpu: 500m
memory: 1024Mi
**imagePullSecrets:**
- name: container-registry
tolerations:
- effect: NoSchedule
key: node-role.kubernetes.io/master
affinity:
podAntiAffinity:
requiredDuringSchedulingIgnoredDuringExecution:
- labelSelector:
matchExpressions:
- key: app
operator: In
values:
- rss-webhook
topologyKey: kubernetes.io/hostname

**But while applying the full-upgrade or applying coordinator or shuffleServer there is no support of imagePullSecrets.**

apiVersion: uniffle.apache.org/v1alpha1
kind: RemoteShuffleService
metadata:
name: rss-full-upgrade-demo
namespace: rss-system
spec:
configMapName: rss-configuration
coordinator:
image: rss-server:0.8.0
initContainerImage: ""busybox:latest""
rpcNodePort:
- 30001
- 30011
httpNodePort:
- 30002
- 30012
xmxSize: ""2G""
count: 2
configDir: ""/data/rssadmin/rss/conf""
replicas: 1
excludeNodesFilePath: ""/data/rssadmin/rss/coo/exclude_nodes""
securityContext:
runAsUser: 1000
fsGroup: 1000
logHostPath: ""/data/logs/rss/coordinator""
hostPathMounts:
/data/logs/rss/coordinator: /data/rssadmin/rss/logs
shuffleServer:
sync: true
replicas: 3
image: rss-server:0.8.0-SNAPSHOT
initContainerImage: ""busybox:latest""
upgradeStrategy:
type: ""FullUpgrade""
xmxSize: ""2G""
configDir: ""/data/rssadmin/rss/conf""
securityContext:
runAsUser: 1000
fsGroup: 1000
logHostPath: ""/data/logs/rss/shuffle-server""
hostPathMounts:
/data/logs/rss/shuffle-server: /data/rssadmin/rss/logs
/data/rssenv1/rssdata1: /data1
/data/rssenv1/rssdata2: /data2
/data/rssenv1/rssdata3: /data3

### How should we improve?

giving support of imagePullSecrets in the CRD of uniffleremoteshuffleservices

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/716/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/716,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XfGBH,incubator-uniffle,1467768903,716,NA,vinayakmalik95,18426293,Vinayak Malik,,NA,2023-03-14T09:56:18Z,2023-03-14T09:56:18Z,"@wangao1236  @jerqi please find the details above.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XfGBH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/719,https://api.github.com/repos/apache/incubator-uniffle/issues/719,incubator-uniffle,1623716563,719,[Subtask] [Netty] Optimize allocation strategy,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-03-14T15:26:25Z,2023-03-20T14:11:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

When we use Netty servers., there are Netty servers and Grpc servers at the same time at first in our production. We should allocate different servers to client according to ClientType. We allocate Netty servers to `GrpcNetty` client. We allocate Grpc servers to `Grpc` client.

### Parent issue

#133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/719/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/719,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XhL1M,incubator-uniffle,1468317004,719,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-14T15:26:43Z,2023-03-14T15:26:43Z,@smallzhongfeng Could you help solve this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XhL1M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/719,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkh4y,incubator-uniffle,1469193778,719,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-03-15T02:16:00Z,2023-03-15T02:16:00Z,"So future servers only need to reserve one port, right ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkh4y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/719,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XkiUo,incubator-uniffle,1469195560,719,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-15T02:18:27Z,2023-03-15T02:18:27Z,"> So future servers only need to reserve one port, right ?

They will reserve two ports. But if we enable Netty, we will only use Netty to transfer data. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XkiUo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/720,https://api.github.com/repos/apache/incubator-uniffle/issues/720,incubator-uniffle,1623720002,720,[Subtask] [Netty] Support random port,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-03-14T15:28:16Z,2023-04-03T15:16:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

For Grpc server and Netty server, when we set the port to zero. we should bind a available random port.

### Parent issue

#133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/720/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/720,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XhMsX,incubator-uniffle,1468320535,720,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-14T15:28:53Z,2023-03-14T15:28:53Z,@xumanbu Could you help solve this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XhMsX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/720,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkp91,incubator-uniffle,1469226869,720,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-03-15T02:48:49Z,2023-03-15T02:48:49Z,"ok,let me try. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkp91/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/720,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xksux,incubator-uniffle,1469238193,720,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-03-15T03:01:51Z,2023-03-15T03:01:51Z,"I think the random port will be generated in one interval range in [ 50000~59999], and avoid the port that are already in use.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xksux/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/720,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkynr,incubator-uniffle,1469262315,720,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-15T03:31:26Z,2023-03-15T03:31:26Z,"> I think the random port will be generated in one interval range in [ 49152~65535], and avoid the port that are already in use.

Make sense. It's ok to specify the port range. But we should also support not to specify the port range.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xkynr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/722,https://api.github.com/repos/apache/incubator-uniffle/issues/722,incubator-uniffle,1624880061,722,[Umbrella] Cleanup residue files in tmp directory after tests,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-03-15T07:00:57Z,2023-08-21T11:34:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

There are many residue files in tmp directory after tests.
Sometimes it will cause issues in repeated tests or parallel tests.
We can use JUnit 5 managed `@TempDir` to replace `Files.createTempDirectory()`.

```console
$ mvn clean package -Pspark3
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  21:06 min
[INFO] Finished at: 2023-03-15T14:36:19+08:00
[INFO] ------------------------------------------------------------------------
$ find | grep '/target/tmp/'
./integration-test/spark-common/target/tmp/dynamicConf5843229430228465171conf
./integration-test/spark-common/target/tmp/rss62430369913332225
./integration-test/spark-common/target/tmp/dynamicConf6147274175500176169conf
./integration-test/spark-common/target/tmp/dynamicConf4208328593701611930conf
./integration-test/spark-common/target/tmp/rss562630552492365514
./integration-test/spark-common/target/tmp/rss46277087768255567
./integration-test/spark-common/target/tmp/dynamicConf1817755823767020171conf
./integration-test/spark-common/target/tmp/rss8341883984735558073
./integration-test/spark-common/target/tmp/dynamicConf8701841393224148370conf
./integration-test/spark-common/target/tmp/rss1030728888778640567
./integration-test/spark-common/target/tmp/dynamicConf5751228400475518214conf
./integration-test/spark-common/target/tmp/dynamicConf919596028861517530conf
./integration-test/spark-common/target/tmp/dynamicConf2112348039475291387conf
./integration-test/spark-common/target/tmp/dynamicConf8968200515884439551conf
./integration-test/spark-common/target/tmp/spark-1b6fb52c-382a-4666-a743-01fe376a9da3
./integration-test/spark-common/target/tmp/dynamicConf3642606138147557145conf
./integration-test/spark-common/target/tmp/dynamicConf7764795188572170812conf
./integration-test/spark-common/target/tmp/rss1340437940162131196
./integration-test/spark3/target/tmp/rssdata4683867891894737544
./integration-test/spark3/target/tmp/rssdata4683867891894737544/local-1678862145522_1678862145477
./integration-test/spark3/target/tmp/rssdata4683867891894737544/local-1678862145522_1678862145477/1
./integration-test/spark3/target/tmp/rssdata4683867891894737544/local-1678862145522_1678862145477/1/92-92
./integration-test/spark3/target/tmp/rssdata4683867891894737544/local-1678862145522_1678862145477/1/92-92/9.134.131.52-20001.data
./integration-test/spark3/target/tmp/rssdata4683867891894737544/local-1678862145522_1678862145477/1/92-92/9.134.131.52-20001.index
...
./integration-test/spark3/target/tmp/rssdata4683867891894737544/local-1678862145522_1678862145477/0/6-6
./integration-test/spark3/target/tmp/rssdata4683867891894737544/local-1678862145522_1678862145477/0/6-6/9.134.131.52-20001.data
./integration-test/spark3/target/tmp/rssdata4683867891894737544/local-1678862145522_1678862145477/0/6-6/9.134.131.52-20001.index
./integration-test/spark3/target/tmp/dynamicConf4726090287767810753conf
./integration-test/spark3/target/tmp/dynamicConf7395142600914379199conf
./integration-test/spark3/target/tmp/dynamicConf5485162686795986256conf
./integration-test/spark3/target/tmp/spark-43b4179d-9940-4625-a2bf-f87bbe86ccbb
./storage/target/tmp/dummy-data-file7618350169586815030.index
./storage/target/tmp/dummy-data-file1719959362551363828.data
./client-spark/spark3/target/tmp/spark-18439b64-6f95-49ed-98b9-46053929202e
./server/target/tmp/removeShuffleDataWithLocalfileTest8262825757764355506
./server/target/tmp/removeShuffleDataWithLocalfileTest8262825757764355506/removeShuffleDataWithLocalfileTest
./server/target/tmp/removeShuffleDataWithLocalfileTest5796962123722765961
./server/target/tmp/removeShuffleDataWithLocalfileTest5796962123722765961/removeShuffleDataWithLocalfileTest
./common/target/tmp/rss3072326445112259054
```

### Task list

- [ ] residue files of unit tests
- [ ] residue files of spark3 integration tests
- [ ] residue files of spark2 integration tests
- [ ] residue files of mr integration tests

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/722/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/729,https://api.github.com/repos/apache/incubator-uniffle/issues/729,incubator-uniffle,1626829090,729,[Improvement] Use foreach when iterate over Roaring64NavigableMap for better performance ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-03-16T06:50:12Z,2023-03-17T07:32:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Use foreach when iterate over Roaring64NavigableMap for better performance, refer https://github.com/RoaringBitmap/RoaringBitmap/issues/44

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/729/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/729,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0LgP,incubator-uniffle,1473296399,729,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-17T07:32:55Z,2023-03-17T07:32:55Z,Done #730 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0LgP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/731,incubator-uniffle,1626907833,731,[FEATURE] Adaptive length of different parts of blockId ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-03-16T07:55:07Z,2024-03-07T07:21:03Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

I found some problems about BlockID in production env.
1. Due to too much iterations, some apps' (like XGBoost training using Spark) taskAttempt ID is large, which means the fixed length of 21 is not enough.
2. Due to above problem, I increase the TASK_ATTEMPT_ID_MAX_LENGTH to 23 and decrease the MAX_SEQUENCE_NO to 6. Pity, I found some apps will fail due to the exceeding the  MAX_SEQUENCE_NO range.

### Under the hood of `BLOCKID` construction

BlockID will be created by 3 parts, including partitionId, taskAttemptId and sequenceNumber. If using the fixed length for every part, it's hard to be adapt with different applications.

So why not using the adaptive length of different parts of blockId? As we know, the partition number has been determinated before writing. That means we could adjust the rest 2 parts' length according to the partition number dynamically. 

BTW, another solution is to decrease the MAX partitionID length, the default value of 24 is too large.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/731/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xtg4j,incubator-uniffle,1471548963,731,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-16T08:56:54Z,2023-03-16T08:56:54Z,"If we  increase `TASK_ATTEMPT_ID_MAX_LENGTH`, it will cause more GC.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xtg4j/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xtkx_,incubator-uniffle,1471564927,731,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-16T09:07:49Z,2023-03-16T09:07:49Z,"> If we increase `TASK_ATTEMPT_ID_MAX_LENGTH`, it will cause more GC.

why","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xtkx_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xtlaq,incubator-uniffle,1471567530,731,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-16T09:09:28Z,2023-03-16T09:09:28Z,"> > If we increase `TASK_ATTEMPT_ID_MAX_LENGTH`, it will cause more GC.
> 
> why

Because the implement of Roaringbitmap. If we increase the length of `TASK_ATTEMPT_ID_MAX_LENGTH`, it will occupy more memory.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xtlaq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xtm3Q,incubator-uniffle,1471573456,731,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-16T09:13:37Z,2023-03-16T09:13:37Z,"Sorry, I can’t get your thought. Could you help give a link of roaringbitmap about this?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xtm3Q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XttRD,incubator-uniffle,1471599683,731,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-16T09:32:30Z,2023-03-16T09:32:30Z,You can see https://arxiv.org/pdf/1402.6407.pdf . ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XttRD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xt4Wb,incubator-uniffle,1471645083,731,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-16T10:00:38Z,2023-03-16T10:00:38Z,"> You can see https://arxiv.org/pdf/1402.6407.pdf .

Thanks. Let me take a look later. 

And for this problem, how about decreasing partitionMaxLen to 20 by default, and the reduced length is given to seqNo?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Xt4Wb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XuDc0,incubator-uniffle,1471690548,731,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-16T10:29:39Z,2023-03-16T10:29:39Z,"> > You can see https://arxiv.org/pdf/1402.6407.pdf .
> 
> Thanks. Let me take a look later.
> 
> And for this problem, how about decreasing partitionMaxLen to 20 by default, and the reduced length is given to seqNo?

Maybe, we should have more discussion about this problem.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5XuDc0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0cjn,incubator-uniffle,1473366247,731,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-17T08:18:34Z,2023-03-17T08:18:34Z,"BTW, if we could make this length as a client side config, this will more flexible. WDYT? @jerqi . ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0cjn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0hZL,incubator-uniffle,1473386059,731,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-17T08:29:01Z,2023-03-17T08:29:01Z,Make sense.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0hZL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aOvKI,incubator-uniffle,1513812616,731,NA,awdavidson,54780428,,,NA,2023-04-18T21:25:17Z,2023-04-18T21:25:17Z,"I think there needs to be a better solution for this problem? Currently, this limitation prevents large scale and iterative applications from using uniffle as we have an upper limit of approximately 1.2m tasks across the entire application because the `taskAttemptId` is being used.

What’s the feasibility of using a combination of the `stageId` and `taskId`? What else can be done?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aOvKI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aVo5q,incubator-uniffle,1515621994,731,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-20T02:25:49Z,2023-04-20T02:25:49Z,"@awdavidson 

In PR #749, @advancedxy propose a new possibility to solving this. refer https://github.com/apache/incubator-uniffle/pull/749#issuecomment-1486540366

But for my thought, it sounds good to me. But in the current codebase, the taskAttemptId must be a real value, some code will retrieve this from this blockId and do some validation. I'm not sure whether removing this part or optimize.

> What’s the feasibility of using a combination of the stageId and taskId? What else can be done?

I'm not sure what do you mean.  Could you help describe more?

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aVo5q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aWlWP,incubator-uniffle,1515869583,731,NA,awdavidson,54780428,,,NA,2023-04-20T07:42:11Z,2023-04-20T07:42:11Z,"> @awdavidson
> 
> In PR #749, @advancedxy propose a new possibility to solving this. refer [#749 (comment)](https://github.com/apache/incubator-uniffle/pull/749#issuecomment-1486540366)
> 
> But for my thought, it sounds good to me. But in the current codebase, the taskAttemptId must be a real value, some code will retrieve this from this blockId and do some validation. I'm not sure whether removing this part or optimize.
> 
> > What’s the feasibility of using a combination of the stageId and taskId? What else can be done?
> 
> I'm not sure what do you mean. Could you help describe more?

@zuston Thank you for the reply, yes I did notice that proposal and I agree with comments such as 

```
Also, I'm more concerned about the compatibility issues. To make the length of fields in block ids adaptive itself is appealing,
it's just that we really have to think it through and make sure it wouldn't break things.
```
In my opinion exposing this to the end user introduces risk and makes the assumption they know what they are doing. It would be ideal to have a implementation that just works without the end user needing to worry.

Sure, so firstly, I mean the taskId index. Currently taskId increments across the life of the application and represents the total number of tasks, which for uniffle has an upper limit.

```
Can't support taskAttemptId[3786263], the max value should be 2097151
```

taskId index is reset in each stage as the index relates to only the task set of the stage. Using a combination of the stageId and taskId index would help increase the upper limit especially for applications running iterative algorithms, rather than have `[1, ..., 20]` you would have `[1_1, .. , 1_10, 2_1, .. , 2_10]`. The blockId would be made up of something like: `long partitionId, long stageId, long taskIdIndex, long atomicInt`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aWlWP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai0HN,incubator-uniffle,1519075789,731,NA,advancedxy,807537,,,NA,2023-04-23T14:05:24Z,2023-04-23T14:05:24Z,"> > @awdavidson
> > In PR #749, @advancedxy propose a new possibility to solving this. refer [#749 (comment)](https://github.com/apache/incubator-uniffle/pull/749#issuecomment-1486540366)
> > But for my thought, it sounds good to me. But in the current codebase, the taskAttemptId must be a real value, some code will retrieve this from this blockId and do some validation. I'm not sure whether removing this part or optimize.
> > > What’s the feasibility of using a combination of the stageId and taskId? What else can be done?
> > 
> > 
> > I'm not sure what do you mean. Could you help describe more?
> 
> @zuston Thank you for the reply, yes I did notice that proposal and I agree with comments such as
> 
> ```
> Also, I'm more concerned about the compatibility issues. To make the length of fields in block ids adaptive itself is appealing,
> it's just that we really have to think it through and make sure it wouldn't break things.
> ```
> 
> In my opinion exposing this to the end user introduces risk and makes the assumption they know what they are doing. It would be ideal to have a implementation that just works without the end user needing to worry.
> 
> Sure, so firstly, I mean the taskId index. Currently taskId increments across the life of the application and represents the total number of tasks, which for uniffle has an upper limit.
> 
> ```
> Can't support taskAttemptId[3786263], the max value should be 2097151
> ```
> 
> taskId index is reset in each stage as the index relates to only the task set of the stage. Using a combination of the stageId and taskId index would help increase the upper limit especially for applications running iterative algorithms, rather than have `[1, ..., 20]` you would have `[1_1, .. , 1_10, 2_1, .. , 2_10]`. The blockId would be made up of something like: `long partitionId, long stageId, long taskIdIndex, long atomicInt`

task id is not identical in one stage. There could be duplicate tasks due to task retry or task speculation. We rely that info to deduplicate shuffle data in the shuffle read part.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai0HN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai3E7,incubator-uniffle,1519087931,731,NA,awdavidson,54780428,,,NA,2023-04-23T15:02:36Z,2023-04-23T15:02:36Z,"> > > @awdavidson
> > > In PR #749, @advancedxy propose a new possibility to solving this. refer [#749 (comment)](https://github.com/apache/incubator-uniffle/pull/749#issuecomment-1486540366)
> > > But for my thought, it sounds good to me. But in the current codebase, the taskAttemptId must be a real value, some code will retrieve this from this blockId and do some validation. I'm not sure whether removing this part or optimize.
> > > > What’s the feasibility of using a combination of the stageId and taskId? What else can be done?
> > > 
> > > 
> > > I'm not sure what do you mean. Could you help describe more?
> > 
> > 
> > @zuston Thank you for the reply, yes I did notice that proposal and I agree with comments such as
> > ```
> > Also, I'm more concerned about the compatibility issues. To make the length of fields in block ids adaptive itself is appealing,
> > it's just that we really have to think it through and make sure it wouldn't break things.
> > ```
> > 
> > 
> >     
> >       
> >     
> > 
> >       
> >     
> > 
> >     
> >   
> > In my opinion exposing this to the end user introduces risk and makes the assumption they know what they are doing. It would be ideal to have a implementation that just works without the end user needing to worry.
> > Sure, so firstly, I mean the taskId index. Currently taskId increments across the life of the application and represents the total number of tasks, which for uniffle has an upper limit.
> > ```
> > Can't support taskAttemptId[3786263], the max value should be 2097151
> > ```
> > 
> > 
> >     
> >       
> >     
> > 
> >       
> >     
> > 
> >     
> >   
> > taskId index is reset in each stage as the index relates to only the task set of the stage. Using a combination of the stageId and taskId index would help increase the upper limit especially for applications running iterative algorithms, rather than have `[1, ..., 20]` you would have `[1_1, .. , 1_10, 2_1, .. , 2_10]`. The blockId would be made up of something like: `long partitionId, long stageId, long taskIdIndex, long atomicInt`
> 
> task id is not identical in one stage. There could be duplicate tasks due to task retry or task speculation. We rely that info to deduplicate shuffle data in the shuffle read part.

A combination of task id and attempt number would be unique within a stage? Obviously you can have stage retries so I guess that would have to be taken into consideration.


Or uniffle should support taskAttemptId to Long.MAX_VALUE?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai3E7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e0Zhc,incubator-uniffle,1590794332,731,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-06-14T09:04:35Z,2023-06-14T09:04:35Z,@advancedxy  any more thoughts on this? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e0Zhc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ryLnJ,incubator-uniffle,1808316873,731,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2023-11-13T14:54:50Z,2023-11-13T14:54:50Z,"Is this BlockID opaque to the RSS, or does the RSS extract and use the `partitionId`, `taskAttemptId` and `sequenceNumber` of a BlockID?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ryLnJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2c4Y,incubator-uniffle,1809436184,731,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-11-14T02:17:24Z,2023-11-14T02:17:24Z,"> Is this BlockID opaque to the RSS, or does the RSS extract and use the `partitionId`, `taskAttemptId` and `sequenceNumber` of a BlockID?

RSS extracts and uses the partitionId, taskAttemptId and sequenceNumber of a BlockID","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2c4Y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r5VMu,incubator-uniffle,1810191150,731,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2023-11-14T13:19:42Z,2023-11-14T13:19:42Z,"Can you point me to the code, I could not find that. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r5VMu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sAkMQ,incubator-uniffle,1812087568,731,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2023-11-15T09:25:23Z,2023-11-15T09:25:23Z,"Given `partitionId` is 32 bit and `taskAttemptId` even 64 bit, there is always a chance that the BlockID overflows, no matter how we balance the different parts. Can you elaborate a bit on the design decision taken to have BlockID contain those parts, and in favour of what benefits you sacrifice large number of partitions or tasks.

I am happy to work out alternatives and contribute, but a bit of background knowledge is needed here. Maybe comments in on Github is not the best format to elaborate on this issue. Happy to chat elsewhere.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sAkMQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sOKYY,incubator-uniffle,1815651864,731,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-11-17T02:27:54Z,2023-11-17T02:27:54Z,"> Given `partitionId` is 32 bit and `taskAttemptId` even 64 bit, there is always a chance that the BlockID overflows, no matter how we balance the different parts. Can you elaborate a bit on the design decision taken to have BlockID contain those parts, and in favour of what benefits you sacrifice large number of partitions or tasks.
> 
> I am happy to work out alternatives and contribute, but a bit of background knowledge is needed here. Maybe comments in on Github is not the best format to elaborate on this issue. Happy to chat elsewhere.

OK.  We have a slack channel or we can use a google meeting to communicate online.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sOKYY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u5fBc,incubator-uniffle,1860563036,731,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2023-12-18T13:54:28Z,2023-12-18T13:54:28Z,"> I found some apps will fail due to the exceeding the  MAX_SEQUENCE_NO range

@zuston which Spark version were you using?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u5fBc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u5f3p,incubator-uniffle,1860566505,731,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-18T13:55:50Z,2023-12-18T13:55:50Z,"> > I found some apps will fail due to the exceeding the  MAX_SEQUENCE_NO range
> 
> 
> 
> @zuston which Spark version were you using?

spark 3.1.1 

But I don't think this is related with the spark version. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u5f3p/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vdkpp,incubator-uniffle,1870023273,731,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-12-27T07:22:01Z,2023-12-27T07:22:01Z,"I also encountered the problem of block id overflow.
The block id is used to verify whether the accurate block set is obtained. I think we can get the sequence id from shuffle server. It will be almost impossible for overflow to occur.
But task id, task attempt id and partition id should be moved from block id. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vdkpp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5z4wtA,incubator-uniffle,1944259392,731,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-02-14T17:12:12Z,2024-02-14T17:12:12Z,"Here is a suggestion to make the bit lengths configurable: #1528
Here are suggestions to practically make those ids not overflow any more (for Spark): #1512 #1529","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5z4wtA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/731,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50lpsl,incubator-uniffle,1956027173,731,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-02-21T07:15:17Z,2024-02-21T07:15:17Z,Fix #1529 has been merged into master. That should mitigate the task attempt id overflow for Spark3.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50lpsl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/733,https://api.github.com/repos/apache/incubator-uniffle/issues/733,incubator-uniffle,1628576742,733,[Flaky Test] LocalStorageManagerTest#testGetLocalStorageInfo fails on SSD system,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-03-17T02:17:55Z,2023-03-17T06:05:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.uniffle.server.storage.LocalStorageManagerTest                                               
[ERROR] Tests run: 6, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.231 s <<< FAILURE! - in org.apache.uniffle.server.storage.
LocalStorageManagerTest                                                                                                             
[ERROR] testGetLocalStorageInfo  Time elapsed: 0.016 s  <<< FAILURE!                                            
org.opentest4j.AssertionFailedError: expected: <HDD> but was: <SSD>                                 
        at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)                                                        
        at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)                                                
        at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:182)                                                   
        at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:177)                                                   
        at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:1141)                                                      
        at org.apache.uniffle.server.storage.LocalStorageManagerTest.testGetLocalStorageInfo(LocalStorageManagerTest.java:242)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)                                                              
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)                                            
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)                
        at java.lang.reflect.Method.invoke(Method.java:498) 
```

### Actions URL

N/A

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/733/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/735,https://api.github.com/repos/apache/incubator-uniffle/issues/735,incubator-uniffle,1628668963,735,[Improvement] Client can configure ` SelectPartitionStrategy`,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-03-17T04:25:53Z,2023-03-17T04:25:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We should can configure ` SelectPartitionStrategy` in the client side. Currently, it's configured by the server side. If we can configure it in the client side. The system is more flexible. We introduced ` SelectPartitionStrategy` by https://github.com/apache/incubator-uniffle/pull/307

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/735/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/736,https://api.github.com/repos/apache/incubator-uniffle/issues/736,incubator-uniffle,1628676486,736,[Improvement] More smart parameters  about `rss.server.max.concurrency.of.single.partition.write`,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-03-17T04:37:32Z,2023-04-10T08:34:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

This parameter is configured by users currently. 
But it should be calculated by the (partition receive data speed / HDFS write speed). It's more flexible.

### How should we improve?

Introduce a new configuration `rss.server.hdfs.speed`. We record the timestamp which the partition start to receive data. And then we record the timestamp which the partition start to flush data. We can use two timestamps to calcuate partition receive data speed.  We use `(partition receive data speed / HDFS write speed)` to calculate how many threads which we need to write HDFS data.  We use the number to create HDFS writer.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/736/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/736,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0NRj,incubator-uniffle,1473303651,736,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-17T07:40:06Z,2023-03-17T07:40:06Z,"> This parameter is configured by users currently.

Correct: this param is configured by server side.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0NRj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/736,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0Ntb,incubator-uniffle,1473305435,736,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-17T07:42:07Z,2023-03-17T07:42:07Z,"> Introduce a new configuration rss.server.hdfs.speed. We record the timestamp which the partition start to receive data. And then we record the timestamp which the partition start to flush data. We can use two timestamps to calcuate partition receive data speed. We use (partition receive data speed / HDFS write speed) to calculate how many threads which we need to write HDFS data. We use the number to create HDFS writer.

It looks too complex, the initial goal is to solve the single partition lock problem. Does above solution will solve this? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0Ntb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/736,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0iEM,incubator-uniffle,1473388812,736,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-17T08:30:25Z,2023-03-17T08:30:25Z,"> > Introduce a new configuration rss.server.hdfs.speed. We record the timestamp which the partition start to receive data. And then we record the timestamp which the partition start to flush data. We can use two timestamps to calcuate partition receive data speed. We use (partition receive data speed / HDFS write speed) to calculate how many threads which we need to write HDFS data. We use the number to create HDFS writer.
> 
> It looks too complex, the initial goal is to solve the single partition lock problem. Does above solution will solve this?

Yes, we don't need to adjust the parameter by hand.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0iEM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/736,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0mvB,incubator-uniffle,1473407937,736,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-17T08:40:14Z,2023-03-17T08:40:14Z,"> > This parameter is configured by users currently.
> 
> Correct: this param is configured by server side.

When you need to modify the parameter, it's inconvenient to modify this parameter. It's difficult to judge whether the number of threads is enough.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X0mvB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/736,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X8q-g,incubator-uniffle,1475522464,736,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-20T02:31:07Z,2023-03-20T02:31:07Z,"Add some detailed information about feature of concurrent writing single partition.
1. The reason of this feature is to solve the write lock of writing same partition data.
2. this feature is no cost, which won't use the thread pool to do this, only leveraging the flushing thread pool in `ShuffleFlushManager`, refer to `PooledHdfsShuffleWriteHandler`

Based on above description, I think we could do some improvements for this.
1. Make client configuring this to control the concurrency of writing single partition
2. Best effort to reduce file number in case of no race condition, which is important for HDFS performance.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X8q-g/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/736,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlFg3,incubator-uniffle,1486116919,736,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-28T02:30:19Z,2023-03-28T02:30:19Z,closed by #744 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlFg3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/736,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zf-Lt,incubator-uniffle,1501553389,736,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-10T08:33:15Z,2023-04-10T08:33:15Z,I want to implement the max concurrency specified by client. WDYT ? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zf-Lt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/736,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zf-Yr,incubator-uniffle,1501554219,736,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-10T08:34:25Z,2023-04-10T08:34:25Z,"> I want to implement the max concurrency specified by client. WDYT ? @jerqi

I'm ok for this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zf-Yr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/737,incubator-uniffle,1628682211,737,[Umbrella] Flink Support (Help Wanted),jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-03-17T04:46:52Z,2023-11-20T13:31:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Flink Support is complex topic. We set up an issue here. In Flink Community, 
Flink Shuffle will have much change because of https://cwiki.apache.org/confluence/display/FLINK/FLIP-301%3A+Hybrid+Shuffle+supports+Remote+Storage. 
We should discuss actively with Flink community. 
Their discussion thread
https://lists.apache.org/thread/nwrqd5jtqwks89tbxpcrgto6r2bhdhno

### Task list

xx

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/737/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJAc_,incubator-uniffle,1646528319,737,NA,slfan1989,55643692,,,NA,2023-07-22T08:38:23Z,2023-07-22T08:38:23Z,"This document can also be used as a reference.

[FLIP-31: Pluggable Shuffle Service](https://cwiki.apache.org/confluence/display/FLINK/FLIP-31%3A+Pluggable+Shuffle+Service)

[FLIP-148: Introduce Sort-Based Blocking Shuffle to Flink](https://cwiki.apache.org/confluence/display/FLINK/FLIP-148%3A+Introduce+Sort-Based+Blocking+Shuffle+to+Flink)

[FLIP-184: Refine ShuffleMaster lifecycle management for pluggable shuffle service framework](https://cwiki.apache.org/confluence/display/FLINK/FLIP-184%3A+Refine+ShuffleMaster+lifecycle+management+for+pluggable+shuffle+service+framework)

[FLIP-199: Change some default config values of blocking shuffle for better usability](https://cwiki.apache.org/confluence/display/FLINK/FLIP-199%3A+Change+some+default+config+values+of+blocking+shuffle+for+better+usability)

[FLIP-209: Support to run multiple shuffle plugins in one session cluster](https://cwiki.apache.org/confluence/display/FLINK/FLIP-209%3A+Support+to+run+multiple+shuffle+plugins+in+one+session+cluster)

[FLIP-301: Hybrid Shuffle supports Remote Storage](https://cwiki.apache.org/confluence/display/FLINK/FLIP-301%3A+Hybrid+Shuffle+supports+Remote+Storage)

Vedio: [Pluggable Shuffle Service and Unaligned Checkpoints](https://www.youtube.com/watch?v=zUp8YWsi6iQ)

[flink-remote-shuffle](https://github.com/flink-extended/flink-remote-shuffle)

https://cwiki.apache.org/confluence/display/FLINK/Data+exchange+between+tasks","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJAc_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJJfF,incubator-uniffle,1646565317,737,NA,slfan1989,55643692,,,NA,2023-07-22T11:49:36Z,2023-07-22T11:49:36Z,@jerqi I will follow up the issue with chenglong(Big Data Development Engineer In Lixiang Car).,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJJfF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJy3J,incubator-uniffle,1646734793,737,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-23T03:19:59Z,2023-07-23T03:19:59Z,Thanks @slfan1989 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJy3J/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iTmL2,incubator-uniffle,1649304310,737,NA,chenglong-bigdata,50446282,窗外的小船,,NA,2023-07-25T07:45:54Z,2023-07-25T07:45:54Z,"> 

with me ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iTmL2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iWSgp,incubator-uniffle,1650010153,737,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-25T15:00:51Z,2023-07-25T15:00:51Z,"> > 
> 
> with me

Thanks for your help.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iWSgp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jeGjP,incubator-uniffle,1668835535,737,NA,pegasas,13224827,John Huang,pegasashjy@gmail.com,NA,2023-08-08T03:01:44Z,2023-08-08T03:01:44Z,"Hi, @jerqi  and the team, 

I am interested in this project due to investigating Flink batch shuffle service in my previous job.

Would I still be able to join this project?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jeGjP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jeIHG,incubator-uniffle,1668841926,737,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-08T03:12:11Z,2023-08-08T03:12:11Z,"
> Hi, @jerqi and the team,
> 
> I am interested in this project due to investigating Flink batch shuffle service in my previous job.
> 

> Would I still be able to join this project?

You're welcome. Currently, we have a regular meeting. If you have interest and can Speak Chinese, you can join the Wechat Group, the meeting link is the Wechat Group.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jeIHG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rllmD,incubator-uniffle,1805015427,737,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-10T03:23:17Z,2023-11-10T03:23:17Z,cc @slfan1989 Do you already have a draft implementation? I remember you mentioned that in the online meeting ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rllmD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/737,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX6Bk,incubator-uniffle,1818206308,737,NA,slfan1989,55643692,,,NA,2023-11-20T04:23:49Z,2023-11-20T04:23:49Z,"> cc @slfan1989 Do you already have a draft implementation? I remember you mentioned that in the online meeting

@zuston My draft version code has been basically completed (but some details still need to be optimized), I will submit PR to the community as soon as possible.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX6Bk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/740,https://api.github.com/repos/apache/incubator-uniffle/issues/740,incubator-uniffle,1630341261,740,[Improvement] Unsafe memory management in RSS mappers,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-03-18T14:08:17Z,2023-03-19T00:18:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We can refer to https://github.com/uber/RemoteShuffleService/issues/59

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/740/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/740,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X62Od,incubator-uniffle,1475044253,740,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-19T00:18:47Z,2023-03-19T00:18:47Z,"+1. I like this feature. If I have time, I will pick up this. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5X62Od/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/743,https://api.github.com/repos/apache/incubator-uniffle/issues/743,incubator-uniffle,1631516427,743,[Flaky Test]  ShuffleFlushManagerTest#writeTest,xianjingfeng,11752250,,,OPEN,2023-03-20T07:05:03Z,2023-03-20T07:05:03Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 8, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 86.34 s <<< FAILURE! - in org.apache.uniffle.server.ShuffleFlushManagerTest
Error:  writeTest  Time elapsed: 51.105 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: Unexpected flush process
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:39)
	at org.junit.jupiter.api.Assertions.fail(Assertions.java:134)
	at org.apache.uniffle.server.ShuffleFlushManagerTest.waitForFlush(ShuffleFlushManagerTest.java:387)
	at org.apache.uniffle.server.ShuffleFlushManagerTest.writeTest(ShuffleFlushManagerTest.java:176)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/4465348917/jobs/7842330833?pr=673

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/743/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/747,https://api.github.com/repos/apache/incubator-uniffle/issues/747,incubator-uniffle,1633363040,747,[Subtask] [Tez] Add Tez Framework directory,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-03-21T07:30:29Z,2023-03-21T11:33:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

We should adjust directories for tez

### Parent issue

#321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/747/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/750,https://api.github.com/repos/apache/incubator-uniffle/issues/750,incubator-uniffle,1633884754,750,[Improvement] Fetch Failed related exceptions should have a dedicated RssException class,advancedxy,807537,,,CLOSED,2023-03-21T13:04:50Z,2023-03-22T03:13:55Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, a lot of exception are all called RssException, which has no distinguish meanings. 
When I'm implementing #477, I think we should at least to make fetch fetch exception a dedicated subclass.

### How should we improve?

1. define a new exception class
2. when fetch failed occurred, throw the corresponding exception

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/750/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/750,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YF16T,incubator-uniffle,1477926547,750,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-03-21T14:20:32Z,2023-03-21T14:20:32Z,"> Currently, a lot of exception are all called RssException, which has no distinguish meanings.

Thanks for the improvement. There are also many raw use of `RuntimeException` need to be replaced.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YF16T/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/750,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YJQWu,incubator-uniffle,1478821294,750,NA,advancedxy,807537,,,NA,2023-03-22T02:04:47Z,2023-03-22T02:04:47Z,"> > Currently, a lot of exception are all called RssException, which has no distinguish meanings.
> 
> Thanks for the improvement. There are also many raw use of `RuntimeException` need to be replaced.

Yes, it's definitely worth refactor. Would you mind create an issue for this? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YJQWu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/752,https://api.github.com/repos/apache/incubator-uniffle/issues/752,incubator-uniffle,1634950232,752,[Improvement] Replace raw use of RuntimeException,kaijchen,5821159,Kaijie Chen,ckj@apache.org,CLOSED,2023-03-22T02:15:33Z,2023-03-22T16:06:03Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Raw use of `RuntimeException` is difficult to catch.
Because other runtime Exceptions will be catched as well.
We should avoid using raw `RuntimeException`.

### How should we improve?

The simple solution is to replace `RuntimeException` with `RssException`.

The best solution is to replace `RuntimeException` with specific exception.
We might need to create new Exception class for more expressive.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/752/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/755,https://api.github.com/repos/apache/incubator-uniffle/issues/755,incubator-uniffle,1637131394,755,[Improvement] Add the method of creating thread pool,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2023-03-23T09:14:13Z,2023-03-28T07:24:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The current method for creating thread pools is not uniform, and tool classes are used to unify them.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/755/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/756,https://api.github.com/repos/apache/incubator-uniffle/issues/756,incubator-uniffle,1637428057,756,[Improvement] ShuffleBufferManager.flushSingleBufferIfNecessary unreasonable,leixm,31424839,Xianming Lei,,CLOSED,2023-03-23T12:14:41Z,2023-03-24T07:05:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

After #471 , the data size of a single partition reaches rss.server.huge-partition.size.threshold, can flush be triggered without waiting for rss.server.single.buffer.flush.threshold satisfy.
https://github.com/apache/incubator-uniffle/blob/master/server/src/main/java/org/apache/uniffle/server/buffer/ShuffleBufferManager.java#228
`if ((isHugePartition || this.bufferFlushEnabled) && buffer.getSize() > this.bufferFlushThreshold) {`

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/756/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/756,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YR6FP,incubator-uniffle,1481089359,756,NA,leixm,31424839,Xianming Lei,,NA,2023-03-23T12:14:53Z,2023-03-23T12:14:53Z,@zuston  PTAL.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YR6FP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/756,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YR9yP,incubator-uniffle,1481104527,756,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-23T12:25:11Z,2023-03-23T12:25:11Z,"It’s my mistake, could you help fix?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YR9yP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/756,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YSJF1,incubator-uniffle,1481150837,756,NA,leixm,31424839,Xianming Lei,,NA,2023-03-23T12:58:28Z,2023-03-23T12:58:28Z,"I misunderstood just now, the single-partition flush still takes effect, but when the data size of a single partition reaches rss.server.huge-partition.size.threshold, can flush be triggered without waiting for rss.server.single.buffer.flush.threshold satisfy.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YSJF1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/756,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YSJZr,incubator-uniffle,1481152107,756,NA,leixm,31424839,Xianming Lei,,NA,2023-03-23T12:59:12Z,2023-03-23T12:59:12Z,cc @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YSJZr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/756,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YSJ6m,incubator-uniffle,1481154214,756,NA,leixm,31424839,Xianming Lei,,NA,2023-03-23T13:00:25Z,2023-03-23T13:00:25Z,((isHugePartition || this.bufferFlushEnabled) && buffer.getSize() > this.bufferFlushThreshold) -> (isHugePartition || (this.bufferFlushEnabled && buffer.getSize() > this.bufferFlushThreshold)),"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YSJ6m/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/756,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YV8kk,incubator-uniffle,1482148132,756,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-24T02:02:56Z,2023-03-24T02:02:56Z,"> I misunderstood just now, the single-partition flush still takes effect, but when the data size of a single partition reaches rss.server.huge-partition.size.threshold, can flush be triggered without waiting for rss.server.single.buffer.flush.threshold satisfy.

Yes. I have rechecked, this is reasonable. WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YV8kk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/756,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YWtLX,incubator-uniffle,1482347223,756,NA,leixm,31424839,Xianming Lei,,NA,2023-03-24T07:05:26Z,2023-03-24T07:05:26Z,"Misunderstood before, seems reasonable, I will close this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YWtLX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/757,https://api.github.com/repos/apache/incubator-uniffle/issues/757,incubator-uniffle,1638836249,757,[Improvement]  Separate flush thread pools for different storage type.,leixm,31424839,Xianming Lei,,CLOSED,2023-03-24T06:56:45Z,2023-07-11T13:23:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In the current MEMORY_LOCALFILE_HDFS mode, the flush thread pool is multiplexed, but for machines with a small number of local disks, the number of configured flush threads is small, for example, only 4 flush threads are configured, which is sufficient for writing to local disks, but for For writing HDFS, the number of threads is too small.

### How should we improve?

Maybe we can separate flush thread pools for different storage type.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/757/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/757,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YWrU4,incubator-uniffle,1482339640,757,NA,leixm,31424839,Xianming Lei,,NA,2023-03-24T06:56:55Z,2023-03-24T06:56:55Z,@jerqi  @zuston  @smallzhongfeng  PTAL.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YWrU4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/757,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YW-SX,incubator-uniffle,1482417303,757,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-24T08:17:56Z,2023-03-24T08:17:56Z,"+1 for this feature, please go head.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YW-SX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/757,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hNHRJ,incubator-uniffle,1630827593,757,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-11T13:23:51Z,2023-07-11T13:23:51Z,Done #775 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hNHRJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/758,incubator-uniffle,1639230938,758,[Umbrella] Introducing `Cli` to update the configuration file,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,OPEN,2023-03-24T11:35:58Z,2023-08-11T09:21:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Currently, our configurations are implemented using the method of scheduling threads, which has some latency. We can add cli methods, which have the following advantages:

1. Ability to refresh configuration files to memory faster
2. More secure update configuration

### Task list

- [x] #770 
- [ ] #769 
- [x] #768 
- [ ] #836 
- [x] #837  
- [ ] #846 


### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/758/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YX6eE,incubator-uniffle,1482663812,758,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-03-24T11:36:44Z,2023-03-24T11:36:44Z,"@jerqi @leixm @zuston @advancedxy If you have time, PTAL.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YX6eE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YgOUC,incubator-uniffle,1484842242,758,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-03-27T09:51:51Z,2023-03-27T09:51:51Z,"If it's ok, I will go ahead. Gently ping. @jerqi @zuston @kaijchen @advancedxy ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YgOUC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YhK-p,incubator-uniffle,1485090729,758,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-27T13:27:09Z,2023-03-27T13:27:09Z,"Great work. I think cli is a good way for admin to manage cluster. But do we need to trigger updating conf by CLI, the update latency is acceptable for me. Do you meet some problems on this? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YhK-p/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YitAy,incubator-uniffle,1485492274,758,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-27T16:53:35Z,2023-03-27T16:53:35Z,+1,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YitAy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlCt8,incubator-uniffle,1486105468,758,NA,xianjingfeng,11752250,,,NA,2023-03-28T02:12:18Z,2023-03-28T02:12:18Z,"As we discussed in #80, should we update conf by REST api?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlCt8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlGw1,incubator-uniffle,1486122037,758,NA,advancedxy,807537,,,NA,2023-03-28T02:39:33Z,2023-03-28T02:39:33Z,">If it's ok, I will go ahead. Gently ping. @jerqi @zuston @kaijchen @advancedxy


I think cli is a good way to manage shuffle clusters. I create a cli support ticket for operator to manage cluster: #569.

However your current proposal is more about to update configurations timely and securely. I'm +1 with intention. But as @xianjingfeng point out, do you think it's better to update configurations via REST api?


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlGw1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlHK8,incubator-uniffle,1486123708,758,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-03-28T02:42:35Z,2023-03-28T02:42:35Z,"> Great work. I think cli is a good way for admin to manage cluster. But do we need to trigger updating conf by CLI, the update latency is acceptable for me. Do you meet some problems on this?

Not yet, but as I said, when updating, we need to wait with a one minute interval. However, if we use the cli method, we can take effect immediately. And in line with top-level projects, services such as `Yarn` and `Hadoop` all provide Cli for configuration updates.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlHK8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlIeL,incubator-uniffle,1486129035,758,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-03-28T02:52:21Z,2023-03-28T02:52:21Z,"> > If it's ok, I will go ahead. Gently ping. @jerqi @zuston @kaijchen @advancedxy
> 
> I think cli is a good way to manage shuffle clusters. I create a cli support ticket for operator to manage cluster: #569.
> 
> However your current proposal is more about to update configurations timely and securely. I'm +1 with intention. But as @xianjingfeng point out, do you think it's better to update configurations via REST api?

Like `Yarn`, in fact, `cli` and `REST` api coexist, and I think we can follow suit.


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YlIeL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ys2S0,incubator-uniffle,1488151732,758,NA,advancedxy,807537,,,NA,2023-03-29T08:24:47Z,2023-03-29T08:24:47Z,"> > > If it's ok, I will go ahead. Gently ping. @jerqi @zuston @kaijchen @advancedxy
> > 
> > 
> > I think cli is a good way to manage shuffle clusters. I create a cli support ticket for operator to manage cluster: #569.
> > However your current proposal is more about to update configurations timely and securely. I'm +1 with intention. But as @xianjingfeng point out, do you think it's better to update configurations via REST api?
> 
> Like `Yarn`, in fact, `cli` and `REST` api coexist, and I think we can follow suit.

co-exist works for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ys2S0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/758,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Yyhjj,incubator-uniffle,1489639651,758,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-03-30T03:42:39Z,2023-03-30T03:42:39Z,"> > > > If it's ok, I will go ahead. Gently ping. @jerqi @zuston @kaijchen @advancedxy
> > > 
> > > 
> > > I think cli is a good way to manage shuffle clusters. I create a cli support ticket for operator to manage cluster: #569.
> > > However your current proposal is more about to update configurations timely and securely. I'm +1 with intention. But as @xianjingfeng point out, do you think it's better to update configurations via REST api?
> > 
> > 
> > Like `Yarn`, in fact, `cli` and `REST` api coexist, and I think we can follow suit.
> 
> co-exist works for me.

+1","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Yyhjj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/762,https://api.github.com/repos/apache/incubator-uniffle/issues/762,incubator-uniffle,1640431832,762,[Bug] `DefaultStorageMediaProvider#getStorageMediaFor` fail because of NoSuchFileException ,xianjingfeng,11752250,,,CLOSED,2023-03-25T08:33:35Z,2023-03-26T02:39:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

If storage path is not exist, `Files#getFileStore` will fail.

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[WARN] 2023-03-23 09:21:32,163 pool-2-thread-1 DefaultStorageMediaProvider getStorageMediaFor - Get storage type failed with exception
java.nio.file.NoSuchFileException: /data/rssadmin/rss/data/rssdata
        at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)
        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)
        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)
        at sun.nio.fs.UnixFileStore.devFor(UnixFileStore.java:57)
        at sun.nio.fs.UnixFileStore.<init>(UnixFileStore.java:64)
        at sun.nio.fs.LinuxFileStore.<init>(LinuxFileStore.java:44)
        at sun.nio.fs.LinuxFileSystemProvider.getFileStore(LinuxFileSystemProvider.java:51)
        at sun.nio.fs.LinuxFileSystemProvider.getFileStore(LinuxFileSystemProvider.java:39)
        at sun.nio.fs.UnixFileSystemProvider.getFileStore(UnixFileSystemProvider.java:368)
        at java.nio.file.Files.getFileStore(Files.java:1461)
        at org.apache.uniffle.storage.common.DefaultStorageMediaProvider.getStorageMediaFor(DefaultStorageMediaProvider.java:63)
        at org.apache.uniffle.server.storage.LocalStorageManager.getStorageTypeForBasePath(LocalStorageManager.java:160)
        at org.apache.uniffle.server.storage.LocalStorageManager.lambda$new$0(LocalStorageManager.java:116)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:750)
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/762/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/768,incubator-uniffle,1641736360,768,[Subtask] `Cli` method for blacklist update,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2023-03-27T09:24:39Z,2023-06-21T12:19:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Currently, updates to the blacklist need to rely on the scheduling thread pool for updates, which is relatively inefficient. We can emulate the Hadoop method of updating the config and add clis for updates, which is more efficient.

### Parent issue

#758 

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/768/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgqaV,incubator-uniffle,1501734549,768,NA,beryllw,25627922,Junbo wang,beryllwang@gmail.com,NA,2023-04-10T11:58:00Z,2023-04-10T11:58:00Z,"I'm Interested in this, could you assign it to me？Should I wait for [770](https://github.com/apache/incubator-uniffle/issues/770) to be completed before starting?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgqaV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkoxY,incubator-uniffle,1502776408,768,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-04-11T06:56:00Z,2023-04-11T06:56:00Z,"Of course, I assigned it to you.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkoxY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zkpwh,incubator-uniffle,1502780449,768,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-04-11T06:59:55Z,2023-04-11T06:59:55Z,"> I'm Interested in this, could you assign it to me？Should I wait for [770](https://github.com/apache/incubator-uniffle/issues/770) to be completed before starting?

Yes, try to wait for #770 to complete.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zkpwh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a7P_p,incubator-uniffle,1525481449,768,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-27T11:00:05Z,2023-04-27T11:00:05Z,cc @Kwafoor #770 has been finished. You can go ahead.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a7P_p/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5byp29,incubator-uniffle,1540005309,768,NA,beryllw,25627922,Junbo wang,beryllwang@gmail.com,NA,2023-05-09T11:40:58Z,2023-05-09T11:40:58Z,"> cc @Kwafoor #770 has been finished. You can go ahead.

OK，I will finish as soon as possible.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5byp29/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dN5rq,incubator-uniffle,1563925226,768,NA,beryllw,25627922,Junbo wang,beryllwang@gmail.com,NA,2023-05-26T07:22:47Z,2023-05-26T07:22:47Z,"> cc @Kwafoor #770 has been finished. You can go ahead.

Almost done, just a little more checking and final touches left. I'll submit it in a few days.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dN5rq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dSyoa,incubator-uniffle,1565207066,768,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-27T04:54:05Z,2023-05-27T04:54:05Z,"> > cc @Kwafoor #770 has been finished. You can go ahead.
> 
> Almost done, just a little more checking and final touches left. I'll submit it in a few days.

@Kwafoor We usually use rest api to control admin service. If we need add api, we would better add rest api. Could we keep consistent with other operation. You can refer to https://github.com/apache/incubator-uniffle/pull/684","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dSyoa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dXNFY,incubator-uniffle,1566363992,768,NA,beryllw,25627922,Junbo wang,beryllwang@gmail.com,NA,2023-05-29T01:34:26Z,2023-05-29T01:34:26Z,"> > > cc @Kwafoor #770 has been finished. You can go ahead.
> > 
> > 
> > Almost done, just a little more checking and final touches left. I'll submit it in a few days.
> 
> @Kwafoor We usually use rest api to control admin service. If we need add api, we would better add rest api. Could we keep consistent with other operation. You can refer to #684

I have implemented control admin service with reference to yarn through grpc, but I will refer to https://github.com/apache/incubator-uniffle/pull/684 to see how to achieve it through rest.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dXNFY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/768,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5faTrC,incubator-uniffle,1600731842,768,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-21T12:19:29Z,2023-06-21T12:19:29Z,closed by #931,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5faTrC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/769,https://api.github.com/repos/apache/incubator-uniffle/issues/769,incubator-uniffle,1641740583,769,[Subtask] `Cli` method for quotaFile update,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,OPEN,2023-03-27T09:27:17Z,2023-07-05T09:02:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Currently, the update of quota needs to rely on the scheduling thread pool for updates. Adding cli for updates is more timely.

### Parent issue

#758 

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/769/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/770,https://api.github.com/repos/apache/incubator-uniffle/issues/770,incubator-uniffle,1641761440,770,[Subtask] Introduce `apache.commons.cli` basic framework,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2023-03-27T09:41:05Z,2023-05-06T02:47:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

We can imitate `YarnCli` to build a `UnifleCli`.

### Parent issue

#758 

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/770/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/770,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ygz-Q,incubator-uniffle,1484996496,770,NA,slfan1989,55643692,,,NA,2023-03-27T11:44:47Z,2023-03-27T11:44:47Z,@smallzhongfeng Can I assign this issue? Thank you very much!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ygz-Q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/770,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZxpAp,incubator-uniffle,1506185257,770,NA,slfan1989,55643692,,,NA,2023-04-13T01:30:01Z,2023-04-13T01:30:01Z,I will submit the code of version 1 in the next 1-2 days.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZxpAp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/770,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bnOd3,incubator-uniffle,1537009527,770,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-05-06T02:47:40Z,2023-05-06T02:47:40Z,Fixed by https://github.com/apache/incubator-uniffle/pull/833,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bnOd3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/772,https://api.github.com/repos/apache/incubator-uniffle/issues/772,incubator-uniffle,1643263498,772,[Bug] Memory leak caused by UserGroupInformation.createProxyUser,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-03-28T06:07:15Z,2023-03-29T03:01:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The hadoop filesystem instance will be created too many time in cache, which will cause the shuffle server memory leak.

As we know, the filesystem cache's key is built by the scheme、authority and ugi. The scheme and authority are not changed everytime. But for ugi, if we invoke the createProxyUser, it will always create a new one, that means the every invoking `Filesystem.get()` , it will be cached due to different key.

We should cache the proxy user ugi to avoid caching every time.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/772/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/772,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ylq8Y,incubator-uniffle,1486270232,772,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-28T06:07:50Z,2023-03-28T06:07:50Z,"cc @advancedxy @jerqi @smallzhongfeng This is a critical bug, I will fix this ASSP.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ylq8Y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/772,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YmQlg,incubator-uniffle,1486424416,772,NA,advancedxy,807537,,,NA,2023-03-28T08:22:03Z,2023-03-28T08:22:03Z,"Do you any any heap dump to indicate this memory leak. 

I just checked the related code, the proxy user created from the same ugi should equal to the same proxy user?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YmQlg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/772,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YmdwQ,incubator-uniffle,1486478352,772,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-28T09:00:55Z,2023-03-28T09:00:55Z,"> Do you any any heap dump to indicate this memory leak.
> 

After dumping all heap, this bug was found.

> I just checked the related code, the proxy user created from the same ugi should equal to the same proxy user?

I have not  get your point.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YmdwQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/772,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ymi1Y,incubator-uniffle,1486499160,772,NA,advancedxy,807537,,,NA,2023-03-28T09:15:03Z,2023-03-28T09:15:03Z,"> > Do you any any heap dump to indicate this memory leak.
> 
> After dumping all heap, this bug was found.

Is it possible for you to upload the screenshot here?

> 
> > I just checked the related code, the proxy user created from the same ugi should equal to the same proxy user?
> 
> I have not get your point.

I mean that two proxy ugi for the same proxy user should be equal to each other, that is what I have checked for.
But never mind, the hash code for proxy ugi is different for each instance.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ymi1Y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/772,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ymj0u,incubator-uniffle,1486503214,772,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-03-28T09:17:50Z,2023-03-28T09:17:50Z,"![g1](https://user-images.githubusercontent.com/8609142/228189882-77361825-f852-409f-ba58-232dc09db68f.png)
![g2](https://user-images.githubusercontent.com/8609142/228189897-6da1e6f2-bc31-46f4-a98c-0fb1c8745291.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ymj0u/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/774,https://api.github.com/repos/apache/incubator-uniffle/issues/774,incubator-uniffle,1643419382,774,[DOCS] metadata.annotations: Too long,xianjingfeng,11752250,,,CLOSED,2023-03-28T08:05:06Z,2023-05-10T13:25:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

```
[root@localhost bases]# kubectl -n spark apply -f uniffle.apache.org_remoteshuffleservices.yaml 
The CustomResourceDefinition ""remoteshuffleservices.uniffle.apache.org"" is invalid: metadata.annotations: Too long: must have at most 262144 bytes
```

`kubectl create` is ok

Maybe we need modify this line
https://github.com/apache/incubator-uniffle/blob/3f9ba8183013f242373329e0238835a16de1a798/docs/operator/install.md?plain=1#L45

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/774/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/778,https://api.github.com/repos/apache/incubator-uniffle/issues/778,incubator-uniffle,1645243278,778,[FEATURE] Separate `ShuffleServer` metrics through tags,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2023-03-29T08:02:45Z,2023-04-17T11:09:50Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In the production environment, we have introduced tag, with the metrics of accessing Grafana. In order to better distinguish the metrics of shuffle-server with different tags, we need to separate them.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/778/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/778,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ysvef,incubator-uniffle,1488123807,778,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-03-29T08:04:24Z,2023-03-29T08:04:24Z,"PTAL. @jerqi @zuston If necessary, I will raise a pr.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Ysvef/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/778,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZbelE,incubator-uniffle,1500375364,778,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-07T15:10:14Z,2023-04-07T15:10:14Z,"> PTAL. @jerqi @zuston If necessary, I will raise a pr.

OK for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZbelE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/778,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZfKAy,incubator-uniffle,1501339698,778,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-10T03:14:37Z,2023-04-10T03:14:37Z,Put `tag` into `labelNames` of metrics ? @smallzhongfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZfKAy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/778,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkvXz,incubator-uniffle,1502803443,778,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-04-11T07:20:11Z,2023-04-11T07:20:11Z,"Yes, currently our environment does this. @zuston 

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkvXz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/778,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkwLl,incubator-uniffle,1502806757,778,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-04-11T07:21:43Z,2023-04-11T07:21:43Z,"![image](https://user-images.githubusercontent.com/84573424/231085826-7eb21462-5a8d-46c6-96df-14b4e2908483.png)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkwLl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/778,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zkw0P,incubator-uniffle,1502809359,778,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-04-11T07:22:37Z,2023-04-11T07:22:37Z,"Just like this. Does this meet your expectations ? @zuston @jerqi 



","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zkw0P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/778,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkxP4,incubator-uniffle,1502811128,778,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-11T07:23:11Z,2023-04-11T07:23:11Z,"> Just like this. Does this meet your expectations ? @zuston @jerqi

Ok for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkxP4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/779,https://api.github.com/repos/apache/incubator-uniffle/issues/779,incubator-uniffle,1645247358,779,Support random grpc port,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2023-03-29T08:05:13Z,2023-06-08T09:00:47Z,"Code of Conduct
 I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)

Search before asking
 I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.

Describe the subtask
For Grpc server, when we set the port to zero. we should bind a available random port.

Parent issue
https://github.com/apache/incubator-uniffle/issues/133

Are you willing to submit PR?
 Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/779/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/779,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aCnYC,incubator-uniffle,1510635010,779,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-17T03:15:39Z,2023-04-17T03:15:39Z,Closed by #820 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aCnYC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/780,https://api.github.com/repos/apache/incubator-uniffle/issues/780,incubator-uniffle,1645283296,780,[Improvement] add fromProto and toProto methods for the proto mapping class,advancedxy,807537,,,OPEN,2023-03-29T08:29:13Z,2023-03-29T08:29:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, some mapping class for rss proto message contains `fromProto` and `toProto` methods, others don't. 
We should add these two methods for all the mapping classes

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/780/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/781,https://api.github.com/repos/apache/incubator-uniffle/issues/781,incubator-uniffle,1645501529,781,[Bug] Latest Uniffle V0.7 release is broken on kubernetes due to the DefaultStorageManagerProvider,connorlwilkes,16749386,Connor Wilkes,,OPEN,2023-03-29T10:28:27Z,2023-05-05T09:18:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When attempting to deploy the latest release of Uniffle on Kubernetes with an emptyDir mount that mounts to /mnt/disk1 I am seeing initialization errors for the local storage. It's strange because there are no actual exceptions logged or thrown. Through some debugging I have found that it is likely due to the new way that storageMedia is deterrmined following https://github.com/apache/incubator-uniffle/issues/410. 

I have discovered that this new method is seemingly unable to determine the storage type of this mounted disk and therefore seems to return UNKNOWN which breaks the storage initialization. 

The only actual error that is thrown is:

```
23/03/29 10:16:47 ERROR ShuffleServer: Errors on initializing shuffle server.                                                                                                                                                                                                           java.lang.RuntimeException: Initialize 1 local storage(s) failed, specified local storage paths size: 1, the conf of rss.server.localstorage.initialize.max.fail.number size: 0                                                                                                             at org.apache.uniffle.server.storage.LocalStorageManager.<init>(LocalStorageManager.java:150)                                                                                                                                                                                           at org.apache.uniffle.server.storage.StorageManagerFactory.createStorageManager(StorageManagerFactory.java:36)                                                                                                                                                                          at org.apache.uniffle.server.ShuffleServer.initialization(ShuffleServer.java:184)                                                                                                                                                                                                       at org.apache.uniffle.server.ShuffleServer.<init>(ShuffleServer.java:85)                                                                                                                                                                                                                at org.apache.uniffle.server.ShuffleServer.main(ShuffleServer.java:103)           
```

It is possible to use ""rss.server.storageMediaProvider.from.env.key"" and set the type that way which resolves this but this is not very well documented and it took me a while to work out the exact issue. 

I can provide more information as required

### Affects Version(s)

master/0.7-rc4

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/781/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/781,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YuqaV,incubator-uniffle,1488627349,781,NA,advancedxy,807537,,,NA,2023-03-29T13:35:26Z,2023-03-29T13:35:26Z,"Hi, thanks for your report. We didn't test K8S deployment with an empty dir, but the DefaultStorageMediaProvider should return HDD by default. could you provide some more clues that why an Unknown type is thrown?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YuqaV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/781,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Yvf6y,incubator-uniffle,1488846514,781,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-03-29T15:29:59Z,2023-03-29T15:29:59Z,"What have you tested this with? This should function the same way as local provisioner or hostpath volumes.

It is very strange. I noticed that even though there is a failure in this block here:
```

for (int i = 0; i < storageBasePaths.size(); i++) {
      final int idx = i;
      String storagePath = storageBasePaths.get(i);
      executorService.submit(() -> {
        try {
          StorageMedia storageType = getStorageTypeForBasePath(storagePath);
          localStorageArray[idx] = LocalStorage.newBuilder()
              .basePath(storagePath)
              .capacity(capacity)
              .lowWaterMarkOfWrite(lowWaterMarkOfWrite)
              .highWaterMarkOfWrite(highWaterMarkOfWrite)
              .shuffleExpiredTimeoutMs(shuffleExpiredTimeoutMs)
              .localStorageMedia(storageType)
              .build();
          successCount.incrementAndGet();
        } catch (Exception e) {
          LOG.error(""LocalStorage init failed!"", e);
        } finally {
          countDownLatch.countDown();
        }
      });
    }
```

as successCounter is not incremented at all, no exception is logged at all.

I noticed through debugging that that return statement with returning the type of HDD doesn't seem to ever get reached but equally I couldn't see anywhere in the block above it that parses 'sys/block' doesn't throw an exception. In fact from what I could see I am not even sure that 'IS_OS_LINUX' resolves correctly. 

I am a bit stumped as to what the actual issue is here. I have yet to try a try catch over the entire method to see if any exception is hidden somehow but I would expect not ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Yvf6y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/781,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YvvAH,incubator-uniffle,1488908295,781,NA,advancedxy,807537,,,NA,2023-03-29T16:13:51Z,2023-03-29T16:13:51Z,"> 



> What have you tested this with? This should function the same way as local provisioner or hostpath volumes.
> 
> It is very strange. I noticed that even though there is a failure in this block here:
> 
> ```
> 
> for (int i = 0; i < storageBasePaths.size(); i++) {
>       final int idx = i;
>       String storagePath = storageBasePaths.get(i);
>       executorService.submit(() -> {
>         try {
>           StorageMedia storageType = getStorageTypeForBasePath(storagePath);
>           localStorageArray[idx] = LocalStorage.newBuilder()
>               .basePath(storagePath)
>               .capacity(capacity)
>               .lowWaterMarkOfWrite(lowWaterMarkOfWrite)
>               .highWaterMarkOfWrite(highWaterMarkOfWrite)
>               .shuffleExpiredTimeoutMs(shuffleExpiredTimeoutMs)
>               .localStorageMedia(storageType)
>               .build();
>           successCount.incrementAndGet();
>         } catch (Exception e) {
>           LOG.error(""LocalStorage init failed!"", e);
>         } finally {
>           countDownLatch.countDown();
>         }
>       });
>     }
> ```
> 
> as successCounter is not incremented at all, no exception is logged at all.
> 
> I noticed through debugging that that return statement with returning the type of HDD doesn't seem to ever get reached but equally I couldn't see anywhere in the block above it that parses 'sys/block' doesn't throw an exception. In fact from what I could see I am not even sure that 'IS_OS_LINUX' resolves correctly.
> 
> I am a bit stumped as to what the actual issue is here. I have yet to try a try catch over the entire method to see if any exception is hidden somehow but I would expect not

hostpath should work as expected. And rss operator uses host path by default.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5YvvAH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/781,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Y5vZa,incubator-uniffle,1491531354,781,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-03-31T08:35:23Z,2023-03-31T08:35:23Z,"Interesting, I wonder if anyone is able to do a quick test to reproduce my issue? I expect local dirs should present the same way as a host path so that's interesting. I will give hostpath a go but that is not the solution that I would prefer","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Y5vZa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/781,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bi9xB,incubator-uniffle,1535892545,781,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-05-05T08:09:37Z,2023-05-05T08:09:37Z,@advancedxy what are the general community's thoughts in regards to running this service on kubernetes? I see there is an operator but I wonder if anyone is doing this in production or people are tending to run on external servers,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bi9xB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/781,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bjA1q,incubator-uniffle,1535905130,781,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-05T08:21:27Z,2023-05-05T08:21:27Z,"> hat are the general community's thoughts in regards to running this service on kubernetes? I see there is an operator but I wonder if anyone is doing this in production or people are tending to run on external servers

In Tencent company, we're using operator to deploy shuffle servers. And in Tencent Cloud, there are Uniffle services deployed by operator in the EKS.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bjA1q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/781,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bjND7,incubator-uniffle,1535955195,781,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-05-05T09:04:35Z,2023-05-05T09:04:35Z,"@jerqi thank you. That is interesting. I guess this is at some kind of scale. I am evaluating this service internally on k8s but are having some trouble with scaling of it when running some benchmarks. Wondering if there was any docs or guidance around scaling this up? We appear to keep hitting issues where we get:

`org.apache.uniffle.common.exception.RssException: Send failed: Task[699170_0] failed because 170 blocks can't be sent to shuffle server.`

I can raise another issue if that's a better way to have this discussion btw","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bjND7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/781,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bjQWM,incubator-uniffle,1535968652,781,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-05T09:15:48Z,2023-05-05T09:15:48Z,"> @jerqi thank you. That is interesting. I guess this is at some kind of scale. I am evaluating this service internally on k8s but are having some trouble with scaling of it when running some benchmarks. Wondering if there was any docs or guidance around scaling this up? We appear to keep hitting issues where we get:
> 
> `org.apache.uniffle.common.exception.RssException: Send failed: Task[699170_0] failed because 170 blocks can't be sent to shuffle server.`
> 
> I can raise another issue if that's a better way to have this discussion btw

Maybe you should provide more logs and metrics to let us give more advice.  There are some tips.
What's your storage type? Do you have enough rpc threads? Maybe you should configure single buffer limit to increase the performance. 
For discussion, we have regular meetings every two weeks. Do you have wechat account? We now have Wechat group now.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bjQWM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/782,https://api.github.com/repos/apache/incubator-uniffle/issues/782,incubator-uniffle,1646847771,782,[Improvement] define RPC_SERVER_TYPE as an enum,advancedxy,807537,,,CLOSED,2023-03-30T03:29:51Z,2023-04-04T06:09:52Z,"There are multiple definitions of ServerType enums, let's refactor that in a new pr.

_Originally posted by @advancedxy in https://github.com/apache/incubator-uniffle/pull/777#discussion_r1152678451_
            ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/782/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/784,https://api.github.com/repos/apache/incubator-uniffle/issues/784,incubator-uniffle,1647132554,784,[Improvement] Make clientReadHandler thread safe,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-03-30T08:13:27Z,2023-03-30T08:13:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

To support clientReadHandler thread safe of reading shuffle data, for async read.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/784/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/790,https://api.github.com/repos/apache/incubator-uniffle/issues/790,incubator-uniffle,1651289475,790,[FEATURE] Client reports task failure to coordinator,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-04-03T04:02:40Z,2023-04-23T13:38:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We'd better to introduce the new api for client to report task failure to coordinator.
If so, we could benefit as following.
1. collect this reporting as metric to know more about uniffle cluster
2. more easier to find exception from task 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/790/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/790,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZBqtw,incubator-uniffle,1493609328,790,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-03T04:03:19Z,2023-04-03T04:03:19Z,cc @xumanbu @advancedxy @smallzhongfeng @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZBqtw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/790,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZCJvE,incubator-uniffle,1493736388,790,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-04-03T06:26:32Z,2023-04-03T06:26:32Z,I think it does make sense. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZCJvE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/790,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZIjP3,incubator-uniffle,1495413751,790,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-04T06:21:30Z,2023-04-04T06:21:30Z,Maybe we need a dashboard process instead of reporting failures to Coordinator.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZIjP3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/791,https://api.github.com/repos/apache/incubator-uniffle/issues/791,incubator-uniffle,1652238068,791,[Bug] case namenode rpc qps too high when all paritiion data written collectively,xumanbu,9135743,xumanbu,manbu.feng@163.com,OPEN,2023-04-03T14:56:58Z,2023-04-07T10:35:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

such as one shuffleId have too many partitions, if use MEMORY_HDFS OR MEMORY_LOCALFILE_HDFS storage type, when the stage startup, all parition data may collective flush to hdfs in a short time, so case namenode create rpc qps too high.

my solution:
I have change flush strategy, increase write priority for existing files,reduce write priority ofy for new files to avoid namenode create rpc too high. 

do you have any better suggestions to solve this problem?




### Affects Version(s)

0.6.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/791/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/791,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZFHhf,incubator-uniffle,1494513759,791,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-03T15:13:58Z,2023-04-03T15:13:58Z,cc @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZFHhf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/791,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZH3GM,incubator-uniffle,1495232908,791,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-04T02:01:54Z,2023-04-04T02:01:54Z,Why shuffleId with too many partitions will make namenode qps high? Could you help describe more? @xumanbu ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZH3GM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/791,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZIBNC,incubator-uniffle,1495274306,791,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-04-04T02:59:57Z,2023-04-04T02:59:57Z,"> Why shuffleId with too many partitions will make namenode qps high? Could you help describe more? @xumanbu

such as shuffle server have 100 shuffleId, earch shuffleId have 2048 partitions, when shuffle server Memory usage reaches the watermark, and new shuffle partition data write into continuely, so 100 * 2048 * 2(index file and data file) = 409600 files will flush to hdfs in a short time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZIBNC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/791,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZIG5-,incubator-uniffle,1495297662,791,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-04T03:35:33Z,2023-04-04T03:35:33Z,"> > Why shuffleId with too many partitions will make namenode qps high? Could you help describe more? @xumanbu
> 
> such as shuffle server have 100 shuffleId, earch shuffleId have 2048 partitions, when shuffle server Memory usage reaches the watermark, and new shuffle partition data write into continuely, so 100 * 2048 * 2(index file and data file) = 409600 files will flush to hdfs in a short time.

This will only occur in `MEMORY_HDFS`, right? So I think the best deploy mode is `MEMORY_LOCALFILE_HDFS`. And the HDFS is only as the HUGE PARTITIONs' house instead of normal partitions.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZIG5-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/791,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZIjBX,incubator-uniffle,1495412823,791,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-04T06:20:29Z,2023-04-04T06:20:29Z,We could extract an LimiterStrategy and add different strategies.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZIjBX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/791,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zaq4V,incubator-uniffle,1500163605,791,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-07T10:35:43Z,2023-04-07T10:35:43Z,"> We could extract an LimiterStrategy and add different strategies.

SGTM.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zaq4V/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/793,https://api.github.com/repos/apache/incubator-uniffle/issues/793,incubator-uniffle,1653108550,793,[FEATURE] output prometheus metrics with custom cluster labels,advancedxy,807537,,,CLOSED,2023-04-04T03:26:58Z,2023-04-06T09:49:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

There might be multiple clusters due to capacity limit or idc spreading. For example, the rss clusters might be deployed on multiple IDCs to fulfill different business needs. Therefore it's a nature need to identify different rss clusters.

Since there are multiple clusters, the metrics collected would be mixed together, I'd like to add the label of cluster name to the metrics produced by rss.

### Motivation

For better monitoring.

### Describe the solution

When the rss cluster start up, the cluster name env would be automatically injected(by rss operator) or configured by the administrator.

Coordinator and shuffle server would detect the cluster name and append it to the metrics produced.,

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/793/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/793,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZVal2,incubator-uniffle,1498786166,793,NA,advancedxy,807537,,,NA,2023-04-06T09:49:29Z,2023-04-06T09:49:29Z,"Closing this since pod name could contain cluster name info, there's no need to populate rss cluster name additionally.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZVal2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/794,https://api.github.com/repos/apache/incubator-uniffle/issues/794,incubator-uniffle,1653336614,794,[Improvement]  Support delete ShuffleServer pod with Evicted status,xianjingfeng,11752250,,,CLOSED,2023-04-04T07:25:07Z,2023-04-06T09:22:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When ShuffleServer pod is Evicted, we can't delete it.
If we try to delete it, the following logs will be printed
``` shell
can not delete the shuffle server pod (xxxxxx) directly
```

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/794/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/796,https://api.github.com/repos/apache/incubator-uniffle/issues/796,incubator-uniffle,1653515888,796,[Bug] Failed to obtain constructor for MetricReporter,xianjingfeng,11752250,,,CLOSED,2023-04-04T09:26:10Z,2023-04-07T03:12:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```
[ERROR] 2023-04-04 09:09:57,810 main ShuffleServer <init> - Errors on initializing shuffle server.
java.lang.NoSuchMethodException: org.apache.uniffle.common.metrics.prometheus.PrometheusPushGatewayMetricReporter.<init>(org.apache.uniffle.server.ShuffleServerConf, java.lang.String)
        at java.lang.Class.getConstructor0(Class.java:3082)
        at java.lang.Class.getConstructor(Class.java:1825)
        at org.apache.uniffle.common.metrics.MetricReporterFactory.getMetricReporter(MetricReporterFactory.java:36)
        at org.apache.uniffle.server.ShuffleServer.registerMetrics(ShuffleServer.java:247)
        at org.apache.uniffle.server.ShuffleServer.initialization(ShuffleServer.java:171)
        at org.apache.uniffle.server.ShuffleServer.<init>(ShuffleServer.java:85)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/796/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/799,https://api.github.com/repos/apache/incubator-uniffle/issues/799,incubator-uniffle,1657090863,799,[Improvement] use hdfs cluster label for remote storage metrics ,advancedxy,807537,,,CLOSED,2023-04-06T10:02:07Z,2023-04-07T02:32:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently,  the remote storage metrics is constructed as `some_write_metrics_remote_${cluster_host}`, for example:
```
storage_total_write_remote_abc_cluster_name
```

This is not an idiomatic metrics construction. 

### How should we improve?

The hdfs cluster could be a label for remote storage metrics, such as
```
storage_total_write_remote{hdfs_cluster='xxx'}
```

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/799/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/802,https://api.github.com/repos/apache/incubator-uniffle/issues/802,incubator-uniffle,1659354899,802,[Improvement] Implement the interface ShuffleDataIO,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-04-08T03:21:54Z,2023-10-10T11:12:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We can implement ShuffleDataIO
https://github.com/apache/spark/blob/master/core/src/main/java/org/apache/spark/shuffle/api/ShuffleDataIO.java
https://github.com/apache/spark/blob/master/core/src/main/java/org/apache/spark/shuffle/api/ShuffleDriverComponents.java
Dynamic Allocation don't need patch any more.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/802/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/802,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zf4NB,incubator-uniffle,1501528897,802,NA,beryllw,25627922,Junbo wang,beryllwang@gmail.com,NA,2023-04-10T08:04:55Z,2023-04-10T08:04:55Z,"I'm Interested in this, could you assign it to me？","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zf4NB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/802,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zf4dq,incubator-uniffle,1501529962,802,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-10T08:05:47Z,2023-04-10T08:05:47Z,"> I'm Interested in this, could you assign it to me？

OK, I have assigned to you.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zf4dq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/802,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZggJ9,incubator-uniffle,1501692541,802,NA,beryllw,25627922,Junbo wang,beryllwang@gmail.com,NA,2023-04-10T11:13:40Z,2023-04-10T11:13:40Z,"The patch [SPARK-42689] that allows ShuffleDriverComponent to declare if shuffle data is reliably stored has been fixed in Spark 3.5, which has not yet been released. Do I need to test it?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZggJ9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/802,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgjFP,incubator-uniffle,1501704527,802,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-10T11:18:32Z,2023-04-10T11:18:32Z,"Yes, you can build a spark client with master branch to test it.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZgjFP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/802,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZglyX,incubator-uniffle,1501715607,802,NA,beryllw,25627922,Junbo wang,beryllwang@gmail.com,NA,2023-04-10T11:31:04Z,2023-04-10T11:31:04Z,"> Yes, you can build a spark client with master branch to test it.

Okay, I will do that.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZglyX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/802,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i6jRn,incubator-uniffle,1659516007,802,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-08-01T03:40:05Z,2023-08-01T03:40:05Z,volunteering,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i6jRn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/802,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i6jrB,incubator-uniffle,1659517633,802,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-01T03:42:31Z,2023-08-01T03:42:31Z,"@Kwafoor If you're busy recently, let @summaryzb finish this issue first.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i6jrB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/803,https://api.github.com/repos/apache/incubator-uniffle/issues/803,incubator-uniffle,1659379373,803,"[Improvement] [MR] If reduce data is small, we don't need to pesist them",jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-04-08T04:23:21Z,2023-04-08T04:23:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We can refer to Spark, if reduce data is small enough, we don't need to persist them

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/803/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/804,https://api.github.com/repos/apache/incubator-uniffle/issues/804,incubator-uniffle,1659547612,804,[Improvement] Optimize CRC calculation of ByteBuffer,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-04-08T14:56:40Z,2023-04-10T04:38:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When we calculate the crc value, we need to copy data to byte array, it's unnecessary. We will use off heap  memory in the v 0.8. So CRC calculation should support off heap memory totally.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/804/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/808,https://api.github.com/repos/apache/incubator-uniffle/issues/808,incubator-uniffle,1661680511,808,[Bug] NullPointerException of WriterBuffer.getData due to race condition,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-04-11T02:42:15Z,2023-07-22T13:10:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

This bug is caused by #706 . After this, the `buffers` in `WriterBuffer` will be visited by multi threads. 

Stacktrace:

```
23/04/10 07:38:03 ERROR Executor: Exception in task 3025.0 in stage 0.0 (TID 676)
java.lang.NullPointerException
	at org.apache.spark.shuffle.writer.WriterBuffer.getData(WriterBuffer.java:77)
	at org.apache.spark.shuffle.writer.WriteBufferManager.createShuffleBlock(WriteBufferManager.java:224)
	at org.apache.spark.shuffle.writer.WriteBufferManager.clear(WriteBufferManager.java:213)
	at org.apache.spark.shuffle.writer.WriteBufferManager.addRecord(WriteBufferManager.java:198)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.doWrite(RssShuffleWriter.java:213)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:167)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)
	at org.apache.spark.scheduler.Task.run(Task.scala:131)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/808/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/808,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkAgU,incubator-uniffle,1502611476,808,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-11T02:43:13Z,2023-04-11T02:43:13Z,I want to use the thread safe list to solve this problem. WDYT? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkAgU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/808,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkAyt,incubator-uniffle,1502612653,808,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-11T02:45:40Z,2023-04-11T02:45:40Z,"> I want to use the thread safe list to solve this problem. WDYT? @jerqi

Ok for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkAyt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/808,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZldDd,incubator-uniffle,1502990557,808,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-11T09:30:34Z,2023-04-11T09:30:34Z,Oh. This bug may cause data lost.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZldDd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/808,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZlgZ8,incubator-uniffle,1503004284,808,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-11T09:41:17Z,2023-04-11T09:41:17Z,"> Oh. This bug may cause data lost.

I would like to revert #706 . I take a look at the pr that you fix. It seems that the mind is not clear for me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZlgZ8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/808,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zl3jr,incubator-uniffle,1503099115,808,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-11T10:47:46Z,2023-04-11T10:47:46Z,Why do this issue cause data lost? We have checked the block infos in the reader.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zl3jr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/809,https://api.github.com/repos/apache/incubator-uniffle/issues/809,incubator-uniffle,1661899550,809,[Flaky Test] ShuffleServerMetricsTest#testServerMetrics,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,OPEN,2023-04-11T07:14:22Z,2023-04-17T08:40:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

When run
```
mvn clean test -Pspark3.2
mvn clean test -Pspark2
```
it would cause
```
[ERROR] Tests run: 5, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.31 s <<< FAILURE! - in org.apache.uniffle.server.ShuffleServerMetricsTest
[ERROR] testServerMetrics  Time elapsed: 0.225 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: array contents differ at index [1], expected: <hdfs1> but was: <localhost>
        at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:39)
        at org.junit.jupiter.api.AssertArrayEquals.failArraysNotEqual(AssertArrayEquals.java:432)
        at org.junit.jupiter.api.AssertArrayEquals.assertArrayElementsEqual(AssertArrayEquals.java:392)
        at org.junit.jupiter.api.AssertArrayEquals.assertArrayEquals(AssertArrayEquals.java:349)
        at org.junit.jupiter.api.AssertArrayEquals.assertArrayEquals(AssertArrayEquals.java:162)
        at org.junit.jupiter.api.AssertArrayEquals.assertArrayEquals(AssertArrayEquals.java:158)
        at org.junit.jupiter.api.Assertions.assertArrayEquals(Assertions.java:1452)
        at org.apache.uniffle.server.ShuffleServerMetricsTest.validateMetrics(ShuffleServerMetricsTest.java:119)
        at org.apache.uniffle.server.ShuffleServerMetricsTest.testServerMetrics(ShuffleServerMetricsTest.java:109)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
```

### Actions URL

Running `mvn clean test -Pspark2` locally will replicate

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/809/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/809,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkuKB,incubator-uniffle,1502798465,809,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-04-11T07:15:58Z,2023-04-11T07:15:58Z,"cc @advancedxy it seems occur after #799 But I'm not sure if this is the reason, if you have time, PTAL.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ZkuKB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/810,https://api.github.com/repos/apache/incubator-uniffle/issues/810,incubator-uniffle,1662006710,810,[FEATURE] Introduce the unified memory pool for less GC and better management,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-04-11T08:28:54Z,2023-04-11T08:28:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, shuffle data is stored in a byte array created by Grpc in a single transfer. While this approach works well for small data, it can cause excessive garbage collection (GC) for large data.

By switching to Netty, we can avoid GC issues caused by having too many on-heap objects, as all data will be stored off-heap. However, if we use Netty's bytebuf, it may not be clear when memory is freed.

In any case, a unified memory pool is necessary for the shuffle server.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/810/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/817,https://api.github.com/repos/apache/incubator-uniffle/issues/817,incubator-uniffle,1663994375,817,[Improvement] Add parameter test for repartitionTest,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-04-12T07:19:59Z,2023-04-12T07:20:21Z,"The repartition test takes too long time. So we use random parameter. If we can optimize the time, we should use parameter test to test all cases.

_Originally posted by @smallzhongfeng in https://github.com/apache/incubator-uniffle/pull/806#discussion_r1163709167_
            ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/817/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/819,https://api.github.com/repos/apache/incubator-uniffle/issues/819,incubator-uniffle,1664159102,819,[Subtask] [Tez] Tez ApplicationMaster supporting RemoteShuffle,baitian77,14013778,,,CLOSED,2023-04-12T09:08:40Z,2023-06-06T07:08:52Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Extend Tez ApplicationMaster context to support RemoteShuffle

### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/819/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/819,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zs3qj,incubator-uniffle,1504934563,819,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-12T09:13:50Z,2023-04-12T09:13:50Z,Do the Tez need extra patch? Maybe we should submit the patch first.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5Zs3qj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/825,incubator-uniffle,1670576345,825,[Umbrella] Dynamic shuffle server assignment,advancedxy,807537,,,CLOSED,2023-04-17T07:22:54Z,2023-11-15T07:43:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Currently, the shuffle server assignment info(for spark) is created when the shuffle is registered on driver side. `RssShuffleHandleInfo` holds the assignment info and is immutable. Therefore, the shuffle server assignment info is static. This simplifies reader and writer implementation which sacrifices flexibility.

When developing #477, there's one piece left to fully enable stage re-submit: regenerating the shuffle server assignments when the whole stage is re-submitted.

In this proposal, I'd like to propose to support dynamic shuffle server assignments during stage resubmission or detecting bad shuffle servers on the fly.

To archive that, there are some parts needs to be updated:
1. add new interfaces to ShufffleManagerGrpcService to generate shuffle server assignment dynamically
2. Corresponding ShuffleManagerClient
3. ShuffleRead/Write client and RssShuffleManager which eliminate the use of `RssShuffleHandleInfo`
4. Rethought/rework of reader's data check part
5. Maybe a unified and static shuffle client to share shuffle assignments, otherwise it would be costly to retrieve shuffle assignments for each task.

### Task list

TBD

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/825/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDYv0,incubator-uniffle,1510837236,825,NA,advancedxy,807537,,,NA,2023-04-17T07:24:21Z,2023-04-17T07:24:21Z,"@zjf2012 @zuston @jerqi @xianjingfeng @smallzhongfeng Please take a look at this issue, do you have any other input?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDYv0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDiZe,incubator-uniffle,1510876766,825,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-17T07:57:24Z,2023-04-17T07:57:24Z,Maybe we should keep the origin implement and a config option for new implement.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDiZe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDojq,incubator-uniffle,1510901994,825,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-17T08:13:30Z,2023-04-17T08:13:30Z,"Really looking forward this. Thanks @advancedxy in advance. 😺

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDojq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDwrP,incubator-uniffle,1510935247,825,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-04-17T08:38:46Z,2023-04-17T08:38:46Z,"> Maybe we should keep the origin implement and a config option for new implement.

+1 for this advice.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aDwrP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aD2iQ,incubator-uniffle,1510959248,825,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-04-17T08:56:45Z,2023-04-17T08:56:45Z,"Maybe we can increase the granularity of partitions->shuffle servers mappings to reduce overhead. Instead of mapping per partition, we can map by partition range or partition hash/modulo.

Just my piece of thought.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aD2iQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aEAoE,incubator-uniffle,1511000580,825,NA,advancedxy,807537,,,NA,2023-04-17T09:23:21Z,2023-04-17T09:23:21Z,"> Maybe we should keep the origin implement and a config option for new implement.

It might be difficult to keep the original implementation and new one in the same code path. Let's discuss more when reviewing.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aEAoE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aQ0rP,incubator-uniffle,1514359503,825,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-19T08:44:57Z,2023-04-19T08:44:57Z,A critical problem is that how to inform the servers that we will assign a new server. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aQ0rP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aXMkz,incubator-uniffle,1516030259,825,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-04-20T09:42:05Z,2023-04-20T09:42:05Z,"> 



> Maybe we can increase the granularity of partitions->shuffle servers mappings to reduce overhead. Instead of mapping per partition, we can map by partition range or partition hash/modulo.
> 
> Just my piece of thought.

+1. we can assgin shuffle server seq for per partition,when the first server is unhealthy or crashed, the second server will served for this parition.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aXMkz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aisNH,incubator-uniffle,1519043399,825,NA,advancedxy,807537,,,NA,2023-04-23T11:36:51Z,2023-04-23T11:36:51Z,"> A critical problem is that how to inform the servers that we will assign a new server.

`inform the servers` what servers do you mean?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aisNH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aisW7,incubator-uniffle,1519044027,825,NA,advancedxy,807537,,,NA,2023-04-23T11:40:17Z,2023-04-23T11:40:17Z,"



> Maybe we can increase the granularity of partitions->shuffle servers mappings to reduce overhead. Instead of mapping per partition, we can map by partition range or partition hash/modulo.
> 
> Just my piece of thought.

could you elaborate a bit more? We were considering partition range, but it's not that effective. We may reconsider in the near feature.

Even the partitions are grouped in ranges, the partition to server mapping still would be a complete view of all partitions/ranges.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aisW7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aisbd,incubator-uniffle,1519044317,825,NA,advancedxy,807537,,,NA,2023-04-23T11:41:40Z,2023-04-23T11:41:40Z,"> > 
> 
> > Maybe we can increase the granularity of partitions->shuffle servers mappings to reduce overhead. Instead of mapping per partition, we can map by partition range or partition hash/modulo.
> > Just my piece of thought.
> 
> +1. we can assgin shuffle server seq for per partition,when the first server is unhealthy or crashed, the second server will served for this parition.

That seems another optimization, which is orthogonal with dynamic shuffle server assignments.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aisbd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aisiG,incubator-uniffle,1519044742,825,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-23T11:44:10Z,2023-04-23T11:44:10Z,"> > A critical problem is that how to inform the servers that we will assign a new server.
> 
> `inform the servers` what servers do you mean?

I mean that we should how to inform the executors that we have updated shuffle servers. Do we only know the shuffle server allocation at the beginning of the stage or the beginning of the stage re-attempt? Could we add shuffle server for some partitions when the stage is running? If we can, how to inform the executors that we have assign new shuffle servers?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aisiG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aizFA,incubator-uniffle,1519071552,825,NA,advancedxy,807537,,,NA,2023-04-23T13:45:49Z,2023-04-23T13:45:49Z,"> > > A critical problem is that how to inform the servers that we will assign a new server.
> > 
> > 
> > `inform the servers` what servers do you mean?
> 
> I mean that we should how to inform the executors that we have updated shuffle servers. Do we only know the shuffle server allocation at the beginning of the stage or the beginning of the stage re-attempt? Could we add shuffle server for some partitions when the stage is running? If we can, how to inform the executors that we have assign new shuffle servers?

Each task will retrieve new shuffle assignment from driver with local cache on the executor side. So once a new server is added, new tasks will get new shuffle server assignments. Old tasks wouldn't get a chance to update shuffle server assignments. It would either failed/abort due to bad shuffle server or write shuffle data successfully. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aizFA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai0kg,incubator-uniffle,1519077664,825,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-23T14:14:11Z,2023-04-23T14:14:11Z,"> > > > A critical problem is that how to inform the servers that we will assign a new server.
> > > 
> > > 
> > > `inform the servers` what servers do you mean?
> > 
> > 
> > I mean that we should how to inform the executors that we have updated shuffle servers. Do we only know the shuffle server allocation at the beginning of the stage or the beginning of the stage re-attempt? Could we add shuffle server for some partitions when the stage is running? If we can, how to inform the executors that we have assign new shuffle servers?
> 
> Each task will retrieve new shuffle assignment from driver with local cache on the executor side. So once a new server is added, new tasks will get new shuffle server assignments. Old tasks wouldn't get a chance to update shuffle server assignments. It would either failed/abort due to bad shuffle server or write shuffle data successfully.

Will it cause too much pressure if we don't executor's level shuffle server info cache.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai0kg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai0xh,incubator-uniffle,1519078497,825,NA,advancedxy,807537,,,NA,2023-04-23T14:17:48Z,2023-04-23T14:17:48Z,"The executor side cache of shuffle server assignments should be added, otherwise, it will introduce much overhead.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai0xh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5akOG7,incubator-uniffle,1519444411,825,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-04-24T06:10:21Z,2023-04-24T06:10:21Z,"> > Maybe we can increase the granularity of partitions->shuffle servers mappings to reduce overhead. Instead of mapping per partition, we can map by partition range or partition hash/modulo.
> > Just my piece of thought.
> 
> could you elaborate a bit more? We were considering partition range, but it's not that effective. We may reconsider in the near feature.
> 
> Even the partitions are grouped in ranges, the partition to server mapping still would be a complete view of all partitions/ranges.

Have you tried the Java TreeMap? It's a good candidate for range search instead of maintaining partitions/ranges map. Please check https://docs.oracle.com/javase/8/docs/api/java/util/TreeMap.html#higherEntry-K-. Keys are range values. Values are servers.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5akOG7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gvuzb,incubator-uniffle,1623125211,825,NA,yl09099,33595968,,,NA,2023-07-06T07:21:35Z,2023-07-06T07:21:35Z,"@advancedxy @jerqi We need the implementation of this function, could you please assign this issue to me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gvuzb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gyObK,incubator-uniffle,1623779018,825,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-06T14:25:27Z,2023-07-06T14:25:27Z,"> @advancedxy @jerqi We need the implementation of this function, could you please assign this issue to me.

Thanks","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gyObK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hNeqE,incubator-uniffle,1630923396,825,NA,advancedxy,807537,,,NA,2023-07-11T14:20:01Z,2023-07-11T14:20:01Z,"> @advancedxy @jerqi We need the implementation of this function, could you please assign this issue to me.

Thanks for taking this over, I am a bit of busy these days. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hNeqE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jJDic,incubator-uniffle,1663318172,825,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-03T05:34:38Z,2023-08-03T05:34:38Z,Any process? I think this is a huge improvement for uniffle. @yl09099 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jJDic/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jJKS-,incubator-uniffle,1663345854,825,NA,yl09099,33595968,,,NA,2023-08-03T06:10:24Z,2023-08-03T06:10:24Z,"> Any process? I think this is a huge improvement for uniffle. @yl09099

The development has been completed and the integration test is under way. I will submit it for review tomorrow or the day after tomorrow","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jJKS-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jJaRl,incubator-uniffle,1663411301,825,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-03T07:09:33Z,2023-08-03T07:09:33Z,"> > Any process? I think this is a huge improvement for uniffle. @yl09099
> 
> The development has been completed and the integration test is under way. I will submit it for review tomorrow or the day after tomorrow

Awesome! Do you mind publishing a draft design doc for me? I'm so glad to review this. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jJaRl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/825,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sADXH,incubator-uniffle,1811953095,825,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-15T07:43:21Z,2023-11-15T07:43:21Z,Can we disable this dynamic assignment manually ? @yl09099 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sADXH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/827,https://api.github.com/repos/apache/incubator-uniffle/issues/827,incubator-uniffle,1672491591,827,[FEATURE] Support generating HPA objects,wangao1236,12544973,jasonawang,908622977@qq.com,CLOSED,2023-04-18T07:08:47Z,2023-04-21T08:23:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We need to support ShuffleServer to use HPA objects to achieve horizontal automatic scaling.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/827/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/831,https://api.github.com/repos/apache/incubator-uniffle/issues/831,incubator-uniffle,1675163144,831,[Subtask] [Tez] Tez patch to support remoteshuffle,bin41215,74609438,,,CLOSED,2023-04-19T15:35:27Z,2023-06-28T14:31:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Supports configurable edge information. 

### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/831/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/831,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gDhCJ,incubator-uniffle,1611534473,831,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-28T14:31:20Z,2023-06-28T14:31:20Z,No needed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gDhCJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/834,https://api.github.com/repos/apache/incubator-uniffle/issues/834,incubator-uniffle,1677077569,834,[Bug] Occasionally client sent blocks to server time out.,bin41215,74609438,,,OPEN,2023-04-20T16:48:52Z,2024-01-04T17:16:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

tez writes data to the server (refer to mr's method), and occasionally sends data time out. (10min)

![image](https://user-images.githubusercontent.com/74609438/233433540-b56663ed-82a5-428c-a436-f587bfb21c1d.png)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/834/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/834,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5abYX8,incubator-uniffle,1517127164,834,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-21T01:24:18Z,2023-04-21T01:24:18Z,"The detailed stacktrace is missing, could you help attach more? 

BTW, one possible problem is the server GC. But this should be confirmed by more info.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5abYX8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/834,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bfZPr,incubator-uniffle,1534956523,834,NA,bin41215,74609438,,,NA,2023-05-04T15:12:10Z,2023-05-04T15:12:10Z,"> The detailed stacktrace is missing, could you help attach more?
> 
> BTW, one possible problem is the server GC. But this should be confirmed by more info.

Sorry, I was delayed by other things these days.
This problem seems to be the problem of shuffleId when the tez client is implemented. It has been modified here, and it will be observed for a few days. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bfZPr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/834,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5v6Aj1,incubator-uniffle,1877477621,834,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-04T17:16:51Z,2024-01-04T17:16:51Z,"You can  update to the latest uniffle version. 
And is this problem show again ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5v6Aj1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/836,https://api.github.com/repos/apache/incubator-uniffle/issues/836,incubator-uniffle,1678244306,836,[Subtask] Display information of all servers through `Cli`,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,OPEN,2023-04-21T09:57:28Z,2023-05-29T15:15:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Display the information of all servers through the `Cli` command such as `uniffle-cli --list nodes `

### Parent issue

#758 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/836/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/836,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a3-Pl,incubator-uniffle,1524622309,836,NA,zhtttylz,54506205,zhtttylz,hualong.z@hotmail.com,NA,2023-04-27T03:41:35Z,2023-04-27T03:41:35Z,@smallzhongfeng Can I assign this issue? Thank you very much!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a3-Pl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/836,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5daiMj,incubator-uniffle,1567236899,836,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-29T14:52:50Z,2023-05-29T14:52:50Z,"> @smallzhongfeng Can I assign this issue? Thank you very much!

We usually use rest api to control admin service. If we need add api, we would better add rest api. Could we keep consistent with other operation. You can refer to https://github.com/apache/incubator-uniffle/pull/684","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5daiMj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/836,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dao5P,incubator-uniffle,1567264335,836,NA,zhtttylz,54506205,zhtttylz,hualong.z@hotmail.com,NA,2023-05-29T15:15:04Z,2023-05-29T15:15:04Z,@jerqi Thank you very much for your suggestion. I will promptly submit the code for this issue as per your request.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dao5P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/837,https://api.github.com/repos/apache/incubator-uniffle/issues/837,incubator-uniffle,1678247339,837,[Subtask] Display information of all application through `Cli`,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,CLOSED,2023-04-21T09:58:55Z,2023-08-11T09:21:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Display the information of all servers through the `Cli` command such as `uniffle-cli --list application` 

### Parent issue

#758 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/837/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/837,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a3-PR,incubator-uniffle,1524622289,837,NA,slfan1989,55643692,,,NA,2023-04-27T03:41:34Z,2023-04-27T03:41:34Z,@smallzhongfeng Can you assign this issue to me? Thank you very much!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a3-PR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/837,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5daiXx,incubator-uniffle,1567237617,837,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-29T14:53:36Z,2023-05-29T14:53:36Z,"> @smallzhongfeng Can you assign this issue to me? Thank you very much!

We usually use rest api to control admin service. If we need add api, we would better add rest api. Could we keep consistent with other operation. You can refer to https://github.com/apache/incubator-uniffle/pull/684","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5daiXx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/837,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d5-7g,incubator-uniffle,1575481056,837,NA,slfan1989,55643692,,,NA,2023-06-04T09:09:50Z,2023-06-04T09:09:50Z,"@jerqi Thank you very much for your suggestion, I will finish this pr as soon as possible. Sorry for the late reply.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d5-7g/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/838,incubator-uniffle,1679873689,838,[Improvement] Better support for  AQE sortMergeJoin -> broadcastHashJoin,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-04-23T05:59:35Z,2023-04-23T14:36:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In #630 , we disable the `localShuffleRead` for AQE in spark. For a pity, sometimes the partial partition is so huge, but the broadcastHashJoin won't optimize skew join. This optimization will be solved by spark community ASSP.

After that, I will propose a new patch for uniffle to better support Spark older version.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/838/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiWMk,incubator-uniffle,1518953252,838,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-23T05:59:43Z,2023-04-23T05:59:43Z,cc @advancedxy @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiWMk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiYLb,incubator-uniffle,1518961371,838,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-23T06:28:54Z,2023-04-23T06:28:54Z,"I can't get your point. If you want to push a Spark's feature patch to `patch` directory of project Uniffle, I will vote -1.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiYLb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aihdC,incubator-uniffle,1518999362,838,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-23T08:53:50Z,2023-04-23T08:53:50Z,"> This optimization will be solved by spark community ASSP. After that, I will propose a new patch for uniffle to better support Spark older version.

I mean this optimization should be proposed to Spark community. After that, I will propose a new patch to older spark version to support this optimization.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aihdC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aihu0,incubator-uniffle,1519000500,838,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-23T08:57:31Z,2023-04-23T08:57:31Z,"


> > This optimization will be solved by spark community ASSP. After that, I will propose a new patch for uniffle to better support Spark older version.
> 
> I mean this optimization should be proposed to Spark community. After that, I will propose a new patch to older spark version to support this optimization.

How do you support the old spark versions?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aihu0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aihzD,incubator-uniffle,1519000771,838,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-23T08:58:10Z,2023-04-23T08:58:10Z,like spark3.1.1 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aihzD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiiyj,incubator-uniffle,1519004835,838,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-23T09:10:31Z,2023-04-23T09:10:31Z,"> like spark3.1.1

I wanna ask you how not what.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiiyj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aii-z,incubator-uniffle,1519005619,838,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-23T09:13:12Z,2023-04-23T09:13:12Z,"https://github.com/apache/incubator-uniffle/tree/master/patch/spark. Like this.

I don't quite understand what is unclear about my expression. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aii-z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aijSU,incubator-uniffle,1519006868,838,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-23T09:17:04Z,2023-04-23T09:17:04Z,"> https://github.com/apache/incubator-uniffle/tree/master/patch/spark. Like this.
> 
> I don't quite understand what is unclear about my expression.

I reject. Because we should avoid modifying the Spark code. It's unrelated to Uniffle although it will improve the performance of Uniffle. If you need this, you should cherry-pick this feature to your internal branch.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aijSU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aikHR,incubator-uniffle,1519010257,838,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-23T09:28:50Z,2023-04-23T09:28:50Z,"> I reject. Because we should avoid modifying the Spark code. It's unrelated to Uniffle although it will improve the performance of Uniffle. If you need this, you should cherry-pick this feature to your internal branch.

It's OK.

The reason of proposing this is to expose the problem of using uniffle(RSS) with spark AQE poor performance. Those using uniffle should pay more attension on this. And all optimization about this could be tracked here. 

If you reject this, we could keep this issue open and attach the related spark optimization PR here if exists.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aikHR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aikW4,incubator-uniffle,1519011256,838,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-23T09:32:20Z,2023-04-23T09:32:20Z,You can modify the document https://github.com/apache/incubator-uniffle-website/blob/master/docs/07-tuning.md.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aikW4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiklL,incubator-uniffle,1519012171,838,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-23T09:35:42Z,2023-04-23T09:35:42Z,Let's discuss first if anyone is interested,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiklL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5airvj,incubator-uniffle,1519041507,838,NA,advancedxy,807537,,,NA,2023-04-23T11:27:25Z,2023-04-23T11:27:25Z,"> For a pity, sometimes the partial partition is so huge, but the broadcastHashJoin won't optimize skew join. This optimization will be solved by spark community ASSP

If skewed join should not be converted into broadcast join, users should disable broadcast join or lower threshold for broadcast join by tweaking relating configurations.

I didn't see how that a spark patch is related, even if the patch was to release users from manually setting here, I don't think the patch belongs to Uniffle's project.   However we can add documentations about that cases.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5airvj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiwhF,incubator-uniffle,1519061061,838,NA,pan3793,26535726,Cheng Pan,chengpan@apache.org,NA,2023-04-23T12:54:29Z,2023-04-23T12:54:29Z,Kyuubi project tackles this issue by allowing to forcibly shuffle before the join operator https://github.com/apache/kyuubi/blob/master/extensions/spark/kyuubi-extension-spark-3-3/src/main/scala/org/apache/kyuubi/sql/InsertShuffleNodeBeforeJoin.scala#L38,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiwhF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aixZY,incubator-uniffle,1519064664,838,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-23T13:10:27Z,2023-04-23T13:10:27Z,"Oh, it has been proposed but still reviewing. https://github.com/apache/spark/pull/40312","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aixZY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiyqv,incubator-uniffle,1519069871,838,NA,advancedxy,807537,,,NA,2023-04-23T13:36:30Z,2023-04-23T13:36:30Z,"> https://github.com/apache/kyuubi/blob/master/extensions/spark/kyuubi-extension-spark-3-3/src/main/scala/org/apache/kyuubi/sql/InsertShuffleNodeBeforeJoin.scala#L38

Thanks for pointing to this. It's interesting and clever way to add new rules and syntax using Spark extension mechanism..

> Oh, it has been proposed but still reviewing. https://github.com/apache/spark/pull/40312

In my opinion, this is just another optimize SkewJoin rule, which should be integrated into your internal Spark code if it's not merged into Spark upstream yet. Optimizing skew joins is out of the scope of Uniffle project. However, if these optimization rules is well maintained elsewhere out of Uniffle project(maybe kyubi?), I believe the community is more than happy to add it to the tuning document in details.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5aiyqv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai1cQ,incubator-uniffle,1519081232,838,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-23T14:31:55Z,2023-04-23T14:31:55Z,"> In my opinion, this is just another optimize SkewJoin rule, which should be integrated into your internal Spark code if it's not merged into Spark upstream yet. Optimizing skew joins is out of the scope of Uniffle project. However, if these optimization rules is well maintained elsewhere out of Uniffle project(maybe kyubi?), I believe the community is more than happy to add it to the tuning document in details.

Yes. I have to re-claim the thought, just to share some performance ideas for Spark & Uniffle. I’m OK for keeping this patch out of uniffle. 

And this optimization is a really good improvement for RSS. Today I met the same problem in the transfer process from hive to spark. 

One task with huge partition ran too long time due to lacking skew join optimization of broadcastHashJoin when disable the local shuffle read","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai1cQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/838,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai1tS,incubator-uniffle,1519082322,838,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-23T14:36:59Z,2023-04-23T14:36:59Z,"> Kyuubi project tackles this issue by allowing to forcibly shuffle before the join operator https://github.com/apache/kyuubi/blob/master/extensions/spark/kyuubi-extension-spark-3-3/src/main/scala/org/apache/kyuubi/sql/InsertShuffleNodeBeforeJoin.scala#L38

Good way!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ai1tS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/841,https://api.github.com/repos/apache/incubator-uniffle/issues/841,incubator-uniffle,1684364974,841,[FEATURE] Support deprecated keys for ConfigOptions,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-04-26T06:31:50Z,2023-04-27T05:20:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Sometimes, in the latest commit it will rename the original config key. To achieve better compatibility, it's time to support deprecated keys for `ConfigOptions` . 

Please refer Flink config implementation.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/841/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/841,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a4Vnw,incubator-uniffle,1524718064,841,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-27T05:20:11Z,2023-04-27T05:20:11Z,#841 Done,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a4Vnw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/845,https://api.github.com/repos/apache/incubator-uniffle/issues/845,incubator-uniffle,1684907101,845,[FEATURE] Support local storage capacity selector for per-partition,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-04-26T12:12:07Z,2023-04-28T03:50:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the local storage of per-partition is selected by hash strategy. This is simple but will cause many problems, like many huge partitions will store in the same local disk, if the hash number is same. I know this is rare but it has happened in our internal env.

So it's better to support remaining space based storage selector for per-partition. And I will introduce the pluggable local storage selector, but I'm not sure whether it could support multiple disk storages for one-partition.

Anyway, the pluggable storage selector for localStorageManager is the first step to achieve above.


### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/845/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/845,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a3WZX,incubator-uniffle,1524459095,845,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-27T02:07:12Z,2023-04-27T02:07:12Z,"WDYT? @jerqi 

I remember you also want to do this. @advancedxy Right?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a3WZX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/845,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bAiAJ,incubator-uniffle,1526865929,845,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-28T01:51:28Z,2023-04-28T01:51:28Z,My concern is that the partition's meta data occupy too much memory.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bAiAJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/845,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bAzrs,incubator-uniffle,1526938348,845,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-28T03:37:18Z,2023-04-28T03:37:18Z,"> My concern is that the partition's meta data occupy too much memory.

The capacity based per-partition storage selector will not cost memory. It just calculate the max free capacity storage for per-partition. 

I think the multiple storage for one partition you mean will cost too much memory. Right? Yes, It will. But currently, I will not do this and we still don't encounter similar problems.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bAzrs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/845,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bA1Hu,incubator-uniffle,1526944238,845,NA,advancedxy,807537,,,NA,2023-04-28T03:47:04Z,2023-04-28T03:47:04Z,"> like many huge partitions will store in the same local disk, if the hash number is same. I know this is rare but it has happened in our internal env.

how often does this happen? This problem would be rare, and spark would also suffer this problem?

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bA1Hu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/845,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bA1lW,incubator-uniffle,1526946134,845,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-28T03:50:18Z,2023-04-28T03:50:18Z,"Seldom. Yes, spark will. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bA1lW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/846,https://api.github.com/repos/apache/incubator-uniffle/issues/846,incubator-uniffle,1686035990,846,[Subtask] Service's start & stop & restart through `Cli`,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,OPEN,2023-04-27T03:39:11Z,2023-05-27T08:02:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Start services through cli (including `shuffleServer`, `coordinator`)

### Parent issue

#758 

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/846/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/846,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a394W,incubator-uniffle,1524620822,846,NA,slfan1989,55643692,,,NA,2023-04-27T03:40:47Z,2023-04-27T03:40:47Z,@smallzhongfeng Can you assign this issue to me?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5a394W/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/846,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ckmhi,incubator-uniffle,1553098850,846,NA,slfan1989,55643692,,,NA,2023-05-18T13:57:05Z,2023-05-18T13:57:05Z,"I will submit the code as soon as possible, 2-3days.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ckmhi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/846,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dSyml,incubator-uniffle,1565206949,846,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-27T04:53:07Z,2023-05-27T04:53:07Z,"> I will submit the code as soon as possible, 2-3days.

@slfan1989 We usually use rest api to control admin service. If we need add api, we would better add rest api. Could we keep consistent with other operation. You can refer to https://github.com/apache/incubator-uniffle/pull/684","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dSyml/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/849,https://api.github.com/repos/apache/incubator-uniffle/issues/849,incubator-uniffle,1688154760,849,[FEATURE] Put partition's blockIds info into Spark driver or MR appMaster,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-04-28T08:46:01Z,2023-04-29T01:53:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the partition data's blocks will be stored in the shuffle server, which will cost too much memory. And the less state will benefit maintenance

In #777, a new connection of driver and executor has been created, how about putting the blocks' info into Spark driver or MR appMaster? 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/849/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/849,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bB1UY,incubator-uniffle,1527207192,849,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-28T08:48:08Z,2023-04-28T08:48:08Z,@advancedxy How about this?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bB1UY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/849,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bB5Ia,incubator-uniffle,1527222810,849,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-28T08:59:23Z,2023-04-28T08:59:23Z,"-1, I have tried to put shuffle blocks to one machine. It's too slow.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bB5Ia/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/849,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bCDjb,incubator-uniffle,1527265499,849,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-28T09:29:18Z,2023-04-28T09:29:18Z,"> -1, I have tried to put shuffle blocks to one machine. It's too slow.

Why putting app's blockIds into one machine will slow? Could you help elaborate more?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bCDjb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/849,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bCGRo,incubator-uniffle,1527276648,849,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-04-28T09:38:01Z,2023-04-28T09:38:01Z,"> > -1, I have tried to put shuffle blocks to one machine. It's too slow.
> 
> Why putting app's blockIds into one machine will slow? Could you help elaborate more?

AppMaster and Driver become single node. And bitmap add operation is very slow.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bCGRo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/849,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bGm7b,incubator-uniffle,1528458971,849,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-04-29T01:53:35Z,2023-04-29T01:53:35Z,"> AppMaster and Driver become single node.

If the driver or appMaster is down, app also will fail. So the single node is acceptable for the shuffle.

>  And bitmap add operation is very slow.

This may slow down the driver. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5bGm7b/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/851,https://api.github.com/repos/apache/incubator-uniffle/issues/851,incubator-uniffle,1699453192,851,[Improvement] Add a similar util method like ThreadUtils.parmap in the Spark,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-05-08T03:38:58Z,2023-12-27T01:59:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We usaully use multiple threads to send rpc requests, we should have a method similar to https://github.com/apache/spark/blob/d157b2d9a71c8370612342b298f0e6757c9b9b78/core/src/main/scala/org/apache/spark/util/ThreadUtils.scala#LL388C11-L388C11
Uniffle have similar logic in many places, like
https://github.com/apache/incubator-uniffle/blob/a3ca2585487265cf791d5a0c6f401041eb3f4b55/client/src/main/java/org/apache/uniffle/client/impl/ShuffleWriteClientImpl.java#L744
We can add a method parmap in the ThreadUtil to reduce repeated logic.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/851/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/851,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5br1qO,incubator-uniffle,1538218638,851,NA,zhtttylz,54506205,zhtttylz,hualong.z@hotmail.com,NA,2023-05-08T11:40:10Z,2023-05-08T11:40:10Z,Can you assign to me this issue? Thank you very much!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5br1qO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/851,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fzk_L,incubator-uniffle,1607356363,851,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-26T12:20:28Z,2023-06-26T12:20:28Z,"> Can you assign to me this issue? Thank you very much!

You can also refer to the implement of Iceberg   https://github.com/apache/iceberg/blob/9f12b85667362dbf0cc1bbb16972602a103938a8/core/src/main/java/org/apache/iceberg/util/Tasks.java#L294","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fzk_L/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/851,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jnPCY,incubator-uniffle,1671229592,851,NA,zhuyaogai,18461102,Fantasy-Jay,,NA,2023-08-09T12:25:12Z,2023-08-09T12:25:12Z,"> Can you assign to me this issue? Thank you very much!

@zhtttylz hi, are you still working on this issue? May I pr for this issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jnPCY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/851,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jnZ5r,incubator-uniffle,1671274091,851,NA,zhtttylz,54506205,zhtttylz,hualong.z@hotmail.com,NA,2023-08-09T12:54:10Z,2023-08-09T12:54:10Z,"> > Can you assign to me this issue? Thank you very much!
> 
> @zhtttylz hi, are you still working on this issue? May I pr for this issue?

 I will work on this PR as soon as possible :)","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jnZ5r/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/854,https://api.github.com/repos/apache/incubator-uniffle/issues/854,incubator-uniffle,1700413434,854,[Subtask] [Tez] Tez Shuffle Read supporting RemoteShuffle,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-05-08T14:56:08Z,2023-06-06T11:39:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Tez Shuffle Read supporting RemoteShuffle

### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/854/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/855,https://api.github.com/repos/apache/incubator-uniffle/issues/855,incubator-uniffle,1700602038,855,[Subtask] [Tez] Tez Shuffle Write supporting RemoteShuffle,bin41215,74609438,,,CLOSED,2023-05-08T17:00:43Z,2023-06-12T10:04:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Tez Shuffle Write supporting RemoteShuffle, RssOrderedPartitionedKVOutput, RssUnorderedPartitionedKVOutput, RssUnorderedKVOutput


### Parent issue

#321 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/855/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/859,https://api.github.com/repos/apache/incubator-uniffle/issues/859,incubator-uniffle,1703075179,859,[Improvement] ShuffleServer set MALLOC_ARENA_MAX,rhh777,41908930,haorenhui,haorenhui0911@163.com,CLOSED,2023-05-10T03:51:40Z,2023-05-10T08:32:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When the shuffle server is deployed in the container, the memory keeps soaring until it exceeds the container's memory limit, and then the container is OOMKill. After checking the memory usage, it is found that there are a large number of 64 MB memory blocks.
Reference:
https://github.com/prestodb/presto/issues/8993
https://issues.apache.org/jira/browse/HADOOP-7154
<img width=""777"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/41908930/fd9aebeb-3417-483d-b55a-4d98ad38d81d"">

<img width=""1251"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/41908930/7cd8fe60-0fa6-4000-95c6-7c87af89152e"">



### How should we improve?

In start-shuffle-server.sh,  set MALLOC_ARENA_MAX(default cpu core * 8) to control memory application/usage 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/859/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/863,https://api.github.com/repos/apache/incubator-uniffle/issues/863,incubator-uniffle,1703762984,863,[Improvement] Exclude node files support comments for easy annotation of changes,yl09099,33595968,,,CLOSED,2023-05-10T11:56:54Z,2023-05-11T04:21:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

exclude node files support comments for easy annotation of changes

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/863/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/864,https://api.github.com/repos/apache/incubator-uniffle/issues/864,incubator-uniffle,1704125299,864,[Improvement] Introduce Jersey to strengthen REST API,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-05-10T14:56:25Z,2023-07-07T16:11:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

As the discussion https://github.com/apache/incubator-uniffle/pull/684#discussion_r1126039877
We would better introduce Jersey to strengthen REST API
It will be helpful for operation.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/864/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/865,https://api.github.com/repos/apache/incubator-uniffle/issues/865,incubator-uniffle,1704136672,865,[Bug] Adding server LocalStorageChecker HealthChecks fails to initialize,awdavidson,54780428,,,OPEN,2023-05-10T15:02:03Z,2023-05-29T15:07:52Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Enabling health checks and configuring the LocalStorageChecker throws IllegalArgumentException on initialisation. I would like to limit the amount of local disk uniffle can consume, it seems that enabling health checks should help us achieve this, however, local storage health checks are current not working.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

```yaml
rss.server.health.check.enable true
rss.server.health.checker.class.names org.apache.uniffle.server.LocalStorageChecker
```


### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/865/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/865,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cJmAX,incubator-uniffle,1546018839,865,NA,awdavidson,54780428,,,NA,2023-05-12T16:47:11Z,2023-05-12T16:47:11Z,"After further investigation, LocalStorageChecker is automatically enabled when using LocalStorage. Enabling via health check and configuring the LocalStorageChecker class is not required.

Out the box it’s not obvious that LocalStorageChecker is automatically enabled, some additional logging when this class is initialised and preventing the HealthCheck from initialising LocalStorageChecker maybe valuable?

NB: From what I can see enabled HealthChecks does not prevent the server from writing to disk. The server metric is labelled as unhealthy but this is not used. Is this intentional? I did find another bug whilst trying to limit the amount of local disk uniffle can consume. The bug is to do with the metadata disk size not being updated when events are processed. I’ll raise a separate issue for this","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cJmAX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/865,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cLmIr,incubator-uniffle,1546543659,865,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-13T06:32:58Z,2023-05-13T06:32:58Z,"> After further investigation, LocalStorageChecker is automatically enabled when using LocalStorage. Enabling via health check and configuring the LocalStorageChecker class is not required.
> 
> Out the box it’s not obvious that LocalStorageChecker is automatically enabled, some additional logging when this class is initialised and preventing the HealthCheck from initialising LocalStorageChecker maybe valuable?
> 
> NB: From what I can see enabled HealthChecks does not prevent the server from writing to disk. The server metric is labelled as unhealthy but this is not used. Is this intentional? I did find another bug whilst trying to limit the amount of local disk uniffle can consume. The bug is to do with the metadata disk size not being updated when events are processed. I’ll raise a separate issue for this

1. It's ok to log extra information.
2. We don't have hard limit about the disk usage. If you have interest, you can design it and contribute to Uniffle. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cLmIr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/865,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cO6-F,incubator-uniffle,1547415429,865,NA,awdavidson,54780428,,,NA,2023-05-15T08:28:09Z,2023-05-15T08:28:09Z,"@jerqi Thank you for your response.

As for the hard limit, a design should not be required, uniffle does already have this functionality when the underlying bug to update `LocalStorageMeta` disk size is fixed. I'll raise another issue with information","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cO6-F/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/865,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dA-oZ,incubator-uniffle,1560537625,865,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-05-24T06:41:07Z,2023-05-24T06:41:07Z,"Nice catch. The real bug occurs in our internal enviroment. The hard limit is necessary, especially for the colocation deployment, more details please see #901 . ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dA-oZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/865,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dam3g,incubator-uniffle,1567256032,865,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-29T15:07:51Z,2023-05-29T15:07:51Z,@awdavidson Should we close this issue after #902 is merged?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dam3g/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/866,https://api.github.com/repos/apache/incubator-uniffle/issues/866,incubator-uniffle,1704934596,866,[Subtask] [Tez] Add Tez Input class related orderedgrouped,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-05-11T02:27:48Z,2023-07-05T06:41:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

[Shuffle Read] add shuffle code related to orderedgrouped

#858


### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/866/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/868,https://api.github.com/repos/apache/incubator-uniffle/issues/868,incubator-uniffle,1704963707,868,[Subtask] Add Tez Input class related shuffle,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-05-11T02:54:04Z,2023-07-05T06:40:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

[Shuffle Read] add shuffle code related to shuffle 



### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/868/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/870,https://api.github.com/repos/apache/incubator-uniffle/issues/870,incubator-uniffle,1705002846,870,[Subtask] [Tez] Tez Shuffle Read supporting RemoteShuffle related app master and reader,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-05-11T03:34:57Z,2023-07-13T06:17:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Related app master and reader

### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/870/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/872,https://api.github.com/repos/apache/incubator-uniffle/issues/872,incubator-uniffle,1705006559,872,[Subtask] [Tez] Tez Shuffle Read supporting RemoteShuffle related common and util,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-05-11T03:40:08Z,2023-05-19T08:23:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Tez Shuffle Read supporting RemoteShuffle related common and util

### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/872/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/880,https://api.github.com/repos/apache/incubator-uniffle/issues/880,incubator-uniffle,1709428952,880,[Bug] Causes data loss to exceed the allocated Buffer for the first time,yl09099,33595968,,,CLOSED,2023-05-15T06:51:00Z,2023-05-15T06:57:17Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The first serialized value exceeds configured value of 'spark.rss.writer.buffer.segment.size',The actual memory used exceeds requestMemory,Cause data loss.

### Affects Version(s)

0.8.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/880/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/881,https://api.github.com/repos/apache/incubator-uniffle/issues/881,incubator-uniffle,1709639553,881,[Bug] LocalStorageMeta disk size is not updated for all events,awdavidson,54780428,,,CLOSED,2023-05-15T09:01:21Z,2023-05-29T14:59:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

`LocalStorageMeta` disk size is not being updated for all events meaning `LocalStorage.canWrite` is always true.

When running a spark application, the first shuffle event will get marked as `underStorage` in `LocalStorageManager.selectStorage` however, follow events for the same shuffle and partition ID are not `setUnderStorage`. Whilst this causes no issues when writing shuffle files `SingleStorageManager.updateWriteMetrics` will only update `LocalStorageMeta` for the first event where `underStorage` is not null (all future events for the same shuffle and partition ID will be null). As the metadata disk size is not updated, the `LocalStorage.canWrite` will always return true regardless of what the actual state.

In my scenario, I would like to limit the amount of disk uniffle can use, addressing this bug mean the `canWrite` will correctly reflect state and retry shuffle write when `canWrite` is false and in my case disk space is available.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/881/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/884,https://api.github.com/repos/apache/incubator-uniffle/issues/884,incubator-uniffle,1711406623,884,[Improvement] Make start and stop scripts executable under the bin folder,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,CLOSED,2023-05-16T07:19:56Z,2023-05-16T10:51:49Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Make start and stop scripts executable under the bin folder

### How should we improve?

chmod +x to these files

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/884/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/886,https://api.github.com/repos/apache/incubator-uniffle/issues/886,incubator-uniffle,1711826347,886,[Bug] MR Client may lost data or throw exception when rss.storage.type without MEMORY.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-05-16T11:27:46Z,2023-05-19T12:12:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

## 1 Bug description

When rss.storage.type without MEMORY, client-mr may raise exception as below:

```
2023-05-16 18:58:52,191 INFO mapreduce.Job: Task Id : attempt_1683514063269_3300_r_000025_0, Status : FAILED
Error: org.apache.uniffle.common.exception.RssException: Blocks read inconsistent: expected 13 blocks, actual 8 blocks
	at org.apache.uniffle.common.util.RssUtils.checkProcessedBlockIds(RssUtils.java:287)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.checkProcessedBlockIds(ShuffleReadClientImpl.java:253)
	at org.apache.hadoop.mapreduce.task.reduce.RssFetcher.copyFromRssServer(RssFetcher.java:193)
	at org.apache.hadoop.mapreduce.task.reduce.RssFetcher.fetchAllRssBlocks(RssFetcher.java:133)
	at org.apache.hadoop.mapreduce.task.reduce.RssShuffle.run(RssShuffle.java:202)
	at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:377)
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:174)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)
	at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:168)
```

In fact, the problem happen firstly in our internal version on client-tez module. Below is tez error stack:

```
2023-05-16 18:35:18,591 INFO impl.ComposedClientReadHandler: Failed to read shuffle data caused by
org.apache.uniffle.common.exception.RssException: Can't get FileSystem for hdfs://devtest-ns-fed/uniffle-rss/appattempt_1684233307050_0001_000000/1/0-0
	at org.apache.uniffle.storage.handler.impl.HdfsClientReadHandler.init(HdfsClientReadHandler.java:113)
	at org.apache.uniffle.storage.handler.impl.HdfsClientReadHandler.readShuffleData(HdfsClientReadHandler.java:162)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:101)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:129)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:238)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:162)
	at org.apache.tez.runtime.library.common.shuffle.rss.RssFetcherOrderedGrouped.copyFromRssServer(RssFetcherOrderedGrouped.java:166)
	at org.apache.tez.runtime.library.common.shuffle.rss.RssFetcherOrderedGrouped.fetchAllRssBlocks(RssFetcherOrderedGrouped.java:151)
	at org.apache.tez.runtime.library.common.shuffle.rss.RssFetcherOrderedGrouped.callInternal(RssFetcherOrderedGrouped.java:296)
	at org.apache.tez.runtime.library.common.shuffle.rss.RssFetcherOrderedGrouped.callInternal(RssFetcherOrderedGrouped.java:29)
	at org.apache.tez.common.CallableWithNdc.call(CallableWithNdc.java:36)
	at org.apache.uniffle.com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131)
	at org.apache.uniffle.com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74)
	at org.apache.uniffle.com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
2023-05-16 18:35:18,595 ERROR rss.RssShuffleScheduler: Summation: Fetcher failed with error
org.apache.uniffle.common.exception.RssFetchFailedException: Failed to read shuffle data from WARM handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:109)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:129)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:238)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:162)
	at org.apache.tez.runtime.library.common.shuffle.rss.RssFetcherOrderedGrouped.copyFromRssServer(RssFetcherOrderedGrouped.java:166)
	at org.apache.tez.runtime.library.common.shuffle.rss.RssFetcherOrderedGrouped.fetchAllRssBlocks(RssFetcherOrderedGrouped.java:151)
	at org.apache.tez.runtime.library.common.shuffle.rss.RssFetcherOrderedGrouped.callInternal(RssFetcherOrderedGrouped.java:296)
	at org.apache.tez.runtime.library.common.shuffle.rss.RssFetcherOrderedGrouped.callInternal(RssFetcherOrderedGrouped.java:29)
	at org.apache.tez.common.CallableWithNdc.call(CallableWithNdc.java:36)
	at org.apache.uniffle.com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131)
	at org.apache.uniffle.com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74)
	at org.apache.uniffle.com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.uniffle.common.exception.RssException: Can't get FileSystem for hdfs://devtest-ns-fed/uniffle-rss/appattempt_1684233307050_0001_000000/1/0-0
	at org.apache.uniffle.storage.handler.impl.HdfsClientReadHandler.init(HdfsClientReadHandler.java:113)
	at org.apache.uniffle.storage.handler.impl.HdfsClientReadHandler.readShuffleData(HdfsClientReadHandler.java:162)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:101)
	... 14 more
```

> In fact, the reproduce probability is very high in tez-local mode. The reproduce probability is low in mr on yarn mode, then I sleep 1 second before shuffleWriteClient.sendShuffleData in SortWriteBufferManager, the The reproduce probability is very high.

## 2 Reason

When the bug happen, the value of `expect committed` in below log is a random value.

```
[INFO] 2023-05-16 19:07:20,436 Grpc-272 ShuffleTaskManager commitShuffle - Checking commit result for appId[appattempt_1683514060868_9741_000001], shuffleId[0], expect committed[390], remain[390]
```

Here we know that shuffleWriteClient.sendShuffleData run in a async thread. when we call finishShuffle, sendShuffleData may not happen, so some data will never flush in shuffle server. 





### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/886/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/886,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cW2vZ,incubator-uniffle,1549495257,886,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-16T11:36:56Z,2023-05-16T11:36:56Z,"We recommend to use `MEMORY_LOCALFILE` or `MEMORY_LOCALFILE_HDFS` storageType in your production environment. But it's also ok to fix this issue. Have you developed Uniffle on Tez?  Some people in huolala are focusing on it. We have a meeting to discuss the issues tomorrow.  Do you have interest on it? And we have wechat group to communicate.
![mmqrcode1684237193864](https://github.com/apache/incubator-uniffle/assets/8159038/08b47b15-3eaa-45c1-a172-a892e8352333)","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cW2vZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/886,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cXITE,incubator-uniffle,1549567172,886,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-05-16T12:27:05Z,2023-05-16T12:27:05Z,"@jerqi I will use MEMORY_LOCALFILE in production environment. LOCALFILE_HDFS is just my develop environment.
Oh, I just know about that some other focus on client-tez. Because our hadoop version is 3.2.1, incompatible with master, so I works it in private before.
BTW, TEZ is our primary hive engine in BEIKE, nearly 150K apps run in one day. I am very interested on it. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cXITE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/886,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cXwQW,incubator-uniffle,1549730838,886,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-16T13:58:08Z,2023-05-16T13:58:08Z,"> @jerqi I will use MEMORY_LOCALFILE in production environment. LOCALFILE_HDFS is just my develop environment. Oh, I just know about that some other focus on client-tez. Because our hadoop version is 3.2.1, incompatible with master, so I works it in private before. BTW, TEZ is our primary hive engine in BEIKE, nearly 150K apps run in one day. I am very interested on it.

For hadoop version 3.1, you can add an extra profile for it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cXwQW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/888,https://api.github.com/repos/apache/incubator-uniffle/issues/888,incubator-uniffle,1713146463,888,[Improvement] Spark blacklist optimization,leixm,31424839,Xianming Lei,,OPEN,2023-05-17T05:23:33Z,2023-05-17T06:26:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When the spark task fails due to some rss exceptions, the executor may be excluded by the stage(See https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/scheduler/TaskSetManager.scala line984), causing the app to run slowly. In fact, this exclude has no effect, because this exception has nothing to do with executor. We can add some optimizations to the patch provided to spark, if the RssException is thrown, the blacklist will not be triggered.

### How should we improve?

Add some optimizations to the patch provided to spark.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/888/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/888,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cbr7Q,incubator-uniffle,1550761680,888,NA,leixm,31424839,Xianming Lei,,NA,2023-05-17T05:28:05Z,2023-05-17T05:28:05Z,@smallzhongfeng  @zuston  @jerqi  PTAL.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cbr7Q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/888,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cbuBJ,incubator-uniffle,1550770249,888,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-17T05:40:45Z,2023-05-17T05:40:45Z,"I prefer reducing extra Spark's patches in the repo.  This improvement is really useful.  You can provide pr if other users  need, we can tell them to use it. 
Maybe we could add some Spark interfaces to strengthen this function, we could add a new exception class. Blaclist of Spark won't add executor which occurs  these exceptions to the blacklist. @LuciferYang , WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cbuBJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/888,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cbuzx,incubator-uniffle,1550773489,888,NA,leixm,31424839,Xianming Lei,,NA,2023-05-17T05:45:20Z,2023-05-17T05:45:20Z,"In fact, last week in our production environment, due to the relatively high load of the machine where the ShuffleServer is located, the client rpc timed out, a large number of tasks failed, and spark's blacklist was triggered, causing the app to run very slowly. This impact is still very large.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cbuzx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/888,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cb4Yz,incubator-uniffle,1550812723,888,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2023-05-17T06:26:41Z,2023-05-17T06:26:41Z,"> I prefer reducing extra Spark's patches in the repo. This improvement is really useful. You can provide pr if other users need, we can tell them to use it. Maybe we could add some Spark interfaces to strengthen this function, we could add a new exception class. Blaclist of Spark won't add executor which occurs these exceptions to the blacklist. @LuciferYang , WDYT?

`spark.excludeOnFailure.enabled` is not enabled by default, and there are also some options that can optimize the `excludeOnFailure` strategy when it is enabled. 

For the special scenario, if the options are ineffective, I prefer to give pr to Spark to optimization the `excludeOnFailure` strategy first instead of maintaining special Spark patches in uniffle.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cb4Yz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/889,https://api.github.com/repos/apache/incubator-uniffle/issues/889,incubator-uniffle,1713147984,889,[Improvement] Default value optimization for 0.8,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-05-17T05:25:30Z,2024-06-05T06:19:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We have developed features to improve the performance of Uniffle. But most of them are turned off by default. Now we will prefer to turn on some config options by default.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/889/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/889,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dV54T,incubator-uniffle,1566023187,889,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-28T09:08:37Z,2023-05-28T09:08:37Z,"Maybe we can make these parameters as default value. @leixm These config options are related to you. Could you raise three pull requests to modify them one by one?
(1)
```
rss.server.single.buffer.flush.enabled true
rss.server.single.buffer.flush.threshold 128M
```
(2)
```
rss.coordinator.select.partition.strategy CONTINUOUS
```
(3)
```
rss.server.max.concurrency.of.per-partition.write 30
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dV54T/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/889,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iMImT,incubator-uniffle,1647348115,889,NA,leixm,31424839,Xianming Lei,,NA,2023-07-24T07:18:03Z,2023-07-24T07:18:03Z,"> Maybe we can make these parameters as default value. @leixm These config options are related to you. Could you raise three pull requests to modify them one by one? (1)
> 
> ```
> rss.server.single.buffer.flush.enabled true
> rss.server.single.buffer.flush.threshold 128M
> ```
> 
> (2)
> 
> ```
> rss.coordinator.select.partition.strategy CONTINUOUS
> ```
> 
> (3)
> 
> ```
> rss.server.max.concurrency.of.per-partition.write 30
> ```

Sure, i will raise PRs later.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iMImT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/889,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5krlp6,incubator-uniffle,1689148026,889,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-23T01:58:37Z,2023-08-23T01:58:37Z,I will make the client compress type as ZSTD by default. cc @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5krlp6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/889,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5krmMv,incubator-uniffle,1689150255,889,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-23T02:01:56Z,2023-08-23T02:01:56Z,"> I will make the client compress type as ZSTD by default. cc @jerqi

It's ok for me if we have verified in the production environment.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5krmMv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/889,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5krm2n,incubator-uniffle,1689152935,889,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-23T02:05:51Z,2023-08-23T02:05:51Z,"> > I will make the client compress type as ZSTD by default. cc @jerqi
> 
> It's ok for me if we have verified in the production environment.

ZSTD has been applied in our production for 1 year by default","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5krm2n/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/889,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5krpA-,incubator-uniffle,1689161790,889,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-23T02:19:56Z,2023-08-23T02:19:56Z,"> > > I will make the client compress type as ZSTD by default. cc @jerqi
> > 
> > 
> > It's ok for me if we have verified in the production environment.
> 
> ZSTD has been applied in our production for 1 year by default

OK.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5krpA-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/892,incubator-uniffle,1718057949,892,[Improvement] Merge data file and index file,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-05-20T05:27:08Z,2024-02-08T03:23:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Now, we store data file and index file separately. It will increase IO cost. We can merge them. We can refer to the implement of Celeborn. It's sure that we need consider more things like AQE. This improvement will increase the performance of RSS.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/892/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cv5oB,incubator-uniffle,1556060673,892,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-05-21T01:45:00Z,2023-05-21T01:45:00Z,"> We can merge them. We can refer to the implement of Celeborn. It's sure that we need consider more things like AQE.

I think you don't describe this optimization clearly, like data/index layout and how to read for client side. Just referring to celeborn is not enough.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cv5oB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cv9Ti,incubator-uniffle,1556075746,892,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-21T03:54:32Z,2023-05-21T03:54:32Z,"> > We can merge them. We can refer to the implement of Celeborn. It's sure that we need consider more things like AQE.
> 
> I think you don't describe this optimization clearly, like data/index layout and how to read for client side. Just referring to celeborn is not enough.

Just a proposal, not a design doc.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5cv9Ti/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5czLT-,incubator-uniffle,1556919550,892,NA,xianjingfeng,11752250,,,NA,2023-05-22T09:58:48Z,2023-05-22T09:58:48Z,"I have thought about this, but i have no good ideas. May be we should  also consider object storage here. I am going to store indexes in memory as we discuss in #407.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5czLT-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5czjwj,incubator-uniffle,1557019683,892,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-22T11:06:45Z,2023-05-22T11:06:45Z,"@xianjingfeng 
1. Do you use object storage?
2. Why should we consider if we use object storage?
3. I see #407, you seems that you occur the problems when you use AQE. Do you try the local sort optimization of Uniffle?
4. We can merge index and data file refer to Celeborn. I can propose more details of Celeborn.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5czjwj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c0Srk,incubator-uniffle,1557211876,892,NA,xianjingfeng,11752250,,,NA,2023-05-22T13:20:17Z,2023-05-22T13:20:17Z,"> @xianjingfeng
> 
> 1. Do you use object storage?
> 2. Why should we consider if we use object storage?
> 3. I see [[FEATURE]  Cache index files on the server side #407](https://github.com/apache/incubator-uniffle/issues/407), you seems that you occur the problems when you use AQE. Do you try the local sort optimization of Uniffle?
> 4. We can merge index and data file refer to Celeborn. I can propose more details of Celeborn.

1. We are going to use object storage. We will put Uniffle on the public cloud to run and use object storage service of cloud vendors.
2. Because most of object storage systems do not support append-mode. We need to consider how to be compatible with it. #391 
3. Yes, i have use ` local sort optimization` , but it just for skipping data files.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c0Srk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c0_1B,incubator-uniffle,1557396801,892,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-22T15:09:36Z,2023-05-22T15:09:36Z,"For object storage, I prefer adding list operation for shuffle server like `listShuffleFiles`.
Because object storage's list operation usually have poor performance.
It's better for object if we merge data file and index file. We can merge them in the support of object storage. I think it's better than caching index file.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c0_1B/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c1kPi,incubator-uniffle,1557545954,892,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-22T16:34:47Z,2023-05-22T16:34:47Z,"Our index and data format is like
![image](https://github.com/apache/incubator-uniffle/assets/8159038/b73bdb4e-3095-4264-8852-b72247298658)
We can merge them into one file
```
blockNum
blockId1 
offset
crc
compress length
uncompress length
taskId
blockId2
offset
crc
compress length
uncompress length
taskId
blockId3
offset
crc
compress length
uncompress length
taskId
......
block1
block2
block3
.....
```

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c1kPi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c47xQ,incubator-uniffle,1558428752,892,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-05-23T02:57:37Z,2023-05-23T02:57:37Z,"Could you help describe more about integrating with object store using above  design? @jerqi 

Does the memory data will be flushed to object store using above layout? Or from the localfile to object store? It's not clear. 

> For object storage, I prefer adding list operation for shuffle server like listShuffleFiles.

Sounds good.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c47xQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/892,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zO96A,incubator-uniffle,1933303424,892,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-08T03:23:14Z,2024-02-08T03:23:14Z,"> For object storage, I prefer adding list operation for shuffle server like `listShuffleFiles`. Because object storage's list operation usually have poor performance. It's better for object if we merge data file and index file. We can merge them in the support of object storage. I think it's better than caching index file.

I think we'd better not to merge index and data into one file. Because we have to read these index file from the so many object file, which will be too slow when skipping some data.

From my prospective, the index files size is under the control, that means we could store them into local disk on the shuffle-server. The speration of index and data is the balance of speed and capacity.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zO96A/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/895,https://api.github.com/repos/apache/incubator-uniffle/issues/895,incubator-uniffle,1721047603,895,[Improvement] Rename Hdfs*.java to Hadoop*.java to support other Hadoop FS-compatible distributed filesystem,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,CLOSED,2023-05-23T02:47:35Z,2023-05-24T06:47:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In server and storage modules, there are many classes prefixed with Hdfs which use Hadoop FS API and are thus impl agnostic, not depending on specific Hdfs impl. So, it's better to rename them to Hadoop* so that we can support other Hadoop FS compatible distributed filesystem by extending existing classes. It'll make code look more naturally. 

There may be some slight differences among different Hadoop FS impls, like [hadoop-daos](https://github.com/daos-stack/daos/tree/master/src/client/java/hadoop-daos) not have a dedicated thread for reading and writing data, which is different from hdfs. Thus, we don't need to close outputstream at each flush to FS. 

### How should we improve?

Just rename the class names.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/895/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/895,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c46Qd,incubator-uniffle,1558422557,895,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-05-23T02:48:31Z,2023-05-23T02:48:31Z,@advancedxy @jerqi does it look reasonable for you?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c46Qd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/895,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c47CG,incubator-uniffle,1558425734,895,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-05-23T02:53:03Z,2023-05-23T02:53:03Z,Sounds good,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c47CG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/895,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c47st,incubator-uniffle,1558428461,895,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-23T02:57:07Z,2023-05-23T02:57:07Z,OK for me.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c47st/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/895,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c5wbM,incubator-uniffle,1558644428,895,NA,advancedxy,807537,,,NA,2023-05-23T06:56:15Z,2023-05-23T06:56:15Z,SGTM.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5c5wbM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/896,https://api.github.com/repos/apache/incubator-uniffle/issues/896,incubator-uniffle,1721322781,896,[Improvement] Support Hadoop-3.2,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-05-23T06:40:40Z,2023-05-29T15:36:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Support Hadoop-3.2

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/896/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/901,incubator-uniffle,1723269037,901,[Bug] Incorrect local disk size limitation when colocating with Yarn nodemanager,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-05-24T06:31:33Z,2023-12-02T12:25:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When the shuffle server of uniffle colocates with the Yarn nodemanager and using MEMORY_LOCALFILE_HDFS, I found the exception occurs, like this: `Unexpected crc value for blockId xxxxxxxxx` . (Finally, I found this is caused by the partial data into file when meeting the no-space left exception)

From the corresponding shuffle-server, I found the disk is full. 
But why the disk full caused the unexpected crc? I give two possible reasons

1. The flush event is triggered to write the local disk due to the failure of `storage.canWrite()`
2. And then the partial data of one event is written to the file of this disk. The another part data for this event has not been written due to no-space left exception. This makes in-consistency

I want to explain more about `stoarge.canWrite()` . Actually, this part logic is correct for exclusive resource deployment for uniffle shuffle-server. But when colocating with other service, this method is incorrect. Because the other service may occupy lots of disk size, which will make the disk limit invalid.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/901/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dA9C3,incubator-uniffle,1560531127,901,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-24T06:34:49Z,2023-05-24T06:34:49Z,This issue is similar to your previous issue. @awdavidson  Do you have any progress? Do you have another suggestion?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dA9C3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dA-9T,incubator-uniffle,1560538963,901,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-05-24T06:42:32Z,2023-05-24T06:42:32Z,"> This issue is similar to your previous issue. @awdavidson Do you have any progress? Do you have another suggestion?

Oh yes. Let @awdavidson to fix this if he is interested","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dA-9T/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dBArl,incubator-uniffle,1560546021,901,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-05-24T06:49:24Z,2023-05-24T06:49:24Z,"BTW, do we support atomic writing for one event? @jerqi WDYT","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dBArl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dBBKx,incubator-uniffle,1560548017,901,NA,awdavidson,54780428,,,NA,2023-05-24T06:51:23Z,2023-05-24T06:51:23Z,"@jerqi I sounds similar except the storage type and exceptions are different. I was using MEMORY_LOCALFILE and noticed that LocalStorageMeta disk size was not correctly updated so when disk was full uniffle would keep trying writing shuffle data. I have a simple fix for this, will look at contributing today. Sorry been busy the past week","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dBBKx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dBCjO,incubator-uniffle,1560553678,901,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-24T06:56:45Z,2023-05-24T06:56:45Z,"> BTW, do we support atomic writing for one event? @jerqi WDYT

I think we don't need. Is it necessary? Usually atomic write operation will bring more cost. I'm worried whether it affected our performance and code complexity。","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dBCjO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dB6x-,incubator-uniffle,1560783998,901,NA,awdavidson,54780428,,,NA,2023-05-24T09:36:54Z,2023-05-24T09:36:54Z,@jerqi @zuston this is the change required to ensure all events update LocalStorageMeta disk size https://github.com/apache/incubator-uniffle/pull/902,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dB6x-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gBEZN,incubator-uniffle,1610892877,901,NA,awdavidson,54780428,,,NA,2023-06-28T07:14:14Z,2023-06-28T07:14:14Z,@zuston are we good to close this issue now?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gBEZN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2uk7,incubator-uniffle,1809508667,901,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-14T03:58:11Z,2023-11-14T03:58:11Z,"> @zuston are we good to close this issue now?

I think this is another problem when colocating with other service.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2uk7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/901,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r9VR-,incubator-uniffle,1811240062,901,NA,awdavidson,54780428,,,NA,2023-11-14T20:41:44Z,2023-11-14T20:41:44Z,"> > @zuston are we good to close this issue now?
> 
> I think this is another problem when colocating with other service.

Yes you are correct. Uniffle is not aware of the actual available space ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r9VR-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/903,https://api.github.com/repos/apache/incubator-uniffle/issues/903,incubator-uniffle,1725028921,903,[Improvement] Limit the read concurrency for one disk,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-05-25T03:42:46Z,2023-05-27T08:05:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

I found the `get_local_data_process_latency_0.99` is high, sometimes it reaches 60 secs.  And in this time, I found the disk utilization reached 100%.

So do we need to limit the concurrency for per disk? I think it's necessary

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/903/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/903,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dTAEM,incubator-uniffle,1565262092,903,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-05-27T08:05:11Z,2023-05-27T08:05:11Z,We now use the read memory to limit the read speed. I suggest that you notice the iops of disk. Is it caused by read operation? Maybe the write operation influence the read operation.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5dTAEM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/907,https://api.github.com/repos/apache/incubator-uniffle/issues/907,incubator-uniffle,1727722472,907,[Improvement] Avoid unnecessary flushEvent close operation,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-05-26T14:17:31Z,2023-05-26T14:17:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We already have `PooledHadoopShuffleWriteHandler`, if the number of flushEvent reach the maxConcurrency, the thread will be blocked now. Every handler will close the file after it write one  flushEvent. If we have many flushEvents, we don't need to close file every time.
We can increase a queue, if the number of flushEvent reach the maxConcurrency, we add the event to the queue, the handler  finish writing one flushEvent, we check whether the queue is empty. If the queue isn't empty, we continue taking one event to write. If the queue is empty, we close the file.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/907/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/908,https://api.github.com/repos/apache/incubator-uniffle/issues/908,incubator-uniffle,1729476059,908,[Subtask] Write byte array shuffle data to MapOutput ,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-05-28T13:44:44Z,2023-05-31T12:20:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

write byte array shuffle data to MapoutPut（memery or disk)

### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/908/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/910,https://api.github.com/repos/apache/incubator-uniffle/issues/910,incubator-uniffle,1730961776,910,[Bug] wrong answer when join key is chinese string.,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-05-29T15:42:49Z,2023-07-29T00:20:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

wrong answer when join key is chinese string.

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
wrong answer when join key is chinese string.
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/910/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/910,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iu-vW,incubator-uniffle,1656482774,910,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-29T00:20:14Z,2023-07-29T00:20:14Z,Solved.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iu-vW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/926,incubator-uniffle,1740850526,926,[Bug] ShuffleReadClientImpl occurs StackOverflowError.,leixm,31424839,Xianming Lei,,OPEN,2023-06-05T03:29:19Z,2023-11-02T08:43:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The following exception occurred in the four attempts of the same task，the probability of this kind of problem recurring is relatively low. About thousands of apps will have this type of exception in one app, causing the app attempt to retry, and every time this exception occurs, the app is also different.
```
org.apache.spark.SparkException: Task failed while writing rows.
	at org.apache.spark.sql.execution.datasources.FileFormatWriter$.org$apache$spark$sql$execution$datasources$FileFormatWriter$$executeTask(FileFormatWriter.scala:321)
	at org.apache.spark.sql.execution.datasources.FileFormatWriter$$anonfun$write$1.apply(FileFormatWriter.scala:209)
	at org.apache.spark.sql.execution.datasources.FileFormatWriter$$anonfun$write$1.apply(FileFormatWriter.scala:208)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
	at org.apache.spark.scheduler.Task.run(Task.scala:121)
	at org.apache.spark.executor.Executor$TaskRunner$$anonfun$10.apply(Executor.scala:408)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1363)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:414)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.lang.StackOverflowError
	at io.grpc.internal.RetriableStream.cancel(RetriableStream.java:493)
	at io.grpc.internal.ClientCallImpl.sendMessageInternal(ClientCallImpl.java:528)
	at io.grpc.internal.ClientCallImpl.sendMessage(ClientCallImpl.java:506)
	at io.grpc.stub.ClientCalls.asyncUnaryRequestCall(ClientCalls.java:317)
	at io.grpc.stub.ClientCalls.futureUnaryCall(ClientCalls.java:227)
	at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:154)
	at org.apache.uniffle.proto.ShuffleServerGrpc$ShuffleServerBlockingStub.getMemoryShuffleData(ShuffleServerGrpc.java:768)
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.getInMemoryShuffleData(ShuffleServerGrpcClient.java:627)
	at org.apache.uniffle.storage.handler.impl.MemoryClientReadHandler.readShuffleData(MemoryClientReadHandler.java:94)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:93)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:224)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:160)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:214)
        ......
        ......
```

### Affects Version(s)

0.6.0

### Uniffle Server Log Output
Corresponding ShuffleServer has been repeatedly printing the following log
```
`[INFO] 2023-06-04 20:42:40,023 Grpc-839 ShuffleServerGrpcService getMemoryShuffleData - Successfully getInMemoryShuffleData cost 0 ms with 318133 bytes shuffle data for appId[xxxxx], shuffleId[0], partitionId[12]`
```


### Uniffle Engine Log Output
Before the exception is thrown, the following logs have been repeatedly appearing, indicating that the client has been requesting the GetInMemoryShuffleData interface of ShuffleServer.
```
`23/06/04 20:42:43 INFO grpc.ShuffleServerGrpcClient: GetInMemoryShuffleData from xxxxx:19999 for appId[xxxxx], shuffleId[0], partitionId[12] cost 2 ms`
```


### Uniffle Server Configurations

```
rss.rpc.server.port 19999
rss.jetty.http.port 19998
rss.storage.basePath /aa/bb/cc,/aa1/bb/cc
rss.storage.type MEMORY_LOCALFILE_HDFS
rss.coordinator.quorum xxxxxxx
rss.server.buffer.capacity 40gb
rss.server.read.buffer.capacity 20gb
rss.server.flush.thread.alive 50
rss.server.flush.threadPool.size 4
rss.server.disk.capacity 1t
rss.server.heartbeat.timeout 60000
rss.server.heartbeat.interval 10000
rss.rpc.message.max.size 1073741824
rss.server.preAllocation.expired 120000
rss.server.commit.timeout 600000
rss.server.app.expired.withoutHeartbeat 300000
rss.server.buffer.flush.enabled true
rss.server.tags high_priority
rss.server.health.check.enable true
rss.server.multistorage.fallback.strategy.class org.apache.uniffle.server.storage.LocalStorageManagerFallbackStrategy
rss.server.flush.cold.storage.threshold.size 50gb
rss.server.buffer.flush.threshold 64m
rss.server.max.concurrency.of.single.partition.writer 20
rss.server.huge-partition.size.threshold 50g
rss.server.huge-partition.memory.limit.ratio 0.2
```



### Uniffle Engine Configurations

```
--conf spark.rss.client.shuffle.data.distribution.type LOCAL_ORDER
```


### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/926/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d76gQ,incubator-uniffle,1575987216,926,NA,leixm,31424839,Xianming Lei,,NA,2023-06-05T03:31:48Z,2023-06-05T03:31:48Z,@jerqi  @zuston  Has this problem occurred in your production environment?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d76gQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d77nc,incubator-uniffle,1575991772,926,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-06-05T03:40:26Z,2023-06-05T03:40:26Z,"> @jerqi @zuston Has this problem occurred in your production environment?

I haven't seen this error","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d77nc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d8qa3,incubator-uniffle,1576183479,926,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-05T07:14:30Z,2023-06-05T07:14:30Z,"I haven't seen this error, too.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d8qa3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olNzh,incubator-uniffle,1754586337,926,NA,leixm,31424839,Xianming Lei,,NA,2023-10-10T07:34:45Z,2023-10-10T07:34:45Z,"I think this exception will occur when duplicate blocks are sent. Assume that there are two blocks with equal blockIds in a ShuffleBuffer. Before flush occurs, getMemoryShuffleData will always be called and never end.
As you can see from the log below, the first read is 5050999 bytes, subsequent reads are all 4625271 bytes, and the reading never ends. There should be duplicate blockIds.
```
23/10/10 03:25:44 INFO grpc.ShuffleServerGrpcClient: GetInMemoryShuffleData from xxx:19999 for appId[application_1695193790407_9195629_1696874216324], shuffleId[9], partitionId[252] cost 1114 ms, get 5050999 bytes
23/10/10 03:25:44 INFO grpc.ShuffleServerGrpcClient: GetInMemoryShuffleData from xxx:19999 for appId[application_1695193790407_9195629_1696874216324], shuffleId[9], partitionId[252] cost 236 ms, get 4625271 bytes
23/10/10 03:25:45 INFO grpc.ShuffleServerGrpcClient: GetInMemoryShuffleData from xxx:19999 for appId[application_1695193790407_9195629_1696874216324], shuffleId[9], partitionId[252] cost 642 ms, get 4625271 bytes
23/10/10 03:25:46 INFO grpc.ShuffleServerGrpcClient: GetInMemoryShuffleData from xxx:19999 for appId[application_1695193790407_9195629_1696874216324], shuffleId[9], partitionId[252] cost 815 ms, get 4625271 bytes
23/10/10 03:25:47 INFO grpc.ShuffleServerGrpcClient: GetInMemoryShuffleData from xx:19999 for appId[application_1695193790407_9195629_1696874216324], shuffleId[9], partitionId[252] cost 868 ms, get 4625271 bytes
......
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olNzh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olPRH,incubator-uniffle,1754592327,926,NA,leixm,31424839,Xianming Lei,,NA,2023-10-10T07:38:40Z,2023-10-10T07:38:40Z,"There are two blocks with blockId=3 in the picture. The first time getMemoryShuffledata will read all blocks, and the second time it will read from blockId=4 to the last block. This reciprocation will never end. [ShuffleBuffer Image](https://ibb.co/XJDQcvh)","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olPRH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olPW6,incubator-uniffle,1754592698,926,NA,leixm,31424839,Xianming Lei,,NA,2023-10-10T07:38:54Z,2023-10-10T07:38:54Z,@jerqi @zuston  What do you think?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olPW6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olSP6,incubator-uniffle,1754604538,926,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-10T07:47:07Z,2023-10-10T07:47:07Z,Sounds right.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olSP6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olS9A,incubator-uniffle,1754607424,926,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-10-10T07:48:59Z,2023-10-10T07:48:59Z,I think you are right.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5olS9A/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5otXOh,incubator-uniffle,1756722081,926,NA,leixm,31424839,Xianming Lei,,NA,2023-10-11T03:48:49Z,2023-10-11T03:48:49Z,"Do you have any optimization suggestions for this situation?  @jerqi  @zuston 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5otXOh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5otYTo,incubator-uniffle,1756726504,926,NA,leixm,31424839,Xianming Lei,,NA,2023-10-11T03:55:16Z,2023-10-11T03:55:16Z,Block deduplication on the ShuffleServer side may have a greater impact on performance.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5otYTo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ot9bX,incubator-uniffle,1756878551,926,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-10-11T06:19:46Z,2023-10-11T06:19:46Z,Maybe we could add a new id like flushId to solve this problem.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ot9bX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ouCWZ,incubator-uniffle,1756898713,926,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-11T06:28:40Z,2023-10-11T06:28:40Z,"Using the composite block id? like (last-1_block_id, last_block_id) ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ouCWZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5o1WDb,incubator-uniffle,1758814427,926,NA,xianjingfeng,11752250,,,NA,2023-10-12T02:26:35Z,2023-10-12T02:26:35Z,How about using skip list to store blocks in `ShuffleBuffer`?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5o1WDb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5o1gvJ,incubator-uniffle,1758858185,926,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-10-12T03:32:27Z,2023-10-12T03:32:27Z,"> How about using skip list to store blocks in `ShuffleBuffer`?

Maybe we can't, we should guarantee that the order is immutable.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5o1gvJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5o1jjj,incubator-uniffle,1758869731,926,NA,xianjingfeng,11752250,,,NA,2023-10-12T03:51:23Z,2023-10-12T03:51:23Z,"> > How about using skip list to store blocks in `ShuffleBuffer`?
> 
> Maybe we can't, we should guarantee that the order is immutable.

Why we should guarantee that the order is immutable?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5o1jjj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qtMlB,incubator-uniffle,1790232897,926,NA,xianjingfeng,11752250,,,NA,2023-11-02T07:53:04Z,2023-11-02T07:53:04Z,"@leixm @zuston
I have discussed this issue with @jerqi offline. We think we can use skipList to store blocks in `ShuffleBuffer`, but the key of the skipList should be a self-increment id.
Another reason to use skipList is that if we assign a lot of memory(1TB) to the shuffle server, it will be slow while getting memory data with current implementation.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qtMlB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/926,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qtcdU,incubator-uniffle,1790297940,926,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-11-02T08:43:44Z,2023-11-02T08:43:44Z,"> @jerqi @zuston Has this problem occurred in your production environment?

We see this Exception before on prd. 
Later on prd, never see the Exception.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qtcdU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/927,https://api.github.com/repos/apache/incubator-uniffle/issues/927,incubator-uniffle,1741128718,927,[Improvement] rss.server.heartbeat.timeout should be replaced with rss.server.heartbeat.interval,summaryzb,37905939,summaryzb,summaryzb@gmail.com,CLOSED,2023-06-05T07:10:33Z,2023-06-05T08:49:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When `rss.server.heartbeat.timeout` such as 60 * 1000 is bigger than `rss.server.heartbeat.interval` such as 10 * 1000, let's assume that just one heartbeat request was very slow effected by the network delay.
The executorService `startHeartBeat` execute the action of sendHearBeat by `rss.server.heartbeat.interval` such as 10 * 1000 milliseconds.
The executorService `sendHeartBeat` execute the real action of hearBeat RPC request, however when the RPC request is timeout, the thread in the executorService `sendHeartBeat` will be blocked. since no more two thread is available, the following sending request will be in the blockingQueue.
As a result, the server only send one hearBeat request in 60 * 1000 milliseconds, that will lead coordinator delete the server, since the server heartBeat exceeding `rss.coordinator.server.heartbeat.timeout`.

### How should we improve?

1. `rss.server.heartbeat.timeout` should be no more than `rss.server.heartbeat.interval`. 
2. Eleminate `rss.server.heartbeat.timeout` replaced with `rss.server.heartbeat.interval`.

I preffer  the second resolution.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/927/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/927,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d8sX8,incubator-uniffle,1576191484,927,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-05T07:18:23Z,2023-06-05T07:18:23Z,Make sense. You can go ahead.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d8sX8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/927,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d9cw_,incubator-uniffle,1576389695,927,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-05T08:49:56Z,2023-06-05T08:49:56Z,closed by #928 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5d9cw_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/933,https://api.github.com/repos/apache/incubator-uniffle/issues/933,incubator-uniffle,1744925702,933,[Bug] Incorrect metric grpc_server_connection_number,xianjingfeng,11752250,,,CLOSED,2023-06-07T02:39:38Z,2023-06-08T07:41:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Sometimes, metric `grpc_server_connection_number` will be less than 0.

https://github.com/grpc/grpc-java/issues/7625#issuecomment-729091732

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/933/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/937,https://api.github.com/repos/apache/incubator-uniffle/issues/937,incubator-uniffle,1746972728,937,[Improvement ] Add rest api for shuffle server list of lost connection and unhealthy,yl09099,33595968,,,CLOSED,2023-06-08T02:33:06Z,2023-06-17T02:26:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

Obtain the list of ServerNodes whose heartbeat is lost from a Coordinator Server,
Obtain the list of ServerNodes whose unhealthy  from a Coordinator Server

### Affects Version(s)

0.8.0

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/937/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/937,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eSOYZ,incubator-uniffle,1581835801,937,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-08T03:29:36Z,2023-06-08T03:29:36Z,"If you want to add an extra api, you would better add a rest api. You can refer to https://github.com/apache/incubator-uniffle/pull/931","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eSOYZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/937,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eSTE3,incubator-uniffle,1581855031,937,NA,yl09099,33595968,,,NA,2023-06-08T03:58:31Z,2023-06-08T03:58:31Z,"@jerqi I changed the title, I just want to add the rest api","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eSTE3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/940,incubator-uniffle,1749000843,940,[FEATURE] Support integrationing into gluten,xianjingfeng,11752250,,,CLOSED,2023-06-09T02:39:44Z,2023-06-18T05:23:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

`gluten` is a spark native engine. When we integrate uniffle into gluten, we need to adjust some codes of uniffle.
In addition, we also need to publish the jar package to the public maven warehouse, like `celeborn` done.
https://github.com/oap-project/gluten/tree/main/gluten-celeborn

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/940/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eZ9fr,incubator-uniffle,1583863787,940,NA,xianjingfeng,11752250,,,NA,2023-06-09T02:43:09Z,2023-06-09T02:43:09Z,"@kaijchen Can you help publish the jar package to the public maven repository.
And my colleagues will help complete the remaining work of this feature.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eZ9fr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eZ-8_,incubator-uniffle,1583869759,940,NA,xianjingfeng,11752250,,,NA,2023-06-09T02:45:44Z,2023-06-09T02:45:44Z,cc @jerqi @advancedxy @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eZ-8_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaATl,incubator-uniffle,1583875301,940,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-09T02:46:58Z,2023-06-09T02:46:58Z,"> @kaijchen Can you help publish the jar package to the public maven repository. And my colleagues will help complete the remaining work of this feature.

If we want to publish the jar package, we need to finish binary release. And we only finish source releasenow. We can discuss this issue on Uniffle regular meeting in  the next week.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaATl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaAUT,incubator-uniffle,1583875347,940,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-06-09T02:47:02Z,2023-06-09T02:47:02Z,"> @kaijchen Can you help publish the jar package to the public maven repository.

Doing so might require releasing process, let's do it in release 0.7.1?
Or we can publish the artifacts to the SNAPSHOT repository.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaAUT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaAok,incubator-uniffle,1583876644,940,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-09T02:48:36Z,2023-06-09T02:48:36Z,cc @summaryzb,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaAok/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaBro,incubator-uniffle,1583880936,940,NA,xianjingfeng,11752250,,,NA,2023-06-09T02:54:40Z,2023-06-09T02:54:40Z,"> > @kaijchen Can you help publish the jar package to the public maven repository.
> 
> Doing so might require releasing process, let's do it in release 0.7.1? Or we can publish the artifacts to the SNAPSHOT repository.

We can do it in next release version, after we complete this feature.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaBro/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaFBy,incubator-uniffle,1583894642,940,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-06-09T03:11:39Z,2023-06-09T03:11:39Z,"I‘d like to involve this feature, shall you open a discussion on it ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaFBy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaKiP,incubator-uniffle,1583917199,940,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-06-09T03:36:19Z,2023-06-09T03:36:19Z,SGTM. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eaKiP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eziKo,incubator-uniffle,1590567592,940,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-06-14T06:42:58Z,2023-06-14T06:42:58Z,"we implement the integration in our production pipeline as below
<img width=""783"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/37905939/7eac97c7-5e5d-48bf-85a5-77476e180e5f"">
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5eziKo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e6cC_,incubator-uniffle,1592377535,940,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-06-15T05:17:46Z,2023-06-15T05:17:46Z,"gluten side change
https://github.com/oap-project/gluten/pull/1966","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e6cC_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e6sUO,incubator-uniffle,1592444174,940,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-15T06:30:21Z,2023-06-15T06:30:21Z,"@summaryzb Could you write a simple document like https://docs.google.com/document/d/1G0cOFVJbYLf2oX1fiadh7zi2M6DlEcjTQTh4kSkb0LA/edit#heading=h.kl0vgpq0nxcy
? It's more easy if other people want to join the discussion or study the implement of this feature.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e6sUO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fBH_o,incubator-uniffle,1594130408,940,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-06-16T05:35:13Z,2023-06-16T05:35:13Z,Sure I'll post it here today later,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fBH_o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/940,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fEaLc,incubator-uniffle,1594991324,940,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-06-16T17:04:46Z,2023-06-16T17:04:46Z,">  It's more easy if other people want to join the discussion or study the implement of this feature.

https://docs.google.com/document/d/1oi5QqrZejPRWBUIBv84eHbUhn2mTcgxP-s1ybh4zB1k/edit
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fEaLc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/946,incubator-uniffle,1752943354,946,[Bug] Uniffle shuffle server failing to start,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,CLOSED,2023-06-12T14:53:41Z,2023-06-13T11:01:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I was trying out uniffle locally and we face the following error when starting the shuffle server

```
[ERROR] 2023-06-12 16:32:19,896 main ShuffleServer <init> - Errors on initializing shuffle server.
org.apache.uniffle.common.exception.RssException: Initialize 1 local storage(s) failed, specified local storage paths size: 1, the conf of rss.server.localstorage.initialize.max.fail.number size: 0
	at org.apache.uniffle.server.storage.LocalStorageManager.<init>(LocalStorageManager.java:147)
	at org.apache.uniffle.server.storage.StorageManagerFactory.createStorageManager(StorageManagerFactory.java:36)
	at org.apache.uniffle.server.ShuffleServer.initialization(ShuffleServer.java:222)
	at org.apache.uniffle.server.ShuffleServer.<init>(ShuffleServer.java:103)
	at org.apache.uniffle.server.ShuffleServer.main(ShuffleServer.java:121)
```

uniffle was built using
```
./build_distribution.sh --spark3-profile 'spark3.3'
```
jvm used: 1.8

coordinator.conf
```
rss.rpc.server.port 19999
rss.jetty.http.port 19998
rss.coordinator.server.heartbeat.timeout 30000
rss.coordinator.app.expired 60000
rss.coordinator.shuffle.nodes.max 13
```

server.conf
```
rss.rpc.server.port 19989
rss.jetty.http.port 19988
rss.storage.basePath /tmp
rss.storage.type MEMORY_LOCALFILE
rss.coordinator.quorum 127.0.0.1:19999
rss.server.buffer.capacity 2gb
rss.server.read.buffer.capacity 2gb
rss.server.flush.thread.alive 5
rss.server.flush.threadPool.size 10
rss.server.disk.capacity -1
```

rss-env.sh
```
set -o pipefail
set -o nounset   # exit the script if you try to use an uninitialised variable
set -o errexit   # exit the script if any statement returns a non-true return value

JAVA_HOME=<java path>
HADOOP_HOME=/tmp/hadoop-3.3.5
XMX_SIZE=""1g"" # Shuffle Server JVM XMX size

RSS_IP=127.0.0.1
```


### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[INFO] 2023-06-12 16:32:19,729 main ShuffleServer main - Start to init shuffle server using config /Users/faiz.halde/dev/nu/nucli/incubator-uniffle/rss-0.8.0-SNAPSHOT/conf/server.conf
[INFO] 2023-06-12 16:32:19,738 main RssUtils getPropertiesFromFile - Load config from /Users/faiz.halde/dev/nu/nucli/incubator-uniffle/rss-0.8.0-SNAPSHOT/conf/server.conf
[INFO] 2023-06-12 16:32:19,780 main ShuffleServer registerMetrics - Register metrics
[INFO] 2023-06-12 16:32:19,805 main ShuffleServer registerMetrics - Add metrics servlet
[ERROR] 2023-06-12 16:32:19,896 main ShuffleServer <init> - Errors on initializing shuffle server.
org.apache.uniffle.common.exception.RssException: Initialize 1 local storage(s) failed, specified local storage paths size: 1, the conf of rss.server.localstorage.initialize.max.fail.number size: 0
	at org.apache.uniffle.server.storage.LocalStorageManager.<init>(LocalStorageManager.java:147)
	at org.apache.uniffle.server.storage.StorageManagerFactory.createStorageManager(StorageManagerFactory.java:36)
	at org.apache.uniffle.server.ShuffleServer.initialization(ShuffleServer.java:222)
	at org.apache.uniffle.server.ShuffleServer.<init>(ShuffleServer.java:103)
	at org.apache.uniffle.server.ShuffleServer.main(ShuffleServer.java:121)
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

```yaml
rss.rpc.server.port 19989
rss.jetty.http.port 19988
rss.storage.basePath /tmp
rss.storage.type MEMORY_LOCALFILE
rss.coordinator.quorum 127.0.0.1:19999
rss.server.buffer.capacity 2gb
rss.server.read.buffer.capacity 2gb
rss.server.flush.thread.alive 5
rss.server.flush.threadPool.size 10
rss.server.disk.capacity -1
```


### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/946/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ernMw,incubator-uniffle,1588491056,946,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-13T04:03:30Z,2023-06-13T04:03:30Z,"Could we paste more logs
<img width=""558"" alt=""企业微信截图_460e9376-4933-4eb0-b400-5c85023ac9b8"" src=""https://github.com/apache/incubator-uniffle/assets/8159038/a13c5bca-82a1-471c-9d88-52301acc7dfb"">
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ernMw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5esu-G,incubator-uniffle,1588785030,946,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-13T08:17:23Z,2023-06-13T08:17:23Z,"yes, so i did that. it does enter the try statement but never reaches the `successCount.incrementAndGet();` statement

what's strange is an error should've been caught in the catch statement and I should've seen the ""LocalStorage init failed!"" error but nothing was printed","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5esu-G/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5esvDt,incubator-uniffle,1588785389,946,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-13T08:17:40Z,2023-06-13T08:17:40Z,"what other logs should I put? i'm going to do the following now

```java
for (int i = 0; i < storageBasePaths.size(); i++) {
      final int idx = i;
      String storagePath = storageBasePaths.get(i);
      executorService.submit(() -> {
        try {
          LOG.info(""building local storage"");
          StorageMedia storageType = getStorageTypeForBasePath(storagePath);
          LOG.info(""Got storageType: "" + storageType);
          localStorageArray[idx] = LocalStorage.newBuilder()
              .basePath(storagePath)
              .capacity(capacity)
              .ratio(ratio)
              .lowWaterMarkOfWrite(lowWaterMarkOfWrite)
              .highWaterMarkOfWrite(highWaterMarkOfWrite)
              .localStorageMedia(storageType)
              .build();
          LOG.info(""local storage built"");
          successCount.incrementAndGet();
        } catch (Exception e) {
          LOG.error(""LocalStorage init failed!"", e);
        } catch (Throwable t) {
          LOG.error(""LocalStorage init failed!"", t);
        } finally {
          countDownLatch.countDown();
        }
      });
    }
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5esvDt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5esxZj,incubator-uniffle,1588794979,946,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-13T08:23:22Z,2023-06-13T08:23:22Z,"ahan, found it. it was indeed throwing a Error not an Exception

```
[ERROR] 2023-06-13 10:22:19,983 LocalStorage-check-0 LocalStorageManager lambda$new$0 - LocalStorage init failed!
java.lang.NoClassDefFoundError: org/apache/commons/lang/SystemUtils
	at org.apache.uniffle.storage.common.DefaultStorageMediaProvider.getStorageMediaFor(DefaultStorageMediaProvider.java:59)
	at org.apache.uniffle.server.storage.LocalStorageManager.getStorageTypeForBasePath(LocalStorageManager.java:168)
	at org.apache.uniffle.server.storage.LocalStorageManager.lambda$new$0(LocalStorageManager.java:119)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
Caused by: java.lang.ClassNotFoundException: org.apache.commons.lang.SystemUtils
	at java.net.URLClassLoader.findClass(URLClassLoader.java:387)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:418)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:351)
	... 8 more
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5esxZj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5esy6e,incubator-uniffle,1588801182,946,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-13T08:25:52Z,2023-06-13T08:25:52Z,but i'm not entirely sure how to fix this. i don't see org.apache.commons as a provided dependency ( sorry but i am not well versed with maven ),"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5esy6e/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5es2cx,incubator-uniffle,1588815665,946,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-13T08:32:22Z,2023-06-13T08:32:22Z,"`DefaultStorageMediaProvider` uses
`import org.apache.commons.lang.SystemUtils;`. should it have been `import org.apache.commons.lang3.SystemUtils;` ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5es2cx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5es2k4,incubator-uniffle,1588816184,946,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-13T08:32:42Z,2023-06-13T08:32:42Z,"but then the question is, why did it compile? ( is it a classpath issue ? ). the hadoop version i'm using is `hadoop-3.3.5`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5es2k4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5etEUF,incubator-uniffle,1588872453,946,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-13T09:08:33Z,2023-06-13T09:08:33Z,@fhalde We already have fixed this issue in the  https://github.com/apache/incubator-uniffle/pull/897. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5etEUF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5etVGy,incubator-uniffle,1588941234,946,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-13T09:45:43Z,2023-06-13T09:45:43Z,let me try with the master!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5etVGy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/946,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5et1TJ,incubator-uniffle,1589073097,946,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-13T11:01:46Z,2023-06-13T11:01:46Z,worked with latest master,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5et1TJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/951,https://api.github.com/repos/apache/incubator-uniffle/issues/951,incubator-uniffle,1756418059,951,[Improvement] Add the HADOOP_VERSION to the RSS Server image name by default,connorlwilkes,16749386,Connor Wilkes,,CLOSED,2023-06-14T09:07:25Z,2023-08-11T08:00:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Now that Uniffle supports more than just Hadoop 2.x it would make sense to tag built docker images with the Hadoop version as well as the rss version.

### How should we improve?

Just append to build.sh with HADOOP_VERSION in the image name

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/951/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/951,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e0d3p,incubator-uniffle,1590812137,951,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-14T09:14:19Z,2023-06-14T09:14:19Z,OK for me. You can go ahead.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e0d3p/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/951,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e04EN,incubator-uniffle,1590919437,951,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-06-14T10:20:36Z,2023-06-14T10:20:36Z,I think we can just ignore the minor hadoop version so we treat Hadoop 3.2.4 as hadoop3.2 and the resulting image would be something like `0.8.0-SNAPSHOT-hadoop3.2-<git-commit>`?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e04EN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/951,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e04Xh,incubator-uniffle,1590920673,951,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-06-14T10:21:31Z,2023-06-14T10:21:31Z,I would be fixing build.sh as currently it doesn't get the right RSS_VERSION as it has not been updated to pick it up as per https://github.com/apache/incubator-uniffle/blob/master/build_distribution.sh#L130,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e04Xh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/951,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e1Gso,incubator-uniffle,1590979368,951,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-14T11:05:29Z,2023-06-14T11:05:29Z,"> I think we can just ignore the minor hadoop version so we treat Hadoop 3.2.4 as hadoop3.2 and the resulting image would be something like `0.8.0-SNAPSHOT-hadoop3.2-<git-commit>`?

ok.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e1Gso/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/952,https://api.github.com/repos/apache/incubator-uniffle/issues/952,incubator-uniffle,1756428133,952,[Improvement] Support setting the BASE_IMAGE of the BASE_IMAGE when building a container using build.sh,connorlwilkes,16749386,Connor Wilkes,,OPEN,2023-06-14T09:12:15Z,2023-06-14T09:12:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In build.sh when BASE_IMAGE is not passed a new base image is built. This base image definition under ""base/""${OS_DISTRIBUTION}""/Dockerfile"" also takes an argo BASE_IMAGE. If users want to build under different java base images than the default ""eclipse-temurin:11-jdk"" this is currently not possible in this script. 

That functionality would be useful.

### How should we improve?

Add a new arg BASE_IMAGE_BASE to build.sh that defaults to 'eclipse-temurin:11-jdk' that is passed to the build of the BASE_IMAGE

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/952/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/955,incubator-uniffle,1758964706,955,[DOCS] Improving the description of several parameters,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,OPEN,2023-06-15T14:30:00Z,2023-06-17T12:53:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

The following configurations are a bit confusing

> rss.coordinator.shuffle.nodes.max
is assignment per shuffle partition or per shuffle writer? why can there be multiple assignments in the first place?

> rss.coordinator.remote.storage.select.strategy
what does `IO_BALANCE` and `APP_BALANCE` even mean?

> rss.server.buffer.capacity
is this a shared global buffer or per app buffer or per connection buffer? how to tune this? what to look for?

> rss.server.read.buffer.capacity
is this global or per shuffle reader? how to tune it? what to look for?

> rss.server.single.buffer.flush.enabled
what is a single buffer?




### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/955/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9mNd,incubator-uniffle,1593205597,955,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-15T14:44:45Z,2023-06-15T14:44:45Z,"1. ` rss.coordinator.shuffle.nodes.max` is max shuffle nodes which we assign to one shuffle. For example, 
We have two shuffles, one have  5 partitions, another have 200 partitions, `rss.coordinator.shuffle.nodes.max` is 10.
We will assign 5 shuffle nodes to the first shuffle. We will assign another 10 shuffle nodes to the second shuffle. 
2. `rss.server.buffer.capacity` is global buffer. We should according to the partition number of shuffle server. We should guarantee that` buffer.capacity` / the number of partition will larger than 2MB, otherwise it will cause too much random io.
3. Every reduce partition is a single buffer. For example:
map1 have data reduce 1, reduce2, reduce3.
map2 have data reduce 1, reduce2, reduce3.
One shuffle node will collect the reduce 1 of map1 and reduce 1 of map2. reduce 1 is a reduce partition.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9mNd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9tAU,incubator-uniffle,1593233428,955,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-15T14:57:28Z,2023-06-15T14:57:28Z,"thanks so much, also in `rss-env.sh`. there's a reference to `XMX_SIZE`. should the buffer sizes defined influence the JVM size of the shuffle server? or does allocation happen off heap?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9tAU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9up0,incubator-uniffle,1593240180,955,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-15T15:00:23Z,2023-06-15T15:00:23Z,"> We will assign 5 shuffle nodes to the first shuffle. We will assign another 10 shuffle nodes to the second shuffle
oh i see, is this to reduce the spread of the data? does the rss server merge partitions coming from different mappers?

> We should according to the partition number of shuffle server
is this configurable? is this the same as `rss.coordinator.shuffle.nodes.max` ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9up0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9vqx,incubator-uniffle,1593244337,955,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-15T15:02:42Z,2023-06-15T15:02:42Z,the assignment process warrants better documentation. let me first try to understand it by myself,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9vqx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e91uq,incubator-uniffle,1593269162,955,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-15T15:16:30Z,2023-06-15T15:16:30Z,"> > We will assign 5 shuffle nodes to the first shuffle. We will assign another 10 shuffle nodes to the second shuffle
> > oh i see, is this to reduce the spread of the data? does the rss server merge partitions coming from different mappers?

No, we don't merge reduce1, reduce 2.Although they can be sent to the same shuffle node, we still use different memory buffer to store them now.

> 
> > We should according to the partition number of shuffle server
> > is this configurable? is this the same as `rss.coordinator.shuffle.nodes.max` ?

No config option. It's just experience formula from me now.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e91uq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9-55,incubator-uniffle,1593306745,955,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-15T15:37:04Z,2023-06-15T15:37:04Z,"ok. what do you mean by

> We should set it according to the partition number of shuffle server
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e9-55/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e-AgM,incubator-uniffle,1593313292,955,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-15T15:41:29Z,2023-06-15T15:41:29Z,"also, any input for https://github.com/apache/incubator-uniffle/issues/955#issuecomment-1593233428 ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e-AgM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e-LEB,incubator-uniffle,1593356545,955,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-15T16:10:56Z,2023-06-15T16:10:56Z,"> ok. what do you mean by
> 
> > We should set it according to the partition number of shuffle server

Actually, we just the use 80G heap to run the shuffle server in our production env. Our machine is 150G. It's enough for several TBs shuffle with 1000 executors to use 9 shuffle server.
We estimate the max task concurrency in our production env. Max task concurrency means the max partitions which we need hold it in the memory of shuffle sever. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e-LEB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e-LoC,incubator-uniffle,1593358850,955,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-15T16:12:41Z,2023-06-15T16:12:41Z,"> thanks so much, also in `rss-env.sh`. there's a reference to `XMX_SIZE`. should the buffer sizes defined influence the JVM size of the shuffle server? or does allocation happen off heap?

1. Yes, buffer size should be 0.7 of XMX_SIZE.
2.We don't support offheap management now. We're developing the feature and tuning this feature.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5e-LoC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fCggK,incubator-uniffle,1594492938,955,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-16T10:54:44Z,2023-06-16T10:54:44Z,"> It's enough for several TBs shuffle with 1000 executors to use 9 shuffle server.

very impressive. how much storage ( disk ) do you typically attach per shuffle server?
we have some jobs that shuffle almost 150TB of data. One could argue that the job needs to be re-written but as a platform we mostly have no control over when the job gets fixed to reduce the shuffle","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fCggK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fChaa,incubator-uniffle,1594496666,955,NA,fhalde,7455872,Faiz Halde,haldefaiz@gmail.com,NA,2023-06-16T10:58:10Z,2023-06-16T10:58:10Z,"> Yes, buffer size should be 0.7 of XMX_SIZE.

ok, so can i set both `rss.server.buffer.capacity` and `rss.server.read.buffer.capacity` to 0.7 of xmx size or should they be split into 0.35 each ?

 is `rss.server.buffer.capacity` for write and `rss.server.read.buffer.capacity` for read ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fChaa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fCh5-,incubator-uniffle,1594498686,955,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-16T10:59:51Z,2023-06-16T10:59:51Z,"> > Yes, buffer size should be 0.7 of XMX_SIZE.
> 
> ok, so can i set both `rss.server.buffer.capacity` and `rss.server.read.buffer.capacity` to 0.7 of xmx size or should they be split into 0.35 each ?
> 
> is `rss.server.buffer.capacity` for write and `rss.server.read.buffer.capacity` for read ?

1. rss.server.buffer.capacity is 0.7
   rss.server.read.buffer.capacity is 0.2 
   0.1 is for other program.
2. Yes
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fCh5-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fCkBh,incubator-uniffle,1594507361,955,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-16T11:07:23Z,2023-06-16T11:07:23Z,"> > It's enough for several TBs shuffle with 1000 executors to use 9 shuffle server.
> 
> very impressive. how much storage ( disk ) do you typically attach per shuffle server? we have some jobs that shuffle almost 150TB of data. One could argue that the job needs to be re-written but as a platform we mostly have no control over when the job gets fixed to reduce the shuffle

For 150TB shuffle, some config options will be recommended.
First. we would like to use MEMORY_LOCALFILE_HDFS, because HDFS have more IO resource and more disk space.
Second, use more shuffle servers, may be more than 20.
Third. use `single.buffer.limit` and `rss.server.max.concurrency.of.per-partition.write`. When reduce partition reach a size, we will flush it to HDFS and `rss.server.max.concurrency.of.per-partition.write` will use multiple threads to write HDFS data.
This feature will have better effect after https://github.com/apache/incubator-uniffle/pull/775
Fourth. We haven't support S3. Because community don't have enough people although we have similar plan. S3 is different from HDFS, it will have more optimization.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fCkBh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fCmhq,incubator-uniffle,1594517610,955,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-16T11:16:33Z,2023-06-16T11:16:33Z,This may be useful for you. https://github.com/apache/incubator-uniffle/blob/master/docs/benchmark.md,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fCmhq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/955,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fHRDE,incubator-uniffle,1595740356,955,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-06-17T12:53:00Z,2023-06-17T12:53:00Z,"> we have some jobs that shuffle almost 150TB of data. 

Do you mean that the 150TB for stage total shuffle data size or just is per partition? 

If it's the former, I think the single shuffle-server tolerant disk capacity * shuffle-server size must hold the 150TB.

And if it's the latter, the jerqi's suggestion is useful, which is for holding huge partition for per-partition. And the issue has been solved in https://github.com/apache/incubator-uniffle/issues/378 

> One could argue that the job needs to be re-written but as a platform we mostly have no control over when the job gets fixed to reduce the shuffle

+1. Feel the same

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fHRDE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/956,https://api.github.com/repos/apache/incubator-uniffle/issues/956,incubator-uniffle,1762852286,956,[Improvement] Changes the Boolean flag that determines whether a Node is healthy to a state,yl09099,33595968,,,CLOSED,2023-06-19T06:38:39Z,2023-06-22T09:09:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Changes the Boolean flag that determines whether a Node is healthy to a state，This makes state management more unified

### How should we improve?

ShuffleServer is removed and the isHealthy ShuffleServerHeartBeatRequest member variable, unified to ServerStatus management

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/956/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/957,https://api.github.com/repos/apache/incubator-uniffle/issues/957,incubator-uniffle,1763267552,957,[Subtask] Tez examples integration test,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-06-19T10:46:43Z,2023-07-12T02:03:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Add tez example integration test

### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/957/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/957,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fRl9J,incubator-uniffle,1598447433,957,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-06-20T09:37:58Z,2023-06-20T09:37:58Z,"There are 6 examples in tez-exampels project. 
> JoinDataGen and JoinValidate are used for generated input and verify result, so ignore it.

| Example |  How to check  |
| --- |  ---  |
| WordCount | make sure the results generated by original tez are same with rss tez. |
| OrderedWordCount | make sure the results generated by original tez are same with rss tez. |
| SimpleSessionExample | make sure the results generated by original tez are same with rss tez. |
| HashJoinExample | JoinDataGen is used to generated input. JoinValidate is used to verify result. |
| SortMergeJoinExample | JoinDataGen is used to generated input. JoinValidate is used to verify result. |
| CartesianProduct | make sure the results generated by original tez are same with rss tez, but not guarantee the order. |

> cartesianproduct will run failed in unpartitioned mode, so only test in partitioned mode.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fRl9J/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/957,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ga-Uq,incubator-uniffle,1617683754,957,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-03T09:08:42Z,2023-07-03T09:08:42Z,"This PR is not ready to review. The integration test will fail until some issue is solved.
This issue are blocked by:
* https://github.com/apache/incubator-uniffle/issues/983
* https://github.com/apache/incubator-uniffle/issues/986
* https://github.com/apache/incubator-uniffle/issues/989
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ga-Uq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/960,incubator-uniffle,1767776346,960,[Umbrella] Uniffle needs to add a WebUI page,yl09099,33595968,,,CLOSED,2023-06-21T14:44:48Z,2023-11-24T06:49:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the proposal

Add a webUI management module for Uniffle, and view specific functions：https://docs.google.com/document/d/10IEbbo_xQS-GHy0ezRcm9mT4Fv9hqghDsXivDpK1kas/edit

### Task list
    1、The code structure of the webUI module needs to be set up.
    2、Front-end pages for the Development Coordinator, ShuffleServer, and Applicantion.
    3、Coordinator, ShuffleServer, and Application back-end RESTful interface development.
    4、Deployment scripts for WebAPP and start script development.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/960/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ffGFb,incubator-uniffle,1601986907,960,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-06-22T04:13:56Z,2023-06-22T04:13:56Z,Great idea! Maybe we need a proposal to show the UI draft. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ffGFb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fnWL_,incubator-uniffle,1604150015,960,NA,yl09099,33595968,,,NA,2023-06-23T11:29:18Z,2023-06-23T11:29:18Z,"@zuston At present, I have opened three pages according to my own ideas. I hope you can put forward your ideas and we can discuss them together. Thank you","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fnWL_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fn2f5,incubator-uniffle,1604282361,960,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-06-23T13:24:06Z,2023-06-23T13:24:06Z,"Wow, it's great, how about discuss this in our weekend meeting firstly? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fn2f5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5frVD9,incubator-uniffle,1605193981,960,NA,yl09099,33595968,,,NA,2023-06-24T00:41:49Z,2023-06-24T00:41:49Z,OK @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5frVD9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5frxmZ,incubator-uniffle,1605310873,960,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-24T08:39:48Z,2023-06-24T08:39:48Z,"> OK @zuston

Have you joined our Wechat group? The regular meeting link is in the group announcement.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5frxmZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ftpkD,incubator-uniffle,1605802243,960,NA,yl09099,33595968,,,NA,2023-06-25T00:49:09Z,2023-06-25T00:49:09Z,"@jerqi I haven't joined the wechat group, how can I join?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ftpkD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ftsiU,incubator-uniffle,1605814420,960,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-25T01:37:28Z,2023-06-25T01:37:28Z,"![9ea34cef3d263ebb1bb28b6d0978c2bd](https://github.com/apache/incubator-uniffle/assets/8159038/a4f608aa-0550-4a7d-b64b-62ed9558bf58)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ftsiU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hQKeV,incubator-uniffle,1631627157,960,NA,slfan1989,55643692,,,NA,2023-07-11T23:20:03Z,2023-07-11T23:20:03Z,"@jerqi @zuston @yl09099 Shouldn't we find a professional frontend developer to review this design and validate its feasibility?

We lack experience in frontend development, and we haven't compared the design of this web module with other projects. This makes me concerned about the module's overall applicability.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hQKeV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hQirZ,incubator-uniffle,1631726297,960,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-12T01:43:41Z,2023-07-12T01:43:41Z,"> @jerqi @zuston @yl09099 Shouldn't we find a professional frontend developer to review this design and validate its feasibility?
> 
> We lack experience in frontend development, and we haven't compared the design of this web module with other projects. This makes me concerned about the module's overall applicability.

Yes, we would better have  professional frontend developer. But we don't have them now.  Some projects also propose a simple dashboard. As the project's development, it will attract some professional frontend developers. The frontend developers will refactor dashboard. So we can propose a simple UI dashboard first.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hQirZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5stlWD,incubator-uniffle,1823888771,960,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-23T06:53:17Z,2023-11-23T06:53:17Z,Is it possible to support multiple coordinator in one dashboard server? @yl09099 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5stlWD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/960,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5syp9O,incubator-uniffle,1825218382,960,NA,yl09099,33595968,,,NA,2023-11-24T06:49:20Z,2023-11-24T06:49:20Z,"> Is it possible to support multiple coordinator in one dashboard server? @yl09099

After I finish fixing the bug, I will modify it, so it can be done at present.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5syp9O/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/961,https://api.github.com/repos/apache/incubator-uniffle/issues/961,incubator-uniffle,1768883502,961,[Improvement] [Minor] Improve Coordinator Log Format.,slfan1989,55643692,,,CLOSED,2023-06-22T03:57:02Z,2023-07-05T03:40:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Some log records in the Coordinator project use splicing, and we should use placeholders.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/961/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/965,https://api.github.com/repos/apache/incubator-uniffle/issues/965,incubator-uniffle,1773015063,965,[Subtask] Tez: support remote shuffle for tez framework,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-06-25T02:27:23Z,2023-07-05T06:37:22Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

A method to support remote shuffle for tez framework.


### Parent issue

https://github.com/apache/incubator-uniffle/issues/321


### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/965/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/965,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ftwQs,incubator-uniffle,1605829676,965,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-06-25T02:35:44Z,2023-06-25T02:35:44Z,"If we want to run tez job with unffile, two way must do:

* (1) Choose RssDagMaster
 use this config:

| config |  value |
| --- | --- |
| tez.am.launch.cmd-opts | -XX:+PrintGCDetails -verbose:gc -XX:+PrintGCTimeStamps -XX:+UseNUMA -XX:+UseParallelGC org.apache.tez.dag.app.RssDAGAppMaster |

* (2) Rename IO Name
Rename io name in code, no config should be configured.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ftwQs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/967,https://api.github.com/repos/apache/incubator-uniffle/issues/967,incubator-uniffle,1773107495,967,[Improvement] feat(coordinator): log4j CVE problems,yl09099,33595968,,,CLOSED,2023-06-25T07:09:18Z,2023-06-26T01:00:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Introduced the Hadoop-common-2.8.5 package of hadoop, introduced the log4j log package, version 1.2.17, this version has serious cve problems：https://mvnrepository.com/artifact/log4j/log4j/1.2.17

### How should we improve?

You need to exclude the log4j package and introduce a later version of the log4j package

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/967/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/967,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fuD33,incubator-uniffle,1605910007,967,NA,yl09099,33595968,,,NA,2023-06-25T07:18:42Z,2023-06-25T07:18:42Z,@jerqi Take a look at this question.Please!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fuD33/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/967,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fuFsq,incubator-uniffle,1605917482,967,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-06-25T07:50:04Z,2023-06-25T07:50:04Z,We only use Hadoop dependency in our test code. We won't include the hadoop jar in our release package.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5fuFsq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/969,https://api.github.com/repos/apache/incubator-uniffle/issues/969,incubator-uniffle,1773345819,969,[Subtask] Decommission ShuffleServer through Cli,slfan1989,55643692,,,OPEN,2023-06-25T15:32:24Z,2023-07-06T01:51:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We will provide a command to decommission the ShuffleServer.

### Motivation

We provide a REST API to support the Decommission of ShuffleServer, it is essential to also support this functionality in the command-line.








### Describe the solution

The cluster administrators can Decommission ShuffleServer using a command.



### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/969/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/970,https://api.github.com/repos/apache/incubator-uniffle/issues/970,incubator-uniffle,1773346646,970,[Subtask] CancelDecommission ShuffleServer through Cli.,slfan1989,55643692,,,OPEN,2023-06-25T15:34:30Z,2023-07-06T01:50:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We will provide a command to CancelDecommission the ShuffleServer.

### Motivation

We provide a REST API to support the CancelDecommission ShuffleServer, it is essential to also support this functionality in the command-line.

### Describe the solution

The cluster administrators can CancelDecommission ShuffleServer using a command.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/970/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/971,https://api.github.com/repos/apache/incubator-uniffle/issues/971,incubator-uniffle,1773673908,971,[Improvement] Provides CLI print format tool objects,yl09099,33595968,,,CLOSED,2023-06-26T02:12:13Z,2023-06-27T11:59:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The CLI provides a formatting tool for printing results that are unaligned, unattractive and inconvenient to view

### How should we improve?

Provides a printed formatting tool class

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/971/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/972,https://api.github.com/repos/apache/incubator-uniffle/issues/972,incubator-uniffle,1773729768,972,[Subtask] Tez client add missed metric,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-06-26T02:41:18Z,2023-07-18T07:49:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Client-tez miss some tez metric, so it should be added later.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/321

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/972/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/973,https://api.github.com/repos/apache/incubator-uniffle/issues/973,incubator-uniffle,1773738140,973,[Improvement] Make shuffle manager client RPC timeout configurable,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-06-26T02:52:59Z,2023-07-20T03:26:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the default rpc timeout for shuffle manager is 60s. But sometimes, the server backend io pressure is high, it's necessary to make it configurable.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/973/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/973,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gZDc0,incubator-uniffle,1617180468,973,NA,cchung100m,6762509,Neo Chien,,NA,2023-07-03T03:32:41Z,2023-07-03T03:32:41Z,"Hi @zuston 
I am interested in this issue, please assign it to me, thank you.  :smile:","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gZDc0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/973,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gZDtD,incubator-uniffle,1617181507,973,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-03T03:33:40Z,2023-07-03T03:33:40Z,Thanks @cchung100m ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gZDtD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/974,https://api.github.com/repos/apache/incubator-uniffle/issues/974,incubator-uniffle,1776038585,974,[Bug] Dynamic remote storage conf invalid,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-06-27T03:48:55Z,2024-01-08T03:28:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

This dynamic remote storage conf is invalid when the value of KV structure in conf exist ` ,` .

Just like this:

`rss.coordinator.remote.storage.cluster.conf hadoop-ns01,dfs.hosts=a,b,c,dfs.service=sssss`

Once using remote storage info, this bug will always happen.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/974/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/974,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gr4Hg,incubator-uniffle,1622114784,974,NA,s0nskar,11391128,Sanskar Modi,sanskarmodi97@gmail.com,NA,2023-07-05T16:38:44Z,2023-07-05T16:38:44Z,"> This dynamic remote storage conf is invalid when the value of KV structure in conf exist  , .

@zuston Can you help me understand the issue more?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gr4Hg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/974,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gurxz,incubator-uniffle,1622850675,974,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-06T02:13:16Z,2023-07-06T02:13:16Z,"> > This dynamic remote storage conf is invalid when the value of KV structure in conf exist  , .
> 
> @zuston Can you help me understand the issue more?

Because the uniffle segmentation configuration uses `, `as the delimiter, the delimiter cannot be included in the parameter. Otherwise, an error will be reported, this is the background of this issue.

BTW, please see the conf of `rss.coordinator.remote.storage.cluster.conf` in uniffle codebase.  It mixed multiple hdfs cluster conf into one config value. This is not elegant and error prone.

If you are interested in this, I think the better design of `rss.coordinator.remote.storage.cluster.conf` is necessary. Feel free to join this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gurxz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/978,https://api.github.com/repos/apache/incubator-uniffle/issues/978,incubator-uniffle,1776751333,978,[Improvement] Provides a tool class to format CLI output content,yl09099,33595968,,,CLOSED,2023-06-27T11:51:58Z,2023-06-29T09:19:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Provides a tool class to format CLI output content

### How should we improve?

Added a tool class

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/978/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/981,https://api.github.com/repos/apache/incubator-uniffle/issues/981,incubator-uniffle,1778362851,981,[Improvement] Ability to create uniffle client docker images,awdavidson,54780428,,,OPEN,2023-06-28T07:21:23Z,2023-06-28T07:21:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently we only create a rss-server docker images (used when running coordinators and shuffle servers). It would be good if we also had the option to build/create a relevant client docker image.

I personally am only interested in creating an image for the spark3 client, however, can image this will be useful for other clients? A flag to enable the build of specific images should be suffice and initial support may only target popular clients?

### How should we improve?

Support client images in `deploy/kubernetes/docker/build.sh`

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/981/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/983,https://api.github.com/repos/apache/incubator-uniffle/issues/983,incubator-uniffle,1782021914,983,[Improvement] [tez] Optimize tez client delivery configuration,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-06-30T07:13:25Z,2023-07-04T03:28:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Three improvement about configuration will be done in this issue.

1 For now, tez client use rss_conf.xml to delivery configuration. As https://github.com/apache/incubator-uniffle/pull/966 is applied, we can delivery configuration by edge conf. 

2 delivery dynamic configuration from shuffle server, then override the tez client configuration.

3 delivery configuration from client side.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/983/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/986,https://api.github.com/repos/apache/incubator-uniffle/issues/986,incubator-uniffle,1785175288,986,[Improvement][tez] Optimize the method of obtain the vertex id.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-07-03T02:40:56Z,2023-07-06T10:45:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For now, vertex id is extract from vertex name. This way only support the vertex name like ""Map 0"", ""Reduce 1"", generally generated from hive.
For tez examples, the vertex name is arbitrary, so we can't get the vertex id. So we need a new way to get vertex id.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/986/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/986,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gtLqy,incubator-uniffle,1622457010,986,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-07-05T20:30:15Z,2023-07-05T20:30:15Z,"It is great, if can obtain vertex id throuth:
```
          int sourceVertexId = dag.getVertex(edge.getSourceVertexName()).getVertexId().getId();
          int destinationVertexId = dag.getVertex(edge.getDestinationVertexName()).getVertexId().getId();
```

The only one it modify lots of file, but it is ok.

but when could not get vertexid, eg:
```
int sourceVertexId = this.conf.getInt(RSS_SHUFFLE_SOURCE_VERTEX_ID, -1);
```
could we throw exception, then we could know something wrong, instead get -1 and wrong result.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gtLqy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/986,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5guHG_,incubator-uniffle,1622700479,986,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-05T23:54:51Z,2023-07-05T23:54:51Z,"> It is great, if can obtain vertex id throuth:
> 
> ```
>           int sourceVertexId = dag.getVertex(edge.getSourceVertexName()).getVertexId().getId();
>           int destinationVertexId = dag.getVertex(edge.getDestinationVertexName()).getVertexId().getId();
> ```
> 
> The only one it modify lots of file, but it is ok.
> 
> but when could not get vertexid, eg:
> 
> ```
> int sourceVertexId = this.conf.getInt(RSS_SHUFFLE_SOURCE_VERTEX_ID, -1);
> ```
> 
> could we throw exception, then we could know something wrong, instead get -1 and wrong result.

@lifeSo 

assert is used to throw exception. You can see the below code.
```
    assert sourceVertexId != -1;
    assert destinationVertexId != -1;
```

 And in fact, the vertex id must exists, so in general way, we will never throw exception.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5guHG_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/986,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gwKzQ,incubator-uniffle,1623239888,986,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-07-06T08:46:26Z,2023-07-06T08:46:26Z,"> sourceVertexId

Greate!  @zhengchenyu zhengchenyu 
How about the assert check is in computeShuffleId() method. 
Then users who call this methods do not assert check explicitly.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gwKzQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/986,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gwNsp,incubator-uniffle,1623251753,986,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-06T08:54:53Z,2023-07-06T08:54:53Z,"@lifeSo 

That's a good idea, as only computeShuffleId use vertex id.
But just like the code show below. I check whether vertex id is -1, but the -1 is the default value of config. If we want to move assert to computeShuffleId, I think getInt also should move to computeShuffleId. How about this way?

```
    int sourceVertexId = this.conf.getInt(RSS_SHUFFLE_SOURCE_VERTEX_ID, -1);
    int destinationVertexId = this.conf.getInt(RSS_SHUFFLE_DESTINATION_VERTEX_ID, -1);
    assert sourceVertexId != -1;
    assert destinationVertexId != -1;
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gwNsp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/988,https://api.github.com/repos/apache/incubator-uniffle/issues/988,incubator-uniffle,1785595162,988,[Flaky Test] org.apache.uniffle.test.GetReaderTest#test,xianjingfeng,11752250,,,OPEN,2023-07-03T08:12:53Z,2023-07-03T08:12:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 4.978 s <<< FAILURE! - in org.apache.uniffle.test.GetReaderTest
Error:  test  Time elapsed: 3.902 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <2> but was: <0>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:527)
	at org.apache.uniffle.test.GetReaderTest.test(GetReaderTest.java:155)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)

[INFO] 
[INFO] Results:
[INFO] 
Error:  Failures: 
Error:    GetReaderTest.test:155 expected: <2> but was: <0>
[INFO] 
Error:  Tests run: 6, Failures: 1, Errors: 0, Skipped: 0
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/5422119028/jobs/9858372786

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/988/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/989,https://api.github.com/repos/apache/incubator-uniffle/issues/989,incubator-uniffle,1785707300,989,[Bug][tez] parition class is not set for RssUnorderedKVOutput.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-07-03T09:07:06Z,2023-07-11T03:20:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

parition class is not set for RssUnorderedKVOutput, will throw error:

```
at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:78)
  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
  at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.NullPointerException
  at java.lang.Class.forName0(Native Method)
  at java.lang.Class.forName(Class.java:348)
  at org.apache.hadoop.conf.Configuration.getClassByNameOrNull(Configuration.java:2534)
  at org.apache.hadoop.conf.Configuration.getClassByName(Configuration.java:2499)
  at org.apache.tez.runtime.library.common.TezRuntimeUtils.instantiatePartitioner(TezRuntimeUtils.java:117)
  at org.apache.tez.runtime.library.common.sort.impl.ExternalSorter.(ExternalSorter.java:271)
  at org.apache.tez.runtime.library.common.sort.impl.RssUnSorter.(RssUnSorter.java:68)
  at org.apache.tez.runtime.library.output.RssUnorderedKVOutput.start(RssUnorderedKVOutput.java:204)
  at org.apache.hadoop.hive.ql.exec.tez.MapRecordProcessor.init(MapRecordProcessor.java:193)
  at org.apache.hadoop.hive.ql.exec.tez.TezProcessor.initializeAndRunProcessor(TezProcessor.java:266)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/989/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/991,https://api.github.com/repos/apache/incubator-uniffle/issues/991,incubator-uniffle,1787293491,991,[Improvement][tez] TezRemoteShuffleManager support secure cluster. ,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-07-04T07:05:49Z,2023-07-14T08:11:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For now, client-tez can not support secure cluster, will throw exception:

```
2023-07-04 12:03:22,206 INFO examples.WordCount: DAG diagnostics: [Vertex failed, vertexName=Tokenizer, vertexId=vertex_1683514063269_21170_1_00, diagnostics=[Task failed, taskId=task_1683514063269_21170_1_00_000003, diagnostics=[TaskAttempt 0 failed, info=[Error: Error while running task ( failure ) : attempt_1683514063269_21170_1_00_000003_0:java.io.IOException: DestHost:destPort hadoop-tz-001017.prod.ljnode.com:39153 , LocalHost:localPort hadoop-tz-001017.prod.ljnode.com/10.201.1.17:0. Failed on local exception: java.io.IOException: org.apache.hadoop.security.AccessControlException: Client cannot authenticate via:[KERBEROS]
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.apache.hadoop.net.NetUtils.wrapWithMessage(NetUtils.java:833)
	at org.apache.hadoop.net.NetUtils.wrapException(NetUtils.java:808)
	at org.apache.hadoop.ipc.Client.getRpcResponse(Client.java:1558)
	at org.apache.hadoop.ipc.Client.call(Client.java:1492)
	at org.apache.hadoop.ipc.Client.call(Client.java:1389)
	at org.apache.hadoop.ipc.WritableRpcEngine$Invoker.invoke(WritableRpcEngine.java:251)
	at com.sun.proxy.$Proxy11.getShuffleAssignments(Unknown Source)
	at org.apache.tez.runtime.library.output.RssOrderedPartitionedKVOutput.initialize(RssOrderedPartitionedKVOutput.java:155)
	at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask$InitializeOutputCallable._callInternal(LogicalIOProcessorRuntimeTask.java:550)
	at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask$InitializeOutputCallable.callInternal(LogicalIOProcessorRuntimeTask.java:533)
	at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask$InitializeOutputCallable.callInternal(LogicalIOProcessorRuntimeTask.java:518)
	at org.apache.tez.common.CallableWithNdc.call(CallableWithNdc.java:36)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.io.IOException: org.apache.hadoop.security.AccessControlException: Client cannot authenticate via:[KERBEROS]
	at org.apache.hadoop.ipc.Client$Connection$1.run(Client.java:771)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)
	at org.apache.hadoop.ipc.Client$Connection.handleSaslConnectionFailure(Client.java:734)
	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:828)
	at org.apache.hadoop.ipc.Client$Connection.access$3900(Client.java:422)
	at org.apache.hadoop.ipc.Client.getConnection(Client.java:1615)
	at org.apache.hadoop.ipc.Client.call(Client.java:1436)
	... 14 more
Caused by: org.apache.hadoop.security.AccessControlException: Client cannot authenticate via:[KERBEROS]
	at org.apache.hadoop.security.SaslRpcClient.selectSaslClient(SaslRpcClient.java:173)
	at org.apache.hadoop.security.SaslRpcClient.saslConnect(SaslRpcClient.java:390)
	at org.apache.hadoop.ipc.Client$Connection.setupSaslConnection(Client.java:628)
	at org.apache.hadoop.ipc.Client$Connection.access$2300(Client.java:422)
	at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:815)
	at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:811)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)
	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:811)
	... 17 more
```

### How should we improve?

support secure cluster.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/991/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/991,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gusAF,incubator-uniffle,1622851589,991,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-06T02:14:48Z,2023-07-06T02:14:48Z,"From my side, the Tez client should have supported the kerberos HDFS. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gusAF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/991,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gutA2,incubator-uniffle,1622855734,991,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-06T02:21:44Z,2023-07-06T02:21:44Z,"> From my side, the Tez client should have supported the kerberos HDFS.

@zuston 

Yes, tez use token from container, so support secure cluster.
But client-tez bring TezRemoteShuffleManager, this rpc server does not set SecretManager. 
You can just see https://github.com/zhengchenyu/incubator-uniffle/commit/39d6b1b3c1ba8489b413bf8afceccd899eb3f945#diff-437a2f418c761939b135bf7356875f3e7caa3c8915596db17c1970551227e994","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gutA2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/991,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gutYn,incubator-uniffle,1622857255,991,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-06T02:22:59Z,2023-07-06T02:22:59Z,"> > From my side, the Tez client should have supported the kerberos HDFS.
> 
> @zuston
> 
> Yes, tez use token from container, so support secure cluster. But client-tez bring TezRemoteShuffleManager, this rpc server does not set SecretManager. You can just see [zhengchenyu@39d6b1b#diff-437a2f418c761939b135bf7356875f3e7caa3c8915596db17c1970551227e994](https://github.com/zhengchenyu/incubator-uniffle/commit/39d6b1b3c1ba8489b413bf8afceccd899eb3f945#diff-437a2f418c761939b135bf7356875f3e7caa3c8915596db17c1970551227e994)

Got it. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gutYn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/992,https://api.github.com/repos/apache/incubator-uniffle/issues/992,incubator-uniffle,1787537423,992,[Bug][tez] convertTaskAttemptIdToLong should not consider appattemptid.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-07-04T09:28:36Z,2023-07-17T07:05:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When we convert task attempt id to long, consider real taskAttemptID = taskAttemptID - (appAttemptId - 1) * 1000, the logical only apply to mr. tez should remove this.

If appAttemptId is 2, taskattemptid will be normalized to negative value, it is unexpected.


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/992/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/993,https://api.github.com/repos/apache/incubator-uniffle/issues/993,incubator-uniffle,1787687112,993,[Improvement][tez] Optimize the method of obtain the application attempt id.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-07-04T10:50:39Z,2023-07-19T06:07:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For now, we obtain the application attempt id from environment variable CONTAINER_ID. But CONTAINER_ID is not set in tez local mode. Then tez local mode will throw error like this:

```
2023-07-04 17:40:12,034 INFO HistoryEventHandler.criticalEvents: [HISTORY][DAG:dag_1688463608398_0001_1][Event:TASK_ATTEMPT_FINISHED]: vertexName=Tokenizer, taskAttemptId=attempt_1688463608398_0001_1_00_000001_0, creationTime=1688463611329, allocationTime=1688463611918, startTime=1688463612008, finishTime=1688463612034, timeTaken=26, status=FAILED, taskFailureType=NON_FATAL, errorEnum=FRAMEWORK_ERROR, diagnostics=Error: Error while running task ( failure ) : attempt_1688463608398_0001_1_00_000001_0:java.lang.NullPointerException
	at org.apache.hadoop.yarn.api.records.ContainerId.fromString(ContainerId.java:190)
	at org.apache.hadoop.yarn.util.ConverterUtils.toContainerId(ConverterUtils.java:140)
	at org.apache.tez.runtime.library.common.sort.impl.RssSorter.<init>(RssSorter.java:123)
	at org.apache.tez.runtime.library.output.RssOrderedPartitionedKVOutput.start(RssOrderedPartitionedKVOutput.java:201)
	at org.apache.tez.runtime.library.processor.SimpleProcessor.preOp(SimpleProcessor.java:87)
	at org.apache.tez.runtime.library.processor.SimpleProcessor.run(SimpleProcessor.java:60)
	at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask.run(LogicalIOProcessorRuntimeTask.java:374)
	at org.apache.tez.runtime.task.TaskRunner2Callable$1.run(TaskRunner2Callable.java:73)
	at org.apache.tez.runtime.task.TaskRunner2Callable$1.run(TaskRunner2Callable.java:61)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)
	at org.apache.tez.runtime.task.TaskRunner2Callable.callInternal(TaskRunner2Callable.java:61)
	at org.apache.tez.runtime.task.TaskRunner2Callable.callInternal(TaskRunner2Callable.java:37)
	at org.apache.tez.common.CallableWithNdc.call(CallableWithNdc.java:36)
	at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:125)
	at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:57)
	at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:78)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
```

In fact, we can obtain application attempt id by below way, this way is effective for tez local mode and yarn mode.

```
ApplicationAttemptId.newInstance(getContext().getApplicationId(), getContext().getDAGAttemptNumber());
```


### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/993/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/993,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gj_TZ,incubator-uniffle,1620047065,993,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-04T11:10:32Z,2023-07-04T11:10:32Z,"The logical of tez local mode is similar to tez yarn mode,  so tez local mode is useful way in development mode.

If wanna tez local mode run with uniffle, need below patch:

```
---
 .../org/apache/tez/client/LocalClient.java    | 26 ++++++++++++++++---
 1 file changed, 22 insertions(+), 4 deletions(-)

diff --git a/tez-dag/src/main/java/org/apache/tez/client/LocalClient.java b/tez-dag/src/main/java/org/apache/tez/client/LocalClient.java
index 6baea48..4612645 100644
--- a/tez-dag/src/main/java/org/apache/tez/client/LocalClient.java
+++ b/tez-dag/src/main/java/org/apache/tez/client/LocalClient.java
@@ -45,10 +45,12 @@ import org.apache.hadoop.yarn.api.records.ApplicationAttemptId;
 import org.apache.hadoop.yarn.api.records.ApplicationReport;
 import org.apache.hadoop.yarn.api.records.YarnApplicationState;
 import org.apache.hadoop.yarn.util.SystemClock;
+import org.apache.tez.common.ReflectionUtils;
 import org.apache.tez.common.TezCommonUtils;
 import org.apache.tez.common.TezUtilsInternal;
 import org.apache.tez.dag.api.TezConfiguration;
 import org.apache.tez.dag.api.TezException;
+import org.apache.tez.dag.api.TezReflectionException;
 import org.apache.tez.dag.api.client.DAGClientHandler;
 import org.apache.tez.dag.api.records.DAGProtos;
 import org.apache.tez.dag.api.records.DAGProtos.AMPluginDescriptorProto;
@@ -312,7 +314,7 @@ public class LocalClient extends FrameworkClient {
           }

           // Construct, initialize, and start the DAGAppMaster
-          ApplicationAttemptId applicationAttemptId = ApplicationAttemptId.newInstance(appId, 0);
+          ApplicationAttemptId applicationAttemptId = ApplicationAttemptId.newInstance(appId, 1);
           ContainerId cId = ContainerId.newInstance(applicationAttemptId, 1);
           String currentHost = InetAddress.getLocalHost().getHostName();
           int nmPort = YarnConfiguration.DEFAULT_NM_PORT;
@@ -360,9 +362,25 @@ public class LocalClient extends FrameworkClient {
         getPluginDescriptorInfo(conf, applicationAttemptId.getApplicationId().toString());


-    return new DAGAppMaster(applicationAttemptId, cId, currentHost, nmPort, nmHttpPort,
-        new SystemClock(), appSubmitTime, isSession, userDir, localDirs, logDirs,
-        versionInfo.getVersion(), credentials, jobUserName, amPluginDescriptorProto);
+    String className = this.conf.get(""tez.local.appmaster.class"", DAGAppMaster.class.getName());
+    try {
+      return ReflectionUtils.createClazzInstance(className,
+          new Class[] {
+              ApplicationAttemptId.class, ContainerId.class, String.class, int.class, int.class,
+              Clock.class, long.class, boolean.class, String.class, String[].class, String[].class,
+              String.class, Credentials.class, String.class, AMPluginDescriptorProto.class
+          },
+          new Object[] {
+              applicationAttemptId, cId, currentHost, nmPort, nmHttpPort,
+              new SystemClock(), appSubmitTime, isSession, userDir, localDirs, logDirs,
+              versionInfo.getVersion(), credentials, jobUserName, amPluginDescriptorProto
+          }
+      );
+    } catch (TezReflectionException e) {
+      return new DAGAppMaster(applicationAttemptId, cId, currentHost, nmPort, nmHttpPort,
+          new SystemClock(), appSubmitTime, isSession, userDir, localDirs, logDirs,
+          versionInfo.getVersion(), credentials, jobUserName, amPluginDescriptorProto);
+    }
   }

   private AMPluginDescriptorProto getPluginDescriptorInfo(Configuration conf,
--
```

And the tez local application command is:

```
HADOOP_CLASSPATH=${TEZ_CONF_DIR}:${TEZ_HOME}/*:${TEZ_HOME}/lib/*:rss-client-tez-XXX-shaded.jar
hadoop jar ${TEZ_HOME}/tez-examples-0.9.2.jar wordcount \
  -Dhadoop.security.authentication=simple \
  -local \
  /XXX/examples/tez-examples/data/wordcount/input \
  /XXX/examples/tez-examples/data/wordcount/output \
  2
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gj_TZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/996,incubator-uniffle,1789147846,996,[Bug] json_exporter export  jvm and grpc metrics to promethus format happen error,smlHao,3837738,,,CLOSED,2023-07-05T09:25:45Z,2023-07-29T00:17:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

json_exporter export  jvm and grpc metrics to promethus format happen error

json_exporter config.yaml :
                                          modules:
                                                default:
                                                  headers:
                                                    MyHeader: MyHeaderValue
                                                  metrics:
                                                    - name: rss_shuffle_server
                                                      type: object
                                                      help: General statistics of the top cryptocurrencies
                                                      path: '{.metrics[*]}'
                                                      labels:
                                                        name: 'rss_worker_{.name}'
                                                      values:
                                                        value1: '{.value}'

start json_exporter:  ./json_exporter --config.file config.yml

then call : curl http://localhost:7979/probe?target=http://[uniffle serverIp]:[jettyPort]/metrics/jvm , error happend:
![image](https://github.com/apache/incubator-uniffle/assets/3837738/5488f463-bd74-4b25-8221-f9fb5cefdbab)


guess  the error happend  because of  the metrics value like  ""value"":3.3737474048E10 , ""value"":""NaN"" 




### Affects Version(s)

0.7.1

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/996/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpJBY,incubator-uniffle,1621397592,996,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-05T09:37:26Z,2023-07-05T09:37:26Z,The value of `3.3737474048E10`  is correct.  The value use scientific notation.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpJBY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpRWJ,incubator-uniffle,1621431689,996,NA,smlHao,3837738,,,NA,2023-07-05T09:56:49Z,2023-07-05T09:56:49Z,"> The value of `3.3737474048E10` is correct. The value use scientific notation.

Thank your fro  fast reply !!!!
 yes,  I know，I think json_exporter has no handler to match this,  /metrics/server works fine, so is it possible keep same with  /metrics/serve , don`t use  scientific notation? 

in addition，/metrics/grpc has ""value"":""NaN""
![image](https://github.com/apache/incubator-uniffle/assets/3837738/5bd7c5ee-fd3d-4bf6-b173-d7b9eb66e8a3)

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpRWJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpnkW,incubator-uniffle,1621522710,996,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-05T10:58:28Z,2023-07-05T10:58:28Z,You should use prometheus api like `/prometheus/metrics/server` instead of `/metrics/server`.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpnkW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpu6j,incubator-uniffle,1621552803,996,NA,smlHao,3837738,,,NA,2023-07-05T11:17:10Z,2023-07-05T11:17:10Z,"ok，thank you，because metrics is json format and had deployed&nbsp; promethus，so i chose json_exporter to pull the metrics send to promethus ; if use promethus api instead of uniffle metrics api，do you have some documents for doing this?



---Original---
From: ***@***.***&gt;
Date: Wed, Jul 5, 2023 18:58 PM
To: ***@***.***&gt;;
Cc: ***@***.******@***.***&gt;;
Subject: Re: [apache/incubator-uniffle] [Bug] json_exporter export  jvm andgrpc metrics to promethus format happen error (Issue #996)




 
You should use prometheus api like /prometheus/metrics/server instead of /metrics/server.
 
—
Reply to this email directly, view it on GitHub, or unsubscribe.
You are receiving this because you authored the thread.Message ID: ***@***.***&gt;","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpu6j/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpxoQ,incubator-uniffle,1621563920,996,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-05T11:24:35Z,2023-07-05T11:24:35Z,May this is useful for you. https://github.com/apache/incubator-uniffle/blob/master/docs/server_guide.md#prometheuspushgatewaymetricreporter-settings,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gpxoQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gp7L7,incubator-uniffle,1621603067,996,NA,smlHao,3837738,,,NA,2023-07-05T11:49:43Z,2023-07-05T11:49:43Z,"OK ，thank you very much!&nbsp; &nbsp; I&nbsp; will&nbsp; try it



---Original---
From: ***@***.***&gt;
Date: Wed, Jul 5, 2023 19:24 PM
To: ***@***.***&gt;;
Cc: ***@***.******@***.***&gt;;
Subject: Re: [apache/incubator-uniffle] [Bug] json_exporter export  jvm andgrpc metrics to promethus format happen error (Issue #996)




 
May this is useful for you. https://github.com/apache/incubator-uniffle/blob/master/docs/server_guide.md#prometheuspushgatewaymetricreporter-settings
 
—
Reply to this email directly, view it on GitHub, or unsubscribe.
You are receiving this because you authored the thread.Message ID: ***@***.***&gt;","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gp7L7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gu5AR,incubator-uniffle,1622904849,996,NA,smlHao,3837738,,,NA,2023-07-06T03:18:50Z,2023-07-06T03:18:50Z,"> May this is useful for you. https://github.com/apache/incubator-uniffle/blob/master/docs/server_guide.md#prometheuspushgatewaymetricreporter-settings

Hi,  I had try it and  it works fine,the metrics had been imported into promethus, now  I want to display them in grafana,  do you have a grafana dashboard json which  can be  imported  in grafana?   if so, this can help us easy to monitor. Thanks","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gu5AR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gu82G,incubator-uniffle,1622920582,996,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-06T03:41:07Z,2023-07-06T03:41:07Z,"> Hi, I had try it and it works fine,the metrics had been imported into promethus, now I want to display them in grafana, do you have a grafana dashboard json which can be imported in grafana? if so, this can help us easy to monitor. Thanks

I don't have. Maybe @xianjingfeng  has the grafana dashboard json.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gu82G/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gvW5-,incubator-uniffle,1623027326,996,NA,smlHao,3837738,,,NA,2023-07-06T05:44:46Z,2023-07-06T05:44:46Z,"@xianjingfeng  Hi, do you have the grafana dashboard json file?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gvW5-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gvykv,incubator-uniffle,1623140655,996,NA,xianjingfeng,11752250,,,NA,2023-07-06T07:34:23Z,2023-07-06T07:34:23Z,"> @xianjingfeng Hi, do you have the grafana dashboard json file?

https://docs.google.com/document/d/1xKblAIoRgpwf3iTPTM1rq_wOJH4dIhnM2Skx56fMgMM/edit?usp=sharing","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gvykv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gv4Zy,incubator-uniffle,1623164530,996,NA,smlHao,3837738,,,NA,2023-07-06T07:53:18Z,2023-07-06T07:53:18Z,"> > @xianjingfeng Hi, do you have the grafana dashboard json file?
> 
> https://docs.google.com/document/d/1xKblAIoRgpwf3iTPTM1rq_wOJH4dIhnM2Skx56fMgMM/edit?usp=sharing

 Hi, got it, Thanks !!!

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gv4Zy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gwlLm,incubator-uniffle,1623347942,996,NA,xianjingfeng,11752250,,,NA,2023-07-06T09:37:15Z,2023-07-06T09:37:15Z,"> > > > @xianjingfeng Hi, do you have the grafana dashboard json file?
> > > 
> > > 
> > > https://docs.google.com/document/d/1xKblAIoRgpwf3iTPTM1rq_wOJH4dIhnM2Skx56fMgMM/edit?usp=sharing
> > 
> > 
> > Hi, got it, Thanks !!!
> 
> @xianjingfeng Hi,I had try it and find this grafana json file is used for coordinator cluster, is there another file grafana json file for shuffle server? if so,can you share me? Thanks !!!

Already included shuffle server.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gwlLm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gwoTK,incubator-uniffle,1623360714,996,NA,smlHao,3837738,,,NA,2023-07-06T09:41:09Z,2023-07-06T09:41:09Z,"> > > > > @xianjingfeng Hi, do you have the grafana dashboard json file?
> > > > 
> > > > 
> > > > https://docs.google.com/document/d/1xKblAIoRgpwf3iTPTM1rq_wOJH4dIhnM2Skx56fMgMM/edit?usp=sharing
> > > 
> > > 
> > > Hi, got it, Thanks !!!
> > 
> > 
> > @xianjingfeng Hi,I had try it and find this grafana json file is used for coordinator cluster, is there another file grafana json file for shuffle server? if so,can you share me? Thanks !!!
> 
> Already included shuffle server.

yes, I had known about this , Thanks !!!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5gwoTK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hXkSt,incubator-uniffle,1633567917,996,NA,advancedxy,807537,,,NA,2023-07-13T05:25:43Z,2023-07-13T05:25:43Z,"> https://docs.google.com/document/d/1xKblAIoRgpwf3iTPTM1rq_wOJH4dIhnM2Skx56fMgMM/edit?usp=sharing

Hi, @xianjingfeng do you think it's possible to include this grafana json file as a template file in the uniffle repo and update the doc to include that part?  It might be useful.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hXkSt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hg2T3,incubator-uniffle,1636001015,996,NA,xianjingfeng,11752250,,,NA,2023-07-14T15:08:59Z,2023-07-14T15:08:59Z,"> > https://docs.google.com/document/d/1xKblAIoRgpwf3iTPTM1rq_wOJH4dIhnM2Skx56fMgMM/edit?usp=sharing
> 
> Hi, @xianjingfeng do you think it's possible to include this grafana json file as a template file in the uniffle repo and update the doc to include that part? It might be useful.

Yes, just like ambari do. https://github.com/apache/ambari/tree/trunk/ambari-server/src/main/resources/common-services/AMBARI_METRICS/3.0.0/package/files/grafana-dashboards/default
But I think the file I gave is not good enough, like a draft.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hg2T3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/996,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iu-cT,incubator-uniffle,1656481555,996,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-29T00:17:00Z,2023-07-29T00:17:00Z,Solved.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iu-cT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/999,https://api.github.com/repos/apache/incubator-uniffle/issues/999,incubator-uniffle,1798001282,999,[Improvement] apply REST principles in the urls of the http interfaces,xianjingfeng,11752250,,,CLOSED,2023-07-11T03:21:38Z,2023-07-17T07:15:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

As we discuss in https://github.com/apache/incubator-uniffle/pull/684#discussion_r1125665019, we should apply REST principles in the urls of http interfaces

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/999/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1001,https://api.github.com/repos/apache/incubator-uniffle/issues/1001,incubator-uniffle,1798353362,1001,[Improvement] support get all metrics by one request,xianjingfeng,11752250,,,CLOSED,2023-07-11T08:00:03Z,2023-07-11T13:04:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, we need to get all metrics by three requests, but for metrics collecter, it maybe more reasonable that get all of them by one request.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1001/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1003,https://api.github.com/repos/apache/incubator-uniffle/issues/1003,incubator-uniffle,1798414355,1003,[#477] feat: support getShuffleResult throws FetchFailedException.,leixm,31424839,Xianming Lei,,OPEN,2023-07-11T08:34:34Z,2023-07-11T08:34:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

After https://github.com/apache/incubator-uniffle/pull/787, uniffle client supports throwing FetchFailedException when reading data to support stage resubmit, but it does not cover the getShuffleResult request. When the task is retried, the getShuffleResult request is first initiated, we should also support getShuffleResult throws FetchFailedException.

### How should we improve?

Support getShuffleResult throws FetchFailedException.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1003/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1003,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hLc8J,incubator-uniffle,1630392073,1003,NA,leixm,31424839,Xianming Lei,,NA,2023-07-11T08:34:51Z,2023-07-11T08:34:51Z,I will raise a PR later.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hLc8J/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1006,https://api.github.com/repos/apache/incubator-uniffle/issues/1006,incubator-uniffle,1800527192,1006,[FEATURE] Support Spark3.4,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-07-12T09:08:19Z,2023-08-07T11:30:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Spark 3.4.1 has been released. It's time to support in uniffle side. https://spark.apache.org/releases/spark-release-3-4-0.html

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1006/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1006,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hXFQB,incubator-uniffle,1633440769,1006,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-07-13T02:20:20Z,2023-07-13T02:20:20Z,Volunteering,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hXFQB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1006,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hYMOO,incubator-uniffle,1633731470,1006,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-13T07:41:58Z,2023-07-13T07:41:58Z,"> Volunteering

Thanks! ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hYMOO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1006,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jZtt-,incubator-uniffle,1667685246,1006,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2023-08-07T11:30:41Z,2023-08-07T11:30:41Z,Fixed by https://github.com/apache/incubator-uniffle/pull/1082,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jZtt-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1010,https://api.github.com/repos/apache/incubator-uniffle/issues/1010,incubator-uniffle,1803302079,1010,[Improvement] enable and enforce spotless,advancedxy,807537,,,CLOSED,2023-07-13T15:45:47Z,2023-07-14T11:07:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Iceberg has a built-in code formatter, it's a pleasure to have it around.

Let's add spotless in uniffle repo.

### How should we improve?

add the spotless plugin and enforce at github workflow.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1010/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1011,https://api.github.com/repos/apache/incubator-uniffle/issues/1011,incubator-uniffle,1804639978,1011,[FEATURE] [tez] Avoid recompute succeeded task.,zhengchenyu,10381583,zhengchenyu,,OPEN,2023-07-14T10:34:14Z,2023-08-07T08:24:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In general local shuffle, some succeeded task may be recomputed. For example, NM is unhealthy, reduce can not read the shuffle date from map which have run successfully in unhealthy NM. 
But for remote shuffle, the shuffle data have store in remote shuffle service, recompute the succeeded task which have run in  unhealthy node is unnecessary.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1011/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1011,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hfpir,incubator-uniffle,1635686571,1011,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-14T10:55:17Z,2023-07-14T10:55:17Z,"# Analysis of recomputed tez task with uniffle

## 1 Background

Tez generally have mechanisms to recompute successful tasks. For example, without remote shuffle service, if the NM is unhealthy, the data generated by the map have done on unhealthy node cannot be provided to the downstream reduce. Therefore, it is necessary to recompute the task on a healthy NM node. Therefore, in general, tez will provide some mechanisms to recompute upstream succeeded tasks.

But in the RemoteShuffleService mode, if the task has successfully sent data to the remote shuffle service. Then there are no need to recompute upstream succeeded tasks when NM is unavailable. That means we have to analyze how tasks in the SUCCEEDED state are recomputed.

## 2 Why the succeeded task recompute

Task recompute mainly refers to the task that is already in the SUCCEEDED state, which becomes non-SUCCEEDED for some reason, and the task is recompute after certain conditions are met. We need to identify which logics in tez will generate task recompute, and identify which ones do not need to be recompute in remote shuffle mode, and prohibit them.

Tez mainly organizes tasks according to DAG->Vertx->Task->TaskImpl. there are several possible situations Will cause the task already in the SUCCEEDED state to recomputed:

* (a) Too many taskattempts failed to run on one node
* (b) When the blacklist function is turn on, will check of all node, then run the logical (a)
* (c) When notify by RM that node is in an unhealthy state
* (d) Sufficient downstream notification read failures.


### 2.a Too many taskattempts failed to run on one node

#### reason

If there are enough taskattempts that fail to run on one node (more than tez.am.maxtaskfailures.per.node, the default is 10), kill all taskattempts of all containers on this node, and let them compute again if necessary.

#### action
This logical should be disabled in remote shuffle service mode.

### 2.b When the blacklist function is turn on, will check of all node, then run the logical (a)

#### reason
When the number of blacklisted machines of the task is greater than 33% of the total machines (tez.am.node-blacklisting.ignore-threshold-node-percent), it will enter the function of ignoring the blacklist. If it changes from higher than 33% to less than 33%, start this function. During this process, all nodes will be checked, and the logic of (2.a) will be used to check each node, and recompute if necessary.

### action
This type of rerun needs to be disabled in RSS mode....

### 2.c When notify by RM that node is in an unhealthy state

####reason
When the node becomes unhealthy, if tez.am.node-unhealthy-reschedule-tasks is set to true (the default is false), kill all TaskAttempts of all Containers on this node, and let it recompoute if necessary.

#### action
In remote shuffle service mode, it is necessary to prohibit such recompute, just set tez.am.node-unhealthy-reschedule-tasks to false.

### 2.d Sufficient downstream notification read failures

#### reason
When there are enough downstream nodes that fail to read task notifications, the TaskAttempt will be killed, and recompute is necessary.

#### processing action
In RSS mode, if many downstream notifications fail to be read, there may be a problem with the uniffle service or some kind of calculation error, directly causing the task to fail or recompute all tasks of this vertex.

> chinese document: [analysis_1011.md](https://github.com/apache/incubator-uniffle/files/12103738/analysis_1011.md)
> detailed analysis: [state_detailed.md](https://github.com/apache/incubator-uniffle/files/12049695/state_detailed.md)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hfpir/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1011,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hfqqZ,incubator-uniffle,1635691161,1011,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-14T10:59:22Z,2023-07-14T10:59:22Z,"@zhengchenyu  First, we can let job fail. Then, we can optimize the logic like https://github.com/apache/incubator-uniffle/issues/477","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hfqqZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1011,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmptS,incubator-uniffle,1637522258,1011,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-17T07:32:49Z,2023-07-17T07:32:49Z,"## 3 Reproduce the problem

### 3.1 Reproduce problem (a): Too many taskattempts failed to run on the node

Steps to reproduce:

* tez.am.maxtaskfailures.per.node set to 1
* start orderedwordcount
* Check the appmaster page, wait for the Tokenizer to have a map completed and other maps not completed, then kill other containers of the task on thi node corresponding to the Tokenizer.
* Check whether the previously marked successful map has been rerun.

In this example, we found that the 0th attempt of Task 19 in the Tokenizer is completed first.

<img width=""1906"" alt=""3 1 1"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/3479ab43-8a95-43e3-8295-497b514fcec0"">

Then we killed all non-AppMaster container on this node. Then after a while, we found that Task 19 had reomputed.

<img width=""1143"" alt=""3 1 2"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/ec0637bc-406e-4165-9194-08bd8abf2c6d"">

See the following error. Note that if there are more than tez.am.maxtaskfailures.per.node task failures, the node will be added to the blacklist.

<img width=""547"" alt=""3 1 3"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/82710899-068d-47e8-9411-e0a7459023e2"">

### 3.2 Reproduce problem (b)

same with (a), omit.

### 3.3 Reproducibility problem (c): When notify by RM that node is in an unhealthy state.

Steps to reproduce:

* tez.am.node-unhealthy-reschedule-tasks set to true
* start orderedwordcount
* Check the appmaster page, wait for the Tokenizer to have a map completed and the other maps are not completed, and decommission the node which the completed map have compute successfully.
* Check whether the previously marked successful map has been recompute.

In this example, we can see that Task 6, 7, and 8 have been completed at this time.

<img width=""1910"" alt=""3 3 1"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/8fe3fe47-edb3-4f10-b2fe-d31aae447000"">

Then we decommission the NM which task 6,7,8 have computed successfully. We found that tasks 6, 7, and 8 have been recomputed.

<img width=""1912"" alt=""3 3 2"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/4cb29cc3-263c-486a-b8e5-6a91e9cc2b6c"">

<img width=""610"" alt=""3 3 3"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/bb993561-0ae9-4077-83e9-53c1e2cc4117"">

And I also added some logs to verify kill the succeeded task after the node is unhealthy, detailed see the patch.

### 3.4 Problem recurrence (d): Sufficient downstream notification read failures

We can stuck shuffle server to reproduce process is as follows:

* set tez.am.maxtaskfailures.per.node to 1000
* tez.task.max.allowed.output.failures set to 1
* tez.am.max.allowed.time-sec.for-read-error set to 0
* tez.task.max.allowed.output.failures.fraction set to 0.01
* start orderedwordcount
* Check the page of appmaster and wait for all tasks of Tokenizer to be completed, but Summation has just started and copy shuffle has not been completed yet. Make the shuffle server stuck (this can be realized through idea remote debugging).
* View task status.

In fact, the task is not recomputed as expected, but the reduce will report the following error and directly cause the task to fail. Because RssShuffleScheduler::copyFailed is not called under tez rss, it also means that the InputReadErrorEvent event is not sent to AM.

```
2023-07-20 12:41:12,932 [ERROR] [ShuffleAndMergeRunner {Tokenizer}] |orderedgrouped.RssShuffle|: Tokenizer: RSSShuffleRunner failed with error
org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffle$RssShuffleError: Error during shuffle
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffle$RssRunShuffleCallable.callInternal(RssShuffle.java:289)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffle$RssRunShuffleCallable.callInternal(RssShuffle.java:281)
	at org.apache.tez.common.CallableWithNdc.call(CallableWithNdc.java:36)
	at org.apache.uniffle.com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131)
	at org.apache.uniffle.com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74)
	at org.apache.uniffle.com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.uniffle.common.exception.RssFetchFailedException: Get shuffle result is failed for appId[appattempt_1683514060868_80962_000001], shuffleId[1000001]
	at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.getShuffleResult(ShuffleWriteClientImpl.java:618)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffleScheduler.constructRssFetcherForPartition(RssShuffleScheduler.java:1580)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffleScheduler.access$1600(RssShuffleScheduler.java:104)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffleScheduler$RssShuffleSchedulerCallable.callInternal(RssShuffleScheduler.java:1520)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffleScheduler$RssShuffleSchedulerCallable.callInternal(RssShuffleScheduler.java:1440)
	at org.apache.tez.common.CallableWithNdc.call(CallableWithNdc.java:36)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffleScheduler.start(RssShuffleScheduler.java:495)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffle$RssRunShuffleCallable.callInternal(RssShuffle.java:287)
	... 8 more
```

## 4 Solutions
### 4.1 Problem (a) Solution

In TerminatedAfterSuccessTransition, we just return the succeeded, do not any other operations. see the attachment patch.

> For now, I do it in tez source code. Let me find a way to do it in uniffle.

### 4.2 Problem (b) Solution

same question (a)

### 4.3 Problem (c) Solution

Set tez.am.node-unhealthy-reschedule-tasks to false (the default is false).

### 4.4 Problem (d) Solution

* (1) If the job fails directly, the current version does not need to do anything. Further optimization: enable recovery, then restore successful tasks and avoid recompute tasks. (recovery maybe do in another issue)
* (2) If you do not let the job fail, we should recompute the current vertex, need to keep pace with https://github.com/apache/incubator-uniffle/issues/477. Maybe do it in another issue.

> Chinese document:  [reproduce_1011.md](https://github.com/apache/incubator-uniffle/files/12104392/reproduce_1011.md)
> Verify log patch: [0001-add-log.patch](https://github.com/apache/incubator-uniffle/files/12104348/0001-add-log.patch)
> Fix problem(a) and (b) patch: [0001-rss-task.patch](https://github.com/apache/incubator-uniffle/files/12104350/0001-rss-task.patch)


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hmptS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1011,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jYPWf,incubator-uniffle,1667298719,1011,NA,okumin,1548925,Shohei Okumiya,github@okumin.com,NA,2023-08-07T07:02:15Z,2023-08-07T07:02:15Z,"I'm still new to Uniffle and I might be very wrong.

I know we can annotate the reliability of source vertices per edge. It could be an option to implement the feature of `rss.avoid.recompute.succeeded.task` in Tez side, and Uniffle just uses the edge type.
https://github.com/apache/tez/blob/rel/release-0.10.2/tez-api/src/main/java/org/apache/tez/dag/api/EdgeProperty.java#L78-L82","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jYPWf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1011,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jYZHu,incubator-uniffle,1667338734,1011,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-08-07T07:31:15Z,2023-08-07T07:31:15Z,"@okumin 

Yes! It'd better that rss.avoid.recompute.succeeded.task take effect in tez side. Why do I implement this in uniffle side? Because I do not want to change the code of tez. Because I think wait for tez release is too slow.

In this PR, I use a trick way to implement it. 
You can see:
https://github.com/apache/incubator-uniffle/blob/ef7f392eb8f2a918f9305483275e444991759f6d/client-tez/src/main/java/org/apache/tez/dag/app/RssDAGAppMaster.java#L520

Even though uniffle just use edge type, I reset the dispatcher. All TA_NODE_FAILED events which want to send to SUCCEEDED TaskAttempt is ignored.

I test this function in test cluster and integration test, it need more production experience, so I disable it in default for now. Can you please review and give some suggestion? or give me more your production experience?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jYZHu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1012,https://api.github.com/repos/apache/incubator-uniffle/issues/1012,incubator-uniffle,1804694429,1012,[Flaky Test] TezRemoteShuffleManagerTest.testTezRemoteShuffleManager,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-07-14T11:13:18Z,2023-07-14T11:26:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

testTezRemoteShuffleManager  Time elapsed: 0.478 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: failed to get Shuffle Assignments ==> expected: <0> but was: <-2>

### Actions URL

[test-reports-tez.zip](https://github.com/apache/incubator-uniffle/files/12049807/test-reports-tez.zip)
https://github.com/apache/incubator-uniffle/actions/runs/5396923230/jobs/10093239882?pr=980

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1012/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1012,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hfygl,incubator-uniffle,1635723301,1012,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-14T11:26:03Z,2023-07-14T11:26:03Z,"Sorry, This isn't a flaky test. I will close it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hfygl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1013,https://api.github.com/repos/apache/incubator-uniffle/issues/1013,incubator-uniffle,1807164700,1013,[Bug] Judge and wait when return wait state MapOutput,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-07-17T07:32:06Z,2023-08-23T08:01:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When therer is not enough memory, It will return MapOutput of type wait, It should wait until there is enough memory.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1013/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1018,https://api.github.com/repos/apache/incubator-uniffle/issues/1018,incubator-uniffle,1808001515,1018,[Improvement] RssUnorderedPartitionedKVOutputTest add close func unit test ,bin41215,74609438,,,CLOSED,2023-07-17T15:09:27Z,2023-07-24T23:20:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

add RssUnorderedPartitionedKVOutputTest close func unit test 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1018/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1019,https://api.github.com/repos/apache/incubator-uniffle/issues/1019,incubator-uniffle,1808003469,1019,[Improvement] RssOrderedPartitionedKVOutputTest add close func unit test,bin41215,74609438,,,CLOSED,2023-07-17T15:10:18Z,2023-07-20T11:24:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

RssOrderedPartitionedKVOutputTest add close func unit test

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1019/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,incubator-uniffle,1808967448,1020,[FEATURE] Support hybrid shuffle manager,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-07-18T02:44:02Z,2023-08-13T17:43:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Delegation shuffle manager has been supported in uniffle, which is useful for avoiding instability of uniffle cluster.

But this is not enough, we hope the hybrid shuffle manager could be supported, that will support using ESS or Uniffle on different stages in one App

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1020/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5htEgT,incubator-uniffle,1639204883,1020,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-18T02:44:22Z,2023-07-18T02:44:22Z,cc @jerqi @advancedxy ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5htEgT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5htLRG,incubator-uniffle,1639232582,1020,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-18T03:00:25Z,2023-07-18T03:00:25Z,The biggest problem is  exchange reuse and stage recompute. How to handle them?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5htLRG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hvtTO,incubator-uniffle,1639896270,1020,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-18T09:46:03Z,2023-07-18T09:46:03Z,"> The biggest problem is exchange reuse and stage recompute. How to handle them?

Sorry, I don't get your point. BTW, I tested the exchange reuse and it works well when using HybridShuffleManager.

From my prospective, for one shuffleId, it only will use one type of ess/rss, so it always will OK. Right? If I'm wrong, please point out. Thanks","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hvtTO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hvzqe,incubator-uniffle,1639922334,1020,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-18T10:04:06Z,2023-07-18T10:04:06Z,"> > The biggest problem is exchange reuse and stage recompute. How to handle them?
> 
> Sorry, I don't get your point. BTW, I tested the exchange reuse and it works well when using HybridShuffleManager.
> 
> From my prospective, for one shuffleId, it only will use one type of ess/rss, so it always will OK. Right? If I'm wrong, please point out. Thanks

If one shuffle is bind to ess or rss, it's ok. I'm worried that one shuffle change from rss to ess.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hvzqe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hwMGp,incubator-uniffle,1640022441,1020,NA,advancedxy,807537,,,NA,2023-07-18T11:14:25Z,2023-07-18T11:14:25Z,"> cc @jerqi @advancedxy

I think it's nice to have this feature. It might also be related with stage resubmission.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5hwMGp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ji5mn,incubator-uniffle,1670093223,1020,NA,pegasas,13224827,John Huang,pegasashjy@gmail.com,NA,2023-08-08T18:21:40Z,2023-08-08T18:21:40Z,"Hi, community, 

I would like to try this issue. 
Would you like to assign this task to me?

It seems I should add HybridShuffleManager with some tests and integration tests like DelegationRssShuffleManager/RssShuffleManager, which is an opportunity for me to go deeper into uniffle.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ji5mn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jyM-9,incubator-uniffle,1674104765,1020,NA,pegasas,13224827,John Huang,pegasashjy@gmail.com,NA,2023-08-11T01:06:23Z,2023-08-11T01:06:23Z,"Hi, @zuston , @jerqi , 

I have a naive question.
How to decide on the shuffle strategy (ESS/RSS/Uniffle) of each shuffleId for spark driver/executor？
When to change RSS to ESS is our best practise?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jyM-9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1020,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jyOm1,incubator-uniffle,1674111413,1020,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-11T01:19:48Z,2023-08-11T01:19:48Z,"> Hi, @zuston , @jerqi ,
> 
> I have a naive question. How to decide on the shuffle strategy (ESS/RSS/Uniffle) of each shuffleId for spark driver/executor？ When to change RSS to ESS is our best practise?

You can see the DelegationShuffleManager design, the pass or not depends on the load or other access checker of coordinator determines","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jyOm1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1024,https://api.github.com/repos/apache/incubator-uniffle/issues/1024,incubator-uniffle,1813205749,1024,[Improvement] [tez]：Optimize user switch to shuffle mode local/remote.,baitian77,14013778,,,CLOSED,2023-07-20T05:47:49Z,2024-01-03T10:01:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, users need to set the parameter tez.am.launch.launch.cmd-opts to switch between local shuffle and remote shuffle, but this parameter is difficult for users to understand.   
We need a simpler and easier to understand parameter，such as tez.shuffle.mode = local/remote

### How should we improve?

1. set tez.am.launch.launch.cmd-opts=-XX:+PrintGCDetails -verbose:gc -XX:+PrintGCTimeStamps -XX:+UseNUMA -XX:+UseParallelGC org.apache.tez.dag.app.RssDAGAppMaster。 【 note： this config will not change 】
2. add new conf tez.shuffle.mode  which will used in RssDAGAppMaster.  when this conf equal local,  RssDAGAppMaster will use all DAGAppMaster  functions


### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1024/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1024,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iFeBY,incubator-uniffle,1645600856,1024,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-21T13:35:17Z,2023-07-21T13:35:17Z,Could we do similar things in another class? Maybe you can refer to `DelegationRssShuffleManager` in our project.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iFeBY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1026,https://api.github.com/repos/apache/incubator-uniffle/issues/1026,incubator-uniffle,1813723091,1026,[Bug]  shuffle server have blocked threads,smlHao,3837738,,,OPEN,2023-07-20T11:02:11Z,2023-07-21T06:27:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

@jerqi @zuston 

 hi， when huge table join huge table， shuffle server have blocked threads ， Is it right?

server conf :  
rss.rpc.server.port 20000
rss.jetty.http.port 20001
rss.storage.basePath /app/rss-0.7.1/data
rss.storage.type MEMORY_LOCALFILE_HDFS
rss.coordinator.quorum 172.100.3.70:19999,172.100.3.71:19999,172.100.3.72:19999
rss.server.disk.capacity 50g

rss.server.flush.thread.alive 30
rss.server.flush.threadPool.size 10
rss.server.buffer.capacity 40g
rss.server.read.buffer.capacity 20g
rss.server.heartbeat.interval 10000
rss.rpc.message.max.size 1073741824
rss.server.preAllocation.expired 120000
rss.server.commit.timeout 600000
rss.server.app.expired.withoutHeartbeat 120000
rss.server.flush.cold.storage.threshold.size 512m


rss client conf :

spark.shuffle.manager=org.apache.spark.shuffle.RssShuffleManager
spark.rss.coordinator.quorum=172.100.3.70:19999,172.100.3.71:19999,172.100.3.72:19999

spark.rss.storage.type=MEMORY_LOCALFILE_HDFS
spark.rss.remote.storage.path=hdfs://ns1/rss/sml


![image](https://github.com/apache/incubator-uniffle/assets/3837738/4fdb9724-4e6d-497a-96dc-01ee45ec9f75)

![image](https://github.com/apache/incubator-uniffle/assets/3837738/97f9a59b-5909-4db6-aef0-9ac89805ab29)

![image](https://github.com/apache/incubator-uniffle/assets/3837738/3ed319e3-f1d9-417c-a570-b587ab70850e)


the executor have no daemon thread holding and hava no error log

![image](https://github.com/apache/incubator-uniffle/assets/3837738/1baad065-8769-4092-82b6-5dbb24478167)

![image](https://github.com/apache/incubator-uniffle/assets/3837738/76b81e9d-1729-40f0-9bec-2c0da7052a79)


### Affects Version(s)

0.7.1

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1026/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1026,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iCw7x,incubator-uniffle,1644891889,1026,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-21T02:14:31Z,2023-07-21T02:14:31Z,What do you want to report? The app failed?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iCw7x/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1026,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iC1uq,incubator-uniffle,1644911530,1026,NA,smlHao,3837738,,,NA,2023-07-21T02:47:56Z,2023-07-21T02:47:56Z,"@zuston  hi ,  thanks  !!!
> What do you want to report
     1 . when huge table join huge table， shuffle server have blocked threads ， Is it right?  
     2 . the executor have no daemon thread and  holding ,  seem to hold on senddata to uniffle server , is my conf need to adjust ?
> The app failed ?
    after running 2 hours, seem no failed but executors holding , executor logs not update ,driver log only have uniffle heatbeat log


Do you have  performance tuning  about spark sql  huge table join ? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iC1uq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1026,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iC7FF,incubator-uniffle,1644933445,1026,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-21T03:27:46Z,2023-07-21T03:27:46Z,"No. But I have tuning with the huge partition. Firstly, we should find out the root cause. Please tell what happened for you app.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iC7FF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1026,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iC9iw,incubator-uniffle,1644943536,1026,NA,smlHao,3837738,,,NA,2023-07-21T03:47:23Z,2023-07-21T03:47:23Z,"> No. But I have tuning with the huge partition. Firstly, we should find out the root cause. Please tell what happened for you app.

@zuston  thanks !!!  yes, you are right ,  I found that : 

executor log  long time no update :
![image](https://github.com/apache/incubator-uniffle/assets/3837738/6d40a4be-77b4-4365-8e16-8f00359308cd)

then I check the executor  stack ,  find there are no daemon threads  WAITTING, seem to holding on senddata: 

![image](https://github.com/apache/incubator-uniffle/assets/3837738/a9b0872a-1b25-473f-82fb-ebbeba9fc8da)


then I analysis the shuffle server  stack , find there are  threads  BLOCKED ：
![image](https://github.com/apache/incubator-uniffle/assets/3837738/725df89e-2727-46e2-a16c-1cad410c10d9)


 myapp process seem  no change,  But I can`t find out the root cause , Do you have some steps to help me ?


>  tuning with the huge partition 
    Do you have documents help me do this ? 





","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iC9iw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1026,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iDQbG,incubator-uniffle,1645020870,1026,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-21T05:55:09Z,2023-07-21T05:55:09Z,"Can you check the shuffle-server and executor GC? Why not using the spark ui? And I think if you want to analysis, it's better to show the metrics into dashboard. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iDQbG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1026,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iDXDa,incubator-uniffle,1645048026,1026,NA,smlHao,3837738,,,NA,2023-07-21T06:27:07Z,2023-07-21T06:27:07Z,"> Can you check the shuffle-server and executor GC? Why not using the spark ui? And I think if you want to analysis, it's better to show the metrics into dashboard.
1 . check the shuffle-server and executor GC ： 
    shuffle-server no full gc , but  jvm_memory_bytes_used is  close to XMX_SIZE=""60g"" ：
![image](https://github.com/apache/incubator-uniffle/assets/3837738/5f717ed0-f8c7-45f1-b6eb-1e23ab2f95d6)
 executor gc seem normal ：
![image](https://github.com/apache/incubator-uniffle/assets/3837738/afe39443-6f8f-48e0-a6c9-16af2e29fa90)

2.  using the spark ui ： dont`t exported the port  and need use vpn
3.  metrics into dashboard : had show some metrics , feel shuffle server had too many blocked thread not normal ，but can`t find why 
    
![image](https://github.com/apache/incubator-uniffle/assets/3837738/f6099093-7e11-4169-8924-e36556aad997)
![image](https://github.com/apache/incubator-uniffle/assets/3837738/1ba65eb2-a6d7-40de-8aea-c9c28b4c4d48)
![image](https://github.com/apache/incubator-uniffle/assets/3837738/2ad58587-6c40-4e68-b8a3-d88b5bc021db)

@zuston  How do you  tuning with the huge partition ？  Could you help me do this ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iDXDa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1028,https://api.github.com/repos/apache/incubator-uniffle/issues/1028,incubator-uniffle,1815101781,1028,[Improvement] [k8s] Make HadoopConfig configurable via ConfigMap,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,OPEN,2023-07-21T03:37:33Z,2023-07-21T03:37:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The current approach of directly copying the Hadoop configuration into the RSS server image is not elegant and can be improved.
https://github.com/apache/incubator-uniffle/blob/2e54ce212c957ece37beaa8dc3c06856c2aac583/deploy/kubernetes/docker/Dockerfile#L50

### How should we improve?

We can use ConfigMap to configure Hadoop configurations, similar to what is done in rss-configuration. I will submit a PR to complete this task.
https://github.com/apache/incubator-uniffle/blob/master/deploy/kubernetes/operator/examples/configuration.yaml

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1028/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1029,https://api.github.com/repos/apache/incubator-uniffle/issues/1029,incubator-uniffle,1816995711,1029,[Umbrella]  Release 0.8.0,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-07-23T05:33:11Z,2024-04-17T08:40:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Release Apache Uniffle 0.8.0, we would like to release binary package. There are many things to do. First, we should ensure what issues should be included in this version.

### Task list

- [x] Bump `master` to `0.9.0-SNAPSHOT`.
- [x] Checkout `branch-0.8`.
- [x] Tag and release `0.8.0-rc1`.
    - [x] Backport necessary fixes from `master` to `branch-0.8`.
    - [x] Bump project version to `0.8.0` in `branch-0.8`.
    - [x] (GitHub) Tag `0.8.0-rc1`.
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.8.0-rc1/`.
    - [x] Post release note on [Uniffle website][1].
    - [x] Vote on dev@uniffle.apache.org
    - [ ] Vote on general@incubator.apache.org
- [x] Tag and release `0.8.0-rc2` (optional).
    - [x] Cancel the `0.8.0-rc1` vote on corresponding mailing lists.
    - [x] Backport necessary fixes from `master` to `branch-0.8`.
    - [x] (GitHub) Tag `0.8.0-rc2`.
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.8.0-rc2/`.
    - [x] Update release note on [Uniffle website][1].
    - [x] Vote on dev@uniffle.apache.org
    - [ ] Vote on general@incubator.apache.org
- [x] Tag and release `0.8.0-rc3` (optional).
    - [x] Cancel the `0.8.0-rc2` vote on corresponding mailing lists.
    - [x] Backport necessary fixes from `master` to `branch-0.8`.
    - [x] (GitHub) Tag `0.8.0-rc3`.
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.8.0-rc3/`.
    - [x] Update release note on [Uniffle website][1].
    - [x] Vote on dev@uniffle.apache.org
    - [x] Vote on general@incubator.apache.org
- [x] Tag and release `0.8.0`.
    - [x] (SVN) Move the artifacts under `dev/.../0.8.0-rc?` to `release/.../0.8.0` (by PPMC).
    - [x] (GitHub) Tag `0.8.0` to `0.8.0-rc?` and upload the artifacts.
    - [x] Update download link on [Uniffle website][1].
    - [x] Bump project version to `0.8.1-SNAPSHOT` in `branch-0.8`
    - [x] Post an announcement on general@incubator.apache.org

[1]: https://github.com/apache/incubator-uniffle-website

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1029/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1029,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJ3FJ,incubator-uniffle,1646752073,1029,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-23T05:36:54Z,2023-07-23T05:36:54Z,"I hope these issues can be included in this version.
https://github.com/apache/incubator-uniffle/issues/586
https://github.com/apache/incubator-uniffle/issues/1013
https://github.com/apache/incubator-uniffle/issues/1011","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJ3FJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1029,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iKJQ3,incubator-uniffle,1646826551,1029,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-23T12:21:05Z,2023-07-23T12:21:05Z,I think we'd better to have a benchmark report of grpc and netty before 0.8 releasing.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iKJQ3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1029,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ks2MG,incubator-uniffle,1689477894,1029,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-23T08:01:53Z,2023-08-23T08:01:53Z,@xianjingfeng All prs are ready. Let's start to release 0.8.0 version.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ks2MG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1029,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kyKdG,incubator-uniffle,1690871622,1029,NA,xianjingfeng,11752250,,,NA,2023-08-24T01:54:38Z,2023-08-24T01:54:38Z,"> @xianjingfeng All prs are ready. Let's start to release 0.8.0 version.

OK, i am going to start working on this today.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kyKdG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,incubator-uniffle,1817028112,1030,[Umbrella] Object Storage Support (Help Wanted),jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-07-23T07:48:27Z,2024-02-07T02:01:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Now, remote shuffle storage only support Hadoop Compatible Filesystem. Object storage is also important and widely used in the big data system. Object storage has different implement. Some systems don't support the method of `list` or have bad performance of the method `list`. Some systems need to consider file names to use more buckets of object. Some object storage don't support the method `append`. Now, we use store index and data separately, it will cause many small index files if we don't support the method `append`. So we should consider merging index files and data files. To have better performance, we should support object storage to adapt different object storage systems. 
https://docs.google.com/document/d/1E88wZA9Yhr-pGeUEfxo6uSgsIXxg_ivPYBNcTOeaaZA/edit

### Task list

- [ ] https://github.com/apache/incubator-uniffle/issues/892
- [ ] https://github.com/apache/incubator-uniffle/issues/391
- [ ] documents for object storage (need to create an issue)
- [ ] https://github.com/apache/incubator-uniffle/issues/1133

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1030/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJ8T8,incubator-uniffle,1646773500,1030,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-23T07:57:32Z,2023-07-23T07:57:32Z,I'm not familiar with object storage. Could you give me more inputs? @hiboyang @pspoerri @melodyyangaws  @zhaohc10 @LantaoJin @yuyang733,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJ8T8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJ8Vl,incubator-uniffle,1646773605,1030,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-23T07:58:08Z,2023-07-23T07:58:08Z,cc @xianjingfeng @zuston  Could we finish this issue together?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iJ8Vl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iKFjw,incubator-uniffle,1646811376,1030,NA,pspoerri,282446,Pascal Spörri,,NA,2023-07-23T11:08:56Z,2023-07-23T11:08:56Z,"**Regarding upload to S3**: As long as you use the Apache HDFS S3A adapter you can stream data to an object store. However you can only append as long as you keep the stream open and you can only do so from a single client. The [S3A filesystem implementation uses buffered multi-part uploads to stream a file to an object store](https://hadoop.apache.org/docs/stable/hadoop-aws/tools/hadoop-aws/index.html#How_S3A_writes_data_to_S3). Streaming from multiple clients should be possible in principle, but the coordination overhead and the way Java streams are implemented make things tricky.

**Regarding `.index` files**: For better performance you can always cache the index files, or serve them from a different location (Redis, Uniffle Coordinator, etc...).

**Regarding `list` support**: You can always store the list of objects somewhere else if you want to avoid any expensive file-listing operations. `spark-s3-shuffle` only uses listings when it needs to delete objects.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iKFjw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iLMsQ,incubator-uniffle,1647102736,1030,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-24T02:23:11Z,2023-07-24T02:23:11Z,"> **Regarding upload to S3**: As long as you use the Apache HDFS S3A adapter you can stream data to an object store. However you can only append as long as you keep the stream open and you can only do so from a single client. The [S3A filesystem implementation uses buffered multi-part uploads to stream a file to an object store](https://hadoop.apache.org/docs/stable/hadoop-aws/tools/hadoop-aws/index.html#How_S3A_writes_data_to_S3). Streaming from multiple clients should be possible in principle, but the coordination overhead and the way Java streams are implemented make things tricky.
> 
> **Regarding `.index` files**: For better performance you can always cache the index files, or serve them from a different location (Redis, Uniffle Coordinator, etc...).
> 
> **Regarding `list` support**: You can always store the list of objects somewhere else if you want to avoid any expensive file-listing operations. `spark-s3-shuffle` only uses listings when it needs to delete objects.

Thanks for your input.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iLMsQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iLNz6,incubator-uniffle,1647107322,1030,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-07-24T02:30:59Z,2023-07-24T02:30:59Z,"> cc @xianjingfeng @zuston Could we finish this issue together?

Yes. I will

> Regarding upload to S3: As long as you use the Apache HDFS S3A adapter you can stream data to an object store. However you can only append as long as you keep the stream open and you can only do so from a single client. The [S3A filesystem implementation uses buffered multi-part uploads to stream a file to an object store](https://hadoop.apache.org/docs/stable/hadoop-aws/tools/hadoop-aws/index.html#How_S3A_writes_data_to_S3). Streaming from multiple clients should be possible in principle, but the coordination overhead and the way Java streams are implemented make things tricky.

I hope the append could be avoided in this design. And I think it's OK to store same partition data into different files in object store. Like this: 

```
s3a://xxxxxxxxxx/{app_id}/{shuffle_id}/{partition_id}/0.index
s3a://xxxxxxxxxx/{app_id}/{shuffle_id}/{partition_id}/0.data
s3a://xxxxxxxxxx/{app_id}/{shuffle_id}/{partition_id}/1.index
s3a://xxxxxxxxxx/{app_id}/{shuffle_id}/{partition_id}/1.data
....


....
s3a://xxxxxxxxxx/{app_id}/{shuffle_id}/{partition_id}/990.index
s3a://xxxxxxxxxx/{app_id}/{shuffle_id}/{partition_id}/990.data
```

The one flush of shuffle-server for one partition could be flushed into one file. But this is ensured by the following rules.
1. The partition must be managed by single shuffle-server. Because the `id` of file prefix name only known with shuffle-server

For reader, it could get the `endId` (s3a://xxxxxxxxxx/{app_id}/{shuffle_id}/{partition_id}/endId.data) from the shuffle-server. That means we need not `list` operation


If I'm wrong, feel free to point out

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iLNz6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iLUYO,incubator-uniffle,1647134222,1030,NA,xianjingfeng,11752250,,,NA,2023-07-24T03:11:59Z,2023-07-24T03:11:59Z,"> cc @xianjingfeng @zuston Could we finish this issue together?

It is ok for me.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iLUYO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iLWHa,incubator-uniffle,1647141338,1030,NA,xianjingfeng,11752250,,,NA,2023-07-24T03:23:29Z,2023-07-24T03:23:29Z,"> s3a://xxxxxxxxxx/{app_id}/{shuffle_id}/{partition_id}/990.data

`s3a://xxxxxxxxxx/{app_id}/{shuffle_id}/{partition_id}/{shuffle_server_id}/990.data` may be better?


> **Regarding `.index` files**: For better performance you can always cache the index files, or serve them from a different location (Redis, Uniffle Coordinator, etc...)

Agree. And I think we can let users to choose whether store index files in memory or other external system.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iLWHa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVrUn,incubator-uniffle,1666626855,1030,NA,hiboyang,14280154,Bo Yang,,NA,2023-08-05T22:31:41Z,2023-08-05T22:31:41Z,"Yeah, a lot of small index files will not work well in object storage like S3. Maybe good idea to store in other places. Or is it possible to serve index file from Spark driver?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVrUn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jW2pu,incubator-uniffle,1666935406,1030,NA,pegasas,13224827,John Huang,pegasashjy@gmail.com,NA,2023-08-06T18:08:06Z,2023-08-06T18:08:06Z,"With my limited experience, I think s3 is a good choice in this issue. 

If we choose to support s3, then it will easily extend to other filesystems (NFS, CIFS, EFS, GCS fuse, Azure File System) by using a solution like MinIO.

> Yeah, a lot of small index files will not work well in object storage like S3. Maybe a good idea to store it in other places. Or is it possible to serve index files from Spark driver?

I think we may have other solution for merging small index files like [application-and-practice-of-spark-small-file-merging-function-on-aws-s3](https://aws.amazon.com/cn/blogs/china/application-and-practice-of-spark-small-file-merging-function-on-aws-s3/)? 

Feel free to correct me if I am wrong.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jW2pu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXjuG,incubator-uniffle,1667120006,1030,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-07T03:09:40Z,2023-08-07T03:09:40Z,"> Yeah, a lot of small index files will not work well in object storage like S3. Maybe good idea to store in other places. Or is it possible to serve index file from Spark driver?

Thanks for your input.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXjuG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXkJC,incubator-uniffle,1667121730,1030,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-07T03:12:40Z,2023-08-07T03:12:40Z,"> With my limited experience, I think s3 is a good choice in this issue.
> 
> If we choose to support s3, then it will easily extend to other filesystems (NFS, CIFS, EFS, GCS fuse, Azure File System) by using a solution like MinIO.
> 
> > Yeah, a lot of small index files will not work well in object storage like S3. Maybe a good idea to store it in other places. Or is it possible to serve index files from Spark driver?
> 
> I think we may have other solution for merging small index files like [application-and-practice-of-spark-small-file-merging-function-on-aws-s3](https://aws.amazon.com/cn/blogs/china/application-and-practice-of-spark-small-file-merging-function-on-aws-s3/)?
> 
> Feel free to correct me if I am wrong.

I will propose a document at this weekend. First, we can only define some interfaces. Then, we will implement some object systems according to the need of xianjingfeng and zuston.

@xianjingfeng What object system do you want to implement?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXkJC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXkaf,incubator-uniffle,1667122847,1030,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-07T03:14:22Z,2023-08-07T03:14:22Z,@jiafuzha Do you have extra input?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXkaf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ja1iJ,incubator-uniffle,1667979401,1030,NA,xianjingfeng,11752250,,,NA,2023-08-07T14:34:20Z,2023-08-07T14:34:20Z,"> @xianjingfeng What object system do you want to implement?

s3","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ja1iJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5j7rri,incubator-uniffle,1676589794,1030,NA,jiafuzha,40050405,jiafu zhang,jiafuzha@apache.org,NA,2023-08-14T02:40:36Z,2023-08-14T02:40:36Z,"> @jiafuzha Do you have extra input?

I was on vacation last week.
Do we have any interface defined for RemoteStorageManager? I am looking forward to it since our [DAOS ](https://github.com/daos-stack/daos/) is pure remote storage.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5j7rri/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rllTt,incubator-uniffle,1805014253,1030,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-10T03:21:25Z,2023-11-10T03:21:25Z,Is this on the roadmap? @jerqi @xianjingfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rllTt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zGnmi,incubator-uniffle,1931114914,1030,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-07T02:01:01Z,2024-02-07T02:01:01Z,"I'm interested on this proposal, and will implement this in rust side. @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zGnmi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1038,https://api.github.com/repos/apache/incubator-uniffle/issues/1038,incubator-uniffle,1821678085,1038,[FEATURE] Support stage recompute for Tez clients,zhengchenyu,10381583,zhengchenyu,,OPEN,2023-07-26T06:29:33Z,2023-07-27T02:44:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

For tez without remote shuffle server, when task recieve too many fetch exception from downstream task, this task will be recomputed.
With remote shuffle server, if some shuffle server is down, will loss data. Because data have been merged from many upstream task, so we must recompute upstream vertex. 

This issue is the problem 2.d which is described in #1011 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1038/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1042,https://api.github.com/repos/apache/incubator-uniffle/issues/1042,incubator-uniffle,1822068130,1042,[FEATURE] [MR] Fast fail job when too many fetch failed happen.,zhengchenyu,10381583,zhengchenyu,,OPEN,2023-07-26T10:15:37Z,2023-07-26T10:23:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In #477 and #1011, job will resubmit upstream stage/vertex when many fetch failed. It is not useful for MR, because there are only 2 stage. For MR, we should fast fail the job.
But now MR can not fast fail. When the selected shuffle server is down or stuck, MR job fail until the number of task attempts is larger than max. It is very slow.
For now, shuffle does not send fetch failed event. We should fail the job according to the number of fetch failed event.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1042/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1042,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ib8OR,incubator-uniffle,1651491729,1042,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-07-26T10:23:46Z,2023-07-26T10:23:46Z,"MR example job have 8 map and 30 reduce. Here I stuck the shuffle server. application fail very slow unit the number of task attempts exceed max.

<img width=""1897"" alt=""截屏2023-07-26 下午5 57 02"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/e31a658a-97ef-4bdb-88aa-a23cf66d87f9"">
<img width=""1726"" alt=""截屏2023-07-26 下午5 56 27"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/4e19020c-d6c5-4d90-83cc-7b6e44c467ca"">

the number of failed task is 74, most of attempts are unnecessary.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ib8OR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1043,https://api.github.com/repos/apache/incubator-uniffle/issues/1043,incubator-uniffle,1823470629,1043,[Improvement] Add NOTICE-binary,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-07-27T01:49:40Z,2023-08-07T10:42:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For binary release, we need Notice-binary.

### How should we improve?

We need a notice-binary. We can refer to https://github.com/apache/spark/blob/master/NOTICE-binary

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1043/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1044,https://api.github.com/repos/apache/incubator-uniffle/issues/1044,incubator-uniffle,1823476376,1044,[Improvement] Add LICENSE-binary,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-07-27T01:54:10Z,2023-08-14T09:26:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For binary release, we should addd LICENSE-binary.

### How should we improve?

We should add LICENSE-binary. https://github.com/apache/spark/blob/master/LICENSE-binary

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1044/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1044,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ig7jY,incubator-uniffle,1652799704,1044,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-27T01:54:32Z,2023-07-27T01:54:32Z,@LuciferYang Could you help me?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ig7jY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1044,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ihM0M,incubator-uniffle,1652870412,1044,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2023-07-27T03:53:25Z,2023-07-27T03:53:25Z,"What kind of help do you need? @jerqi 

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ihM0M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1044,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ihNRF,incubator-uniffle,1652872261,1044,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-07-27T03:56:49Z,2023-07-27T03:56:49Z,"> What kind of help do you need? @jerqi

Could you finish this issue refering to Spark's behaviour?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ihNRF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1044,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ihca4,incubator-uniffle,1652934328,1044,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2023-07-27T05:24:52Z,2023-07-27T05:24:52Z,"Ok, let me investigate first

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ihca4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1045,https://api.github.com/repos/apache/incubator-uniffle/issues/1045,incubator-uniffle,1824070844,1045,[Bug] shuffle server may hang when restart worker due to multi require-momery and no require-momery release,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-07-27T10:20:40Z,2023-08-08T06:51:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When Tez Task is doing big shuffle and restart worker, the total-require-memory metric will increase to very high then performance down。


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1045/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1048,https://api.github.com/repos/apache/incubator-uniffle/issues/1048,incubator-uniffle,1825649371,1048,[Bug] ExcludeNodes does not take effect when the coordinator restarts.,leixm,31424839,Xianming Lei,,CLOSED,2023-07-28T03:42:29Z,2023-07-28T06:05:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

There is a delay in the loading of excludeNode files. Assume that we added a batch of ShuffleServers to excludeNode, when the coordinator restarts, the ShuffleServers added to excludeNode within the period of updateNodesInterval will still be allocated.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1048/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1051,https://api.github.com/repos/apache/incubator-uniffle/issues/1051,incubator-uniffle,1825947338,1051,[Improvement] [mr] Ensure configurations in both mapred-site.xml and dynamic_client.conf take effect.,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2023-07-28T08:20:16Z,2023-08-17T11:53:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

If dynamic conf is not enabled, though `mapreduce.rss.storage.type` is configued at mapred-site.xml, running MR job within RSS still fails, with this error message `Error: java.lang.IllegalArgumentException: No enum constant org.apache.uniffle.storage.util.StorageType.`
The reason is only `rssJobConf` is used to new `CreateShuffleReadClientRequest`
https://github.com/apache/incubator-uniffle/blob/57c35ad340e376c75b17b4ca7ffbd91376f10963/client-mr/core/src/main/java/org/apache/hadoop/mapreduce/task/reduce/RssShuffle.java#L243
This issue will optimize how configuration works. Configuration in both dynamic conf and local conf file should work. 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1051/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1051,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iqjZ5,incubator-uniffle,1655322233,1051,NA,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,NA,2023-07-28T09:01:41Z,2023-07-28T09:01:41Z,"Now `mapreduce.rss.client.type` and `mapreduce.rss.remote.storage.path` must be configued at `mapred-site.xml` instead of `dynamic_client.conf`. It should also be allowd that these conf are not configued at `mapred-site.xml`.
```
Exception in thread ""main"" java.lang.IllegalArgumentException: The value of null should be one of [GRPC_NETTY, GRPC]
```
```
Exception in thread ""main"" java.lang.IllegalStateException: Can't find remoteStorage: with storageType[MEMORY_LOCALFILE_HDFS]
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5iqjZ5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1060,https://api.github.com/repos/apache/incubator-uniffle/issues/1060,incubator-uniffle,1830546198,1060,[DOCS] Add the document for Netty,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-01T06:22:02Z,2023-09-05T08:33:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

We don't have the document to tell users how to use Netty to transfer data.

### Affects Version(s)

master

### Improving the documentation

server_guide.md
client_guide.md

### Anything else

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1060/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1060,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i7B4F,incubator-uniffle,1659641349,1060,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-01T06:22:25Z,2023-08-01T06:22:25Z,@leixm Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i7B4F/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1060,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i7DIL,incubator-uniffle,1659646475,1060,NA,leixm,31424839,Xianming Lei,,NA,2023-08-01T06:25:46Z,2023-08-01T06:25:46Z,I will raise a PR later.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i7DIL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1061,https://api.github.com/repos/apache/incubator-uniffle/issues/1061,incubator-uniffle,1831139472,1061,[Bug] incubator-uniffle-website codes can not clone in windows,cdmikechen,12069428,Thinking Chen,cdmikechen@apache.org,CLOSED,2023-08-01T12:10:49Z,2023-08-01T14:40:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

It is currently not possible to clone `https://github.com/apache/incubator-uniffle-website` locally
```shell
$ git clone https://github.com/cdmikechen/incubator-uniffle-website.git
Cloning into 'incubator-uniffle-website'...
remote: Enumerating objects: 396, done.
remote: Counting objects: 100% (171/171), done.
remote: Compressing objects: 100% (106/106), done.
remote: Total 396 (delta 81), reused 128 (delta 62), pack-reused 225
Receiving objects: 100% (396/396), 2.59 MiB | 1.74 MiB/s, done.
Resolving deltas: 100% (166/166), done.
error: invalid path 'blog/2023-07-21/Uniffle: New chapter for the shuffle in the cloud native era.md'
fatal: unable to checkout working tree
warning: Clone succeeded, but checkout failed.
You can inspect what was checked out with 'git status'
and retry with 'git restore --source=HEAD :/'

```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

It seems to be caused by colon/spaces in the file path. I'm using windows.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1061/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1061,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i-Lbp,incubator-uniffle,1660466921,1061,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-01T14:40:58Z,2023-08-01T14:40:58Z,closed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5i-Lbp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1062,https://api.github.com/repos/apache/incubator-uniffle/issues/1062,incubator-uniffle,1831625510,1062,[Bug] Fix to use TezIdHelper to getTaskAttemptId instead of default IdHelper.,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-08-01T16:17:40Z,2023-08-23T06:20:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

when there is no task fail and attempt, the default IdHelper code before will work ok, but if where is task fail and attempt, it will filter  block id.

The filter code:
- ShuffleReadClientImp.java

```
    List<Long> removeBlockIds = Lists.newArrayList();
    blockIdBitmap.forEach(
        bid -> {
          if (!taskIdBitmap.contains(idHelper.getTaskAttemptId(bid))) {
            removeBlockIds.add(bid);
          }
        });

    for (long rid : removeBlockIds) {
      blockIdBitmap.removeLong(rid);
    }
```


idHelper.getTaskAttemptId(bid) will return wrong task attemt id if there is task attempt and use default idHelper.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1062/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1064,https://api.github.com/repos/apache/incubator-uniffle/issues/1064,incubator-uniffle,1832325417,1064,[Improvement] [tez] Make shuffle data send thread pool configurable in WriteBufferManager,zhuyaogai,18461102,Fantasy-Jay,,CLOSED,2023-08-02T02:36:38Z,2023-08-02T07:18:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently the number of threads in the send data thread pool in WriteBufferManager is fixed at 1, making it configurable.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1064/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1066,https://api.github.com/repos/apache/incubator-uniffle/issues/1066,incubator-uniffle,1832402243,1066,[Bug] The Jetty server fails to start when compiled with JDK 8 but runtime version is JDK 11.,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2023-08-02T04:20:22Z,2023-08-05T07:28:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

ref: https://openjdk.org/jeps/320
The reason is that java 11 removes `java.activation`

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[WARN] 2023-08-01 05:07:10,464 Jetty-8 ServletHandler doHandle - Error for /prometheus/metrics/server
java.lang.NoClassDefFoundError: javax/activation/DataSource
......
Caused by: java.langClassNotFoundException: javax.activation.DataSource
......
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1066/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1068,https://api.github.com/repos/apache/incubator-uniffle/issues/1068,incubator-uniffle,1832560699,1068,[Improvement] [tez] Fail fast in WriteBufferManager when failed to send shuffle data to shuffle server.,zhuyaogai,18461102,Fantasy-Jay,,CLOSED,2023-08-02T06:59:24Z,2023-08-05T17:16:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, it only checks for blocks that failed to send after all buffer data has been sent. This check also needs to be moved forward into the `addRecord` method, allowing it to fail fast.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1068/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1070,https://api.github.com/repos/apache/incubator-uniffle/issues/1070,incubator-uniffle,1833015771,1070,[Bug] [tez] shuffle server may leak if not register remote storage.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-08-02T11:42:04Z,2023-08-04T06:00:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In our cluster, we found require_buffer_failed increase rapidly. Then we found used_buffer_size keep very high which is greater than high watermark even though no application is running for long time.
Then we found error log as below:

```
[ERROR] 2023-08-02 12:09:00,329 ProcessEventThread DefaultFlushEventHandler processNextEvent - Exception happened when process event.
org.apache.uniffle.common.exception.RssException: Unexpected storage type!
	at org.apache.uniffle.server.DefaultFlushEventHandler.processNextEvent(DefaultFlushEventHandler.java:122)
	at org.apache.uniffle.server.DefaultFlushEventHandler.eventLoop(DefaultFlushEventHandler.java:109)
	at java.base/java.lang.Thread.run(Thread.java:829)
```

By some debug, we found when some big shuffle data occur, will fall back to hadoop storage, but here hadoop storage is null,  so many flush event fail. 
Why hadoop storage is null? because registerRemoteStorage is never called. 
Why registerRemoteStorage is never called? because the conf in TezRemoteShuffleManager is not merge the 'rss.storage.type' from dynamic configuration. And I did not set 'rss.storage.type' in client side.


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1070/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1071,https://api.github.com/repos/apache/incubator-uniffle/issues/1071,incubator-uniffle,1834189764,1071,[Bug] Incorrect capacity check in Server#LocalStorage,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-08-03T03:00:17Z,2024-01-10T16:46:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When uniffle shuffle-servers colocate with other services (like Hadoop HDFS data), they shares the same mounted disks.

If so, the current capacity checking is wrong, it only will check the uniffle's data used size instead of using the free disk size.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1071/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1071,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wXikz,incubator-uniffle,1885219123,1071,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-10T16:46:43Z,2024-01-10T16:46:43Z,"Maybe this PR could be close  occording to conversation:

https://github.com/apache/incubator-uniffle/pull/1072#issuecomment-1855541678

https://github.com/apache/incubator-uniffle/pull/1337

@jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wXikz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1073,https://api.github.com/repos/apache/incubator-uniffle/issues/1073,incubator-uniffle,1834211696,1073,[FEATURE] Enable MR RSS in one of multiple sub-clusters  under YARN Federation,Lobo2008,15674151,l.zonghai,,OPEN,2023-08-03T03:34:09Z,2023-08-07T10:17:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

There are two sub-clusters  e.g. A and B are federated by YARN Federation and only when a MR is routed to sub-cluster  B should RSS be enabled.  Thus  a new way to enable MR RSS like spark `DelegationShuffleManager` is desired, we hope this feature could be supported.


### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1073/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1073,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jIy5e,incubator-uniffle,1663250014,1073,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-03T03:48:03Z,2023-08-03T03:48:03Z,"This issue is similar to https://github.com/apache/incubator-uniffle/issues/1024
The Spark code is https://github.com/apache/incubator-uniffle/blob/master/client-spark/spark2/src/main/java/org/apache/spark/shuffle/DelegationRssShuffleManager.java
You can support this feature if you needed it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jIy5e/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1073,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jJRMS,incubator-uniffle,1663374098,1073,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-08-03T06:36:03Z,2023-08-03T06:36:03Z,"For MR, there is a difference with Spark/Tez.  AppMaster, MapTask, ReduceTask also use job.xml which is set by client. But client does not know the selected subcluster. So we need a way to inject the rss configuration to job.xml

If the sub cluster id is the condition to enable rss, the api 'accessCluster' to  coordinator is unnecessary, just do it in appmaster. Maybe DelegationRssShuffleManager should be called after this in another issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jJRMS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1073,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jZV8c,incubator-uniffle,1667587868,1073,NA,Lobo2008,15674151,l.zonghai,,NA,2023-08-07T10:17:56Z,2023-08-07T10:17:56Z,"> This issue is similar to #1024 The Spark code is https://github.com/apache/incubator-uniffle/blob/master/client-spark/spark2/src/main/java/org/apache/spark/shuffle/DelegationRssShuffleManager.java You can support this feature if you needed it.

Thanks, I'm working on it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jZV8c/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1074,https://api.github.com/repos/apache/incubator-uniffle/issues/1074,incubator-uniffle,1834576722,1074,[FEATURE] Introduce the metric of `local_storage_uniffle_used_space`,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-08-03T08:44:44Z,2023-08-07T06:12:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the `local_storage_used_space` will show the disks used total size. But if it is in the colocation with Yarn Nodemanager, this is not enough.

So this issue is to introduce the metric of `local_storage_uniffle_used_space` to show the uniffle used space.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1074/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1077,https://api.github.com/repos/apache/incubator-uniffle/issues/1077,incubator-uniffle,1834785861,1077,[FEATURE] add jdk profile,xumanbu,9135743,xumanbu,manbu.feng@163.com,OPEN,2023-08-03T10:30:47Z,2023-08-04T02:37:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In our production environment, the server uses JDK17, Spark Client use JDK8. To avoid maintaining two different branches code, I suggest JDK version should configurable in build.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1077/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1077,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jPDpI,incubator-uniffle,1664891464,1077,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-04T02:37:39Z,2023-08-04T02:37:39Z,Make sense.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jPDpI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1079,https://api.github.com/repos/apache/incubator-uniffle/issues/1079,incubator-uniffle,1835973532,1079,[FEATURE] Assignment strategies under different memory capacity configurations,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-08-04T02:37:17Z,2023-08-04T02:37:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

If using the different memory capacity in one uniffle cluster and the underlying disk capacity is same, it will make the large memory capacity machine disk usage relatively high. Sometimes this will make local disk full and fallback to HDFS (it's really slow)

Anyway, I know if the HDFS is slow and local disk is full, this will reflect to the server memory of large memory machine. But this will also make some apps slow and the little memory machines are free when this happened.

I hope the better assignment strategies could be introduced for this problem. And I'm bothered by this. Feel free to describe more for this. 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1079/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1079,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jPDsp,incubator-uniffle,1664891689,1079,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-04T02:37:58Z,2023-08-04T02:37:58Z,cc @xumanbu @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jPDsp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1081,https://api.github.com/repos/apache/incubator-uniffle/issues/1081,incubator-uniffle,1836373760,1081,[Bug] [tez] shuffle can not read the data which have flush to hdfs.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-08-04T09:13:32Z,2023-08-09T10:58:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

big shuffle data will flush to hdfs. But shuffle can no read these data. The reason is that baseDir is missing.

```
org.apache.uniffle.common.exception.RssFetchFailedException: Failed to read shuffle data from WARM handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:124)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:134)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:348)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:267)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssTezShuffleDataFetcher.copyFromRssServer(RssTezShuffleDataFetcher.java:144)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssTezShuffleDataFetcher.fetchAllRssBlocks(RssTezShuffleDataFetcher.java:129)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssTezShuffleDataFetcher.callInternal(RssTezShuffleDataFetcher.java:108)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssTezShuffleDataFetcher.callInternal(RssTezShuffleDataFetcher.java:38)
	at org.apache.tez.common.CallableWithNdc.call(CallableWithNdc.java:36)
	at org.apache.uniffle.com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131)
	at org.apache.uniffle.com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74)
	at org.apache.uniffle.com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.uniffle.common.exception.RssException: Can't get FileSystem for null/appattempt_1691045129773_0174_000001/1000001/5-5
	at org.apache.uniffle.storage.handler.impl.HadoopClientReadHandler.init(HadoopClientReadHandler.java:129)
	at org.apache.uniffle.storage.handler.impl.HadoopClientReadHandler.readShuffleData(HadoopClientReadHandler.java:199)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113)
	... 14 more
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1081/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1083,https://api.github.com/repos/apache/incubator-uniffle/issues/1083,incubator-uniffle,1837514353,1083,[FEATURE]  Support Spark 3.5,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T01:48:09Z,2023-10-08T06:56:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Spark 3.5 is releasing. We should support the version.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1083/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1083,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUmXb,incubator-uniffle,1666344411,1083,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T01:48:40Z,2023-08-05T01:48:40Z,@LuciferYang @summaryzb Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUmXb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1083,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr94,incubator-uniffle,1666367352,1083,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-08-05T03:09:16Z,2023-08-05T03:09:16Z,volunteering,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr94/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1083,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jejA1,incubator-uniffle,1668952117,1083,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-08-08T05:55:06Z,2023-08-08T05:55:06Z,"Once spark3.5 release, i'll move on","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jejA1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1083,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mYVDX,incubator-uniffle,1717653719,1083,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2023-09-13T13:37:39Z,2023-09-13T13:37:39Z,"@summaryzb Apache Spark 3.5.0 has been released to the Maven Central Repository.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mYVDX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1084,https://api.github.com/repos/apache/incubator-uniffle/issues/1084,incubator-uniffle,1837515418,1084,[FEATURE] Support dynamic allocation for Spark 3.3,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T01:52:11Z,2023-10-07T03:37:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We can refer to https://github.com/apache/incubator-uniffle/blob/master/patch/spark/spark-3.2.1_dynamic_allocation_support.patch
We should add the patch for Spark 3.3. You can use the ut of Spark to verify the effect of this patch.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1084/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1084,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUmz5,incubator-uniffle,1666346233,1084,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T01:52:46Z,2023-08-05T01:52:46Z,@LuciferYang @summaryzb Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUmz5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1084,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr-2,incubator-uniffle,1666367414,1084,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-08-05T03:09:41Z,2023-08-05T03:09:41Z,please assign this to me,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr-2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1085,https://api.github.com/repos/apache/incubator-uniffle/issues/1085,incubator-uniffle,1837516381,1085,[FEATURE] Support dynamic allocation for Spark 3.4,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T01:54:03Z,2023-10-08T06:56:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We can refer to https://github.com/apache/incubator-uniffle/blob/master/patch/spark/spark-3.2.1_dynamic_allocation_support.patch
We should add the patch for Spark 3.4. You can use the ut of Spark to verify the effect of this patch.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1085/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1085,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUm8Q,incubator-uniffle,1666346768,1085,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T01:54:27Z,2023-08-05T01:54:27Z,@LuciferYang @summaryzb Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUm8Q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1085,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr8S,incubator-uniffle,1666367250,1085,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-08-05T03:08:35Z,2023-08-05T03:08:35Z,"volunteering, please assign this to me","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr8S/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1086,https://api.github.com/repos/apache/incubator-uniffle/issues/1086,incubator-uniffle,1837516799,1086,[DOCS] Add the document of Gluten,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-08-05T01:55:46Z,2023-08-05T03:38:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

We don't have any gluten document. We should add them.

### Affects Version(s)

master

### Improving the documentation

The document of Gluten.

### Anything else

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1086/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1086,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUnCa,incubator-uniffle,1666347162,1086,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T01:56:08Z,2023-08-05T01:56:08Z,@LuciferYang @summaryzb Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUnCa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1086,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr5X,incubator-uniffle,1666367063,1086,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-08-05T03:07:44Z,2023-08-05T03:07:44Z,"volunteering, since I contributed the integration of gluten with uniffle before","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr5X/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1087,https://api.github.com/repos/apache/incubator-uniffle/issues/1087,incubator-uniffle,1837517812,1087,[FEATURE] Support dynamic allocation for Gluten Uniffle,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T01:58:43Z,2024-04-16T11:03:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

As the comment https://github.com/oap-project/gluten/pull/1966#discussion_r1230611154
We should support dynamic allocation for Gluten.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1087/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1087,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUnUr,incubator-uniffle,1666348331,1087,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T01:59:08Z,2023-08-05T01:59:08Z,@summaryzb @LuciferYang Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUnUr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1087,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr0h,incubator-uniffle,1666366753,1087,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-08-05T03:06:14Z,2023-08-05T03:06:14Z,volunteering,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUr0h/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1088,https://api.github.com/repos/apache/incubator-uniffle/issues/1088,incubator-uniffle,1837554809,1088,[FEATURE] Support dynamic allocation for Spark 3.0,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T03:43:57Z,2023-10-16T07:15:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature


We can refer to https://github.com/apache/incubator-uniffle/blob/master/patch/spark/spark-3.2.1_dynamic_allocation_support.patch
We should add the patch for Spark 3.0. You can use the ut of Spark to verify the effect of this patch.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1088/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1088,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUt_N,incubator-uniffle,1666375629,1088,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T03:45:27Z,2023-08-05T03:45:27Z,@LuciferYang @summaryzb Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUt_N/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1089,https://api.github.com/repos/apache/incubator-uniffle/issues/1089,incubator-uniffle,1837554962,1089,[FEATURE] Support dynamic allocation for Spark 2.3,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T03:44:41Z,2023-10-17T02:13:55Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature


We can refer to https://github.com/apache/incubator-uniffle/blob/master/patch/spark/spark-3.2.1_dynamic_allocation_support.patch
We should add the patch for Spark 2.3. You can use the ut of Spark to verify the effect of this patch.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1089/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1089,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUt94,incubator-uniffle,1666375544,1089,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T03:45:00Z,2023-08-05T03:45:00Z,@LuciferYang @summaryzb Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUt94/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1090,https://api.github.com/repos/apache/incubator-uniffle/issues/1090,incubator-uniffle,1837562990,1090,[Improvement] Refactor the reader code with builder pattern,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T04:14:54Z,2023-10-16T01:55:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

`ShuffleReadClientImpl` has too many construct parameters and some parameters should have default value.  We usually add extra parameter for them. It will be easier to maintain if we use builder pattern to refactor.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1090/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1090,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUvd7,incubator-uniffle,1666381691,1090,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T04:15:17Z,2023-08-05T04:15:17Z,@LuciferYang @summaryzb Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUvd7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1091,https://api.github.com/repos/apache/incubator-uniffle/issues/1091,incubator-uniffle,1837563410,1091,[Improvement] Refactor the writer code with builder pattern ,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T04:16:40Z,2023-10-10T01:52:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

`ShuffleWriteClientImpl` has too many construct parameters and some parameters should have default value.  We usually add extra parameter for them. It will be easier to maintain if we use builder pattern to refactor.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1091/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1091,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUviJ,incubator-uniffle,1666381961,1091,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T04:16:57Z,2023-08-05T04:16:57Z,@LuciferYang @summaryzb Could you help me with this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jUviJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1092,https://api.github.com/repos/apache/incubator-uniffle/issues/1092,incubator-uniffle,1837572213,1092,[Umbrella]  Good First Issues,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-08-05T04:43:09Z,2024-01-12T05:47:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

These issues are a great way to get started with a project. Any contribution is important for the Uniffle Commuinity. If the issues have been assigned to others, but there isn't any progress for more than 3 months. You can ask committers or collaborators to assign it to you, too. 
The steps of contribution is as below: https://github.com/apache/incubator-uniffle/blob/master/CONTRIBUTING.md

### Task list

Code Style Improvements
If you don't read the code of Uniffle but you have some experience about Java. These issues are suitable for you.
- [x] https://github.com/apache/incubator-uniffle/issues/851
- [x] https://github.com/apache/incubator-uniffle/issues/363
- [x] https://github.com/apache/incubator-uniffle/issues/532



Simple Tasks
If you don't realize the code of Uniffle and want to realize this project by some tasks. These issues are suitable for you.
- [ ] https://github.com/apache/incubator-uniffle/issues/1020
- [x] https://github.com/apache/incubator-uniffle/issues/974
- [x] https://github.com/apache/incubator-uniffle/issues/460
- [x] https://github.com/apache/incubator-uniffle/issues/333
- [ ] https://github.com/apache/incubator-uniffle/issues/138
- [ ] https://github.com/apache/incubator-uniffle/issues/313
- [x] https://github.com/apache/incubator-uniffle/issues/1119
- [x] https://github.com/apache/incubator-uniffle/issues/1108
- [x] https://github.com/apache/incubator-uniffle/issues/1157

CI Improvement
If you're not familiar about Uniffle but have some experience about Github Actions. These issues are suitable for you.
- [ ] https://github.com/apache/incubator-uniffle/issues/1096

Documents
If you don't have much experience about Java and Uniffle but want to contribute to this project. You can try to improve the documents of this project.
- [x] https://github.com/apache/incubator-uniffle/issues/1094

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1092/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1094,https://api.github.com/repos/apache/incubator-uniffle/issues/1094,incubator-uniffle,1837582915,1094,[DOCS] Split the client.md into four documents,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T05:18:36Z,2023-11-06T12:28:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

The `docs/client.md` have common client's, Spark's, MapReduce's and Tez's configurations. We should split it into four documents.

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1094/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1094,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVAJU,incubator-uniffle,1666450004,1094,NA,ASDasd341,94269643,abhi,,NA,2023-08-05T09:15:12Z,2023-08-05T09:15:12Z,Let me help in this.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVAJU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1094,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVAS2,incubator-uniffle,1666450614,1094,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T09:17:44Z,2023-08-05T09:17:44Z,Thanks.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVAS2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1094,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5q2aVZ,incubator-uniffle,1792648537,1094,NA,zivali,29471273,Ziva Li,,NA,2023-11-03T15:27:16Z,2023-11-03T15:27:16Z,"Hi @jerqi, may I try this one? 
Will try to preserve only [shared configuration](https://github.com/apache/incubator-uniffle/blob/master/docs/client_guide.md#common-setting) in [client_guide.md](https://github.com/apache/incubator-uniffle/blob/master/docs/client_guide.md#deploy-tez-client-plugin) and open three other subpages:
- Deploy Spark Client Plugin & Configurations
- Deploy MapReduce Client Plugin & Configurations
- Deploy Tez Client Plugin & Configurations
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5q2aVZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1094,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5q3Xfx,incubator-uniffle,1792899057,1094,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-11-03T18:02:02Z,2023-11-03T18:02:02Z,"> Hi @jerqi, may I try this one? Will try to preserve only [shared configuration](https://github.com/apache/incubator-uniffle/blob/master/docs/client_guide.md#common-setting) in [client_guide.md](https://github.com/apache/incubator-uniffle/blob/master/docs/client_guide.md#deploy-tez-client-plugin) and open three other subpages:
> 
> * Deploy Spark Client Plugin & Configurations
> * Deploy MapReduce Client Plugin & Configurations
> * Deploy Tez Client Plugin & Configurations

OK.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5q3Xfx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1095,https://api.github.com/repos/apache/incubator-uniffle/issues/1095,incubator-uniffle,1837591886,1095,[DOCS]  Add slack link to the `readme.md`,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-05T05:50:27Z,2023-08-06T00:00:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

Our slack link is https://join.slack.com/t/the-asf/shared_invite/zt-1fm9561yr-uzTpjqg3jf5nxSJV5AE3KQ
We can refer to https://github.com/apache/iceberg/blob/4f401a7779a56c25e9371cc3a95a13a51012cd6c/README.md?plain=1#L24

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1095/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1095,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVAGa,incubator-uniffle,1666449818,1095,NA,ASDasd341,94269643,abhi,,NA,2023-08-05T09:14:35Z,2023-08-05T09:14:35Z,i can do that.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVAGa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1095,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVATl,incubator-uniffle,1666450661,1095,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T09:17:59Z,2023-08-05T09:17:59Z,Thanks.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVATl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1096,https://api.github.com/repos/apache/incubator-uniffle/issues/1096,incubator-uniffle,1837593826,1096,[Improvement] Add kubernetes Integration test CI,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-08-05T05:56:55Z,2023-08-07T11:21:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We already have k8s e2e tests. But we should  add the e2e tests to our CI pipeline.
https://github.com/apache/incubator-uniffle/blob/master/deploy/kubernetes/integration-test/e2e/start-e2e.sh

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1096/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1096,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXxZV,incubator-uniffle,1667176021,1096,NA,krishnaduttPanchagnula,84926220,Krishna Dutt Panchagnula,krishnadutt123@gmail.com,NA,2023-08-07T04:43:47Z,2023-08-07T04:43:47Z,/assign,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXxZV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1096,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jZqQL,incubator-uniffle,1667671051,1096,NA,krishnaduttPanchagnula,84926220,Krishna Dutt Panchagnula,krishnadutt123@gmail.com,NA,2023-08-07T11:19:38Z,2023-08-07T11:19:38Z,@jerqi do we want to fail the pipeline if the e2e tests fail ?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jZqQL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1096,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jZq03,incubator-uniffle,1667673399,1096,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-07T11:21:25Z,2023-08-07T11:21:25Z,"> @jerqi do we want to fail the pipeline if the e2e tests fail ?

Yes. we want.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jZq03/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1098,https://api.github.com/repos/apache/incubator-uniffle/issues/1098,incubator-uniffle,1837783069,1098,[Flaky Test]  RssShuffleTest.testSchedulerTerminatesOnException:93 expected: <false> but was: <true>,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-08-05T14:18:21Z,2023-08-31T10:54:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

 RssShuffleTest.testSchedulerTerminatesOnException:93 expected: <false> but was: <true>

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/5771062012

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1098/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1098,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVQ42,incubator-uniffle,1666518582,1098,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-05T14:18:49Z,2023-08-05T14:18:49Z,@bin41215 @baitian77 @lifeSo Could you help me with this flaky test?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jVQ42/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1098,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lYGr3,incubator-uniffle,1700817655,1098,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-08-31T10:54:28Z,2023-08-31T10:54:28Z,"> @bin41215 @baitian77 @lifeSo Could you help me with this flaky test?

ok, let me see","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lYGr3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1100,https://api.github.com/repos/apache/incubator-uniffle/issues/1100,incubator-uniffle,1837995709,1100,[Improvement] [MR] Fail fast in WriteBufferManager when failed to send shuffle data to shuffle server.,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-06T01:00:06Z,2023-08-06T16:15:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, it only checks for blocks that failed to send after all buffer data has been sent. This check also needs to be moved forward into the `addRecord` method, allowing it to fail fast. The code of Tez and MapReduce is same. You can refer to https://github.com/apache/incubator-uniffle/pull/1069

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1100/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1101,https://api.github.com/repos/apache/incubator-uniffle/issues/1101,incubator-uniffle,1838193593,1101,[Improvement] [tez] Release server resources as soon as possible in RssDAGAppMaster.,zhuyaogai,18461102,Fantasy-Jay,,CLOSED,2023-08-06T12:38:39Z,2023-08-07T10:41:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Only when the JVM is about to exit, the server resources will be released. In some scenarios, it will occupy server resources for a long time. For example, when enable history logging service and timeline service.

### How should we improve?

Release server resources as soon as possible in RssDAGAppMaster.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1101/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1105,https://api.github.com/repos/apache/incubator-uniffle/issues/1105,incubator-uniffle,1838610972,1105,[Bug] The block that the Task fails to send needs to be cleared,yl09099,33595968,,,OPEN,2023-08-07T03:32:20Z,2023-08-07T03:40:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When a Task sends a Block to the ShuffleServer, it is placed in the DataPusher asynchronous thread to send it, but if the Task fails before the block is finished sending, the block to be sent is not cleaned.

### Affects Version(s)

0.8.0

### Uniffle Server Log Output

```logtalk
2023-08-07 10:41:16,838 INFO  [Executor task launch worker for task 0.0 in stage 2.0 (TID 10)] writer.RssShuffleWriter (RssShuffleWriter.java:checkBlockSendResult(273)) - Wait 327 blocks sent to shuffle server
2023-08-07 10:41:16,838 INFO  [Executor task launch worker for task 1.0 in stage 2.0 (TID 11)] writer.RssShuffleWriter (RssShuffleWriter.java:checkBlockSendResult(273)) - Wait 350 blocks sent to shuffle server
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1105/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1105,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXnP0,incubator-uniffle,1667134452,1105,NA,yl09099,33595968,,,NA,2023-08-07T03:34:13Z,2023-08-07T03:34:13Z,@jerqi @zuston @advancedxy Take a hard look at this problem. Are there any good solutions.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXnP0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1105,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXoID,incubator-uniffle,1667138051,1105,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-07T03:40:32Z,2023-08-07T03:40:32Z,Maybe we should add FailureCallback to clean the blocks. You can see https://github.com/apache/incubator-uniffle/blob/dbb9890a20da8d013abc0b333d8e0ccbeac10c75/client-spark/spark2/src/main/java/org/apache/spark/shuffle/reader/RssShuffleReader.java#L144,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jXoID/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1108,https://api.github.com/repos/apache/incubator-uniffle/issues/1108,incubator-uniffle,1838804143,1108,[FEATURE] Add labels with disk path for local storage `total_localfile_write_data` metrics,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-08-07T06:54:17Z,2023-08-21T08:51:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the metric of `total_localfile_write_data` only shows the all disks data written. It's better to expose the every disk's uniffle data written size.

We could put the disk path as the label of `total_localfile_write_data` metrics

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1108/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5j6PuK,incubator-uniffle,1676213130,1108,NA,zhuyaogai,18461102,Fantasy-Jay,,NA,2023-08-13T03:55:53Z,2023-08-13T03:55:53Z,@zuston Could you assign this issue to me? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5j6PuK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1108,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5j7zua,incubator-uniffle,1676622746,1108,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-14T03:37:38Z,2023-08-14T03:37:38Z,"> @zuston Could you assign this issue to me?

Thanks. Pls go ahead ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5j7zua/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1109,https://api.github.com/repos/apache/incubator-uniffle/issues/1109,incubator-uniffle,1838916538,1109,[Bug] [tez] Fix the user of remote storage. ,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-08-07T08:06:43Z,2023-08-10T05:30:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When we use remote storage, we will flush data to hdfs, but the user of the storage is appid. See the storage:

```
[yarn@host dir]$ hdfs dfs -ls /uniffle-rss
Found 1 items
drwxrwx--x   - application_1691045129773_0174 yarn          0 2023-08-04 16:52 /uniffle-rss/appattempt_1691045129773_0174_000001
```

It seems reasonable that regard applicationid as user, because it is more safe. But we know the max number of hadoop user is 16777215, it is limited. Even though the related remote storage directory is deleted, this user string won't be delete from SerialNumberMap util restart namenode.


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1109/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1110,https://api.github.com/repos/apache/incubator-uniffle/issues/1110,incubator-uniffle,1838938042,1110,[Improvement] the value of remote storage conf should support comma.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-08-07T08:19:57Z,2023-11-30T04:14:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When parse the remoteStorageConf, we use ',' as separator to parse the config. It means the value of config should not contain ','.
But it is common that the value of config contain ','. For examples, in federated hdfs, below config is common.
```
dfs.ha.namenodes.ns-fed=nn1,nn2
```


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1110/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1110,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5suPM4,incubator-uniffle,1824060216,1110,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-23T09:29:47Z,2023-11-23T09:29:47Z,"If you dont mind, I think I will pick up this. @zhengchenyu ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5suPM4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1110,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tJSo5,incubator-uniffle,1831152185,1110,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-11-29T03:23:14Z,2023-11-29T03:23:14Z,"> If you dont mind, I think I will pick up this. @zhengchenyu

You are free to take over this PR. I'm really confused about how to implement it. I will close the original PR.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tJSo5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1110,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tJVXo,incubator-uniffle,1831163368,1110,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-29T03:35:34Z,2023-11-29T03:35:34Z,"> > If you dont mind, I think I will pick up this. @zhengchenyu
> 
> You are free to take over this PR. I'm really confused about how to implement it. I will close the original PR.

#1110 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tJVXo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1111,https://api.github.com/repos/apache/incubator-uniffle/issues/1111,incubator-uniffle,1838943437,1111,[Bug] Shuffle server can not delete remote storage path in security cluster.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-08-07T08:23:23Z,2023-08-11T02:09:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In security cluster, shuffle server delete remote storage path failed, the logs:

```
[WARN] 2023-08-04 15:38:28,840 clearResourceThread HadoopShuffleDeleteHandler delete - Can't delete shuffle data for appId[appattempt_1691129746305_0051_000001] with 4 times
java.lang.Exception: User must be not null or empty
	at org.apache.uniffle.common.security.HadoopSecurityContext.runSecured(HadoopSecurityContext.java:99)
	at org.apache.uniffle.common.filesystem.HadoopFilesystemProvider.getFilesystem(HadoopFilesystemProvider.java:57)
	at org.apache.uniffle.storage.handler.impl.HadoopShuffleDeleteHandler.delete(HadoopShuffleDeleteHandler.java:54)
	at org.apache.uniffle.server.storage.HadoopStorageManager.removeResources(HadoopStorageManager.java:113)
	at org.apache.uniffle.server.storage.MultiStorageManager.removeResources(MultiStorageManager.java:175)
	at org.apache.uniffle.server.ShuffleTaskManager.removeResources(ShuffleTaskManager.java:663)
	at org.apache.uniffle.server.ShuffleTaskManager.lambda$new$0(ShuffleTaskManager.java:162)
	at java.lang.Thread.run(Thread.java:748)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1111/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1114,https://api.github.com/repos/apache/incubator-uniffle/issues/1114,incubator-uniffle,1840415009,1114,[FEATURE] Add labels with hdfs host for local storage total_hadoop_write_data metrics,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-08-08T01:23:56Z,2023-08-10T12:53:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We will write apps of different businesses apps into different HDFS.
For further iterative optimization, we need to expose the write capacity of
different HDFS to evaluate the total write capacity of different business lines.



### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1114/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1114,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5junn5,incubator-uniffle,1673165305,1114,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-10T12:53:43Z,2023-08-10T12:53:43Z,#1107 done,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5junn5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1115,https://api.github.com/repos/apache/incubator-uniffle/issues/1115,incubator-uniffle,1840463899,1115,[Improvement] Unregister shuffle explicitly when application is stopped.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-08-08T02:35:47Z,2023-08-11T07:29:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For MR/Tez, as applications is stopped, we should unregister shuffle explicitly. There are no need to wait timeout.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1115/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1119,https://api.github.com/repos/apache/incubator-uniffle/issues/1119,incubator-uniffle,1840693439,1119,[Improvement] Explicitly throw `BUFFER_LIMIT_OF_HUGE_PARTITION` instead of `NO_BUFFER`,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-08-08T07:04:55Z,2024-01-08T03:37:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In current codebase, once the huge partition is limited of fixed memory, the NO_BUFFER code will be returned. It's better to throw explicit huge partition limit code and log this in client side. 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1119/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5je4-g,incubator-uniffle,1669042080,1119,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-08T07:17:42Z,2023-08-08T07:17:42Z,BTW. the code of https://github.com/apache/incubator-uniffle/blob/ca245316c3f5002de117adb7f550d3198fb7f6e2/server/src/main/java/org/apache/uniffle/server/ShuffleTaskManager.java#L410-L440 looks strange. It's better to throw `NoBufferException` or `NoRegisterException`  instead of using the negative number to indicate the error.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5je4-g/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jxHeK,incubator-uniffle,1673820042,1119,NA,SunMoon97,118104021,Sanskar Mundhra,,NA,2023-08-10T19:52:00Z,2023-08-10T19:52:00Z,"@jerqi can you assign me this issue?
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jxHeK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1124,https://api.github.com/repos/apache/incubator-uniffle/issues/1124,incubator-uniffle,1842395213,1124,[DOCS] Add the document for tez-client,bin41215,74609438,,,CLOSED,2023-08-09T03:28:09Z,2023-08-09T11:59:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

_No response_

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1124/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,incubator-uniffle,1844313623,1127,[Bug] IllegalReferenceCountException: refCnt: 0 in netty encode message,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-08-10T02:38:49Z,2023-08-16T10:45:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```
23/08/09 18:22:47 ERROR util.ByteBufUtils: Failed to copy. size: 120228
23/08/09 18:22:47 ERROR netty.MessageEncoder: Unexpected exception during process encode!
org.apache.uniffle.common.exception.RssException: org.apache.uniffle.io.netty.util.IllegalReferenceCountException: refCnt: 0
    at org.apache.uniffle.common.util.ByteBufUtils.copyByteBuf(ByteBufUtils.java:72)
    at org.apache.uniffle.common.ShuffleBlockInfo.copyDataTo(ShuffleBlockInfo.java:157)
    at org.apache.uniffle.common.netty.protocol.Encoders.encodeShuffleBlockInfo(Encoders.java:46)
    at org.apache.uniffle.common.netty.protocol.SendShuffleDataRequest.encodePartitionData(SendShuffleDataRequest.java:116)
    at org.apache.uniffle.common.netty.protocol.SendShuffleDataRequest.encode(SendShuffleDataRequest.java:80)
    at org.apache.uniffle.common.netty.MessageEncoder.write(MessageEncoder.java:54)
    at org.apache.uniffle.io.netty.channel.AbstractChannelHandlerContext.invokeWrite0(AbstractChannelHandlerContext.java:717)
    at org.apache.uniffle.io.netty.channel.AbstractChannelHandlerContext.invokeWrite(AbstractChannelHandlerContext.java:709)
    at org.apache.uniffle.io.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:792)
    at org.apache.uniffle.io.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:702)
    at org.apache.uniffle.io.netty.handler.timeout.IdleStateHandler.write(IdleStateHandler.java:302)
    at org.apache.uniffle.io.netty.channel.AbstractChannelHandlerContext.invokeWrite0(AbstractChannelHandlerContext.java:717)
    at org.apache.uniffle.io.netty.channel.AbstractChannelHandlerContext.invokeWriteAndFlush(AbstractChannelHandlerContext.java:764)
    at org.apache.uniffle.io.netty.channel.AbstractChannelHandlerContext$WriteTask.run(AbstractChannelHandlerContext.java:1071)
    at org.apache.uniffle.io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)
    at org.apache.uniffle.io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:469)
    at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:500)
    at org.apache.uniffle.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
    at org.apache.uniffle.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
    at org.apache.uniffle.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
    at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.uniffle.io.netty.util.IllegalReferenceCountException: refCnt: 0
    at org.apache.uniffle.io.netty.buffer.AbstractByteBuf.ensureAccessible(AbstractByteBuf.java:1454)
    at org.apache.uniffle.io.netty.buffer.UnpooledHeapByteBuf.array(UnpooledHeapByteBuf.java:147)
    at org.apache.uniffle.io.netty.buffer.UnsafeByteBufUtil.setBytes(UnsafeByteBufUtil.java:526)
    at org.apache.uniffle.io.netty.buffer.PooledUnsafeDirectByteBuf.setBytes(PooledUnsafeDirectByteBuf.java:193)
    at org.apache.uniffle.io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1104)
    at org.apache.uniffle.io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1096)
    at org.apache.uniffle.io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1087)
    at org.apache.uniffle.common.util.ByteBufUtils.copyByteBuf(ByteBufUtils.java:68)
    ... 20 more
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1127/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jr8ev,incubator-uniffle,1672464303,1127,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-10T02:39:05Z,2023-08-10T02:39:05Z,cc @leixm @xumanbu ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jr8ev/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsHO2,incubator-uniffle,1672508342,1127,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-10T03:46:09Z,2023-08-10T03:46:09Z,The `ShuffleBlockInfo` 's copyDataTo will be invoked multiple times. But I think  the data in this will be released? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsHO2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsIK0,incubator-uniffle,1672512180,1127,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-10T03:52:31Z,2023-08-10T03:52:31Z,"> The `ShuffleBlockInfo` 's copyDataTo will be invoked multiple times. But I think the data in this will be released?

The memory won't be released in some cases if the memory isn't allowed to release by users.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsIK0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsIzl,incubator-uniffle,1672514789,1127,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-10T03:56:14Z,2023-08-10T03:56:14Z,"```
public class UnpooledDirectByteBuf extends AbstractReferenceCountedByteBuf {
  private final ByteBufAllocator alloc;
  ByteBuffer buffer;
  private ByteBuffer tmpNioBuf;
  private int capacity;
  private boolean doNotFree
```
The variable `doNotFree` matters.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsIzl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsJVm,incubator-uniffle,1672516966,1127,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-10T03:59:42Z,2023-08-10T03:59:42Z,I didn't find we set this variable. And the concrete byte buf is `UnpooledHeapByteBuf ` instead of `UnpooledDirectByteBuf`,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsJVm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsJlI,incubator-uniffle,1672517960,1127,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-10T04:01:15Z,2023-08-10T04:01:15Z,"> I didn't find we set this variable. And the concrete byte buf is `UnpooledHeapByteBuf ` instead of `UnpooledDirectByteBuf`

If we use HeapByteBuf, we don't enable off heap memory.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsJlI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsKg0,incubator-uniffle,1672521780,1127,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-10T04:06:00Z,2023-08-10T04:06:00Z,"> UnsafeByteBufUtil

Oh, it's just tmp data.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsKg0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsZAy,incubator-uniffle,1672581170,1127,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-10T05:33:29Z,2023-08-10T05:33:29Z,What do you mean? Sorry I'm not familiar with netty.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jsZAy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jt_Qh,incubator-uniffle,1672999969,1127,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-10T10:54:41Z,2023-08-10T10:54:41Z,"> What do you mean? Sorry I'm not familiar with netty.

My mistake, igore it. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jt_Qh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kDV_C,incubator-uniffle,1678598082,1127,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-15T08:38:24Z,2023-08-15T08:38:24Z,Could you help check this failure? @leixm ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kDV_C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1127,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kGT2_,incubator-uniffle,1679375807,1127,NA,leixm,31424839,Xianming Lei,,NA,2023-08-15T18:07:57Z,2023-08-15T18:07:57Z,"Sure, i will check this failure.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kGT2_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1130,https://api.github.com/repos/apache/incubator-uniffle/issues/1130,incubator-uniffle,1844885998,1130,[Bug] Jetty ServletContainer initialize failed in jdk17 ,xumanbu,9135743,xumanbu,manbu.feng@163.com,OPEN,2023-08-10T10:18:35Z,2023-08-10T10:24:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When the server starts on jdk17, the call metrics URL encounters the same error.
```
[WARN] 2023-08-10 17:50:13,116 Jetty-8 ServletHandler doHandle - Error for /metrics/jvm
java.lang.ExceptionInInitializerError
        at com.sun.xml.bind.v2.runtime.reflect.opt.AccessorInjector.prepare(AccessorInjector.java:83)
        at com.sun.xml.bind.v2.runtime.reflect.opt.OptimizedAccessorFactory.get(OptimizedAccessorFactory.java:176)
        at com.sun.xml.bind.v2.runtime.reflect.Accessor$FieldReflection.optimize(Accessor.java:282)
        at com.sun.xml.bind.v2.runtime.property.ArrayProperty.<init>(ArrayProperty.java:69)
        at com.sun.xml.bind.v2.runtime.property.ArrayERProperty.<init>(ArrayERProperty.java:88)
        at com.sun.xml.bind.v2.runtime.property.ArrayElementProperty.<init>(ArrayElementProperty.java:100)
        at com.sun.xml.bind.v2.runtime.property.ArrayElementNodeProperty.<init>(ArrayElementNodeProperty.java:62)
        at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
        at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)
        at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)
        at com.sun.xml.bind.v2.runtime.property.PropertyFactory.create(PropertyFactory.java:128)
        at com.sun.xml.bind.v2.runtime.ClassBeanInfoImpl.<init>(ClassBeanInfoImpl.java:183)
        at com.sun.xml.bind.v2.runtime.JAXBContextImpl.getOrCreate(JAXBContextImpl.java:532)
        at com.sun.xml.bind.v2.runtime.JAXBContextImpl.<init>(JAXBContextImpl.java:347)
        at com.sun.xml.bind.v2.runtime.JAXBContextImpl$JAXBContextBuilder.build(JAXBContextImpl.java:1170)
        at com.sun.xml.bind.v2.ContextFactory.createContext(ContextFactory.java:145)
        at com.sun.xml.bind.v2.ContextFactory.createContext(ContextFactory.java:236)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:217)
        at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:175)
        at javax.xml.bind.ContextFinder.find(ContextFinder.java:353)
        at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:508)
        at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:465)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.server.wadl.internal.WadlApplicationContextImpl.getJAXBContextFromWadlGenerator(WadlApplicationContextImpl.java:121)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.server.wadl.internal.WadlApplicationContextImpl.isJaxbImplAvailable(WadlApplicationContextImpl.java:270)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.server.wadl.WadlFeature.configure(WadlFeature.java:65)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.model.internal.CommonConfig.configureFeatures(CommonConfig.java:728)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.model.internal.CommonConfig.configureMetaProviders(CommonConfig.java:647)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.server.ResourceConfig.configureMetaProviders(ResourceConfig.java:824)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.server.ApplicationHandler.initialize(ApplicationHandler.java:332)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.server.ApplicationHandler.lambda$initialize$1(ApplicationHandler.java:297)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.internal.Errors.process(Errors.java:292)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.internal.Errors.process(Errors.java:274)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.internal.Errors.processWithException(Errors.java:232)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.server.ApplicationHandler.initialize(ApplicationHandler.java:296)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.server.ApplicationHandler.<init>(ApplicationHandler.java:261)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.servlet.WebComponent.<init>(WebComponent.java:311)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.servlet.ServletContainer.init(ServletContainer.java:154)
        at org.apache.hbase.thirdparty.org.glassfish.jersey.servlet.ServletContainer.init(ServletContainer.java:339)
        at javax.servlet.GenericServlet.init(GenericServlet.java:244)
        at org.eclipse.jetty.servlet.ServletHolder.initServlet(ServletHolder.java:643)
        at org.eclipse.jetty.servlet.ServletHolder.getServlet(ServletHolder.java:499)
        at org.eclipse.jetty.servlet.ServletHolder.ensureInstance(ServletHolder.java:791)
        at org.eclipse.jetty.servlet.ServletHolder.prepare(ServletHolder.java:776)
        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:579)
        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)
        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)
        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)
        at org.eclipse.jetty.server.Server.handle(Server.java:539)
        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:333)
        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)
        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:283)
        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:108)
        at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)
        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)
        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)
        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: java.lang.reflect.InaccessibleObjectException: Unable to make protected final java.lang.Class java.lang.ClassLoader.defineClass(java.lang.String,byte[],int,int) throws java.lang.ClassFormatError accessible: module java.base does not ""opens java.lang"" to unnamed module @1176dcec
        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:354)
        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:297)
        at java.base/java.lang.reflect.Method.checkCanSetAccessible(Method.java:199)
        at java.base/java.lang.reflect.Method.setAccessible(Method.java:193)
        at com.sun.xml.bind.v2.runtime.reflect.opt.Injector$1.run(Injector.java:177)
        at com.sun.xml.bind.v2.runtime.reflect.opt.Injector$1.run(Injector.java:174)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1130/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1130,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jt1gL,incubator-uniffle,1672960011,1130,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-08-10T10:24:31Z,2023-08-10T10:24:31Z,"I attemp to include `--add-opens java.base/java.lang=ALL-UNNAMED` in JVM_ARGS,  the Jetty server operates normally.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jt1gL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1132,https://api.github.com/repos/apache/incubator-uniffle/issues/1132,incubator-uniffle,1846319998,1132,[Improvement] Unregister shuffle explicitly when Spark application is stopped,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-11T07:13:05Z,2023-08-15T08:01:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Now we delete  shuffle data when the shuffle servers haven't received heartbeat for a period time and trigger to delete the shuffle data because of heartbeat time out.
We can unregister shuffle explicitly when Spark application is stopped.
MR and Tez have supported this feature. Spark can support it, too. You can refer to https://github.com/apache/incubator-uniffle/pull/1131

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1132/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1132,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jzKUP,incubator-uniffle,1674355983,1132,NA,zhuyaogai,18461102,Fantasy-Jay,,NA,2023-08-11T08:03:23Z,2023-08-11T08:03:23Z,@jerqi Could you assign this issue to me? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5jzKUP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1133,https://api.github.com/repos/apache/incubator-uniffle/issues/1133,incubator-uniffle,1847049242,1133,[FEATURE] Add an  interface for object storage,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-08-11T15:41:42Z,2023-08-12T09:30:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

1. Refactor some classes to adapt object storage
2. Add Remote Storage Manager
3. Add Object Storage Manager
4. Add the interface `listRemoteFiles`

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1133/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1143,https://api.github.com/repos/apache/incubator-uniffle/issues/1143,incubator-uniffle,1848823469,1143,[DOCS] Show procedures' sequence number correctly in Readme,bowenliang123,1935105,Bowen Liang,bowenliang@apache.org,CLOSED,2023-08-14T01:03:14Z,2023-08-14T01:48:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

_No response_

### Affects Version(s)

master

### Improving the documentation

Inside the architecture graph in Readme, the procedures are marked in numbers of 1, 2, 3, etc, while the following text is marked in numbers of i, ii, iii, etc. It's introduced by incorrect paragraph indentation in Markdown.

![image](https://github.com/apache/incubator-uniffle/assets/1935105/5b9a339c-0d4c-46d6-8b11-bbd8ec95f560)


### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1143/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1149,https://api.github.com/repos/apache/incubator-uniffle/issues/1149,incubator-uniffle,1851088900,1149,[Bug] GC logs in JDK 11 do not include date and time stamps.,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2023-08-15T08:35:56Z,2024-05-28T05:13:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Now gc log in jdk11 is set by 
``` shell
JVM_ARGS="" -server \
......
          -Xloggc:${RSS_LOG_DIR}/gc-%t.log""

JAVA11_EXTRA_ARGS="" -XX:+IgnoreUnrecognizedVMOptions \
          -Xlog:gc:tags,time,uptime,level""
```
and gc log do not include data and time 
```
[0.004s][info][gc,heap] Heap region size: 32M
```
when use
```
-Xlog:gc*:${RSS_LOG_DIR}/gc-%t.log:tags,time,uptime,level
```
it works
```
[2023-08-15T16:16:50.442+0800][0.011s][info   ][gc,heap] Heap region size: 32M
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1149/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1149,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wXeOs,incubator-uniffle,1885201324,1149,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-10T16:36:37Z,2024-01-10T16:36:37Z,"@qijiale76 
Hei, Is this problem resolved ? 
If no resolved, maybe I am interests in this problem.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wXeOs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1152,https://api.github.com/repos/apache/incubator-uniffle/issues/1152,incubator-uniffle,1854148152,1152,[Bug] Direct memory may leak in shuffle server.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-08-17T02:41:04Z,2023-08-17T11:56:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Direct memory may leak in shuffle server.

In client side, some task failed, Found error log:`due to io.grpc.StatusRuntimeException: DEADLINE_EXCEEDED: deadline exceeded after 59.999950602s.`

And then I found shuffle server have many oom log:
```
Exception in thread ""Grpc-3250"" java.lang.OutOfMemoryError: Direct buffer memory
	at java.base/java.nio.Bits.reserveMemory(Bits.java:175)
	at java.base/java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:118)
	at java.base/java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:317)
	at io.grpc.netty.shaded.io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:648)
	at io.grpc.netty.shaded.io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:623)
	at io.grpc.netty.shaded.io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:202)
	at io.grpc.netty.shaded.io.netty.buffer.PoolArena.tcacheAllocateNormal(PoolArena.java:186)
```

Monitor shows that the direct memory of shuffle server have reached 80G (MaxDirectMemorySize is just 80G).

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

some key configuration:

1. We did not set netty port.
2. client type is GRPC, but not GRPC_NETTY
3. -Xmx200G -XX:MaxDirectMemorySize=80G

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1152/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1152,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kOjJJ,incubator-uniffle,1681535561,1152,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-08-17T02:57:01Z,2023-08-17T02:57:01Z,"We add these startup options to analyse:
```
-Dio.netty.leakDetection.level=PARANOID -XX:NativeMemoryTracking=detail
```

Then we found these logs

```
[ERROR] 2023-08-16 12:56:11,453 Grpc-146 ResourceLeakDetector reportTracedLeak - LEAK: ByteBuf.release() was not called before it's garbage-collected. See https://netty.io/wiki/reference-counted-objects.html for more information.
Recent access records: 
#1:
        io.netty.buffer.AdvancedLeakAwareByteBuf.order(AdvancedLeakAwareByteBuf.java:71)
        io.netty.buffer.CompositeByteBuf.newComponent(CompositeByteBuf.java:346)
        io.netty.buffer.CompositeByteBuf.consolidate0(CompositeByteBuf.java:1758)
        io.netty.buffer.CompositeByteBuf.consolidateIfNeeded(CompositeByteBuf.java:571)
        io.netty.buffer.CompositeByteBuf.addComponent(CompositeByteBuf.java:266)
        io.netty.buffer.CompositeByteBuf.addComponent(CompositeByteBuf.java:222)
        org.apache.uniffle.server.buffer.ShuffleBuffer.updateShuffleData(ShuffleBuffer.java:272)
        org.apache.uniffle.server.buffer.ShuffleBuffer.getShuffleData(ShuffleBuffer.java:169)
        org.apache.uniffle.server.buffer.ShuffleBufferManager.getShuffleData(ShuffleBufferManager.java:231)
        org.apache.uniffle.server.ShuffleTaskManager.getInMemoryShuffleData(ShuffleTaskManager.java:516)
        org.apache.uniffle.server.ShuffleServerGrpcService.getMemoryShuffleData(ShuffleServerGrpcService.java:798)
        org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1053)
        io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:352)
        io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:866)
        io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        java.base/java.lang.Thread.run(Thread.java:829)
#2:
        io.netty.buffer.AdvancedLeakAwareByteBuf.writeBytes(AdvancedLeakAwareByteBuf.java:605)
        io.netty.buffer.CompositeByteBuf$Component.transferTo(CompositeByteBuf.java:1927)
        io.netty.buffer.CompositeByteBuf.consolidate0(CompositeByteBuf.java:1754)
        io.netty.buffer.CompositeByteBuf.consolidateIfNeeded(CompositeByteBuf.java:571)
        io.netty.buffer.CompositeByteBuf.addComponent(CompositeByteBuf.java:266)
        io.netty.buffer.CompositeByteBuf.addComponent(CompositeByteBuf.java:222)
        org.apache.uniffle.server.buffer.ShuffleBuffer.updateShuffleData(ShuffleBuffer.java:272)
        org.apache.uniffle.server.buffer.ShuffleBuffer.getShuffleData(ShuffleBuffer.java:169)
        org.apache.uniffle.server.buffer.ShuffleBufferManager.getShuffleData(ShuffleBufferManager.java:231)
        org.apache.uniffle.server.ShuffleTaskManager.getInMemoryShuffleData(ShuffleTaskManager.java:516)
        org.apache.uniffle.server.ShuffleServerGrpcService.getMemoryShuffleData(ShuffleServerGrpcService.java:798)
        org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1053)
        io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:352)
        io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:866)
        io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        java.base/java.lang.Thread.run(Thread.java:829)
Created at:
        io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:402)
        io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:188)
        io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:179)
        io.netty.buffer.CompositeByteBuf.allocBuffer(CompositeByteBuf.java:1872)
        io.netty.buffer.CompositeByteBuf.consolidate0(CompositeByteBuf.java:1751)
        io.netty.buffer.CompositeByteBuf.consolidateIfNeeded(CompositeByteBuf.java:571)
        io.netty.buffer.CompositeByteBuf.addComponent(CompositeByteBuf.java:266)
        io.netty.buffer.CompositeByteBuf.addComponent(CompositeByteBuf.java:222)
        org.apache.uniffle.server.buffer.ShuffleBuffer.updateShuffleData(ShuffleBuffer.java:272)
        org.apache.uniffle.server.buffer.ShuffleBuffer.getShuffleData(ShuffleBuffer.java:169)
        org.apache.uniffle.server.buffer.ShuffleBufferManager.getShuffleData(ShuffleBufferManager.java:231)
        org.apache.uniffle.server.ShuffleTaskManager.getInMemoryShuffleData(ShuffleTaskManager.java:516)
        org.apache.uniffle.server.ShuffleServerGrpcService.getMemoryShuffleData(ShuffleServerGrpcService.java:798)
        org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1053)
        io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:352)
        io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:866)
        io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        java.base/java.lang.Thread.run(Thread.java:829)
```

We found NettyManagedBuffer in https://github.com/apache/incubator-uniffle/blob/5ac76e8179a7c038855d439bfbdc9bf759f3f108/server/src/main/java/org/apache/uniffle/server/buffer/ShuffleBuffer.java#L170 is never released in GRPC mode. 

I search the code. ManagedBuffer::release is only called in NETTY mode.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kOjJJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1152,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kOnEd,incubator-uniffle,1681551645,1152,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-17T03:22:17Z,2023-08-17T03:22:17Z,Great work!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kOnEd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1153,https://api.github.com/repos/apache/incubator-uniffle/issues/1153,incubator-uniffle,1854163143,1153,[Improvement] Add Netty buffer leak detection in integration test.,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,OPEN,2023-08-17T03:01:08Z,2024-06-19T13:23:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

As mentioned in https://github.com/apache/incubator-uniffle/issues/1152, by adding `-Dio.netty.leakDetection.level=advanced`, we discovered the problem of buffer leak in Netty. It is necessary to include this leak detection feature in integration testing to better identify such problems.

```
[ERROR] 2023-08-16 12:56:11,453 Grpc-146 ResourceLeakDetector reportTracedLeak - LEAK: ByteBuf.release() was not called before it's garbage-collected. See https://netty.io/wiki/reference-counted-objects.html for more information.
Recent access records: 
#1:
        io.netty.buffer.AdvancedLeakAwareByteBuf.order(AdvancedLeakAwareByteBuf.java:71)
        io.netty.buffer.CompositeByteBuf.newComponent(CompositeByteBuf.java:346)
        io.netty.buffer.CompositeByteBuf.consolidate0(CompositeByteBuf.java:1758)
        io.netty.buffer.CompositeByteBuf.consolidateIfNeeded(CompositeByteBuf.java:571)
        io.netty.buffer.CompositeByteBuf.addComponent(CompositeByteBuf.java:266)
        io.netty.buffer.CompositeByteBuf.addComponent(CompositeByteBuf.java:222)
        org.apache.uniffle.server.buffer.ShuffleBuffer.updateShuffleData(ShuffleBuffer.java:272)
        org.apache.uniffle.server.buffer.ShuffleBuffer.getShuffleData(ShuffleBuffer.java:169)
        org.apache.uniffle.server.buffer.ShuffleBufferManager.getShuffleData(ShuffleBufferManager.java:231)
        org.apache.uniffle.server.ShuffleTaskManager.getInMemoryShuffleData(ShuffleTaskManager.java:516)
        org.apache.uniffle.server.ShuffleServerGrpcService.getMemoryShuffleData(ShuffleServerGrpcService.java:798)
        org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1053)
        io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:352)
        io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:866)
        io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        java.base/java.lang.Thread.run(Thread.java:829)

......

: 14 leak records were discarded because they were duplicates
: 1010 leak records were discarded because the leak record count is targeted to 4. Use system property io.netty.leakDetection.targetRecords to increase the limit.

```

Ref: https://netty.io/wiki/reference-counted-objects.html

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1153/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1153,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kPK7y,incubator-uniffle,1681698546,1153,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-17T06:33:02Z,2023-08-17T06:33:02Z,Nice feature!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kPK7y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1153,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vF0ms,incubator-uniffle,1863797164,1153,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2023-12-20T03:36:12Z,2023-12-20T03:36:12Z,@qijiale76 Any progress here?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vF0ms/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1153,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vNKl1,incubator-uniffle,1865722229,1153,NA,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,NA,2023-12-21T07:16:53Z,2023-12-21T07:16:53Z,"> @qijiale76 Any progress here?

@rickyma I have attempted to address this issue. It's fairly straightforward to add tests related to memory leaks, and using the older version of the code that hasn't fixed the bug, these leaks can be detected. However, I haven't found a method to cause the entire unit test to fail when a memory leak occurs. If you have any effective solutions, please let me know. Thank you for your attention.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vNKl1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1153,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6B3IHA,incubator-uniffle,2178712000,1153,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-19T13:23:01Z,2024-06-19T13:23:01Z,"I think you can use a custom `ResourceLeakDetector`:
```
import io.netty.util.ResourceLeakDetector;
import io.netty.util.ResourceLeak;
import io.netty.util.internal.StringUtil;

public class CustomResourceLeakDetector<T> extends ResourceLeakDetector<T> {

    public CustomResourceLeakDetector(Class<?> resourceType, int samplingInterval) {
        super(resourceType, samplingInterval);
    }

    @Override
    protected void reportTracedLeak(String records, String additionalString) {
        throw new AssertionError(""Resource leak detected: "" + records + StringUtil.NEWLINE + additionalString);
    }

    @Override
    protected void reportUntracedLeak(String records) {
        throw new AssertionError(""Resource leak detected: "" + records);
    }
}
```

And the demo test code could be:
```
import io.netty.buffer.ByteBuf;
import io.netty.buffer.ByteBufAllocator;
import io.netty.buffer.PooledByteBufAllocator;
import io.netty.util.ResourceLeakDetectorFactory;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

public class NettyLeakTest {

    private CustomResourceLeakDetector<ByteBuf> leakDetector;

    @Before
    public void setUp() {
        // Create a custom ResourceLeakDetector
        leakDetector = new CustomResourceLeakDetector<>(ByteBuf.class, 1);
        // Set ResourceLeakDetectorFactory to the custom ResourceLeakDetector
        ResourceLeakDetectorFactory.setResourceLeakDetectorFactory(() -> leakDetector);
    }

    @Test
    public void testLeak() {
        // Write your business code here
        ByteBufAllocator allocator = PooledByteBufAllocator.DEFAULT;
        ByteBuf buffer = allocator.buffer();
        // Intentionally do not release the buffer to trigger leak detection
        // buffer.release();
    }

    @After
    public void tearDown() {
        // Check for leaks after the test is finished
        // If a leak is detected, the custom ResourceLeakDetector will throw an AssertionError, causing the JUnit test to fail
        leakDetector.reportLeak();
    }
}
```

The code might not be workable. You can dig into it. Help Uniffle to gain the ability to find out potential leaks during tests.

@qijiale76 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6B3IHA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1155,https://api.github.com/repos/apache/incubator-uniffle/issues/1155,incubator-uniffle,1854595500,1155,fix(netty): io.netty.util.internal.OutOfDirectMemoryError.,leixm,31424839,Xianming Lei,,CLOSED,2023-08-17T09:16:48Z,2023-08-17T11:55:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Currently using the code of the master branch to test a large data set, an `io.netty.util.internal.OutOfDirectMemoryError` exception will occur.

#### Is there a memory leak? 
I tried to use the end-to-end test method. I found that in the scenario of 5 concurrency and 500G, the oom exception did not appear, but in the scenario of 40 concurrency and 500G, the oom exception appeared. It seems that the problem of oom is caused by `actual memory occupies larger than used_buffer` instead of `memory leak`.

When this line of code `ByteBuf data = ByteBufUtils.readSlice(byteBuf);` was executed in org.apache.uniffle.common.netty.protocol.Decoders#decodeShuffleBlockInfo, the life cycle of the ByteBuf applied inside the netty framework is extended, TransportFrameDecoder# When channelRead executes `frame.release();`, ByteBuf cannot be released. I am not sure whether the Bytebuf object generated by the netty framework contains other content. Judging from the current test results, it seems to lead to off-heap memory Occupies much larger than `used_buffer`.

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 85899345920, max: 85899345920)
        at io.netty.util.internal.PlatformDependent.incrementMemoryCounter(PlatformDependent.java:802)
        at io.netty.util.internal.PlatformDependent.allocateDirectNoCleaner(PlatformDependent.java:731)
        at io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:632)
        at io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:607)
        at io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:202)
        at io.netty.buffer.PoolArena.tcacheAllocateNormal(PoolArena.java:186)
        at io.netty.buffer.PoolArena.allocate(PoolArena.java:136)
        at io.netty.buffer.PoolArena.allocate(PoolArena.java:126)
        at io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:395)
        at io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:188)
        at io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:179)
        at io.netty.buffer.AbstractByteBufAllocator.ioBuffer(AbstractByteBufAllocator.java:140)
        at io.netty.channel.DefaultMaxMessagesRecvByteBufAllocator$MaxMessageHandle.allocate(DefaultMaxMessagesRecvByteBufAllocator.java:114)
        at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:150)
        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719)
        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
        at java.lang.Thread.run(Thread.java:745)
```



### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

```
rss.rpc.server.port 19997
rss.jetty.http.port 19996
rss.server.netty.port 29999
rss.storage.basePath xxx,xxx
rss.storage.type MEMORY_LOCALFILE
rss.coordinator.quorum xxx:19999
rss.server.buffer.capacity 40gb
rss.server.read.buffer.capacity 20gb
rss.server.flush.thread.alive 50
rss.server.flush.threadPool.size 4
rss.server.disk.capacity 1t
rss.server.heartbeat.timeout 60000
rss.server.heartbeat.interval 10000
rss.rpc.message.max.size 1073741824
rss.server.preAllocation.expired 120000
rss.server.commit.timeout 600000
rss.server.app.expired.withoutHeartbeat 300000
rss.server.flush.cold.storage.threshold.size 64m
```

### Uniffle Engine Configurations

_No response_

### Additional context

Test script:
```
package org.apache.uniffle.client.tools;

import com.google.common.collect.Lists;
import com.google.common.collect.Maps;
import org.apache.uniffle.client.api.ShuffleServerClient;
import org.apache.uniffle.client.factory.ShuffleServerClientFactory;
import org.apache.uniffle.client.request.RssAppHeartBeatRequest;
import org.apache.uniffle.client.request.RssRegisterShuffleRequest;
import org.apache.uniffle.client.request.RssSendShuffleDataRequest;
import org.apache.uniffle.client.response.RssSendShuffleDataResponse;
import org.apache.uniffle.client.util.ClientUtils;
import org.apache.uniffle.common.ClientType;
import org.apache.uniffle.common.PartitionRange;
import org.apache.uniffle.common.ShuffleBlockInfo;
import org.apache.uniffle.common.ShuffleServerInfo;
import org.apache.uniffle.common.config.RssClientConf;
import org.apache.uniffle.common.config.RssConf;
import org.apache.uniffle.common.rpc.StatusCode;
import org.apache.uniffle.common.util.ChecksumUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.List;
import java.util.Map;
import java.util.Random;
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.atomic.AtomicInteger;

public class EndToEndStressTest {
    private static Logger LOG;
    static class StressTest {
        private String shuffleServerAddress;
        private String appId;
        private int shuffleId;
        private int partitionNum;
        private int threadNum;
        private long sendBytes;

        private long bytesPerThread;
        private long roundsPerThread;

        private int bytesPerPartition;

        private AtomicInteger atomicInteger = new AtomicInteger();
        ShuffleServerClient shuffleServerClient;

        Map<Integer, Map<Integer, List<ShuffleBlockInfo>>> shuffleIdToBlocks;

        ExecutorService threadPoolExecutor;

        CountDownLatch countDownLatch;
        private volatile boolean stopped = false;

        private int blockSize;
        public StressTest(String shuffleServerAddress, String appId, int shuffleId, int partitionNum, int threadNum, long sendBytes, int blockSize) {
            this.shuffleServerAddress = shuffleServerAddress;
            this.appId = appId;
            this.shuffleId = shuffleId;
            this.partitionNum = partitionNum;
            this.threadNum = threadNum;
            this.sendBytes = sendBytes;
            this.blockSize = blockSize;
            this.bytesPerThread = sendBytes / threadNum;
            this.roundsPerThread = bytesPerThread / blockSize;
            this.bytesPerPartition = (int) (bytesPerThread / (roundsPerThread * partitionNum));
            LOG = LoggerFactory.getLogger(EndToEndStressTest.class + ""-"" + appId);
            shuffleIdToBlocks = Maps.newHashMap();
            LOG.info(""bytesPerThread={}, roundsPerThread={}, bytesPerPartition={}"", bytesPerThread, roundsPerThread, bytesPerPartition);
            Map<Integer, List<ShuffleBlockInfo>> partitionToBlocks = Maps.newHashMap();
            for (int partitionId = 0; partitionId < partitionNum; partitionId++) {
                byte[] data = new byte[bytesPerPartition];
                for (int j = 0; j < bytesPerPartition; j++) {
                    data[j] = (byte) (new Random()).nextInt(127);
                }
                int mockTaskAttemptId =  (new Random()).nextInt(100);
                partitionToBlocks.put(partitionId, Lists.newArrayList(new ShuffleBlockInfo(0, partitionId,
                        ClientUtils.getBlockId(partitionId, mockTaskAttemptId, atomicInteger.getAndIncrement()),
                        data.length, ChecksumUtils.getCrc32(data), data, Lists.newArrayList(), data.length, 0, mockTaskAttemptId)));
            }
            shuffleIdToBlocks.put(0, partitionToBlocks);
            ShuffleServerClientFactory clientFactory = ShuffleServerClientFactory.getInstance();
            RssConf rssConf = new RssConf();
            rssConf.set(RssClientConf.NETTY_CLIENT_NUM_CONNECTIONS_PER_PEER, 20);
            shuffleServerClient = clientFactory.getShuffleServerClient(
                    ClientType.GRPC_NETTY.name(), new ShuffleServerInfo(""1"", shuffleServerAddress.split("":"")[0],
                            Integer.parseInt(shuffleServerAddress.split("":"")[1]), Integer.parseInt(shuffleServerAddress.split("":"")[2])), rssConf
            );
            countDownLatch = new CountDownLatch(threadNum);

            List<PartitionRange> partitionRangeList = Lists.newArrayList();
            for (int i = 0; i < partitionNum; i++) {
                partitionRangeList.add(new PartitionRange(i, i));
            }

            LOG.info(""Start register shuffle!"");
            RssRegisterShuffleRequest rssRegisterShuffleRequest = new RssRegisterShuffleRequest(appId, 0, partitionRangeList, """");
            shuffleServerClient.registerShuffle(rssRegisterShuffleRequest);
            LOG.info(""Finished register shuffle!"");
        }

        public void run() throws InterruptedException {
            LOG.info(""Start end-to-end stress test!"");
            threadPoolExecutor = Executors.newFixedThreadPool(threadNum);
            for (int i = 0; i < threadNum; i++) {
                threadPoolExecutor.submit(this::send);
            }

            RssAppHeartBeatRequest heartBeatRequest = new RssAppHeartBeatRequest(""test_app"", 60 * 1000);
            while (countDownLatch.getCount() > 0) {
                shuffleServerClient.sendHeartBeat(heartBeatRequest);
                try {
                    Thread.sleep(3000);
                } catch (InterruptedException e) {
                    LOG.error(""heartBeat error!"", e);
                    break;
                }
            }

            countDownLatch.await();
        }
        public void send() {
            LOG.info(""Start end-to-end stress send!"");

            for (int i = 0; i < roundsPerThread && !stopped; i++) {
                LOG.info(""round-{}"", i);
                RssSendShuffleDataRequest request = new RssSendShuffleDataRequest(appId, 100, 10000L, shuffleIdToBlocks);
                RssSendShuffleDataResponse response = shuffleServerClient.sendShuffleData(request);
                if(response.getStatusCode() != StatusCode.SUCCESS) {
                    LOG.error(""sendShuffleData error! {}"", response.getMessage());
                }
            }
            countDownLatch.countDown();
        }

        public void stop() {
            stopped = true;
            threadPoolExecutor.shutdown();
        }
    }

    public static void main(String[] args) throws InterruptedException {
        String appId = args[0];
        String shuffleServerAddress = args[1];
        int partitionNun = Integer.parseInt(args[2]);
        int thread = Integer.parseInt(args[3]);
        long sendBytes = Long.parseLong(args[4]);
        int blockSize = Integer.parseInt(args[5]);
        StressTest stressTest = new StressTest(shuffleServerAddress, appId, 0, partitionNun, thread, sendBytes, blockSize);
        stressTest.run();
        stressTest.stop();
    }
}
```

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1155/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1157,https://api.github.com/repos/apache/incubator-uniffle/issues/1157,incubator-uniffle,1857504541,1157,[Bug] [TEZ] The container does not exit because shuffleclient is not closed,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-19T02:56:29Z,2023-12-24T10:50:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

MR has fixed the issue https://github.com/apache/incubator-uniffle/pull/882
Tez has the similar issue. We can refer to https://github.com/apache/incubator-uniffle/pull/882 to fix the issue.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1157/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1157,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kb4bC,incubator-uniffle,1685030594,1157,NA,zhuyaogai,18461102,Fantasy-Jay,,NA,2023-08-19T15:39:49Z,2023-08-19T15:39:49Z,@jerqi Could you assign this issue to me? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kb4bC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1157,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nKlwI,incubator-uniffle,1730829320,1157,NA,Sanjeevliv,91120312,,,NA,2023-09-22T05:38:28Z,2023-09-22T05:38:28Z,"Please assign it to me
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nKlwI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1157,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nKqJm,incubator-uniffle,1730847334,1157,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-09-22T06:02:11Z,2023-09-22T06:02:11Z,"> Please assign it to me

@Sanjeevliv Assigned. Thanks.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nKqJm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1159,https://api.github.com/repos/apache/incubator-uniffle/issues/1159,incubator-uniffle,1857521121,1159,Improve the code of getShuffleResult,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2023-08-19T03:24:58Z,2023-08-19T03:25:53Z," I will raise sub PRs to address the following problem:
1. Create a new rpc interface to report failures in batch
2. move getShuffleResult into ShuffleReadClient
3. get result part move to RssShuffleReader

_Originally posted by @leixm in https://github.com/apache/incubator-uniffle/issues/1004#issuecomment-1631928050_
            ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1159/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1161,https://api.github.com/repos/apache/incubator-uniffle/issues/1161,incubator-uniffle,1858966674,1161,Netty performance tracking,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-08-21T09:23:47Z,2023-08-22T09:13:56Z,"## Netty Performance tracking

### sub tasks

1. #1162 
2. #1163

### Benchmark

Tested with grpc and netty.

#### Environment
_Software_: Uniffle master / Hadoop 3.2.2 / Spark 3.1.2

_Hardware_: Machine 96 cores, 512G memory, 1T * 4 SSD, network bandwidth 8GB/s

_Hadoop Yarn Cluster_: 1 * ResourceManager + 40 * NodeManager, every machine 1T * 4 SSD

_Uniffle Cluster_: 1 * Coordinator + 5 * Shuffle Server, every machine 1T * 4 SSD


#### Configuration
spark's conf
``` 
spark.executor.instances 400
spark.executor.cores 1
spark.executor.memory 2g
spark.shuffle.manager org.apache.spark.shuffle.RssShuffleManager
spark.rss.storage.type MEMORY_LOCALFILE
``` 

uniffle grpc-based server's conf
``` 
JVM XMX=200g

...
rss.server.buffer.capacity 100g
rss.server.read.buffer.capacity 20g
rss.server.flush.thread.alive 20
rss.server.flush.threadPool.size 50
rss.server.high.watermark.write 80
rss.server.low.watermark.write 70
...
``` 

uniffle netty-based server's conf
``` 
XMX_SIZE=""140g""
MAX_DIRECT_MEMORY_SIZE=200g

...
rss.server.buffer.capacity 100g
rss.server.read.buffer.capacity 20g
rss.server.flush.thread.alive 20
rss.server.flush.threadPool.size 50
rss.server.high.watermark.write 80
rss.server.low.watermark.write 70
...
``` 

#### report

| type                | 5T (run with 400 executors) |
|----------------------:|:---------------------------:|
| grpc-based | 3.6min/5.9min    |
| netty                    | 3.4min/7.7min   |


And I found the spark executor with netty uniffle gc time is higher than grpc based.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1161/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1161,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kfeow,incubator-uniffle,1685973552,1161,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-21T09:27:35Z,2023-08-21T09:27:35Z,Could you enable `spark.rss.client.off.heap.memory.enable`?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kfeow/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1161,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kknz1,incubator-uniffle,1687321845,1161,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-22T02:30:46Z,2023-08-22T02:30:46Z,"> Could you enable `spark.rss.client.off.heap.memory.enable`?

This is only for hdfs.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kknz1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1161,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kkn8c,incubator-uniffle,1687322396,1161,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-22T02:31:37Z,2023-08-22T02:31:37Z,"Another problem: the remote fetch from localfile by netty is unstable, compared with grpc, it costs too much time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kkn8c/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1163,https://api.github.com/repos/apache/incubator-uniffle/issues/1163,incubator-uniffle,1860457669,1163,[Improvement] return the direct byte buffer when getting localfile data by using netty ,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-08-22T02:54:54Z,2023-08-23T16:15:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the `FileSegmentManagedBuffer` will return the heap bytebuffer when reading data from localfile. It will be better to using the direct byte buffer

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1163/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1163,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kvyYV,incubator-uniffle,1690248725,1163,NA,pegasas,13224827,John Huang,pegasashjy@gmail.com,NA,2023-08-23T16:14:08Z,2023-08-23T16:14:08Z,"Hi, @zuston ,

I will look into this problem and tries to raise an PR.
request to assign me this issue.
feel free to ping me if there is any concern.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kvyYV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1164,https://api.github.com/repos/apache/incubator-uniffle/issues/1164,incubator-uniffle,1860774129,1164,Exposing the `getDataLen` method for ShuffleDataResult,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-22T07:19:02Z,2023-08-28T01:44:03Z,"              Why not exposing the `bufferDataLen` method for being invoked?

_Originally posted by @zuston in https://github.com/apache/incubator-uniffle/pull/1162#discussion_r1300808432_
            ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1164/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1164,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kvwhb,incubator-uniffle,1690241115,1164,NA,pegasas,13224827,John Huang,pegasashjy@gmail.com,NA,2023-08-23T16:09:44Z,2023-08-23T16:09:44Z,"Hi, @jerqi , 

I will make a PR for this to go through shuffle server logic for learning.
Would you please assign me this issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kvwhb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1165,https://api.github.com/repos/apache/incubator-uniffle/issues/1165,incubator-uniffle,1860964744,1165,[Improvement] (tez): Unregister shuffle data after completing the execution of a DAG. ,zhuyaogai,18461102,Fantasy-Jay,,CLOSED,2023-08-22T08:52:56Z,2023-08-25T02:22:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Generally, one application will execute multiple DAGs, and there is no correlation between the DAGs. Therefore, after completing the execution of a DAG, you can unregister the relevant shuffle data. Otherwise, when there are many DAGs, an application will occupy a large amount of resources for a long period of time.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1165/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1168,https://api.github.com/repos/apache/incubator-uniffle/issues/1168,incubator-uniffle,1862812280,1168,[Improvement] Avoid unnecessary data copy.,zhengchenyu,10381583,zhengchenyu,,OPEN,2023-08-23T08:16:16Z,2023-08-23T08:16:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For MR/Tez, I found that compressedData is extracted to uncompressedData. Then uncompressedData is copy to InMemoryMapOutput::memory.  I think the copy process is unnecessary.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1168/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1169,https://api.github.com/repos/apache/incubator-uniffle/issues/1169,incubator-uniffle,1864295661,1169,[DOCS] shuffle-server with low-memory best practice,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-08-24T02:49:24Z,2023-12-23T17:26:09Z,"I think we need to describe more sections to how to configure the client/server config on a low memory config.

From my point of view, once you configure lower memory, you have to accept the slowdown caused by back pressure when running more. As we all know, Uniffle uses memory as a high-speed buffer, but once the buffer is full, the rate of receiving shuffle data will be reduced to the highest write rate of the disk, so it will be back pressured.

In this case, we have two ways to avoid task failure
1. make the lower watermark for memory store. such as ` rss.server.high.watermark.write 20` , `rss.server.low.watermark.write 10`
2. increase the client timeout. `rss.client.send.check.timeout.ms 1200000`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1169/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kzbPl,incubator-uniffle,1691202533,1169,NA,kunzeng,34341321,kunzeng,,NA,2023-08-24T08:02:33Z,2023-08-24T08:02:33Z,"    
It's a good issue. In fact, in some cases, the resources of the hosts are strictly allocated. A better thing is that we can test the performance of uniffle under different memory sizes. This can provides a reference for resource allocation for unifle server. 

But, in my case, an error was reported when running the 1tb tpc-ds q4.sql test  with the memory set to 4g for uniffle server, 2g for coordinator.  Just limit the resource of uniffle, because compared to the sortshuffle(spark) , the resources of uniffle are additional. the confs are as follows:

test data: tpc-ds, generated by 1tb, query q4.sql, stored in hive2.1.1, spark2.4.4, uniffle0.7.1, hadoop3.2.1 

spark-defaults.conf：
spark.driver.memory 32g
spark.driver.memoryOverhead 8g
spark.executor.memory 64g
spark.executor.memoryOverhead 16g
spark.executor.instances 6
spark.driver.cores 16
spark.executor.cores 32
spark.sql.autoBroadcastJoinThreshold 2
spark.sql.broadcastTimeout 300
spark.executor.heartbeatInterval 60
spark.network.timeout 600
spark.rss.client.send.check.timeout.ms 1800000

coordinator.conf(We have modified the JVM_ARGS parameter in the start-coordinator. sh file to limit the coordinator resource to 2g, ):
rss.coordinator.server.heartbeat.timeout 30000
rss.coordinator.server.periodic.output.interval.times 30
rss.coordinator.assignment.strategy PARTITION_BALANCE
rss.coordinator.app.expired 60000
rss.coordinator.shuffle.nodes.max 3
rss.coordinator.exclude.nodes.file.path 
rss.coordinator.exclude.nodes.check.interval.ms 60000
rss.coordinator.access.checkers 
rss.coordinator.access.loadChecker.memory.percentage 5.0
rss.coordinator.dynamicClientConf.enabled true
rss.coordinator.dynamicClientConf.path /etc/confpath/dynamic_client.conf
rss.coordinator.dynamicClientConf.updateIntervalSec 120
rss.coordinator.remote.storage.cluster.conf 
rss.rpc.server.port 19995
rss.jetty.http.port 19994
rss.coordinator.remote.storage.select.strategy APP_BALANCE
rss.coordinator.remote.storage.io.sample.schedule.time 60000
rss.coordinator.remote.storage.io.sample.file.size 204800000
rss.coordinator.remote.storage.io.sample.access.times 3
rss.coordinator.startup-silent-period.enabled false
rss.coordinator.startup-silent-period.duration 20000

dynamic_client.conf:
rss.storage.type MEMORY_LOCALFILE_HDFS
rss.coordinator.remote.storage.path hdfs://ip:8020/tmp
rss.writer.require.memory.retryMax 1200
rss.client.retry.max 50
rss.writer.send.check.timeout 600000
rss.client.read.buffer.size 14m
rss.client.send.check.timeout.ms 1800000

server.conf:
rss.rpc.server.port 19992
rss.jetty.http.port 19991
rss.rpc.executor.size 1000
rss.storage.basePath /mnt/ssd1/data/rssdata,/mnt/ssd2/data/rssdata,/mnt/ssd3/data/rssdata,/mnt/ssd4/data/rssdata,/mnt/ssd5/data/rssdata,/mnt/disk1/data/rssdata,/mnt/disk2/data/rssdata,/mnt/disk3/data/rssdata,/mnt/disk4/data/rssdata,/mnt/disk5/data/rssdata
rss.server.flush.thread.alive 120
rss.server.heartbeat.timeout 60000
rss.rpc.message.max.size 1073741824
rss.server.preAllocation.expired 20000
rss.server.app.expired.withoutHeartbeat 60000
rss.server.buffer.capacity 3g
rss.server.memory.shuffle.highWaterMark.percentage 10.0
rss.server.memory.shuffle.lowWaterMark.percentage 5.0
rss.server.read.buffer.capacity 512m
rss.server.heartbeat.interval 10000
rss.server.flush.threadPool.size 10
rss.server.commit.timeout 600000
rss.storage.type MEMORY_LOCALFILE_HDFS
rss.server.flush.cold.storage.threshold.size 32m
rss.server.tags 
rss.server.single.buffer.flush.enabled true
rss.server.single.buffer.flush.threshold 32m
rss.server.disk.capacity -1
rss.server.localstorage.initialize.max.fail.number 1
rss.coordinator.access.loadChecker.serverNum.threshold 1
rss.coordinator.access.candidates.updateIntervalSec 120
rss.coordinator.access.candidates.path 

rss-env.sh:
RSS_HOME=/usr/lib/uniffle
RSS_CONF_DIR=/etc/uniffle
RSS_PID_DIR=/var/uniffle
RSS_LOG_DIR=/mnt/disk1/log/uniffle
JAVA_HOME=/usr/lib/jdk1.8
HADOOP_HOME=/usr/lib/hadoop
XMX_SIZE=4g
RSS_IP=0.0.0.0

uniffle server is normal, but spark thrown an exception, and the task ends, exts.
org.apache.spark.SparkException: Job aborted due to stage failure: Task 25 in stage 1.0 failed 4 times, most recent failure: Lost task 25.3 in stage 1.0 (TID 4604, xshbp225.bigdata.hikvision.com, executor 5): org.apache.uniffle.common.exception.RssException: Send failed: Task[4604_3] failed because 200 blocks can't be sent to shuffle server.
        at org.apache.spark.shuffle.writer.RssShuffleWriter.checkBlockSendResult(RssShuffleWriter.java:299)
        at org.apache.spark.shuffle.writer.RssShuffleWriter.writeImpl(RssShuffleWriter.java:194)
        at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:167)
        at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)
        at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:55)
        at org.apache.spark.scheduler.Task.run(Task.scala:123)
        at org.apache.spark.executor.Executor$TaskRunner$$anonfun$10.apply(Executor.scala:408)
        at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1360)
        at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:414)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        at java.base/java.lang.Thread.run(Thread.java:834)

Some optimization operations(useless)：
set rss.server.buffer.capacity 3g or 2g
rss.server.memory.shuffle.highWaterMark.percentage 10.0 or 20.0, 30.0 
rss.server.memory.shuffle.lowWaterMark.percentage 5.0 or 10.0
rss.server.single.buffer.flush.threshold 32m or 64m, 16m, 4m
rss.server.read.buffer.capacity 512m or 256m, 1g
rss.server.single.buffer.flush.enabled true or false

Big workers，have any other parameter tuning or suggestions for uniflle under limited resource conditions? thanks","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5kzbPl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5k1tjM,incubator-uniffle,1691801804,1169,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-24T14:33:23Z,2023-08-24T14:33:23Z,Thanks for your share. I will test it in tomorrow.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5k1tjM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5k42ht,incubator-uniffle,1692625005,1169,NA,kunzeng,34341321,kunzeng,,NA,2023-08-25T01:28:49Z,2023-08-25T01:28:49Z,"something wrong! Pay attention and attention to the conf of RSS_IP=0.0.0.0.  Due to multiple network interface card env, i set rss_ip=0.0.0.0 to adapt(For multiple network interface card, some suggestions?), looks wrong. 

Remove it and set rss.server.high.watermark.write 20 , rss.server.low.watermark.write 5, XMX_SIZE=4g. Now task is normal, but  some executors died and slow.  The result will be reported soon! Something confuses me. 

I set XMX_SIZE=4g, but top -p process_id display RES 14.6g, bigger than 4g? U may make me clear! thanks. top -p process_id display as fellow.

top - 09:27:59 up 8 days, 29 min,  4 users,  load average: 31.17, 32.44, 32.10
Tasks:   1 total,   0 running,   1 sleeping,   0 stopped,   0 zombie
%Cpu(s): 36.7 us,  4.9 sy,  0.0 ni, 53.5 id,  4.6 wa,  0.0 hi,  0.3 si,  0.0 st
KiB Mem : 52776729+total, 11288404+free, 16546635+used, 24941689+buff/cache
KiB Swap:        0 total,        0 free,        0 used. 36083699+avail Mem 

   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                             
297718 root      20   0   38.9g  14.6g  14.9m S  35.7  2.9  17:37.99 java ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5k42ht/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5k6KJn,incubator-uniffle,1692967527,1169,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-08-25T08:25:06Z,2023-08-25T08:25:06Z,"https://stackoverflow.com/questions/48798024/java-consumes-memory-more-than-xmx-argument Sometimes. the native and off-heap will occupy some memory, this is the java's problem.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5k6KJn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5m9aaW,incubator-uniffle,1727374998,1169,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-09-20T09:51:20Z,2023-09-20T09:51:20Z,"I have same proposal in the low-memory shuffle server :

if write speed of client is under control, spark client support features like **BackPressure**  or **Sleep Seconds after write same records**. This will prevent the server memory from growing too quickly.

these same configurations in the client to control the writing speed.
```
spark.rss.client.send.threadPool.size = 1
spark.rss.client.data.transfer.pool.size 1
spark.rss.client.retry.max 100
spark.rss.client.retry.interval.max 60000
spark.rss.client.send.check.timeout.ms 2100000
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5m9aaW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1169,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nnQ2R,incubator-uniffle,1738345873,1169,NA,kunzeng,34341321,kunzeng,,NA,2023-09-28T02:22:19Z,2023-09-28T02:22:19Z,"Conclusion: different memory sizes have little impact on the performance of uniffle. For reference only!

We used 1t tpc-ds, 3 nodes, and the configuration is as shown above. The test results are as follows, with a total of 10 SQL statements q (4 11 17 50 64 67 14 78 93 94). SQL.
![image](https://github.com/apache/incubator-uniffle/assets/34341321/466fef57-a20b-4054-8a71-76239e5439b3)

The custom configuration is as follows:
#spark-defaults.conf
spark.driver.memory 32g
spark.driver.memoryOverhead 8g
spark.executor.memory 64g
spark.executor.memoryOverhead 16g
spark.executor.instances 6
spark.driver.cores 16
spark.executor.cores 32

#coordinator.conf
-Xmx4g

#server.conf
-XX:MaxDirectMemorySize=1g

###2g  conf
    XMX_SIZE=2g
    rss.server.buffer.capacity=1400m
    rss.server.read.buffer.capacity=700m
    rss.server.memory.shuffle.highWaterMark.percentage=""30.0""
    rss.server.memory.shuffle.lowWaterMark.percentage=""5.0""
    rss.server.single.buffer.flush.threshold=""32m""
    rss.server.flush.cold.storage.threshold.size=""32m"" 
###4g  conf
    XMX_SIZE=4g
    rss.server.buffer.capacity=2800m
    rss.server.read.buffer.capacity=1400m
    rss.server.memory.shuffle.highWaterMark.percentage=""40.0""
    rss.server.memory.shuffle.lowWaterMark.percentage=""5.0""
    rss.server.single.buffer.flush.threshold=""32m""
    rss.server.flush.cold.storage.threshold.size=""32m""
###8g  server.conf
    XMX_SIZE=8g
    rss.server.buffer.capacity=5600m
    rss.server.read.buffer.capacity=2800m
    rss.server.memory.shuffle.highWaterMark.percentage=""50.0""
    rss.server.memory.shuffle.lowWaterMark.percentage=""10.0""
    rss.server.single.buffer.flush.threshold=""32m""
    rss.server.flush.cold.storage.threshold.size=""32m""
####16g  server.conf
    XMX_SIZE=16g
    rss.server.buffer.capacity=11200m
    rss.server.read.buffer.capacity=5600m
    rss.server.memory.shuffle.highWaterMark.percentage=""70.0""
    rss.server.memory.shuffle.lowWaterMark.percentage=""20.0""
    rss.server.single.buffer.flush.threshold=""64m""
    rss.server.flush.cold.storage.threshold.size=""64m""
####24g  server.conf
    XMX_SIZE=24g
    rss.server.buffer.capacity= 16800m
    rss.server.read.buffer.capacity=8400m
    rss.server.memory.shuffle.highWaterMark.percentage=""75.0""
    rss.server.memory.shuffle.lowWaterMark.percentage=""25.0""
    rss.server.single.buffer.flush.threshold=""64m""
    rss.server.flush.cold.storage.threshold.size=""64m""
###32g  conf
    XMX_SIZE=32g
    rss.server.buffer.capacity= 22400m
    rss.server.read.buffer.capacity= 11200m
    rss.server.memory.shuffle.highWaterMark.percentage=""75.0""
    rss.server.memory.shuffle.lowWaterMark.percentage=""25.0""
    rss.server.single.buffer.flush.threshold=""64m""
rss.server.flush.cold.storage.threshold.size=""64m""
####64g  conf
    XMX_SIZE=64g
    rss.server.buffer.capacity= 44800m
    rss.server.read.buffer.capacity= 22400m
    rss.server.memory.shuffle.highWaterMark.percentage=""75.0""
    rss.server.memory.shuffle.lowWaterMark.percentage=""25.0""
    rss.server.single.buffer.flush.threshold=""64m""
    rss.server.flush.cold.storage.threshold.size=""64m""
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nnQ2R/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1173,https://api.github.com/repos/apache/incubator-uniffle/issues/1173,incubator-uniffle,1866520456,1173,[Bug] Incorrect shuffle server status ,xianjingfeng,11752250,,,CLOSED,2023-08-25T07:42:29Z,2023-08-28T09:05:37Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When i review the pr #1053, I found two problems:

1. The shuffle server status will be wrong if the server is decommissioning or decommissioned. Let's look at the following code.

https://github.com/apache/incubator-uniffle/blob/9b725f250469798ca603e62a12ec521eb55d9de5/coordinator/src/main/java/org/apache/uniffle/coordinator/SimpleClusterManager.java#L137-L151

2. We can't obtain decommissioning or decommissioned server list from API '/api/server/nodes'

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1173/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1175,https://api.github.com/repos/apache/incubator-uniffle/issues/1175,incubator-uniffle,1869446749,1175,[Improvement] ShuffleServerGrpcNettyClient  sendShuffleData support config maxRetryAttempts ,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2023-08-28T10:10:42Z,2023-09-01T08:57:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

I encountered an error while using the Netty client with the configuration.
```
spark.rss.client.type = GRPC_NETTY
spark.rss.client.retry.max = 50
spark.rss.client.retry.interval.max = 20000
```
But actually, attempt three times in total.

I noticed that the current code only initializes GrpcClient.maxRetryAttempts to a value of 3.

```
23/08/25 18:58:41 WARN [netty-rpc-client-28-2] TransportChannelHandler: Exception in connection from /10.xxx.xx.xx:49999
org.apache.uniffle.io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 3103784960, max: 3113877504)
	at org.apache.uniffle.io.netty.util.internal.PlatformDependent.incrementMemoryCounter(PlatformDependent.java:802)
	at org.apache.uniffle.io.netty.util.internal.PlatformDependent.allocateDirectNoCleaner(PlatformDependent.java:731)
	at org.apache.uniffle.io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:632)
	at org.apache.uniffle.io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:607)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:202)
	at org.apache.uniffle.io.netty.buffer.PoolArena.tcacheAllocateSmall(PoolArena.java:172)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocate(PoolArena.java:134)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocate(PoolArena.java:126)
	at org.apache.uniffle.io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:395)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:188)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:179)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.ioBuffer(AbstractByteBufAllocator.java:140)
	at org.apache.uniffle.io.netty.channel.DefaultMaxMessagesRecvByteBufAllocator$MaxMessageHandle.allocate(DefaultMaxMessagesRecvByteBufAllocator.java:114)
	at org.apache.uniffle.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:150)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
	at org.apache.uniffle.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
	at org.apache.uniffle.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at org.apache.uniffle.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
23/08/25 18:58:41 WARN [netty-rpc-client-28-2] AbstractChannelHandlerContext: An exception 'java.lang.NullPointerException' [enable DEBUG level for full stacktrace] was thrown by a user handler's exceptionCaught() method while handling the following exception:
org.apache.uniffle.io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 3103784960, max: 3113877504)
	at org.apache.uniffle.io.netty.util.internal.PlatformDependent.incrementMemoryCounter(PlatformDependent.java:802)
	at org.apache.uniffle.io.netty.util.internal.PlatformDependent.allocateDirectNoCleaner(PlatformDependent.java:731)
	at org.apache.uniffle.io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:632)
	at org.apache.uniffle.io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:607)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:202)
	at org.apache.uniffle.io.netty.buffer.PoolArena.tcacheAllocateSmall(PoolArena.java:172)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocate(PoolArena.java:134)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocate(PoolArena.java:126)
	at org.apache.uniffle.io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:395)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:188)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:179)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.ioBuffer(AbstractByteBufAllocator.java:140)
	at org.apache.uniffle.io.netty.channel.DefaultMaxMessagesRecvByteBufAllocator$MaxMessageHandle.allocate(DefaultMaxMessagesRecvByteBufAllocator.java:114)
	at org.apache.uniffle.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:150)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
	at org.apache.uniffle.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
	at org.apache.uniffle.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at org.apache.uniffle.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
23/08/25 18:58:41 ERROR [netty-rpc-client-28-2] TransportResponseHandler: Still have 1 requests outstanding when connection from /10.155.96.22:49999 is closed
23/08/25 18:58:41 INFO [pool-6-thread-2] RetryUtils: Retry due to Throwable, org.apache.uniffle.common.exception.RssException java.util.concurrent.ExecutionException: java.io.IOException: Connection from /10.xx.xxx.xx::49999 closed
23/08/25 18:58:41 INFO [pool-6-thread-2] RetryUtils: Waiting 20000 milliseconds before next connection attempt.
23/08/25 18:58:41 INFO [Executor task launch worker for task 1137] ReaderImpl: Reading ORC rows from hdfs://bipxxx05/bip/developer/xx/xxxx/dt=20230825/hm=0030/part-00007-db96623e-a56e-44a4-910c-1d4ad23039e7.c000.snappy.orc with {include: null, offset: 0, length: 41968866, sarg: leaf-0 = (IS_NULL page_type), leaf-1 = (EQUALS page_type page_commodity_detail), leaf-2 = (IS_NULL goods_id), leaf-3 = (EQUALS goods_id -99), leaf-4 = (EQUALS goods_id -999999), expr = (and (not leaf-0) leaf-1 (not leaf-2) (not leaf-3) (not leaf-4)), schema: struct<mid:string,page_type:string,goods_id:bigint,dt:string,hm:string>, includeAcidColumns: true}
23/08/25 18:58:41 WARN [netty-rpc-client-99-2] TransportChannelHandler: Exception in connection from /10.xx.xxx.xx:49999
org.apache.uniffle.io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 3103784960, max: 3113877504)
	at org.apache.uniffle.io.netty.util.internal.PlatformDependent.incrementMemoryCounter(PlatformDependent.java:802)
	at org.apache.uniffle.io.netty.util.internal.PlatformDependent.allocateDirectNoCleaner(PlatformDependent.java:731)
	at org.apache.uniffle.io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:632)
	at org.apache.uniffle.io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:607)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:202)
	at org.apache.uniffle.io.netty.buffer.PoolArena.tcacheAllocateSmall(PoolArena.java:172)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocate(PoolArena.java:134)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocate(PoolArena.java:126)
	at org.apache.uniffle.io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:395)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:188)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:179)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.ioBuffer(AbstractByteBufAllocator.java:140)
	at org.apache.uniffle.io.netty.channel.DefaultMaxMessagesRecvByteBufAllocator$MaxMessageHandle.allocate(DefaultMaxMessagesRecvByteBufAllocator.java:114)
	at org.apache.uniffle.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:150)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
	at org.apache.uniffle.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
	at org.apache.uniffle.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at org.apache.uniffle.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
23/08/25 18:58:41 WARN [netty-rpc-client-99-2] AbstractChannelHandlerContext: An exception 'java.lang.NullPointerException' [enable DEBUG level for full stacktrace] was thrown by a user handler's exceptionCaught() method while handling the following exception:
org.apache.uniffle.io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 3103784960, max: 3113877504)
	at org.apache.uniffle.io.netty.util.internal.PlatformDependent.incrementMemoryCounter(PlatformDependent.java:802)
	at org.apache.uniffle.io.netty.util.internal.PlatformDependent.allocateDirectNoCleaner(PlatformDependent.java:731)
	at org.apache.uniffle.io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:632)
	at org.apache.uniffle.io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:607)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:202)
	at org.apache.uniffle.io.netty.buffer.PoolArena.tcacheAllocateSmall(PoolArena.java:172)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocate(PoolArena.java:134)
	at org.apache.uniffle.io.netty.buffer.PoolArena.allocate(PoolArena.java:126)
	at org.apache.uniffle.io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:395)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:188)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:179)
	at org.apache.uniffle.io.netty.buffer.AbstractByteBufAllocator.ioBuffer(AbstractByteBufAllocator.java:140)
	at org.apache.uniffle.io.netty.channel.DefaultMaxMessagesRecvByteBufAllocator$MaxMessageHandle.allocate(DefaultMaxMessagesRecvByteBufAllocator.java:114)
	at org.apache.uniffle.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:150)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
	at org.apache.uniffle.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
	at org.apache.uniffle.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
	at org.apache.uniffle.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at org.apache.uniffle.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
23/08/25 18:58:41 ERROR [netty-rpc-client-99-2] TransportResponseHandler: Still have 1 requests outstanding when connection from /10.155.93.22:49999 is closed
23/08/25 18:58:41 INFO [pool-6-thread-5] RetryUtils: Retry due to Throwable, org.apache.uniffle.common.exception.RssException java.util.concurrent.ExecutionException: java.io.IOException: Connection from /10.xx.xxx.xx:49999 closed
23/08/25 18:58:41 INFO [pool-6-thread-5] RetryUtils: Waiting 20000 milliseconds before next connection attempt.
23/08/25 18:58:41 WARN [netty-rpc-client-37-2] TransportClient: Failed to send request RPC 1157 to /10.xx.xxx.xx::49999: org.apache.uniffle.io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 3103784960, max: 3113877504), channel will be closed
23/08/25 18:58:41 INFO [pool-6-thread-4] RetryUtils: Retry due to Throwable, org.apache.uniffle.common.exception.RssException java.util.concurrent.ExecutionException: java.io.IOException: Failed to send request RPC 1157 to /10.xx.xxx.xx::49999: org.apache.uniffle.io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 3103784960, max: 3113877504), channel will be closed
23/08/25 18:58:41 INFO [pool-6-thread-4] RetryUtils: Waiting 20000 milliseconds before next connection attempt.
```



### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1175/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1175,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lDj8i,incubator-uniffle,1695432482,1175,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-08-28T10:22:37Z,2023-08-28T10:22:37Z,"another issue arises when sending data via netty and encounters an exception, the channel will be closed. 
however, in the next retry, the closed transportclient will still be used. 
As a result, the execution of the retry will throw an exception similar to this:
```
23/08/25 18:59:01 WARN [netty-rpc-client-28-2] TransportClient: Failed to send request RPC 1281 to /10.xxx.xx.xxx:49999: org.apache.uniffle.io.netty.channel.StacklessClosedChannelException, channel will be closed
23/08/25 18:59:01 INFO [pool-6-thread-2] RetryUtils: Retry due to Throwable, org.apache.uniffle.common.exception.RssException java.util.concurrent.ExecutionException: java.io.IOException: Failed to send request RPC 1281 to /10.XXX.XX.XX:49999: org.apache.uniffle.io.netty.channel.StacklessClosedChannelException, channel will be closed
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lDj8i/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1175,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lDzLq,incubator-uniffle,1695494890,1175,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-28T11:03:19Z,2023-08-28T11:03:19Z,"> another issue arises when sending data via netty and encounters an exception, the channel will be closed. but use the closed transportClient in next retry, so retry execution will throw exception like this: however, in the next retry, the closed transportclient will still be used. As a result, the execution of the retry will throw an exception similar to this:
> 
> ```
> 23/08/25 18:59:01 WARN [netty-rpc-client-28-2] TransportClient: Failed to send request RPC 1281 to /10.155.96.22:49999: org.apache.uniffle.io.netty.channel.StacklessClosedChannelException, channel will be closed
> 23/08/25 18:59:01 INFO [pool-6-thread-2] RetryUtils: Retry due to Throwable, org.apache.uniffle.common.exception.RssException java.util.concurrent.ExecutionException: java.io.IOException: Failed to send request RPC 1281 to /10.XXX.XX.XX:49999: org.apache.uniffle.io.netty.channel.StacklessClosedChannelException, channel will be closed
> ```

Does the Spark have similar issues? What's the Spark's solution?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lDzLq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1175,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lI7-G,incubator-uniffle,1696841606,1175,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-08-29T06:24:56Z,2023-08-29T06:24:56Z,"> > another issue arises when sending data via netty and encounters an exception, the channel will be closed.  however, in the next retry, the closed transportclient will still be used. As a result, the execution of the retry will throw an exception similar to this:
> > ```
> > 23/08/25 18:59:01 WARN [netty-rpc-client-28-2] TransportClient: Failed to send request RPC 1281 to /10.155.96.22:49999: org.apache.uniffle.io.netty.channel.StacklessClosedChannelException, channel will be closed
> > 23/08/25 18:59:01 INFO [pool-6-thread-2] RetryUtils: Retry due to Throwable, org.apache.uniffle.common.exception.RssException java.util.concurrent.ExecutionException: java.io.IOException: Failed to send request RPC 1281 to /10.XXX.XX.XX:49999: org.apache.uniffle.io.netty.channel.StacklessClosedChannelException, channel will be closed
> > ```
> 
> Does the Spark have similar issues? What's the Spark's solution?

I think It's a bug.

```
// shouldn't get transportClient  outside
TransportClient transportClient = getTransportClient();
RetryUtils.retry(
            () -> {
              // should get transportClient in RetryCmd function, spark also use transportClient like this.
             //  getTransportClient() could automatically remove invalid client
              TransportClient transportClient = getTransportClient();
    })
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lI7-G/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1175,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lI8Xa,incubator-uniffle,1696843226,1175,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-29T06:26:36Z,2023-08-29T06:26:36Z,@leixm WDYT?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lI8Xa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1175,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lKs0s,incubator-uniffle,1697303852,1175,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-29T11:59:20Z,2023-08-29T11:59:20Z,"



> > > another issue arises when sending data via netty and encounters an exception, the channel will be closed.  however, in the next retry, the closed transportclient will still be used. As a result, the execution of the retry will throw an exception similar to this:
> > > ```
> > > 23/08/25 18:59:01 WARN [netty-rpc-client-28-2] TransportClient: Failed to send request RPC 1281 to /10.155.96.22:49999: org.apache.uniffle.io.netty.channel.StacklessClosedChannelException, channel will be closed
> > > 23/08/25 18:59:01 INFO [pool-6-thread-2] RetryUtils: Retry due to Throwable, org.apache.uniffle.common.exception.RssException java.util.concurrent.ExecutionException: java.io.IOException: Failed to send request RPC 1281 to /10.XXX.XX.XX:49999: org.apache.uniffle.io.netty.channel.StacklessClosedChannelException, channel will be closed
> > > ```
> > 
> > 
> > Does the Spark have similar issues? What's the Spark's solution?
> 
> I think It's a bug.
> 
> ```
> // shouldn't get transportClient  outside
> TransportClient transportClient = getTransportClient();
> RetryUtils.retry(
>             () -> {
>               // should get transportClient in RetryCmd function, spark also use transportClient like this.
>              //  getTransportClient() could automatically remove invalid client
>               TransportClient transportClient = getTransportClient();
>     })
> ```

Make sense. Could you create a pr for this issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lKs0s/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1177,https://api.github.com/repos/apache/incubator-uniffle/issues/1177,incubator-uniffle,1871004607,1177,[Improvement] Reduce the write time,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-08-29T06:50:38Z,2023-08-31T02:05:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We use the `SEND_CHECK_INTERVAL` to check the blocks whether finished. Although we send small data, we will still use 500ms to wait.

### How should we improve?

We add the event `FinishBlockEvent`. We post the event to a blocking queue. When we finish sending data, we will create a new event and add the event to the queue. We will poll the `FinishBlockEvent` from the queue instead of waiting for 500ms.
like 
```
queue = new BlockingQueue();
Event event = queue.poll(500, TimeUnit.MS);
```

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1177/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1177,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lJCsI,incubator-uniffle,1696869128,1177,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-29T06:51:07Z,2023-08-29T06:51:07Z,"If no one have interest on this issue, I will create a pr for this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lJCsI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1178,https://api.github.com/repos/apache/incubator-uniffle/issues/1178,incubator-uniffle,1871026583,1178,[Bug] suggest COORDINATOR_QUOTA_DEFAULT_APP_NUM turned off by default,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2023-08-29T07:05:02Z,2023-09-04T16:43:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

coordinator start with default value same application will Fail to access cluster.
I suggest to turn off this quota by default

```
[2023-08-29 14:34:08.267] [WARN] [main] [org.apache.spark.shuffle.DelegationRssShuffleManager] >>> Fail to access cluster Coordinator grpc client ref to xxx:29999 using etl_spark for Request to access cluster Coordinator grpc client ref to xxx:29999 is denied using etl_spark for Denied by AccessQuotaChecker => User: u_dw, current app num is: 6, default app num is: 5. We will reject this app[uuid=897411780-5229].
[2023-08-29 14:34:08.277] [WARN] [main] [org.apache.spark.shuffle.DelegationRssShuffleManager] >>> Fail to access cluster Coordinator grpc client ref to xxxx:29999 using etl_spark for Request to access cluster Coordinator grpc client ref to xxxx:29999 is denied using etl_spark for Denied by AccessQuotaChecker => User: user1, current app num is: 7, default app num is: 5. We will 
.....
[2023-08-29 14:34:31.736] [WARN] [main] [org.apache.spark.deploy.yarn.Client] >>> Application report for application_1693203805432_17544 (state: ACCEPTED)
[2023-08-29 14:34:32.737] [WARN] [main] [org.apache.spark.deploy.yarn.Client] >>> Application report for application_1693203805432_17544 (state: ACCEPTED)
[2023-08-29 14:34:33.738] [WARN] [main] [org.apache.spark.deploy.yarn.Client] >>> Application report for application_1693203805432_17544 (state: ACCEPTED)
[2023-08-29 14:34:34.740] [WARN] [main] [org.apache.spark.deploy.yarn.Client] >>> Application report for application_1693203805432_17544 (state: RUNNING)
[2023-08-29 14:34:34.740] [WARN] [main] [org.apache.spark.deploy.yarn.Client] >>>
client token: Token { kind: YARN_CLIENT_TOKEN, service: }
diagnostics: N/A
ApplicationMaster RPC port: -1
final status: UNDEFINED
tracking URL: http://xxx:8042/proxy/application_1693203805432_17544/
user: u_dw
[2023-08-29 14:34:35.567] [ERROR] [main] [org.apache.spark.SparkContext] >>> Error initializing SparkContext.
org.apache.spark.SparkException: Dynamic allocation of executors requires the external shuffle service. You may enable this through spark.shuffle.service.enabled.
```


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1178/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1178,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lJYt7,incubator-uniffle,1696959355,1178,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-08-29T08:01:33Z,2023-08-29T08:01:33Z,@smallzhongfeng WDYT? I'm ok.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lJYt7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1178,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lcxUr,incubator-uniffle,1702040875,1178,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-09-01T02:41:09Z,2023-09-01T02:41:09Z,"> @smallzhongfeng WDYT? I'm ok.

Of course no problem, or we can make the default value bigger? @xumanbu 


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lcxUr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1178,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5leGhb,incubator-uniffle,1702389851,1178,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-09-01T08:43:37Z,2023-09-01T08:43:37Z,"> > @smallzhongfeng WDYT? I'm ok.
> 
> Of course no problem, or we can make the default value bigger? @xumanbu

make a larger value as the default is ok.
other way, we can set the default value as -1 to indicate no quota check.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5leGhb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1178,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5leLe5,incubator-uniffle,1702410169,1178,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-09-01T08:58:31Z,2023-09-01T08:58:31Z,"> > > @smallzhongfeng WDYT? I'm ok.
> > 
> > 
> > Of course no problem, or we can make the default value bigger? @xumanbu
> 
> make a larger value as the default is ok. other way, we can set the default value as -1 to indicate no quota check.

It's ok for me to set the default value as -1. Could you raise a pr for this issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5leLe5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1178,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5leTvK,incubator-uniffle,1702443978,1178,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-09-01T09:23:22Z,2023-09-01T09:23:22Z,"> make a larger value as the default is ok. other way, we can set the default value as -1 to indicate no quota check.

+1 for this change!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5leTvK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1178,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5legyp,incubator-uniffle,1702497449,1178,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-09-01T10:01:21Z,2023-09-01T10:01:21Z,"> > > > @smallzhongfeng WDYT? I'm ok.
> > > 
> > > 
> > > Of course no problem, or we can make the default value bigger? @xumanbu
> > 
> > 
> > make a larger value as the default is ok. other way, we can set the default value as -1 to indicate no quota check.
> 
> It's ok for me to set the default value as -1. Could you raise a pr for this issue?

ok","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5legyp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1182,https://api.github.com/repos/apache/incubator-uniffle/issues/1182,incubator-uniffle,1875129532,1182,[Bug] [k8s] The LeaderElectionNamespace of the rss-controller is hard-coded to kube-system.,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2023-08-31T09:21:59Z,2023-09-03T04:34:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The LeaderElectionNamespace of the rss-controller is hard-coded to kube-system. When we attempt to create multiple Uniffle clusters in different namespaces within the same Kubernetes cluster, conflicts may arise.
```
I0831 07:24:40.147203       1 leaderelection.go:352] lock is held by rss-controller-64df7df9fd-k2g49_153e6f91-4d42-4bc5-b6c1-774467406a4e and has not yet expired
I0831 07:24:40.147234       1 leaderelection.go:253] failed to acquire lease kube-system/rss-controller-uniffle.apache.org
```




### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1182/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1187,https://api.github.com/repos/apache/incubator-uniffle/issues/1187,incubator-uniffle,1879777987,1187,[Improvement] Netty Encoder Support zero-copy.,leixm,31424839,Xianming Lei,,CLOSED,2023-09-04T08:30:21Z,2023-11-26T07:03:55Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, MessageEncoder does not support zero-copy. We can refer to the implementation of spark to make MessageEncoder support zero-copy.

### How should we improve?

https://github.com/apache/spark/blob/master/common/network-common/src/main/java/org/apache/spark/network/protocol/MessageEncoder

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1187/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1187,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lnc_b,incubator-uniffle,1704841179,1187,NA,leixm,31424839,Xianming Lei,,NA,2023-09-04T08:32:09Z,2023-09-04T08:32:09Z,cc @pegasas .,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lnc_b/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1187,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lnlhC,incubator-uniffle,1704876098,1187,NA,pegasas,13224827,John Huang,pegasashjy@gmail.com,NA,2023-09-04T08:55:54Z,2023-09-04T08:55:54Z,"Ack.
Following this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5lnlhC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1188,https://api.github.com/repos/apache/incubator-uniffle/issues/1188,incubator-uniffle,1879783697,1188,[Improvement] Netty Support getLocalShuffleData and getMemoryShuffleData.,leixm,31424839,Xianming Lei,,CLOSED,2023-09-04T08:33:52Z,2024-06-19T12:48:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

At present, only sendShuffleData uses netty. The three interfaces getLocalShuffleData, getMemoryShuffleData, and getLocalShuffleIndex all support netty, but they have not been enabled yet.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1188/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1188,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mzbaO,incubator-uniffle,1724757646,1188,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-09-19T02:53:31Z,2023-09-19T02:53:31Z,any update on this? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mzbaO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1188,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6B21TK,incubator-uniffle,2178634954,1188,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-19T12:48:48Z,2024-06-19T12:48:48Z,I think we already support this. Closed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6B21TK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1189,https://api.github.com/repos/apache/incubator-uniffle/issues/1189,incubator-uniffle,1885400030,1189,[Improvement] ShuffleServer add Direct Memory Metric for monitor,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-09-07T08:44:17Z,2023-12-17T15:35:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Add metric to monit Direct Memory。

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1189/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1189,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mNrVq,incubator-uniffle,1714861418,1189,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-09-12T02:13:38Z,2023-09-12T02:13:38Z,"Can this metric, `jvm_buffer_pool_used_bytes{pool=""direct""}`, be used to monitor direct memory?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mNrVq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1189,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uymqQ,incubator-uniffle,1858759312,1189,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-16T08:19:36Z,2023-12-16T08:19:36Z,Merged #1363,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uymqQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1189,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u0TAx,incubator-uniffle,1859203121,1189,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-12-17T15:32:00Z,2023-12-17T15:32:00Z,"> Can this metric, `jvm_buffer_pool_used_bytes{pool=""direct""}`, be used to monitor direct memory?

https://github.com/apache/incubator-uniffle/pull/1363#discussion_r1423348080","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u0TAx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1192,https://api.github.com/repos/apache/incubator-uniffle/issues/1192,incubator-uniffle,1891595189,1192,[Improvement] Support configurable for storing shuffle data to a secured HDFS cluster by a spark job user,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2023-09-12T03:18:31Z,2023-09-13T11:49:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Storing shuffle data to secured HDFS cluster by spark job user's at now. 
but if we use split kerberos user by component, uniffle will have a independent user, all shuffle data will storing by uniffle user.

therefore, I suggest the user for storing shuffle data is configurable, getting user from ugi in client or get user in spark config.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1192/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1192,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mN1dj,incubator-uniffle,1714902883,1192,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-09-12T03:19:04Z,2023-09-12T03:19:04Z,@jerqi  @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mN1dj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1192,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mN135,incubator-uniffle,1714904569,1192,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-09-12T03:21:53Z,2023-09-12T03:21:53Z,"> @jerqi @zuston

Make sense,  could you raise a pr?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mN135/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1192,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mN5Yb,incubator-uniffle,1714918939,1192,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-09-12T03:48:07Z,2023-09-12T03:48:07Z,"> > @jerqi @zuston
> 
> Make sense, could you raise a pr?

ok，I think about how to achieve it better, is the config on the client or on the server. the application user also used in quota check. how do u think?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mN5Yb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1192,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mO2Qj,incubator-uniffle,1715168291,1192,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-09-12T07:39:50Z,2023-09-12T07:39:50Z,"> > > @jerqi @zuston
> > 
> > 
> > Make sense, could you raise a pr?
> 
> ok，I think about how to achieve it better, is the config on the client or on the server. the application user also used in quota check. how do u think?

I think it's a server's config option. The user of client can be used for the quota check. THe user of server can be used to write data to the HDFS.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mO2Qj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1196,https://api.github.com/repos/apache/incubator-uniffle/issues/1196,incubator-uniffle,1895777112,1196,[Improvement] `rss.client.assignment.shuffle.nodes.max` should not be less than `rss.data.replica`,xianjingfeng,11752250,,,OPEN,2023-09-14T06:06:50Z,2024-02-08T03:56:55Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For current assignment strategy, if `rss.client.assignment.shuffle.nodes.max` less than `rss.data.replica`,  the duplicate shuffle server will be included in the replicas. 

### How should we improve?

Check if `rss.client.assignment.shuffle.nodes.max` less than `rss.data.replica` in the client side.
We can modify the following method.

https://github.com/apache/incubator-uniffle/blob/10e8e3d2eb553146d9729e5dac2bde20f71c3358/common/src/main/java/org/apache/uniffle/common/util/RssUtils.java#L310C22-L319

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1196/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1196,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zPDBQ,incubator-uniffle,1933324368,1196,NA,somelovelanguage,47029491,Yiqi You,,NA,2024-02-08T03:56:55Z,2024-02-08T03:56:55Z,"Kindly to ask if there is somebody working for this issue？ If not, i'm glad to undertake it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zPDBQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1198,https://api.github.com/repos/apache/incubator-uniffle/issues/1198,incubator-uniffle,1898063061,1198,[Improvement] zerocopy from Protobuf's ByteString to Netty's ByteBuf ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-09-15T09:33:24Z,2023-09-16T11:11:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

zerocopy from Protobuf's ByteString to Netty's ByteBuf like https://github.com/netty/netty/discussions/13605 did

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1198/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1201,https://api.github.com/repos/apache/incubator-uniffle/issues/1201,incubator-uniffle,1900406162,1201,[Improvement] only invoking LOG.debug when `LOG.isDebugEnabled()` is true,xianjingfeng,11752250,,,CLOSED,2023-09-18T08:14:55Z,2023-10-08T02:10:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently in part of the code,  `LOG.debug` was invoked without deciding if `LOG.isDebugEnabled()` is true, which will have an impact on performance.

### How should we improve?

Only invoking `LOG.debug` when `LOG.isDebugEnabled()` is true.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1201/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1201,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ms8CJ,incubator-uniffle,1723056265,1201,NA,misselvexu,3436472,o'Laoxu,iskp.me@gmail.com,NA,2023-09-18T09:31:54Z,2023-09-18T09:31:54Z,/assigne to me ?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ms8CJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1201,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mtUWd,incubator-uniffle,1723155869,1201,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-09-18T10:40:47Z,2023-09-18T10:40:47Z,"> /assigne to me ?

@misselvexu Thanks.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5mtUWd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1202,https://api.github.com/repos/apache/incubator-uniffle/issues/1202,incubator-uniffle,1906925396,1202,[Improvement] HealthScriptChecker support,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2023-09-21T13:02:03Z,2023-09-22T11:34:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

add a HealthScriptChecker  to support executor a special shell script to checker server node is healthy. it's configable by `rss.server.health.checker.class.names=org.apache.uniffle.server.HealthScriptChecker`

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1202/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1204,https://api.github.com/repos/apache/incubator-uniffle/issues/1204,incubator-uniffle,1909747118,1204,[Bug]  Fix the ci pipeline of Kubernetes,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2023-09-23T07:10:53Z,2023-09-23T10:26:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The ci pipeline use the latest revive package. But the version v1.3.4 will cause the failure of CI. So I use the older version package to pass the CI pipeline

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1204/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1206,https://api.github.com/repos/apache/incubator-uniffle/issues/1206,incubator-uniffle,1909841861,1206,[FEATURE] Introduce rust based shuffle server for uniffle,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-09-23T11:51:59Z,2023-11-07T07:12:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

I have implemented riffle (https://github.com/zuston/riffle), it's time to contribute back to uniffle community.

And the before discussion is here https://github.com/apache/incubator-uniffle/discussions/953

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1206/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1209,https://api.github.com/repos/apache/incubator-uniffle/issues/1209,incubator-uniffle,1910068116,1209,[Improvement] Optimize cleanupStorageSelectionCache method in LocalStorageManager.,zhuyaogai,18461102,Fantasy-Jay,,CLOSED,2023-09-24T02:37:10Z,2023-10-31T02:49:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Assuming there are 500 running APPs, each APP has an average of 10 shuffleIds, and each shuffleId has 1000 partitions, then the size of partitionsOfStorage in LocalStorageManager is about 5000000. The cleanupStorageSelectionCache method can take 500ms on average (sometimes it took a longer time when the size of partitionsOfStorage is larger). So it should be optimized.

Also assuming we complete 10,000 APPs in a day, if we use the AppPurgeEvent event to release resources, it would take approximately 10,000 * 500ms = 5000s. But if we use the ShufflePurgeEvent event to release resources, then it would take 10,000 * 500ms * 10 = 50,000s, which is quite crazy.

### How should we improve?

1. Optimize cleanupStorageSelectionCache method in LocalStorageManager.
2. Fix bug when release resource using ShufflePurgeEvent event.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1209/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1209,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qeZfm,incubator-uniffle,1786353638,1209,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-10-31T02:49:20Z,2023-10-31T02:49:20Z,Good Catch. I find the same problom.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qeZfm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1211,https://api.github.com/repos/apache/incubator-uniffle/issues/1211,incubator-uniffle,1910090884,1211,[Bug] Unexpectedly removing resources even though the App has re-registered shuffle later.,zhuyaogai,18461102,Fantasy-Jay,,CLOSED,2023-09-24T04:43:00Z,2023-09-27T09:12:37Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Suppose in such a scenario, App is expired due to no heartbeat, so it was added to expired queue and will be removed resources soon. Also At this moment, this app re-registers shuffle. But after re-registering shuffle, the app was removed resources. The following requireBuffer will appear NO_REGISTERED...

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1211/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nRFEo,incubator-uniffle,1732530472,1211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-09-24T09:31:04Z,2023-09-24T09:31:04Z,"Once the app is marked as unregistered, I think it's acceptable to reject. WDYT? @zhuyaogai ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nRFEo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nRSi4,incubator-uniffle,1732585656,1211,NA,zhuyaogai,18461102,Fantasy-Jay,,NA,2023-09-24T14:29:14Z,2023-09-24T14:29:14Z,"@zuston hi, I don't think so. Let's assume this scenario, there are multi stages(DAGs) in an application. If stage1 requires `ShuffleServer1`, but stage2 does not require `ShuffleServer1`, so the resources of `ShuffleServer1` will be released after stage1 ends. Due to no heartbeat, `ShuffleServer1` will add the application to the expired queue and wait for the resources to be released, but `ShuffleServer1` was required again in stage3, then some unexpected problems will occur. But we know that the application is still in progress.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nRSi4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nSTlU,incubator-uniffle,1732852052,1211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-09-25T03:35:09Z,2023-09-25T03:35:09Z,The heartbeat of app with one shuffle-server also will happen in spark driver side. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nSTlU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nZbh_,incubator-uniffle,1734719615,1211,NA,zhuyaogai,18461102,Fantasy-Jay,,NA,2023-09-26T02:08:16Z,2023-09-26T02:08:16Z,"@zuston If we remove resources after per stage, we use `ShuffleWriteClientImpl#unregisterShuffle` method which will finally remove related shuffle servers. 
https://github.com/apache/incubator-uniffle/blob/b4adaa50b7474330ed7723bba3976e090b8bd022/client/src/main/java/org/apache/uniffle/client/impl/ShuffleWriteClientImpl.java#L994
So there is no heartbeat anymore.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nZbh_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nZdPn,incubator-uniffle,1734726631,1211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-09-26T02:20:07Z,2023-09-26T02:20:07Z,"> @zuston If we remove resources after per stage, we use `ShuffleWriteClientImpl#unregisterShuffle` method which will finally remove related shuffle servers.
> 
> https://github.com/apache/incubator-uniffle/blob/b4adaa50b7474330ed7723bba3976e090b8bd022/client/src/main/java/org/apache/uniffle/client/impl/ShuffleWriteClientImpl.java#L994
> 
> 
> So there is no heartbeat anymore.

I think this is right, if the operation of unregister is triggered by spark, it means the data will not be used in the future, the removal is right. Feel free to tell me if I'm wrong.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nZdPn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nZhEw,incubator-uniffle,1734742320,1211,NA,zhuyaogai,18461102,Fantasy-Jay,,NA,2023-09-26T02:43:06Z,2023-09-26T02:43:06Z,"> @zuston hi, I don't think so. Let's assume this scenario, there are multi stages(DAGs) in an application. If stage1 requires `ShuffleServer1`, but stage2 does not require `ShuffleServer1`, so the resources of `ShuffleServer1` will be released after stage1 ends. Due to no heartbeat, `ShuffleServer1` will add the application to the expired queue and wait for the resources to be released, but `ShuffleServer1` was required again in stage3, then some unexpected problems will occur. But we know that the application is still in progress.

Let's assume this scenario, there are multi DAGs in a tez application(DAG is executed serially one after another). If DAG1 requires `ShuffleServer1`, but DAG2 does not require `ShuffleServer1`, so the resources of `ShuffleServer1` will be released after DAG1 ends. Due to no heartbeat anymore, `ShuffleServer1` will add the application to the expired queue and wait for the resources to be released, but `ShuffleServer1` was required again in DAG3. We assume the following execution sequence.
1. In DAG2, due to no heartbeat anymore, `ShuffleServer1` will add the application to the expired queue, but we know the `clearResourceThread` thread releases resources serially. If the queue is relatively large, it need to wait for a while.
2. In DAG3, the `ShuffleServer1` is required again which will invoke `ShuffleTaskManager#registerShuffle` method.
3. The `clearResourceThread` thread releases application resources.
4. In DAG3, shuffle client will require buffer by invoking `ShuffleTaskManager#requireBuffer` in `ShuffleServer1`, but it just return `NO_REGISTER` status code...

But we know that the application is still in progress.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nZhEw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1211,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nZjHs,incubator-uniffle,1734750700,1211,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-09-26T02:56:40Z,2023-09-26T02:56:40Z,Thanks for your patient explanation @zhuyaogai 👍，got your point and make sense.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5nZjHs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1213,https://api.github.com/repos/apache/incubator-uniffle/issues/1213,incubator-uniffle,1910171020,1213,[FEATURE][RUST] Support blockId filter when getting data from memory,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-09-24T09:38:37Z,2023-11-22T07:12:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support blockId filter when getting data from memory, this will improve the performance for Spark AQE

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1213/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1213,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rNarl,incubator-uniffle,1798679269,1213,NA,wenlongbrother,50658515,,,NA,2023-11-07T14:38:34Z,2023-11-07T14:38:34Z,"Hi @zuston I am interested in this task, can you assign it to me?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rNarl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1214,https://api.github.com/repos/apache/incubator-uniffle/issues/1214,incubator-uniffle,1910180963,1214,[FEATURE][RUST] Require memory from unified memory pool when reading data,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-09-24T10:13:39Z,2023-11-07T22:53:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Before writing data into server, the memory allocation is needed. 

So require memory from unified memory pool when reading data should be supported for limited memory used.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1214/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1214,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rNahh,incubator-uniffle,1798678625,1214,NA,wenlongbrother,50658515,,,NA,2023-11-07T14:38:18Z,2023-11-07T14:38:18Z,"Hi @zuston I am interested in this task, can you assign it to me?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rNahh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1215,https://api.github.com/repos/apache/incubator-uniffle/issues/1215,incubator-uniffle,1912563131,1215,[Improvement][rust] Set the default value for config key in toml,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-09-26T02:23:14Z,2023-10-08T01:27:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the optional value of conf key is scattered everywhere, we should set the default value if it is not shown in toml config file.

Refer: https://github.com/serde-rs/serde/issues/725

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1215/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1215,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5oa2vH,incubator-uniffle,1751870407,1215,NA,A-Stupid-Sun,48410497,,,NA,2023-10-08T00:06:42Z,2023-10-08T00:06:42Z,"hi @zuston i am new here, let me have a try","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5oa2vH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1215,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5oa6Y_,incubator-uniffle,1751885375,1215,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-08T01:27:51Z,2023-10-08T01:27:51Z,"> hi @zuston i am new here, let me have a try

Thanks. Assigned","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5oa6Y_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1219,https://api.github.com/repos/apache/incubator-uniffle/issues/1219,incubator-uniffle,1913300950,1219,[Flaky Test] WriteAndReadMetricsTest,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-09-26T11:27:21Z,2023-10-16T01:52:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.uniffle.test.WriteAndReadMetricsTest
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 31.023 s <<< FAILURE! - in org.apache.uniffle.test.WriteAndReadMetricsTest
Error:  test  Time elapsed: 28.209 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <55> but was: <54>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:182)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:177)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:1141)
	at org.apache.uniffle.test.SparkIntegrationTestBase.verifyTestResult(SparkIntegrationTestBase.java:128)
	at org.apache.uniffle.test.SparkIntegrationTestBase.run(SparkIntegrationTestBase.java:67)
	at org.apache.uniffle.test.WriteAndReadMetricsTest.test(WriteAndReadMetricsTest.java:40)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/6311740658/job/17136352841?pr=1218

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1219/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1219,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pHoAN,incubator-uniffle,1763606541,1219,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-16T01:52:09Z,2023-10-16T01:52:09Z,fix by #1235 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pHoAN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1220,https://api.github.com/repos/apache/incubator-uniffle/issues/1220,incubator-uniffle,1915038616,1220,[Flaky Test] ShuffleTaskInfoTest#hugePartitionTest,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-09-27T09:02:15Z,2023-09-27T09:02:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

ShuffleTaskInfoTest#hugePartitionTest

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/6288119881/job/17073292482?pr=1212

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1220/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1221,https://api.github.com/repos/apache/incubator-uniffle/issues/1221,incubator-uniffle,1915048956,1221,[FEATURE] support graceful shutdown for grpc server ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-09-27T09:08:17Z,2023-11-24T07:21:52Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Refer to: https://github.com/hyperium/tonic/pull/169

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1221/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1221,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvJ6l,incubator-uniffle,1773969061,1221,NA,wenlongbrother,50658515,,,NA,2023-10-22T01:52:13Z,2023-10-22T01:52:13Z,"Hi @zuston I am the fresher regarding rust, can I try to this task if no one is interested?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvJ6l/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1221,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvMyE,incubator-uniffle,1773980804,1221,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-10-22T03:17:54Z,2023-10-22T03:17:54Z,@wenlongbrother assigned to you.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvMyE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1221,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qy_W2,incubator-uniffle,1791751606,1221,NA,wenlongbrother,50658515,,,NA,2023-11-03T00:47:49Z,2023-11-03T00:47:49Z,"Hi @jerqi here is pr #1292, could you please take a look? Thanks","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qy_W2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,incubator-uniffle,1915052488,1222,[FEATURE] Add the integration with existing Spark tests on rust based server ,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-09-27T09:10:09Z,2024-01-24T13:04:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We should create the mini rust server to integrate with existing spark tests.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1222/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2OLu,incubator-uniffle,1809375982,1222,NA,guixiaowen,58287738,,,NA,2023-11-14T01:01:47Z,2023-11-14T01:01:47Z,"@zuston i am new here, let me have a try

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2OLu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sywmz,incubator-uniffle,1825245619,1222,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-24T07:23:13Z,2023-11-24T07:23:13Z,I think this is a big change. Are you interested on this? @wenlongbrother ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sywmz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s0WPT,incubator-uniffle,1825661907,1222,NA,wenlongbrother,50658515,,,NA,2023-11-24T13:14:27Z,2023-11-24T13:14:27Z,"Hi @zuston I am interested this task and I think  it can help me have much deeper understanding of the whole project. 
Before start this task, here is my understanding of the task the content of this task: our goal is to create a mini rust server to successfully integrate with tests which under the integration-test dictionary. By the way, if we create rust server, do we need to keep the original Java server?
Please correct me If I am wrong, Thanks.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s0WPT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s5h_4,incubator-uniffle,1827020792,1222,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-27T02:10:45Z,2023-11-27T02:10:45Z,I hope the mini rust based shuffle-server could be tested with the existing integration tests. But this part could be involved in the independent module rather than former intergated-test module.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s5h_4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s7lYM,incubator-uniffle,1827558924,1222,NA,wenlongbrother,50658515,,,NA,2023-11-27T10:27:44Z,2023-11-27T10:27:44Z,"@zuston  thanks. Can you assign it to me?
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s7lYM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tA6GF,incubator-uniffle,1828954501,1222,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-28T02:19:17Z,2023-11-28T02:19:17Z,Do you have time to do this? @guixiaowen ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tA6GF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tEb79,incubator-uniffle,1829879549,1222,NA,wenlongbrother,50658515,,,NA,2023-11-28T13:46:38Z,2023-11-28T13:46:38Z,"Hi @zuston do we have a default config.toml which contains basic config about shuffle server, I will use Java to start rust program. If not I will create a default one and place it in the resource directory.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tEb79/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tEhP8,incubator-uniffle,1829901308,1222,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-28T13:59:23Z,2023-11-28T13:59:23Z,"> Hi @zuston do we have a default config.toml which contains basic config about shuffle server, I will use Java to start rust program. If not I will create a default one and place it in the resource directory.

Haven't. I recommend drafting a initial implementation and then discuss it based on this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tEhP8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tI30X,incubator-uniffle,1831042327,1222,NA,wenlongbrother,50658515,,,NA,2023-11-29T01:21:58Z,2023-11-29T01:21:58Z,"> > Hi @zuston do we have a default config.toml which contains basic config about shuffle server, I will use Java to start rust program. If not I will create a default one and place it in the resource directory.
> 
> Haven't. I recommend drafting a initial implementation and then discuss it based on this.

ok","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tI30X/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wjSlL,incubator-uniffle,1888299339,1222,NA,wenlongbrother,50658515,,,NA,2024-01-12T02:05:14Z,2024-01-12T02:05:14Z,"Still pending, will finish it recent days, just take examination in past serval days.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wjSlL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wtdT0,incubator-uniffle,1890964724,1222,NA,wenlongbrother,50658515,,,NA,2024-01-14T14:14:37Z,2024-01-14T14:14:37Z,"Hi @zuston , I am writing **sendDataAndRequireBufferTest**, here is  a quick question why we set partition_id = 1, like below code
```rust
async fn require_buffer(
        &self,
        request: Request<RequireBufferRequest>,
    ) -> Result<Response<RequireBufferResponse>, Status> {
        let timer = GRPC_BUFFER_REQUIRE_PROCESS_TIME.start_timer();
        let req = request.into_inner();
        let app_id = req.app_id;
        let shuffle_id = req.shuffle_id;

        let app = self.app_manager_ref.get_app(&app_id);
        if app.is_none() {
            return Ok(Response::new(RequireBufferResponse {
                require_buffer_id: 0,
                status: StatusCode::NO_REGISTER.into(),
                ret_msg: ""No such app in this shuffle server"".to_string(),
            }));
        }

        let partition_id = PartitionedUId {
            app_id,
            shuffle_id,
            // why?
            // ignore this.
            partition_id: 1,
        };
        let app = app
            .unwrap()
            .require_buffer(RequireBufferContext {
                uid: partition_id.clone(),
                size: req.require_size as i64,
            })
            .instrument_await(format!(""require buffer. uid: {:?}"", &partition_id))
            .await;

        let res = match app {
            Ok(required_buffer_res) => (
                StatusCode::SUCCESS,
                required_buffer_res.ticket_id,
                """".to_string(),
            ),
            Err(err) => (StatusCode::NO_BUFFER, -1i64, format!(""{:?}"", err)),
        };

        timer.observe_duration();

        Ok(Response::new(RequireBufferResponse {
            require_buffer_id: res.1,
            status: res.0.into(),
            ret_msg: res.2,
        }))
    }
```
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wtdT0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wulWr,incubator-uniffle,1891259819,1222,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-15T03:50:28Z,2024-01-15T03:50:28Z,"The `partitionId` in RequireBufferContext won't be used in the process of requiring buffer, which is only a placeholder. Please ignore this @wenlongbrother ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wulWr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xawRw,incubator-uniffle,1902838896,1222,NA,wenlongbrother,50658515,,,NA,2024-01-22T00:55:02Z,2024-01-22T00:55:02Z,"Hi @zuston  A follow question, I see below code will log **partition_id**, do you think it will confuses user?
<img width=""872"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/50658515/7843110b-b46a-4e28-a1e8-992c27046ae0"">
<img width=""1143"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/50658515/3eb0d0e2-ca83-4e04-965f-2ae2fe3287e2"">","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xawRw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1222,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xuwrk,incubator-uniffle,1908083428,1222,NA,wenlongbrother,50658515,,,NA,2024-01-24T13:04:11Z,2024-01-24T13:04:11Z,"Hi @zuston , can you please help review this draft pr? https://github.com/apache/incubator-uniffle/pull/1481 I am still in progress, and I wonder does this meet expectation.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xuwrk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1231,https://api.github.com/repos/apache/incubator-uniffle/issues/1231,incubator-uniffle,1939738037,1231,[FEATURE] [TEZ] Support remote spill in merge stage.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-10-12T10:57:49Z,2023-10-19T15:04:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In a cloud scenario, the storage of the machine that performs the job is very small. The merge phase often uses disk. The remote spill allows remote shuffle service job to use as little disk as possible.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1231/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1234,https://api.github.com/repos/apache/incubator-uniffle/issues/1234,incubator-uniffle,1941538901,1234,[Improvement] separate runtimes for different overload ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-10-13T08:58:00Z,2023-10-16T02:04:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

separate runtimes for different overload for better stability

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1234/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1237,https://api.github.com/repos/apache/incubator-uniffle/issues/1237,incubator-uniffle,1944209897,1237,[FEATURE] support populating args by clap,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-10-16T02:11:26Z,2023-10-17T01:34:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the config path is specified by the environment key, which is not elegant.



### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1237/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1238,https://api.github.com/repos/apache/incubator-uniffle/issues/1238,incubator-uniffle,1944343136,1238,[Improvement] Support combine operation in map stage.,zhengchenyu,10381583,zhengchenyu,,OPEN,2023-10-16T04:41:56Z,2023-10-26T07:56:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When map send buffer to shuffle server,  we could reduce data transmission as much as possible through combine operations.

Because most data may be aggregated in the shuffle server, only part of the data can be combined on the map side. , so the proportion of merge may not be very high.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1238/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1238,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qIdF6,incubator-uniffle,1780601210,1238,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-26T07:56:04Z,2023-10-26T07:56:04Z,"Good idea. The combine could be supported on the different computing frameworks, like Spark/Tez/MR , right?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qIdF6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1239,https://api.github.com/repos/apache/incubator-uniffle/issues/1239,incubator-uniffle,1944350896,1239,[Umbrella] Remote merge on the shuffle server side.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-10-16T04:50:39Z,2024-10-28T02:25:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Some RSS jobs may run on low-storage machines, and we want to avoid using local disk as much as possible.
In fact, the merge process in the shuffle phase uses more local disks.
There are two ways to solve this problem:

1. Spill to merged data to remote file system.
2. Merge on the shuffle server side.

This issue will describe the second proposal.

### Task list

TODO:

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1239/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qId9z,incubator-uniffle,1780604787,1239,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-26T07:58:30Z,2023-10-26T07:58:30Z,"This optimization also could be applied on Spark. One concern is that whether it will put more pressure on shuffle-server, like IO/cpu ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qId9z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vahWF,incubator-uniffle,1869223301,1239,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-12-26T03:20:59Z,2023-12-26T03:20:59Z,"
# 1 Default shuffle

> Note: The first chapter briefly introduces the principle of default shuffle, with the purpose of find where local disks are used, then design remote merge. If you know enough, you can ignore this part.

We will analyze the shuffle of MapReduce, Tez, and Spark in turn.

## 1.1 MapReduce

Map writes the record to the memory. When the memory exceeds the threshold, the memory data is spilled to the disk file, and the Record is written to the disk file in order of partitionid+key. After Map has processed all records, it will spill the data currently in memory to a disk file. Then read all the files spilled to the disk and merge them in the order of partitionid+key to get the sorted Records.

> Note: The purpose of sorting according to partitionid is that when the Reduce side obtains the data from the Map side, it should be read as sequentially as possible. For MR, Tez, and Spark, regardless of whether they are sorted or not, as long as there are partitioned, they need to be sorted according to partitionid.

The reduce will pull the records of the corresponding partition remotely or locally from the Map, which is called MapOutput. Under normal circumstances, the memory will be used directly. If the memory exceeds the threshold, these records will be written to the disk. Then the reduce will perform merge operations on MapOutputs using minimum heap K-way merge sorting to obtain globally sorted records. During the Merge process, temporary results may be spilled to disk because the memory exceeds the threshold. In addition, if there are too many files spilled to disk, additional merges will be triggered.

## 1.2 Tez

There are two cases of tez: (1) ordered io  (2) unordered io.

Ordered io is the same as MapReduce and so ignore it here.

Unordered io is generally used in hashjoin and other situations where keys are not required for sorting. Non-sorted io adopts a ready-to-use solution. Map writes the Record directly to the file or writes it to the file through cache. The Reduce side can also read and use it when reading data.

## 1.3 Spark

Spark's shuffle is more complex and more reasonable. Some tasks do not require sort and combine, so spark users can determine the shuffle logic according to their needs.

### 1.3.1 Shuffle write operation
When writing shuffle data, three writers are supported:

* (1) BypassMergeSortShuffleWriter

A temporary file is generated for each partition. When writing record, find the corresponding partition and write it directly to the corresponding temporary file. Then when all data is processed, these temporary files are written to a final file in order of the partitions, and the temporary files are deleted.

* (2) UnsafeShuffleWriter

UnsafeShuffleWriter mainly implements specific logic through ShuffleExternalSorter. When writing a Record, the serialization operation is performed directly and the serialized bytes are copied to the requested memory. At the same time, the address and partition of the record will also be recorded into the memory (inMemSorter).

When the memory reaches the threshold, spill operation will be performed. Based on the information in memory (inMemSorter), we can easily get a Record sorted by partition and write it to a file.

When all Records are processed, we will spill the records currently in memory into the file. Finally, all spilled files are aggregated once. Since the previously spilled files have been sorted according to the partition, we can copy the corresponding copies of all the spilled files to the final file in the order of the partitions. The final file obtained in this way is the partition-sorted file.

* (3) SortShuffleWriter

SortShuffleWriter mainly implements specific logic through ExternalSorter. ExternalSorter decides whether to combine and sort based on the user's needs.

When writing record, it will be inserted directly into memory. If combine is required, the memory architecture is map, otherwise it is buffer.

If the current evaluation memory is greater than the threshold, the spill operation will be triggered. During the spill operation, the Record will be spilled to the disk. This process requires sorting. The specific comparator will use different values according to different user needs. If keyordering is set, it will be sorted by key. If keyordering is not set, but aggregator (i.e. combine) is set, the keys are sorted according to  the hashcode of key, thus ensuring that the same keys are organized together to facilitate combine operations. If neither keyordering nor aggregator is set, it will be sorted according to partition.

When all Records are written, the spill files need to be read and merged into a globally ordered file.
​
Comparison of three writers

| writer | advantages | disadvantages | scene |
| --- |---|---|---|
| BypassMergeSortShuffleWriter | (1) Only serialized once. <br>(2) Using hashmap-like data structure, inserting data is fast. | (1) Combine and sort are not supported <br>(2) Each partition must generate a temporary file, which will generate too many temporary files. | Suitable for situations where the number of partitions is small (default is less than or equal to 200) and there is no combine. |
| UnsafeShuffleWriter | (1) Only serialized once. <br>(2) The number of files spilled to disk is limited and is no longer based on the number of partitions, and can support larger partitions. | (1) Combine, sort is not supported <br>(2) The writing order Record order will be disrupted, and supportsRelocationOfSerializedObjects is required.  | Applicable to situations where combine does not exist, and supportsRelocationOfSerializedObjects is true, and the maximum number of supported partitions is 16777216. |
| SortShuffleWriter | (1) Supports combine, sort <br> (2) Suitable for all scenarios <br> (3) The number of files spilled to disk is limited | (1) Multiple serializations are required | Suitable for all scenarios. |

### 1.3.2 shuffle read

Currently there is only one implementation of BlockStoreShuffleReader. The implementation is similar to MapReduce.
The reduce will pull the records of the corresponding partition remotely or locally from the map. Under normal circumstances, it will be written directly to the memory, but if the block size to be obtained exceeds the threshold, will use disk.
Then it will be decided according to the user's needs whether to combine or sort, and finally form a record iterator required by the user.
Combine and sort use ExternalAppendOnlyMap and ExternalSorter respectively. When the memory exceeds the threshold, the data will be spilled to the local disk.

## 1.4 Summary

(1) About the semantics of each framework

For MapReduce and the ordered io of Tez, it is a special case of spark sorting. For Tez's unordered io, it is essentially a special case of spark's non-sorting. In essence, the semantics of each framework are the same, and spark is more general.

(2) Where will generate local disk files?

After analyzing the three computing frameworks, we learned that the following processes will use disks:
* (1) Map may generate intermediate temporary files because the memory exceeds the threshold.
* (2) The map will eventually generate disk files to provide shuffle services.
* (3) When reduce pulls records, disk files may be generated because the threshold is exceeded.
* (4) When merging on the reduce side, temporary disk files may be generated for global sorting.

In fact, uniffle has solved (1), (2). For (3), if the parameters are adjusted effectively, it is difficult to generate disk files. In fact, only (4) needs to be discussed in this article.

# 2 Plans
In order to solve the problem that Merge on the Reduce side may spill to disk, there are two main solutions:
* (1) Merge on Shuffle Server
* (2) Reduce side Merge on demand
## 2.1 Option 1: Merge on ShuffleServer
Move the merge process of reduce to the ShuffleServer side. ShuffleServer will merge the locally sorted Records sent from the map side into a globally sorted records sequence. The reduce side reads directly in the order of the records sequence.
* Advantages: Does not require too much memory and network RPC.
* Disadvantages: Shuffle Server needs to parse Key, Value and Comparator. The Shuffle side cannot combine.

## 2.2 Option 2: On-demand Merge on the Reduce side

<img width=""440"" alt=""on_demand_merge"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/ac15cb13-7d9e-480b-8328-c14a41fe60b2"">

Since the memory on the reduce side is limited, in order to avoid spilling data to disk when merging on the reduce side. When reduce obtains segment, it can only read part of the buffer of each segment, and then merge all the buffers. Then when the partial buffer reading of a certain segment is completed, the next buffer of this segment will continue to be read, and this buffer will continue to be added to the merge process.
There is a problem with this. The number of times the Reduce side reads data from ShuffleServer is approximately segments_num * (segment_size / buffer_size), which is a large value for large tasks. Too many RPCs means decreased performance.

> The segment here refers to the sorted record collection, which can be understood as the block in which the records have been sorted according to key.

* Advantages: Shuffle Server does not need to do anything extra.
* Disadvantages: Too many RPCs.

**This article chooses option 1, and the following content mainly discusses option 1.** 

# 3 Demand analysis

## 3.1 What types of tasks require remote merge?

Currently, uniffle's map-side no longer spill disk. This article mainly considers the situation on the reduce. Mainly divided into the following situations:
* (1) For spark's non-sorted, non-aggregated, tez unordered io. It does not require any global aggregation and sorting operations, and only requires very little memory. The current version of uniffle will not use disk if related settings are reasonable. Just use the current uniffle solution. This article will not discuss this aspect.
* (2) For spark sorting or aggregation tasks, tez ordered io, mapreduce, due to the need for global sorting or aggregation, the memory may not be enough, and the record may be spilled to the disk. This article mainly discusses this situation.
**In summary, it can be seen that remote merge is only used for shuffles that require sorting or aggregation. **
## 3.2 How does ShuffleServer sort?

For sorting, map is generally sorted to obtain a set of partially sorted records, which is called segment here. Then reduce will obtain all segments and merge them. Spark, MR, and Tez all use minimum heap K-way merge sorting. This method can still be used for remote sorting.

BufferManager and FlushManager maintain block information in memory and disk. We only need to add MergeManager to ShuffleServer and merge the blocks under the same Shuffle to obtain globally sorted Records.

Introducing sorting on the ShuffleServer produces a side effect: the Shuffle's KeyClass, ValueClass and KeyComparator need to be passed to ShuffleServer.

## 3.3 How does ShuffleServer combine?

Combine is generally a user-defined operation, so ShuffleServer is prohibited from performing combine operations. If combine is performed on the Reduce side, wouldn't it violate our theme of avoiding spill to disk on the task side? In fact we don't have to use ExternalAppendOnlyMap for combine. If the Records obtained from ShuffleServer are sorted by key, it means that the same keys have been organized together, and only a small amount of memory is needed to combine.

## 3.4 How does Writer write?

Just write it the way we have it.

## 3.5 How does Reader read?

Currently, Uniffle's shuffle reader uses blockid as the read mark, which makes it easy to verify whether an accurate and complete records are obtained. For remote merge, MergeManager has merged the original Block collection into a new sequence sorted records by key. Therefore, the blockid generated by the map segment cannot be used:
We will use a new way to read Records. When MergerManager performs global Merge, an index will be generated. Reader will read according to this index.

> Note: In principle, using key as a read index is more semantic, and the first version of the demo program was also implemented by this way. However, this proposal was not friendly enough to deal with the problem of data skew, so  gave up the plan.

# 4 Scheme Design

## 4.1 Basic procedures for RemoteMerge

<img width=""974"" alt=""remote_merge_structure"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/42e48b04-dfb6-4038-b311-184d39dbeb49"">

The following introduces the process of Remote Merge:
* (1) Register
When AM/Driver calls the registerShuffle method, it will additionally register keyClass, valueClass and keyComparator. This information is mainly used by ShuffleServer to parse and sort the Record during merging.
* (2) sendShuffleData
The sendShuffleData logic is basically consistent with existing RSS tasks. The only difference is the use of unified serializers and deserializers, which ensures that ShuffleServer can parse the Record normally no matter which framework it is.
* (3) buffer and flush
The shuffle server will store the data in the cache, or cache it to the local file system or remote file system through the flush manager. The logic of the original ShuffleServer is still reused here.
* (4) reportUniqueBlocks
A new API is provided, reportUniqueBlocks. The Reduce end will deduplicate the blocks generated by the map, and then send the valid block set to ShuffleServer through reportUniqueBlocks. After ShuffleServer receives a valid blocks collection, it will trigger Remote Merge. The results of Remote Merge will be written to the bufferPool like a normal block, and may be flushed to disk when necessary. The result generated by RemoteMerge is an ordinary block, but for convenience of explanation, it is called merged block here. The merged block records the results sorted by key, so when reading the merged block, you need to read it in ascending order in the order of blockid.
* (5) getSortedShuffleData
Reduce will read merged blocks in the order of block serial numbers, and then choose when to use them for reduce calculations based on certain conditions.

## 4.2 Analyze the process from the perspective of Record
We can use WordCount as an example to explain the flow of record in the entire process. In this example, there are two partitions and one reduce, that is, one reduce processes the data of two partitions.

![remote_merge_from_record_perspective](https://github.com/apache/incubator-uniffle/assets/10381583/536aeaa6-b1f1-46b1-b312-b0e2b03c9dcd)

* (1) MAP side
After the document data is processed on the map side, it will be sorted. For Map1, since there are two partitions, records with odd numbers as keys will be written to block101, and records with even numbers as keys will be written to block102. The same goes for Map2. Note that the Records in the block here are all sorted.
* (2) Map side sends data
The map side sends the block to ShuffleServer through sendShuffleData, and ShuffleServer stores it in the bufferPool.
What I mean here is that when registering, the app named APP1 will also be registered, and the app named APP1@RemoteMerge will also be registered, which will be introduced later.
* (3) ShuffleServer side Merge
After reduce is started, reportUniqueBlocks will be called to report the available block set, and the corresponding partition in ShuffleServer will be triggered to merge. The result of Merge is a globally sorted record collection under this partition.
Then the question is where are the results of merge stored? The merge process occurs in memory. Whenever a certain number of records are merged, the results are written to a new block. In order to distinguish it from the original appid, this group of blocks will be managed in an appid ending with ""@RemoteMerge"". The blockid of this new group of blocks increases from 1 and is sorted globally. That is, the records inside each block are sorted, and the records with blockid=1 must be less than or equal to the records with blockid=2.
* (4) Reduce end reading
According to the previous analysis, the reduce side only needs to read the block managed by the appid ending with ""@RemoteMerge"". When reduce reads a block, it starts from the block with blockid=1 and reads in the order of blockid. We know that when reduce performs calculations, it is calculated in order. Since the data we obtain on the ShuffleServer side is already sorted, we only need to obtain a small amount of data from the ShuffleServer side each time. This enables on-demand reading from the ShuffleServer side, which greatly reduces memory usage.
There are two special situations here, detailed in 5.5.​
# 5 Plan

## 5.1 Unified serializer
Since Merge needs to be performed on the ShuffleServer side, a unified serializer that is independent of the computing framework needs to be extracted. Two types of serializers are extracted here: (1) Writable (2) Kryo. Writable serialization is used for classes that handle the org.apache.hadoop.io.Writable interface, used in the MR and TEZ frameworks. Kryo can serialize most classes and is generally used in the Spark framework.
## 5.2 RecordsFileWriter/RecordFileReader
Provides abstract methods for processing Records
## 5.3 Merger
Provides basic Merger service to merge multiple data streams according to key. Minimum heap K-way merge sorting is used to merge and sort the data streams that have been partially sorted.
## 5.4 MergeManager
Used to merge Records on the server side.
## 5.5 Tools for reading sorted data
Generally speaking, when the Reduce side reads data, it can be sent directly to downstream calculations. But there are two special situations:
(1) For situations where it is necessary to combine in Merge, we need to wait for all the same keys to arrive before combining, and then send them to the downstream.
(2) For spark and tez, the reduce end can read data from multiple partitions. Therefore, we need to merge the data of multiple partitions again on the reduce side, and then send it to the downstream.
RMRecordsReader is a tool for reading sorted data. The general structure is as follows:

<img width=""906"" alt=""rm_records_reader"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/d5a5214e-77c0-4123-89d9-2f6840ae2f64"">

The figure depicts a situation where a single Reduce processes two partitions. The RecordsFetcher thread will read the block of the corresponding partition and then parse it into Records. Then send it to combineBuffers. RecordCombiner reads Records from combineBuffer. When all records of a certain key are collected, a combine operation is performed. The result will be sent to mergedBuffer. RecordMerge will obtain all mergedBuffers and then merge and sort them again in memory. Finally, the global sorting results are obtained for downstream.
## 5.6 Framework adaptation
Compatible with MR, Tez, and Spark architectures.

> I has used online application to conduct large-scale stress testing on MR and Tez. Spark has currently only tested some basic examples and still needs a lot of testing.

## 5.7 Isolated classloader
For different versions of keyclass, valueclass and comparatorclass, use isolated classloaders to load them.

> Chinese version document: https://zhengchenyu.github.io/2023/12/25/RSS-%E8%BF%9C%E7%A8%8BMerge%E7%9A%84%E8%AE%BE%E8%AE%A1/","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vahWF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1239,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6RdaSw,incubator-uniffle,2440406192,1239,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-10-28T02:25:53Z,2024-10-28T02:25:53Z,"I tested the master branch [b5290b2](https://github.com/apache/incubator-uniffle/commit/b5290b21723b8698ea6dbaaddf3b2e4da7ee966a)  in my own cluster, 90% of which are tez tasks and 10% are mr tasks. There were no accuracy issues after running for three days, and no OOM or service restarts. Note: I used GRPC_NETTY mode and mimaloc, and set MIMALLOC_PURGE_DELAY=0, which is recommended. So close this issue. Spark development will open another issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6RdaSw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1243,https://api.github.com/repos/apache/incubator-uniffle/issues/1243,incubator-uniffle,1947843196,1243,[Flaky Test] SparkSQLTest and  RepartitionTest,summaryzb,37905939,summaryzb,summaryzb@gmail.com,CLOSED,2023-10-17T16:45:17Z,2023-10-17T18:24:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

1.Test class extends `SparkSQLTest` or  `RepartitionTest`
2.Call `IntegrationTestBase`#getShuffleServerConf()
3.Run with wildcard pattern to a specific one test
If above requirements are meet then NullPointerException occurs
Example1: mvn -B   package -Dtest=org.apache.uniffle.test.RepartitionWithLocalFileRssTest -Pspark3.5
```
[INFO] Running org.apache.uniffle.test.RepartitionWithLocalFileRssTest
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 4.374 s <<< FAILURE! - in org.apache.uniffle.test.RepartitionWithLocalFileRssTest
[ERROR] org.apache.uniffle.test.RepartitionWithLocalFileRssTest  Time elapsed: 4.373 s  <<< ERROR!
java.lang.NullPointerException
	at org.apache.uniffle.test.IntegrationTestBase.getShuffleServerConf(IntegrationTestBase.java:115)
	at org.apache.uniffle.test.RepartitionWithLocalFileRssTest.setupServers(RepartitionWithLocalFileRssTest.java:49)
```

Example2: mvn -B   package -Dtest=org.apache.uniffle.test.SparkSQLWithDelegationShuffleManagerTest -Pspark3.5
```
[INFO] Running org.apache.uniffle.test.SparkSQLWithDelegationShuffleManagerTest
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 4.021 s <<< FAILURE! - in org.apache.uniffle.test.SparkSQLWithDelegationShuffleManagerTest
[ERROR] org.apache.uniffle.test.SparkSQLWithDelegationShuffleManagerTest  Time elapsed: 4.02 s  <<< ERROR!
java.lang.NullPointerException
  at org.apache.uniffle.test.IntegrationTestBase.getShuffleServerConf(IntegrationTestBase.java:115)
  at org.apache.uniffle.test.SparkSQLWithDelegationShuffleManagerTest.setupServers(SparkSQLWithDelegationShuffleManagerTest.java:59)
```


### Actions URL

No. actions link. This happens when running  specific only one test

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1243/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1243,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pUWKd,incubator-uniffle,1766941341,1243,NA,kaijchen,5821159,Kaijie Chen,ckj@apache.org,NA,2023-10-17T18:24:58Z,2023-10-17T18:24:58Z,"Merged, thanks @summaryzb.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pUWKd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1246,https://api.github.com/repos/apache/incubator-uniffle/issues/1246,incubator-uniffle,1948664418,1246,[FEATURE] [tez] Support remote spill for unordered input.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-10-18T02:39:11Z,2023-10-31T09:39:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

For ordered input, we have support remote spill in merge stage. see #1231 
For unordered input, some fetch input data may be too large, then will restore in local filesystem. We should support remote spill for these data. 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1246/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,incubator-uniffle,1949286362,1247,[Bug] Incorrect size in `LocalStorageMeta`,xianjingfeng,11752250,,,OPEN,2023-10-18T09:29:00Z,2024-06-22T04:33:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I found some shuffle servers in our cluster write shuffle data to HDFS frequently. And then i found the size stored in `LocalStorageMeta` is incorrect.
Maybe we should update the metrics in the following method. There may be other places that have been missed.
https://github.com/apache/incubator-uniffle/blob/b2154c722f30ee31a867561f550254842c33cbab/server/src/main/java/org/apache/uniffle/server/storage/LocalStorageManager.java#L346

Other suggestion:
1. Maybe it is not a good way that judging if the local disk can be written by using this metric, because this metric is easily overlooked and it is hard to guarantee it's accurate. And #1071 trying to change this.
2. I found `shuffleMetaMap` in `LocalStorageMeta` is useless, maybe we should remove it. And then we can remove `LocalStorageMeta` at the same time.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1247/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pYljM,incubator-uniffle,1768052940,1247,NA,xianjingfeng,11752250,,,NA,2023-10-18T09:29:52Z,2023-10-18T09:29:52Z,@jerqi @zuston @advancedxy @sfwang218 PTAL,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pYljM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pYtrm,incubator-uniffle,1768086246,1247,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-18T09:48:59Z,2023-10-18T09:48:59Z,"> Maybe we should update the metrics in the following method. There may be other places that have been missed.

How to update? The updated value maybe not the consistent with the real disk usage.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pYtrm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pYvlx,incubator-uniffle,1768094065,1247,NA,xianjingfeng,11752250,,,NA,2023-10-18T09:53:32Z,2023-10-18T09:53:32Z,"> > Maybe we should update the metrics in the following method. There may be other places that have been missed.
> 
> How to update? The updated value maybe not the consistent with the real disk usage.

You are right. So i prefer to remove `LocalStorageMeta`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pYvlx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pgoil,incubator-uniffle,1770162341,1247,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-19T06:43:34Z,2023-10-19T06:43:34Z,"> > > Maybe we should update the metrics in the following method. There may be other places that have been missed.
> > 
> > 
> > How to update? The updated value maybe not the consistent with the real disk usage.
> 
> You are right. So i prefer to remove `LocalStorageMeta`.

+1 Please go ahead","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pgoil/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvq6c,incubator-uniffle,1774104220,1247,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-10-22T14:04:22Z,2023-10-22T14:04:22Z,"@xianjingfeng  @zuston  Maybe the root cause is that we change the storage or storage manager  in `hadoopThreadPoolExecutor` or 
 `localFileThreadPoolExecutor` which is designed to handle specified storage type.
The `storage` and `storageManager` who handle the `ShuffleDataFlushEvent` are  messed up.
Besides, some metrics updates concurrently using the wrong key, for example `incStorageFailedCounter` is called while the storage under the event may have already changed.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvq6c/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvvPW,incubator-uniffle,1774121942,1247,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-10-22T15:20:27Z,2023-10-22T15:20:27Z,"To solve this issue and make  the storage selection logic more clear, may be we could try the below way
1. Mark and get `storage` or `stageManager` only through `ShuffleDataFlushEvent`
2. remove the concurrent logic to `ShuffleDataFlushEvent`

I'm working on this","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvvPW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5p4Sr3,incubator-uniffle,1776364279,1247,NA,xianjingfeng,11752250,,,NA,2023-10-24T01:59:03Z,2023-10-24T01:59:03Z,"> @xianjingfeng @zuston Maybe the root cause is that we change the storage or storage manager in `hadoopThreadPoolExecutor` or `localFileThreadPoolExecutor` which is designed to handle specified storage type. The `storage` and `storageManager` who handle the `ShuffleDataFlushEvent` are messed up. Besides, some metrics updates concurrently using the wrong key, for example `incStorageFailedCounter` is called while the storage under the event may have already changed.

This may be just one of the cases.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5p4Sr3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qOihS,incubator-uniffle,1782196306,1247,NA,advancedxy,807537,,,NA,2023-10-27T02:37:04Z,2023-10-27T02:37:04Z,"> I found shuffleMetaMap in LocalStorageMeta is useless, maybe we should remove it. And then we can remove LocalStorageMeta at the same time.

If LocalStageMeta is removed, how to support LocalStorage mode?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qOihS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qPIp4,incubator-uniffle,1782352504,1247,NA,xianjingfeng,11752250,,,NA,2023-10-27T06:10:18Z,2023-10-27T06:10:18Z,"> > I found shuffleMetaMap in LocalStorageMeta is useless, maybe we should remove it. And then we can remove LocalStorageMeta at the same time.
> 
> If LocalStageMeta is removed, how to support LocalStorage mode?

Sorry, i can't get your point. 
There are only two fields in `LocalStageMeta`, `shuffleMetaMap` and `size`. 
`shuffleMetaMap`  is useless, right? 
And `size` is  just for judging whether the local disk can be written, right? 
So if we judge whether the local disk can be written by monitoring the usage of the local disk, `size` becomes useless too.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qPIp4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qQ3V7,incubator-uniffle,1782805883,1247,NA,advancedxy,807537,,,NA,2023-10-27T12:08:33Z,2023-10-27T12:08:33Z,"> shuffleMetaMap is useless, right?

I don't think ShuffleMetaMap is useless. I believe its intention is to track every shuffleId's shuffle size and last read time. It should be updated in a thread safe manner. Without this metadata, it would be hard to track how many data each shuffle has been wrote, data management operations such as: quota limit per app/shuffle, back pressure or traffic throttle would be impossible.

> And size is just for judging whether the local disk can be written, right?

Currently, there's a capacity configuration for shuffle server. It is possible that the shuffle server's disk is shared by other services, although not recommended. So we cannot simply check if the disk has free space to determine whether it's writable.

If we are going to remove LocalStorageMeta, I think we may have to add it back in the future to support advanced features.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qQ3V7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qRtXc,incubator-uniffle,1783027164,1247,NA,xianjingfeng,11752250,,,NA,2023-10-27T14:36:46Z,2023-10-27T14:36:46Z,"> > shuffleMetaMap is useless, right?
> 
> I don't think ShuffleMetaMap is useless. I believe its intention is to track every shuffleId's shuffle size and last read time. It should be updated in a thread safe manner. Without this metadata, it would be hard to track how many data each shuffle has been wrote, data management operations such as: quota limit per app/shuffle, back pressure or traffic throttle would be impossible.
> 
> > And size is just for judging whether the local disk can be written, right?
> 
> Currently, there's a capacity configuration for shuffle server. It is possible that the shuffle server's disk is shared by other services, although not recommended. So we cannot simply check if the disk has free space to determine whether it's writable.
> 
> If we are going to remove LocalStorageMeta, I think we may have to add it back in the future to support advanced features.

It's okay to keep it. Let's focus on how do we solve this problem and how can we avoid this problem from happening again in the future.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qRtXc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHGJ1,incubator-uniffle,2182898293,1247,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-21T14:47:57Z,2024-06-21T14:47:57Z,Can we close this? @xianjingfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHGJ1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1247,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CKdPX,incubator-uniffle,2183779287,1247,NA,xianjingfeng,11752250,,,NA,2024-06-22T04:33:11Z,2024-06-22T04:33:11Z,"> Can we close this? @xianjingfeng 

I don't think it can be closed.The problem still exists, we just don't use this variable anymore.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CKdPX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1249,https://api.github.com/repos/apache/incubator-uniffle/issues/1249,incubator-uniffle,1951953302,1249,[FEATURE] [MR] Support to spill large amounts of shuffle data.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-10-19T11:20:15Z,2023-12-28T08:17:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

https://github.com/apache/incubator-uniffle/commit/8683254720974c7254f9c5c2fd902743ae0ab273 disable write data to MR's OnDiskMapOutput. So it means we can not support the large shuffle data which is over mapreduce.reduce.shuffle.memory.limit.percent * memoryLimit.

In this issue, will enable this function.
Here's the key point:
RssFetcher will fetch compressed data(compressed by uiffle), then decompressed to the parameter 'buffer'. 
But when MergeManagerImpl merge the temporary shuffle data, will use hadoop compression code.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1249/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1249,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ppzlf,incubator-uniffle,1772566879,1249,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-10-20T11:28:34Z,2023-10-20T11:28:34Z,"## 1 analysis
<img width=""601"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/caa17b0c-a2b4-4720-8171-9542e30b1fba"">


Upper picture show the data format change. In brief, we have three data format:
Format B: the raw format. It is a sequence of keylen, valuelen, key, value, ending with two -1.
Format A: Format b is compressed according to uniffle encoding.
Format C: Add checksum to format b (IFile format) and compress it according to hadoop encoding.

> The yellow is component of Map. Blue is shuffle server. Green is component of Reduce.

What's the key of the promblem which is described by 8683254720974c7254f9c5c2fd902743ae0ab273?
We write the format B to OnDiskMapOutput, but MergeManagerImpl can only parse format C for OnDiskMapOutput.

## proposal

I have some proposal:

1. convert Format B to Format C for OnDiskMapOutput.
2. Unify compression encoding among uniffle, hadoop, tez, and spark.
3. Unify meger. New merger will use Format B in memory, Format A on disk.

I will implement proposal (1) in this issue. But this proposal will add a new encode operation. Of course we can set disable hadoop compression to ignore the encode operation. But all temp file which is produced by hadoop will not be compressed.

In the future, I tend to proposal (3). Since uniffle has controlled the encoding of the map stage, the encoding of the reduce stage should also be strictly controlled. At present, the reduce phase still uses Hadoop's merger, which will produce Hadoop's encoding format. If uniffle can implement its own merge, this problem will be solved. 

In addition, the codec and merge should also be unified. This is necessary if we consider sorting on the shuffle server in the future.


@jerqi  What about my proposal? How about implement proposal (1) firstly? Then discuss the future plan?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ppzlf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1249,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5p5peV,incubator-uniffle,1776719765,1249,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-10-24T08:03:56Z,2023-10-24T08:03:56Z,"Maybe we won't the similar situation. According the logic of data send, we won't produce too large data.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5p5peV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1249,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5p6EEb,incubator-uniffle,1776828699,1249,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-10-24T09:14:33Z,2023-10-24T09:14:33Z,"> Maybe we won't the similar situation. According the logic of data send, we won't produce too large data.

Emm. If we use default parameter, won't produce large data. If we increase read buffer size, maybe produce the large shuffle.

And In my test, I decrease mapreduce.reduce.shuffle.memory.limit.percent, then produce this.

If you think so, I will close https://github.com/apache/incubator-uniffle/pull/1263. But It's better to set some limits that read buffer will never be over than single memory limit.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5p6EEb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1249,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qHNCo,incubator-uniffle,1780273320,1249,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-10-26T01:25:20Z,2023-10-26T01:25:20Z,"> > Maybe we won't the similar situation. According the logic of data send, we won't produce too large data.
> 
> Emm. If we use default parameter, won't produce large data. If we increase read buffer size, maybe produce the large shuffle.
> 
> And In my test, I decrease mapreduce.reduce.shuffle.memory.limit.percent, then produce this.
> 
> If you think so, I will close #1263. But It's better to set some limits that read buffer will never be over than single memory limit.

It's ok for you to raise a pr. I just state the reason why we don't support this feature at first.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qHNCo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1249,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vhBor,incubator-uniffle,1870928427,1249,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-12-28T08:17:20Z,2023-12-28T08:17:20Z,"This process mainly occurs during the fetch block. If the number of bytes obtained exceeds the threshold (the default is 0.25 bytes of reduce memory), the data will be stored directly on the disk. In fact, we can precisely control the size of readbuffersize, the default is 14M. We should avoid this process through parameters, rather than support this process. What's more, if the readbuffersize is not adjusted large enough, this process will not happen. So close this PR.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vhBor/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1252,https://api.github.com/repos/apache/incubator-uniffle/issues/1252,incubator-uniffle,1955945710,1252,[Bug] Incorrect storage write fail metric,summaryzb,37905939,summaryzb,summaryzb@gmail.com,CLOSED,2023-10-22T15:32:07Z,2023-10-25T11:35:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Metric in `incStorageFailedCounter` may updates wrong, while  using the wrong storageHost.
The storage under the event may have already changed, if `incStorageFailedCounter` is called  after `eventHandler.handle(event)`, since the event will be processed in another thread to do storage selection work.

### Affects Version(s)

0.8

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1252/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1252,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvwP1,incubator-uniffle,1774126069,1252,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-10-22T15:38:21Z,2023-10-22T15:38:21Z,It's just a thread safety problem,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pvwP1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1254,https://api.github.com/repos/apache/incubator-uniffle/issues/1254,incubator-uniffle,1956216404,1254,[Flaky Test] tez unit test `RssShuffleTest`,summaryzb,37905939,summaryzb,summaryzb@gmail.com,CLOSED,2023-10-23T02:10:45Z,2023-10-23T06:55:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffleTest
Error:  Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.134 s <<< FAILURE! - in org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffleTest
Error:  testSchedulerTerminatesOnException  Time elapsed: 0.074 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <false> but was: <true>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertFalse.assertFalse(AssertFalse.java:40)
	at org.junit.jupiter.api.AssertFalse.assertFalse(AssertFalse.java:35)
	at org.junit.jupiter.api.Assertions.assertFalse(Assertions.java:227)
	at org.apache.tez.runtime.library.common.shuffle.orderedgrouped.RssShuffleTest.testSchedulerTerminatesOnException(RssShuffleTest.java:93)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/6607344077/job/17944613341?pr=1253

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1254/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1254,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pwgkR,incubator-uniffle,1774323985,1254,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-10-23T02:13:29Z,2023-10-23T02:13:29Z,"@lifeSo please take a look, appreciated","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pwgkR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1254,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pw27R,incubator-uniffle,1774415569,1254,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-10-23T04:29:31Z,2023-10-23T04:29:31Z,"I also encountered this problem and prepare to fix it.

shuffle.run -> submit runnable to executor. 
The runnable will call cleanupShuffleScheduler -> rssScheduler.close -> sShutdown.getAndSet(true)
So this is a random error.

If sleep 3s before 'assertFalse(scheduler.isShutdown())'. It is easy to reproduce this error.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5pw27R/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1256,https://api.github.com/repos/apache/incubator-uniffle/issues/1256,incubator-uniffle,1956502931,1256,[Improvement] optimize collections contruction,summaryzb,37905939,summaryzb,summaryzb@gmail.com,CLOSED,2023-10-23T07:11:02Z,2023-10-25T11:45:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

1. Some empty collections are only for read, so replace it with `Collections.emptyList()`, `Collections.emptySet()`, `Collections.emptyMap()`.
2. Set a properly initial size
3. In spark, writer client construct a new List prepared for `shuffleBlockInfos` per record, But in most case there is no blocks produced.


improve above scenarios

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1256/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1256,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qCrjs,incubator-uniffle,1779087596,1256,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2023-10-25T11:45:47Z,2023-10-25T11:45:47Z,Fixed by https://github.com/apache/incubator-uniffle/pull/1257,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qCrjs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1261,https://api.github.com/repos/apache/incubator-uniffle/issues/1261,incubator-uniffle,1958463577,1261,[Bug] `InterruptedException` should be passed in `WriteBufferManager.requestExecutorMemory`,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2023-10-24T03:55:25Z,2023-10-24T05:37:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When killing  job while waiting for memory in `requestExecutorMemory`, the task will not be killed.

![1111](https://github.com/apache/incubator-uniffle/assets/17894939/a601a2a5-5103-4ca3-8030-29a7d0f5dac2)

Although the job has been killed, the task is still running.

![image](https://github.com/apache/incubator-uniffle/assets/17894939/edfce33d-5eb0-489e-821f-3392fc4b500c)

![2222](https://github.com/apache/incubator-uniffle/assets/17894939/0359ff2c-6780-463f-8b1e-6af4bdac9bdd)

So I think we should pass` InterruptedException` in `requestExecutorMemory`.


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1261/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1264,https://api.github.com/repos/apache/incubator-uniffle/issues/1264,incubator-uniffle,1962586198,1264,[FEATURE][SPARK] Support cancel async thread of  handle blockEvent and  rpc when writer is killed,summaryzb,37905939,summaryzb,summaryzb@gmail.com,OPEN,2023-10-26T02:26:25Z,2023-10-27T03:24:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

When task is killed for stage cancel, another task attempt succeed or some other reasons, The `AddBlockEvent` handling and `sendShuffleData`  still work. 
Although `needCancelRequest` may cancel some work, but the `AddBlockEvent` in the blocking queue of threadPool still holds the shuffleblockdata, and so as to the rpc request that are already called but waiting for repsonse.

That will cause 3 problems:
1. We freeAll memory onece the task is killed, but the shuffleBlockData hold by the async thread still occupy memory
2. Many useless runnable related to the kille task are still working or wait to be executed
4. Currently`checkBlockSendResult` can not be interrupted, when the killed task  caused by speculation is the last one of the shuffle map stage, it will block the next reduce stage scheduling


### Motivation

_No response_

### Describe the solution

1. Cancel  all the runnable that are wait to be executed or  blocked in waiting for rpc callback
2. Interrupt `checkBlockSendResult` immediately

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1264/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1264,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qIIxo,incubator-uniffle,1780517992,1264,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-26T06:53:26Z,2023-10-26T06:53:26Z,Nice catch.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qIIxo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1266,https://api.github.com/repos/apache/incubator-uniffle/issues/1266,incubator-uniffle,1964676046,1266,[Improvement] Support lazily init the grpc client channel,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-10-27T02:58:58Z,2023-11-07T03:52:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In current codebase, the grpc client channel will be created once the sending/getting happens. But connection will not be used if the partition data don't exist. So I think the lazily initialization of grpc client channel is meaningful.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1266/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1266,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qOmM3,incubator-uniffle,1782211383,1266,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-10-27T02:59:24Z,2023-10-27T02:59:24Z,WDYT? @jerqi @summaryzb ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qOmM3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1266,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rIe0G,incubator-uniffle,1797385478,1266,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-11-07T02:59:06Z,2023-11-07T02:59:06Z,please assign this to me,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rIe0G/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1267,https://api.github.com/repos/apache/incubator-uniffle/issues/1267,incubator-uniffle,1964680130,1267,[Improvement]  Fast fail when grpc request encounter `unable to create new native thread` exception,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-10-27T03:04:19Z,2023-12-08T10:06:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In online applications, I found the some jobs will hang when encountering the exception as follows

```
23/10/27 07:54:32 ERROR ManagedChannelImpl: [Channel<27>: (10.67.67.91:21000)] Uncaught exception in the SynchronizationContext. Panic!
java.lang.OutOfMemoryError: unable to create new native thread
	at java.lang.Thread.start0(Native Method)
	at java.lang.Thread.start(Thread.java:714)
	at io.grpc.netty.shaded.io.netty.util.concurrent.ThreadPerTaskExecutor.execute(ThreadPerTaskExecutor.java:32)
	at io.grpc.netty.shaded.io.netty.util.internal.ThreadExecutorMap$1.execute(ThreadExecutorMap.java:57)
	at io.grpc.netty.shaded.io.netty.util.concurrent.SingleThreadEventExecutor.doStartThread(SingleThreadEventExecutor.java:975)
	at io.grpc.netty.shaded.io.netty.util.concurrent.SingleThreadEventExecutor.startThread(SingleThreadEventExecutor.java:944)
	at io.grpc.netty.shaded.io.netty.util.concurrent.SingleThreadEventExecutor.execute(SingleThreadEventExecutor.java:827)
	at io.grpc.netty.shaded.io.netty.util.concurrent.SingleThreadEventExecutor.lazyExecute(SingleThreadEventExecutor.java:820)
	at io.grpc.netty.shaded.io.netty.util.concurrent.AbstractScheduledEventExecutor.schedule(AbstractScheduledEventExecutor.java:263)
	at io.grpc.netty.shaded.io.netty.util.concurrent.AbstractScheduledEventExecutor.schedule(AbstractScheduledEventExecutor.java:177)
	at io.grpc.netty.shaded.io.netty.util.concurrent.AbstractEventExecutorGroup.schedule(AbstractEventExecutorGroup.java:50)
	at io.grpc.netty.shaded.io.netty.util.concurrent.AbstractEventExecutorGroup.schedule(AbstractEventExecutorGroup.java:32)
	at io.grpc.internal.Rescheduler.reschedule(Rescheduler.java:63)
	at io.grpc.internal.ManagedChannelImpl.rescheduleIdleTimer(ManagedChannelImpl.java:447)
	at io.grpc.internal.ManagedChannelImpl.exitIdleMode(ManagedChannelImpl.java:402)
	at io.grpc.internal.ManagedChannelImpl$RealChannel$2.run(ManagedChannelImpl.java:984)
	at io.grpc.SynchronizationContext.drain(SynchronizationContext.java:95)
	at io.grpc.SynchronizationContext.execute(SynchronizationContext.java:127)
	at io.grpc.internal.ManagedChannelImpl$RealChannel.newCall(ManagedChannelImpl.java:981)
	at org.apache.uniffle.client.impl.grpc.RetryInterceptor$1RetryingUnaryRequestClientCall.startCall(RetryInterceptor.java:98)
	at org.apache.uniffle.client.impl.grpc.RetryInterceptor$1RetryingUnaryRequestClientCall.halfClose(RetryInterceptor.java:94)
	at io.grpc.stub.ClientCalls.asyncUnaryRequestCall(ClientCalls.java:318)
	at io.grpc.stub.ClientCalls.futureUnaryCall(ClientCalls.java:227)
	at org.apache.uniffle.proto.ShuffleServerGrpc$ShuffleServerFutureStub.requireBuffer(ShuffleServerGrpc.java:920)
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.doRequirePreAllocation(ShuffleServerGrpcClient.java:291)
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.requirePreAllocation(ShuffleServerGrpcClient.java:277)
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.lambda$sendShuffleData$3(ShuffleServerGrpcClient.java:405)
	at org.apache.uniffle.common.util.RetryUtils.retry(RetryUtils.java:49)
	at org.apache.uniffle.common.util.RetryUtils.retry(RetryUtils.java:31)
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.sendShuffleData(ShuffleServerGrpcClient.java:400)
	at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.lambda$sendShuffleDataAsync$4(ShuffleWriteClientImpl.java:239)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
```

And the retry will cost too much time and always fail. So I want to exclude this exception when retrying

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1267/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1269,https://api.github.com/repos/apache/incubator-uniffle/issues/1269,incubator-uniffle,1965151785,1269,[Bug] [TEZ] uniqueMapId may be not unique when more than one fetcher are working.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-10-27T09:43:00Z,2023-10-31T09:40:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

We use faked InputAttemptIdentifier to reserve a MapOutput. This id is used to distinguish between different data sources. If flush to disk, we will use this id to distinguish between different files within a reduce. If the id is conflicted, there is a certain probability that the data will be abnormal.

For TEZ, if auto reduce is enable, a reduce may read multiple partitions. It means there are more than one RssTezShuffleDataFetcher/RssTezFetcher in a reduce. So uniqueMapId will not be unique. We should make uniqueMapId static.

> Note: So far, this problem does not exist for MR engines, because A reduce can only have one RssFetcher. 

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1269/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1271,https://api.github.com/repos/apache/incubator-uniffle/issues/1271,incubator-uniffle,1966559522,1271,[Improvement] Change transportTime and processTime summary to Thread Pool Instead of block,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-10-28T11:30:48Z,2023-11-01T02:12:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When calc transportTime and processTime summary, It will block GRPC Thread, so change it to ThreadPool calc it, and not block GRPC thread


### How should we improve?

not block GRPC thread


### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1271/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1273,https://api.github.com/repos/apache/incubator-uniffle/issues/1273,incubator-uniffle,1967366832,1273,[FEATURE]  Add shaded module for spark3 client,xianjingfeng,11752250,,,CLOSED,2023-10-30T02:52:11Z,2023-10-30T13:18:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

For publishing maven releases to maven central repository.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1273/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1274,https://api.github.com/repos/apache/incubator-uniffle/issues/1274,incubator-uniffle,1967367428,1274,[FEATURE] Add shaded module for spark2 client,xianjingfeng,11752250,,,CLOSED,2023-10-30T02:52:52Z,2023-10-31T02:56:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

For publishing maven releases to maven central repository.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1274/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1275,https://api.github.com/repos/apache/incubator-uniffle/issues/1275,incubator-uniffle,1967371075,1275,[FEATURE] Add scripts for publishing maven releases to maven central repository.,xianjingfeng,11752250,,,CLOSED,2023-10-30T02:57:29Z,2023-10-31T06:15:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In order to easy to publish maven releases to maven central repository.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1275/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1276,https://api.github.com/repos/apache/incubator-uniffle/issues/1276,incubator-uniffle,1967377189,1276,[Umbrella] Publishing maven releases to maven central repository.,xianjingfeng,11752250,,,CLOSED,2023-10-30T03:02:26Z,2023-10-31T13:36:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Third-party projects need to rely on spark client, such as gluten. So we need to publish maven releases to maven central repository.

### Task list

- [x]  #1277
- [x]  #1273 
- [x]  #1274
- [x]  #1275

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1276/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1277,https://api.github.com/repos/apache/incubator-uniffle/issues/1277,incubator-uniffle,1967431439,1277,[Improvement] Add flatten-maven-plugin,xianjingfeng,11752250,,,CLOSED,2023-10-30T03:48:32Z,2023-10-30T08:19:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

If we add shaded module for clients, we must add flatten-maven-plugin, or the dependences in not-shaded module will not be included in the shaded jar.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1277/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1285,https://api.github.com/repos/apache/incubator-uniffle/issues/1285,incubator-uniffle,1971624403,1285,[Flaky Test][TeZ] WriteBufferManagerTest.testWriteNormal,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-11-01T03:21:55Z,2023-11-02T03:55:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

WriteBufferManagerTest.testWriteNormal

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/6704550390/job/18217184953

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1285/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1285,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ql__C,incubator-uniffle,1788346306,1285,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-01T03:22:13Z,2023-11-01T03:22:13Z,Could you help check this? @zhengchenyu ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ql__C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1285,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qsZRc,incubator-uniffle,1790022748,1285,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-11-02T03:55:02Z,2023-11-02T03:55:02Z,"Maybe inSendListBytes is updated in another async thread. But I can not catch the second test section in testWriteNormal. why we assert before waitSendFinished? I think before waitSendFinished, waitSendBuffers is non-deterministic. 
@bin41215 Can you please review it? I am no sure the initial thought.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qsZRc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1286,https://api.github.com/repos/apache/incubator-uniffle/issues/1286,incubator-uniffle,1972020840,1286,[Improvement] Add RemoveResourceTime Metric,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-11-01T09:34:16Z,2023-11-01T11:02:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Add RemoveResourceTime Metric to monitor the time.

### How should we improve?

By add metric

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1286/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1290,https://api.github.com/repos/apache/incubator-uniffle/issues/1290,incubator-uniffle,1973633377,1290,[Improvement][operator] Avoid accidentally deleting data of other services when misconfiguring the mounting directory,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2023-11-02T07:02:45Z,2023-11-18T06:41:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We use k8s-operator to deploy ShuffleServer at datanode machine, using the same disk but different directories. It is very dangerious if the mounting directory is configured incorrectly and the data of the datanode may be deleted by uniffle k8s-operator.

### How should we improve?

Only delete `rssdata` directory.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1290/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1293,https://api.github.com/repos/apache/incubator-uniffle/issues/1293,incubator-uniffle,1975551694,1293,[FEATURE] Add the total_read_data metrics for rust based server,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-11-03T06:52:32Z,2023-11-08T07:18:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the `total_received_data` metric has been introduced, the `total_read_data` is also necessary

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1293/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1293,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qzyJW,incubator-uniffle,1791959638,1293,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-03T06:53:24Z,2023-11-03T06:53:24Z,Are you interested on this issue? @wenlongbrother,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5qzyJW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1293,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5q6BRv,incubator-uniffle,1793594479,1293,NA,wenlongbrother,50658515,,,NA,2023-11-05T00:45:38Z,2023-11-05T00:45:38Z,"> Are you interested on this issue? @wenlongbrother

Hi @zuston sorry for late, thank you, I will complete in next week. You can assign it to me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5q6BRv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1294,https://api.github.com/repos/apache/incubator-uniffle/issues/1294,incubator-uniffle,1975557216,1294,[FEATURE] Use the tonic's layer to introduce the grpc request latency metrics,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-11-03T06:57:25Z,2023-11-03T08:54:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Use the tonic's layer to introduce the grpc request latency metrics

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1294/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1296,https://api.github.com/repos/apache/incubator-uniffle/issues/1296,incubator-uniffle,1975707160,1296,[Improvement] Replace tokio lock with std.sync.lock,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-11-03T08:52:28Z,2023-11-03T08:52:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The tokio lock performance is slow. 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1296/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1297,https://api.github.com/repos/apache/incubator-uniffle/issues/1297,incubator-uniffle,1977270277,1297,[Improvement] optimize JVM default config,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-11-04T10:23:00Z,2023-12-23T17:08:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

optimize JVM default config

### How should we improve?

 optimize JVM default config, add config, include dump on OOM, DirectMemory config

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1297/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1297,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vXICb,incubator-uniffle,1868333211,1297,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-12-23T17:08:41Z,2023-12-23T17:08:41Z,"refer to:
https://github.com/apache/incubator-uniffle/issues/460
https://github.com/apache/incubator-uniffle/pull/1390","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vXICb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1300,https://api.github.com/repos/apache/incubator-uniffle/issues/1300,incubator-uniffle,1983364789,1300,[Improvement][mr] Support combine operation in map stage.,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2023-11-08T11:17:31Z,2023-11-14T02:35:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

As mentioned in #1238, it's useful to support combine operation in map stage.
This issue is for mapreduce engine.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1300/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1302,https://api.github.com/repos/apache/incubator-uniffle/issues/1302,incubator-uniffle,1984883723,1302,[Improvement] Replace ConfigEntry with ConfigOption in RssSparkConfig,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-11-09T05:49:48Z,2024-01-12T02:28:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We will use the `ConfigOption` to unify all client and server config style. But currently, there are some original code using the ConfigEntry, which is necessary to replace by the `ConfigEntry`

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1302/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1302,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2LCP,incubator-uniffle,1809363087,1302,NA,guixiaowen,58287738,,,NA,2023-11-14T00:44:56Z,2023-11-14T00:44:56Z,"@zuston i am new here, let me have a try","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2LCP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1302,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wczcx,incubator-uniffle,1886598961,1302,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-01-11T08:21:03Z,2024-01-11T08:21:03Z,"Do we need to finalize the design about #1302 #1303 #1304 ?
 
RssSparkConfig/RssTezConfig/RssMRConfig or SparkConf/Configuration need to spark/tez/mr prefix? 
And how about RssClientConfig? Do we need RssSparkConfig/RssTezConfig/RssMRConfig to be extend from RssClientConfig?

@zuston @jerqi @lifeSo Can you give us some suggesstion?

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wczcx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1302,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5whJAC,incubator-uniffle,1887735810,1302,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-11T18:30:37Z,2024-01-11T18:30:37Z,"> Do we need to finalize the design about #1302 #1303 #1304 ?
> 
> RssSparkConfig/RssTezConfig/RssMRConfig or SparkConf/Configuration need to spark/tez/mr prefix? And how about RssClientConfig? Do we need RssSparkConfig/RssTezConfig/RssMRConfig to be extend from RssClientConfig?
> 
> @zuston @jerqi @lifeSo Can you give us some suggesstion?

I think at least TezClientConf need 'tez.' prefix, because there is some plase can not direct use TezClientConf.get(...).
Instead, it use as TezClientConf.someconf.key() and TezClientConf.someconf.defaultValue() where use Configuration.

eg: in RssDAGAppMaster.java

```
    // set the remote storage with actual value
    appMaster
        .getClusterClientConf()
        .put(TezClientConf.RSS_REMOTE_STORAGE_PATH.key(), remoteStorage.getPath());
    appMaster
        .getClusterClientConf()
        .put(TezClientConf.RSS_REMOTE_STORAGE_CONF.key(), remoteStorage.getConfString());
```


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5whJAC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1302,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wjbRO,incubator-uniffle,1888334926,1302,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-01-12T02:28:23Z,2024-01-12T02:28:23Z,"@lifeSo

We just need to reach some consensus. Then develop MR/Tez/Spark code based on this consensus.

This is my idea. Since TezConfiguration/SparkConf is start with ""tez.""/""spark."", then RssConfig is not start with ""tez.""/""spark."".
Then if TezClientConf is extended from RssConfig, TezClientConf/SparkConf should not start with ""tez.""/""spark."".

If so, TezClientConf should be extended from TezConfiguration. SparkClientConf should be extended from SparkConf.
RssClientConfig should be extended from RssConfig.
TezClientConf can be transient to RssClientConfig.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wjbRO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1303,https://api.github.com/repos/apache/incubator-uniffle/issues/1303,incubator-uniffle,1984886150,1303,[Improvement] Using the configOption in RssTezConfig,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-11-09T05:52:01Z,2023-11-14T01:28:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the config key is the single string and the default value should be retrieved explictly, it should be wrapped by `ConfigOption`

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1303/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1303,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2Kpc,incubator-uniffle,1809361500,1303,NA,guixiaowen,58287738,,,NA,2023-11-14T00:43:47Z,2023-11-14T00:43:47Z,"@zuston  i am new here, let me have a try","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2Kpc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1304,https://api.github.com/repos/apache/incubator-uniffle/issues/1304,incubator-uniffle,1984887471,1304,[Improvement] Using configOption in RssMRConfig ,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-11-09T05:53:06Z,2023-11-14T01:28:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the config key is the single string and the default value should be retrieved explictly, it should be wrapped by `ConfigOption`

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1304/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1304,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2KUl,incubator-uniffle,1809360165,1304,NA,guixiaowen,58287738,,,NA,2023-11-14T00:43:07Z,2023-11-14T00:43:07Z,"@zuston  i am new here, let me have a try","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5r2KUl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1305,https://api.github.com/repos/apache/incubator-uniffle/issues/1305,incubator-uniffle,1986773198,1305,[FEATURE] Support stateful upgrade for shuffle-server more quickly,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-11-10T03:15:51Z,2023-11-14T01:28:33Z,"I think the quick stateful upgrade for shuffle-server is meaningful, especially for a big uniffle cluster. The current graceful decommission mechanism by exclude node file in coordinator side is useful, but it will cost too much time. In our internal environment, this will cost 1 week for 400+ nodes cluster. Anyway, it was a burden for ops people.

So it's time to make this feature involved in the next or future uniffle version, all write-read process should be taken into consideration in detail currently although I made effort before like https://github.com/apache/incubator-uniffle/pull/308

the following problems need to be considered

# For reading client
If the client is reading the data from one shuffle-server, but the shuffle-server is offline, it should fast fail. This is OK for the normal process.

But when server is upgrading, the reader client should be able to tolerate waiting for a while once it accept the signal from the server, like `QUICK_STATEFUL_UPGRADE` state.

# For writing client
When writing for the client and the shuffle-server is upgrading, it should accept the signal from the shuffle-server, and then   require new server to store partitioned data. This mechanism is called HARD_SPLIT in celeborn. And I think we also could achieve it by extending the dynamic assignment for one partition rather than whole stage like #308 did.

# Shuffle-server's shuffle data in memory

Before shutdown, all the shuffle-data in memory should be persisted into persistent storage like localfile. The cost time depends on the localfile IO speed. 

For example, the memory size is 100G, the shuffle-server has 4 SSDs(500M/s), it will cost 50s. I think it's acceptable. But for HDD, the time will be longer, and the more disks is needed if you want to speed up.

# Shuffle-server's meta data

Currently, the blockids and partition's disk mapping are stored in memory of server, which also should be recovered when restarting.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1305/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1305,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rlkwc,incubator-uniffle,1805011996,1305,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-10T03:17:52Z,2023-11-10T03:17:52Z,"Are you interested on this feature? @summaryzb 

cc @jerqi @smallzhongfeng @leixm @xianjingfeng @zhengchenyu @advancedxy ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rlkwc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1305,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rxhoh,incubator-uniffle,1808144929,1305,NA,summaryzb,37905939,summaryzb,summaryzb@gmail.com,NA,2023-11-13T13:14:54Z,2023-11-13T13:14:54Z,"I'm in,  Please assign this to me","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rxhoh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1307,https://api.github.com/repos/apache/incubator-uniffle/issues/1307,incubator-uniffle,1987129794,1307,[Improvement] tonic throughput problems,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-11-10T08:12:42Z,2023-11-10T08:59:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

I‘m always digging the way to solve the request throughput when the writing concurrency is 400. And then I found the few people talk about this, which makes me confused until I see this https://github.com/hyperium/tonic/issues/1405#issuecomment-1805099818 .

From this blog https://medium.com/@fujita.tomonori/scalable-server-design-in-rust-with-tokio-4c81a5f350a3,
I try to do this optimization, and then do some terasort test. I found the peek receive data speed from 1.2G/s -> 2.0G/s, it works ! And the latency becomes low. And the whole processing time reduces from 20min -> 8.5min

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1307/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1308,https://api.github.com/repos/apache/incubator-uniffle/issues/1308,incubator-uniffle,1987136762,1308,[Bug] StagingBuffer reference remain when it has been deleted,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-11-10T08:17:07Z,2023-11-22T07:23:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I print out the arc reference count of the stagingBuffer in memoryStore before deleting from the dashmap in the method of `purge` , it's 2. This is strange, which means the data will remain.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1308/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1308,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rmnGw,incubator-uniffle,1805283760,1308,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-10T08:17:28Z,2023-11-10T08:17:28Z,Are you interested on this ? @wenlongbrother ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rmnGw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1308,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rnUSu,incubator-uniffle,1805468846,1308,NA,wenlongbrother,50658515,,,NA,2023-11-10T10:28:05Z,2023-11-10T10:28:05Z,Hi @zuston I am interested it. Can you assign it to me? I will complete in next week,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5rnUSu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1308,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sWmXI,incubator-uniffle,1817863624,1308,NA,wenlongbrother,50658515,,,NA,2023-11-19T13:58:00Z,2023-11-19T13:58:00Z,"Hi @zuston , I reproduce the problem you mentioned according to the following steps:
## 1. I add some test code to reproduce this issue, like below
```rust
async fn purge(&self, app_id: String) -> Result<()> {
        // free allocated
        let released_size = self.discard_tickets(app_id.as_str(), None);
        self.budget.free_allocated(released_size).await?;
        info!(
            ""free allocated buffer size:[{}] for app:[{}]"",
            released_size,
            app_id.as_str()
        );

        // remove the corresponding app's data
        let read_only_state_view = self.state.clone().into_read_only();
        let mut _removed_list = vec![];
        for entry in read_only_state_view.iter() {
            let pid = entry.0;
            if pid.app_id == app_id {
                _removed_list.push(pid);
            }
        }

        let mut used = 0;
        for removed_pid in _removed_list {
            if let Some(entry) = self.state.get(removed_pid) {
                // get arc reference count
                let arc_ref_count = Arc::strong_count(&entry.value());

                println!(""Arc reference count for StagingBuffer before removal: {}"", arc_ref_count);
            }
            if let Some(entry) = self.state.remove(removed_pid) {
                used += entry.1.lock().await.total_size;
            }
        }

        // free used
        self.budget.free_used(used).await?;

        info!(
            ""removed used buffer size:[{}] for app:[{}]"",
            used,
            app_id.as_str()
        );

        Ok(())
    }
```
## 2. After this I run test_purge to observe resut.
Here is result:
<img width=""492"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/50658515/1088627b-503f-4cb1-b2b7-401cdd53659f"">

## 3.  I add some test code in **purge**

```rust

    async fn purge(&self, app_id: String) -> Result<()> {
        // free allocated
        let released_size = self.discard_tickets(app_id.as_str(), None);
        self.budget.free_allocated(released_size).await?;
        info!(
            ""free allocated buffer size:[{}] for app:[{}]"",
            released_size,
            app_id.as_str()
        );

        // print reference count before clone
        for entry in self.state.iter() {
            if entry.key().app_id == app_id {
                let arc_ref_count = Arc::strong_count(entry.value());
                println!(""Arc reference count for value with app_id '{}': {}, before clone"", app_id, arc_ref_count);
            }
        }

        // remove the corresponding app's data
        let read_only_state_view = self.state.clone().into_read_only();
       
        // print reference count after clone
        for entry in self.state.iter() {
            if entry.key().app_id == app_id {
                let arc_ref_count = Arc::strong_count(entry.value());
                println!(""Arc reference count for value with app_id '{}': {}, after clone"", app_id, arc_ref_count);
            }
        }

        let mut _removed_list = vec![];
        for entry in read_only_state_view.iter() {
            let pid = entry.0;
            if pid.app_id == app_id {
                _removed_list.push(pid);
            }
        }

        let mut used = 0;
        for removed_pid in _removed_list {
            if let Some(entry) = self.state.get(removed_pid) {
                // get arc reference count
                let arc_ref_count = Arc::strong_count(&entry.value());

                println!(""Arc reference count for StagingBuffer before removal: {}"", arc_ref_count);
            }
            if let Some(entry) = self.state.remove(removed_pid) {
                used += entry.1.lock().await.total_size;
            }
        }

        // free used
        self.budget.free_used(used).await?;

        info!(
            ""removed used buffer size:[{}] for app:[{}]"",
            used,
            app_id.as_str()
        );

        Ok(())
    }
```

I got this result
<img width=""693"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/50658515/f626a640-533c-47d4-b9b0-99a2f2d5b7ce"">

So I suspect the problem lies in the **clone()** method.

## 4. I try to search some information to explain the problem. 
Here is what I searched:
```doc
When you clone an Arc<T> (Atomic Reference Count) instance, several things happen, reflecting the design goals and use cases of Arc:

What Happens
Incrementing the Reference Count:
Inside Arc, there's an atomic reference count. When you clone an Arc, this count is safely incremented by one. This increment is an atomic operation, ensuring thread safety even in multi-threaded contexts. It means the count is adjusted without interference from other threads that might simultaneously access the Arc.

Creating a New Arc Instance:
The clone operation creates a new Arc instance. This new instance shares ownership of the underlying data with the original Arc instance. Both point to the same data in memory, but now there are two references to it.

Why It's Designed This Way
Shared Ownership:
Arc enables multiple owners (in the form of Arc instances) to share the same piece of data. Cloning an Arc doesn't duplicate the data it points to; instead, it just creates another pointer to the data, indicating that there's another owner.

Thread Safety:
The atomic increment of the reference count ensures that Arc can be used safely across threads without the need for additional synchronization mechanisms. This is crucial for concurrent programming in Rust.

Automatic Memory Management:
Arc automatically deallocates the data it points to when the last Arc pointing to that data goes out of scope. This automatic deallocation is a result of the reference count going to zero, indicating no more owners.

Preventing Premature Deallocation:
Incrementing the reference count on cloning prevents the data from being deallocated while it's still in use. If the count didn't increase on cloning, the data could be deallocated while other Arc instances are still using it, leading to undefined behavior.

Suitability for Concurrent Use:
Since Rust emphasizes safety, especially in concurrent scenarios, Arc provides a way to safely and efficiently manage data shared across threads without the explicit use of locks (though you might still need locks or other synchronization for mutating shared data).

In summary, Arc's design around cloning and reference counting is focused on enabling safe, concurrent sharing of immutable data, with automatic and efficient memory management.
```
## 5. Get weak reference to ensure purge can successfully free memory
To verify that the purge method correctly reduces the reference count of instances of Arc < Mutex < StagingBuffer > >, resulting in related resources being released. I use below code:

```rust
      // get weak reference to ensure purge can successfully free memory
        let weak_ref_before = store.state.get(&uid)
            .map(|entry| Arc::downgrade(&entry.value()));
        assert!(weak_ref_before.is_some(), ""Failed to obtain weak reference before purge"");

        // purge
        runtime.wait(store.purge(app_id.to_string())).expect("""");
        assert!(weak_ref_before.clone().unwrap().upgrade().is_none(), ""Arc should not exist after purge"");
```

## 6. Conclusion
I guess when the purge method returns, stagebuffer should be recycled because his reference count is 0. 
If I am wrong, please do correct me, thank you!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sWmXI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1308,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sXxvc,incubator-uniffle,1818172380,1308,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-20T03:31:14Z,2023-11-20T03:31:14Z,Got your point. Really thanks @wenlongbrother ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sXxvc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1309,https://api.github.com/repos/apache/incubator-uniffle/issues/1309,incubator-uniffle,1987601201,1309,[Bug][#825][part-3] WriteBufferManager in Spark2 does not use a reassigned shuffle server.,yl09099,33595968,,,CLOSED,2023-11-10T13:11:31Z,2023-11-11T14:46:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In Spark2, after a write failure, ShuffleBlockInfo is not built using the new shuffle server after the shuffle server is reassigned.

### Affects Version(s)

0.9.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1309/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1314,https://api.github.com/repos/apache/incubator-uniffle/issues/1314,incubator-uniffle,1993984166,1314,[Bug] used_buffer leak after ShuffleServer restart.,leixm,31424839,Xianming Lei,,CLOSED,2023-11-15T03:48:49Z,2023-11-20T03:52:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When an app is writing data and restarting ShuffleServer, used_buffer cannot be released, because a NO_REGISTER exception will be thrown when sendingShuffleData. At this time, only preAllocated is released, but used_buffer is not released.
See https://github.com/apache/incubator-uniffle/blob/master/server/src/main/java/org/apache/uniffle/server/ShuffleServerGrpcService.java#L278C5-L278C5

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1314/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1314,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX0__,incubator-uniffle,1818185727,1314,NA,leixm,31424839,Xianming Lei,,NA,2023-11-20T03:52:23Z,2023-11-20T03:52:23Z,#1045  can also fix this problem.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX0__/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1316,https://api.github.com/repos/apache/incubator-uniffle/issues/1316,incubator-uniffle,1994322606,1316,[Improvement] Detect OutputTracker API version via Spark version,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2023-11-15T08:51:18Z,2024-02-20T08:23:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The OutputTracker API version is detected by reflectively calling into the various versions (3.0.0, 3.1.0, 3.2.0), catching an exception and calling into the next version.

### How should we improve?

Spark provides the version as a string, which can be used to decide which OutputTracker API to use without calling into non-existing methods.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1316/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1319,https://api.github.com/repos/apache/incubator-uniffle/issues/1319,incubator-uniffle,1998218785,1319,[Bug] java.lang.NoClassDefFoundError: org/apache/uniffle/guava/util/concurrent/internal/InternalFutureFailureAccess,leixm,31424839,Xianming Lei,,CLOSED,2023-11-17T03:42:38Z,2023-12-06T13:12:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When the registerShuffle interface of ShuffleServer is called, java.lang.NoClassDefFoundError will be thrown.
And I noticed that the jar package `shuffle-server-0.9.0-SNAPSHOT.jar` does not contain the class org/apache/uniffle/guava/util/concurrent/internal/InternalFutureFailureAccess. The reason is server/pom.xml line161`com. google.guava:guava`, the shaded guava package is configured. When I add these two lines of configuration, the above exception no longer occurs`<include>com.google.guava:failureaccess</include>
                  <include>com.google.guava:listenablefuture</include>`

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
Exception in thread ""Grpc-1"" java.lang.NoClassDefFoundError: org/apache/uniffle/guava/util/concurrent/internal/InternalFutureFailureAccess
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:763)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:467)
        at java.net.URLClassLoader.access$100(URLClassLoader.java:73)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:368)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:362)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:361)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:763)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:467)
        at java.net.URLClassLoader.access$100(URLClassLoader.java:73)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:368)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:362)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:361)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:763)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:467)
        at java.net.URLClassLoader.access$100(URLClassLoader.java:73)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:368)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:362)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:361)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
        at org.apache.uniffle.guava.cache.LocalCache$LoadingValueReference.<init>(LocalCache.java:3476)
        at org.apache.uniffle.guava.cache.LocalCache$LoadingValueReference.<init>(LocalCache.java:3480)
        at org.apache.uniffle.guava.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2138)
        at org.apache.uniffle.guava.cache.LocalCache$Segment.get(LocalCache.java:2049)
        at org.apache.uniffle.guava.cache.LocalCache.get(LocalCache.java:3966)
        at org.apache.uniffle.guava.cache.LocalCache$LocalManualCache.get(LocalCache.java:4863)
        at org.apache.uniffle.server.ShuffleTaskManager.getAppLock(ShuffleTaskManager.java:200)
        at org.apache.uniffle.server.ShuffleTaskManager.registerShuffle(ShuffleTaskManager.java:233)
        at org.apache.uniffle.server.ShuffleServerGrpcService.registerShuffle(ShuffleServerGrpcService.java:163)
        at org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1033)
        at io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        at io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        at io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        at io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:352)
        at io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:866)
        at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:745)
Caused by: java.lang.ClassNotFoundException: org.apache.uniffle.guava.util.concurrent.internal.InternalFutureFailureAccess
        at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
        ... 56 more


Exception in thread ""Grpc-9"" java.lang.NoClassDefFoundError: org/apache/uniffle/guava/util/concurrent/SettableFuture
        at org.apache.uniffle.guava.cache.LocalCache$LoadingValueReference.<init>(LocalCache.java:3476)
        at org.apache.uniffle.guava.cache.LocalCache$LoadingValueReference.<init>(LocalCache.java:3480)
        at org.apache.uniffle.guava.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2138)
        at org.apache.uniffle.guava.cache.LocalCache$Segment.get(LocalCache.java:2049)
        at org.apache.uniffle.guava.cache.LocalCache.get(LocalCache.java:3966)
        at org.apache.uniffle.guava.cache.LocalCache$LocalManualCache.get(LocalCache.java:4863)
        at org.apache.uniffle.server.ShuffleTaskManager.getAppLock(ShuffleTaskManager.java:200)
        at org.apache.uniffle.server.ShuffleTaskManager.registerShuffle(ShuffleTaskManager.java:233)
        at org.apache.uniffle.server.ShuffleServerGrpcService.registerShuffle(ShuffleServerGrpcService.java:163)
        at org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1033)
        at io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        at io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        at io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        at io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:352)
        at io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:866)
        at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:745)
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1319/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1319,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sOWn0,incubator-uniffle,1815702004,1319,NA,leixm,31424839,Xianming Lei,,NA,2023-11-17T03:42:58Z,2023-11-17T03:42:58Z,@zuston  PTAL.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sOWn0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1319,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX1Oc,incubator-uniffle,1818186652,1319,NA,leixm,31424839,Xianming Lei,,NA,2023-11-20T03:53:52Z,2023-11-20T03:53:52Z,It looks like shaded is missing some configuration. cc @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX1Oc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1319,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX1aY,incubator-uniffle,1818187416,1319,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-20T03:55:07Z,2023-11-20T03:55:07Z,I haven't checked this. Can you submit your fix ? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX1aY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1319,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX2hy,incubator-uniffle,1818191986,1319,NA,leixm,31424839,Xianming Lei,,NA,2023-11-20T04:02:31Z,2023-11-20T04:02:31Z,This is a Good-First issue. Some people have also reported it in the WeChat group. I will try to encourage new people to submit PR first.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5sX2hy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1319,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5t0oop,incubator-uniffle,1842514473,1319,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-06T09:34:51Z,2023-12-06T09:34:51Z,Could you help fix this? I think this is a serious problem. @leixm ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5t0oop/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1324,https://api.github.com/repos/apache/incubator-uniffle/issues/1324,incubator-uniffle,2003512674,1324,[Bug] [dashboard] fix dashboard data display bug.,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2023-11-21T05:50:05Z,2024-06-05T06:18:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Try to deploy dashborad in our cluster, found bugs make dashboard data empty, fixed these.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1324/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1327,https://api.github.com/repos/apache/incubator-uniffle/issues/1327,incubator-uniffle,2008109069,1327,[Improvement][tez] Support combine operation in sort.,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,OPEN,2023-11-23T12:12:44Z,2023-11-23T12:12:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

As mentioned in #1238, it's useful to support combine operation.
This issue is for tez engine.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1327/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1330,https://api.github.com/repos/apache/incubator-uniffle/issues/1330,incubator-uniffle,2009303922,1330,[Improvement] Optimize tips for checking replica settings,xianjingfeng,11752250,,,CLOSED,2023-11-24T08:24:38Z,2023-11-29T03:35:37Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The following tips is incorrect.
https://github.com/apache/incubator-uniffle/blob/51e02d0539786b3888832c16a4248bc2ded44513/common/src/main/java/org/apache/uniffle/common/util/RssUtils.java#L311-L314

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1330/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1336,https://api.github.com/repos/apache/incubator-uniffle/issues/1336,incubator-uniffle,2011765188,1336,[DOCS] Add stage recompute intro,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-11-27T08:35:09Z,2023-11-27T09:04:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

Thanks to  the efforts of @advancedxy and @yl09099 , the stage recompute has been supported.

We'd better to add more docs to describe this design and effect, and the dedicated article is also necessary for this 
big feature

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1336/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1336,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s61zO,incubator-uniffle,1827364046,1336,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-27T08:35:40Z,2023-11-27T08:35:40Z,Do you want to take this? @yl09099 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s61zO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1336,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s7AUF,incubator-uniffle,1827407109,1336,NA,yl09099,33595968,,,NA,2023-11-27T09:04:05Z,2023-11-27T09:04:05Z,"> Do you want to take this? @yl09099

Okay, let me write that down.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5s7AUF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1340,https://api.github.com/repos/apache/incubator-uniffle/issues/1340,incubator-uniffle,2015772423,1340,[FEATURE] Provider uber jar for cli/dashboard/coordinator/server module,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-11-29T04:12:37Z,2023-11-29T09:49:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In some cases, the separate jars are not easy to maintain, uber jar is better to run and test, especially for dashboard module

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1340/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1340,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tJbZO,incubator-uniffle,1831188046,1340,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-29T04:12:53Z,2023-11-29T04:12:53Z,WDYT? @yl09099 @xianjingfeng @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tJbZO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1340,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tKPEC,incubator-uniffle,1831399682,1340,NA,xianjingfeng,11752250,,,NA,2023-11-29T08:04:25Z,2023-11-29T08:04:25Z,"For cli, it is ok. But for other modules, using uber jar may make it more difficult to find problems and it may lead to many useless dependencies that will not be discovered in the future. Right?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tKPEC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1340,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tK2K6,incubator-uniffle,1831559866,1340,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-11-29T09:49:23Z,2023-11-29T09:49:23Z,"> For cli, it is ok. But for other modules, using uber jar may make it more difficult to find problems and it may lead to many useless dependencies that will not be discovered in the future. Right?

Ok for me. I think Cli + dashboard are more suitable to use uber jar.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tK2K6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1341,https://api.github.com/repos/apache/incubator-uniffle/issues/1341,incubator-uniffle,2016256020,1341,[Bug] java.lang.ArrayIndexOutOfBoundsException,sunshineJK,41426045,Jiankun Feng,,CLOSED,2023-11-29T10:18:46Z,2024-04-30T03:10:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Test wordcount to specify combine on the master branch，Report an error：
**java.lang.ArrayIndexOutOfBoundsException: 3075**
	at org.apache.hadoop.io.DataInputBuffer$Buffer.read(DataInputBuffer.java:80)
	at java.io.DataInputStream.readInt(DataInputStream.java:387)
	at org.apache.hadoop.io.IntWritable.readFields(IntWritable.java:47)
	at org.apache.hadoop.io.serializer.WritableSerialization$WritableDeserializer.deserialize(WritableSerialization.java:71)
	at org.apache.hadoop.io.serializer.WritableSerialization$WritableDeserializer.deserialize(WritableSerialization.java:42)
	at org.apache.hadoop.mapreduce.task.ReduceContextImpl.nextKeyValue(ReduceContextImpl.java:146)
	at org.apache.hadoop.mapreduce.task.ReduceContextImpl$ValueIterator.next(ReduceContextImpl.java:239)
	at org.apache.hadoop.examples.WordCount$IntSumReducer.reduce(WordCount.java:60)
	at org.apache.hadoop.examples.WordCount$IntSumReducer.reduce(WordCount.java:52)
	at org.apache.hadoop.mapreduce.Reducer.run(Reducer.java:183)
	at org.apache.hadoop.mapred.Task$NewCombinerRunner.combine(Task.java:1923)
	at org.apache.hadoop.mapred.SortWriteBufferManager.combineBuffer(SortWriteBufferManager.java:268)
	at org.apache.hadoop.mapred.SortWriteBufferManager.prepareBufferForSend(SortWriteBufferManager.java:241)
	at org.apache.hadoop.mapred.SortWriteBufferManager.sendBufferToServers(SortWriteBufferManager.java:209)
	at org.apache.hadoop.mapred.SortWriteBufferManager.addRecord(SortWriteBufferManager.java:194)
	at org.apache.hadoop.mapred.RssMapOutputCollector.collect(RssMapOutputCollector.java:216)
	at org.apache.hadoop.mapred.MapTask$NewOutputCollector.write(MapTask.java:745)
	at org.apache.hadoop.mapreduce.task.TaskInputOutputContextImpl.write(TaskInputOutputContextImpl.java:89)
	at org.apache.hadoop.mapreduce.lib.map.WrappedMapper$Context.write(WrappedMapper.java:112)
	at org.apache.hadoop.examples.WordCount$TokenizerMapper.map(WordCount.java:47)
	at org.apache.hadoop.examples.WordCount$TokenizerMapper.map(WordCount.java:36)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:155)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:819)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:349)
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:174)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)


### Affects Version(s)

0.9.0-SNAPSHOT

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1341/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tLHlL,incubator-uniffle,1831631179,1341,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-11-29T10:33:46Z,2023-11-29T10:33:46Z,@qijiale76 Could you take a look at this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tLHlL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tLLgL,incubator-uniffle,1831647243,1341,NA,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,NA,2023-11-29T10:43:51Z,2023-11-29T10:43:51Z,@sunshineJK Could you provide information such as the specific Hadoop version and test data to reproduce this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tLLgL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tLNin,incubator-uniffle,1831655591,1341,NA,sunshineJK,41426045,Jiankun Feng,,NA,2023-11-29T10:48:49Z,2023-11-29T10:48:49Z,"Uniffle：0.9.0-SNAPSHOT（master branch）
hadoop：3.2.1
command：hadoop jar /tmp/hadoop-mapreduce-examples-3.2.1.jar  wordcount

When the data volume is 1 GB, an error is reported","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5tLNin/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vZdzZ,incubator-uniffle,1868946649,1341,NA,sunshineJK,41426045,Jiankun Feng,,NA,2023-12-25T11:46:46Z,2023-12-25T11:46:46Z,"@qijiale76 Hello, is there a repair plan？","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vZdzZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vai2o,incubator-uniffle,1869229480,1341,NA,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,NA,2023-12-26T03:40:23Z,2023-12-26T03:40:23Z,"> @qijiale76 Hello, is there a repair plan？

Thank you for your patience. I plan to submit a PR with the solution by the end of this week.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vai2o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x8d5d,incubator-uniffle,1911676509,1341,NA,sunshineJK,41426045,Jiankun Feng,,NA,2024-01-26T08:41:07Z,2024-01-26T08:41:07Z,"> > @qijiale76 Hello, is there a repair plan？
> 
> Thank you for your patience. I plan to submit a PR with the solution by the end of this week.

Thank you. Do you have any ideas so far? We can do some communication","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x8d5d/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1341,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yFxAK,incubator-uniffle,1914114058,1341,NA,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,NA,2024-01-29T07:31:51Z,2024-01-29T07:31:51Z,"> Thank you. Do you have any ideas so far? We can do some communication

I am still having difficulty reproducing this issue in my environment. Could you please provide me a stable way to reproduce?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yFxAK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1342,https://api.github.com/repos/apache/incubator-uniffle/issues/1342,incubator-uniffle,2020151710,1342,[Improvement] Record the appId when failure on clearing resources,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-12-01T05:55:28Z,2023-12-01T08:58:22Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Record the appId when clearing resources failed

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1342/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1348,https://api.github.com/repos/apache/incubator-uniffle/issues/1348,incubator-uniffle,2027590023,1348,[Improvement] Unify tags generation for shuffle-server metrics reporter,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-12-06T03:43:57Z,2023-12-13T08:58:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the tags label is generated by self when registering metrics for shuffle-server. This is wrong, which will lack the `GRPC` or `NETTY_GRPC` tags.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1348/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1354,https://api.github.com/repos/apache/incubator-uniffle/issues/1354,incubator-uniffle,2030112237,1354,[Improvement] Introduce HybridRpcServer to implement ServerInterface for GRPC_NETTY,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-12-07T07:54:07Z,2024-01-19T04:08:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, the streamServer of netty and grpc server are created in the different places. From my prospective, we could introduce HybridRpcServer to implement ServerInterface for GRPC_NETTY.

In the HybridRpcServer, the grpc and netty should be started.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1354/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1354,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5t9gLL,incubator-uniffle,1844839115,1354,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-07T07:54:20Z,2023-12-07T07:54:20Z,cc @jerqi @leixm ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5t9gLL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1354,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xORxN,incubator-uniffle,1899568205,1354,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-19T03:01:43Z,2024-01-19T03:01:43Z,"Are interested on this? @rickyma I do a poc PR to fix, but I don't have much time to finish this. Can you pick up?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xORxN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1354,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xOuKg,incubator-uniffle,1899684512,1354,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-19T04:06:03Z,2024-01-19T04:06:03Z,"> Are interested on this? @rickyma I do a poc PR to fix, but I don't have much time to finish this. Can you pick up?

Interested, but I've encountered a very serious #1472 issue, still working on it. Can you help me fix this issue first? 
It is a very serious bug. This results in our inability to use it on a large scale in production.


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xOuKg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1355,https://api.github.com/repos/apache/incubator-uniffle/issues/1355,incubator-uniffle,2030247161,1355,[Bug] server memory leak with netty,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-12-07T09:08:21Z,2023-12-08T03:06:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

![image](https://github.com/apache/incubator-uniffle/assets/8609142/f96fc6cf-8e4d-454f-b103-c8bffb487f47)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

```yaml
rss.rpc.server.type            GRPC_NETTY
rss.server.netty.port          21100
```


### Uniffle Engine Configurations

```yaml
spark.rss.client.type         GRPC_NETTY
```


### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1355/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1355,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5t99la,incubator-uniffle,1844959578,1355,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-07T09:08:30Z,2023-12-07T09:08:30Z,PTAL @leixm ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5t99la/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1356,https://api.github.com/repos/apache/incubator-uniffle/issues/1356,incubator-uniffle,2030253250,1356,[FEATURE] add metrics of expired pre-allocated buffer size,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-12-07T09:12:10Z,2024-01-22T06:50:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

add metrics of expired pre-allocated buffer size

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1356/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1356,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xHuop,incubator-uniffle,1897851433,1356,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-18T05:58:12Z,2024-01-18T05:58:12Z,I don't know the reason of removing the metrics in #1425,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xHuop/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1356,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xcwwr,incubator-uniffle,1903365163,1356,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-22T06:50:56Z,2024-01-22T06:50:56Z,"> I don't know the reason of removing the metrics in #1425

OK, anyway I will fix it recently.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xcwwr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1358,https://api.github.com/repos/apache/incubator-uniffle/issues/1358,incubator-uniffle,2030363626,1358,[Bug] msg: Zstd only supports the same type of bytebuffer decompression,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2023-12-07T10:01:56Z,2023-12-18T01:55:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

![image](https://github.com/apache/incubator-uniffle/assets/8609142/9ac117cd-1c31-470a-887d-efdb5d4dce98)

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1358/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1358,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uD0M2,incubator-uniffle,1846494006,1358,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-08T03:25:16Z,2023-12-08T03:25:16Z,Do you know the managedBuffer is not direct buffer when getting memory by netty? @leixm ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uD0M2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1358,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uD1cJ,incubator-uniffle,1846499081,1358,NA,leixm,31424839,Xianming Lei,,NA,2023-12-08T03:33:59Z,2023-12-08T03:33:59Z,"> Do you know the managedBuffer is not direct buffer when getting memory by netty? @leixm

Does this happen when netty is turned on or off? RssShuffleDataIterator line164 will keep uncompressedData the same type as rawData. Why does the above exception still appear?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uD1cJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1358,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uD1rv,incubator-uniffle,1846500079,1358,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-08T03:35:41Z,2023-12-08T03:35:41Z,"> > Do you know the managedBuffer is not direct buffer when getting memory by netty? @leixm
> 
> Does this happen when netty is turned on or off? RssShuffleDataIterator line164 will keep uncompressedData the same type as rawData. Why does the above exception still appear?

Netty is on.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uD1rv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1358,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uD4za,incubator-uniffle,1846512858,1358,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-12-08T03:58:37Z,2023-12-08T03:58:37Z,Is this issue related to `spark.rss.client.off.heap.memory.enable`?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uD4za/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1358,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uESA0,incubator-uniffle,1846616116,1358,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-08T06:31:32Z,2023-12-08T06:31:32Z,I found sometimes the bytebuffer is not direct after coverting from netty direct bytebuf using `bytebuf.nioBuffer()`,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uESA0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1358,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uEUdK,incubator-uniffle,1846626122,1358,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-08T06:40:36Z,2023-12-08T06:40:36Z,"![image](https://github.com/apache/incubator-uniffle/assets/8609142/22ac790e-8f2a-4b52-83f2-2da4e94efc56)

@leixm ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5uEUdK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1358,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u1IIX,incubator-uniffle,1859420695,1358,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-12-18T01:55:22Z,2023-12-18T01:55:22Z,"> ![image](https://private-user-images.githubusercontent.com/8609142/288985798-22ac790e-8f2a-4b52-83f2-2da4e94efc56.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTEiLCJleHAiOjE3MDI4NjQ3NTksIm5iZiI6MTcwMjg2NDQ1OSwicGF0aCI6Ii84NjA5MTQyLzI4ODk4NTc5OC0yMmFjNzkwZS04ZjJhLTRiNTItODNmMi0yZGE0ZTk0ZWZjNTYucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQUlXTkpZQVg0Q1NWRUg1M0ElMkYyMDIzMTIxOCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyMzEyMThUMDE1NDE5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MDNiNWYzN2ZlYWQ4ZTVkN2MwYjQzMDViZjkxOTJiOWRkZTkxM2QwNWFkZDRiYTZlNWNiN2NjNGY1MzFjYjY5NCZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.Suy2pw4jANiP_mN3m-Tffkq9ZfCiRNY2wCR5583wp5g)
> 
> @leixm

@LuciferYang Do you know more about this point?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u1IIX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,incubator-uniffle,2030376523,1359,[Bug] client memory leak with netty #1355,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-12-07T10:06:58Z,2024-05-10T01:47:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

![image](https://github.com/apache/incubator-uniffle/assets/8609142/9c277a79-0f48-4fa0-ba65-84c335fd48c4)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1359/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u_0bu,incubator-uniffle,1862223598,1359,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2023-12-19T06:59:37Z,2023-12-19T06:59:37Z,I've encountered this problem too. Any ideas to fix this? @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u_0bu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u_1g7,incubator-uniffle,1862228027,1359,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-19T07:04:27Z,2023-12-19T07:04:27Z,"> I've encountered this problem too. Any ideas to fix this? @zuston

I don't reproduce this case, do you want to fix this? @rickyma ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5u_1g7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vADgF,incubator-uniffle,1862285317,1359,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2023-12-19T08:00:12Z,2023-12-19T08:00:12Z,"I can reproduce this issue when we are doing stress testing, but I don't know how to fix it. It seems to be a problem with the underlying code handling in Netty. @zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vADgF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zgFqA,incubator-uniffle,1937791616,1359,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-02-11T15:50:59Z,2024-02-11T15:50:59Z,I think we can close this now. @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zgFqA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VJ_p,incubator-uniffle,2102697961,1359,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-09T13:47:35Z,2024-05-09T13:47:35Z,@jerqi @zuston We can close this.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VJ_p/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VKTc,incubator-uniffle,2102699228,1359,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-05-09T13:48:19Z,2024-05-09T13:48:19Z,"> @jerqi @zuston We can close this.

Is everything ok ?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VKTc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59WZbl,incubator-uniffle,2103023333,1359,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-09T16:41:42Z,2024-05-09T16:41:42Z,"> > @jerqi @zuston We can close this.
> 
> Is everything ok ?

Yes. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59WZbl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1359,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59Y_Vk,incubator-uniffle,2103702884,1359,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-05-10T01:47:45Z,2024-05-10T01:47:45Z,"> > > @jerqi @zuston We can close this.
> > 
> > 
> > Is everything ok ?
> 
> Yes.

thanks for your effort","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59Y_Vk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1361,https://api.github.com/repos/apache/incubator-uniffle/issues/1361,incubator-uniffle,2032102186,1361,[FEATURE] Involve netty metrics into reporter,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-12-08T07:40:19Z,2023-12-08T10:05:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the netty metrics is not involved in reporter module.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1361/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1364,https://api.github.com/repos/apache/incubator-uniffle/issues/1364,incubator-uniffle,2037248643,1364,[FEATURE] Introduce `rss.remote.storage.configs` for spark,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-12-12T08:36:09Z,2024-01-25T02:40:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

 Introduce `rss.remote.storage.configs` for spark

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1364/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1369,https://api.github.com/repos/apache/incubator-uniffle/issues/1369,incubator-uniffle,2039023257,1369,[FEATURE] Provide distribution jars with hadoop ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-12-13T06:08:52Z,2023-12-20T01:46:55Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, uniffle must need HADOOP env, which is not easy for newbie to use it. Let's make this as an optional param when creating the distribution binary.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1369/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,incubator-uniffle,2043022161,1373,[FEATURE] support shuffle partition data write to multiple shuffle servers,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2023-12-15T07:04:18Z,2024-09-03T07:26:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, data from one partition can only be written to a designated shuffle server. 

In some scenarios, such as when a large partition occupies a significant amount of shuffle server disk space, this can lead to server crashes in extreme cases.

Based on #825, we could support writing one partition data to multiple shuffle servers.

### Motivation

https://docs.google.com/document/d/1FRGP82R7JBnr3IjmF8PQ6qWP9GnKQsk-N1OWk_f1kSY

### Describe the solution

<!-- ![ddd](https://github.com/apache/incubator-uniffle/assets/9135743/f9499e55-027f-4558-95cd-c1ff0821dbc0) -->
![shuffleServer drawio](https://github.com/apache/incubator-uniffle/assets/9135743/b34f208c-3005-4da9-9990-e19afbbb2d08)

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1373/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5utX1g,incubator-uniffle,1857387872,1373,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-12-15T07:14:17Z,2023-12-15T07:14:17Z,"When to trigger the next node write?

Two strategies I propose are:
- Based on the application quota of a shuffle server.
- Based on the shuffle server's health status.

@jerqi @zuston @leixm ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5utX1g/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5utZT3,incubator-uniffle,1857393911,1373,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-15T07:19:59Z,2023-12-15T07:19:59Z,"+1 for that.

I hope the trigger strategies could be designed as the pluggable mechansim ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5utZT3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vAs1n,incubator-uniffle,1862454631,1373,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2023-12-19T09:58:35Z,2023-12-19T09:58:35Z,How would this differ from `rss.data.replica.write`,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vAs1n/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vAyKD,incubator-uniffle,1862476419,1373,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-12-19T10:11:44Z,2023-12-19T10:11:44Z,"> When to trigger the next node write?
> 
> Two strategies I propose are:
> 
> * Based on the application quota of a shuffle server.
> * Based on the shuffle server's health status.
> 
> @jerqi @zuston @leixm

+1 for this proposal.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vAyKD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vAyhX,incubator-uniffle,1862477911,1373,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-12-19T10:12:35Z,2023-12-19T10:12:35Z,"> How would this differ from `rss.data.replica.write`

This may only write one replica but the replica can be stored in different servers.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vAyhX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ve4rr,incubator-uniffle,1870367467,1373,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-12-27T14:41:02Z,2023-12-27T14:41:02Z, @jerqi @zuston added a dataflow diagram in ***describe the solution*** for implementation plan.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ve4rr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vku_9,incubator-uniffle,1871900669,1373,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-29T10:07:21Z,2023-12-29T10:07:21Z,"> @jerqi @zuston added a dataflow diagram in _**describe the solution**_ for implementation plan.

Looks good. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vku_9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vkxWg,incubator-uniffle,1871910304,1373,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2023-12-29T10:11:29Z,2023-12-29T10:11:29Z,"> @jerqi @zuston added a dataflow diagram in _**describe the solution**_ for implementation plan.

You would better give us a google document like https://docs.google.com/document/d/1p1PksBN2LJ-OtGEHvdyEuH9b1Mv1aD_exMPl4TNaTs0/edit#heading=h.c7fauf9cicbi","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vkxWg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vlIzK,incubator-uniffle,1872006346,1373,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2023-12-29T12:13:10Z,2023-12-29T12:13:10Z,"> > @jerqi @zuston added a dataflow diagram in _**describe the solution**_ for implementation plan.
> 
> You would better give us a google document like https://docs.google.com/document/d/1p1PksBN2LJ-OtGEHvdyEuH9b1Mv1aD_exMPl4TNaTs0/edit#heading=h.c7fauf9cicbi

OK. added a google doc https://docs.google.com/document/d/1FRGP82R7JBnr3IjmF8PQ6qWP9GnKQsk-N1OWk_f1kSY","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vlIzK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vvsE2,incubator-uniffle,1874772278,1373,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-03T02:15:51Z,2024-01-03T02:15:51Z,LGTM. Please go ahead.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vvsE2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KQwS0,incubator-uniffle,2319647924,1373,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-08-30T01:41:29Z,2024-08-30T01:41:29Z,"@xumanbu This is a great feature! But it seems not finished. I guess it lack a piece about how server reject the ` large partition` and split to write to another server. 

The existing logic handled `send data failed` and reassign the partitions related to these server, but for `large partition` case, the server is health, so the `send data` request should be succeed in general but failed for few partition data, so we should handle this case also.

WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KQwS0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KnSrh,incubator-uniffle,2325555937,1373,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2024-09-03T03:52:32Z,2024-09-03T03:52:32Z,"> @xumanbu This is a great feature! But it seems not finished. I guess it lack a piece about how server reject the ` large partition` and split to write to another server.
> 
> The existing logic handled `send data failed` and reassign the partitions related to these server, but for `large partition` case, the server is health, so the `send data` request should be succeed in general but failed for few partition data, so we should handle this case also.
> 
> WDYT?

Good consideration scene. But I think it's Ok at now. The `send data` request may fail for large partitions due to the server rejecting it with `StatusCode.NO_BUFFER_FOR_HUGE_PARTITION`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KnSrh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1373,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KoL6m,incubator-uniffle,2325790374,1373,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-03T07:26:55Z,2024-09-03T07:26:55Z,"@xumanbu Thanks for your reply, I submit a PR https://github.com/apache/incubator-uniffle/pull/2093/files  to support write shuffle data to multiple shuffle servers, PTAL.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KoL6m/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1375,https://api.github.com/repos/apache/incubator-uniffle/issues/1375,incubator-uniffle,2043200621,1375,[FEATURE] Support the rpc of getShuffleResultForMultiPart for rust server,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-12-15T08:53:57Z,2023-12-22T11:21:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

 Support the rpc of getShuffleResultForMultiPart for rust server

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1375/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1375,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vUNlI,incubator-uniffle,1867569480,1375,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-22T11:21:46Z,2023-12-22T11:21:46Z,This has been supported. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vUNlI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1380,https://api.github.com/repos/apache/incubator-uniffle/issues/1380,incubator-uniffle,2047220146,1380,[Improvement] optimize code logic for insertIntoBuffer,myandpr,20159351,yanmin,myanstu@163.com,CLOSED,2023-12-18T18:35:39Z,2023-12-19T03:23:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

1. Refactor to enhance code readability for function `insertIntoBuffer`.  

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1380/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1382,https://api.github.com/repos/apache/incubator-uniffle/issues/1382,incubator-uniffle,2048245384,1382,improvement(client): Client fast fai when heartbeat fail,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-12-19T09:18:55Z,2023-12-31T09:33:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When server GC and STW, tez client beartheat with server fail, but client not fast fail and is hang.

![image](https://github.com/apache/incubator-uniffle/assets/9440617/d7ad74ee-cc2b-4560-baa5-33139f61b6dd)


### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1382/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1383,https://api.github.com/repos/apache/incubator-uniffle/issues/1383,incubator-uniffle,2048496523,1383,[DOCS] Improve Netty's documentation,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2023-12-19T11:46:24Z,2023-12-19T12:52:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

After [#1349](https://github.com/apache/incubator-uniffle/pull/1349), we can only enable Netty by setting at least two parameters: `rss.server.netty.port` and `rss.rpc.server.type`. The documentation needs to be updated. Also, Netty should be capitalized.

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1383/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1385,https://api.github.com/repos/apache/incubator-uniffle/issues/1385,incubator-uniffle,2048875729,1385,[Improvement] Improve log4j appender layout pattern,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2023-12-19T15:19:19Z,2023-12-27T07:29:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In the current log output, the full logger name and code line number is not printed. It is very useful, we usually need this.

### How should we improve?

Improve the log4j appender layout pattern.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1385/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1385,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vdly-,incubator-uniffle,1870027966,1385,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2023-12-27T07:29:44Z,2023-12-27T07:29:44Z,Done by [#1392](https://github.com/apache/incubator-uniffle/pull/1392),"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vdly-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1387,https://api.github.com/repos/apache/incubator-uniffle/issues/1387,incubator-uniffle,2050113513,1387,[Bug] compatibility with jdk8 when call JavaUtils.newConcurrentMap ,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-12-20T08:51:14Z,2023-12-21T01:52:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

![image](https://github.com/apache/incubator-uniffle/assets/9440617/146d2518-7881-4775-9ad1-af20590a1449)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1387/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1387,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vG7W9,incubator-uniffle,1864086973,1387,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-12-20T08:51:55Z,2023-12-20T08:51:55Z,"When compile  with  jdk 8 and run in jdk8, it throw error. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vG7W9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1391,https://api.github.com/repos/apache/incubator-uniffle/issues/1391,incubator-uniffle,2054350228,1391,[Bug] Direct memory may leak in exceptional scenarios in shuffle server.,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2023-12-22T18:20:48Z,2023-12-25T02:02:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

code: https://github.com/apache/incubator-uniffle/pull/1357/files#diff-8ce1686a7767273a5dcf2f8520a9d7767582e7b3f21d8c12056a45d874b7bf44R151

According to [#1357](https://github.com/apache/incubator-uniffle/pull/1357), if the first for loop execution fails, the first `spd` in the list will not be released, which may cause memory leaks.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1391/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1391,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vYYVV,incubator-uniffle,1868662101,1391,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-25T02:02:13Z,2023-12-25T02:02:13Z,Done by #1392 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vYYVV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1398,https://api.github.com/repos/apache/incubator-uniffle/issues/1398,incubator-uniffle,2057054098,1398,[Improvement] [TEZ][MR] Make attempId computable and move it to taskAttemptId in BlockId layout.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2023-12-27T08:09:20Z,2024-07-05T07:19:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We found blockid was overflow when shuffle date is large enough, especially when the data is skewed.

For MR and TEZ, block is consist of sequentially increasing block id, task attempt id, partition id, task id.
The highest 12 bits are used for sequentially increasing block id, the next 6 bits are used for task attempt id, the next 24 bits are used for partition id, the lowest 21 bits  are used for task id. (Note: Ignore highest bit)
So if block size in one partition is larger than 2^12, will be overflow.

For spark, block size supports maximum of 2^18. Because the lowest 21 bits is from TaskContext::taskAttemptId, this is a sequentially increasing number, can be used to identify tasks and task attempts.

I think we could move the task attempt id to the lowest 21 bits, reduce the number of bits allocated to task attempt id. In general task attempt id is not large.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1398/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1398,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vdtAI,incubator-uniffle,1870057480,1398,NA,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,NA,2023-12-27T08:12:40Z,2023-12-27T08:12:40Z,Please assign this issue to me.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vdtAI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1399,https://api.github.com/repos/apache/incubator-uniffle/issues/1399,incubator-uniffle,2057065189,1399,[Improvement] support sequential unique block id,zhengchenyu,10381583,zhengchenyu,,OPEN,2023-12-27T08:21:03Z,2023-12-27T09:56:03Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The problem of block id overflow is described in #731, #1398.
The block id is used to verify whether the accurate block set is obtained. I think we can get the sequence id from shuffle server. It will be almost impossible for overflow to occur.
In map side, we can generate local block id. Then we report shuffle result. Shuffle will map the local block id to global sequential unique block id. In reduce side, we get shuffle result, then get the global sequential unique block id set.
Since block id is sequential, we only need to pass the length of the bock set.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1399/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1399,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vdvfH,incubator-uniffle,1870067655,1399,NA,zhengchenyu,10381583,zhengchenyu,,NA,2023-12-27T08:26:44Z,2023-12-27T08:26:44Z,This proposal has major changes to the API and needs to be fully discussed before development.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vdvfH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1399,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5veA6e,incubator-uniffle,1870139038,1399,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2023-12-27T09:56:02Z,2023-12-27T09:56:02Z,"For spark, the blockID is used to filter unused ids by upstream mapID

Could you help describe more about this design, how about drafting a proposal?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5veA6e/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,incubator-uniffle,2057912321,1401,[Umbrella] Enhance dashboard capabilities.,yl09099,33595968,,,CLOSED,2023-12-28T02:16:35Z,2024-08-02T12:32:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

You can configure one dashboard to manage multiple clusters, and add dashboard management functions for Coordinators and ShuffleServer.Reference documents for specific functions:
https://docs.google.com/document/d/1pR-pTn3aIZHpKSYDmFVdTijDwaT7INFVXJd5VG0WVpg/edit

### Task list

- Added the ability for the dashboard to connect to multiple coordinators and shuffle servers.
- Add sorting and search functions to the dashboard list area for ease of use.
- Added the dashboard account password login function.
- Dashboard added functions for adding and deleting ShuffleServer nodes offline and blacklist.
- Added monitoring status indicators of the ShuffleServer node.
- https://github.com/apache/incubator-uniffle/issues/1618
- https://github.com/apache/incubator-uniffle/issues/1622
- https://github.com/apache/incubator-uniffle/issues/1623
- https://github.com/apache/incubator-uniffle/issues/1624
- https://github.com/apache/incubator-uniffle/issues/1688

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1401/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vgY1v,incubator-uniffle,1870761327,1401,NA,yl09099,33595968,,,NA,2023-12-28T02:18:39Z,2023-12-28T02:18:39Z,@zuston @jerqi @lifeSo Let's see if these functions make sense.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vgY1v/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vhRcA,incubator-uniffle,1870993152,1401,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2023-12-28T09:40:52Z,2023-12-28T09:40:52Z,"> @zuston @jerqi @lifeSo Let's see if these functions make sense.

OK, I am new to dashboard, let's me see see first and will try.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vhRcA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vrGZr,incubator-uniffle,1873569387,1401,NA,yl09099,33595968,,,NA,2024-01-02T02:11:43Z,2024-01-02T02:11:43Z,"> Is the current dashboard functioning correctly? I see many 404 error requests on all dashboard pages. ![image](https://private-user-images.githubusercontent.com/13834479/293407204-18c8a4a9-2d87-4b9c-a1c4-0711f84a6c31.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDQxNjE0MzUsIm5iZiI6MTcwNDE2MTEzNSwicGF0aCI6Ii8xMzgzNDQ3OS8yOTM0MDcyMDQtMThjOGE0YTktMmQ4Ny00YjljLWExYzQtMDcxMWY4NGE2YzMxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAxMDIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMTAyVDAyMDUzNVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTk5NjdkNjRiMjZhMGQxNTMwZDNjZGFlZDNjMzExNmUyYjhiNGY3ZjVkYWNiNjc5OTgyMmYzY2JkNTA2YThjMjcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.yR3WXkO3Axa39dJ-IHlkXmJieHcLqYDzJhJR-cvhIeE) ![image](https://private-user-images.githubusercontent.com/13834479/293407378-19e98fc7-2fb3-441f-834f-f15be73d0efd.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDQxNjE0MzUsIm5iZiI6MTcwNDE2MTEzNSwicGF0aCI6Ii8xMzgzNDQ3OS8yOTM0MDczNzgtMTllOThmYzctMmZiMy00NDFmLTgzNGYtZjE1YmU3M2QwZWZkLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAxMDIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMTAyVDAyMDUzNVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWNjMWE0NDE2ZTY3ZDk4ODBmMzc2NGNmNDc1ZDVmZTk4ZWMzZThkMmYxZGVlMjRiYjljZTI0NTQzN2VkOWUxMGMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.yJ5OHnoO9miWyy41xO9KLHif_UFZV5-bZuITJFvY_cE) ![image](https://private-user-images.githubusercontent.com/13834479/293407404-475a3172-5976-4b90-8fd9-205f65ebada7.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDQxNjE0MzUsIm5iZiI6MTcwNDE2MTEzNSwicGF0aCI6Ii8xMzgzNDQ3OS8yOTM0MDc0MDQtNDc1YTMxNzItNTk3Ni00YjkwLThmZDktMjA1ZjY1ZWJhZGE3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAxMDIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMTAyVDAyMDUzNVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWMxMDBmZDMzZGExMzFlZTNiNTgyYWU2YzVhNDI5YWJmMGE4MzcyYzc5MWU0MDZhZjU3Y2M1OTFiNGEzNTgwMzAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.-7EhuJ2PSIfr6Zp06tmHVpy09aKlDIwgoHWweBJz3K0) @yl09099 @lifeSo @jerqi

Is the code up to date?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vrGZr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vrMvM,incubator-uniffle,1873595340,1401,NA,yl09099,33595968,,,NA,2024-01-02T03:36:46Z,2024-01-02T03:36:46Z,"> It's up to date. I don't know why this is happening. Am I missing something? @yl09099

Is the Coordinator interface access address correctly configured? The error is that the interface cannot be accessed，Refer to configuration here：https://github.com/apache/incubator-uniffle/blob/master/docs/dashboard_guide.md.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vrMvM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vreml,incubator-uniffle,1873668517,1401,NA,yl09099,33595968,,,NA,2024-01-02T06:49:25Z,2024-01-02T06:49:25Z,"> So I am just wondering, if the latest code works fine?

You should have no problem using the latest version of the code.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vreml/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wzeVV,incubator-uniffle,1892541781,1401,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-15T17:15:53Z,2024-01-15T17:15:53Z,"Can we display `usedDirectMemory` on the Dashboard's shuffle server page(which is very useful in my opinion)? Maybe add a column? If you think there are too many columns and it doesn't look nice, can we remove the first column `Id`? Displaying `Id` on the page doesn't serve any purpose, right? `Id` can be composed of the values in the following columns (IP + GrpcPort + NettyPort).

PTAL @yl09099 ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wzeVV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5w1nvb,incubator-uniffle,1893104603,1401,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-16T05:43:26Z,2024-01-16T05:43:26Z,"I personly do not think add `usedDirectMemory` is necessary if your company have other monitor system like:

![image](https://github.com/apache/incubator-uniffle/assets/9440617/f8abcacd-eb05-4e0f-8af7-da8bf92962ca)

If I want to see the metric, I will use metric system instead of dashboard.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5w1nvb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5w1oIW,incubator-uniffle,1893106198,1401,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-16T05:45:48Z,2024-01-16T05:45:48Z,"Id can be composed of the values in the following columns (IP + GrpcPort + NettyPort).

@yl09099  What do you think ? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5w1oIW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5w1wMZ,incubator-uniffle,1893139225,1401,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-16T06:24:51Z,2024-01-16T06:24:51Z,"![image](https://github.com/apache/incubator-uniffle/assets/13834479/9270431b-d877-43c2-8731-ea60642cda3e)
`usedDirectMemory` has already become a very important metric in the latest Uniffle(especially when enabling Netty). 

I'm just making a suggestion for your reference. Since the `Id` is not very useful anymore(actually useless), you might as well  conveniently replace it with `usedDirectMemory`.

@lifeSo ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5w1wMZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5w2vel,incubator-uniffle,1893398437,1401,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-16T09:48:49Z,2024-01-16T09:48:49Z,"It is my  personal opinion， if you persist it. 
I just think dashboard is the place to operate server， and there is monitor system to see metric.
@jerqi   @yl09099  What's your idea?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5w2vel/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xsG3Y,incubator-uniffle,1907387864,1401,NA,yl09099,33595968,,,NA,2024-01-24T05:07:50Z,2024-01-24T05:07:50Z,"> Can we display `usedDirectMemory` on the Dashboard's shuffle server page(which is very useful in my opinion)? Maybe add a column? If you think there are too many columns and it doesn't look nice, can we remove the first column `Id`? Displaying `Id` on the page doesn't serve any purpose, right? `Id` can be composed of the values in the following columns (IP + GrpcPort + NettyPort).
> 
> PTAL @yl09099

I don't think it's useful either. We can change it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xsG3Y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xsHIH,incubator-uniffle,1907388935,1401,NA,yl09099,33595968,,,NA,2024-01-24T05:09:19Z,2024-01-24T05:09:19Z,"> I personly do not think add `usedDirectMemory` is necessary if your company have other monitor system like:
> 
> ![image](https://private-user-images.githubusercontent.com/9440617/296943231-f8abcacd-eb05-4e0f-8af7-da8bf92962ca.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDYwNzI5MzYsIm5iZiI6MTcwNjA3MjYzNiwicGF0aCI6Ii85NDQwNjE3LzI5Njk0MzIzMS1mOGFiY2FjZC1lYjA1LTRlMGYtOGFmNy1kYThiZjkyOTYyY2EucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDEyNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDAxMjRUMDUwMzU2WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NzMzZmNiOGMzZTgyNjFkMDFiMDQyOGE5NDE2MzhhOTI3NzBiZGU4YWUyNWRiMTY1NTA5OTUyYWJmZmQ4NWRhYyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.85deudrLRsJuTIOoI2E8SDxRMLabaAvE0KGUc22Uo-Q)
> 
> If I want to see the metric, I will use metric system instead of dashboard.

I also do not have what good idea, document change inside, https://docs.google.com/document/d/1pR-pTn3aIZHpKSYDmFVdTijDwaT7INFVXJd5VG0WVpg/edit","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xsHIH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xsHg5,incubator-uniffle,1907390521,1401,NA,yl09099,33595968,,,NA,2024-01-24T05:11:45Z,2024-01-24T05:11:45Z,"> Id can be composed of the values in the following columns (IP + GrpcPort + NettyPort).
> 
> @yl09099 What do you think ?

I think it's useless. We can change it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xsHg5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1401,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHBJg,incubator-uniffle,2182877792,1401,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-21T14:36:15Z,2024-06-21T14:36:15Z,I think this is not finished yet.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHBJg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1403,https://api.github.com/repos/apache/incubator-uniffle/issues/1403,incubator-uniffle,2058573304,1403,[Bug] RSS client configurations are not working.,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2023-12-28T15:37:56Z,2024-01-03T08:10:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

For example, the following configurations no longer work:
```
<client_type>.rss.client.netty.io.mode
<client_type>.rss.client.netty.client.connection.timeout.ms
<client_type>.rss.client.netty.client.threads
<client_type>.rss.client.netty.client.prefer.direct.bufs
<client_type>.rss.client.netty.client.connections.per.peer
<client_type>.rss.client.netty.client.receive.buffer
<client_type>.rss.client.netty.client.send.buffer
```

It is a bug introduced from [#1228](https://github.com/apache/incubator-uniffle/pull/1228).

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1403/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1403,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vwfn-,incubator-uniffle,1874983422,1403,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-03T08:10:13Z,2024-01-03T08:10:13Z,Done by [#1404](https://github.com/apache/incubator-uniffle/pull/1404),"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vwfn-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1405,https://api.github.com/repos/apache/incubator-uniffle/issues/1405,incubator-uniffle,2058659496,1405,[Improvement] Prometheus instanceId modified to hostname,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2023-12-28T17:15:55Z,2024-01-04T17:13:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Current Prometheus not show as IP, instead, it show as ip, so change it to hostname for convenient。

![image](https://github.com/apache/incubator-uniffle/assets/9440617/140bdea0-0796-4b86-9892-caee86b9d737)


### How should we improve?

change PrometheusPushGatewayMetricReporter related code.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1405/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1407,https://api.github.com/repos/apache/incubator-uniffle/issues/1407,incubator-uniffle,2059259688,1407,[Improvement] Rust based server optimization,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2023-12-29T09:55:13Z,2024-01-29T05:56:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

### Rust optimization as follows

- [x] #1408 
  - [x] fix getting blockId failure
  - [x] support unregister/finish shuffle grpc interface explicitly
  - [x] fix the memory reserve when app is deleted
  - [x] fix the buffer ticket reserve when app is deleted. 
     - [x] add test cases 
     - [x] fix the release bug when the partial data sent failed, the allocated should be released 
     - [x] refactor ticket management 
  - [x] optimize the lock performance when high concurrency of writing
- [ ] detailed test report with GRPC_NETTY + GRPC uniffle shuffle server
- [x] #1414 
- [ ] construct the end-to-end tests into github CI workflow by the spark jobs
- [ ] remove the console_subscribe dependenecy.
- [ ] simplify the toml config

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1407/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1409,https://api.github.com/repos/apache/incubator-uniffle/issues/1409,incubator-uniffle,2060277607,1409,[Bug] Netty Epoll is unavailable for the RSS Client.,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2023-12-29T17:27:10Z,2024-01-03T08:09:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When the RSS Client enables Netty and sets the mode to Epoll, the following error will be reported:
`[22:21:37:071] [pool-3-thread-1] INFO  RetryUtils.retryWithCondition - Retry due to Throwable, java.lang.UnsatisfiedLinkError`
After further investigation, it was found that this issue is related to this PR [#924](https://github.com/apache/incubator-uniffle/pull/924) not functioning properly.

The Netty native libraries have never been successfully shaded. PR [#924](https://github.com/apache/incubator-uniffle/pull/924) is not working at all.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1409/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1409,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vwffq,incubator-uniffle,1874982890,1409,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-03T08:09:36Z,2024-01-03T08:09:36Z,Done by [#1410](https://github.com/apache/incubator-uniffle/pull/1410),"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5vwffq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1414,https://api.github.com/repos/apache/incubator-uniffle/issues/1414,incubator-uniffle,2063328229,1414,[FEATURE] native hdfs client for rust,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-01-03T06:42:59Z,2024-01-04T02:19:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

hdfs-native is ready for production. Let's rock it

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1414/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1416,https://api.github.com/repos/apache/incubator-uniffle/issues/1416,incubator-uniffle,2065302250,1416,[FEATURE] Support custom hadoop config in client side,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-01-04T09:29:27Z,2024-01-08T03:42:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

It's necessary to support user specify custom hadoop config in client side for remote storage.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1416/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1416,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wE8tM,incubator-uniffle,1880345420,1416,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-08T03:42:43Z,2024-01-08T03:42:43Z,#1417 Done.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wE8tM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1420,https://api.github.com/repos/apache/incubator-uniffle/issues/1420,incubator-uniffle,2066014810,1420,[Bug] reportShuffleWriteFailure failed because of IndexOutOfBoundsException,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-04T16:55:45Z,2024-01-05T15:06:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

![image](https://github.com/apache/incubator-uniffle/assets/13834479/ce28a985-af3d-4fd9-b56c-8e0aea17b45e)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1420/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,incubator-uniffle,2071561477,1426,[FEATURE] Print out the task shuffle write time statistics by table format in log,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-01-09T03:27:07Z,2024-02-05T06:43:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, we can't find out the slow shuffle-server in the client side log, this is not ease to use, especially for server with terriable GC.

I hope the metric with the server dimension for one spark task could be shown like the following table format in the client side log.

|                              |        Min        |   25th percentile  |       Median      | 75th percentile    | Max                |
|------------------------------|:-----------------:|:------------------:|:-----------------:|--------------------|--------------------|
| Shuffle Write Duration       | 10s               | 15s                | 25s               | 30s                | 4min               |
| Shuffle Write Size / Records | 20M / 10000       | 20M / 10000        | 20M / 10000       | 20M / 10000        | 20M / 10000        |
| Shuffle server list          | 10.23.35.19-21001 | 10.23.35.134-21001 | 10.23.35.14-21001 | 10.23.315.14-21001 | 10.123.35.14-21001 |


 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1426/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wMhxJ,incubator-uniffle,1882332233,1426,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-09T03:27:40Z,2024-01-09T03:27:40Z,Feel free to pick this up. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wMhxJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wMiWT,incubator-uniffle,1882334611,1426,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-09T03:28:48Z,2024-01-09T03:28:48Z,Are you interested on this? @myandpr ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wMiWT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wMk1_,incubator-uniffle,1882344831,1426,NA,myandpr,20159351,yanmin,myanstu@163.com,NA,2024-01-09T03:33:46Z,2024-01-09T03:33:46Z,"> Are you interested on this? @myandpr

Fine，please assign to me, thanks @zuston !","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wMk1_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wMrHv,incubator-uniffle,1882370543,1426,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-01-09T03:49:18Z,2024-01-09T03:49:18Z,Should we use Spark's metrics instead of log?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wMrHv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wNDX8,incubator-uniffle,1882469884,1426,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-09T06:13:37Z,2024-01-09T06:13:37Z,"> Should we use Spark's metrics instead of log?

This may be also valid for MR and Tez. BTW, the task metrics for low shuffle-server don't exist. I haven't seen this metric.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wNDX8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wNELA,incubator-uniffle,1882473152,1426,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-01-09T06:17:30Z,2024-01-09T06:17:30Z,"> > Should we use Spark's metrics instead of log?
> 
> This may be also valid for MR and Tez. BTW, the task metrics for low shuffle-server don't exist. I haven't seen this metric.

This should be a metric instead of log. The log seems weird.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wNELA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wNYDG,incubator-uniffle,1882554566,1426,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-09T07:44:38Z,2024-01-09T07:44:38Z,So how to meet the requirement if using metrics ? @jerqi Can you give some ideas if you want,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wNYDG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wNkgn,incubator-uniffle,1882605607,1426,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-01-09T08:26:49Z,2024-01-09T08:26:49Z,"> So how to meet the requirement if using metrics ? @jerqi Can you give some ideas if you want

Spark metrics system allows user to add extra metrics. You can refer to https://simhadri-g.medium.com/custom-metrics-source-in-apache-spark-ca30a3b362dd","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wNkgn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wN2it,incubator-uniffle,1882679469,1426,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-09T09:16:08Z,2024-01-09T09:16:08Z,"> > So how to meet the requirement if using metrics ? @jerqi Can you give some ideas if you want
> 
> Spark metrics system allows user to add extra metrics. You can refer to https://simhadri-g.medium.com/custom-metrics-source-in-apache-spark-ca30a3b362dd

Looks good. ping @myandpr If you have any idea, feel free to discuss","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wN2it/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wTeAh,incubator-uniffle,1884151841,1426,NA,myandpr,20159351,yanmin,myanstu@163.com,NA,2024-01-10T03:54:03Z,2024-01-10T03:54:03Z,"> > > So how to meet the requirement if using metrics ? @jerqi Can you give some ideas if you want
> > 
> > 
> > Spark metrics system allows user to add extra metrics. You can refer to https://simhadri-g.medium.com/custom-metrics-source-in-apache-spark-ca30a3b362dd
> 
> Looks good. ping @myandpr If you have any idea, feel free to discuss

fine,I think I understand this feature. Let me look at the logic about spark metrics system.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wTeAh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1426,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y0WIG,incubator-uniffle,1926324742,1426,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-05T06:43:46Z,2024-02-05T06:43:46Z,"> > > > So how to meet the requirement if using metrics ? @jerqi Can you give some ideas if you want
> > > 
> > > 
> > > Spark metrics system allows user to add extra metrics. You can refer to https://simhadri-g.medium.com/custom-metrics-source-in-apache-spark-ca30a3b362dd
> > 
> > 
> > Looks good. ping @myandpr If you have any idea, feel free to discuss
> 
> fine,I think I understand this feature. Let me look at the logic about spark metrics system.

Maybe we could introduce extra tab page in spark UI(runtime + history server) to show more infos about shuffle-servers, like kyuubi did. https://github.com/apache/kyuubi/tree/master/externals/kyuubi-spark-sql-engine/src/main/scala/org/apache/spark/ui","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5y0WIG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1428,https://api.github.com/repos/apache/incubator-uniffle/issues/1428,incubator-uniffle,2073486510,1428,[Bug] Fallback invalid when local storage's all disks are in high watermark ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-01-10T02:48:12Z,2024-01-17T05:45:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I specify the following conf.

```
# HDFS fallback strategy
rss.server.hybrid.storage.fallback.strategy.class       org.apache.uniffle.server.storage.LocalStorageManagerFallbackStrategy
rss.server.hybrid.storage.manager.selector.class        org.apache.uniffle.server.storage.hybrid.HugePartitionSensitiveStorageManagerSelector
```


For one shuffle-server, fallback to hadoop storage is  invalid when local storage's all disks are in high watermark.

Because once all disks are in high-watermark, it will return null in selectStorage, and because the retry time default value is 0 in `LocalStorageManagerFallbackStrategy`. So it won't be fallbacked and then the event will be discarded in `DefaultFlushEventHandler`.

The logs are as follows:

![image](https://github.com/apache/incubator-uniffle/assets/8609142/06e37582-e1fc-4113-bc48-41406783ed26)



I will fix this using the following 2 steps
1. allow setting the negative value for `rss.server.hybrid.storage.fallback.max.fail.times`
2. optimize `DefaultFlushEventHandler` when encountering null storage for one flush event. 

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1428/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1433,https://api.github.com/repos/apache/incubator-uniffle/issues/1433,incubator-uniffle,2074049255,1433,[Bug] Race conditions with ShuffleServer state,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-01-10T10:22:01Z,2024-01-12T02:30:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The ShuffleServer state transitions are subject to race conditions. In unlikely but possible situations, states can transition undesirably, e.g.
- `DECOMMISSIONING` -> `UNHEALTHY` -> `ACTIVE` (though still unhealthy)
- `DECOMMISSIONING` -> `UNHEALTHY` (decommissioning stopped)
- `ACTIVE` -> any non-`ACTIVE` -> `DECOMMISSIONING` (not allowed by code)

Example:
```Java
if (!ServerStatus.ACTIVE.equals(serverStatus.get())) {
  throw new InvalidRequestException(
      ""Shuffle Server is processing other procedures, current status:"" + serverStatus);
}
serverStatus.set(ServerStatus.DECOMMISSIONING);
```
Just before line `serverStatus.set(ServerStatus.DECOMMISSIONING);`, the state could change, so it is not guaranteed that `ACTIVE` state turns into `DECOMMISSIONING`.

Having an `AtomicReference<ServerStatus>`, this should look like:
```Java
boolean wasActive = serverStatus.compareAndSet(ServerStatus.ACTIVE, ServerStatus.DECOMMISSIONING);
if (!wasActive) {
  throw new InvalidRequestException(
      ""Shuffle Server is processing other procedures, current status:"" + serverStatus);
}
```

Ideally, you would use `compareAndExchange`, so that the state in the exception is accurate (that could change in the meantime as well), but I get such a warning for that: `Usage of API documented as @since 1.9+`:
```Java
ServerStatus before = serverStatus.compareAndExchange(ServerStatus.ACTIVE, ServerStatus.DECOMMISSIONING);
if (!ServerStatus.ACTIVE.equals(before)) {
  throw new InvalidRequestException(
          ""Shuffle Server is processing other procedures, current status:"" + before);
}
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1433/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1435,https://api.github.com/repos/apache/incubator-uniffle/issues/1435,incubator-uniffle,2074280087,1435,[Improvement] Improve log4j settings to avoid annoying messages,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-10T12:33:14Z,2024-01-12T05:13:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, when we enable debug logs, we'll find a large number of annoying log messages(of course useless). We need to have separate log levels for these annoying logs and set their default log level to INFO.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1435/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1437,https://api.github.com/repos/apache/incubator-uniffle/issues/1437,incubator-uniffle,2074677547,1437,optimize TestUtils.httpGet in ShuffleServerGrpcTest.sendDataAndRequireBufferTest(),lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2024-01-10T15:58:06Z,2024-01-10T15:58:43Z,"              This is really weird. Maybe we could optimize this in the another PR.

_Originally posted by @zuston in https://github.com/apache/incubator-uniffle/pull/1425#discussion_r1444150953_
            ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1437/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1438,https://api.github.com/repos/apache/incubator-uniffle/issues/1438,incubator-uniffle,2074709075,1438,[Improvement] optimize TestUtils.httpGet in ShuffleServerGrpcTest.sendDataAndRequireBufferTest(),lifeSo,9440617,Qing,1169158401@qq.com,OPEN,2024-01-10T16:15:07Z,2024-01-10T16:15:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

optimize TestUtils.httpGet in ShuffleServerGrpcTest.sendDataAndRequireBufferTest()

https://github.com/apache/incubator-uniffle/pull/1425#discussion_r1444150953

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1438/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1439,https://api.github.com/repos/apache/incubator-uniffle/issues/1439,incubator-uniffle,2074911060,1439,[SpotBugs] Fix SC_START_IN_CTOR,lifeSo,9440617,Qing,1169158401@qq.com,CLOSED,2024-01-10T18:09:41Z,2024-01-27T01:51:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Fix SC_START_IN_CTOR SpotBugs suggestion.

### How should we improve?

Fix SC_START_IN_CTOR SpotBugs suggestion.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1439/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1439,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yBK2z,incubator-uniffle,1912909235,1439,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-27T01:51:31Z,2024-01-27T01:51:31Z,"Refer to :
https://github.com/apache/incubator-uniffle/pull/1440

Fixed it and close the issue.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yBK2z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1443,https://api.github.com/repos/apache/incubator-uniffle/issues/1443,incubator-uniffle,2076344771,1443,[Bug] IllegalReferenceCountException: refCnt: 0 in ShuffleReadClientImpl.readShuffleBlockData,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-11T11:17:13Z,2024-01-11T16:02:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

<img width=""1114"" alt=""0a63cf4d8fb119d055dfc69e328c893"" src=""https://github.com/apache/incubator-uniffle/assets/13834479/0392b89c-c13f-49cb-b4c8-48d433fb3e60"">


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1443/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1443,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5weCxS,incubator-uniffle,1886923858,1443,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-11T11:17:51Z,2024-01-11T11:17:51Z,"@leixm 
cc @jerqi @zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5weCxS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1443,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wgKpE,incubator-uniffle,1887480388,1443,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-11T16:02:35Z,2024-01-11T16:02:35Z,Not a bug. Closed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wgKpE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1446,https://api.github.com/repos/apache/incubator-uniffle/issues/1446,incubator-uniffle,2078908651,1446,[Flaky Test] Kerberos-related tests fail on vanilla Ubuntu,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,OPEN,2024-01-12T14:00:18Z,2024-09-12T09:39:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

Running `mvn test` on a clean checkout fails:

Running in a fresh Ubuntu 20.04: `docker run --rm -it ubuntu:20.04 /bin/bash`
```bash
apt update
DEBIAN_FRONTEND=noninteractive apt install -y git openjdk-8-jdk-headless maven
git clone https://github.com/apache/incubator-uniffle.git
cd incubator-uniffle
mvn test -Dtest=org.apache.uniffle.common.filesystem.HadoopFilesystemProviderTest
```
I get the following test error:
```
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.apache.uniffle.common.filesystem.HadoopFilesystemProviderTest
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 38.739 s <<< FAILURE! - in org.apache.uniffle.common.filesystem.HadoopFilesystemProviderTest
[ERROR] org.apache.uniffle.common.filesystem.HadoopFilesystemProviderTest  Time elapsed: 38.737 s  <<< ERROR!
java.lang.Exception: java.io.IOException: Failed on local exception: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Message stream modified (41) - Message stream modified)]; Host Details : local host is: ""e63c10289941/172.17.0.3""; destination host is: ""localhost"":35997; 
	at org.apache.uniffle.common.KerberizedHadoop.setup(KerberizedHadoop.java:105)
	at org.apache.uniffle.common.KerberizedHadoopBase.init(KerberizedHadoopBase.java:36)
	at org.apache.uniffle.common.filesystem.HadoopFilesystemProviderTest.beforeAll(HadoopFilesystemProviderTest.java:44)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptLifecycleMethod(TimeoutExtension.java:126)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptBeforeAllMethod(TimeoutExtension.java:68)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeBeforeAllMethods$11(ClassBasedTestDescriptor.java:397)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.invokeBeforeAllMethods(ClassBasedTestDescriptor.java:395)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.before(ClassBasedTestDescriptor.java:209)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.before(ClassBasedTestDescriptor.java:80)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:148)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1541)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.io.IOException: Failed on local exception: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Message stream modified (41) - Message stream modified)]; Host Details : local host is: ""e63c10289941/172.17.0.3""; destination host is: ""localhost"":35997; 
	at org.apache.hadoop.net.NetUtils.wrapException(NetUtils.java:782)
	at org.apache.hadoop.ipc.Client.getRpcResponse(Client.java:1493)
	at org.apache.hadoop.ipc.Client.call(Client.java:1435)
	at org.apache.hadoop.ipc.Client.call(Client.java:1345)
	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:227)
	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:116)
	at com.sun.proxy.$Proxy29.getDatanodeReport(Unknown Source)
	at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.getDatanodeReport(ClientNamenodeProtocolTranslatorPB.java:649)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:409)
	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeMethod(RetryInvocationHandler.java:163)
	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invoke(RetryInvocationHandler.java:155)
	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeOnce(RetryInvocationHandler.java:95)
	at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:346)
	at com.sun.proxy.$Proxy30.getDatanodeReport(Unknown Source)
	at org.apache.hadoop.hdfs.DFSClient.datanodeReport(DFSClient.java:2108)
	at org.apache.hadoop.hdfs.MiniDFSCluster.waitActive(MiniDFSCluster.java:2463)
	at org.apache.hadoop.hdfs.MiniDFSCluster.waitActive(MiniDFSCluster.java:2507)
	at org.apache.hadoop.hdfs.MiniDFSCluster.startDataNodes(MiniDFSCluster.java:1541)
	at org.apache.hadoop.hdfs.MiniDFSCluster.initMiniDFSCluster(MiniDFSCluster.java:851)
	at org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:485)
	at org.apache.hadoop.hdfs.MiniDFSCluster$Builder.build(MiniDFSCluster.java:444)
	at org.apache.uniffle.common.KerberizedHadoop$1.run(KerberizedHadoop.java:214)
	at org.apache.uniffle.common.KerberizedHadoop$1.run(KerberizedHadoop.java:205)
	at java.base/java.security.AccessController.doPrivileged(Native Method)
	at java.base/javax.security.auth.Subject.doAs(Subject.java:423)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1844)
	at org.apache.uniffle.common.KerberizedHadoop.lambda$startKerberizedDFS$0(KerberizedHadoop.java:204)
	at org.apache.uniffle.common.util.RetryUtils.retryWithCondition(RetryUtils.java:81)
	at org.apache.uniffle.common.util.RetryUtils.retry(RetryUtils.java:61)
	at org.apache.uniffle.common.util.RetryUtils.retry(RetryUtils.java:41)
	at org.apache.uniffle.common.KerberizedHadoop.startKerberizedDFS(KerberizedHadoop.java:194)
	at org.apache.uniffle.common.KerberizedHadoop.setup(KerberizedHadoop.java:103)
	... 61 more
Caused by: java.io.IOException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Message stream modified (41) - Message stream modified)]
	at org.apache.hadoop.ipc.Client$Connection$1.run(Client.java:755)
	at java.base/java.security.AccessController.doPrivileged(Native Method)
	at java.base/javax.security.auth.Subject.doAs(Subject.java:423)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1844)
	at org.apache.hadoop.ipc.Client$Connection.handleSaslConnectionFailure(Client.java:718)
	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:811)
	at org.apache.hadoop.ipc.Client$Connection.access$3500(Client.java:410)
	at org.apache.hadoop.ipc.Client.getConnection(Client.java:1550)
	at org.apache.hadoop.ipc.Client.call(Client.java:1381)
	... 94 more
Caused by: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Message stream modified (41) - Message stream modified)]
	at jdk.security.jgss/com.sun.security.sasl.gsskerb.GssKrb5Client.evaluateChallenge(GssKrb5Client.java:222)
	at org.apache.hadoop.security.SaslRpcClient.saslConnect(SaslRpcClient.java:406)
	at org.apache.hadoop.ipc.Client$Connection.setupSaslConnection(Client.java:614)
	at org.apache.hadoop.ipc.Client$Connection.access$2200(Client.java:410)
	at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:798)
	at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:794)
	at java.base/java.security.AccessController.doPrivileged(Native Method)
	at java.base/javax.security.auth.Subject.doAs(Subject.java:423)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1844)
	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:793)
	... 97 more
Caused by: GSSException: No valid credentials provided (Mechanism level: Message stream modified (41) - Message stream modified)
	at java.security.jgss/sun.security.jgss.krb5.Krb5Context.initSecContext(Krb5Context.java:773)
	at java.security.jgss/sun.security.jgss.GSSContextImpl.initSecContext(GSSContextImpl.java:266)
	at java.security.jgss/sun.security.jgss.GSSContextImpl.initSecContext(GSSContextImpl.java:196)
	at jdk.security.jgss/com.sun.security.sasl.gsskerb.GssKrb5Client.evaluateChallenge(GssKrb5Client.java:203)
	... 106 more
Caused by: KrbException: Message stream modified (41) - Message stream modified
	at java.security.jgss/sun.security.krb5.KrbTgsRep.<init>(KrbTgsRep.java:73)
	at java.security.jgss/sun.security.krb5.KrbTgsReq.getReply(KrbTgsReq.java:226)
	at java.security.jgss/sun.security.krb5.KrbTgsReq.sendAndGetCreds(KrbTgsReq.java:237)
	at java.security.jgss/sun.security.krb5.internal.CredentialsUtil.serviceCredsSingle(CredentialsUtil.java:477)
	at java.security.jgss/sun.security.krb5.internal.CredentialsUtil.serviceCreds(CredentialsUtil.java:340)
	at java.security.jgss/sun.security.krb5.internal.CredentialsUtil.serviceCreds(CredentialsUtil.java:314)
	at java.security.jgss/sun.security.krb5.internal.CredentialsUtil.acquireServiceCreds(CredentialsUtil.java:169)
	at java.security.jgss/sun.security.krb5.Credentials.acquireServiceCreds(Credentials.java:490)
	at java.security.jgss/sun.security.jgss.krb5.Krb5Context.initSecContext(Krb5Context.java:697)
	... 109 more
Caused by: KrbException: Identifier doesn't match expected value (906)
	at java.security.jgss/sun.security.krb5.internal.KDCRep.init(KDCRep.java:140)
	at java.security.jgss/sun.security.krb5.internal.TGSRep.init(TGSRep.java:65)
	at java.security.jgss/sun.security.krb5.internal.TGSRep.<init>(TGSRep.java:60)
	at java.security.jgss/sun.security.krb5.KrbTgsRep.<init>(KrbTgsRep.java:55)
	... 117 more

[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Errors: 
[ERROR]   HadoopFilesystemProviderTest.beforeAll:44->KerberizedHadoopBase.init:36 ?  jav...
[INFO] 
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary for Apache Uniffle 0.9.0-SNAPSHOT:
[INFO] 
[INFO] Apache Uniffle ..................................... SUCCESS [ 49.712 s]
[INFO] Apache Uniffle Protocols ........................... SUCCESS [ 51.562 s]
[INFO] Apache Uniffle Common .............................. FAILURE [02:09 min]
[INFO] Apache Uniffle Internal Client ..................... SKIPPED
[INFO] Apache Uniffle Coordinator ......................... SKIPPED
[INFO] Apache Uniffle Storage ............................. SKIPPED
[INFO] Apache Uniffle Server .............................. SKIPPED
[INFO] Apache Uniffle Client .............................. SKIPPED
[INFO] Apache Uniffle CLI ................................. SKIPPED
[INFO] Apache Uniffle Integration Test (Common) ........... SKIPPED
[INFO] Apache Uniffle Dashboard ........................... SKIPPED
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  04:05 min
[INFO] Finished at: 2024-01-12T12:43:45Z
[INFO] ------------------------------------------------------------------------
```

### Actions URL

none

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1446/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1447,https://api.github.com/repos/apache/incubator-uniffle/issues/1447,incubator-uniffle,2080335834,1447,[FEATURE] Introduce configurations to control default behavior of RPC client,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-13T15:03:51Z,2024-01-16T09:53:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the default values for the timeout and maxAttempts configurations of RPC are hard-coded in the code.

We need to introduce the configurations like below to control default behavior of RPC:
|Property Name|Default| Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---|---|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|<client_type>.rss.client.rpc.timeout.ms|60000| Timeout in milliseconds for RPC calls.|
|<client_type>.rss.client.rpc.maxAttempts|3| When we fail to send RPC calls, we will retry for maxAttempts times.|

I think this is very useful. In some circumstances, we need to change the default values.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1447/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1450,https://api.github.com/repos/apache/incubator-uniffle/issues/1450,incubator-uniffle,2081371305,1450,[Bug] Flush failure retry invalid,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-01-15T06:58:12Z,2024-01-25T02:41:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Currently, the memory -> file flush failure retry is invalid.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1450/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1450,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wvORG,incubator-uniffle,1891427398,1450,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-15T06:58:22Z,2024-01-15T06:58:22Z,PTAL @leixm ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wvORG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1450,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xzNt1,incubator-uniffle,1909250933,1450,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-25T02:41:02Z,2024-01-25T02:41:02Z,Has been done #1429,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xzNt1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1451,https://api.github.com/repos/apache/incubator-uniffle/issues/1451,incubator-uniffle,2081405104,1451,[FEATURE] introduce dedicated healthy metrics for every local disk,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-01-15T07:25:24Z,2024-02-22T04:33:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

introduce dedicated healthy metrics for every local disk

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1451/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wvW20,incubator-uniffle,1891462580,1451,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-15T07:29:55Z,2024-01-15T07:29:55Z,"I think it is not hard, so added ""gooed first issue"", ok ?
@zuston ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wvW20/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wvgoa,incubator-uniffle,1891502618,1451,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-15T07:51:30Z,2024-01-15T07:51:30Z,It's OK ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wvgoa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50tNAr,incubator-uniffle,1958006827,1451,NA,SemyonSinchenko,29755009,Sem,ssinchenko@apache.org,NA,2024-02-21T21:39:08Z,2024-02-21T21:39:08Z,"Hello! I'm new here but I have a lot of motivation to contribute to this nice project! Do I understand right, that it should be implemented via calling of `smartctl` with `java.lang.Runtime.getRuntime` and parsing the output?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50tNAr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50vZs2,incubator-uniffle,1958583094,1451,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-22T03:17:42Z,2024-02-22T03:17:42Z,You could do this in LocalStorageChecker#checkIsSpaceEnough and checkStorageReadAndWrite method. @SemyonSinchenko ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50vZs2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50vc5K,incubator-uniffle,1958596170,1451,NA,XuQianJin-Stars,10494131,ForwardXu,forwardxu315@gmail.com,NA,2024-02-22T03:36:26Z,2024-02-22T03:36:26Z,hi @zuston Is there a design for this part or is it just a suggestion and then the design is done?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50vc5K/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1451,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50vx_8,incubator-uniffle,1958682620,1451,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-22T04:33:18Z,2024-02-22T04:33:18Z,This is a feature request that no need to design.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM50vx_8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1452,https://api.github.com/repos/apache/incubator-uniffle/issues/1452,incubator-uniffle,2081653246,1452,[Bug]  Off-heap memory grows,dingshun3016,21172339,,,CLOSED,2024-01-15T09:51:45Z,2024-06-19T09:02:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Off-heap memory growth with latest version of code
rss.rpc.server.type GRPC
MAX_DIRECT_MEMORY_SIZE = 70G
![1705312223134](https://github.com/apache/incubator-uniffle/assets/21172339/10469a98-fc75-43f0-be83-c6a2e3503dc5)




### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1452/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1452,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wwyjd,incubator-uniffle,1891838173,1452,NA,dingshun3016,21172339,,,NA,2024-01-15T10:37:57Z,2024-01-15T10:37:57Z,"When I set MAX_DIRECT_MEMORY_SIZE=30G,  jvm_buffer_pool_used_bytes{pool=""direct""}  can reach 30G

![截屏2024-01-15 18 37 38](https://github.com/apache/incubator-uniffle/assets/21172339/8c69da99-4366-4a8d-a31f-6e3c27c82ead)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wwyjd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1452,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wwzdv,incubator-uniffle,1891841903,1452,NA,dingshun3016,21172339,,,NA,2024-01-15T10:39:42Z,2024-01-15T10:39:42Z,Do you have any ideas about this issue? @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5wwzdv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1452,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zqWdy,incubator-uniffle,1940481906,1452,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-02-13T06:07:49Z,2024-02-13T06:07:49Z,"Maybe you can try [the latest version](https://github.com/apache/incubator-uniffle/pull/1520), it might have something to do with GRPC internally.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zqWdy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1452,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6B0_eT,incubator-uniffle,2178152339,1452,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-19T09:02:56Z,2024-06-19T09:02:56Z,You can try GRPC_NETTY. Closed due to https://github.com/apache/incubator-uniffle/issues/1651.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6B0_eT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1453,https://api.github.com/repos/apache/incubator-uniffle/issues/1453,incubator-uniffle,2081974851,1453,[Improvement] We should force spotless-maven-plugin to use UNIX line endings,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-15T12:51:20Z,2024-01-16T09:36:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When we use the spotless-maven-plugin to format code on the Windows platform, it can cause changes in the file's line endings. We need to force a specific(UNIX: LF) line ending in the pom.xml. This ensures that the final output of line endings is consistent, regardless of the platform used to format the code.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1453/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1456,https://api.github.com/repos/apache/incubator-uniffle/issues/1456,incubator-uniffle,2082475457,1456,[Improvement] Better exception handling when calling requireBuffer using GRPC,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-15T17:55:56Z,2024-01-19T04:10:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, when we call the `ShuffleServerGrpcClient.requirePreAllocation` method, if the internal `getBlockingStub().requireBuffer` throws an exception, it is currently not being caught. We should catch the exception here, log the error, and return `FAILED_REQUIRE_ID`. This would make the `ShuffleServerGrpcClient.requirePreAllocation` method more pure. Also, we need to refactor the code to avoid calling `getBlockingStub().requireBuffer` multiple times.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1456/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1458,https://api.github.com/repos/apache/incubator-uniffle/issues/1458,incubator-uniffle,2083009255,1458,[Improvement] [SPARK] Modify task attempt id to avoid information redundancy.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-01-16T04:43:07Z,2024-02-27T06:37:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In spark, task attempt id is used to distinguish different task attempts. 
We know task attempt id is from [driver](https://github.com/apache/spark/blob/a58362ecbbf7c4e5d5f848411834cf2a9ef298b3/core/src/main/scala/org/apache/spark/scheduler/TaskSchedulerImpl.scala#L232). It is used to distinguish all task attempts in the entire spark applicaiton. For example, the id of task attempt in stage 0 is in [0,100), the id of task attempt in stage 1 will be [100,200). 
But RSS's requirement for task id is that it only needs to be able to distinguish different ids of the same shuffle. For id of task attempt in stage, we can use  [0,100], because the IDs between each shuffle are isolated. Starting counting from 100 is very wasteful.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1458/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1458,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51LPZI,incubator-uniffle,1965880904,1458,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-02-27T06:37:34Z,2024-02-27T06:37:34Z,"This issue is solved by https://github.com/apache/incubator-uniffle/pull/1529, close it!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51LPZI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1459,https://api.github.com/repos/apache/incubator-uniffle/issues/1459,incubator-uniffle,2085278186,1459,[Improvement] Refactor DefaultFlushEventHandler and ShuffleFlushManager#flushToFile,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-01-17T02:34:29Z,2024-01-18T10:46:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In #775, it separate flush thread pools for different storage type. But I'm not satisfied with current impl.

In `DefaultFlushEventHandler`, we consume the `ShuffleDataFlushEvent` by the function from `ShuffleFlushManager#flushToFile`. But in the `flushToFile` method, we will modify the internal state of event,  this is not proper.

I hope the flushToFile only flush or check whether retry or discard the event, all the state of event should be modified or maintained in the `DefaultFlushEventHandler`. The following code is here:

```
private void flushToFile(ShuffleDataFlushEvent event) {
    long start = System.currentTimeMillis();
    boolean writeSuccess = false;

    try {
      if (!event.isValid()) {
        LOG.warn(
            ""AppId {} was removed already, event {} should be dropped"", event.getAppId(), event);
        return;
      }

      List<ShufflePartitionedBlock> blocks = event.getShuffleBlocks();
      if (blocks == null || blocks.isEmpty()) {
        LOG.info(""There is no block to be flushed: {}"", event);
        return;
      }

      Storage storage = event.getUnderStorage();
      if (storage == null) {
        LOG.error(""Storage selected is null and this should not happen. event: {}"", event);
        throw new EventDiscardException();
      }

      if (event.isPended()
          && System.currentTimeMillis() - event.getStartPendingTime()
              > pendingEventTimeoutSec * 1000L) {
        ShuffleServerMetrics.counterTotalDroppedEventNum.inc();
        LOG.error(
            ""Flush event cannot be flushed for {} sec, the event {} is dropped"",
            pendingEventTimeoutSec,
            event);
        throw new EventDiscardException();
      }
```

We could introduce the `EventDiscardException` or `EventRetryException` and so on for next processing in `DefaultFlushEventHandler`.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1459/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1460,https://api.github.com/repos/apache/incubator-uniffle/issues/1460,incubator-uniffle,2085285943,1460,[FEATURE] Support pending for ShuffleDataFlushEvent in DefaultFlushEventHandler,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-01-17T02:44:41Z,2024-01-25T02:38:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the event will be discarded when flushing failure happens. This is not friendly for flushing to HDFS that is not stable.

I think this features should be supported after #1459 done

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1460/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1462,https://api.github.com/repos/apache/incubator-uniffle/issues/1462,incubator-uniffle,2085677347,1462,[Bug] Memory may leak when a flush event is dropped,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-17T08:34:38Z,2024-01-19T04:09:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Currently, in `ShuffleFlushManager.flushToFile`, there may be memory leaks when a flush event is exceptionally dropped.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1462/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1464,https://api.github.com/repos/apache/incubator-uniffle/issues/1464,incubator-uniffle,2085750631,1464,[Improvement] Improve the error log message for checkBlockSendResult,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-17T09:18:08Z,2024-01-18T02:18:37Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, when method `checkBlockSendResult` will only print error log like below:
org.apache.uniffle.common.exception.RssSendFailedException: Send failed: Task[7173_0] failed because 72 blocks can't be sent to shuffle server.
This is not enough. I think a more detailed version would be something like below:
org.apache.uniffle.common.exception.RssSendFailedException: Send failed: Task[7173_0] failed because 72 blocks can't be sent to shuffle server: [ShuffleServerInfo{id[127.0.0.1-19977-17000], host[127.0.0.1], grpc port[19977], netty port[17000]}].

Also, I think we don't need `id` in `ShuffleServerInfo.toString`, which I think is useless.

So the final output would be:
org.apache.uniffle.common.exception.RssSendFailedException: Send failed: Task[7173_0] failed because 72 blocks can't be sent to shuffle server: [ShuffleServerInfo{host[127.0.0.1], grpc port[19977], netty port[17000]}].

This is useful when troubleshooting.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1464/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1466,https://api.github.com/repos/apache/incubator-uniffle/issues/1466,incubator-uniffle,2087431777,1466,[FEATURE] Introduce GC pause monitor,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-01-18T03:50:07Z,2024-01-19T02:06:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

 Introduce GC pause monitor for shuffle server

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1466/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1467,https://api.github.com/repos/apache/incubator-uniffle/issues/1467,incubator-uniffle,2087619630,1467,[FEATURE] Introduce the metrics of hdfs spill data size for huge partition,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-01-18T06:38:46Z,2024-01-25T02:38:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Sometimes. we want to know the huge partition size that spilled to HDFS.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1467/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1471,https://api.github.com/repos/apache/incubator-uniffle/issues/1471,incubator-uniffle,2089464888,1471,[Bug] Display the first successful registration time in Dashboard,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-19T02:59:02Z,2024-07-09T07:38:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Now the `ResigerTime`(which is spelled incorrectly, should be `RegistrationTime`) for shuffle servers is always displaying the latest registration time, which is useless and changing all the time?
The registration time is updated with each heartbeat report. Shouldn't we be displaying the time of the first successful registration, rather than the time of the most recent successful heartbeat report?
If the shuffle server is always active, why not display the first successful registration time?
![image](https://github.com/apache/incubator-uniffle/assets/13834479/e6df96ef-db14-4092-8593-808512d2c52a)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1471/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1472,https://api.github.com/repos/apache/incubator-uniffle/issues/1472,incubator-uniffle,2089530612,1472,[Serious Bug] Inaccurate flow control leads to Shuffle server OOM when enabling Netty,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-19T04:04:43Z,2024-02-26T06:47:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In high-pressure scenarios, inaccurate flow control(usedMemory? preAllocatedMemory?) leads to Shuffle server OOM.

![image](https://github.com/apache/incubator-uniffle/assets/13834479/a46fd27e-5430-4cde-8a4a-54c73b3cb6cc)

The SQL used to reproduce the bug:
tpcds：
select * from (
select s.*,c.* from store_sales s join customer  c on s.ss_customer_sk=c.c_customer_sk
) sc DISTRIBUTE BY sc.ss_customer_sk,sc.ss_item_sk;

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[2024-01-19 03:18:50.483] [Grpc-714] [DEBUG] org.apache.uniffle.server.buffer.ShuffleBufferManager.requireMemory - Require memory succeeded with 1023891 bytes, usedMemory[117888810505] include preAllocation[180869913], inFlushSize[110004009963]
[2024-01-19 03:18:50.485] [Grpc-19] [DEBUG] org.apache.uniffle.server.buffer.ShuffleBufferManager.requireMemory - Require memory succeeded with 3093288 bytes, usedMemory[117891903793] include preAllocation[183963201], inFlushSize[110004009963]
[2024-01-19 03:18:50.485] [epollEventLoopGroup-3-19] [DEBUG] org.apache.uniffle.server.netty.ShuffleServerNettyHandler.handleSendShuffleDataRequest - Cache Shuffle Data for appId[application_1703049085550_1651917_1705170927963], shuffleId[0], cost 0 ms with 52 blocks and 1189625 bytes
[2024-01-19 03:18:50.487] [epollEventLoopGroup-3-44] [WARN] org.apache.uniffle.common.netty.handle.TransportChannelHandler.exceptionCaught - Exception in connection from /9.23.12.144:45176
io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 4194304 byte(s) of direct memory (used: 171798691840, max: 171798691840)
        at io.netty.util.internal.PlatformDependent.incrementMemoryCounter(PlatformDependent.java:843)
        at io.netty.util.internal.PlatformDependent.allocateDirectNoCleaner(PlatformDependent.java:772)
        at io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:710)
        at io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:685)
        at io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:212)
        at io.netty.buffer.PoolArena.tcacheAllocateNormal(PoolArena.java:194)
        at io.netty.buffer.PoolArena.allocate(PoolArena.java:136)
        at io.netty.buffer.PoolArena.allocate(PoolArena.java:126)
        at io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:397)
        at io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:188)
        at io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:179)
        at org.apache.uniffle.common.netty.protocol.Decoders.decodeShuffleBlockInfo(Decoders.java:50)
        at org.apache.uniffle.common.netty.protocol.SendShuffleDataRequest.decodePartitionData(SendShuffleDataRequest.java:92)
        at org.apache.uniffle.common.netty.protocol.SendShuffleDataRequest.decode(SendShuffleDataRequest.java:104)
        at org.apache.uniffle.common.netty.protocol.Message.decode(Message.java:145)
        at org.apache.uniffle.common.netty.TransportFrameDecoder.channelRead(TransportFrameDecoder.java:72)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:800)
        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:509)
        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:407)
        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
        at java.lang.Thread.run(Thread.java:750)
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

```yaml
xmx：120g
capacity：110g
read.capacity：20g
max_direct_mem：160g
rss.server.netty.epoll.enable true
rss.rpc.server.type GRPC_NETTY
```


### Uniffle Engine Configurations

```yaml
set spark.sql.files.maxPartitionBytes=1073741824;
set spark.executor.cores=8;
set spark.task.cpus=4;
set spark.executor.memory=49g;
set spark.driver.memory=20g;
set spark.dynamicAllocation.maxExecutors=150;
set spark.dynamicAllocation.minExecutors=150;
set spark.rss.client.type = GRPC_NETTY;
set spark.rss.client.netty.io.mode = EPOLL;
```


### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1472/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1472,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xPJrf,incubator-uniffle,1899797215,1472,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-19T05:31:40Z,2024-01-19T05:31:40Z,PTAL @leixm @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xPJrf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1472,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xuX_V,incubator-uniffle,1907982293,1472,NA,connorlwilkes,16749386,Connor Wilkes,,NA,2024-01-24T11:55:51Z,2024-01-24T11:55:51Z,This only affects off heap Netty?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xuX_V/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1472,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xzNcR,incubator-uniffle,1909249809,1472,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-01-25T02:39:35Z,2024-01-25T02:39:35Z,"> This only affects off heap Netty?

Currently, it only affects off heap Netty.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xzNcR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1472,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yakWU,incubator-uniffle,1919567252,1472,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-31T17:24:09Z,2024-01-31T17:24:09Z,"Progress: I already have a version that can solve this problem, and I am still testing it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yakWU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1476,https://api.github.com/repos/apache/incubator-uniffle/issues/1476,incubator-uniffle,2095152305,1476,[FEATURE] Provide dedicated unregister app rpc interface,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-01-23T03:06:00Z,2024-02-08T01:26:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

```
@Override
  public void unregisterShuffle(String appId) {
    if (appId == null) {
      return;
    }
    Map<Integer, Set<ShuffleServerInfo>> appServerMap = shuffleServerInfoMap.get(appId);
    if (appServerMap == null) {
      return;
    }
    appServerMap.keySet().forEach(shuffleId -> unregisterShuffle(appId, shuffleId));
  }
```

### Motivation

I found the unregister app in shuffleManager stop method always is timeout when having too much stages. And there is no need to unregister shuffle one by one, why not introducing unregister app rpc method? 

But I'm hesitant whether to reuse the unregisterShuffle rpc by making the shuffleId of protobuf optional to achieve the app purging

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1476/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ymaX7,incubator-uniffle,1922672123,1476,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-02T02:22:12Z,2024-02-02T02:22:12Z,cc @xianjingfeng @jerqi . WDYT? Whether to introduce new rpc or reusing the existing,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5ymaX7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxa53,incubator-uniffle,1925557879,1476,NA,xianjingfeng,11752250,,,NA,2024-02-04T02:41:05Z,2024-02-04T02:41:05Z,"> cc @xianjingfeng @jerqi . WDYT? Whether to introduce new rpc or reusing the existing

I think it is better to introduce new rpc interface. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxa53/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxfW_,incubator-uniffle,1925576127,1476,NA,somelovelanguage,47029491,Yiqi You,,NA,2024-02-04T04:21:44Z,2024-02-04T04:21:44Z,"Kindly to ask if there is somebody working for this issue？ If not, i'm glad to undertake it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxfW_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1476,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxinh,incubator-uniffle,1925589473,1476,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-04T05:42:24Z,2024-02-04T05:42:24Z,"> Kindly to ask if there is somebody working for this issue？ If not, i'm glad to undertake it.

Feel free. Assigned","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxinh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,incubator-uniffle,2096619226,1477,[Bug] IllegalReferenceCountException in Shuffle Server,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-23T17:33:36Z,2024-05-14T12:20:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

[2024-01-24 00:38:19.554] [Grpc-973] [ERROR] ShuffleServerGrpcService.sendShuffleData - Error happened when shuffleEngine.write for appId[application_1703049085550_2397150_1706027594091], shuffleId[0], partitionId[32790], statusCode=NO_REGISTER
[2024-01-24 00:38:20.996] [LocalFileFlushEventThreadPool-4] [WARN] SingleStorageManager.write - Exception happened when write data for ShuffleDataFlushEvent: eventId=14051, appId=application_1703049085550_2397150_1706027594091, shuffleId=0, startPartition=12408, endPartition=12408, retryTimes=0, underStorage=LocalStorage, isPended=false, ownedByHugePartition=false, try again
io.netty.util.IllegalReferenceCountException: refCnt: 0
        at io.netty.buffer.AbstractByteBuf.ensureAccessible(AbstractByteBuf.java:1454)
        at io.netty.buffer.AbstractByteBuf.checkReadableBytes0(AbstractByteBuf.java:1440)
        at io.netty.buffer.AbstractByteBuf.checkReadableBytes(AbstractByteBuf.java:1428)
        at io.netty.buffer.AbstractByteBuf.readBytes(AbstractByteBuf.java:895)
        at io.netty.buffer.AbstractByteBuf.readBytes(AbstractByteBuf.java:903)
        at org.apache.uniffle.common.util.ByteBufUtils.readBytes(ByteBufUtils.java:85)
        at org.apache.uniffle.storage.handler.impl.LocalFileWriteHandler.write(LocalFileWriteHandler.java:106)
        at org.apache.uniffle.server.storage.SingleStorageManager.write(SingleStorageManager.java:59)
        at org.apache.uniffle.server.storage.HybridStorageManager.write(HybridStorageManager.java:143)
        at org.apache.uniffle.server.ShuffleFlushManager.processFlushEvent(ShuffleFlushManager.java:164)
        at org.apache.uniffle.server.DefaultFlushEventHandler.handleEventAndUpdateMetrics(DefaultFlushEventHandler.java:87)
        at org.apache.uniffle.server.DefaultFlushEventHandler.lambda$dispatchEvent$0(DefaultFlushEventHandler.java:198)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:750)
[2024-01-24 00:38:21.021] [LocalFileFlushEventThreadPool-2] [WARN] SingleStorageManager.write - Exception happened when write data for ShuffleDataFlushEvent: eventId=14052, appId=application_1703049085550_2397150_1706027594091, shuffleId=0, startPartition=12409, endPartition=12409, retryTimes=0, underStorage=LocalStorage, isPended=false, ownedByHugePartition=false, try again
io.netty.util.IllegalReferenceCountException: refCnt: 0
        at io.netty.buffer.AbstractByteBuf.ensureAccessible(AbstractByteBuf.java:1454)
        at io.netty.buffer.AbstractByteBuf.checkReadableBytes0(AbstractByteBuf.java:1440)
        at io.netty.buffer.AbstractByteBuf.checkReadableBytes(AbstractByteBuf.java:1428)
        at io.netty.buffer.AbstractByteBuf.readBytes(AbstractByteBuf.java:895)
        at io.netty.buffer.AbstractByteBuf.readBytes(AbstractByteBuf.java:903)
        at org.apache.uniffle.common.util.ByteBufUtils.readBytes(ByteBufUtils.java:85)
        at org.apache.uniffle.storage.handler.impl.LocalFileWriteHandler.write(LocalFileWriteHandler.java:106)
        at org.apache.uniffle.server.storage.SingleStorageManager.write(SingleStorageManager.java:59)
        at org.apache.uniffle.server.storage.HybridStorageManager.write(HybridStorageManager.java:143)
        at org.apache.uniffle.server.ShuffleFlushManager.processFlushEvent(ShuffleFlushManager.java:164)
        at org.apache.uniffle.server.DefaultFlushEventHandler.handleEventAndUpdateMetrics(DefaultFlushEventHandler.java:87)
        at org.apache.uniffle.server.DefaultFlushEventHandler.lambda$dispatchEvent$0(DefaultFlushEventHandler.java:198)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:750)

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1477/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xpC7d,incubator-uniffle,1906585309,1477,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-23T17:36:23Z,2024-01-23T17:36:23Z,@zuston PTAL. Not sure if this is related to #1461 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xpC7d/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xzNbD,incubator-uniffle,1909249731,1477,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-01-25T02:39:28Z,2024-01-25T02:39:28Z,"> @zuston PTAL. Not sure if this is related to #1461

Not sure.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xzNbD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM503-YX,incubator-uniffle,1960830487,1477,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-02-23T07:11:26Z,2024-02-23T07:11:26Z,"Didn't reproduce it, closed. Maybe it has been fixed already.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM503-YX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59t8nQ,incubator-uniffle,2109196752,1477,NA,dingshun3016,21172339,,,NA,2024-05-14T03:15:02Z,2024-05-14T03:15:02Z,"I also found this case
`[WARN] 2024-05-14 08:14:18,357 LocalFileFlushEventThreadPool-36 SingleStorageManager write - Exception happened when write data for ShuffleDataFlushEvent: eventId=12568330,
appId=application_1715067054210_414115_-779157491-95513, shuffleId=0, startPartition=55, endPartition=55, retryTimes=0, underStorage=LocalStorage, isPended=false, try again
io.netty.util.IllegalReferenceCountException: refCnt: 0
        at io.netty.buffer.AbstractByteBuf.ensureAccessible(AbstractByteBuf.java:1454)
        at io.netty.buffer.AbstractByteBuf.checkReadableBytes0(AbstractByteBuf.java:1440)
        at io.netty.buffer.AbstractByteBuf.checkReadableBytes(AbstractByteBuf.java:1428)
        at io.netty.buffer.UnpooledDirectByteBuf.readBytes(UnpooledDirectByteBuf.java:316)
        at io.netty.buffer.AbstractByteBuf.readBytes(AbstractByteBuf.java:903)
        at org.apache.uniffle.common.util.ByteBufUtils.readBytes(ByteBufUtils.java:79)
        at org.apache.uniffle.storage.handler.impl.LocalFileWriteHandler.write(LocalFileWriteHandler.java:106)
        at org.apache.uniffle.server.storage.SingleStorageManager.write(SingleStorageManager.java:59)
        at org.apache.uniffle.server.storage.HybridStorageManager.write(HybridStorageManager.java:151)
        at org.apache.uniffle.server.ShuffleFlushManager.flushToFile(ShuffleFlushManager.java:210)
        at org.apache.uniffle.server.ShuffleFlushManager.processEvent(ShuffleFlushManager.java:91)
        at org.apache.uniffle.server.DefaultFlushEventHandler.handleEventAndUpdateMetrics(DefaultFlushEventHandler.java:76)
        at org.apache.uniffle.server.DefaultFlushEventHandler.lambda$processNextEvent$1(DefaultFlushEventHandler.java:123)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:833)`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59t8nQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59uDfY,incubator-uniffle,2109224920,1477,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-14T03:48:39Z,2024-05-14T03:48:39Z,Are you using the latest code? I've never reproduced it.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59uDfY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59ugGd,incubator-uniffle,2109342109,1477,NA,dingshun3016,21172339,,,NA,2024-05-14T05:54:03Z,2024-05-14T05:54:03Z,"> Are you using the latest code? I've never reproduced it.

The code I use is checkout from the master branch, at that time, the latest commit of the master branch was `upgrade to 0.9.0-snapshot (#1176)`. The code behind is the code I cherry pick from the master branch or customized as needed.
Do you know what subsequent commits will help this problem?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59ugGd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59uhSI,incubator-uniffle,2109346952,1477,NA,dingshun3016,21172339,,,NA,2024-05-14T05:58:15Z,2024-05-14T05:58:15Z,"On my side, this case only occurred once after the cluster has been running for a long time.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59uhSI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59ulTr,incubator-uniffle,2109363435,1477,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-14T06:11:19Z,2024-05-14T06:11:19Z,"Have you tried https://github.com/apache/incubator-uniffle/pull/1574? Maybe it will help you. The buffer could've been 
 released by other cleaner threads after it has already been put into the flushing queue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59ulTr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1477,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59xPlx,incubator-uniffle,2110060913,1477,NA,dingshun3016,21172339,,,NA,2024-05-14T12:20:24Z,2024-05-14T12:20:24Z,"> Have you tried #1574? Maybe it will help you. The buffer could've been released by other cleaner threads after it has already been put into the flushing queue.

Thanks, I'll take a look","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59xPlx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1478,https://api.github.com/repos/apache/incubator-uniffle/issues/1478,incubator-uniffle,2097464518,1478,Some metric shows 0,xianjingfeng,11752250,,,OPEN,2024-01-24T05:37:55Z,2025-01-16T07:03:24Z,"### Discussed in https://github.com/apache/incubator-uniffle/discussions/1268

<div type='discussions-op-text'>

<sup>Originally posted by **youjeongsue** October 27, 2023</sup>
Hi. I'm setting up a prometheus pushgateway to collect metrics.

https://github.com/apache/incubator-uniffle/blob/master/docs/metrics_guide.md#report-metrics-to-prometheus-automatically

```
rss.metrics.prometheus.pushgateway.addr rss-pushgateway...com:80
rss.metrics.prometheus.pushgateway.jobname rss-shuffle-server
rss.metrics.reporter.class org.apache.uniffle.common.metrics.prometheus.PrometheusPushGatewayMetricReporter
```

However, I only get the JVM related metrics to show up properly, all the others are collected as zeros.
<img width=""1680"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/43227174/cdb7fd8d-abe5-4b4e-8773-5f4a3ef8a871"">
<img width=""1683"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/43227174/66c3cc3f-5ed4-4090-b577-619df4009481"">
<img width=""1687"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/43227174/f86f375c-dfe5-485b-98f4-cdbb63df68ff"">

If I'm setting this up wrong, please correct me. (__)
Your advice will be of great help to me.</div>","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1478/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1478,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x98J5,incubator-uniffle,1912062585,1478,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-26T13:23:48Z,2024-01-26T13:23:48Z,"I have not see it , and here is our conf and it it very simple:



```
rss.metrics.reporter.class org.apache.uniffle.common.metrics.prometheus.PrometheusPushGatewayMetricReporter
rss.metrics.prometheus.pushgateway.addr   <normal_ip>:9091
**rss.metrics.prometheus.pushgateway.report.interval.seconds 20**
rss.metrics.prometheus.pushgateway.jobname  <normal_jobname>
```



How about add this:
`rss.metrics.prometheus.pushgateway.report.interval.seconds`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x98J5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1478,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6aQivK,incubator-uniffle,2588027850,1478,NA,BaluDontu,22899615,Balu Dontu,bdontu@vmware.com,NA,2025-01-13T19:36:01Z,2025-01-13T19:36:01Z,"Hi, 

I am seeing a similar issue where I see most of the metrics show a value of 0.
Any update on this issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6aQivK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1478,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6aTixM,incubator-uniffle,2588814412,1478,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2025-01-14T03:03:00Z,2025-01-14T03:03:00Z,"> Hi,
> 
> I am seeing a similar issue where I see most of the metrics show a value of 0. Any update on this issue?

Could you help share some deployment uniffle version and config options? @BaluDontu . From my deployment, the metric system is valid. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6aTixM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1478,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ansKH,incubator-uniffle,2594095751,1478,NA,BaluDontu,22899615,Balu Dontu,bdontu@vmware.com,NA,2025-01-15T22:49:40Z,2025-01-15T22:49:40Z,"Hi @zuston . I was able to get it resolved. Sorry for the confusion.

I have another question. I am trying to get metric data for these below metrics. I want to understand what is the unit for it?

total_read_data -> Is this in bytes?
total_read_time -> Is this in milliseconds?
total_write_data -> Is this in bytes?
total_write_time -> Is this in milliseconds?
used_buffer_size -> -> Is this in bytes?

Can you point to the documentation about these metrics information?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ansKH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1478,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ap5bk,incubator-uniffle,2594674404,1478,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2025-01-16T06:59:37Z,2025-01-16T06:59:37Z,"total_read_data -> Is this in bytes? yes
total_read_time -> Is this in milliseconds? yes
total_write_data -> Is this in bytes? yes
total_write_time -> Is this in milliseconds? yes
used_buffer_size -> -> Is this in bytes? yes

The unit of the metrics about data size are all bytes. @BaluDontu ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ap5bk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1478,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ap6Kr,incubator-uniffle,2594677419,1478,NA,BaluDontu,22899615,Balu Dontu,bdontu@vmware.com,NA,2025-01-16T07:01:42Z,2025-01-16T07:01:42Z,@zuston How about time metrics ?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ap6Kr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1478,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ap6u2,incubator-uniffle,2594679734,1478,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2025-01-16T07:03:23Z,2025-01-16T07:03:23Z,"> [@zuston](https://github.com/zuston) How about time metrics ?

If I'm right, the unit is milliseconds for the time metrics","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ap6u2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1479,https://api.github.com/repos/apache/incubator-uniffle/issues/1479,incubator-uniffle,2097499904,1479,[Bug] Too high SUnreclaim memery use and does not release memory,lifeSo,9440617,Qing,1169158401@qq.com,OPEN,2024-01-24T06:13:20Z,2024-01-26T13:19:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

We launch 8 Shuffle Server machine, and there is one machine memory use is very high.
After diagnose, we find there is SUnreclaim too high by run cmd :/etc/meminfo
![image](https://github.com/apache/incubator-uniffle/assets/9440617/30d93e38-a343-4afe-8ce5-88ae1da5850a)

Event though RSS process is down, the memory is not released.

![image](https://github.com/apache/incubator-uniffle/assets/9440617/aa148e69-2761-4fa1-ad74-3d510503187c)


### Affects Version(s)

0.7.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1479/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1479,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xuIOF,incubator-uniffle,1907917701,1479,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-24T11:11:57Z,2024-01-24T11:11:57Z,Can you run `jmap -histo:live` to show what occupies the memory when the process of RSS Server is still alive? I think it will probably be `io.netty.buffer.ReadOnlyByteBufferBuf` from `org.apache.uniffle.common.ShufflePartitionedBlock`.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xuIOF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1479,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xzG1H,incubator-uniffle,1909222727,1479,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-25T02:02:22Z,2024-01-25T02:02:22Z,"@rickyma 
We don't run the `jmap -histo:live` cmd, because we think the rss use memory is ok, it just use half of the memory from the pic above.
And the machine restarted later.
If the problem show next time, I think could run `slabtop`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5xzG1H/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1482,https://api.github.com/repos/apache/incubator-uniffle/issues/1482,incubator-uniffle,2099513225,1482,[Bug] The shuffle server list will be collapsed and not fully displayed in dashboard,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-01-25T03:52:08Z,2024-01-25T03:53:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

![image](https://github.com/apache/incubator-uniffle/assets/13834479/be0c76d5-261a-43f3-98b6-9e37ffb6c86b)

Also, the Coordinator's tab page will be displayed in yellow, even if I am accessing the shuffle server page.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1482/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1483,https://api.github.com/repos/apache/incubator-uniffle/issues/1483,incubator-uniffle,2099915414,1483,[Bug] AvailableMem should not be negative,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-01-25T09:12:08Z,2024-01-25T09:20:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

![image](https://github.com/apache/incubator-uniffle/assets/13834479/84705c7c-4f80-4625-be76-ed50f8527892)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1483/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1483,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x1CG-,incubator-uniffle,1909727678,1483,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-01-25T09:20:19Z,2024-01-25T09:20:19Z,"Might not be a bug. Can't reproduce, it will be reopened if it happens again.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x1CG-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1484,https://api.github.com/repos/apache/incubator-uniffle/issues/1484,incubator-uniffle,2101472797,1484,[Bug] Potential memory leak risk in the spark client,xianjingfeng,11752250,,,CLOSED,2024-01-26T02:27:39Z,2024-01-26T02:31:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

`hasRequested` is always `false` in the following code
https://github.com/apache/incubator-uniffle/blob/ba25785324f3b19a5780eb1ff9d696717420e2b3/client-spark/common/src/main/java/org/apache/spark/shuffle/writer/WriteBufferManager.java#L241-L243

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1484/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1484,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x7E4-,incubator-uniffle,1911311934,1484,NA,xianjingfeng,11752250,,,NA,2024-01-26T02:27:51Z,2024-01-26T02:27:51Z,@zuston cc,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x7E4-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1484,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x7FdD,incubator-uniffle,1911314243,1484,NA,xianjingfeng,11752250,,,NA,2024-01-26T02:31:23Z,2024-01-26T02:31:23Z,My mistake. it not a bug.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5x7FdD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1489,https://api.github.com/repos/apache/incubator-uniffle/issues/1489,incubator-uniffle,2104567028,1489,"[Improvement] Big Partition require buffer fail, and improve it. ",lifeSo,9440617,Qing,1169158401@qq.com,OPEN,2024-01-29T03:31:15Z,2024-01-30T03:50:03Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When there is big partition require buffer, require buffer fails and may wait.
![image](https://github.com/apache/incubator-uniffle/assets/9440617/f4a14f8a-c281-41e6-ac9f-69450442fdce)



Until there is flush:
![image](https://github.com/apache/incubator-uniffle/assets/9440617/47e258ce-0969-4e5f-b92f-2e38e7dbb7ec)


### How should we improve?

Provide better default arguement and advise.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1489/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1489,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yE_Aw,incubator-uniffle,1913909296,1489,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-29T03:41:48Z,2024-01-29T03:41:48Z,"Machine 128G memory， rss Xmx 75G, -XX:MaxDirectMemorySize=20G.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yE_Aw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1489,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yE_J2,incubator-uniffle,1913909878,1489,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-29T03:42:44Z,2024-01-29T03:42:44Z,"Now, 
**rss.server.shuffleBufferManager.trigger.flush.interval**
is default value and flush check thread is close, and we want to set it to 180 and enable flush check.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yE_J2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1489,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yNDTS,incubator-uniffle,1916024018,1489,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-01-30T03:50:02Z,2024-01-30T03:50:02Z,"Now the huge partition is default value 20G, and it is bigger for me,  I want to adjust to 8G according to the log:
(Make it flush early)

![image](https://github.com/apache/incubator-uniffle/assets/9440617/50c12f6c-0742-4506-b790-b45342b03a1b)
Above is First Appear.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yNDTS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1490,https://api.github.com/repos/apache/incubator-uniffle/issues/1490,incubator-uniffle,2105279857,1490,[Improvement] Disable dynamic allocation shuffle tracking,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2024-01-29T11:29:57Z,2024-01-30T02:24:55Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When using uniffle in Spark 3.5, I found that the executor did not exit in time when DRA was enabled.

```
spark.dynamicAllocation.enabled true
spark.shuffle.manager	org.apache.spark.shuffle.RssShuffleManager
spark.shuffle.service.enabled	false
spark.shuffle.sort.io.plugin.class	org.apache.spark.shuffle.RssShuffleDataIo
```

As mentioned in [SPARK-39846](https://issues.apache.org/jira/browse/SPARK-39846), shuffle tracking is enabled by default in Spark 3.4.0.

When we disable shuffle service and enable shuffle tracking by default, the executor will only exit idle after shuffle cleanup. So we should disable shuffle tracking by default.

refer: https://github.com/apache/spark/blob/8dd395b2eabd2815982022b38a5287dae7af8b82/core/src/main/scala/org/apache/spark/scheduler/dynalloc/ExecutorMonitor.scala#L55


enable shuffle tracking (by default in spark 3.5):

![image](https://github.com/apache/incubator-uniffle/assets/17894939/a6d92a5b-9005-4481-868a-3e4065416d3f)


after disable shuffle tracking:

![image](https://github.com/apache/incubator-uniffle/assets/17894939/02671143-6162-43a3-84cf-1b9eac1db338)


### How should we improve?

Disable dynamic allocation shuffle tracking by default.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1490/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1494,https://api.github.com/repos/apache/incubator-uniffle/issues/1494,incubator-uniffle,2107376969,1494,[Flaky Test] RepartitionWithHadoopHybridStorageRssTest#resultCompareTest,xianjingfeng,11752250,,,CLOSED,2024-01-30T09:42:13Z,2024-06-19T09:00:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  resultCompareTest  Time elapsed: 24.11 s  <<< ERROR!
org.apache.spark.SparkException: 
Job aborted due to stage failure: Task 3 in stage 2.0 failed 1 times, most recent failure: Lost task 3.0 in stage 2.0 (TID 12) (fv-az694-448.54qhn1hql4lezjuaogcugbdfcb.ex.internal.cloudapp.net executor driver): org.apache.uniffle.common.exception.RssFetchFailedException: Failed to read shuffle data from HOT handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:124)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:273)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:185)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:297)
	at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
	at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
	at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:136)
	at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:329)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:329)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:329)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
	at org.apache.spark.scheduler.Task.run(Task.scala:136)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1504)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
Caused by: io.netty.util.IllegalReferenceCountException: refCnt: 0
	at io.netty.buffer.AbstractByteBuf.ensureAccessible(AbstractByteBuf.java:1454)
	at io.netty.buffer.AbstractByteBuf.checkIndex(AbstractByteBuf.java:1383)
	at io.netty.buffer.PooledByteBuf.duplicateInternalNioBuffer(PooledByteBuf.java:194)
	at io.netty.buffer.PooledByteBuf.nioBuffer(PooledByteBuf.java:211)
	at io.netty.buffer.AbstractByteBuf.nioBuffer(AbstractByteBuf.java:1231)
	at org.apache.uniffle.common.netty.buffer.NettyManagedBuffer.nioByteBuffer(NettyManagedBuffer.java:48)
	at org.apache.uniffle.common.ShuffleIndexResult.getIndexData(ShuffleIndexResult.java:62)
	at org.apache.uniffle.common.segment.LocalOrderSegmentSplitter.split(LocalOrderSegmentSplitter.java:67)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:80)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113)
	... 25 more


```

### Actions URL

https://github.com/xianjingfeng/incubator-uniffle/actions/runs/7708416244/job/21007443535

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1494/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1494,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6B0-DE,incubator-uniffle,2178146500,1494,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-19T09:00:23Z,2024-06-19T09:00:23Z,I think this does not exist anymore. Feel free to reopen this if you can reproduce this.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6B0-DE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1497,https://api.github.com/repos/apache/incubator-uniffle/issues/1497,incubator-uniffle,2111323975,1497,[Improvement] flushing buffer if the memoryUsed of the first record of WriterBuffer larger than bufferSize,xianjingfeng,11752250,,,CLOSED,2024-02-01T01:53:06Z,2024-02-01T06:16:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently in `org.apache.spark.shuffle.writer.WriteBufferManager#insertIntoBuffer`, if the memoryUsed of WriterBuffer larger than bufferSize, the WriterBuffer will be flush. But if the memoryUsed of the first record larger than bufferSize, the WriterBuffer will not be flush.

### How should we improve?

Flushing buffer if the memoryUsed of the first record of WriterBuffer larger than bufferSize

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1497/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1499,https://api.github.com/repos/apache/incubator-uniffle/issues/1499,incubator-uniffle,2112337758,1499,[DOCS] What does a decomission actually do,connorlwilkes,16749386,Connor Wilkes,,CLOSED,2024-02-01T11:58:47Z,2024-03-06T03:26:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

It is not currently clear from the documentation what a decommission does. It would be good to have some documentation about that

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1499/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1499,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxnh4,incubator-uniffle,1925609592,1499,NA,smallzhongfeng,84573424,jokercurry,jingxiongzhong0512@gmail.com,NA,2024-02-04T07:24:18Z,2024-02-04T07:24:18Z,cc @xianjingfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yxnh4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1499,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yx50C,incubator-uniffle,1925684482,1499,NA,xianjingfeng,11752250,,,NA,2024-02-04T10:20:01Z,2024-02-04T10:20:01Z,@connorlwilkes Please see the design doc. https://docs.google.com/document/d/1p1PksBN2LJ-OtGEHvdyEuH9b1Mv1aD_exMPl4TNaTs0/edit?pli=1,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5yx50C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1499,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BI5S,incubator-uniffle,1980010066,1499,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-03-06T03:26:48Z,2024-03-06T03:26:48Z,Close this. Feel free to reopen if having any problem,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BI5S/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1501,https://api.github.com/repos/apache/incubator-uniffle/issues/1501,incubator-uniffle,2116844194,1501,fix(server): storage selection cache accidentally deleted when clearing stage level data.,dingshun3016,21172339,,,CLOSED,2024-02-04T02:53:01Z,2024-02-05T12:02:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Accidentally deleting the storage selection cache leads to failure in reading data

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1501/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1512,https://api.github.com/repos/apache/incubator-uniffle/issues/1512,incubator-uniffle,2125292447,1512,[Improvement] Replace taskAttemptId in blockId with mapIndex,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-02-08T14:19:29Z,2024-02-27T06:30:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The blockId consists of a sequence number, the partition id and the task attempt id. In Spark, partition id is 31 bits (positive int), the attempt id is 63 bit (positive long). However, as part of the 63 bit blockId, it has only a fraction of those bits available. By design, Uniffle does not support any arbitrary Spark app.

Using Uniffle with large datasets (e.g. 100TB) and long running Spark apps with many stages, we face an overflow of these fields. This blocks us from migrating all our Spark workloads onto a Kubernetes cluster with Uniffle shuffle service.

Related:
- https://github.com/apache/incubator-uniffle/issues/1399
- https://github.com/apache/incubator-uniffle/issues/1398
- https://github.com/apache/incubator-uniffle/issues/749
- https://github.com/apache/incubator-uniffle/issues/731
- https://github.com/apache/incubator-uniffle/issues/420
- https://github.com/apache/incubator-uniffle/issues/134

### How should we improve?

The block id should store the map index (source partition), instead of the task attempt id of the map task. The former is a number between 0 and the number of partitions - 1, whereas the latter is an arbitrary large 63 bit number (monotonically increasing unique id).

With each stage, the task attempt id grows by at least the number of partitions (unless AQE coalesces partitions). Long running Spark apps with hundred of thousands of partitions will experience task attempt ids in the 100 of million or even billion (30 bit). Using the map index would limit those ids to the number of partitions (e.g. 20 bit), no matter how many stages and jobs there will be.

The task attempt id is part of the blockId, because multiple task attempts may write blocks for the same map index. Having the block id contain the task attempt id allows to retrieve blocks from just block ids alone. Moving over to the map index, those block ids would become ambiguous.

However, the `ShufflePartitionedBlock` that provides the `blockId` **and** the `taskAttemptId`. Replacing the task attempt id in the block id with the map index would make `blockId` ambiguous. Together, `blockId` and `taskAttemptId` form a unique identifier.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1512/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1512,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zWH-z,incubator-uniffle,1935179699,1512,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-09T01:11:48Z,2024-02-09T01:11:48Z,"Sounds good. +1 for this.

I'm not sure this change whether will break down the LOCAL_ORDER feature in `LocalOrderSegmentSplitter` for AQE.

cc @jerqi @zhengchenyu ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5zWH-z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1512,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51LNjg,incubator-uniffle,1965873376,1512,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-02-27T06:30:27Z,2024-02-27T06:30:27Z,Superseded by #1529.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51LNjg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1518,https://api.github.com/repos/apache/incubator-uniffle/issues/1518,incubator-uniffle,2126682239,1518,[Bug] RssMRUtils.convertTaskAttemptIdToLong produces too large taskAttemptIds,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-02-09T08:28:08Z,2024-03-06T03:26:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The `RssMapOutputCollector` creates an RSS task attempt id via `RssMRUtils.convertTaskAttemptIdToLong`:
https://github.com/apache/incubator-uniffle/blob/866f5ff121948e2144729300a0f5cb03510db29d/client-mr/core/src/main/java/org/apache/hadoop/mapred/RssMapOutputCollector.java#L102-L104

that is later used to create an RSS block id:
https://github.com/apache/incubator-uniffle/blob/866f5ff121948e2144729300a0f5cb03510db29d/client-mr/core/src/main/java/org/apache/hadoop/mapred/SortWriteBufferManager.java#L379

However, the RSS task attempt id created by `RssMRUtils.convertTaskAttemptIdToLong` may exceed `Constants.MAX_TASK_ATTEMPT_ID` if `highBytes > 0`:
https://github.com/apache/incubator-uniffle/blob/866f5ff121948e2144729300a0f5cb03510db29d/client-mr/core/src/main/java/org/apache/hadoop/mapreduce/RssMRUtils.java#L51-L66

I think what this method is trying to do is create an RSS task attempt id where the upper `MAX_ATTEMPT_LENGTH` bits consist of the `taskAttemptID.getId()`, and the lower `TASK_ATTEMPT_ID_MAX_LENGTH - MAX_ATTEMPT_LENGTH` bits of the `taskAttemptID.getTaskID().getId()`.

I am just wondering why this is not breaking:
https://github.com/apache/incubator-uniffle/blob/866f5ff121948e2144729300a0f5cb03510db29d/client/src/main/java/org/apache/uniffle/client/util/ClientUtils.java#L57-L63
in
https://github.com/apache/incubator-uniffle/blob/866f5ff121948e2144729300a0f5cb03510db29d/client/src/main/java/org/apache/uniffle/client/util/ClientUtils.java#L42

That would mean `highBytes` is always `0`.

It looks like the TEZ client has pretty much the same logic, but there it uses `RssTezUtils.getBlockId` to create the RSS block id, which first deconstructs the task attempt id, and therefore does not suffer from this issue.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1518/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1518,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BIxU,incubator-uniffle,1980009556,1518,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-03-06T03:26:03Z,2024-03-06T03:26:03Z,"Done with #1529
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BIxU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1533,https://api.github.com/repos/apache/incubator-uniffle/issues/1533,incubator-uniffle,2145939518,1533,[FEATURE] support shuffle partition data read from multiple shuffle servers,dingshun3016,21172339,,,OPEN,2024-02-21T06:31:51Z,2024-08-30T01:23:17Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Based on https://github.com/apache/incubator-uniffle/issues/1373, we could support read one partition data from multiple shuffle servers.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1533/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1533,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BI_P,incubator-uniffle,1980010447,1533,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-03-06T03:27:23Z,2024-03-06T03:27:23Z,Having any process on this? @dingshun3016 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BI_P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1533,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KQqPd,incubator-uniffle,2319623133,1533,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-08-30T01:23:16Z,2024-08-30T01:23:16Z,@dingshun3016 Is there any update on this?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KQqPd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1535,https://api.github.com/repos/apache/incubator-uniffle/issues/1535,incubator-uniffle,2148282249,1535,[Improvement] Improve write throughput for rust,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-02-22T06:03:50Z,2024-02-22T06:03:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Limited by the rust poor lock performance, the peek write throughput could reach the 3.5G/s. After using the async data channel, the highest throghput could reach 5G/s . 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1535/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1538,https://api.github.com/repos/apache/incubator-uniffle/issues/1538,incubator-uniffle,2152216266,1538,[FEATURE] Optional blockIds report from remote shuffle-server to individual spark driver,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-02-24T08:48:40Z,2024-05-11T05:38:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the client will report blockIds to shuffle-server, that will burden servers' memory pressure. Besides, when implementing  serveless shuffle-server or quick graceful upgrade with #1373 , the current impl is not applicable for the future features.

So I think we could make the blockIds report to spark driver.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1538/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1538,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM509l1X,incubator-uniffle,1962302807,1538,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-24T08:54:47Z,2024-02-24T08:54:47Z,"If someone has passion on this, feel free to contact me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM509l1X/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1539,https://api.github.com/repos/apache/incubator-uniffle/issues/1539,incubator-uniffle,2152218006,1539,[FEATURE] Quick graceful upgrading for shuffle-server cluster,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-02-24T08:54:10Z,2024-09-07T02:14:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

After #1538 and #1373 is finished, we could implement the graceful quick upgrading for shuffle-server cluster.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1539/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1539,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM509l08,incubator-uniffle,1962302780,1539,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-24T08:54:41Z,2024-02-24T08:54:41Z,"If someone has passion on this, feel free to contact me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM509l08/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1539,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51B1LU,incubator-uniffle,1963414228,1539,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-02-26T06:36:33Z,2024-02-26T06:36:33Z,A good feature! +1 for this. Hope someone can pick this up. I'm currently not available.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51B1LU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1539,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LLVFI,incubator-uniffle,2335002952,1539,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-07T02:14:06Z,2024-09-07T02:14:06Z,@kuszz This is the issue about maintenance state server.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LLVFI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1542,https://api.github.com/repos/apache/incubator-uniffle/issues/1542,incubator-uniffle,2152387500,1542,[Bug] Unexpected exceptions happened when flushing events,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-02-24T16:29:19Z,2024-03-18T07:32:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

As described in https://github.com/apache/incubator-uniffle/pull/1537, here is the full stack trace:

```
[2024-02-24 21:01:20.540] [checkResource-0] [WARN] ShuffleTaskManager.preAllocatedBufferCheck - Remove expired preAllocatedBuffer[id=1213266] that required by app: application_1703049085550_4925739_1708775782306
[2024-02-24 21:01:20.540] [expiredAppCleaner-0] [INFO] ShuffleTaskManager.checkResourceStatus - Detect expired appId[application_1703049085550_4925739_1708775782306] according to rss.server.app.expired.withoutHeartbeat
[2024-02-24 21:01:20.547] [clearResourceThread] [INFO] ShuffleTaskManager.removeResources - Start remove resource for appId[application_1703049085550_4925739_1708775782306]
[2024-02-24 21:01:21.078] [LocalFileFlushEventThreadPool-0] [ERROR] DefaultFlushEventHandler.handleEventAndUpdateMetrics - Unexpected exceptions happened due to
java.lang.NullPointerException
at org.apache.uniffle.server.ShuffleTaskInfo.getMaxConcurrencyPerPartitionToWrite(ShuffleTaskInfo.java:109)
at org.apache.uniffle.server.ShuffleFlushManager.getMaxConcurrencyPerPartitionWrite(ShuffleFlushManager.java:198)
at org.apache.uniffle.server.ShuffleFlushManager.processFlushEvent(ShuffleFlushManager.java:149)
at org.apache.uniffle.server.DefaultFlushEventHandler.handleEventAndUpdateMetrics(DefaultFlushEventHandler.java:87)
at org.apache.uniffle.server.DefaultFlushEventHandler.lambda$dispatchEvent$0(DefaultFlushEventHandler.java:203)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
at java.lang.Thread.run(Thread.java:750)
```

As you can see, the exception will happen right after the appId is expired and the resources related to the appId are removed.

NPE happend here:
```
public int getMaxConcurrencyPerPartitionToWrite() {
  return specification.get().getMaxConcurrencyPerPartitionToWrite();
}
```

I wanna discuss about it. What's the best way to avoid the exception?

Updated:
I've encountered another exception too:
```
[2024-03-08 17:50:24.075] [epollEventLoopGroup-3-95] [ERROR] ShuffleServerNettyHandler.handleSendShuffleDataRequest - Error happened when shuffleEngine.write for appId[application_1703049085550_5931482_1709891324515], shuffleId[0], partitionId[18632]: null
java.lang.NullPointerException
        at org.apache.uniffle.server.ShuffleTaskManager.getDataDistributionType(ShuffleTaskManager.java:861)
        at org.apache.uniffle.server.ShuffleFlushManager.getDataDistributionType(ShuffleFlushManager.java:270)
        at org.apache.uniffle.server.buffer.ShuffleBufferManager.flushBuffer(ShuffleBufferManager.java:301)
        at org.apache.uniffle.server.buffer.ShuffleBufferManager.flush(ShuffleBufferManager.java:468)
        at org.apache.uniffle.server.buffer.ShuffleBufferManager.flushIfNecessary(ShuffleBufferManager.java:268)
        at org.apache.uniffle.server.buffer.ShuffleBufferManager.cacheShuffleData(ShuffleBufferManager.java:187)
        at org.apache.uniffle.server.ShuffleTaskManager.cacheShuffleData(ShuffleTaskManager.java:302)
        at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.handleSendShuffleDataRequest(ShuffleServerNettyHandler.java:168)
        at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.receive(ShuffleServerNettyHandler.java:78)
        at org.apache.uniffle.common.netty.handle.TransportRequestHandler.handle(TransportRequestHandler.java:62)
        at org.apache.uniffle.common.netty.handle.TransportChannelHandler.channelRead(TransportChannelHandler.java:100)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
        at io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:286)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
        at org.apache.uniffle.common.netty.TransportFrameDecoder.channelRead(TransportFrameDecoder.java:80)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:800)
        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:509)
        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:407)
        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
        at java.lang.Thread.run(Thread.java:750)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1542/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1542,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52E0JJ,incubator-uniffle,1980973641,1542,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-06T14:18:11Z,2024-03-06T14:18:11Z,Anyone will be welcome to pick this up.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52E0JJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1542,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM53ZOvy,incubator-uniffle,2003102706,1542,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-18T07:32:54Z,2024-03-18T07:32:54Z,Done by https://github.com/apache/incubator-uniffle/pull/1574,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM53ZOvy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1543,https://api.github.com/repos/apache/incubator-uniffle/issues/1543,incubator-uniffle,2153065730,1543,[Improvement] [SPARK]Optimize shuffle reading when both sort and combine are used.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-02-26T01:24:23Z,2024-05-07T23:59:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

See SPARK-46512 for details

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1543/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1543,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51BDOg,incubator-uniffle,1963209632,1543,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-02-26T02:25:26Z,2024-02-26T02:25:26Z,"Nice catch, looking forward this! ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51BDOg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1546,https://api.github.com/repos/apache/incubator-uniffle/issues/1546,incubator-uniffle,2156138265,1546,[Bug] NPE could happen before uncompressing after #1360,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-02-27T09:47:32Z,2024-02-28T11:11:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

java.lang.NullPointerException
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.isSameMemoryType(RssShuffleDataIterator.java:154)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.uncompress(RssShuffleDataIterator.java:169)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:122)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:297)
	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage1.sort_addToSorter_0$(generated.java:31)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage1.processNext(generated.java:43)
	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)
	at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:760)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage3.smj_findNextJoinRows_0$(generated.java:42)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage3.processNext(generated.java:149)
	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)
	at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$2.hasNext(WholeStageCodegenExec.scala:779)
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.writeImpl(RssShuffleWriter.java:256)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:238)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)
	at org.apache.spark.scheduler.Task.run(Task.scala:136)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1556)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)

![1709027212050](https://github.com/apache/incubator-uniffle/assets/13834479/01cb7a42-7b76-49d4-b945-616cc12edb4f)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1546/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1548,https://api.github.com/repos/apache/incubator-uniffle/issues/1548,incubator-uniffle,2158167200,1548,[Bug] Duplicated shaded-grpc jar cause task fail,lifeSo,9440617,Qing,1169158401@qq.com,OPEN,2024-02-28T05:45:15Z,2024-03-18T08:34:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

There is shaded-grpc jar in client-tez,
When there is also shaded-grpc jar in user UDF, 
then, there will be sometimes task fail.

![Uploading image.png…]()


### Affects Version(s)

0.7.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

```logtalk
###|||2024-02-23 11:07:41.996|||INFO|||-|||-|||main|||-|||RssDAGAppMaster--->Registering coordinators 172.19.193.73:19999,172.19.193.182:19999
###|||2024-02-23 11:07:41.996|||INFO|||-|||-|||main|||-|||CoordinatorClientFactory--->Start to create coordinator clients from 172.19.193.73:19999,172.19.193.182:19999
###|||2024-02-23 11:07:42.013|||ERROR|||-|||-|||main|||-|||RssDAGAppMaster--->Error starting RssDAGAppMaster
java.lang.NoSuchFieldError: EPOLL_DOMAIN_CLIENT_CHANNEL_TYPE
        at io.grpc.netty.shaded.io.grpc.netty.UdsNettyChannelProvider.isAvailable(UdsNettyChannelProvider.java:34)
        at io.grpc.ManagedChannelRegistry$ManagedChannelPriorityAccessor.isAvailable(ManagedChannelRegistry.java:172)
        at io.grpc.ManagedChannelRegistry$ManagedChannelPriorityAccessor.isAvailable(ManagedChannelRegistry.java:168)
        at io.grpc.ServiceProviders.loadAll(ServiceProviders.java:68)
        at io.grpc.ManagedChannelRegistry.getDefaultRegistry(ManagedChannelRegistry.java:96)
        at io.grpc.ManagedChannelProvider.provider(ManagedChannelProvider.java:41)
        at io.grpc.ManagedChannelBuilder.forAddress(ManagedChannelBuilder.java:39)
        at org.apache.uniffle.client.impl.grpc.GrpcClient.<init>(GrpcClient.java:43)
        at org.apache.uniffle.client.impl.grpc.CoordinatorGrpcClient.<init>(CoordinatorGrpcClient.java:91)
        at org.apache.uniffle.client.impl.grpc.CoordinatorGrpcClient.<init>(CoordinatorGrpcClient.java:87)
        at org.apache.uniffle.client.impl.grpc.CoordinatorGrpcClient.<init>(CoordinatorGrpcClient.java:83)
        at org.apache.uniffle.client.factory.CoordinatorClientFactory.createCoordinatorClient(CoordinatorClientFactory.java:43)
        at org.apache.uniffle.client.factory.CoordinatorClientFactory.createCoordinatorClient(CoordinatorClientFactory.java:69)
        at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.registerCoordinators(ShuffleWriteClientImpl.java:431)
        at org.apache.tez.dag.app.RssDAGAppMaster.initAndStartRSSClient(RssDAGAppMaster.java:144)
        at org.apache.tez.dag.app.RssDAGAppMaster.serviceInit(RssDAGAppMaster.java:107)
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:164)
        at org.apache.tez.dag.app.DAGAppMaster$9.run(DAGAppMaster.java:2662)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:422)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730)
        at org.apache.tez.dag.app.DAGAppMaster.initAndStartAppMaster(DAGAppMaster.java:2659)
        at org.apache.tez.dag.app.RssDAGAppMaster.main(RssDAGAppMaster.java:348)
```


### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1548/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1548,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51UZkR,incubator-uniffle,1968281873,1548,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-02-28T05:50:34Z,2024-02-28T05:50:34Z,"In tez-client:
![image](https://github.com/apache/incubator-uniffle/assets/9440617/8740e633-d1d4-48f9-8536-021b7c7c9b2f)


There is no ""EPOLL_DOMAIN_CLIENT_CHANNEL_TYPE"" field in user shaded-grpc jar:
![image](https://github.com/apache/incubator-uniffle/assets/9440617/4514a0b6-173e-43cc-a6da-03aff0f5b167)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM51UZkR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1548,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52_HXa,incubator-uniffle,1996256730,1548,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-03-14T02:02:03Z,2024-03-14T02:02:03Z,Could you help fix this? @lifeSo ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52_HXa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1548,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM53ZlrH,incubator-uniffle,2003196615,1548,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-03-18T08:34:02Z,2024-03-18T08:34:02Z,"> Could you help fix this? @lifeSo

OK, I could try, remove or rename the shaded jar name to other, to not conflict user's jar. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM53ZlrH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1549,https://api.github.com/repos/apache/incubator-uniffle/issues/1549,incubator-uniffle,2158487778,1549,[Bug] Uniformly throw RssException for external callers,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-02-28T09:22:53Z,2024-02-28T11:11:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

We need to uniformly throw `RssException` for external callers, making it convenient for them to perform unified exception handling.

For example , as described in https://github.com/apache/incubator-uniffle/issues/888, we can uniformly handle `RssException` in Spark's `TaskSetManager`.

Some custom exception classes in the `rss-common` module directly inherit from `RuntimeException`, instead of `RssException`. Since the `rss-common` module can be directly used by clients, we need to fix this issue.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1549/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1552,https://api.github.com/repos/apache/incubator-uniffle/issues/1552,incubator-uniffle,2161561141,1552,[Improvement] Migrate from log4j1 to log4j2,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-02-29T15:46:29Z,2024-03-06T03:24:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Apache Uniffle uses log4j 1.x, so hence is not susceptible to the recent log4j v2 vulnerability. However, log4j 1.x has reached end of life and is no longer supported. Vulnerabilities reported after August 2015 against log4j 1.x were not checked and will not be fixed. As a result, we are recommended to upgrade Uniffle to Log4j 2 as soon as possible.

When using log4j 1.x, there is a probability of performance bottlenecks in high concurrency scenarios, like:
```
""epollEventLoopGroup-3-100"" #267 prio=10 os_prio=0 cpu=1354.16ms elapsed=124.91s tid=0x0000563b3a4dc000 nid=0x202 waiting for monitor entry [0x00007f3532371000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at org.apache.log4j.Category.callAppenders(Category.java:204)
	- waiting to lock <0x00007f3634089b88> (a org.apache.log4j.spi.RootLogger)
	at org.apache.log4j.Category.forcedLog(Category.java:384)
	at org.apache.log4j.Category.log(Category.java:810)
	at org.slf4j.impl.Reload4jLoggerAdapter.info(Reload4jLoggerAdapter.java:347)
        at org.apache.uniffle.
        ...
```

Log4j2 uses java.util.concurrent libraries to perform locking at the lowest level possible. Log4j-1.x has known deadlock issues.


### How should we improve?

Migrate from log4j1 to log4j2

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1552/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1554,https://api.github.com/repos/apache/incubator-uniffle/issues/1554,incubator-uniffle,2163261850,1554,[FEATURE] Support dynamic client conf for creating ShuffleWriteClient,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-03-01T12:06:32Z,2024-03-14T02:01:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Dynamic client configuration should support configuring the `ShuffleWriteClient` of shuffle manager that fetches the config.

### Motivation

Providing cluster-wide defaults via coordinators to configure the `ShuffleWriteClient` has operational benefits.

One use case is to have coordinators provide a BlockId layout configuration for clients (#1528).

### Describe the solution

Currently, the dynamic client configuration cannot be used to configure the `ShuffleWriteClient` because the `ShuffleWriteClient` is used to fetch the dynamic client configuration, so the client has to be created first.

These solutions exist:
1. Create another `ShuffleWriteClient` after dynamic client config has been fetched.
2. Have `RssShuffleManager` create its own set of `CoordinatorClient`s to fetch the dynamic client conf, then update the client configuration to finally create the `ShuffleWriteClient`.
3. Provide the updated `RssConfig` to `ShuffleWriteClient`, to re-initialize from it.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1554/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,incubator-uniffle,2165869082,1555,[Serious Bug] The number of output rows in SortMergeJoin has increased after enabling RSS,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-04T03:57:22Z,2024-03-10T13:41:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Updated:
The results when enabling RSS seem to be arbitrary, producing a different outcome each time the SQL is executed. There must be an issue somewhere.

The tpcds SQL used to reproduce the bug:
```
select count(*) from (select * from (select s.*,c.* from (select *,floor(rand()*82857000) as sr from store_sales) s join (select*,floor(rand()*82857000)as cr from customer)  c on s.sr=c.cr) sc DISTRIBUTE BY sc.ss_customer_sk,sc.ss_item_sk)
```

Enable RSS (The result of the SQL is copied from the Spark stdout log):
![image](https://github.com/apache/incubator-uniffle/assets/13834479/f2ea99ee-3c96-4084-b4ec-34349edc844b)
![image](https://github.com/apache/incubator-uniffle/assets/13834479/6c8f0733-7599-4428-a549-26248fbe5761)
![image](https://github.com/apache/incubator-uniffle/assets/13834479/447747bb-7f11-49b7-98cd-9975cc4d1f90)

Disable RSS (The result of the SQL is copied from the Spark stdout log):
![image](https://github.com/apache/incubator-uniffle/assets/13834479/421a8676-e536-4ddc-8f57-7f58d4821a08)
![image](https://github.com/apache/incubator-uniffle/assets/13834479/be557779-c81c-4ef9-80d7-2a57bee561e2)
![image](https://github.com/apache/incubator-uniffle/assets/13834479/3c8ecd07-7195-4654-95be-73e5a8dfa234)



### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1555/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BH5M,incubator-uniffle,1980005964,1555,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-03-06T03:21:03Z,2024-03-06T03:21:03Z,I'm not sure whether this will happen on the task failure.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BH5M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52Brz-,incubator-uniffle,1980153086,1555,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-06T06:08:35Z,2024-03-06T06:08:35Z,"This might not be a bug. I'll close this for now. If I can reproduce this, I will reopen it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52Brz-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BtZa,incubator-uniffle,1980159578,1555,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-03-06T06:15:43Z,2024-03-06T06:15:43Z,"Those numbers are collected through Spark accumulators, which are sensitive to rerunning tasks. They over-count the actual number of rows. You should see further down the query plan (the next stage without task failures) the numbers match again.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52BtZa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52bbNS,incubator-uniffle,1986900818,1555,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-09T16:12:39Z,2024-03-09T16:12:39Z,"I have to reopen this. Because I am very sure to reproduce this issue now.
I've updated the description of this issue. I think this is a serious bug.
PTAL. @zuston @jerqi @EnricoMi","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52bbNS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52bhWC,incubator-uniffle,1986925954,1555,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-03-09T17:34:35Z,2024-03-09T17:34:35Z,"Stage 3 (with RSS enabled) has speculative tasks. Their rows count towards the `number of output rows`. Another indication is that stage 3 writes more data than is being read by stage 4. With RSS disabled, both numbers are identical because there are only one attempts per task.

Those number are only comparable with `spark.speculation=false` and `spark.task.maxFailures=0`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52bhWC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52bhmp,incubator-uniffle,1986927017,1555,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-03-09T17:39:14Z,2024-03-09T17:39:14Z,If you'd do a count in the end you should see differing number of rows with and without RSS if RSS adds rows.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52bhmp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52cVEN,incubator-uniffle,1987137805,1555,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-10T08:06:31Z,2024-03-10T08:06:31Z,"> If you'd do a count in the end you should see differing number of rows with and without RSS if RSS adds rows.

I don't think it's related to Spark speculation, because you can see the final count result is different. I think you might have missed the count results that I've uploaded.
![image](https://github.com/apache/incubator-uniffle/assets/13834479/2ecaefcf-6fc9-4324-80e8-ef199b83af4c)
![image](https://github.com/apache/incubator-uniffle/assets/13834479/de73d5da-4b6a-46f7-82a8-91aacd1c7b97)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52cVEN/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52cWDM,incubator-uniffle,1987141836,1555,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-03-10T08:24:19Z,2024-03-10T08:24:19Z,The counts are a solid proof.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52cWDM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52caG4,incubator-uniffle,1987158456,1555,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-10T09:28:14Z,2024-03-10T09:28:14Z,"> The counts are a solid proof.

I totally can't get your point. You think this is not a bug or what do you mean?
I think after enabling RSS, the count results should be the same, right?

I turned speculation off, and you can see the count results are still not the same, the result is different but still greater:
![image](https://github.com/apache/incubator-uniffle/assets/13834479/785b95ce-e78d-4f11-ad7b-05f11bfdf4b0)
![image](https://github.com/apache/incubator-uniffle/assets/13834479/d4b4e866-8300-481f-8e17-7eceffb8b51e)
![image](https://github.com/apache/incubator-uniffle/assets/13834479/1f1240d1-f10b-4dbf-afee-b4e622e63cd2)


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52caG4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52cd7L,incubator-uniffle,1987174091,1555,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-10T10:20:46Z,2024-03-10T10:20:46Z,"After turning off speculation in Spark and enabling RSS, I found that running the same SQL each time yields different results. However, the results should all be greater than those obtained without enabling RSS, like the following results:
![image](https://github.com/apache/incubator-uniffle/assets/13834479/ac2d24b0-2b8d-449d-9134-9f03c96c54f7)
![image](https://github.com/apache/incubator-uniffle/assets/13834479/ce04f735-e741-49df-859f-0f5a947b42b3)

The results seem random, which indicates that there might be an issue somewhere, probably related to concurrency.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52cd7L/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1555,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52cpVk,incubator-uniffle,1987220836,1555,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-10T12:58:44Z,2024-03-10T12:58:44Z,The issue might be caused by the `rand()` function in my SQL. The `rand()` function requires a fixed seed value parameter to ensure consistent results for each execution. I will close this issue for now and will reopen it if there are any problems after further confirmation.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52cpVk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1560,https://api.github.com/repos/apache/incubator-uniffle/issues/1560,incubator-uniffle,2170840828,1560,[Bug] A concurrency issue occurred when flushing events and removing resources at the same time,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-06T07:37:59Z,2024-03-18T07:32:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```
[2024-03-05 12:24:37.811] [clearResourceThread] [ERROR] ShuffleTaskManager.lambda$new$0 - Exception happened when clearing resource for expired application for appId: application_1703049085550_5682506_1709610574306
io.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1
        at io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:83)
        at io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:148)
        at io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:101)
        at org.apache.uniffle.server.buffer.ShuffleBufferManager.lambda$removeBufferByShuffleId$9(ShuffleBufferManager.java:656)
        at java.lang.Iterable.forEach(Iterable.java:75)
        at org.apache.uniffle.server.buffer.ShuffleBufferManager.removeBufferByShuffleId(ShuffleBufferManager.java:656)
        at org.apache.uniffle.server.buffer.ShuffleBufferManager.removeBuffer(ShuffleBufferManager.java:319)
        at org.apache.uniffle.server.ShuffleTaskManager.removeResources(ShuffleTaskManager.java:757)
        at org.apache.uniffle.server.ShuffleTaskManager.lambda$new$0(ShuffleTaskManager.java:189)
        at java.lang.Thread.run(Thread.java:750)
```

Similar to https://github.com/apache/incubator-uniffle/issues/1542.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1560/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1560,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52Ez-l,incubator-uniffle,1980972965,1560,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-06T14:17:50Z,2024-03-06T14:17:50Z,Anyone will be welcome to pick this up.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52Ez-l/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1560,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM53ZOpH,incubator-uniffle,2003102279,1560,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-18T07:32:36Z,2024-03-18T07:32:36Z,Done by https://github.com/apache/incubator-uniffle/pull/1574,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM53ZOpH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1561,https://api.github.com/repos/apache/incubator-uniffle/issues/1561,incubator-uniffle,2170889779,1561,[FEATURE] Support Spark 2.1,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-06T08:10:45Z,2024-03-12T15:33:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Some companies are still using Spark 2.1, we should support this.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1561/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1561,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52CT1M,incubator-uniffle,1980317004,1561,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-03-06T08:22:16Z,2024-03-06T08:22:16Z,"Spark 2.1 has been EOL'ed almost 6 years ago. Companies are missing out on features, performance and are subject to security issues. This should not be supported. Spark 4.0 will be released this summer.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52CT1M/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1561,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52Ckmc,incubator-uniffle,1980385692,1561,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-06T09:00:15Z,2024-03-06T09:00:15Z,"> Spark 2.1 has been EOL'ed almost 6 years ago. Companies are missing out on features, performance and are subject to security issues. This should not be supported. Spark 4.0 will be released this summer.

For some large companies, upgrading the Spark version is troublesome and complicated, as there are many historical burdens involved. We need to support these users to strengthen the activity of our community, and this will not bring any additional costs or burdens. I will try to implement this part. I think there is no need to worry about it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52Ckmc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1561,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52ETzH,incubator-uniffle,1980841159,1561,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-06T13:08:57Z,2024-03-06T13:08:57Z,@EnricoMi I will close this issue. Spark 2.1 is indeed too old. We only support Spark version 2.3 and above.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52ETzH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1564,https://api.github.com/repos/apache/incubator-uniffle/issues/1564,incubator-uniffle,2173170786,1564,[Bug] LocalStorageChecker hang when disk is corrupted,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-03-07T07:33:12Z,2024-03-13T03:24:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I found the LocalStorageChecker hangs when encoutering the disk corruption, which makes the some apps fail due to the data is missing. Because uniffle haven't mark this disk corruption because the thread hang.

jstack as follows:

![image](https://github.com/apache/incubator-uniffle/assets/8609142/49270db5-a79b-4577-93ba-4e67ceb1dac8)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1564/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1567,https://api.github.com/repos/apache/incubator-uniffle/issues/1567,incubator-uniffle,2174240871,1567,[Bug] NoSuchMethodError will be encountered when using Spark 2.x,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-07T16:19:29Z,2024-03-11T01:53:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```
24/03/07 16:34:37 INFO SecurityManager: SecurityManager: authentication disabled; ui acls disabled; users  with view permissions: Set(tdwadmin); groups with view permissions: Set(); users  with modify permissions: Set(tdwadmin); groups with modify permissions: Set()
Exception in thread ""main"" java.lang.NoSuchMethodError: org.apache.spark.network.util.NettyUtils.createEventLoop(Lorg/apache/spark/network/util/IOMode;ILjava/lang/String;)Lio/netty/channel/EventLoopGroup;
	at org.apache.spark.network.client.TransportClientFactory.<init>(TransportClientFactory.java:104)
	at org.apache.spark.network.TransportContext.createClientFactory(TransportContext.java:89)
	at org.apache.spark.rpc.netty.NettyRpcEnv.<init>(NettyRpcEnv.scala:70)
	at org.apache.spark.rpc.netty.NettyRpcEnvFactory.create(NettyRpcEnv.scala:449)
	at org.apache.spark.rpc.RpcEnv$.create(RpcEnv.scala:56)
	at org.apache.spark.SparkEnv$.create(SparkEnv.scala:264)
	at org.apache.spark.SparkEnv$.createDriverEnv(SparkEnv.scala:193)
	at org.apache.spark.SparkContext.createSparkEnv(SparkContext.scala:271)
	at org.apache.spark.SparkContext.<init>(SparkContext.scala:474)
	at org.apache.spark.deploy.yarn.SQLApplicationMaster.<init>(SQLApplicationMaster.scala:96)
	at org.apache.spark.deploy.yarn.SQLApplicationMaster.<init>(SQLApplicationMaster.scala:53)
	at org.apache.spark.deploy.yarn.SQLApplicationMaster$$anonfun$main$1.apply$mcV$sp(SQLApplicationMaster.scala:544)
	at org.apache.spark.deploy.SparkHadoopUtil$$anon$1.run(SparkHadoopUtil.scala:61)
	at org.apache.spark.deploy.SparkHadoopUtil$$anon$1.run(SparkHadoopUtil.scala:60)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:2286)
	at org.apache.spark.deploy.SparkHadoopUtil.runAsSparkUser(SparkHadoopUtil.scala:60)
	at org.apache.spark.deploy.yarn.SQLApplicationMaster$.main(SQLApplicationMaster.scala:543)
	at org.apache.spark.deploy.yarn.SQLApplicationMaster.main(SQLApplicationMaster.scala)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1567/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1569,https://api.github.com/repos/apache/incubator-uniffle/issues/1569,incubator-uniffle,2175199186,1569,[Flaky Test] test_ticket_manager for rust,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-03-08T03:17:59Z,2024-03-08T09:34:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

![image](https://github.com/apache/incubator-uniffle/assets/8609142/ce57d26b-f4e1-4c79-ab58-579392773886)

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/8186834919/job/22386042466?pr=1557

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1569/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1571,https://api.github.com/repos/apache/incubator-uniffle/issues/1571,incubator-uniffle,2181519172,1571,[Bug] Memory may leak when EventInvalidException occurs,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-12T12:38:42Z,2024-03-18T07:26:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

This issue may cause the memory of the shuffle server to never be released.
![image](https://github.com/apache/incubator-uniffle/assets/13834479/76589efd-10f8-4611-bf09-3f218928e5c6)


```
[2024-03-08 17:51:25.737] [clearResourceThread] [INFO] HybridStorageManager.removeResources - Start to remove resource of AppPurgeEvent{appId='application_1703049085550_5925694_1709883294114', user='tdwadmin', shuffleIds=[0, 1, 2]}
[2024-03-08 17:51:25.743] [clearResourceThread] [INFO] LocalStorageManager.cleanupStorageSelectionCache - Cleaning the storage selection cache costs: 4(ms) for event: AppPurgeEvent{appId='application_1703049085550_5925694_1709883294114', user='tdwadmin', shuffleIds=[0, 1, 2]}
[2024-03-08 17:51:25.743] [clearResourceThread] [INFO] LocalStorage.removeResources - Start to remove resource of application_1703049085550_5925694_1709883294114/0
[2024-03-08 17:51:25.743] [clearResourceThread] [INFO] LocalStorage.removeResources - Finish remove resource of application_1703049085550_5925694_1709883294114/0, disk size is 736983533790 and 2 shuffle metadata
[2024-03-08 17:51:25.743] [clearResourceThread] [INFO] LocalStorage.removeResources - Start to remove resource of application_1703049085550_5925694_1709883294114/1
[2024-03-08 17:51:25.743] [clearResourceThread] [INFO] LocalStorage.removeResources - Finish remove resource of application_1703049085550_5925694_1709883294114/1, disk size is 736983533790 and 2 shuffle metadata
[2024-03-08 17:51:25.743] [clearResourceThread] [INFO] LocalStorage.removeResources - Start to remove resource of application_1703049085550_5925694_1709883294114/2
[2024-03-08 17:51:25.743] [clearResourceThread] [INFO] LocalStorage.removeResources - Finish remove resource of application_1703049085550_5925694_1709883294114/2, disk size is 134246092 and 1 shuffle metadata
[2024-03-08 17:51:25.764] [LocalFileFlushEventThreadPool-25] [WARN] ShuffleFlushManager.processFlushEvent - AppId application_1703049085550_5925694_1709883294114 was removed already, event:ShuffleDataFlushEvent: eventId=38029, appId=application_1703049085550_5925694_1709883294114, shuffleId=2, startPartition=13682, endPartition=13682, retryTimes=0, underStorage=LocalStorage, isPended=false, ownedByHugePartition=false should be dropped
[2024-03-08 17:51:25.770] [LocalFileFlushEventThreadPool-25] [WARN] ShuffleFlushManager.processFlushEvent - AppId application_1703049085550_5925694_1709883294114 was removed already, event:ShuffleDataFlushEvent: eventId=38030, appId=application_1703049085550_5925694_1709883294114, shuffleId=2, startPartition=13683, endPartition=13683, retryTimes=0, underStorage=LocalStorage, isPended=false, ownedByHugePartition=false should be dropped
```

This is due to the multithreading concurrency issue between the scheduled cleanup task and the flush event.


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1571/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1571,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52uIo-,incubator-uniffle,1991805502,1571,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-12T14:38:32Z,2024-03-12T14:38:32Z,"We already have a fix, still working on it. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52uIo-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1571,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52z5q_,incubator-uniffle,1993317055,1571,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-03-13T03:27:12Z,2024-03-13T03:27:12Z,cc @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM52z5q_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1572,https://api.github.com/repos/apache/incubator-uniffle/issues/1572,incubator-uniffle,2183064981,1572,[Bug] Exceptions might be discarded when spilling buffers ,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-13T03:56:15Z,2024-03-14T01:33:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

A return statement inside a finally block will cause any exception that might be thrown in the try or catch block to be discarded.

I think we need to handle all the exceptions when spilling buffers.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1572/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1576,https://api.github.com/repos/apache/incubator-uniffle/issues/1576,incubator-uniffle,2185666589,1576,[FEATURE] Provide the default no-hadoop-home deployment guide,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-03-14T07:50:25Z,2024-03-18T09:38:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

As we all know, the hadoop env is not simple to set up, and so this PR is to give the guide to simplify the uniffle shuffle-server deployment without hadoop home env.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1576/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1579,https://api.github.com/repos/apache/incubator-uniffle/issues/1579,incubator-uniffle,2185929159,1579,[Bug] previous data is not deleted when re-register shuffle after re-assignment for stage recomputing ,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-03-14T09:57:20Z,2024-06-13T01:31:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

previous data is not deleted when re-register shuffle after re-assignment for stage recomputing 

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1579/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1585,https://api.github.com/repos/apache/incubator-uniffle/issues/1585,incubator-uniffle,2188431504,1585,"[FEATURE] Add metrics about block size distribution, either overall or on a per-application basis.",leslizhang,16606973,leslizhang,453688819@qq.com,CLOSED,2024-03-15T12:42:00Z,2024-05-09T13:56:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Add metrics about block size distribution, on overall or on a per-application basis.

### Motivation

We know that in RSS, the size of shuffle blocks generated by Spark tasks can vary greatly due to differences in configurations (such as memory, RDD partition count, etc.). Generally speaking, the larger the shuffle block size generated by a task, the higher the efficiency of transferring shuffle data from the Spark task to the shuffle server. There is also some disk space savings after the shuffle server-side persistence (size of the index file); during shuffle read, the entire index file content is requested in a single read operation. If the index file is too large, the shuffle read process may be negatively affected. By collecting and utilizing the block size distribution, we can assist in optimizing the configuration of Spark jobs, thereby achieving better performance.

### Describe the solution

While caching the shuffle partition data of jobs in the shuffle server, synchronously record the total or per-application block size, and collect it into the histogram type of metrics in Prometheus.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1585/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1585,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM53OC2L,incubator-uniffle,2000170379,1585,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-15T17:58:56Z,2024-03-15T17:58:56Z,The PR for this feature will be created only after https://github.com/apache/incubator-uniffle/pull/1574 is merged. Because both PRs modify the same files. @jerqi @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM53OC2L/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1585,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VJuM,incubator-uniffle,2102696844,1585,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-09T13:46:58Z,2024-05-09T13:46:58Z,@jerqi @zuston We can close this.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VJuM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1586,https://api.github.com/repos/apache/incubator-uniffle/issues/1586,incubator-uniffle,2191584603,1586,[Improvement] Allow Netty Worker thread pool size to dynamically adapt to the number of processor cores,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-18T08:56:43Z,2024-03-21T06:08:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Allow Netty Worker thread pool size to dynamically adapt to the number of processor cores.
We will have a more reasonable default value and better performance in most cases.

### How should we improve?

Just use the default value in Netty (but not less than the original value `100`), Netty sets this dynamically in `io.netty.channel.MultithreadEventLoopGroup`:

```
static {
    DEFAULT_EVENT_LOOP_THREADS = Math.max(1, SystemPropertyUtil.getInt(
            ""io.netty.eventLoopThreads"", NettyRuntime.availableProcessors() * 2));

    if (logger.isDebugEnabled()) {
        logger.debug(""-Dio.netty.eventLoopThreads: {}"", DEFAULT_EVENT_LOOP_THREADS);
    }
}
```

It will be better than just using the static value `100`.

More detailed reasons:
Netty sets the default `EventLoop` pool size to `processor * 2` primarily to fully utilize CPU resources in a multi-core environment while maintaining good performance and throughput.

In Netty, `processor` refers to the available number of CPU cores. Setting the `EventLoop` pool size to `processor * 2` means that each CPU core will have two event loop threads available. The benefits of this approach are:

1. Better utilization of multi-core performance: In a multi-core environment, each CPU core can process tasks in parallel. By setting the event loop thread count to twice the number of cores, each core is ensured to have enough threads to handle tasks, thus improving performance and throughput at the same time.

2. Avoid thread starvation: In high-concurrency scenarios, some threads may be blocked, preventing other threads from continuing to execute. By increasing the number of event loop threads, the likelihood of thread starvation can be reduced, thereby improving the system's responsiveness.

3. Better handling of I/O operations: Netty is commonly used for handling network I/O operations, which may be blocked while waiting for I/O completion. By increasing the number of event loop threads, enough threads can be ensured to handle I/O operations, thus improving the system's throughput.

However, setting the `EventLoop` pool size to `processor * 2` is not always the best choice. In some scenarios, it may be necessary to adjust the number of event loop threads based on actual requirements and system resources. For example, if system resources are limited, it may be necessary to reduce the size of the event loop pool to avoid resource exhaustion. Therefore, in practical applications, it is best to determine the optimal `EventLoop` pool size through load testing and performance analysis.

But again, it will still be better than just using the static value `100`.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1586/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1588,https://api.github.com/repos/apache/incubator-uniffle/issues/1588,incubator-uniffle,2191674723,1588,[Bug] The exception might be swallowed when there is a bug in the code while handling the FlushEvent,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-18T09:30:40Z,2024-03-18T11:40:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Currently, the thread pool handling the `FlushEvent` does not have exception handling in place. If there are unknown bugs in the subsequent code, exceptions might be swallowed, making it difficult to pinpoint the issue.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1588/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1591,https://api.github.com/repos/apache/incubator-uniffle/issues/1591,incubator-uniffle,2194179105,1591,[FEATURE] Support Spark 3.5.1,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2024-03-19T06:54:28Z,2024-03-20T06:22:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Since Spark 3.5.1 is released, we should support this version.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

The abstract class `TaskContext` introduced a new method `isFailed()` after Spark version 3.5.1. Due to this addition, it is not possible to compile the `MockTaskContext` class using Spark 3.5.1 without modifying the code. Consequently, we also added the `isFailed()` method to `MockTaskContext`. However, to maintain compatibility with versions of Spark prior to 3.5.1, we did not annotate this method with `@Override`.

Compiling old code with Spark 3.5.1 results in the following error: 
```error: MockTaskContext is not abstract and does not override abstract method isFailed() in TaskContext.```
Additionally, adding the `@Override` annotation leads to another error: 
```error: method does not override or implement a method from a supertype.```

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1591/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1594,https://api.github.com/repos/apache/incubator-uniffle/issues/1594,incubator-uniffle,2197646635,1594,[FEATURE] support generating larger block size during shuffle map task by spill partial partitions data,leslizhang,16606973,leslizhang,453688819@qq.com,CLOSED,2024-03-20T14:13:26Z,2024-06-18T15:33:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

At least three situations can trigger a large number of small blocks in shuffle map task:

1. **Data skew:** When the data processed by the map task mostly belongs to a few reduce tasks, the sum of the data for the few reduce tasks exceeds the spill threshold, causing the remaining long-tail reduce tasks to spill together passively.
2. **The number of reduce tasks is extremely large (>10k)**: When each reduce partition has very little data, it will also cause the buffer of the `ShuffleBufferManager` of the shuffle map task to be occupied beyond the spill threshold, thereby producing a large number of small blocks.
3. **When an executor can run multiple tasks at the same time**, there is memory competition between tasks. At this time, some tasks may not get enough memory because they start later than other tasks, but the overall memory of the executor is insufficient to cause `ShuffleBufferManager` to spill as a MemoryConsumer. In fact, `ShuffleBufferManager` may only store a small amount of data for each reduce partition.

Problems caused by small blocks:

Unnecessary network overhead: The amount of data sent in a single transmission is reduced, increasing the number of network interactions between the executor and the shuffle server. The number of interactions can expand up to 10 times or even 100 times.
Increase the size of the index file when the shuffle server stores shuffle data persistently.

### Motivation

_No response_

### Describe the solution

when spilling shuffle data, we just spill part of the reduce partition datas which hold the major space.
so, in each spilling process, the WriteBufferManager.clear() method  should implement one more logic: sort the to-be spilled buffers by their size and select the top-N buffers to spill.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1594/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1594,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54DdT_,incubator-uniffle,2014172415,1594,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-03-22T01:53:51Z,2024-03-22T01:53:51Z,+1. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54DdT_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1594,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54H_5Q,incubator-uniffle,2015362640,1594,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-03-22T15:38:12Z,2024-03-22T15:38:12Z,Sorting the partition data by the reduce partition id should maximize block sizes. Is that an option?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54H_5Q/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1594,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM58D1JH,incubator-uniffle,2081378887,1594,NA,leslizhang,16606973,leslizhang,453688819@qq.com,NA,2024-04-28T07:53:15Z,2024-04-28T07:53:15Z,"With this feature, the buffer size of a single partition(spark.rss.writer.buffer.size) can be increased to a larger value, for example, from the current default configuration of 3MB to 10MB or more.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM58D1JH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1596,https://api.github.com/repos/apache/incubator-uniffle/issues/1596,incubator-uniffle,2200075139,1596,[Bug] Reading local shuffle data in high-pressure scenarios may lead to high system load,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-21T12:32:31Z,2024-05-27T02:55:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

1. When enabling Netty, the current timing of releasing `readMemory` in the code is incorrect because the method `client.getChannel().writeAndFlush()` is asynchronous. If we release `readMemory` directly, it will result in `readMemory` being released before it has a chance to take effect. And the file reading only occurs after the `writeAndFlush` method is called. We should add a `ChannelFutureListener` and use its callback mechanism to release `readMemory`. This can ensure the `writeAndFlush` method is truly completed.

2. ~~We haven't set a limit on the maximum number of concurrent requests(for reading local shuffle data) that can be processed at the same time; we only controlled the maximum `readCapacity` of the buffer when reading local shuffle data. This approach falls short. In our tests, we discovered that the metric `read_used_buffer_size` could potentially only reach up to 3.75GB, yet the system load on the shuffle server was already high. This suggests that relying solely on `readCapacity` to manage the reading of local shuffle data is inadequate.~~

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1596/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1596,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5370J3,incubator-uniffle,2012168823,1596,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-21T12:34:18Z,2024-03-21T12:34:18Z,"I will use a thread pool to control the concurrency when reading shuffle data. If anyone has any good suggestions, please feel free to let me know.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5370J3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1596,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54Dcsd,incubator-uniffle,2014169885,1596,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-03-22T01:50:17Z,2024-03-22T01:50:17Z,Read concurrency is not limited in current codebase. +1 for this issue.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54Dcsd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1596,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54Ds88,incubator-uniffle,2014236476,1596,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-03-22T02:55:03Z,2024-03-22T02:55:03Z,"We ever calculated the number of write threads. 2 threads per HDD or  3 threads per SSD will obtain the best performance.
You can evaluate the number threads which we need.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54Ds88/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1596,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_HBbB,incubator-uniffle,2132547265,1596,NA,dingshun3016,21172339,,,NA,2024-05-27T02:46:17Z,2024-05-27T02:46:17Z,"Is this error message also affected by this problem? @rickyma 
`24/05/26 12:13:01 WARN [netty-rpc-client-57-5] TransportClient: Failed to send request RPC 1472 to /...:49999: org.apache.uniffle.io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 4076863488, max: 4080271360), channel will be closed
`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_HBbB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1596,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_HC81,incubator-uniffle,2132553525,1596,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-27T02:55:02Z,2024-05-27T02:55:02Z,"No, `OutOfDirectMemoryError` should be related to https://github.com/apache/incubator-uniffle/issues/1651.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_HC81/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1598,https://api.github.com/repos/apache/incubator-uniffle/issues/1598,incubator-uniffle,2203851770,1598,[Bug] The used direct memory metric is inaccurate,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-23T12:10:39Z,2024-03-25T11:03:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The current `used_direct_memory_size` metric is inaccurate. To get the right value, we need to combine the off-heap memory usage from both Netty and gRPC's Netty, as they are the primary sources of off-heap memory consumption.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1598/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1600,https://api.github.com/repos/apache/incubator-uniffle/issues/1600,incubator-uniffle,2204261823,1600,[FEATURE] Support for allocating direct memory when reading local files and indexes,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-24T09:25:16Z,2024-03-26T17:53:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

For https://github.com/apache/incubator-uniffle/issues/133.
Currently, we only allocate heap memory when reading local files and indexes.
This can be improved when enabling Netty.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1600/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1602,https://api.github.com/repos/apache/incubator-uniffle/issues/1602,incubator-uniffle,2207177141,1602,[Improvement] Seprate code for the different roles in spark rssShuffleManager,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-03-26T03:40:26Z,2024-03-26T03:40:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

For the current codebase,  the different roles codes are all in the same `RssShuffleManager` , this is hard to read and understand for the new bies.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1602/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1603,https://api.github.com/repos/apache/incubator-uniffle/issues/1603,incubator-uniffle,2207319827,1603,[Improvement] Disable dataPusher initialization for spark driver ,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-03-26T05:51:27Z,2024-03-26T05:51:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

There is no need to initialize `dataPusher`  for spark driver in  `RssShuffleManager`

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1603/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1606,https://api.github.com/repos/apache/incubator-uniffle/issues/1606,incubator-uniffle,2210583118,1606,[Improvement] Add retry mechanism for reading data(memory/local/index) when there is no buffer,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-27T11:42:33Z,2024-04-08T05:54:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

There is no retry mechanism for clients to read data(memory/local/index) when there is no read memory on the server side. 
Currently, retries will be performed on the server side, up to 50 times, with a sleep time of 1s each time. This means that a request may take more than 50s, which significantly affects the server's throughput in handling read requests.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1606/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1606,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54kXez,incubator-uniffle,2022799283,1606,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-27T13:40:13Z,2024-03-27T13:40:13Z,Do we regard this issue as a bug or as a feature?  @jerqi @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54kXez/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1606,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54mo-G,incubator-uniffle,2023395206,1606,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-03-27T17:37:56Z,2024-03-27T17:37:56Z,I think this is an improvement.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM54mo-G/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1607,https://api.github.com/repos/apache/incubator-uniffle/issues/1607,incubator-uniffle,2210599073,1607,[DOCS] Performance Benchmark Report using TPC-DS,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-03-27T11:51:00Z,2024-04-17T06:13:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

_No response_

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1607/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1608,https://api.github.com/repos/apache/incubator-uniffle/issues/1608,incubator-uniffle,2214528191,1608,Support client partition data reassign,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-03-29T03:04:09Z,2024-06-03T09:08:31Z,"# Motivation

After reviewing #1445 again(partition data reassign, which is disabled by default in the master branch), I found some bugs and design problems. I will use this issue to track the further optimizations.

# Subtasks tracking
- [x] #1609 
- [x] #1610 
- [x] #1583 
- [x] #1612 
- [x] #1615
- [ ] #1617
- [x] #1652 
- [x] #1690 
- [x] #1693 

# Design thought

## reassign rpc between with spark driver + executor

This part has been involved in the #1445 design doc, I will not describe more.

## reassign signal propagation
In current codebase, the latest reassign partition-> servers plan won't be propagated into the next start tasks.
To solve this problem, I will make writer always get the latest partition->servers plan. Once the reassign signal happens, 
the cached shuffleHandleInfo will be updated by the reassign rpc returned.

For the next start task(task2) after reassign tasks finished, task2 will get the latest plan according to the replacement + normal servers list. It will avoid writing to the faulty servers again.

## reassign multiple servers for one partition
This topic is scoped in the single replica.

For the different type partition, we will have different strategies for the partition -> multiple servers assign.
For huge partition, I will hope that after recogizing the huge_partition, we will request reassign multiple servers by rpc, and the task will acheive its owned partitioned server by the hash mechanism by its taskAttemptId,
which will make load balance valid.

For normal partition, the multiple servers are only valid on the reassign multiple times due to the expected problems.
For this case, the task will always get the last server to write.

![image](https://github.com/apache/incubator-uniffle/assets/8609142/75800a5a-dc7e-4e70-b665-bd1fa25075dd)


![image](https://github.com/apache/incubator-uniffle/assets/8609142/2178a7af-b46c-45c6-9e38-2d21d1444eae)


","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1608/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1608,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5421Ye,incubator-uniffle,2027640350,1608,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-03-29T19:10:54Z,2024-03-29T19:10:54Z,"> I found some bugs and design problems

What kind of bugs did you find? What will the bug cause? Data loss, or ... ? Can you elaborate more in this issue? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5421Ye/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1608,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM543nb_,incubator-uniffle,2027845375,1608,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-03-30T00:33:51Z,2024-03-30T00:33:51Z,"> > I found some bugs and design problems
> 
> What kind of bugs did you find? What will the bug cause? Data loss, or ... ? Can you elaborate more in this issue?

This is just for the partition data reassignment, which will not effect data correctness and loss.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM543nb_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1613,https://api.github.com/repos/apache/incubator-uniffle/issues/1613,incubator-uniffle,2218655879,1613,[Improvement] Use FileChannel to replace FileOutputStream and DataOutputStream in LocalFileWriter,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-01T16:53:43Z,2024-11-17T09:22:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

FileChannel can provide better performance than traditional IO streams, as it can take advantage of the underlying operating system's native IO capabilities, such as memory-mapped files and direct buffer access.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1613/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1613,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM55Aake,incubator-uniffle,2030151966,1613,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-04-01T16:54:55Z,2024-04-01T16:54:55Z,"If you have any ideas on this, please let me know. Anyone will be welcome to pick this up.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM55Aake/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1613,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-Z098,incubator-uniffle,2120699772,1613,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-20T15:33:39Z,2024-05-20T15:33:39Z,Close this because FileChannel will cause RSS(Resident Set Size) to grow unexpectedly.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-Z098/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1613,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2qFa,incubator-uniffle,2480578906,1613,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-11-16T13:56:40Z,2024-11-16T13:56:40Z,"> Close this because FileChannel will cause RSS(Resident Set Size) to grow unexpectedly.

Hi @rickyma, we just merge the PR to introduce `org.apache.uniffle.storage.handler.impl.LocalFileNioWriter`  last month, so I wonder the context of that issue what you motioned?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2qFa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1613,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T4iWK,incubator-uniffle,2481071498,1613,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-11-17T09:22:46Z,2024-11-17T09:22:46Z,You can have a try with stress tests. I think the Uniffle server process will be killed by the OS oom-killer easily.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T4iWK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1614,https://api.github.com/repos/apache/incubator-uniffle/issues/1614,incubator-uniffle,2219493041,1614,"[Improvement] When committing to a shuffle server, print its IP and port",rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-04-02T03:40:10Z,2024-04-02T03:40:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, we don't know which shuffle server the client is committing to.
```
[03:08:14:067] [Executor task launch worker for task 18899.0 in stage 3.0 (TID 64760)] INFO  org.apache.spark.shuffle.writer.RssShuffleWriter.sendCommit:555 - Wait commit to shuffle server for task[75596] cost 16201 ms
[03:08:19:067] [Executor task launch worker for task 18899.0 in stage 3.0 (TID 64760)] INFO  org.apache.spark.shuffle.writer.RssShuffleWriter.sendCommit:555 - Wait commit to shuffle server for task[75596] cost 21202 ms
[03:08:24:067] [Executor task launch worker for task 18899.0 in stage 3.0 (TID 64760)] INFO  org.apache.spark.shuffle.writer.RssShuffleWriter.sendCommit:555 - Wait commit to shuffle server for task[75596] cost 26202 ms
[03:08:29:067] [Executor task launch worker for task 18899.0 in stage 3.0 (TID 64760)] INFO  org.apache.spark.shuffle.writer.RssShuffleWriter.sendCommit:555 - Wait commit to shuffle server for task[75596] cost 31202 ms
```
We can add the shuffle server's IP and port into the log.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1614/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1618,https://api.github.com/repos/apache/incubator-uniffle/issues/1618,incubator-uniffle,2223065215,1618,[FEATURE] Show Thread Dump in DashBoard,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-03T14:14:48Z,2024-07-22T02:08:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

I think it's a good feature to show a coordinator or a shuffle server's thread dump in the dashboard.
It's like you can see an executor's thread dump in Spark UI.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1618/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1618,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59aeeQ,incubator-uniffle,2104092560,1618,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-10T07:38:11Z,2024-05-10T07:38:11Z,@yl09099 If you have time. PTAL.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59aeeQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1618,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59foA0,incubator-uniffle,2105442356,1618,NA,yl09099,33595968,,,NA,2024-05-11T01:50:20Z,2024-05-11T01:50:20Z,"> @yl09099 If you have time. PTAL.

Do you have a good presentation format? suggest.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59foA0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1618,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59ftxZ,incubator-uniffle,2105465945,1618,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-11T02:39:29Z,2024-05-11T02:39:29Z,"I think we can refer to the `Executors` tab in Spark UI. Something like(https://spark.apache.org/docs/latest/web-ui.html): 
![image](https://github.com/apache/incubator-uniffle/assets/13834479/3d4a28b2-2160-4c20-990b-63000be6e1da)
![image](https://github.com/apache/incubator-uniffle/assets/13834479/ff32d785-477a-49bf-9efd-9950090a9589)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59ftxZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1619,https://api.github.com/repos/apache/incubator-uniffle/issues/1619,incubator-uniffle,2223113364,1619,[FEATURE] Set up multiple Netty servers to handle different requests separately,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-03T14:34:09Z,2024-05-09T13:46:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, multiple different requests share the `rss.server.netty.accept.thread` and `rss.server.netty.worker.thread` configurations, which are coupled together. This means we cannot independently control the number of Netty threads for each request.
I think we need to decouple it. There exists a situation where certain requests may occupy the Netty connection for a long time, causing other requests to be unable to respond.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1619/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1619,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VJT9,incubator-uniffle,2102695165,1619,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-09T13:46:02Z,2024-05-09T13:46:02Z,"Actually, whether it's reading or writing, they are both performance loads, and I don't see the necessity to distinguish and handle them separately for now. Let's close this requirement.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VJT9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1620,https://api.github.com/repos/apache/incubator-uniffle/issues/1620,incubator-uniffle,2223137851,1620,"[Bug] Under high pressure situations, reading data may encounter the issue of ""Blocks read inconsistent""",rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-04-03T14:45:18Z,2024-04-09T03:51:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```
[19:30:48:677] [Executor task launch worker for task 15111.2 in stage 4.0 (TID 83474)] ERROR org.apache.spark.executor.Executor.logError:98 - Exception in task 15111.2 in stage 4.0 (TID 83474)
org.apache.uniffle.common.exception.RssException: Blocks read inconsistent: expected 23357 blocks, actual 19597 blocks
	at org.apache.uniffle.common.util.RssUtils.checkProcessedBlockIds(RssUtils.java:382) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.checkProcessedBlockIds(ShuffleReadClientImpl.java:321) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:131) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:317) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460) ~[scala-library-2.12.15.jar:?]
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage4.hashAgg_doAggregateWithoutKey_0$(Unknown Source) ~[?:?]
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage4.processNext(Unknown Source) ~[?:?]
	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43) ~[spark-sql_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:760) ~[spark-sql_2.12-3.3.1.jar:3.3.1]
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460) ~[scala-library-2.12.15.jar:?]
	at org.apache.spark.shuffle.writer.RssShuffleWriter.writeImpl(RssShuffleWriter.java:266) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:247) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.scheduler.Task.run(Task.scala:136) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1556) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_392]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_392]
	at java.lang.Thread.run(Thread.java:750) ~[?:1.8.0_392]
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1620/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1620,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM551n06,incubator-uniffle,2044099898,1620,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-04-09T03:48:30Z,2024-04-09T03:48:30Z,"The root cause of this issue is https://github.com/apache/incubator-uniffle/issues/1626, which will be fixed by https://github.com/apache/incubator-uniffle/pull/1627.

And I think maybe we can improve this: when there are flush events being dropped(We need to distinguish a scenario: if it's a speculative write task, we allow them to be dropped), we can fast fail when reading data, instead of lagging until throwing ""Blocks read inconsistent"" exceptions.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM551n06/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1621,https://api.github.com/repos/apache/incubator-uniffle/issues/1621,incubator-uniffle,2224810716,1621,[Umbrella] Refactor BlockId semantics,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,OPEN,2024-04-04T08:19:49Z,2024-05-28T10:04:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)

### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.

### Describe the proposal

The block id encodes the task attempt id, the partition id, and the sequence number of a shuffle block. Block data are stored along with this block id, while some of these information are explicitly stored as well (task attempt id). For reading, interfaces use block id, partition id encoded in block id, and explicit task attempt ids to identify relevant blocks. Reading blocks explicitly by their block ids implicitly reads particular partition id, task attempt id and sequence number tuples.

Further, the block id is 63 bits long, while task attempt id and partition id are 31 bits long. This poses a conflict as bits have to be balanced between task attempt ids, partition ids and sequence number. There are potential situations where one of these bits are insufficient, which kills an application using the shuffle service.

The block id should be refactored to simplify interfaces, to make reading blocks explicit, and to avoid potential situations where bits are insufficient.

The block id is effectively a triple of (task attempt id, partition id, sequence number), truncated and encoded in a `long`.

Given each block id is stored together with its task attempt id, we can make block id a triple of (task index, partition id, sequence number). Blocks a read giving the set of task attempt ids that wrote the desired map index, we can reduce the bit foot print of the block id.

The structure of the block id should then be made explicit:

    BlockId(int mapIndex, int partitionId, int sequenceNo)

The block id is often used in large sets, e.g.

- the set of all block ids written by a task attempt (register shuffle result)
- the set of all block ids that constitute a partition (reading blocks)

A task attempt can register blocks using a `Map<Integer, Integer>`, which maps a partition id to the number of blocks (#1399). This should also reduce the memory footprint storing registered block ids on the shuffle server (or the Spark driver #1538).

Reading blocks should be as easy as reading blocks written by a set of task attempt ids that produced block ids that match `Map<Integer, Map<Integer, Integer>`, which maps a partition id to the task index and their number of blocks. Given map index and partition index are ranges, we can store these information efficiently as arrays `blockNums[partitionRangeIndex][mapRangeIndex]`.

While reading those blocks, the reader has to maintain a set of block sequence numbers from `0` to `blockNum - 1` (#1399) for each partition id and task index to identify duplicates. This can be done via `Map<Integer, Roaring64NavigableMap>`, where the `Roaring64NavigableMap` stores read (map index, sequence number) tuples.

The `BufferSegment` stores the block id (`long`) and already the task attempt id (`long`). Reworking the block id will increases the size of `BufferSegment` only by one 32 bits (block id long turns into three ints).

Primary objective:
- Any possible task attempt id, partition id and sequence number is supported.

Benefits:
- the block id field information are not truncated any more
- concept of block id layout and its configuration can be removed
- block id field information are accessible server and client side
  - id helper providing access to the partition id can be removed
- storing shuffle result registration server side does not require a number of bitmaps argument
- reduce redundancies in `BufferSegment`

### Task list

- [ ] Register shuffle result using `Map<partitionId, blockNums>`
- [ ] Replace `taskAttemptId` with `mapIndex` in block id
- [ ] Hide set-of-block-ids implementation behind interface
- [ ] Use `BlockId` instead of `long` everywhere
- [ ] Turn `BlockId(long blockId)` into `BlockId(int mapIndex, int partitionId, int sequenceNo)`

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1621/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1621,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-osKv,incubator-uniffle,2124595887,1621,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-05-22T11:47:12Z,2024-05-22T11:47:12Z,One concern is that it may occupy too much memory if we use Map to store blockIds instead of bitmap.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-osKv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1621,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_PvCG,incubator-uniffle,2134831238,1621,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-05-28T10:04:39Z,2024-05-28T10:04:39Z,"The shuffle servers do not need to store all individual shuffle result block ids, but only the number of blocks per partition and map id. An array of integers would be more compact than a Map. A shuffle from 1000 to 1000 partitions would occupy less than 4 MB memory.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_PvCG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1622,https://api.github.com/repos/apache/incubator-uniffle/issues/1622,incubator-uniffle,2226038782,1622,[Improvement] Remove useless ID column in Dashboard,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-04-04T16:45:03Z,2024-06-19T09:01:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Refer to:
https://github.com/apache/incubator-uniffle/issues/1401#issuecomment-1892541781
https://github.com/apache/incubator-uniffle/issues/1401#issuecomment-1893139225

I think we can remove the useless `ID` column.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1622/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1623,https://api.github.com/repos/apache/incubator-uniffle/issues/1623,incubator-uniffle,2226043169,1623,[FEATURE] Show logs in Dashboard,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-04-04T16:47:45Z,2024-04-05T04:17:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature
We should show logs for coordinators and shuffle Servers in dashboard.
If the dashboard can display logs, it will benefit a lot for dev and ops.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1623/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1624,https://api.github.com/repos/apache/incubator-uniffle/issues/1624,incubator-uniffle,2226967154,1624,[FEATURE] Show IO/CPU/Disk usage in Dashboard,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-04-05T04:09:09Z,2024-04-05T04:09:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We should show IO/CPU/Disk usage for coordinators and shuffle servers in dashboard.
Perhaps we can display the usage of IO, CPU, and Disk in sorted order. This way, we can readily identify which shuffle server has reached its IO/CPU bottleneck, which shuffle server's local disk is nearly full, and so on, allowing us to make a series of optimizations accordingly.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1624/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1626,https://api.github.com/repos/apache/incubator-uniffle/issues/1626,incubator-uniffle,2230634824,1626,[Bug] The StorageManager cache might not function effectively under heavy IO pressure,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-08T08:54:07Z,2024-04-10T06:15:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I think the following code snipet in `HybridStorageManager` could be refactored after https://github.com/apache/incubator-uniffle/pull/383:
```
public boolean write(Storage storage, ShuffleWriteHandler handler, ShuffleDataFlushEvent event) {
  StorageManager underStorageManager = eventOfUnderStorageManagers.getIfPresent(event);
  if (underStorageManager == null) {
    return false;
  }
  return underStorageManager.write(storage, handler, event);
}
```
When we cannot obtain the cached storageManager from `eventOfUnderStorageManagers`, we should try other methods to acquire the storageManager and refresh the cache, instead of directly returning `false`. 

Currently, the actual write logic is not truly executed.
There may be a scenario where retry failures occur rapidly, and such retries are meaningless:
<img width=""1720"" alt=""35879725f6a9ba276ca6a37c5249f29"" src=""https://github.com/apache/incubator-uniffle/assets/13834479/94b7034a-5ebe-422a-a56a-07b5676cda88"">


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1626/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,incubator-uniffle,2231195141,1628,[Bug] Occasionally encountering IllegalReferenceCountException when releasing ShuffleIndexResult,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-08T13:13:52Z,2024-10-18T03:23:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

https://github.com/apache/incubator-uniffle/actions/runs/9282054580/job/25539265104?pr=1752

org.apache.uniffle.test.RepartitionWithHadoopHybridStorageRssTest

Error stacktrace:
```
Caused by: org.apache.uniffle.common.exception.RssFetchFailedException: Failed to read shuffle data from HOT handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:124)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:305)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:213)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:307)
	at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
	at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
	at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:136)
	at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:329)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)
	at org.apache.spark.scheduler.Task.run(Task.scala:136)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1504)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
Caused by: io.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1
	at io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:83)
	at io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:148)
	at io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:101)
	at org.apache.uniffle.common.netty.buffer.NettyManagedBuffer.release(NettyManagedBuffer.java:59)
	at org.apache.uniffle.common.ShuffleIndexResult.release(ShuffleIndexResult.java:75)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:82)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113)
	... 21 more
```

Reason: Unknown
Priority: Minor

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1628/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6A9Peo,incubator-uniffle,2163537832,1628,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-12T17:13:05Z,2024-06-12T17:13:05Z,"@EnricoMi Could you help to find out the reason here? I still have no clue.

I've encountered this issue again this time: https://github.com/apache/incubator-uniffle/actions/runs/9486586733/job/26141279578?pr=1780","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6A9Peo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGWlI,incubator-uniffle,2182703432,1628,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-06-21T12:56:20Z,2024-06-21T12:56:20Z,Maybe duplicate of #1818,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGWlI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGaPc,incubator-uniffle,2182718428,1628,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-21T13:05:20Z,2024-06-21T13:05:20Z,I think they are different. This is caused by calling `ShuffleIndexResult.release`. https://github.com/apache/incubator-uniffle/issues/1818 is caused by calling `ShuffleDataResult.release`.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGaPc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGaSD,incubator-uniffle,2182718595,1628,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-06-21T13:05:26Z,2024-06-21T13:05:26Z,"> Maybe duplicate of #1818

Sorry, it looks like the error stack is different","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGaSD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGdCS,incubator-uniffle,2182729874,1628,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-21T13:12:29Z,2024-06-21T13:12:29Z,Could you help to look at this issue too?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGdCS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHFJb,incubator-uniffle,2182894171,1628,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-06-21T14:45:33Z,2024-06-21T14:45:33Z,"> Could you help to look at this issue too?

Sure, I will try to fix it later.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHFJb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHHEj,incubator-uniffle,2182902051,1628,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-06-21T14:49:55Z,2024-06-21T14:49:55Z,`ShuffleIndexResult` and `ShuffleDataResult` seem to be no longer used after release. Shall we set their internal buffer to null after release?  cc @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHHEj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHXwK,incubator-uniffle,2182970378,1628,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-21T15:28:40Z,2024-06-21T15:28:40Z,"I think it is feasible, you can do it. Although setting the internal buffer to null might have a positive impact on GC, this impact is usually minimal.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CHXwK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CnNfU,incubator-uniffle,2191316948,1628,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-06-26T10:09:20Z,2024-06-26T10:09:20Z,"https://github.com/wForget/incubator-uniffle/blob/0c80d4d62315aeb5366f9d2154f861fd59a769aa/common/src/main/java/org/apache/uniffle/common/netty/buffer/NettyManagedBuffer.java#L62-L70

After adding the following log in NettyManagedBuffer, I got some related logs from https://github.com/wForget/incubator-uniffle/actions/runs/9676598458 and did not find any repeated calls.

```
[2024-06-26 09:03:18.227] [Executor task launch worker for task 1.0 in stage 2.0 (TID 10)] [WARN] NettyManagedBuffer.release - Check NettyManagedBuffer release
[2024-06-26 09:03:18.227] [Executor task launch worker for task 1.0 in stage 2.0 (TID 10)] [WARN] NettyManagedBuffer.release - Executor task launch worker for task 1.0 in stage 2.0 (TID 10)
[2024-06-26 09:03:18.227] [Executor task launch worker for task 1.0 in stage 2.0 (TID 10)] [WARN] NettyManagedBuffer.release - org.apache.uniffle.common.netty.buffer.NettyManagedBuffer@1d924010
[2024-06-26 09:03:18.227] [Executor task launch worker for task 1.0 in stage 2.0 (TID 10)] [WARN] NettyManagedBuffer.release - PooledUnsafeDirectByteBuf(freed)
[2024-06-26 09:03:18.227] [Executor task launch worker for task 1.0 in stage 2.0 (TID 10)] [WARN] NettyManagedBuffer.release - size: 70
[2024-06-26 09:03:18.227] [Executor task launch worker for task 1.0 in stage 2.0 (TID 10)] [WARN] NettyManagedBuffer.release - Check NettyManagedBuffer release stack tree
java.lang.Throwable
	at org.apache.uniffle.common.netty.buffer.NettyManagedBuffer.release(NettyManagedBuffer.java:68)
	at org.apache.uniffle.common.ShuffleIndexResult.release(ShuffleIndexResult.java:76)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:82)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:308)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:216)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:315)
	at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
	at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
	at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:182)
	at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
	at org.apache.spark.scheduler.Task.run(Task.scala:131)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:506)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1462)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:509)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
[2024-06-26 09:03:18.228] [Executor task launch worker for task 1.0 in stage 2.0 (TID 10)] [ERROR] Executor.logError - Exception in task 1.0 in stage 2.0 (TID 10)
org.apache.uniffle.common.exception.RssFetchFailedException: Failed to read shuffle data from HOT handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:124)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:308)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:216)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:315)
	at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
	at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
	at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:182)
	at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
	at org.apache.spark.scheduler.Task.run(Task.scala:131)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:506)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1462)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:509)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
Caused by: io.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1
	at io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:83)
	at io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:148)
	at io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:101)
	at org.apache.uniffle.common.netty.buffer.NettyManagedBuffer.release(NettyManagedBuffer.java:69)
	at org.apache.uniffle.common.ShuffleIndexResult.release(ShuffleIndexResult.java:76)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:82)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113)
	... 25 more
```

`PooledUnsafeDirectByteBuf` is marked as `freed`, but size is not `0`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CnNfU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Ct0FM,incubator-uniffle,2193047884,1628,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-27T02:48:19Z,2024-06-27T02:48:19Z,Could you add some logs in `HadoopShuffleReadHandler.readShuffleIndex` to get more infomation why it returned a freed `ByteBuf` whose size is not `0`? Or maybe this time it's not in `HadoopShuffleReadHandler` but some elsewhere?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Ct0FM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DGY8f,incubator-uniffle,2199490335,1628,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-07-01T07:59:18Z,2024-07-01T07:59:18Z,"> Could you add some logs in `HadoopShuffleReadHandler.readShuffleIndex` to get more infomation why it returned a freed `ByteBuf` whose size is not `0`? Or maybe this time it's not in `HadoopShuffleReadHandler` but some elsewhere?

The `PooledUnsafeDirectByteBuf` object does not seem to be generated by `HadoopShuffleReadHandler.readShuffleIndex`, it should be generated by netty framework.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DGY8f/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DG1Ei,incubator-uniffle,2199605538,1628,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-01T08:57:44Z,2024-07-01T08:57:44Z,"If you are sure that it is `PooledUnsafeDirectByteBuf`, then it must come from `LocalFileClientReadHandler.readShuffleIndex`. 

Because we use `PooledByteBufAllocator` to receive responses like `GetLocalShuffleIndexResponse` from Uniffle server.

Could you please add some logs in `TransportFrameDecoder`, `Message` and `GetLocalShuffleIndexRequest.decode` to help dig into this issue?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DG1Ei/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DO3Cw,incubator-uniffle,2201710768,1628,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-07-02T02:36:21Z,2024-07-02T02:36:21Z,"I seem to have found two threads that repeatedly release it:

```
[2024-07-01 22:12:37.173] [netty-rpc-client-24-1] [WARN] PooledUnsafeDirectByteBuf.release - Check PooledUnsafeDirectByteBuf release empty
[2024-07-01 22:12:37.173] [netty-rpc-client-24-1] [WARN] PooledUnsafeDirectByteBuf.release - netty-rpc-client-24-1
[2024-07-01 22:12:37.173] [netty-rpc-client-24-1] [WARN] PooledUnsafeDirectByteBuf.release - PooledUnsafeDirectByteBuf(ridx: 0, widx: 1063, cap: 1063)
[2024-07-01 22:12:37.173] [netty-rpc-client-24-1] [WARN] PooledUnsafeDirectByteBuf.release - io.netty.buffer.PooledUnsafeDirectByteBuf@6d1c06f3
[2024-07-01 22:12:37.173] [netty-rpc-client-24-1] [WARN] PooledUnsafeDirectByteBuf.release - size: 1063
[2024-07-01 22:12:37.174] [netty-rpc-client-24-1] [WARN] PooledUnsafeDirectByteBuf.release - refCnt: 1
[2024-07-01 22:12:37.174] [netty-rpc-client-24-1] [WARN] PooledUnsafeDirectByteBuf.release - Check PooledUnsafeDirectByteBuf release stack tree
java.lang.Throwable
	at io.netty.buffer.PooledUnsafeDirectByteBuf.release(PooledUnsafeDirectByteBuf.java:308)
	at io.netty.channel.ChannelOutboundBuffer.remove(ChannelOutboundBuffer.java:296)
	at io.netty.channel.ChannelOutboundBuffer.removeBytes(ChannelOutboundBuffer.java:383)
	at io.netty.channel.socket.nio.NioSocketChannel.doWrite(NioSocketChannel.java:421)
	at io.netty.channel.AbstractChannel$AbstractUnsafe.flush0(AbstractChannel.java:931)
	at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.flush0(AbstractNioChannel.java:359)
	at io.netty.channel.AbstractChannel$AbstractUnsafe.flush(AbstractChannel.java:895)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.flush(DefaultChannelPipeline.java:1372)
	at io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:935)
	at io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:921)
	at io.netty.channel.AbstractChannelHandlerContext.flush(AbstractChannelHandlerContext.java:907)
	at io.netty.channel.ChannelDuplexHandler.flush(ChannelDuplexHandler.java:127)
	at io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:937)
	at io.netty.channel.AbstractChannelHandlerContext.invokeWriteAndFlush(AbstractChannelHandlerContext.java:957)
	at io.netty.channel.AbstractChannelHandlerContext$WriteTask.run(AbstractChannelHandlerContext.java:1263)
	at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)
	at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)
	at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:566)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)


[2024-07-01 22:12:36.273] [Executor task launch worker for task 0.0 in stage 5.0 (TID 14)] [WARN] PooledUnsafeDirectByteBuf.release - Check PooledUnsafeDirectByteBuf release empty
[2024-07-01 22:12:36.273] [Executor task launch worker for task 0.0 in stage 5.0 (TID 14)] [WARN] PooledUnsafeDirectByteBuf.release - Executor task launch worker for task 0.0 in stage 5.0 (TID 14)
[2024-07-01 22:12:36.273] [Executor task launch worker for task 0.0 in stage 5.0 (TID 14)] [WARN] PooledUnsafeDirectByteBuf.release - PooledUnsafeDirectByteBuf(ridx: 0, widx: 70, cap: 70)
[2024-07-01 22:12:36.273] [Executor task launch worker for task 0.0 in stage 5.0 (TID 14)] [WARN] PooledUnsafeDirectByteBuf.release - io.netty.buffer.PooledUnsafeDirectByteBuf@6d1c06f3
[2024-07-01 22:12:36.273] [Executor task launch worker for task 0.0 in stage 5.0 (TID 14)] [WARN] PooledUnsafeDirectByteBuf.release - size: 70
[2024-07-01 22:12:36.273] [Executor task launch worker for task 0.0 in stage 5.0 (TID 14)] [WARN] PooledUnsafeDirectByteBuf.release - refCnt: 1
[2024-07-01 22:12:36.273] [Executor task launch worker for task 0.0 in stage 5.0 (TID 14)] [WARN] PooledUnsafeDirectByteBuf.release - Check PooledUnsafeDirectByteBuf release stack tree
java.lang.Throwable
	at io.netty.buffer.PooledUnsafeDirectByteBuf.release(PooledUnsafeDirectByteBuf.java:308)
	at org.apache.uniffle.common.netty.buffer.NettyManagedBuffer.release(NettyManagedBuffer.java:88)
	at org.apache.uniffle.common.ShuffleIndexResult.release(ShuffleIndexResult.java:76)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:87)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:308)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:216)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:315)
	at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
	at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
	at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:182)
	at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
[2024-07-01 22:12:37.178] [Executor task launch worker for task 0.0 in stage 5.0 (TID 14)] [ERROR] Executor.logError - Exception in task 0.0 in stage 5.0 (TID 14)
org.apache.uniffle.common.exception.RssFetchFailedException: Failed to read shuffle data from HOT handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:124)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:308)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:216)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:315)
	at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
	at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
	at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:182)
	at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:104)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:54)
	at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
	at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: io.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1
	at io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:83)
	at io.netty.util.internal.ReferenceCountUpdater.retryRelease0(ReferenceCountUpdater.java:173)
	at io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:147)
	at io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:101)
	at io.netty.buffer.PooledUnsafeDirectByteBuf.release(PooledUnsafeDirectByteBuf.java:316)
	at org.apache.uniffle.common.netty.buffer.NettyManagedBuffer.release(NettyManagedBuffer.java:88)
	at org.apache.uniffle.common.ShuffleIndexResult.release(ShuffleIndexResult.java:76)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:87)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113)
	... 24 more
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DO3Cw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DRH0e,incubator-uniffle,2202303774,1628,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-02T08:26:36Z,2024-07-02T08:26:36Z,"I didn't see the connection between these two release stacktrace logs, as they seem to be unrelated. The first stack contains `ChannelOutboundBuffer`, so it looks more like it happened during `ChannelOutbound` rather than `ChannelInbound`. The `TransportFrameDecoder`, on the other hand, occurs during `ChannelInbound`. So, it seems like the first release doesn't have much to do with `TransportFrameDecoder`?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DRH0e/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Devvf,incubator-uniffle,2205875167,1628,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-07-03T11:39:27Z,2024-07-03T11:39:27Z,"> io.netty.buffer.PooledUnsafeDirectByteBuf@6d1c06f3

They seem to be the same object. `PooledUnsafeDirectByteBuf` seems to be reusable before release.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Devvf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1628,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6HmCW6,incubator-uniffle,2274895290,1628,NA,xianjingfeng,11752250,,,NA,2024-08-08T03:46:09Z,2024-08-08T03:46:09Z,"Could we temporarily handle it in the following way?

```java
public static void releaseByteBuffer(ByteBuffer byteBuffer) {
    if (byteBuffer == null || !byteBuffer.isDirect()) {
      return;
    }
    try {
      PlatformDependent.freeDirectBuffer(byteBuffer);
    } catch (Throwable t) {
      LOGGER.warn(""Failed to release direct buffer:"" + t.getMessage());
    }
  }
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6HmCW6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1629,https://api.github.com/repos/apache/incubator-uniffle/issues/1629,incubator-uniffle,2232756000,1629,[Bug] [Operator] ShuffleSever cannot be deleted even though there are no more application.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-04-09T07:07:06Z,2024-04-16T12:30:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Even though there are no more application, the pod of shuffle server cant not be deleted, will throw `there are some apps still running in shuffle server`.
The log of webhook show: `get last app number of (xx.xx.xx.xx) failed: json: cannot unmarshal string into Go struct field MetricItem.metrics.value of type float32`
The problem is that since #1286 , add Summary metrics, may return ""NaN"", is not string but not number.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1629/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1629,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM553iXW,incubator-uniffle,2044601814,1629,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-04-09T09:50:16Z,2024-04-09T09:50:16Z,"To digress a bit, are you running the operator based on the latest version of the code? Have you encountered any other issues during the process? Is Uniffle currently stable on k8s? Because we are going to deploy on K8S too.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM553iXW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1629,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM553wK_,incubator-uniffle,2044658367,1629,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-04-09T10:22:40Z,2024-04-09T10:22:40Z,"> To digress a bit, are you running the operator based on the latest version of the code? Have you encountered any other issues during the process? Is Uniffle currently stable on k8s? Because we are going to deploy on K8S too.

Yes, now I develop on master, almost the latest version. 
I think the k8s just start shuffle server, there was no problem deploying on the k8s, the stability problem mainly comes from the shuffle server

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM553wK_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1629,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM555okt,incubator-uniffle,2045151533,1629,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-04-09T13:12:43Z,2024-04-09T13:12:43Z,"> > To digress a bit, are you running the operator based on the latest version of the code? Have you encountered any other issues during the process? Is Uniffle currently stable on k8s? Because we are going to deploy on K8S too.
> 
> Yes, now I develop on master, almost the latest version. I think the k8s just start shuffle server, there was no problem deploying on the k8s, the stability problem mainly comes from the shuffle server

Sounds good. We will use it soon, maybe in this month.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM555okt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1629,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM55-JL6,incubator-uniffle,2046333690,1629,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-04-10T02:11:37Z,2024-04-10T02:11:37Z,"> > > To digress a bit, are you running the operator based on the latest version of the code? Have you encountered any other issues during the process? Is Uniffle currently stable on k8s? Because we are going to deploy on K8S too.
> > 
> > 
> > Yes, now I develop on master, almost the latest version. I think the k8s just start shuffle server, there was no problem deploying on the k8s, the stability problem mainly comes from the shuffle server
> 
> Sounds good. We will use it soon, maybe in this month.

The author of the operator is wangao of Tencent. You can communicate with him.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM55-JL6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1631,https://api.github.com/repos/apache/incubator-uniffle/issues/1631,incubator-uniffle,2233093408,1631,[Bug] ShuffleTaskInfo may leak when app is removed.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-04-09T10:11:45Z,2024-04-10T03:14:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In our cluster, delete pod is denied by web hook, even though all application is deleted for long time.
When I curl http://host:ip/metrics/server, I found app_num_with_node is 1. 
The problem is some application is leaked. I see many duplicated logs `[INFO] ShuffleTaskManager.checkResourceStatus - Detect expired appId[appattempt_xxx_xx_xx] according to rss.server.app.expired.withoutHeartbeat`.
When I jstack the server many times, clearResourceThread will be stuck forever, here is the call stack.
```
""clearResourceThread"" #40 daemon prio=5 os_prio=0 cpu=3767.63ms elapsed=5393.50s tid=0x00007f24fe92e800 nid=0x8f waiting on condition  [0x00007f24f7b33000]
   java.lang.Thread.State: WAITING (parking)
	at jdk.internal.misc.Unsafe.park(java.base@11.0.22/Native Method)
	- parking to wait for  <0x00007f28d5e29f20> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)
	at java.util.concurrent.locks.LockSupport.park(java.base@11.0.22/LockSupport.java:194)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(java.base@11.0.22/AbstractQueuedSynchronizer.java:885)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(java.base@11.0.22/AbstractQueuedSynchronizer.java:917)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(java.base@11.0.22/AbstractQueuedSynchronizer.java:1240)
	at java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(java.base@11.0.22/ReentrantReadWriteLock.java:959)
	at org.apache.uniffle.server.ShuffleTaskManager.removeResources(ShuffleTaskManager.java:756)
	at org.apache.uniffle.server.ShuffleTaskManager.lambda$new$0(ShuffleTaskManager.java:183)
	at org.apache.uniffle.server.ShuffleTaskManager$$Lambda$216/0x00007f24f824cc40.run(Unknown Source)
	at java.lang.Thread.run(java.base@11.0.22/Thread.java:829)
```

Apparently there's a lock that's not being released. Looking at the code, it's easy to see that the read lock in the flushBuffer is not released correctly.  The log ` ShuffleBufferManager.flushBuffer - Shuffle[3066071] for app[appattempt_xxx] has already been removed, no need to flush the buffer` proved it.


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1631/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1631,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM553vRz,incubator-uniffle,2044654707,1631,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-04-09T10:20:14Z,2024-04-09T10:20:14Z,"I think the following code snipet should be put inside the try-block:
```
if (!bufferPool.getOrDefault(appId, new HashMap<>()).containsKey(shuffleId)) {
  LOG.info(
      ""Shuffle[{}] for app[{}] has already been removed, no need to flush the buffer"",
      shuffleId,
      appId);
  return;
}
```
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM553vRz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1633,https://api.github.com/repos/apache/incubator-uniffle/issues/1633,incubator-uniffle,2234701682,1633,[FEATURE] Determine whether data can be written and read based on the actual disk IO situation,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-10T03:48:50Z,2024-05-09T13:38:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Determine whether data can be written and read based on the actual disk IO situation, rather than based on `usedMemory` and `readDataMemory`.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1633/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1633,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VGLz,incubator-uniffle,2102682355,1633,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-09T13:38:41Z,2024-05-09T13:38:41Z,"The IO is constantly changing, so there is no need to address this requirement for now.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VGLz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1634,https://api.github.com/repos/apache/incubator-uniffle/issues/1634,incubator-uniffle,2234982906,1634,[Bug] app localdisk folder remains when app is expired,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-04-10T07:55:13Z,2024-04-13T12:31:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I found some shuffle-servers basic dir has lots of app folders remains wich has been expired.

After digging this case, I think this is caused by the children shuffleIds unregistering. Please see here: https://github.com/apache/incubator-uniffle/blob/a7a0b4ce41a213f8f3e05a1e1198c41857706229/server/src/main/java/org/apache/uniffle/server/ShuffleTaskManager.java#L778-#L781 .

Once one app's all shuffleIds has been unregistered by the `ShufflePurgeEvent`, the above code will be invalid, because `shuffleToCachedBlockIds` will be empty and them won't trigger the removeResource by app level. So the app folder still remains after expire.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1634/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1639,https://api.github.com/repos/apache/incubator-uniffle/issues/1639,incubator-uniffle,2235741393,1639,[Improvement] Use thread pool to control the concurrency of data reading threads when enabling Netty,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-10T14:28:06Z,2024-05-09T13:45:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

As described in https://github.com/apache/incubator-uniffle/issues/1596#issuecomment-2012168823, I find out https://github.com/apache/incubator-uniffle/pull/1605 is not enough. 

For example, because Netty processing is asynchronous, even if we only configure the number of Netty workers to be 200, the number of threads running concurrently to read local files may far exceed 200. This is because when the Netty worker thread finishes calling `writeAndFlush`, it immediately goes to receive and process the next client request, without waiting for the data to be sent completely. The process of sending data is asynchronous.

So we should limit the concurrency when reading local files.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1639/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1639,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VG5f,incubator-uniffle,2102685279,1639,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-09T13:40:22Z,2024-05-09T13:40:22Z,It for now can be controlled by the thread number of Worker `EventLoopGroup`. Closed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59VG5f/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1642,https://api.github.com/repos/apache/incubator-uniffle/issues/1642,incubator-uniffle,2237684787,1642,[Improvement] Optimize CompositeByteBuf initialization for better performance when getting memory data,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-11T13:05:42Z,2024-04-11T15:08:49Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Optimize the initialization of `CompositeByteBuf` by creating an accurately sized `CompositeByteBuf` to improve performance and reduce memory allocation and resizing overhead.

I think the following code could be optimized:
```
public synchronized ShuffleDataResult getShuffleData(
      long lastBlockId, int readBufferSize, Roaring64NavigableMap expectedTaskIds) {
  try {
    List<BufferSegment> bufferSegments = Lists.newArrayList();
    List<ShufflePartitionedBlock> readBlocks = Lists.newArrayList();
    updateBufferSegmentsAndResultBlocks(
        lastBlockId, readBufferSize, bufferSegments, readBlocks, expectedTaskIds);
    if (!bufferSegments.isEmpty()) {
      CompositeByteBuf byteBuf =
          new CompositeByteBuf(
              NettyUtils.getNettyBufferAllocator(),
              true,
              Constants.COMPOSITE_BYTE_BUF_MAX_COMPONENTS);
      // copy result data
      updateShuffleData(readBlocks, byteBuf);
      return new ShuffleDataResult(byteBuf, bufferSegments);
    }
  } catch (Exception e) {
    LOG.error(""Exception happened when getShuffleData in buffer"", e);
  }
  return new ShuffleDataResult();
}
```

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1642/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1642,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM56L0uM,incubator-uniffle,2049919884,1642,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-04-11T15:08:48Z,2024-04-11T15:08:48Z,My mistake. It cannot be optimized this way.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM56L0uM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1644,https://api.github.com/repos/apache/incubator-uniffle/issues/1644,incubator-uniffle,2242586508,1644,[FEATURE] Add rpc queued time and rpc process time.,zhengchenyu,10381583,zhengchenyu,,OPEN,2024-04-15T02:48:24Z,2024-07-04T02:16:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

When I perform a stress test on the cluster, tasks occasionally encounter errors like this:

```
Caused by: io.grpc.StatusRuntimeException: DEADLINE_EXCEEDED: ClientCall was cancelled at or after deadline. [closed=[CANCELLED], committed=[remote_addr=xxx/xxx:xxx]]
	at io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCalls.java:268)
	at io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:249)
```

> We can increase `rss.rpc.executor.size` to reduce the probability of problems.

In this time, I will see metrics `grpc_server_executor_blocking_queue_size` like this:
<img width=""1018"" alt=""截屏2024-04-15 上午10 40 12"" src=""https://github.com/apache/incubator-uniffle/assets/10381583/8b0d3aeb-e3b1-4dea-b351-863d2ef8d1a5"">

This may mean that rpc requests are not processed in a timely manner. But there are no indicators that directly prove this. So we should add rpc queued time and rpc process time.


 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1644/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1644,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM56dpJM,incubator-uniffle,2054591052,1644,NA,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,NA,2024-04-15T03:02:04Z,2024-04-15T03:02:04Z,Please assign this issue to me.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM56dpJM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1644,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DT0VI,incubator-uniffle,2203010376,1644,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-07-02T12:15:01Z,2024-07-02T12:15:01Z,This looks interesting.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DT0VI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1644,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DUDYX,incubator-uniffle,2203072023,1644,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-02T12:46:45Z,2024-07-02T12:46:45Z,@maobaolong You can go ahead if you want. I think @qijiale76 might not have time on this. We now mostly use Netty for sending/getting shuffle data. We only use gRPC to send other requests rather than shuffle data. So we may want to add metrics both for Netty and gRPC.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DUDYX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1644,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DbHRo,incubator-uniffle,2204922984,1644,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-07-03T02:24:25Z,2024-07-03T02:24:25Z,@rickyma Great! It's important to know the pressure of coordinator and shuffle server.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DbHRo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1644,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DmYbi,incubator-uniffle,2207876834,1644,NA,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,NA,2024-07-04T02:16:20Z,2024-07-04T02:16:20Z,@maobaolong Feel free to continue working on this issue if you are intrested and have time.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DmYbi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1645,https://api.github.com/repos/apache/incubator-uniffle/issues/1645,incubator-uniffle,2242612872,1645,[FEATURE] Add gauge metrics for reading data,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-15T03:17:35Z,2024-04-16T09:48:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, we only have the counter metrics, but not the gauge metrics, which we often care more about. I think we need to know the maximum number of threads reading data at a particular moment, as well as the cumulative size of the data being read at that moment. So we should introduce gauge metrics for reading data.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1645/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1651,https://api.github.com/repos/apache/incubator-uniffle/issues/1651,incubator-uniffle,2245612198,1651,[Improvement] Set Netty as the default server type,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-04-16T09:46:24Z,2024-07-17T07:53:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

After https://github.com/apache/incubator-uniffle/pull/1650, we can know that gRPC mode will not perform very well under high pressure. I think it's time for us to set the default server type to Netty, based on the following reasons.

## Netty mode brings about a 20% performance improvement compared to gRPC mode
Refer to https://github.com/apache/incubator-uniffle/blob/master/docs/benchmark_netty_case_report.md.

## gRPC mode will cause higher CPU load
We can see that gRPC mode will cause the machine's load to be much higher than Netty mode:
<img width=""750"" alt=""企业微信截图_17132589265203"" src=""https://github.com/apache/incubator-uniffle/assets/13834479/9402e63d-3d3e-4d9a-800d-12d61c2ef93d"">

## gRPC mode will cause memory usage to double
We will find that in gRPC mode, both off-heap and on-heap memory may be heavily occupied. In extreme cases, this may cause memory usage to double:
![image](https://github.com/apache/incubator-uniffle/assets/13834479/699e8bd7-9955-4f76-b6b8-b87dd9daa843)

This is because gRPC enables off-heap memory by default, and this part of the memory will be allocated and used by the gRPC framework. When the request enters the `ShuffleServerGrpcService` method, this part of the memory will be converted into on-heap memory and used in the business code. However, this is completely unnecessary, as we can simply use either off-heap memory or on-heap memory, without the need for conversion. 

## gRPC mode will cause inaccurate `usedMemory` leading to OOM 
gRPC enables off-heap memory by default, and this part of the memory will be allocated and used by the gRPC framework, __which is not calculated in `usedMemory`__.
By default, gRPC uses PooledByteBufAllocator to allocate off-heap memory for requests, with a chunkSize of 2MB. Therefore, when doing pre-allocation, it will also require allocating 2MB of off-heap memory. So in high-pressure and high-concurrency scenarios, we may easily encounter the following error exceptions when the shuffle server is receiving plenty of `SendShuffleDataRequest` and `RequireBufferRequest` at the same time:
```
[17:23:23:348] [client-data-transfer-79] ERROR org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.requirePreAllocation:257 - Exception happened when requiring pre-allocated buffer from 127.0.0.1:19970
io.grpc.StatusRuntimeException: UNAVAILABLE: GOAWAY shut down transport. HTTP/2 error code: INTERNAL_ERROR, debug data: failed to allocate 2097152 byte(s) of direct memory (used: 161059176727, max: 161061273600)
	at io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCalls.java:268) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:249) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:167) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.proto.ShuffleServerGrpc$ShuffleServerBlockingStub.requireBuffer(ShuffleServerGrpc.java:842) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.requirePreAllocation(ShuffleServerGrpcClient.java:255) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.lambda$sendShuffleData$0(ShuffleServerGrpcClient.java:476) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.common.util.RetryUtils.retryWithCondition(RetryUtils.java:81) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.sendShuffleData(ShuffleServerGrpcClient.java:473) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.lambda$sendShuffleDataAsync$1(ShuffleWriteClientImpl.java:189) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1604) ~[?:1.8.0_352]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_352]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_352]
	at java.lang.Thread.run(Thread.java:750) ~[?:1.8.0_352]
```

## gRPC does not support sending `ByteString` using off-heap memory
Refer to https://github.com/grpc/grpc-java/issues/9704.

## More flexible
Using Netty is more direct and flexible, and it won't be constrained by the gRPC layer's wrapping.

## Netty's iterative upgrades will be faster
Netty's iterative upgrades will be faster, and the gRPC community cannot guarantee timely updates to Netty's version.

So I think it's time for us to set the default server type to Netty.


### How should we improve?

Tasks:
- https://github.com/apache/incubator-uniffle/issues/1810
- https://github.com/apache/incubator-uniffle/issues/1856
- https://github.com/apache/incubator-uniffle/pull/1919

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1651/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,incubator-uniffle,2247665125,1654,[Umbrella] Release 0.9.0,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-04-17T08:11:10Z,2024-08-15T06:30:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)

### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.

### Describe the proposal

Release Apache Uniffle 0.9.0, we would like to release binary package. There are many things to do. First, we should ensure what issues should be included in this version.

### Task list

- [x] #1655
- [x] Checkout `branch-0.9`
- [x] Tag and release `v0.9.0-rc1`.
    - [x] Backport necessary fixes from `master` to `branch-0.9`.
        - [x] https://github.com/apache/incubator-uniffle/milestone/2
    - [x] Bump project version to `0.9.0` in `branch-0.9`.
    - [x] (GitHub) Tag `v0.9.0-rc1`:
        - https://github.com/apache/incubator-uniffle/releases/tag/v0.9.0-rc1
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.9.0-rc1/`:
        - https://dist.apache.org/repos/dist/dev/incubator/uniffle/0.9.0-rc1/
- [X] Tag and release `v0.9.0-rc2`.
    - [x] (GitHub) Tag `v0.9.0-rc2`:
        - https://github.com/apache/incubator-uniffle/releases/tag/v0.9.0-rc2
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.9.0-rc2/`:
        - https://dist.apache.org/repos/dist/dev/incubator/uniffle/0.9.0-rc2/
    - [x] Post release note on [Uniffle website][1]:
        - https://github.com/apache/incubator-uniffle-website/pull/75
    - [X] Vote on dev@uniffle.apache.org
    - [X] Vote on general@incubator.apache.org
- [X] Tag and release `0.9.0`.
    - [x] (SVN) Move the artifacts under `dev/.../0.9.0-rc2` to `release/.../0.9.0` (by PPMC).
    - [x] (GitHub) Tag `v0.9.0` to `v0.9.0-rc2` and upload the artifacts.
    - [x] Update download link on [Uniffle website][1]:
      - https://github.com/apache/incubator-uniffle-website/pull/82
    - [X] Bump project version to `0.9.1-SNAPSHOT` in `branch-0.9`:
      - #1907
    - [x] Post an announcement on general@incubator.apache.org

[1]: https://github.com/apache/incubator-uniffle-website

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1654/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-LTL4,incubator-uniffle,2116891384,1654,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-05-17T07:05:07Z,2024-05-17T07:05:07Z,@EnricoMi Maybe we could to start to release 0.9.0-rc1.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-LTL4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-NX-I,incubator-uniffle,2117435272,1654,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-05-17T11:55:34Z,2024-05-17T11:55:34Z,"Oh, this is my first time to find the Milestone componet that can be as the tracker for version management. Maybe the 0.10.0 could be created now to track the main features.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-NX-I/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-O7JU,incubator-uniffle,2117841492,1654,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-05-17T15:24:43Z,2024-05-17T15:24:43Z,"> Oh, this is my first time to find the Milestone componet that can be as the tracker for version management. Maybe the 0.10.0 could be created now to track the main features.

Please add your favourite issues / pull requests to https://github.com/apache/incubator-uniffle/milestone/3.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-O7JU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-PF30,incubator-uniffle,2117885428,1654,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-05-17T15:47:45Z,2024-05-17T15:47:45Z,"> @EnricoMi Maybe we could to start to release 0.9.0-rc1.

we are not waiting for #1720 / #1240?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-PF30/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_P_fZ,incubator-uniffle,2134898649,1654,NA,xianjingfeng,11752250,,,NA,2024-05-28T10:39:45Z,2024-05-28T10:39:45Z,@EnricoMi @jerqi @zuston Should we wait for #1751,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_P_fZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_Tj-B,incubator-uniffle,2135834497,1654,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-05-28T18:04:38Z,2024-05-28T18:04:38Z,Let's not wait with the release for more features. There will always be new features. We should rather release more frequently.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_Tj-B/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_WZXS,incubator-uniffle,2136577490,1654,NA,xianjingfeng,11752250,,,NA,2024-05-29T05:59:52Z,2024-05-29T05:59:52Z,"> Let's not wait with the release for more features. There will always be new features. We should rather release more frequently.

But it is not a feature. Version 0.8 already supports gluten.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_WZXS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_ff0e,incubator-uniffle,2138963230,1654,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-05-30T08:15:40Z,2024-05-30T08:15:40Z,Then this is not an [Improvement] but a [Fix]: https://github.com/apache/incubator-uniffle/issues/1751,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_ff0e/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EqBn5,incubator-uniffle,2225609209,1654,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-12T13:36:57Z,2024-07-12T13:36:57Z,@EnricoMi It's been a while. Could you please continue working on this?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EqBn5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EwZVA,incubator-uniffle,2227279168,1654,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-07-14T09:24:48Z,2024-07-14T09:24:48Z,I'll finish the release on Monday.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EwZVA/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1654,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6E8OgO,incubator-uniffle,2230380558,1654,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-07-16T08:59:23Z,2024-07-16T08:59:23Z,This has been released.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6E8OgO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1655,https://api.github.com/repos/apache/incubator-uniffle/issues/1655,incubator-uniffle,2247678482,1655,Bump `master` to `0.10.0-SNAPSHOT`.,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-04-17T08:18:17Z,2024-04-18T08:41:33Z,,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1655/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1657,https://api.github.com/repos/apache/incubator-uniffle/issues/1657,incubator-uniffle,2247709304,1657,[DOCS] Add licences and notices regarding new dashboard module,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-04-17T08:34:30Z,2024-05-17T15:50:18Z,,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1657/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1657,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM57X6jg,incubator-uniffle,2069866720,1657,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-04-22T15:21:52Z,2024-04-22T15:21:52Z,"@jerqi what specifically is needed here?
@yl09099 would you like to take this one?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM57X6jg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1657,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM57o8zm,incubator-uniffle,2074332390,1657,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-04-24T08:05:14Z,2024-04-24T08:05:14Z,"> @jerqi what specifically is needed here? @yl09099 would you like to take this one?

I'm a little busy recently. I will finish the issue after the vocation of Thailand.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM57o8zm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1657,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM57yIEX,incubator-uniffle,2076737815,1657,NA,yl09099,33595968,,,NA,2024-04-25T09:17:46Z,2024-04-25T09:17:46Z,"> > @jerqi what specifically is needed here? @yl09099 would you like to take this one?
> 
> I'm a little busy recently. I will finish the issue after the vocation of Thailand.

Okay, I'll do it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM57yIEX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1657,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM58RzgS,incubator-uniffle,2085042194,1657,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-04-30T11:27:20Z,2024-04-30T11:27:20Z,"There are two kinds of packages for Apache release package: source release package and binary release package.
For different licenses, they will restrict you use them in different ways.

Some license allow you to copy its code to your project, like Apache license. But you shouldn't modify the copied file licenses.

Some licenses don't allow you to copy its code and allow to use the binary package like EPL license.

So Apache project needs to update the dependencies license information in License and License-binary if we add extra dependencies.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM58RzgS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1658,https://api.github.com/repos/apache/incubator-uniffle/issues/1658,incubator-uniffle,2249973191,1658,[Bug] Optimized FileSegmentManagedBuffer.nioByteBuffer to avoid multiple read file,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2024-04-18T07:34:37Z,2025-01-27T01:25:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

FileSegmentManagedBuffer#nioByteBuffer read file directly without cache at now.
`ShuffleDataResult getData()` may read file twice when buffer instanceof FileSegmentManagedBuffer, it‘s not Consistent with `NettyManagedBuffer`.
```
   if (buffer.nioByteBuffer().hasArray()) {
      return buffer.nioByteBuffer().array();
    }
```

expect:
FileSegmentManagedBuffer#nioByteBuffer should add a buffer to hold read file result to avoid multiple read file

### Affects Version(s)

master

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1658/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1662,https://api.github.com/repos/apache/incubator-uniffle/issues/1662,incubator-uniffle,2251999818,1662,[Bug] Fix flaky tests,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-19T03:24:05Z,2024-04-25T03:06:52Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

We can see flaky tests like https://github.com/apache/incubator-uniffle/actions/runs/8747823784/job/24006888103?pr=1661.
Because https://github.com/apache/incubator-uniffle/pull/1653 has been put on hold. So I'll cherry-pick the code from https://github.com/apache/incubator-uniffle/pull/1653.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1662/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1664,https://api.github.com/repos/apache/incubator-uniffle/issues/1664,incubator-uniffle,2252252431,1664,[DOCS] Update the descriptions and default values of outdated configurations,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-19T07:14:00Z,2024-04-25T03:07:52Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

Some descriptions and default values are outdated in the current documentations, we can update them.

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1664/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1668,https://api.github.com/repos/apache/incubator-uniffle/issues/1668,incubator-uniffle,2263672417,1668,[Bug] Assertions will not take effect during production runtime,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-04-25T13:59:41Z,2024-06-24T03:07:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

We have many assertions in our code, and these will only take effect when running test cases because the `-ea` parameter is enabled when running tests. However, they will not take effect in actual production because we do not include the `-ea` parameter in the startup arguments, and enabling assertions can also impact performance, so it is not recommended to enable them. We should refactor them, maybe replacing these assertions with exception-throwing methods. 

This allows us to promptly detect some errors that have not been checked currently, making these exception checks work. This will make the code more reliable when running in prod.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1668/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1673,https://api.github.com/repos/apache/incubator-uniffle/issues/1673,incubator-uniffle,2279887620,1673,[Improvement] Operator should support K8S 1.24,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2024-05-06T02:10:14Z,2024-05-17T06:59:17Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In K8S operator, we use autoscaling/v2beta2, in K8S 1.24, they remove autoscaling/v2beta2, they have autoscaling/v2.

### How should we improve?

We should adapt to 1.24. I don't know whether we can adapt to the old versions.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1673/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1673,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM584Idy,incubator-uniffle,2095089522,1673,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-05-06T02:21:36Z,2024-05-06T02:21:36Z,@advancedxy @wangao1236 Could you give me some input?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM584Idy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1673,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM584WY-,incubator-uniffle,2095146558,1673,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-05-06T03:46:44Z,2024-05-06T03:46:44Z,I have a solution. https://github.com/VictoriaMetrics/operator/blob/master/controllers/factory/k8stools/version.go,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM584WY-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1673,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5848Qn,incubator-uniffle,2095301671,1673,NA,advancedxy,807537,,,NA,2024-05-06T06:48:55Z,2024-05-06T06:48:55Z,"1.24 is already end of life[^1].
I think the master code should target the latest K8S version instead.

However there might be some pretty old k8s clusters runnings in the prod. @wangao1236 do you have any idea about the backward compatibility of K8S versions? Is it safe for operator to depends on a newer version of k8s and deploys to an old one with limited usage of new APIs.

[^1]: https://kubernetes.io/releases/patch-releases/#non-active-branch-history","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5848Qn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1673,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59ZQSo,incubator-uniffle,2103772328,1673,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-05-10T03:01:34Z,2024-05-10T03:01:34Z,@zhengchenyu @qijiale76 Could you have any ideas?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59ZQSo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1675,https://api.github.com/repos/apache/incubator-uniffle/issues/1675,incubator-uniffle,2280175124,1675,[Flaky Test] Tests may fail on different machines,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-05-06T06:51:05Z,2024-05-08T05:04:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

Running some unit tests on different machines may result in failures. One of them, as shown below:
```
[INFO] Running org.apache.uniffle.server.storage.LocalStorageManagerTest
[ERROR] Tests run: 6, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.332 s <<< FAILURE! - in org.apache.uniffle.server.storage.LocalStorageManagerTest
[ERROR] testInitializeLocalStorage  Time elapsed: 0.014 s  <<< FAILURE!
org.opentest4j.AssertionFailedError
        at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:35)
        at org.junit.jupiter.api.Assertions.fail(Assertions.java:115)
        at org.apache.uniffle.server.storage.LocalStorageManagerTest.testInitializeLocalStorage(LocalStorageManagerTest.java:205)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
        at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
        at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
        at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
        at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
        at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
        at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
        at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
        at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
        at java.util.ArrayList.forEach(ArrayList.java:1259)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
        at java.util.ArrayList.forEach(ArrayList.java:1259)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
        at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
        at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
        at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
        at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
        at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
        at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
        at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
        at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```

It will succeed on github machines or even on MacBooks. But it will fail on CentOS Linux release 7.2 (Final), which is my test machine.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1675/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1678,https://api.github.com/repos/apache/incubator-uniffle/issues/1678,incubator-uniffle,2284728491,1678,[Bug] Incorrect disk size for local storage,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-05-08T05:45:50Z,2024-05-10T02:54:17Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Currently, the disk size of localStorage's shuffleMeta is not descrease correctly when using appPurgeEvent to remove resources. 
That will make the disk size collected by uniffle leak and then make the disk invalid.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1678/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1678,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59KMWu,incubator-uniffle,2099824046,1678,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-08T06:19:42Z,2024-05-08T06:19:42Z,When will the disk become invalid? I'm curious that I've never encountered this issue.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59KMWu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1680,https://api.github.com/repos/apache/incubator-uniffle/issues/1680,incubator-uniffle,2284732696,1680,"[Bug] When a application is expired in one of shuffle servers assigned, all application data on HDFS will be deleted",xianjingfeng,11752250,,,CLOSED,2024-05-08T05:49:35Z,2024-05-11T02:06:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Currently, when a application is expired in one of shuffle servers assigned, all data of the application on HDFS will be deleted.
And I think this issue is related to #1620

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1680/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1680,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59KEiY,incubator-uniffle,2099792024,1680,NA,xianjingfeng,11752250,,,NA,2024-05-08T05:51:41Z,2024-05-08T05:51:41Z,@jerqi @zuston @rickyma @dingshun3016 PTAL,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59KEiY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1680,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59KRkQ,incubator-uniffle,2099845392,1680,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-08T06:37:04Z,2024-05-08T06:37:04Z,"Why is this related to https://github.com/apache/incubator-uniffle/issues/1620? You mean you will also encounter ""Blocks read inconsistent"" issue when fetching shuffle data?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59KRkQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1680,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59KVcJ,incubator-uniffle,2099861257,1680,NA,xianjingfeng,11752250,,,NA,2024-05-08T06:48:34Z,2024-05-08T06:48:34Z,"> Why is this related to #1620? You mean you will also encounter ""Blocks read inconsistent"" issue when fetching shuffle data?

Yes","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59KVcJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1682,https://api.github.com/repos/apache/incubator-uniffle/issues/1682,incubator-uniffle,2285001055,1682,[Improvement] Introduce the local_storage_is_writable metric,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-05-08T08:25:25Z,2024-05-08T23:26:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Introduce the local_storage_is_writable metric to indicate the local file is writable clearly.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1682/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1682,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59LG-s,incubator-uniffle,2100064172,1682,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-08T08:41:27Z,2024-05-08T08:41:27Z,Is `is_writable` here means `!corrupted`? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59LG-s/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1682,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59LTDq,incubator-uniffle,2100113642,1682,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-05-08T09:06:58Z,2024-05-08T09:06:58Z,"> Is `is_writable` here means `!corrupted`?

I think it takes the meanings with space enough + not corrupted. And this metric is construct by the local storage canWrite method, that means it will be more precise.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59LTDq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1682,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59RLxa,incubator-uniffle,2101656666,1682,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-05-08T23:26:36Z,2024-05-08T23:26:36Z,solved by #1682 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59RLxa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1684,https://api.github.com/repos/apache/incubator-uniffle/issues/1684,incubator-uniffle,2286754006,1684,[Improvement] use the disk size obtained from periodic check to determine whether the disk can be written,xianjingfeng,11752250,,,CLOSED,2024-05-09T02:01:15Z,2024-05-11T01:56:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In our production cluster, we found that although the amount of shuffle data did not change much, the amount of writing to HDFS continued to increase every day. The main reason is that currently we determine whether the local disk is writable based on metadata. 
Related to #1678 #1247

<img width=""1115"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/11752250/fb4cda16-5cc3-41a9-8550-95378e083720"">

<img width=""1126"" alt=""image"" src=""https://github.com/apache/incubator-uniffle/assets/11752250/24d5312a-dd39-4b99-8c78-71fc1294534f"">


### How should we improve?

Use the disk size obtained from periodic check to determine whether the disk can be written.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1684/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1686,https://api.github.com/repos/apache/incubator-uniffle/issues/1686,incubator-uniffle,2287514357,1686,[FEATURE] Support pending tasks number metrics for Netty EventLoopGroup,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-05-09T11:43:17Z,2024-05-13T07:07:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Through the metrics, we can know whether the current Netty Server has reached a performance bottleneck, whether tasks are accumulating, and thus be able to adjust the thread number of the Netty EventLoopGroup more accurately.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1686/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1688,https://api.github.com/repos/apache/incubator-uniffle/issues/1688,incubator-uniffle,2287728960,1688,[FEATURE] Show read_used_buffer_size in DashBoard,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-05-09T13:43:17Z,2024-06-18T15:35:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We only show `used_buffer_size` in the dashboard for now. We should show `read_used_buffer_size` too.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1688/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1688,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59aeXC,incubator-uniffle,2104092098,1688,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-10T07:37:49Z,2024-05-10T07:37:49Z,@yl09099 If you have time. PTAL.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59aeXC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1695,https://api.github.com/repos/apache/incubator-uniffle/issues/1695,incubator-uniffle,2290791187,1695,[Bug] Asynchronous verification causes invalid resending of data blocks. ,yl09099,33595968,,,CLOSED,2024-05-11T08:48:49Z,2024-05-11T09:14:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In the checkIfBlocksFailed method, when the failed block list is obtained for the first time, a new failed block is added to the failed block list during the retransmission process. In this case, an exception is thrown and the resend is invalid.

### Affects Version(s)

0.9.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1695/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1695,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59gY5y,incubator-uniffle,2105642610,1695,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-05-11T08:53:52Z,2024-05-11T08:53:52Z,Please look at the master branch code,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59gY5y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1695,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59gaVp,incubator-uniffle,2105648489,1695,NA,yl09099,33595968,,,NA,2024-05-11T09:13:11Z,2024-05-11T09:13:11Z,"> Please look at the master branch code
Ok, my question, I read the wrong branch, let me close the issue.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59gaVp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1695,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59gabo,incubator-uniffle,2105648872,1695,NA,yl09099,33595968,,,NA,2024-05-11T09:14:44Z,2024-05-11T09:14:44Z,"My mistake, straight off.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59gabo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1698,https://api.github.com/repos/apache/incubator-uniffle/issues/1698,incubator-uniffle,2290978720,1698,[Flaky Test] Tests fail because of VM crash,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-05-11T16:23:53Z,2024-05-22T09:33:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

Error:  Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.22.2:test (default-test) on project rss-integration-common-test: There are test failures.
Error:  
Error:  Please refer to /home/runner/work/incubator-uniffle/incubator-uniffle/integration-test/common/target/surefire-reports for the individual test results.
Error:  Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
Error:  The forked VM terminated without properly saying goodbye. VM crash or System.exit called?
Error:  Command was /bin/sh -c cd /home/runner/work/incubator-uniffle/incubator-uniffle/integration-test/common && /usr/lib/jvm/temurin-8-jdk-amd64/jre/bin/java -ea -Xmx3g -jar /home/runner/work/incubator-uniffle/incubator-uniffle/integration-test/common/target/surefire/surefirebooter7429227444381436354.jar /home/runner/work/incubator-uniffle/incubator-uniffle/integration-test/common/target/surefire 2024-05-11T16-14-55_901-jvmRun1 surefire6058224363993333182tmp surefire_07324544499115299035tmp
Error:  Error occurred in starting fork, check output in log
Error:  Process Exit Code: 1
Error:  Crashed tests:
Error:  org.apache.uniffle.test.FetchClientConfTest
Error:  org.apache.maven.surefire.booter.SurefireBooterForkException: The forked VM terminated without properly saying goodbye. VM crash or System.exit called?
Error:  Command was /bin/sh -c cd /home/runner/work/incubator-uniffle/incubator-uniffle/integration-test/common && /usr/lib/jvm/temurin-8-jdk-amd64/jre/bin/java -ea -Xmx3g -jar /home/runner/work/incubator-uniffle/incubator-uniffle/integration-test/common/target/surefire/surefirebooter7429227444381436354.jar /home/runner/work/incubator-uniffle/incubator-uniffle/integration-test/common/target/surefire 2024-05-11T16-14-55_901-jvmRun1 surefire6058224363993333182tmp surefire_07324544499115299035tmp
Error:  Error occurred in starting fork, check output in log
Error:  Process Exit Code: 1
Error:  Crashed tests:
Error:  org.apache.uniffle.test.FetchClientConfTest
Error:  	at org.apache.maven.plugin.surefire.booterclient.ForkStarter.fork(ForkStarter.java:669)
Error:  	at org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:282)
Error:  	at org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:245)
Error:  	at org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeProvider(AbstractSurefireMojo.java:1183)
Error:  	at org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeAfterPreconditionsChecked(AbstractSurefireMojo.java:1011)
Error:  	at org.apache.maven.plugin.surefire.AbstractSurefireMojo.execute(AbstractSurefireMojo.java:857)
Error:  	at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:126)
Error:  	at org.apache.maven.lifecycle.internal.MojoExecutor.doExecute2(MojoExecutor.java:328)
Error:  	at org.apache.maven.lifecycle.internal.MojoExecutor.doExecute(MojoExecutor.java:316)
Error:  	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:212)
Error:  	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:174)
Error:  	at org.apache.maven.lifecycle.internal.MojoExecutor.access$000(MojoExecutor.java:75)
Error:  	at org.apache.maven.lifecycle.internal.MojoExecutor$1.run(MojoExecutor.java:162)
Error:  	at org.apache.maven.plugin.DefaultMojosExecutionStrategy.execute(DefaultMojosExecutionStrategy.java:39)
Error:  	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:159)
Error:  	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:105)
Error:  	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:73)
Error:  	at org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build(SingleThreadedBuilder.java:53)
Error:  	at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:118)
Error:  	at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:261)
Error:  	at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:173)
Error:  	at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:101)
Error:  	at org.apache.maven.cli.MavenCli.execute(MavenCli.java:906)
Error:  	at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:283)
Error:  	at org.apache.maven.cli.MavenCli.main(MavenCli.java:206)
Error:  	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
Error:  	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
Error:  	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
Error:  	at java.lang.reflect.Method.invoke(Method.java:498)
Error:  	at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:283)
Error:  	at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:226)
Error:  	at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:407)
Error:  	at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:348)
Error:  	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
Error:  	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
Error:  	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
Error:  	at java.lang.reflect.Method.invoke(Method.java:498)
Error:  	at org.apache.maven.wrapper.BootstrapMainStarter.start(BootstrapMainStarter.java:52)
Error:  	at org.apache.maven.wrapper.WrapperExecutor.execute(WrapperExecutor.java:161)
Error:  	at org.apache.maven.wrapper.MavenWrapperMain.main(MavenWrapperMain.java:73)
Error:  -> [Help 1]

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/9044920297/job/24854106226?pr=1696

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1698/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1698,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59hjEu,incubator-uniffle,2105946414,1698,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-11T16:25:09Z,2024-05-11T16:25:09Z,"Maybe we should increase the memory? Current memory is 3g: `<argLine>-ea -Xmx3g</argLine>`.

WDYT? @zuston @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM59hjEu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1698,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-T8Dc,incubator-uniffle,2119155932,1698,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-19T08:47:28Z,2024-05-19T08:47:28Z,ping @zuston @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-T8Dc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1698,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-VbmP,incubator-uniffle,2119547279,1698,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-05-20T02:16:21Z,2024-05-20T02:16:21Z,"> Maybe we should increase the memory? Current memory is 3g: `<argLine>-ea -Xmx3g</argLine>`.
> 
> WDYT? @zuston @jerqi

Ok for me. We can take a try","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-VbmP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1699,https://api.github.com/repos/apache/incubator-uniffle/issues/1699,incubator-uniffle,2290982846,1699,[Improvement] Upgrade from commons-collections:commons-collections:3.2.2 to org.apache.commons:commons-collections:4.4,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-05-11T16:35:54Z,2024-05-17T05:18:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

> All users are strongly encouraged to update to this release.

Refer to https://commons.apache.org/proper/commons-collections/release_4_4.html.
It includes a log of bugfixes and improvements. I think we need to upgrade it.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1699/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1701,https://api.github.com/repos/apache/incubator-uniffle/issues/1701,incubator-uniffle,2290987707,1701,[Improvement] Bump Netty from 4.1.106.Final to 4.1.109.Final,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-05-11T16:50:56Z,2024-05-14T06:53:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Netty has released v4.1.107.Final, v4.1.108.Final, v4.1.109.Final, including a lot of bugfixes and improvements.
Refer to [v4.1.107.Final](https://netty.io/news/2024/02/13/4-1-107-Final.html), [v4.1.108.Final](https://netty.io/news/2024/03/21/4-1-108-Final.html), [v4.1.109.Final](https://netty.io/news/2024/04/15/4-1-109-Final.html).

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1701/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1703,https://api.github.com/repos/apache/incubator-uniffle/issues/1703,incubator-uniffle,2290995183,1703,[Improvement] Bump gRPC from 1.61.1 to 1.63.0,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-05-11T17:13:51Z,2024-05-14T06:53:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

gRPC has released [v1.62.2](https://github.com/grpc/grpc-java/releases/tag/v1.62.2), [v1.63.0](https://github.com/grpc/grpc-java/releases/tag/v1.63.0), including a lot of bugfixes and improvements. Refer to https://github.com/grpc/grpc-java/releases.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1703/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1705,https://api.github.com/repos/apache/incubator-uniffle/issues/1705,incubator-uniffle,2291012194,1705,[Improvement] Upgrade Jetty to the latest stable version,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-05-11T18:01:31Z,2024-05-11T18:02:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

> Jetty 12 is the only community supported versions of Jetty at this point in time, and has a great many improvements over previous releases.
> While many people continue to use older versions of Jetty like 11/10/9 for a variety of reasons, we recommend using Jetty 12
> Note that Jetty 12 is the only version that will receive support for the open source community, and represents the version of Jetty that we will actively maintain and improve over the next few years.
> January 1st, 2024 marks the end of community support for the Jetty 11 and older releases.

Refer to https://eclipse.dev/jetty/download.php and [End of Community Support for Jetty 9.x - June 2022](https://github.com/jetty/jetty.project/issues/7958).


I think we should upgrade Jetty to the latest stable version.

### How should we improve?
No response

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1705/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1706,https://api.github.com/repos/apache/incubator-uniffle/issues/1706,incubator-uniffle,2291231581,1706,[Improvement] Upgrade the default NodeJS and npm versions of dashboard.,yl09099,33595968,,,CLOSED,2024-05-12T08:51:54Z,2024-05-23T01:53:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The dashboard on MacOS does not support the M-chip of Node14, resulting in a local compilation failure, and you need to upgrade to Node16 or npm8 or later.

[ERROR] Failed to execute goal com.github.eirslett:frontend-maven-plugin:1.12.1:npm (npm install) on project dashboard: Failed to run task: 'npm install' failed. org.apache.commons.exec.ExecuteException: Process exited with an error: 1 (Exit value: 1) -> [Help 1]

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1706/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1708,https://api.github.com/repos/apache/incubator-uniffle/issues/1708,incubator-uniffle,2291745563,1708,[FEATURE] support use skip list to store shuffleBuffer in memory,xianjingfeng,11752250,,,CLOSED,2024-05-13T03:51:35Z,2024-06-17T07:17:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, we use linkedList to store shuffleBuffer in memory.  If we assign a lot of memory(1TB) to the shuffle server, the performance will not be good while getting data from memory. Because every request needs to look for `lastBlockId` from the head position.

Other benefits of using skip list:
1. Fix #926
2. We don't need to sort data while flushing data to disk. #137

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1708/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1708,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-MQtg,incubator-uniffle,2117143392,1708,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-05-17T09:32:40Z,2024-05-17T09:32:40Z,"We need to guarantee the order of data, otherwise we will lose the data.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-MQtg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1708,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-Mmrx,incubator-uniffle,2117233393,1708,NA,xianjingfeng,11752250,,,NA,2024-05-17T10:18:05Z,2024-05-17T10:18:05Z,"> We need to guarantee the order of data, otherwise we will lose the data.

Get it. This feature will not support `slow start`. I'm going to make it an optional feature.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-Mmrx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1709,https://api.github.com/repos/apache/incubator-uniffle/issues/1709,incubator-uniffle,2291972114,1709,[FEATURE] Introduce pluggable clientConf access in coordinator when clients fetch client conf,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-05-13T06:51:22Z,2024-05-16T23:16:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Sometimes, for some experimental features(like reassign), I hope it could be only applied some apps for better stability. And it's time to implement this in `fetchClientConf` rpc

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1709/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1711,https://api.github.com/repos/apache/incubator-uniffle/issues/1711,incubator-uniffle,2292336103,1711,[FEATURE] Refactor reconfigurable conf framework and apply to shuffleServer module,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-05-13T09:47:56Z,2024-05-22T07:55:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

#572 introduces the reconfigurable conf mechanism in coordinator side, but I don't like this implementation. This issue is to track this optimization

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1711/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1713,https://api.github.com/repos/apache/incubator-uniffle/issues/1713,incubator-uniffle,2292487672,1713,[Improvement] Log message should indicate RPC error during after close / shutdown,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-05-13T10:59:59Z,2024-06-18T13:26:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Some async calls may not have finished when `ShuffleWriteClientImpl.close()` / `RegisterHeartBeat.shutdown()` is called, which creates warnings in the log. This pollutes logs and makes tracing unrelated issues harder:

```
WARN impl.ShuffleWriteClientImpl: Error happened when unregistering to ShuffleServerInfo{host[10.109.9.45], grpc port[19999]}
io.grpc.StatusRuntimeException: CANCELLED: Thread interrupted
        at io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCalls.java:268)
        at io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:249)
        at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:167)
        at org.apache.uniffle.proto.ShuffleServerGrpc$ShuffleServerBlockingStub.unregisterShuffleByAppId(ShuffleServerGrpc.java:772)
        at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.doUnregisterShuffleByAppId(ShuffleServerGrpcClient.java:345)
        at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.unregisterShuffleByAppId(ShuffleServerGrpcClient.java:352)
        at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.lambda$unregisterShuffle$28(ShuffleWriteClientImpl.java:1020)
        at org.apache.uniffle.common.util.ThreadUtils.lambda$executeTasks$0(ThreadUtils.java:110)
        at java.base/java.util.concurrent.FutureTask.run(Unknown Source)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
        at java.base/java.lang.Thread.run(Unknown Source)
Caused by: java.lang.InterruptedException
        at io.grpc.stub.ClientCalls$ThreadlessExecutor.throwIfInterrupted(ClientCalls.java:750)
        at io.grpc.stub.ClientCalls$ThreadlessExecutor.waitAndDrain(ClientCalls.java:718)
        at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:159)
        ... 9 more
```

### How should we improve?

Once `close` and `shutdown` has been called, ongoing async calls are expected to fail, so the log message should indicate this.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1713/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1717,https://api.github.com/repos/apache/incubator-uniffle/issues/1717,incubator-uniffle,2301965140,1717,[Improvement] pick partitions instead of shuffles for flushing,xianjingfeng,11752250,,,CLOSED,2024-05-17T06:55:41Z,2024-06-06T06:28:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, if the used memory reach the high watermark, the shuffle server will pick the shuffle with max size to flush.
In this case, if the size of a shuffle is very large, it will cause long GC pauses and high disk pressure.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1717/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1721,https://api.github.com/repos/apache/incubator-uniffle/issues/1721,incubator-uniffle,2305444795,1721,[Bug] ClassCastExpection of boolean -> string when getting remote client conf in coordinator,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-05-20T08:37:11Z,2024-05-21T01:59:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

ClassCastExpection of boolean -> string when getting remote client conf in coordinator

![image](https://github.com/apache/incubator-uniffle/assets/8609142/c82a64d0-dabc-4e4f-8cab-5711b943e0cd)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1721/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1727,https://api.github.com/repos/apache/incubator-uniffle/issues/1727,incubator-uniffle,2307133731,1727,[Improvement] Introduce local allocation buffer to store blocks in memory,xianjingfeng,11752250,,,OPEN,2024-05-21T02:29:51Z,2024-05-21T07:23:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently we have put the shuffle data into the off-heap memory in shuffle server . But I found it still occupancy a lot of heap memory.
The following is the result of printing by using `jmap -histo`.
```
   1:     189601376    16684921088  io.netty.buffer.UnpooledByteBufAllocator$InstrumentedUnpooledUnsafeDirectByteBuf
   2:     189860728    15188858240  java.nio.DirectByteBuffer (java.base@11.0.1)
   3:     189605871    13651622712  jdk.internal.ref.Cleaner (java.base@11.0.1)
   4:     189018520    10585037120  org.apache.uniffle.common.ShufflePartitionedBlock
   5:     189605871     7584234840  java.nio.DirectByteBuffer$Deallocator (java.base@11.0.1)
  ```
From the above results, we can see that the main reason for high memory usage is that there are too many blocks. And the reason why there are so many blocks is because the blocks are very small.

### How should we improve?

Introduce local allocation buffer like `MSLAB` in Hbase. 
Refer: https://hbase.apache.org/book.html#gcpause

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1727/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1727,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-dQng,incubator-uniffle,2121599456,1727,NA,xianjingfeng,11752250,,,NA,2024-05-21T02:38:34Z,2024-05-21T02:38:34Z,"@jerqi @zuston @advancedxy @rickyma PTAL. 
I'm quite busy recently. If anyone interested in it, welcome to pick it up.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-dQng/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1727,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-eiJ4,incubator-uniffle,2121933432,1727,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-05-21T07:23:32Z,2024-05-21T07:23:32Z,"This issue seems feasible. I'll take a look first. We need this too. 

Currently, there are a few things that we can do to make blocks smaller:
1. Set `spark.rss.writer.buffer.spill.size` to a higher value to make blocks larger, e.g. `1g` or `2g`.
2. Set `rss.client.memory.spill.ratio` less than `0.5`, e.g. `0.3`, let larger blocks spill first.
3. Set `spark.rss.writer.buffer.size` to a larger value refer to https://github.com/apache/incubator-uniffle/issues/1594#issuecomment-2081378887, e.g. `10m`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5-eiJ4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1728,https://api.github.com/repos/apache/incubator-uniffle/issues/1728,incubator-uniffle,2308216286,1728,[FEATURE] Introduce disks timeout metrics,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-05-21T12:41:33Z,2024-05-22T15:30:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

When the disk load is high and `rss.server.health.check.enable` is enabled, it may cause temporary disk response timeouts, which does not necessarily mean that the disk is damaged/corrupted. If we mark the disk as damaged/corrupted during a timeout, it could lead to the ultimate failure of the task, or even result in an awkward situation where no disks are available for further allocation, which will make the job unstable.

### Motivation

Currently, we can find logs as below when a disk response timeouts:
```
[2024-05-21 16:12:45.464] [HealthCheckService] [ERROR] LocalStorageChecker.checkIsHealthy - Timeout of checking local storage: /data1/rssdata. This should not happen and mark this disk corrupted.
[2024-05-21 16:12:45.465] [HealthCheckService] [INFO] LocalStorageChecker.checkIsHealthy - shuffle server become unhealthy
```

### Describe the solution

Therefore, in this situation, we only need to record the number of timeouts, without marking the disk as damaged/corrupted.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1728/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1731,https://api.github.com/repos/apache/incubator-uniffle/issues/1731,incubator-uniffle,2309466390,1731,[Improvement] Bump gRPC from 1.63.0 to 1.64.0,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-05-22T02:55:18Z,2024-05-23T01:48:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?
Sadly after https://github.com/apache/incubator-uniffle/pull/1704, I found out [memory leaks](https://github.com/grpc/grpc-java/issues/11225) exist. Refer to the [issue](https://github.com/grpc/grpc-java/issues/11115) after 1.61.1.
And it was fixed in [v1.64.0](https://github.com/grpc/grpc-java/releases/tag/v1.64.0) last week, and the fix was backported to [v1.63.1](https://github.com/grpc/grpc-java/releases/tag/v1.63.1).
We should upgrade to 1.64.0.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1731/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1735,https://api.github.com/repos/apache/incubator-uniffle/issues/1735,incubator-uniffle,2310080594,1735,[Bug] MultiException class not found when reassign or stage retry is enabled,dingshun3016,21172339,,,CLOSED,2024-05-22T09:49:29Z,2024-07-10T03:41:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When reassign or stage retry is enabled, GrpcServer needs to be started. If there is a port conflict during startup and retry is performed, MultiException will be thrown and the following exception will occur, causing the job to fail.The root cause is that uniffle did not include jetty-util related packages.

`ERROR [main] SparkSubmit$$anon$2: spark submit throw error: org/eclipse/jetty/util/MultiException java.lang.NoClassDefFoundError: org/eclipse/jetty/util/MultiException at org.apache.uniffle.common.util.RssUtils.isServerPortBindCollision(RssUtils.java:219) at org.apache.uniffle.common.util.RssUtils.startServiceOnPort(RssUtils.java:197) at org.apache.uniffle.common.rpc.GrpcServer.start(GrpcServer.java:188) at org.apache.spark.shuffle.RssShuffleManager.<init>(RssShuffleManager.java:262) at org.apache.spark.shuffle.DelegationRssShuffleManager.createShuffleManagerInDriver(DelegationRssShuffleManager.java:87) at org.apache.spark.shuffle.DelegationRssShuffleManager.<init>(DelegationRssShuffleManager.java:60) at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) at java.lang.reflect.Constructor.newInstance(Constructor.java:423)`

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1735/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1743,https://api.github.com/repos/apache/incubator-uniffle/issues/1743,incubator-uniffle,2320164273,1743,[Bug] Add exception handling for thread pools,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-05-28T05:38:04Z,2024-05-30T06:50:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Many thread pools in the code do not have exception handling, which swallows exceptions and makes it difficult to locate the problem. We need to add exception handling for them.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1743/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1745,https://api.github.com/repos/apache/incubator-uniffle/issues/1745,incubator-uniffle,2320202043,1745,[Remote Merge] Introduce a common serializer,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-05-28T06:06:41Z,2024-07-17T11:06:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Since merge needs to be performed on the ShuffleServer side, and serialization/deserialization may differ between versions of the compute framework. To avoid server-side processing of different versions of serialization/deserialization, unified serializer that is independent of the computing framework needs to be extracted. 
Two types of serializers are extracted here: (1) Writable (2) Kryo. Writable serialization is used for classes that handle the org.apache.hadoop.io.Writable interface, used in the MR and TEZ frameworks. Kryo can serialize most classes and is generally used in the Spark framework.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/1239

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1745/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1746,https://api.github.com/repos/apache/incubator-uniffle/issues/1746,incubator-uniffle,2320204721,1746,[Remote Merge] Introduce the reader and writer for record,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-05-28T06:08:10Z,2024-07-18T02:29:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Provides abstract methods for processing Records.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/1239

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1746/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1747,https://api.github.com/repos/apache/incubator-uniffle/issues/1747,incubator-uniffle,2320206948,1747,[Remote Merge] Introduce common merger to merge multiple data streams.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-05-28T06:09:28Z,2024-07-22T08:01:50Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Introduce merger to merge multiple data streams according to key. Minimum heap K-way merge sorting is used to merge and sort the data streams that have been partially sorted.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/1239

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1747/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1748,https://api.github.com/repos/apache/incubator-uniffle/issues/1748,incubator-uniffle,2320209319,1748,[Remote Merge] Introduce MergeManager to merge records on the server side.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-05-28T06:10:56Z,2024-08-12T02:23:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Used to merge Records on the server side.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/1239

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1748/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1749,https://api.github.com/repos/apache/incubator-uniffle/issues/1749,incubator-uniffle,2320211554,1749,[Remote Merge] Introduce new reader for reading sorted data.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-05-28T06:12:29Z,2024-09-11T02:46:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Introduce new reader for reading sorted data.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/1239

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1749/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1750,https://api.github.com/repos/apache/incubator-uniffle/issues/1750,incubator-uniffle,2320213420,1750,[Remote Merge] Support different computing frameworks,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-05-28T06:13:48Z,2024-09-29T08:33:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Support different computing frameworks, including MR, TEZ, SPARK.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/1239

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1750/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1751,https://api.github.com/repos/apache/incubator-uniffle/issues/1751,incubator-uniffle,2320621662,1751,[Improvement] Support gluten in the master branch ,xianjingfeng,11752250,,,CLOSED,2024-05-28T09:50:37Z,2024-07-04T02:25:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, gluten will fail to compile using client from the master branch of uniffle.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1751/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1751,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_PoRo,incubator-uniffle,2134803560,1751,NA,xianjingfeng,11752250,,,NA,2024-05-28T09:51:13Z,2024-05-28T09:51:13Z,@summaryzb @zuston @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM5_PoRo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1755,https://api.github.com/repos/apache/incubator-uniffle/issues/1755,incubator-uniffle,2324549426,1755,[Bug] Task that encounters inconsistent data records number fast fail,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-05-30T02:15:24Z,2024-08-16T08:15:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When using the latest master branch code into production env, I found some tasks failed due to the consistent record number. 

After digging this,  I think this is caused by the #1670

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1755/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1755,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IrSUB,incubator-uniffle,2293048577,1755,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-08-16T08:15:50Z,2024-08-16T08:15:50Z,"#1670 is not merged to branch-0.9, remove this from 0.9.1 milestone.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IrSUB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1757,https://api.github.com/repos/apache/incubator-uniffle/issues/1757,incubator-uniffle,2324837167,1757,[FEATURE] Add block counter check in server side,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-05-30T06:41:02Z,2024-06-18T13:26:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

As described on title

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1757/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1764,https://api.github.com/repos/apache/incubator-uniffle/issues/1764,incubator-uniffle,2332818198,1764,[Bug] Unregister shuffles timeout unit mismatch,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-06-04T07:55:29Z,2024-06-04T08:53:19Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The default timeout for unregister calls is 10 seconds, but the value of `10` is considered milliseconds, so requests get interrupted prematurely.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

```logtalk
WARN impl.ShuffleWriteClientImpl: Error happened when unregistering to ShuffleServerInfo{host[10.109.9.45], grpc port[19999]}
io.grpc.StatusRuntimeException: CANCELLED: Thread interrupted
        at io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCalls.java:268)
        at io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:249)
        at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:167)
        at org.apache.uniffle.proto.ShuffleServerGrpc$ShuffleServerBlockingStub.unregisterShuffleByAppId(ShuffleServerGrpc.java:772)
        at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.doUnregisterShuffleByAppId(ShuffleServerGrpcClient.java:345)
        at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.unregisterShuffleByAppId(ShuffleServerGrpcClient.java:352)
        at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.lambda$unregisterShuffle$28(ShuffleWriteClientImpl.java:1020)
        at org.apache.uniffle.common.util.ThreadUtils.lambda$executeTasks$0(ThreadUtils.java:110)
        at java.base/java.util.concurrent.FutureTask.run(Unknown Source)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
        at java.base/java.lang.Thread.run(Unknown Source)
Caused by: java.lang.InterruptedException
        at io.grpc.stub.ClientCalls$ThreadlessExecutor.throwIfInterrupted(ClientCalls.java:750)
        at io.grpc.stub.ClientCalls$ThreadlessExecutor.waitAndDrain(ClientCalls.java:718)
        at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:159)
        ... 9 more
```


### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1764/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1765,https://api.github.com/repos/apache/incubator-uniffle/issues/1765,incubator-uniffle,2332829299,1765,[Improvement] Improve shuffle unregister timeouts,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-06-04T08:01:00Z,2024-06-12T05:52:37Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

A timeout can be configured in Spark for unregistering shuffles called `spark.rss.client.unregister.request.timeout.sec`. However, this timeout applies to all requests executed concurrently. Given a small thread pool size and many servers, the effective timeout for individual requests becomes a fraction of this.

### How should we improve?

The request timeout should be used for individual requests only, an overall timeout should be configurable, and the impact of the thread pool size should be highlighted.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1765/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1767,https://api.github.com/repos/apache/incubator-uniffle/issues/1767,incubator-uniffle,2336091371,1767,[FEATURE] The client-side supports choosing Netty's ByteBufAllocator,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-05T14:31:32Z,2024-06-11T07:57:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Currently, the client-side does not support choosing between `PooledByteBufAllocator` and `UnpooledByteBufAllocator`, which lacks flexibility. We should provide this option.

### Motivation

The `PooledByteBufAllocator` may occupy the memory of the Executors for an extended period, making it unsuitable for some users' scenarios(e.g. users only have limited resources, executors with very small memory, maybe less than 1g). In such cases, users may want to switch to `UnpooledByteBufAllocator`.

### Describe the solution

Add a client config: `rss.client.netty.client.pooled.allocator.enabled` to decide whether to enable `PooledByteBufAllocator`.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1767/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1769,https://api.github.com/repos/apache/incubator-uniffle/issues/1769,incubator-uniffle,2340485138,1769,[Bug] A more elegant way to delete files is needed,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-06-07T13:37:28Z,2024-06-12T06:15:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

We need a more elegant way to delete files, rather than deleting them from the local disk first and then from the hdfs every time.

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[2024-06-07 21:33:45.064] [checkResource-0] [WARN] ShuffleTaskManager.preAllocatedBufferCheck - Remove expired preAllocatedBuffer[id=8311808] that required by app: application_1703049085550_12962744_1717766212505
[2024-06-07 21:33:45.064] [expiredAppCleaner-0] [INFO] ShuffleTaskManager.checkResourceStatus - Detect expired appId[application_1703049085550_12962744_1717766212505] according to rss.server.app.expired.withoutHeartbeat
[2024-06-07 21:33:45.065] [clearResourceThread] [INFO] ShuffleTaskManager.removeResources - Start remove resource for appId[application_1703049085550_12962744_1717766212505]
[2024-06-07 21:33:45.268] [clearResourceThread] [INFO] HybridStorageManager.removeResources - Start to remove resource of AppPurgeEvent{appId='application_1703049085550_12962744_1717766212505', user='aaa', shuffleIds=[0]}
[2024-06-07 21:33:45.269] [clearResourceThread] [INFO] LocalStorageManager.cleanupStorageSelectionCache - Cleaning the storage selection cache costs: 1(ms) for event: AppPurgeEvent{appId='application_1703049085550_12962744_1717766212505', user='aaa', shuffleIds=[0]}
[2024-06-07 21:33:45.269] [clearResourceThread] [INFO] LocalStorage.removeResources - Start to remove resource of application_1703049085550_12962744_1717766212505/0
[2024-06-07 21:33:45.269] [clearResourceThread] [INFO] LocalStorage.removeResources - Finish remove resource of application_1703049085550_12962744_1717766212505/0, disk size is 0 and 0 shuffle metadata
[2024-06-07 21:33:54.505] [clearResourceThread] [INFO] LocalFileDeleteHandler.delete - Delete shuffle data for appId[application_1703049085550_12962744_1717766212505] with /data1/rssdata/application_1703049085550_12962744_1717766212505 cost 9236 ms
[2024-06-07 21:33:54.505] [clearResourceThread] [INFO] HadoopShuffleDeleteHandler.delete - Try delete shuffle data in Hadoop FS for appId[application_1703049085550_12962744_1717766212505] of user[aaa] with hdfs://xxx/rss/online/application_1703049085550_12962744_1717766212505
[2024-06-07 21:33:54.600] [clearResourceThread] [WARN] HadoopShuffleDeleteHandler.delete - Can't delete shuffle data for appId[application_1703049085550_12962744_1717766212505] with 1 times
java.io.FileNotFoundException: File hdfs://xxx/rss/online/application_1703049085550_12962744_1717766212505 does not exist.
        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatusInternal(DistributedFileSystem.java:993)
        at org.apache.hadoop.hdfs.DistributedFileSystem.access$800(DistributedFileSystem.java:120)
        at org.apache.hadoop.hdfs.DistributedFileSystem$24.doCall(DistributedFileSystem.java:1053)
        at org.apache.hadoop.hdfs.DistributedFileSystem$24.doCall(DistributedFileSystem.java:1050)
        at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)
        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatus(DistributedFileSystem.java:1060)
        at org.apache.uniffle.storage.handler.impl.HadoopShuffleDeleteHandler.delete(HadoopShuffleDeleteHandler.java:101)
        at org.apache.uniffle.storage.handler.impl.HadoopShuffleDeleteHandler.delete(HadoopShuffleDeleteHandler.java:61)
        at org.apache.uniffle.server.storage.HadoopStorageManager.removeResources(HadoopStorageManager.java:125)
        at org.apache.uniffle.server.storage.HybridStorageManager.removeResources(HybridStorageManager.java:162)
        at org.apache.uniffle.server.ShuffleTaskManager.removeResources(ShuffleTaskManager.java:775)
        at org.apache.uniffle.server.ShuffleTaskManager.lambda$new$0(ShuffleTaskManager.java:183)
        at java.lang.Thread.run(Thread.java:750)
[2024-06-07 21:33:55.636] [clearResourceThread] [WARN] HadoopShuffleDeleteHandler.delete - Can't delete shuffle data for appId[application_1703049085550_12962744_1717766212505] with 2 times
java.io.FileNotFoundException: File hdfs://xxx/rss/online/application_1703049085550_12962744_1717766212505 does not exist.
        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatusInternal(DistributedFileSystem.java:993)
        at org.apache.hadoop.hdfs.DistributedFileSystem.access$800(DistributedFileSystem.java:120)
        at org.apache.hadoop.hdfs.DistributedFileSystem$24.doCall(DistributedFileSystem.java:1053)
        at org.apache.hadoop.hdfs.DistributedFileSystem$24.doCall(DistributedFileSystem.java:1050)
        at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)
        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatus(DistributedFileSystem.java:1060)
        at org.apache.uniffle.storage.handler.impl.HadoopShuffleDeleteHandler.delete(HadoopShuffleDeleteHandler.java:101)
        at org.apache.uniffle.storage.handler.impl.HadoopShuffleDeleteHandler.delete(HadoopShuffleDeleteHandler.java:61)
        at org.apache.uniffle.server.storage.HadoopStorageManager.removeResources(HadoopStorageManager.java:125)
        at org.apache.uniffle.server.storage.HybridStorageManager.removeResources(HybridStorageManager.java:162)
        at org.apache.uniffle.server.ShuffleTaskManager.removeResources(ShuffleTaskManager.java:775)
        at org.apache.uniffle.server.ShuffleTaskManager.lambda$new$0(ShuffleTaskManager.java:183)
        at java.lang.Thread.run(Thread.java:750)
[2024-06-07 21:33:56.672] [clearResourceThread] [WARN] HadoopShuffleDeleteHandler.delete - Can't delete shuffle data for appId[application_1703049085550_12962744_1717766212505] with 3 times
java.io.FileNotFoundException: File hdfs://xxx/rss/online/application_1703049085550_12962744_1717766212505 does not exist.
        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatusInternal(DistributedFileSystem.java:993)
        at org.apache.hadoop.hdfs.DistributedFileSystem.access$800(DistributedFileSystem.java:120)
        at org.apache.hadoop.hdfs.DistributedFileSystem$24.doCall(DistributedFileSystem.java:1053)
        at org.apache.hadoop.hdfs.DistributedFileSystem$24.doCall(DistributedFileSystem.java:1050)
        at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)
        at org.apache.hadoop.hdfs.DistributedFileSystem.listStatus(DistributedFileSystem.java:1060)
        at org.apache.uniffle.storage.handler.impl.HadoopShuffleDeleteHandler.delete(HadoopShuffleDeleteHandler.java:101)
        at org.apache.uniffle.storage.handler.impl.HadoopShuffleDeleteHandler.delete(HadoopShuffleDeleteHandler.java:61)
        at org.apache.uniffle.server.storage.HadoopStorageManager.removeResources(HadoopStorageManager.java:125)
        at org.apache.uniffle.server.storage.HybridStorageManager.removeResources(HybridStorageManager.java:162)
        at org.apache.uniffle.server.ShuffleTaskManager.removeResources(ShuffleTaskManager.java:775)
        at org.apache.uniffle.server.ShuffleTaskManager.lambda$new$0(ShuffleTaskManager.java:183)
        at java.lang.Thread.run(Thread.java:750)
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1769/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1769,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Amldq,incubator-uniffle,2157598570,1769,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-06-10T07:57:39Z,2024-06-10T07:57:39Z,Can you elaborate on the issue a bite more please? What is the current behaviour and what is not elegant about it.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Amldq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1769,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6AugvC,incubator-uniffle,2159676354,1769,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-11T02:54:16Z,2024-06-11T02:54:16Z,"When cleaning expired resources, no matter it is an HDFS file or a normal disk file, we always do the following things in `HybridStorageManager.removeResources`, that's why en exception is thrown:

```
public void removeResources(PurgeEvent event) {
  LOG.info(""Start to remove resource of {}"", event);
  warmStorageManager.removeResources(event);
  coldStorageManager.removeResources(event);
}
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6AugvC/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1769,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6A33jb,incubator-uniffle,2162129115,1769,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-06-12T05:22:14Z,2024-06-12T05:22:14Z,You are saying we should not attempt to delete from any storage if the data is not stored there? This means we need to keep track where the data reside.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6A33jb/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1769,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6A4FmJ,incubator-uniffle,2162186633,1769,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-12T06:15:21Z,2024-06-12T06:15:21Z,"Yeah, it's better this way, so we can reduce a lot of meaningless warn logs.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6A4FmJ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1770,https://api.github.com/repos/apache/incubator-uniffle/issues/1770,incubator-uniffle,2345303566,1770,[Improvement] Increase the IHOP value to avoid frequent garbage collection,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-11T03:30:00Z,2024-06-11T13:03:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Uniffle servers could cache a large amount of data in heap memory, it means that the usage rate of heap memory may be high. To avoid frequent garbage collection, the IHOP (InitiatingHeapOccupancyPercent) value can be appropriately increased.

The default value is 45%, we currently set it to 20% which is too low. We should set it to 60% ~ 70%.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1770/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1773,https://api.github.com/repos/apache/incubator-uniffle/issues/1773,incubator-uniffle,2345545528,1773,[Improvement] Reduce the chunkSize of gRPC Netty's PooledByteBufAllocator to reduce memory usage,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-11T06:49:42Z,2024-06-13T10:02:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In Netty mode, we should reduce the chunkSize of the gRPC Netty's PooledByteBufAllocator to reduce memory usage.

Since gRPC is no longer used for data transmission when Netty is enabled, the default chunkSize should not be used anymore, as it would waste memory. The current default chunkSize is 2MB (gRPC overwrites it by default).

### How should we improve?

Tasks need to be done:

- https://github.com/apache/incubator-uniffle/pull/1775
- https://github.com/apache/incubator-uniffle/pull/1780

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1773/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1774,https://api.github.com/repos/apache/incubator-uniffle/issues/1774,incubator-uniffle,2345674456,1774,[Bug] rss.rpc.client.type.grpc.timeout does not work as expected,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-11T07:56:17Z,2024-08-02T06:19:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

See https://github.com/apache/incubator-uniffle/pull/1017#issuecomment-2160035077

Maybe we can use `rss.client.rpc.timeout.ms` to replace it.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1774/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1774,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Av613,incubator-uniffle,2160045431,1774,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-11T07:56:56Z,2024-06-11T07:56:56Z,It requires a certain amount of refactoring work. Anyone is welcome to pick it up.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Av613/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1774,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6G-8EH,incubator-uniffle,2264645895,1774,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-08-02T06:19:38Z,2024-08-02T06:19:38Z,Duplicated issue https://github.com/apache/incubator-uniffle/issues/2003. Closed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6G-8EH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1778,https://api.github.com/repos/apache/incubator-uniffle/issues/1778,incubator-uniffle,2348828141,1778,[Improvement] Dashboard adds the ability to automatically format code.,yl09099,33595968,,,CLOSED,2024-06-12T13:47:39Z,2024-06-15T16:19:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Front-end code needs to add automatic formatting code functions for JS, Vue, etc.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1778/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1781,https://api.github.com/repos/apache/incubator-uniffle/issues/1781,incubator-uniffle,2350047907,1781,[Flaky Test] Flaky Test for ShuffleServerGrpcTest ,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-06-13T03:11:11Z,2024-06-25T17:36:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.uniffle.test.ShuffleServerGrpcTest
Error:  Tests run: 7, Failures: 1, Errors: 0, Skipped: 1, Time elapsed: 20.245 s <<< FAILURE! - in org.apache.uniffle.test.ShuffleServerGrpcTest
Error:  shuffleResultTest  Time elapsed: 12.044 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: Exception should be thrown
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:39)
	at org.junit.jupiter.api.Assertions.fail(Assertions.java:134)
	at org.apache.uniffle.test.ShuffleServerGrpcTest.shuffleResultTest(ShuffleServerGrpcTest.java:422)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```


### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/9492933751/job/26160864876?pr=1780

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1781/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1782,https://api.github.com/repos/apache/incubator-uniffle/issues/1782,incubator-uniffle,2350051394,1782,[Bug] ConcurrentModificationException is thrown when calling Roaring64NavigableMap.getLongCardinality,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-13T03:15:03Z,2025-01-04T06:06:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

https://github.com/apache/incubator-uniffle/actions/runs/9381222136/job/25830065788?pr=1763



### Affects Version(s)

master

### Uniffle Server Log Output

```
[INFO] Running org.apache.uniffle.server.buffer.ShuffleBufferManagerTest
Error:  Tests run: 13, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 6.347 s <<< FAILURE! - in org.apache.uniffle.server.buffer.ShuffleBufferManagerTest
Error:  bufferSizeTest  Time elapsed: 0.646 s  <<< ERROR!
java.util.ConcurrentModificationException
	at java.util.TreeMap$NavigableSubMap$SubMapIterator.nextEntry(TreeMap.java:1703)
	at java.util.TreeMap$NavigableSubMap$SubMapEntryIterator.next(TreeMap.java:1751)
	at java.util.TreeMap$NavigableSubMap$SubMapEntryIterator.next(TreeMap.java:1745)
	at org.roaringbitmap.longlong.Roaring64NavigableMap.ensureCumulatives(Roaring64NavigableMap.java:553)
	at org.roaringbitmap.longlong.Roaring64NavigableMap.getLongCardinality(Roaring64NavigableMap.java:278)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.waitForFlush(ShuffleBufferManagerTest.java:637)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.bufferSizeTest(ShuffleBufferManagerTest.java:450)
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1782/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1782,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LLRJ5,incubator-uniffle,2334986873,1782,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-07T01:24:42Z,2024-09-07T01:24:42Z,"@rickyma After thinking about this issue and study `Roaring64NavigableMap`, I found that `Roaring64NavigableMap` is not thread-safe.

I decreased the sleep time and increased the retry max count to increase the race condition change like following changes.

```
 private void waitForFlush(
      ShuffleFlushManager shuffleFlushManager,
      String appId,
      int shuffleId,
      int expectedBlockNum,
      long expectedUsedMemory)
      throws Exception {
    int retry = 0;
    long committedCount = 0;
    do {
      committedCount =
          shuffleFlushManager.getCommittedBlockIds(appId, shuffleId).getLongCardinality();
      if (committedCount < expectedBlockNum) {
        Thread.sleep(5);
      }
      retry++;
      if (retry > 1000) {
        fail(""Flush data time out"");
      }
    } while (committedCount < expectedBlockNum);

    // Need to wait for `event.doCleanup` to be executed
    // to ensure the correctness of subsequent checks of
    // `shuffleBufferManager.getUsedMemory()` and `shuffleBufferManager.getInFlushSize()`.
    Awaitility.await()
        .atMost(Duration.ofSeconds(5))
        .until(() -> shuffleBufferManager.getUsedMemory() == expectedUsedMemory);
  }
```

I encountered `ConcurrentModificationException`, `ArrayIndexOutOfBoundsException` and `AssertError` after 20 or more time executed test.

```
java.lang.ArrayIndexOutOfBoundsException: 3

	at org.roaringbitmap.longlong.Roaring64NavigableMap.getLongCardinality(Roaring64NavigableMap.java:286)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.waitForFlush(ShuffleBufferManagerTest.java:657)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.bufferSizeTest(ShuffleBufferManagerTest.java:451)
```

<img width=""1556"" alt=""image"" src=""https://github.com/user-attachments/assets/e0395635-7c5f-4e8b-9b56-241863fbe415"">

```
java.lang.AssertionError: Computed 1 differs from dummy binary-search index: -1

	at org.roaringbitmap.longlong.Roaring64NavigableMap.ensureOne(Roaring64NavigableMap.java:642)
	at org.roaringbitmap.longlong.Roaring64NavigableMap.ensureCumulatives(Roaring64NavigableMap.java:567)
	at org.roaringbitmap.longlong.Roaring64NavigableMap.getLongCardinality(Roaring64NavigableMap.java:278)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.waitForFlush(ShuffleBufferManagerTest.java:664)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.waitForFlush(ShuffleBufferManagerTest.java:648)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.bufferSizeTest(ShuffleBufferManagerTest.java:443)
```

```
[2024-09-07 09:50:26.752] [main] [ERROR] ShuffleBufferManagerTest.waitForFlush - Ignored exception.
java.util.ConcurrentModificationException
	at java.util.TreeMap$NavigableSubMap$SubMapIterator.nextEntry(TreeMap.java:1703)
	at java.util.TreeMap$NavigableSubMap$SubMapEntryIterator.next(TreeMap.java:1751)
	at java.util.TreeMap$NavigableSubMap$SubMapEntryIterator.next(TreeMap.java:1745)
	at org.roaringbitmap.longlong.Roaring64NavigableMap.ensureCumulatives(Roaring64NavigableMap.java:553)
	at org.roaringbitmap.longlong.Roaring64NavigableMap.getLongCardinality(Roaring64NavigableMap.java:278)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.waitForFlush(ShuffleBufferManagerTest.java:664)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.bufferSizeTest(ShuffleBufferManagerTest.java:456)
```

In conclusion, I suggest to use lock or clone to avoid race condition, and we can use try catch to ignore this kind exception for testing.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LLRJ5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1782,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LRWYH,incubator-uniffle,2336581127,1782,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-09-08T07:32:53Z,2024-09-08T07:32:53Z,"> I suggest to use lock or clone to avoid race condition

Seems fine.

> we can use try catch to ignore this kind exception for testing

I think this is more of a hack than a fix.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LRWYH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1782,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LS527,incubator-uniffle,2336988603,1782,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-09T02:26:46Z,2024-09-09T02:26:46Z,"> I think this is more of a hack than a fix.

I'm not sure how many days and how difficult to solve this issue. As it is for testing purpose, do you think a fail and retry could be a simple way to make the test passed?

As motioned, the `Roaring64NavigableMap` is not `thread-safe`, and it is not worth to add lock for production code only to make `test code` avoid race.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LS527/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1782,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LTD68,incubator-uniffle,2337029820,1782,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-09-09T03:15:33Z,2024-09-09T03:15:33Z,"You can refactor the test cases, or maybe just disable the tests.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LTD68/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1784,https://api.github.com/repos/apache/incubator-uniffle/issues/1784,incubator-uniffle,2350633956,1784,[Improvement] Skip retries for absent HDFS app directory to speed up resource removal,xianjingfeng,11752250,,,CLOSED,2024-06-13T09:20:18Z,2024-06-14T02:07:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, if the application directory in HDFS is not exists, it will retry for 5 times and it will affect the speed of removing resources.

### How should we improve?

Do not retry if the application directory in HDFS is not exists

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1784/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1784,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6BDRVU,incubator-uniffle,2165118292,1784,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-13T09:28:37Z,2024-06-13T09:28:37Z,"A better title:
Skip retries for absent HDFS app directory to speed up resource removal","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6BDRVU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1787,https://api.github.com/repos/apache/incubator-uniffle/issues/1787,incubator-uniffle,2352411776,1787,[FEATURE] Independent switch for fetch and write failure of stage retry mechanism,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-06-14T03:27:16Z,2024-06-21T14:29:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Independent switch for fetch and write failure of stage retry mechanism

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1787/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1787,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CG-HY,incubator-uniffle,2182865368,1787,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-21T14:29:12Z,2024-06-21T14:29:12Z,Fixed by https://github.com/apache/incubator-uniffle/pull/1788.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CG-HY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1790,https://api.github.com/repos/apache/incubator-uniffle/issues/1790,incubator-uniffle,2352586456,1790,[FEATURE] Introduce the max stage retry times,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-06-14T06:04:45Z,2024-06-14T06:04:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Introduce the max stage retry times to specify

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1790/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1791,https://api.github.com/repos/apache/incubator-uniffle/issues/1791,incubator-uniffle,2352645136,1791,[FEATURE] Add more request params when getting assignment to track the reassign/stageRetry apps,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-06-14T06:43:20Z,2024-06-21T14:29:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Add more request params when getting assignment to track the reassign/stageRetry apps

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1791/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1794,https://api.github.com/repos/apache/incubator-uniffle/issues/1794,incubator-uniffle,2353011748,1794,[Improvement] Backport SPARK-46506,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-14T10:01:15Z,2024-06-16T05:59:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Backport https://github.com/apache/spark/pull/46506

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1794/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1796,https://api.github.com/repos/apache/incubator-uniffle/issues/1796,incubator-uniffle,2356485794,1796,[Bug] Remaining map output when enable the stage retry on fetch failure,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-06-17T06:22:17Z,2024-06-17T06:22:17Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

We should  Implicitly unregister map output on fetch failure

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1796/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1798,https://api.github.com/repos/apache/incubator-uniffle/issues/1798,incubator-uniffle,2356531463,1798,[Bug] Incorrect stage retry condition for write failure,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-06-17T06:51:29Z,2024-06-17T06:51:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In current codebase, the stage retry condition on write failure is incorrect that will check the failure server report times whether is great than the spark  task max failure. Actually, when reaching the max task failure times, it should always trigger the stage retry, this is not related with the failure server happening number.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1798/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1799,https://api.github.com/repos/apache/incubator-uniffle/issues/1799,incubator-uniffle,2356539039,1799,[FEATURE] rename the rpc reassignShuffleServers to reassignOnStageResubmit,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-06-17T06:55:47Z,2024-06-18T12:59:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

As title described

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1799/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1801,https://api.github.com/repos/apache/incubator-uniffle/issues/1801,incubator-uniffle,2356579373,1801,[Bug] Incorrect stage retry condition for fetch failure,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-06-17T07:19:10Z,2024-06-17T07:19:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In current codebase, the retry will happen when the partitionId's failure reaches the `spark.task.maxFailures`. At the case of no-AQE, this is right. But for AQE, this suppose is wrong.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1801/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1801,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6BfWWg,incubator-uniffle,2172478880,1801,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-06-17T07:19:19Z,2024-06-17T07:19:19Z,Could you help check this? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6BfWWg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1802,https://api.github.com/repos/apache/incubator-uniffle/issues/1802,incubator-uniffle,2356621738,1802,[Improvement] Uniffle should allow sharing Netty's memory pools,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-17T07:38:40Z,2024-06-18T13:08:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

We can reduce the Uniffle client's memory usage, refer to https://issues.apache.org/jira/browse/SPARK-24920.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1802/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1805,https://api.github.com/repos/apache/incubator-uniffle/issues/1805,incubator-uniffle,2358160550,1805,[Improvement] Support Spark 4,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,OPEN,2024-06-17T20:05:39Z,2024-06-19T19:56:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Support Spark 4.

### How should we improve?

This requires the Spark client to compile for Scala 2.13 and work with Spark 4. The Spark 3 client is compatible to Spark 4, but users might hesitate to use the Spark 3 client with Spark 4, so Uniffle should provide a Spark 4 client, which is basically based on Spark 3.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1805/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1807,https://api.github.com/repos/apache/incubator-uniffle/issues/1807,incubator-uniffle,2358765339,1807,[Improvement] avoid repeating judgment special partitionId is huge partition,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2024-06-18T03:03:41Z,2024-06-18T07:49:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The function `isHugePartition` in `ShuffleBufferManager` judges if a specific partitionId is a huge partition multiple times. A more elegant approach is to judge it only once and label this partition as huge.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1807/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1809,https://api.github.com/repos/apache/incubator-uniffle/issues/1809,incubator-uniffle,2359383938,1809,[Bug] Performance issues with the SKIP_LIST shuffle buffer,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-18T09:23:54Z,2024-07-02T07:54:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I've tested https://github.com/apache/incubator-uniffle/pull/1763 and find out performance issues exist.

Only one worker thread is able to work:
```
""epollEventLoopGroup-3-52"" #497 prio=10 os_prio=0 cpu=749.25ms elapsed=57.12s tid=0x0000031f9a19d800 nid=0x345 runnable [0x00007f2c6a4fd000]
   java.lang.Thread.State: RUNNABLE
	at java.util.concurrent.ConcurrentSkipListMap.toList(ConcurrentSkipListMap.java:2391)
	at java.util.concurrent.ConcurrentSkipListMap$Values.toArray(ConcurrentSkipListMap.java:2503)
	at java.util.LinkedList.addAll(LinkedList.java:408)
	at java.util.LinkedList.addAll(LinkedList.java:387)
	at java.util.LinkedList.<init>(LinkedList.java:119)
	at org.apache.uniffle.server.buffer.ShuffleBufferWithSkipList.getBlocks(ShuffleBufferWithSkipList.java:103)
	at org.apache.uniffle.server.buffer.ShuffleBufferManager.flushSingleBufferIfNecessary(ShuffleBufferManager.java:281)
	at org.apache.uniffle.server.buffer.ShuffleBufferManager.cacheShuffleData(ShuffleBufferManager.java:208)
	- locked <0x00007f2f72092a10> (a org.apache.uniffle.server.buffer.ShuffleBufferManager)
	at org.apache.uniffle.server.ShuffleTaskManager.cacheShuffleData(ShuffleTaskManager.java:311)
	at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.handleSendShuffleDataRequest(ShuffleServerNettyHandler.java:184)
	at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.receive(ShuffleServerNettyHandler.java:82)
	at org.apache.uniffle.common.netty.handle.TransportRequestHandler.handle(TransportRequestHandler.java:62)
	at org.apache.uniffle.common.netty.handle.TransportChannelHandler.channelRead(TransportChannelHandler.java:100)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:289)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at org.apache.uniffle.common.netty.TransportFrameDecoder.channelRead(TransportFrameDecoder.java:81)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:801)
	at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:501)
	at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:399)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:750)
```

Others will get stuck:
```
""epollEventLoopGroup-3-51"" #496 prio=10 os_prio=0 cpu=736.73ms elapsed=57.13s tid=0x0000031f9a19c800 nid=0x344 waiting for monitor entry [0x00007f2c6a5fd000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at org.apache.uniffle.server.buffer.ShuffleBufferManager.cacheShuffleData(ShuffleBufferManager.java:207)
	- waiting to lock <0x00007f2f72092a10> (a org.apache.uniffle.server.buffer.ShuffleBufferManager)
	at org.apache.uniffle.server.ShuffleTaskManager.cacheShuffleData(ShuffleTaskManager.java:311)
	at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.handleSendShuffleDataRequest(ShuffleServerNettyHandler.java:184)
	at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.receive(ShuffleServerNettyHandler.java:82)
	at org.apache.uniffle.common.netty.handle.TransportRequestHandler.handle(TransportRequestHandler.java:62)
	at org.apache.uniffle.common.netty.handle.TransportChannelHandler.channelRead(TransportChannelHandler.java:100)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:289)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at org.apache.uniffle.common.netty.TransportFrameDecoder.channelRead(TransportFrameDecoder.java:81)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:801)
	at io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe$1.run(AbstractEpollChannel.java:425)
	at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)
	at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)
	at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)
	at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:405)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:750)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1809/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1809,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6BrZZe,incubator-uniffle,2175637086,1809,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-18T09:28:26Z,2024-06-18T09:28:26Z,@xianjingfeng PTAL.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6BrZZe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1810,https://api.github.com/repos/apache/incubator-uniffle/issues/1810,incubator-uniffle,2360151161,1810,[Improvement] Unit tests support mocking the ShuffleServerNettyHandler class,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-06-18T15:32:07Z,2024-07-03T02:49:55Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Unit tests support mocking the ShuffleServerNettyHandler class in order to better cover the business code for the netty part.

We can search for `TODO skip validating for GRPC_NETTY, needs to mock ShuffleServerNettyHandler` in our codes.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1810/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1810,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CgZF2,incubator-uniffle,2189529462,1810,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-25T17:21:04Z,2024-06-25T17:21:04Z,This is really important in Netty mode. Anyone is welcome to pick this up.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CgZF2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1810,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DUJNz,incubator-uniffle,2203095923,1810,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-02T12:58:56Z,2024-07-02T12:58:56Z,"> This is really important in Netty mode. Anyone is welcome to pick this up.

When running in prod, we currently use Netty mode due to https://github.com/apache/incubator-uniffle/issues/1651, so this issue is very important. Because we lack the ability to test Netty business codes using UTs. If you are interested, I can assign this issue to you. That will be of great help.

@maobaolong ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DUJNz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1810,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DbGTS,incubator-uniffle,2204918994,1810,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-07-03T02:20:26Z,2024-07-03T02:20:26Z,"@rickyma Will take a look at this issue, thank you!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DbGTS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1811,https://api.github.com/repos/apache/incubator-uniffle/issues/1811,incubator-uniffle,2361758282,1811,[Improvement] Print received Netty ByteBuf readable bytes in clients,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-19T08:46:26Z,2024-06-21T08:47:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

To achieve more detailed log information.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1811/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1816,https://api.github.com/repos/apache/incubator-uniffle/issues/1816,incubator-uniffle,2365658906,1816,[Bug]  Failed to read data using netty,dingshun3016,21172339,,,OPEN,2024-06-21T03:53:09Z,2024-06-21T14:31:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When using Netty to read data, the server index file does not exist, and the client still reads the shuffle data.

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[2024-06-20 02:36:35,167] [INFO] [HadoopFlushEventThreadPool-46] [HadoopShuffleWriteHandler] [initialize] >>> User: u_yth, Path: hdfs://xxx/user/uniffle/gd17-02/shuffle_data/application_1718442507784_2497395_-779157490-31930/0/176-176
[2024-06-20 02:36:38,945] [DEBUG] [HadoopFlushEventThreadPool-46] [DefaultFlushEventHandler] [handleEventAndUpdateMetrics] >>> Flush event:ShuffleDataFlushEvent: eventId=8443984, appId=application_1718442507784_2497395_-779157490-31930, shuffleId=0, startPartition=176, endPartition=176, retryTimes=0, underStorage=HadoopStorage, isPended=false, ownedByHugePartition=false successfully in 3779 ms and release 1073814556 bytes
[2024-06-20 02:38:03,727] [INFO] [nioEventLoopGroup-3-260] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1718442507784_2497395_-779157490-31930], shuffleId[0], partitionId[176]. Took 15 ms and retrieved 12291274 bytes of data
[2024-06-20 02:38:03,877] [INFO] [nioEventLoopGroup-3-259] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1718442507784_2497395_-779157490-31930], shuffleId[0], partitionId[176]. Took 0 ms and retrieved 0 bytes of data
[2024-06-20 02:38:03,880] [WARN] [nioEventLoopGroup-3-259] [ShuffleServerNettyHandler] [handleGetLocalShuffleIndexRequest] >>> Index file for appId[application_1718442507784_2497395_-779157490-31930], shuffleId[0], partitionId[176] is not found, maybe the data has been flushed to cold storage.
org.apache.uniffle.common.exception.FileNotFoundException: No such data in current storage manager.
        at org.apache.uniffle.server.ShuffleTaskManager.getShuffleIndex(ShuffleTaskManager.java:841) ~[shuffle-server-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.handleGetLocalShuffleIndexRequest(ShuffleServerNettyHandler.java:360) [shuffle-server-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.receive(ShuffleServerNettyHandler.java:85) [shuffle-server-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at org.apache.uniffle.common.netty.handle.TransportRequestHandler.handle(TransportRequestHandler.java:62) [rss-common-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at org.apache.uniffle.common.netty.handle.TransportChannelHandler.channelRead(TransportChannelHandler.java:100) [rss-common-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:289) [netty-handler-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at org.apache.uniffle.common.netty.TransportFrameDecoder.channelRead(TransportFrameDecoder.java:80) [rss-common-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) [netty-common-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) [netty-common-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-common-4.1.109.Final.jar:4.1.109.Final]
        at java.base/java.lang.Thread.run(Thread.java:833) [?:?]
[2024-06-20 02:38:38,922] [INFO] [nioEventLoopGroup-3-265] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1718442507784_2497395_-779157490-31930], shuffleId[0], partitionId[176]. Took 25 ms and retrieved 12291274 bytes of data
[2024-06-20 02:38:39,267] [INFO] [nioEventLoopGroup-3-266] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1718442507784_2497395_-779157490-31930], shuffleId[0], partitionId[176]. Took 0 ms and retrieved 0 bytes of data
[2024-06-20 02:38:39,270] [WARN] [nioEventLoopGroup-3-266] [ShuffleServerNettyHandler] [handleGetLocalShuffleIndexRequest] >>> Index file for appId[application_1718442507784_2497395_-779157490-31930], shuffleId[0], partitionId[176] is not found, maybe the data has been flushed to cold storage.
org.apache.uniffle.common.exception.FileNotFoundException: No such data in current storage manager.
        at org.apache.uniffle.server.ShuffleTaskManager.getShuffleIndex(ShuffleTaskManager.java:841) ~[shuffle-server-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.handleGetLocalShuffleIndexRequest(ShuffleServerNettyHandler.java:360) [shuffle-server-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.receive(ShuffleServerNettyHandler.java:85) [shuffle-server-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at org.apache.uniffle.common.netty.handle.TransportRequestHandler.handle(TransportRequestHandler.java:62) [rss-common-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at org.apache.uniffle.common.netty.handle.TransportChannelHandler.channelRead(TransportChannelHandler.java:100) [rss-common-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:289) [netty-handler-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at org.apache.uniffle.common.netty.TransportFrameDecoder.channelRead(TransportFrameDecoder.java:80) [rss-common-0.10.0-SNAPSHOT.jar:0.10.0-SNAPSHOT]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562) [netty-transport-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) [netty-common-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) [netty-common-4.1.109.Final.jar:4.1.109.Final]
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-common-4.1.109.Final.jar:4.1.109.Final]
        at java.base/java.lang.Thread.run(Thread.java:833) [?:?]
```


### Uniffle Engine Log Output

```logtalk
24/06/20 02:38:03 INFO [Executor task launch worker for task 9577] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from xxx:49999 for appId[application_1718442507784_2497395_-779157490-31930], shuffleId[0], partitionId[176], lastBlockId[1476402704] cost 1 ms
24/06/20 02:38:03 INFO [Executor task launch worker for task 9577] ShuffleServerGrpcNettyClient: GetShuffleIndex from xxx:49999 for appId[application_1718442507784_2497395_-779157490-31930], shuffleId[0], partitionId[176 cost 1 ms
24/06/20 02:38:03 INFO [Executor task launch worker for task 9577] RssShuffleManager: Mark the task: 9577_0 failed.



24/06/20 02:38:03 ERROR [Executor task launch worker for task 9577] Executor: Exception in task 176.0 in stage 14.0 (TID 9577)
org.apache.uniffle.common.exception.RssFetchFailedException: Failed to read shuffle data from WARM handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:124)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:134)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:308)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:216)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:312)
	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:458)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage13.sort_addToSorter_0$(Unknown Source)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage13.processNext(Unknown Source)
	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:47)
	at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:729)
	at org.apache.spark.sql.execution.RowIteratorFromScala.advanceNext(RowIterator.scala:83)
	at org.apache.spark.sql.execution.joins.SortMergeJoinScanner.advancedStreamed(SortMergeJoinExec.scala:837)
	at org.apache.spark.sql.execution.joins.SortMergeJoinScanner.findNextOuterJoinRows(SortMergeJoinExec.scala:794)
	at org.apache.spark.sql.execution.joins.OneSideOuterIterator.advanceStream(SortMergeJoinExec.scala:1033)
	at org.apache.spark.sql.execution.joins.OneSideOuterIterator.advanceNext(SortMergeJoinExec.scala:1069)
	at org.apache.spark.sql.execution.RowIteratorToScala.hasNext(RowIterator.scala:68)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage15.processNext(Unknown Source)
	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:47)
	at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:729)
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:458)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage17.agg_doAggregateWithKeys_0$(Unknown Source)
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage17.processNext(Unknown Source)
	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:47)
	at org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:729)
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:458)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.writeImpl(RssShuffleWriter.java:291)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:272)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)
	at org.apache.spark.scheduler.Task.run(Task.scala:135)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$runWithUgi$3(Executor.scala:462)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1381)
	at org.apache.spark.executor.Executor$TaskRunner.runWithUgi(Executor.scala:465)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:394)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.uniffle.common.exception.RssException: Read index data under flow
	at org.apache.uniffle.common.segment.LocalOrderSegmentSplitter.split(LocalOrderSegmentSplitter.java:144)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:80)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113)
	... 40 more
Caused by: java.nio.BufferUnderflowException
	at java.nio.Buffer.nextGetIndex(Buffer.java:506)
	at java.nio.DirectByteBuffer.getLong(DirectByteBuffer.java:772)
	at org.apache.uniffle.common.segment.LocalOrderSegmentSplitter.split(LocalOrderSegmentSplitter.java:95)
	... 42 more
```


### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1816/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1816,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CDgAH,incubator-uniffle,2181955591,1816,NA,dingshun3016,21172339,,,NA,2024-06-21T03:57:39Z,2024-06-21T03:57:39Z,@rickyma Can you help me take a look?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CDgAH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1816,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CG_Q7,incubator-uniffle,2182870075,1816,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-21T14:31:47Z,2024-06-21T14:31:47Z,I've never encountered this. Do you have any idea? I think you might be familiar with this `BufferUnderflowException` scenario. @zuston ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CG_Q7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1818,https://api.github.com/repos/apache/incubator-uniffle/issues/1818,incubator-uniffle,2366481554,1818,[Bug] RssShuffleDataIterator.cleanup may be called multiple times,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2024-06-21T12:49:14Z,2024-06-25T02:09:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I got an IllegalReferenceCountException when running unit tests locally, which was caused by `RssShuffleDataIterator.cleanup` being called multiple times.

```
[2024-06-21 20:37:15.230] [Executor task launch worker for task 3.0 in stage 1.0 (TID 13)] [ERROR] TaskContextImpl.logError - Error in TaskCompletionListener
io.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1
	at io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:83)
	at io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:148)
	at io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:101)
	at org.apache.uniffle.common.netty.buffer.NettyManagedBuffer.release(NettyManagedBuffer.java:59)
	at org.apache.uniffle.common.ShuffleDataResult.release(ShuffleDataResult.java:112)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.close(ShuffleReadClientImpl.java:332)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.cleanup(RssShuffleDataIterator.java:219)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.lambda$new$0(RssShuffleReader.java:289)
	at scala.Function0.apply$mcV$sp(Function0.scala:39)
	at org.apache.spark.util.CompletionIterator$$anon$1.completion(CompletionIterator.scala:47)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.lambda$new$1(RssShuffleReader.java:313)
	at org.apache.spark.TaskContextImpl.$anonfun$markTaskCompleted$1(TaskContextImpl.scala:124)
	at org.apache.spark.TaskContextImpl.$anonfun$markTaskCompleted$1$adapted(TaskContextImpl.scala:124)
	at org.apache.spark.TaskContextImpl.$anonfun$invokeListeners$1(TaskContextImpl.scala:137)
	at org.apache.spark.TaskContextImpl.$anonfun$invokeListeners$1$adapted(TaskContextImpl.scala:135)
	at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
	at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
	at org.apache.spark.TaskContextImpl.invokeListeners(TaskContextImpl.scala:135)
	at org.apache.spark.TaskContextImpl.markTaskCompleted(TaskContextImpl.scala:124)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at java.base/java.lang.Thread.run(Thread.java:834)
[2024-06-21 20:37:15.234] [Executor task launch worker for task 3.0 in stage 1.0 (TID 13)] [ERROR] Executor.logError - Exception in task 3.0 in stage 1.0 (TID 13)
org.apache.spark.util.TaskCompletionListenerException: refCnt: 0, decrement: 1

Previous exception in task: null
	java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	java.base/java.lang.reflect.Method.invoke(Method.java:566)
	io.netty.util.internal.CleanerJava9.freeDirectBuffer(CleanerJava9.java:88)
	io.netty.util.internal.PlatformDependent.freeDirectBuffer(PlatformDependent.java:521)
	org.apache.uniffle.common.util.RssUtils.releaseByteBuffer(RssUtils.java:422)
	org.apache.uniffle.client.impl.ShuffleReadClientImpl.close(ShuffleReadClientImpl.java:335)
	org.apache.spark.shuffle.reader.RssShuffleDataIterator.cleanup(RssShuffleDataIterator.java:219)
	org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.lambda$new$0(RssShuffleReader.java:289)
	scala.Function0.apply$mcV$sp(Function0.scala:39)
	org.apache.spark.util.CompletionIterator$$anon$1.completion(CompletionIterator.scala:47)
	org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:36)
	org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:324)
	org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
	org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
	org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:180)
	org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
	org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
	org.apache.spark.scheduler.Task.run(Task.scala:131)
	org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)
	org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)
	org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)
	java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	java.base/java.lang.Thread.run(Thread.java:834)
	at org.apache.spark.TaskContextImpl.invokeListeners(TaskContextImpl.scala:145)
	at org.apache.spark.TaskContextImpl.markTaskCompleted(TaskContextImpl.scala:124)
	at org.apache.spark.scheduler.Task.run(Task.scala:141)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:497)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1439)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:500)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at java.base/java.lang.Thread.run(Thread.java:834)
```


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1818/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1820,https://api.github.com/repos/apache/incubator-uniffle/issues/1820,incubator-uniffle,2366538853,1820,[Flaky Test] Flaky test for RSSStageDynamicServerReWriteTest,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-06-21T13:20:29Z,2024-07-30T11:15:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.uniffle.test.GroupByKeyTest
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 29.203 s - in org.apache.uniffle.test.GroupByKeyTest
[INFO] Running org.apache.uniffle.test.RSSStageDynamicServerReWriteTest
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 24.078 s <<< FAILURE! - in org.apache.uniffle.test.RSSStageDynamicServerReWriteTest
Error:  testRSSStageResubmit  Time elapsed: 21.115 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <1000> but was: <979>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:527)
	at org.apache.uniffle.test.SparkIntegrationTestBase.verifyTestResult(SparkIntegrationTestBase.java:146)
	at org.apache.uniffle.test.SparkIntegrationTestBase.run(SparkIntegrationTestBase.java:64)
	at org.apache.uniffle.test.RSSStageDynamicServerReWriteTest.testRSSStageResubmit(RSSStageDynamicServerReWriteTest.java:119)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/9614003714/job/26517944049?pr=1819

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1820/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1820,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Gl-jf,incubator-uniffle,2258102495,1820,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-07-30T11:15:01Z,2024-07-30T11:15:01Z,This test is so bother me ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Gl-jf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1821,https://api.github.com/repos/apache/incubator-uniffle/issues/1821,incubator-uniffle,2366604089,1821,[FEATURE] A more thorough data cleaning mechanism,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-06-21T13:55:23Z,2024-06-21T13:56:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We found that after the server cluster is restarted, the app directories on HDFS may not be cleaned up, which can lead to long-term occupation of disk space. We need a more thorough data cleaning mechanism to make sure data is always cleaned up, without leaks.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1821/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1821,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGvyH,incubator-uniffle,2182806663,1821,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-21T13:56:36Z,2024-06-21T13:56:36Z,@zuston @dingshun3016 @yl09099 @xianjingfeng Have you ever encountered this issue in prod?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6CGvyH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1823,https://api.github.com/repos/apache/incubator-uniffle/issues/1823,incubator-uniffle,2369553039,1823,[Flaky Test] Flaky test for ShuffleBufferManagerTest,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-06-24T08:15:42Z,2024-06-24T08:16:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.uniffle.server.buffer.ShuffleBufferManagerTest
Error:  Tests run: 13, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 3.348 s <<< FAILURE! - in org.apache.uniffle.server.buffer.ShuffleBufferManagerTest
Error:  shuffleFlushThreshold  Time elapsed: 0.021 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <159> but was: <63>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:166)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:161)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:628)
	at org.apache.uniffle.server.buffer.ShuffleBufferManagerTest.shuffleFlushThreshold(ShuffleBufferManagerTest.java:604)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/9638858633/job/26580199686

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1823/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1824,https://api.github.com/repos/apache/incubator-uniffle/issues/1824,incubator-uniffle,2369914686,1824,[FEATURE] Support map side combine of shuffle writer,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2024-06-24T10:51:37Z,2024-06-26T13:22:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support map side combine of shuffle writer

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1824/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1826,https://api.github.com/repos/apache/incubator-uniffle/issues/1826,incubator-uniffle,2370250155,1826,[Bug] Fix build_distribution.sh,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-06-24T13:23:50Z,2024-06-25T06:41:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

1. ~~After https://github.com/apache/incubator-uniffle/pull/1525, we can set options start with `--without`, but I find out they cannot work togethe~~.
2. When running `./build_distribution.sh --hadoop-profile 'hadoop3.2'`, `build_distribution.sh` will still use `hadoop2.8` which is the default value of `HADOOP_PROFILE_ID` to build the project (both server and client). This could be a potential risk when building the project using the `hadoop3.2` profile.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1826/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1828,https://api.github.com/repos/apache/incubator-uniffle/issues/1828,incubator-uniffle,2370408335,1828,[Flaky Test] Flaky test for ContinuousSelectPartitionStrategyTest,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-06-24T14:29:56Z,2024-06-24T14:30:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
[INFO] Running org.apache.uniffle.test.ContinuousSelectPartitionStrategyTest
Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 25.706 s <<< FAILURE! - in org.apache.uniffle.test.ContinuousSelectPartitionStrategyTest
Error:  resultCompareTest  Time elapsed: 22.748 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <63001> but was: <53001>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:527)
	at org.apache.uniffle.test.SparkIntegrationTestBase.verifyTestResult(SparkIntegrationTestBase.java:146)
	at org.apache.uniffle.test.SparkIntegrationTestBase.run(SparkIntegrationTestBase.java:76)
	at org.apache.uniffle.test.ContinuousSelectPartitionStrategyTest.resultCompareTest(ContinuousSelectPartitionStrategyTest.java:168)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)
	at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)
	at org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.util.ArrayList.forEach(ArrayList.java:1259)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)
	at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)
	at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/9646462378/job/26602938213

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1828/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1832,https://api.github.com/repos/apache/incubator-uniffle/issues/1832,incubator-uniffle,2374055149,1832,[Bug] Remove handlers when purging app shuffleIds,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-06-26T02:36:50Z,2024-06-26T03:10:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In current codebase, the write/read handlers are not removed when purging shuffleIds.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1832/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1832,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Cj2Ox,incubator-uniffle,2190435249,1832,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-06-26T02:45:05Z,2024-06-26T02:45:05Z,Will this issue lead to some more serious problems?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Cj2Ox/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1832,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Cj9dp,incubator-uniffle,2190464873,1832,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-06-26T03:10:11Z,2024-06-26T03:10:11Z,"> Will this issue lead to some more serious problems?

Noop. Just remains some unnecessary data, but this is critial for stage retry","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Cj9dp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1833,https://api.github.com/repos/apache/incubator-uniffle/issues/1833,incubator-uniffle,2374059307,1833,[Bug] AddBlockEvent created with stageAttemptNumber,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-06-26T02:41:12Z,2024-06-26T02:41:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In current code, the AddBlockEvent creating process lacks the stageAttemptNumber

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1833/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1834,https://api.github.com/repos/apache/incubator-uniffle/issues/1834,incubator-uniffle,2374094189,1834,[Improvement] Upload failed test logs of GA,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2024-06-26T03:16:33Z,2024-06-27T02:42:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Upload failed test logs of GA

### How should we improve?

Add log4j conf file to test resource and upload failed test logs of GA.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1834/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1836,https://api.github.com/repos/apache/incubator-uniffle/issues/1836,incubator-uniffle,2374509703,1836,[Improvement] Rpc of getting result with stage attempt number to avoid getting outdate blockIds,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-06-26T06:54:04Z,2024-06-26T06:54:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

As described in title

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1836/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1837,https://api.github.com/repos/apache/incubator-uniffle/issues/1837,incubator-uniffle,2374514288,1837,[FEATURE] Introduce the lazy deletion mechanism for stage retry,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-06-26T06:56:37Z,2024-06-26T06:56:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Deleting the disk data costs too much time, let's introduce the lazy deletion for stage retry, it will be composed by 2 steps:
1. rename sync with register with the latest attempt number
2. putting the renamed path into the async deletion queue

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1837/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,incubator-uniffle,2377620400,1840,Rework stage retry,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-06-27T09:19:26Z,2024-07-29T13:28:17Z,"After revisiting the stage retry feature, I found some obvious bugs that were not ready for production use. This issue is to track the design,existing problems and solutions.

# Background and design

Some background and design are included in the previous design doc and github issues.
You can search the github to retrieve them to know more about this feature.

1. https://github.com/apache/incubator-uniffle/issues/477
2. https://docs.google.com/document/d/1OGswqDDQ52rpw5Lat-FpEGDfX1T6EFXYLC7L0G5O4WE/edit?usp=sharing
3. https://github.com/apache/incubator-uniffle/issues/825

The stage retry whole design is based on the Spark's `fetchFailedException` , once spark scheduler accepts this exception thrown from task, it will not schedule the next tasks in this stage and trigger the stage resubmit to run. That means uniffle will use this exception as the way to trigger whatever encountering fetch/write failure.

Leveraging from this mechanism, Uniffle wants to hack this to acheive the stage retry ability to improve the spark jobs stability, especially on the case of shuffle-server shutdown unnormally.

The shuffle task failure could be split into 2 parts: write failure and read(fetch) failure, that should be digged separately and together. Below description will be shown by my understanding correct solution.

All the below design architecture is based on the consensus that we want to keep the spark's original semantic of `shuffleId`.

## Write failure

Once the task failed on the write failure that may be shuffle-server hang or shutdown or network lost..., task will ask shuffle manager whether throwing spark's fetchFailedException. 
At this time, shuffle manager will check whether the task failure reaches the spark max failure threshold. Once this condition is satisfied, this will make task throw and fail.

To avoid the data duplication, the unregister map output tracker related with the shuffleId is necessary.

## Fetch failure

Fetch failure shows the similar logic with the above write failure. 

The special point of fetch failure is that will rerun all the map tasks from the upstream stage, which is different with the spark vanilla shuffle service that only will trigger the maps executed on the broken servers. 

## Write + fetch failure together

Write and fetch failures won't happen at the same time, that's ensured by the spark, that's not pipelined data flow.

For uniffle shuffle manager, the write and fetch failure problem is on the retry condition. But I think the shuffle manager only needs to worry about the reported index of task attempts, whatever the failure type.

# QA
## How to clear previous stage attempt data and reassign

Before answering this question, another question is that do you really need to clear previous stage data. I think this is necessary

1. Current blockId layout's taskAttemptId is not real unique taskId, that means we can't depend this to filter the retry tasks outdate data. (Although in the following QA, I will re-introduce this real task attempt id into blockId layout)
4. Too much data will make client read unnecessary memory data, although the localfile data could be filtered out by the index file. This will bring too much cost
5. Outdate data remains on the shuffle-server that will waste disk/memory space, this is unnessary

Based on the above thought, let's answer the initial question.

The unregister and reassign will occur on the first request that reaches the retry condition with the lock to make other tasks' ask requests to hang.

Once the reassign is finished, shuffle manager will register the next stage attempt shuffle to the reassignment shuffle-servers. At this time, server will accept this request and then to clear out the previous data, including in the memory/disk/hdfs. 

We hope this deletion is quick, but properly not. From my survey, the 200g disk file with 3000 partition costs 40s. this is not accpetable for a grpc request.

So the two phase deletion should be introduced to solve the problem of data visibility and delete speed, that splits the deletion into `rename sync` and `delete async` 2 phases.
This is based on the rename quick speed of disk and hdfs. If having object store, the first phase will not use the rename mechansim, or store some metadata into memory and then to rename. However, there are always ways to solve the OSS storage type.

And in now codebase, the report failure and reassignOnStageRetry is splitted into 2 rpcs, it's necessary to unify them into one.

## How to ensure shuffle data consistency in different stage attempt

Everything looks fine now, but some corner cases are ignored especially on the high-concurrent jobs. 

When deleting previous shuffle data, the another writer or reader may read the same partition data.

For the writer, it's hard to use lock to ensure consistency as it need to ensure write throughput. So in this case, we hope that the partial leak data could be filtered out from the client side by the task attempt id. Based on this, the real unique task attemptId will be introduced here to solve this problem, which may bring some limitation for the huge jobs, but I think this is necessary and worthwhile.

For the reader, the premise of accuracy is to obtain the real blockId bitmap, so locking is required here by stage attempt number check.

# Next step

The current code has some bugs described on the above Q&A, so this is time to create some issues to solve them.

1. Unify the fetch failure + write failure retry checking into the `RssStageResubmitManager`, the checking logic may be different but we could distingush them and use different strategies.
2. RPC merge from 2 rpcs of reportXXFailure and reassignOnStageRetry into reportXXFailure, that include the reassign into one request.
3. Introduce the real unique taskAttemptId into uniffle by the indiviual config option to make client filter out previous stage data correctly
6. Ensure the getting shuffle result safe
7. Some bugs","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1840/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Cyuw0,incubator-uniffle,2194336820,1840,NA,PengleiShi,23723660,levishi,shipenglei24@163.com,NA,2024-06-27T10:29:06Z,2024-06-27T10:29:06Z,"> The stage retry whole design is based on the Spark's fetchFailedException , once spark scheduler accepts this exception thrown from task, it will kill all the running tasks in this stage and trigger the stage resubmit to run.

AFAIK, vanillia spark will not kill any task if FetchFailed occured, new stage attempt will submit missing tasks which are not finished. Does it have same behavior with rss enabled?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Cyuw0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6C5DzB,incubator-uniffle,2195995841,1840,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-06-28T02:30:35Z,2024-06-28T02:30:35Z,"> > The stage retry whole design is based on the Spark's fetchFailedException , once spark scheduler accepts this exception thrown from task, it will kill all the running tasks in this stage and trigger the stage resubmit to run.
> 
> AFAIK, vanillia spark will not kill any task if FetchFailed occured, new stage attempt will submit missing tasks which are not finished. Does it have same behavior with rss enabled?

Good to know this, and I have checked this part that spark will not kill all running tasks. Let me fix this description","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6C5DzB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6C6V2L,incubator-uniffle,2196331915,1840,NA,qqqttt123,148952220,,,NA,2024-06-28T07:43:04Z,2024-06-28T07:43:04Z,"1. Exchange reuse.
2. Map stiil runs after stage finished
3. Limit
4. Stage fail, shuffle will consists of multple attempts.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6C6V2L/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6C6Xnj,incubator-uniffle,2196339171,1840,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-06-28T07:48:01Z,2024-06-28T07:48:01Z,"To ensure the data consistency, I will support the original unique task attempt id in blockId layout for the stage retry to filter out the previous stage data. PTAL @EnricoMi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6C6Xnj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6C6elE,incubator-uniffle,2196367684,1840,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-06-28T08:06:15Z,2024-06-28T08:06:15Z,I don't find out any concept that the limit operator will get the stage attempt 0 + stage attempt 1 data to be as the normal data pipeline. Could you give me some background or spark issues? @jerqi ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6C6elE/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DFsxr,incubator-uniffle,2199309419,1840,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-07-01T06:04:57Z,2024-07-01T06:04:57Z,Could you help review this? @advancedxy I want to go on to finish this feature. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DFsxr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DJTQq,incubator-uniffle,2200253482,1840,NA,advancedxy,807537,,,NA,2024-07-01T14:08:04Z,2024-07-01T14:08:04Z,"> Could you help review this? @advancedxy I want to go on to finish this feature.

Thanks for ping me. I maybe able to review your design and PRs this week. And by the way, I haven't followed how shuffle writer failure triggered a stage recompute, I may be wrong about that.

Some inline comments.
> task will ask shuffle manager whether throwing spark's fetchFailedException.
At this time, shuffle manager will check whether the task failure reaches the spark max failure threshold. Once this condition is satisfied, this will make task throw and fail.

I don’t think this is correct per se? ShuffleWriteFailures should not trigger a`FetchFailedException` from executor side which might mess around Spark's driver logic. The shuffle write stage doesn't involve a shuffle fetch if it's not read from another shuffle stage. I think a more appropriate approach would be that the shuffle writer reports its write failures and the shuffle manager decides whether to retry the whole stage or simply relaunch tasks in the same stage with different shuffler assignments. If it decides to retry the whole stage, it might need to do something hacky to fail the current shuffle write stage  fast and unregister all its map outputs. This logic is similar like how Spark handles its barrier tasks. However, it might be hard to simulate that case from Uniffle's perspective.

> Write and fetch failures won't happen at the same time, that's ensured by the spark, that's not pipelined data flow.

it might be as long as there's one stage that reading from Uniffle's shuffle and writing shuffle data to uniffle too. There's only one instance of exception per task, though.  So I think the shuffle manager should be aware of that when receiving shuffle fetch failures and write failures.

> So the two phase deletion should be introduced to solve the problem of data visibility and delete speed, that splits the deletion into rename sync and delete async 2 phases.

Hmm, we don't encode stage attempt number in the output path? If the stage attempt number is encoded, I think we can just leave the shuffle data as it is and put it into a asyn delete queue if necessary.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DJTQq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DXenh,incubator-uniffle,2203970017,1840,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-07-02T17:54:24Z,2024-07-02T17:54:24Z,"I strongly object to moving back to the original unique task attempt id which limits the number of tasks or partitions, which renders Uniffle unusable in our production environment.

I am happy to discuss alternative approaches like adding the stage attempt no, similar to us adding the task attempt no (#1529), to the block id.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DXenh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DXftn,incubator-uniffle,2203974503,1840,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-07-02T17:57:03Z,2024-07-02T17:57:03Z,Can you elaborate on why the current block id scheme does not work for stage retry given all data of previous stage gets erased?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DXftn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6E9fTm,incubator-uniffle,2230711526,1840,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-07-16T11:59:08Z,2024-07-16T11:59:08Z,"> Can you elaborate on why the current block id scheme does not work for stage retry given all data of previous stage gets erased?

Sorry for the late reply (Pity. I'm busy for my daily work). If the stage retry, the taskAttemptId in the blockId is not unique for the multiple stage retry. Right? ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6E9fTm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6E9gTT,incubator-uniffle,2230715603,1840,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-07-16T12:01:23Z,2024-07-16T12:01:23Z,"> I strongly object to moving back to the original unique task attempt id which limits the number of tasks or partitions, which renders Uniffle unusable in our production environment.我强烈反对回到原来的唯一任务尝试 ID，这会限制任务或分区的数量，从而导致 Uniffle 在我们的生产环境中无法使用。
> 
> I am happy to discuss alternative approaches like adding the stage attempt no, similar to us adding the task attempt no (#1529), to the block id.我很高兴讨论替代方法，例如添加阶段尝试编号，类似于我们将任务尝试编号 ( #1529 ) 添加到块 ID。

Yes. This is the important concern for this feature. So I want to try whether to add the retry attempt number into memory/file prefix or memory data structure indicator","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6E9gTT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1840,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Gdxsv,incubator-uniffle,2255952687,1840,NA,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,NA,2024-07-29T13:28:15Z,2024-07-29T13:28:15Z,"Before retrying a stage, isn't all data deleted of the earlier attempt?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Gdxsv/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1841,https://api.github.com/repos/apache/incubator-uniffle/issues/1841,incubator-uniffle,2379796334,1841,[Improvement] memoryUsed of WriterBuffer should release unused buffer size,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2024-06-28T07:35:27Z,2024-06-28T07:57:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

memoryUsed of WriterBuffer should release unused buffer size

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1841/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1843,https://api.github.com/repos/apache/incubator-uniffle/issues/1843,incubator-uniffle,2379822708,1843,[Improvement] WriterBuffer seems to waste a little memory,wForget,17894939,Zhen Wang,wangzhen@apache.org,OPEN,2024-06-28T07:51:29Z,2024-06-28T07:51:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When adding  record and do not as for memory, we will create a new buffer. The old buffer may have some unused bytes, which wastes some memory.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1843/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1844,https://api.github.com/repos/apache/incubator-uniffle/issues/1844,incubator-uniffle,2381600877,1844,[Bug] fix(spark): Triggering Stage retry requires reassigning the shuffle server in the retry Stage.,yl09099,33595968,,,CLOSED,2024-06-29T09:12:55Z,2024-12-09T07:13:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When the Write task triggers Stage retry, the shuffle server needs to be reassigned after the new Stage is up.

### Affects Version(s)

0.10.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1844/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1847,https://api.github.com/repos/apache/incubator-uniffle/issues/1847,incubator-uniffle,2385022400,1847,[Bug] ShuffleBufferManager#bufferSize equals zero all the time,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-02T01:43:02Z,2024-07-02T11:35:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I'm trying to improve the performance related buffer, so I read the code around buffer. I found the ShuffleBufferManager#bufferSize is used without reassign other non-zero value, is that a bug?

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1847/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1854,https://api.github.com/repos/apache/incubator-uniffle/issues/1854,incubator-uniffle,2386112630,1854,[FEATURE] Support Launch uniffle Process by intellij idea,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-02T12:21:30Z,2024-07-04T15:08:00Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support Launch uniffle Process by intellij idea

### Motivation

- Make it easy to start up servers from newbie.
- Make it fast to restart after one-line-change.

### Describe the solution

Run a bash script to copy intellij launch configuration to the projects work area, so that we can see the launch configuration

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1854/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1856,https://api.github.com/repos/apache/incubator-uniffle/issues/1856,incubator-uniffle,2386188710,1856,[Improvement] Enhance Netty test coverage,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-07-02T12:57:36Z,2024-08-05T08:23:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Add test cases for Netty, as many current UTs only test gRPC codes.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1856/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1856,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6HNNi_,incubator-uniffle,2268387519,1856,NA,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,NA,2024-08-05T07:40:55Z,2024-08-05T07:40:55Z,@rickyma I'd like to work on this. Could you please assign this issue to me?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6HNNi_/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1856,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6HNgk2,incubator-uniffle,2268465462,1856,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-08-05T08:23:12Z,2024-08-05T08:23:12Z,Sure. Please go ahead.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6HNgk2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1858,https://api.github.com/repos/apache/incubator-uniffle/issues/1858,incubator-uniffle,2387615346,1858,[FEATURE] Introduce a fine-grained force commit switch,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-07-03T03:57:41Z,2024-07-09T07:44:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Add a force-commit switch, so even if the memory mode is enabled, we can still force to commit.

When running HDFS on a large scale, to improve stability, we may want to force to commit under all circumstances.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1858/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1860,https://api.github.com/repos/apache/incubator-uniffle/issues/1860,incubator-uniffle,2388919427,1860,[FEATURE] Display the application first successful registration time in Dashboard and UniffleCLI,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-03T15:27:55Z,2024-07-04T07:10:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

`bin/uniffle  client-cli -app -host localhost -port 19998` should display the register time of each application.

Besides, the dashboard should display application register time too.

### Motivation

Helps user to know the application life time.

### Describe the solution

record application register time.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1860/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1863,https://api.github.com/repos/apache/incubator-uniffle/issues/1863,incubator-uniffle,2389861227,1863,[Bug] ShuffleTaskManager.commitShuffle will get stuck forever if an exception occurs during the flush process,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-07-04T03:30:34Z,2024-07-08T03:14:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

![image](https://github.com/apache/incubator-uniffle/assets/13834479/d352306e-97bd-41e3-8475-a68e4168e9ca)


### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
jstack:

""Grpc-1788"" #2073 daemon prio=5 os_prio=0 cpu=1723.11ms elapsed=88729.16s tid=0x00007f3d3c0f1000 nid=0x968 waiting for monitor entry [0x00007f3cf97fe000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at org.apache.uniffle.server.ShuffleTaskManager.commitShuffle(ShuffleTaskManager.java:338)
        - waiting to lock <0x00007f4fbf708e00> (a java.lang.Object)
        at org.apache.uniffle.server.ShuffleServerGrpcService.finishShuffle(ShuffleServerGrpcService.java:468)
        at org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1060)
        at io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        at io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        at io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        at io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:356)
        at io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:861)
        at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:750)

""Grpc-1359"" #1629 daemon prio=5 os_prio=0 cpu=5536.44ms elapsed=88733.96s tid=0x00007f4380185800 nid=0x7ac waiting on condition [0x00007f41156fe000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
        at java.lang.Thread.sleep(Native Method)
        at org.apache.uniffle.server.ShuffleTaskManager.commitShuffle(ShuffleTaskManager.java:360)
        - locked <0x00007f4fbf708e00> (a java.lang.Object)
        at org.apache.uniffle.server.ShuffleServerGrpcService.finishShuffle(ShuffleServerGrpcService.java:468)
        at org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1060)
        at io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        at io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        at io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        at io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:356)
        at io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:861)
        at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:750)	
```

exception log:
```
[2024-07-03 08:54:32.973] [HadoopFlushEventThreadPool-1] [WARN] SingleStorageManager.write - Exception happened when write data for ShuffleDataFlushEvent: eventId=252896, appId=application_1716779728283_6825960_1719966578466, shuffleId=0, startPartition=315, endPartition=315, retryTimes=0, underStorage=HadoopStorage, isPended=false, ownedByHugePartition=false, try again
org.apache.uniffle.common.exception.RssException: java.io.IOException: All datanodes [DatanodeInfoWithStorage[127.0.0.1:9003,DS-3ad04d12-7d78-405f-ba33-d2bb706f073d,DISK]] are bad. Aborting...
        at org.apache.uniffle.storage.handler.impl.HadoopShuffleWriteHandler.write(HadoopShuffleWriteHandler.java:157)
        at org.apache.uniffle.storage.handler.impl.PooledHadoopShuffleWriteHandler.write(PooledHadoopShuffleWriteHandler.java:122)
        at org.apache.uniffle.server.storage.SingleStorageManager.write(SingleStorageManager.java:59)
        at org.apache.uniffle.server.storage.HybridStorageManager.write(HybridStorageManager.java:130)
        at org.apache.uniffle.server.ShuffleFlushManager.processFlushEvent(ShuffleFlushManager.java:165)
        at org.apache.uniffle.server.DefaultFlushEventHandler.handleEventAndUpdateMetrics(DefaultFlushEventHandler.java:97)
        at org.apache.uniffle.server.DefaultFlushEventHandler.lambda$dispatchEvent$0(DefaultFlushEventHandler.java:219)
        at java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1640)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:750)
Caused by: java.io.IOException: All datanodes [DatanodeInfoWithStorage[127.0.0.1:9003,DS-3ad04d12-7d78-405f-ba33-d2bb706f073d,DISK]] are bad. Aborting...
        at org.apache.hadoop.hdfs.DataStreamer.handleBadDatanode(DataStreamer.java:1567)
        at org.apache.hadoop.hdfs.DataStreamer.setupPipelineInternal(DataStreamer.java:1501)
        at org.apache.hadoop.hdfs.DataStreamer.setupPipelineForAppendOrRecovery(DataStreamer.java:1487)
        at org.apache.hadoop.hdfs.DataStreamer.processDatanodeOrExternalError(DataStreamer.java:1262)
        at org.apache.hadoop.hdfs.DataStreamer.run(DataStreamer.java:673)
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1863/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1863,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DssRW,incubator-uniffle,2209530966,1863,NA,sahibamatta,26037835,,,NA,2024-07-04T20:23:08Z,2024-07-04T20:23:08Z,"Hi @rickyma, I'm willing to contribute to it. I can raise a PR if you are ok? Thanks!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6DssRW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1863,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Dthsn,incubator-uniffle,2209749799,1863,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-05T01:04:47Z,2024-07-05T01:04:47Z,Sure. I'll assign this to you. @sahibamatta ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Dthsn/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1863,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6D0GNU,incubator-uniffle,2211472212,1863,NA,sahibamatta,26037835,,,NA,2024-07-05T22:29:31Z,2024-07-05T22:29:31Z,"Hi @rickyma , I've raised a [PR](https://github.com/apache/incubator-uniffle/pull/1866) for it as per my understanding of the issue 😅. For now, it just handles the exception thrown from the `write` method, as per mentioned in the screenshot above. Please let me know if we need to handle other parts of the `processFlushEvent` method as well? Also, feel free to let me know if there’s any gap in my understanding.
Thanks!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6D0GNU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1867,https://api.github.com/repos/apache/incubator-uniffle/issues/1867,incubator-uniffle,2393428646,1867,[feature][dashboard] Shuffle server page list sorting function.,yl09099,33595968,,,CLOSED,2024-07-06T06:06:16Z,2024-07-07T06:02:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

On the Shuffle Server list page, you can sort the Shuffle Server by column to facilitate you to view information about the Shuffle Server.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1867/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1867,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6D3Y3n,incubator-uniffle,2212335079,1867,NA,yl09099,33595968,,,NA,2024-07-07T06:02:07Z,2024-07-07T06:02:07Z,This should be integrated into issue 1401.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6D3Y3n/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1867,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6D3Y4o,incubator-uniffle,2212335144,1867,NA,yl09099,33595968,,,NA,2024-07-07T06:02:25Z,2024-07-07T06:02:25Z,This should be integrated into issue 1401.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6D3Y4o/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1869,https://api.github.com/repos/apache/incubator-uniffle/issues/1869,incubator-uniffle,2393906913,1869,[FEATURE][dashboard] Remove the function of a lost shuffle server.,yl09099,33595968,,,CLOSED,2024-07-07T05:57:49Z,2024-07-07T06:03:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

If some shuffle servers are lost, they need to go offline and the Coordinator has been in the lost state. You need to add the delete function to delete these servers in the memory.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1869/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1869,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6D3Y7C,incubator-uniffle,2212335298,1869,NA,yl09099,33595968,,,NA,2024-07-07T06:03:10Z,2024-07-07T06:03:10Z,This should be integrated into issue 1401.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6D3Y7C/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1872,https://api.github.com/repos/apache/incubator-uniffle/issues/1872,incubator-uniffle,2394324430,1872,[Improvement] Binary Artifact directory name should have Apache branding,pjfanning,11783444,PJ Fanning,,CLOSED,2024-07-08T00:28:04Z,2025-01-08T06:40:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

https://dist.apache.org/repos/dist/dev/incubator/uniffle/0.9.0-rc2/apache-uniffle-0.9.0-incubating-bin.tar.gz

When you extract this, the dir is `rss-0.9.0-hadoop2.8`.
Maybe it should be `apache-uniffle-incubating-rss-0.9.0-hadoop2.8` or something like that.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1872/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1873,https://api.github.com/repos/apache/incubator-uniffle/issues/1873,incubator-uniffle,2394944605,1873,[FEATURE] Add audit log support for write and delete operations,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-07-08T08:07:49Z,2024-07-09T07:43:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

For auditing purposes, the server should support logging audit records for every disk write and delete operation.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1873/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1875,https://api.github.com/repos/apache/incubator-uniffle/issues/1875,incubator-uniffle,2397031045,1875,"[Bug] After the coordinator restarts, the user field will be lost in heartbeat",kuszz,21366445,kqhzz,kuangqinghuazz@163.com,OPEN,2024-07-09T03:34:29Z,2024-07-09T03:34:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

![image](https://github.com/apache/incubator-uniffle/assets/21366445/f69ffa3a-b15b-4daf-a81c-4db1d8c7a6a3)
The user field will only be present during the registration process of RssShuffleManager, if Coordinator restarts, the user will be lost.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1875/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1881,https://api.github.com/repos/apache/incubator-uniffle/issues/1881,incubator-uniffle,2399565301,1881,[Improvement] Make all uniifle class under org.apache.uniffle package to avoid conflict,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-07-10T02:13:53Z,2024-07-10T02:13:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Make all uniifle class under org.apache.uniffle package to avoid conflict.

Something like spark mr tez client sdk.

### How should we improve?

Make all uniifle class under org.apache.uniffle package to avoid conflict.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1881/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1885,https://api.github.com/repos/apache/incubator-uniffle/issues/1885,incubator-uniffle,2400070085,1885,[Improvement] usedMemory should be released as soon as possible after buffer released,xianjingfeng,11752250,,,CLOSED,2024-07-10T08:15:58Z,2024-07-10T09:08:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In the current implementation, `usedMemory` is released only when all buffers of an application are released.
https://github.com/apache/incubator-uniffle/blob/34b5187fdf2959e543be75b2bf82824400bba60b/server/src/main/java/org/apache/uniffle/server/buffer/ShuffleBufferManager.java#L718-L725
If an app needs to release a lot of buffers, the buffer release time will be very long.  `usedMemory` will not be released in time.
```
[2024-07-10 10:07:44.706] [clearResourceThread] [INFO] ShuffleTaskManager.removeResources - Start remove resource for appId[application_1710412492003_44045761_1720576106674]
[2024-07-10 10:09:45.716] [clearResourceThread] [INFO] HybridStorageManager.removeResources - Start to remove resource of AppPurgeEvent{appId='application_1710412492003_44045761_1720576106674', user='root', shuffleIds=[0]}
```

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1885/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1887,https://api.github.com/repos/apache/incubator-uniffle/issues/1887,incubator-uniffle,2400352199,1887,[Improvement] reject all requests from unregistered apps in shuffle server,xianjingfeng,11752250,,,CLOSED,2024-07-10T10:24:08Z,2024-07-23T07:28:03Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently. If a server is restarted, it can still receive requests from clients before the restart. And these requests will waste some computing resources.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1887/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1887,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EqVow,incubator-uniffle,2225691184,1887,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-12T14:21:58Z,2024-07-12T14:21:58Z,This is useful. When will this be ready to be reviewed?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EqVow/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1887,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EyVpB,incubator-uniffle,2227788353,1887,NA,xianjingfeng,11752250,,,NA,2024-07-15T06:35:28Z,2024-07-15T06:35:28Z,"> This is useful. When will this be ready to be reviewed?

Plan for next week.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EyVpB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1888,https://api.github.com/repos/apache/incubator-uniffle/issues/1888,incubator-uniffle,2400638424,1888,[FEATURE] Introduce a config to limit the max partition size,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-10T12:32:25Z,2024-08-05T08:21:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Introduce a config to limit the maximum of partition size, client will received an exception with message to show the partition size and configured max partition size.

### Motivation

- Protected the shuffle server to avoid write huge huge huge file.(I am so lucky to saw a 6TB file under a single disk of shuffle server)
- Fast failed and let user know the truth is partition data skew and user can do something to avoid product huge huge huge partition.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1888/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1890,https://api.github.com/repos/apache/incubator-uniffle/issues/1890,incubator-uniffle,2402686488,1890,[Bug] Incompatibility issues might happen after upgrading the npm version,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-07-11T09:18:57Z,2024-07-12T03:12:49Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In https://github.com/apache/incubator-uniffle/pull/1870, it bumps the npm version from 8.19.4 to 10.7.0, and I found out that it may cause incompatibility issues with some old glibc when compiling the dashboard:
![image](https://github.com/apache/incubator-uniffle/assets/13834479/02bc7191-5e7f-4889-9858-ecba3c3588c1)


```
[INFO] /data/landun/workspace/project-mission-peak/dashboard/src/main/webapp/node/node: /lib64/libm.so.6: versi
on `GLIBC_2.27' not found (required by /data/landun/workspace/project-mission-peak/dashboard/src/main/webapp/no
de/node)
[INFO] /data/landun/workspace/project-mission-peak/dashboard/src/main/webapp/node/node: /lib64/libstdc++.so.6: 
version `GLIBCXX_3.4.20' not found (required by /data/landun/workspace/project-mission-peak/dashboard/src/main/
webapp/node/node)
[INFO] /data/landun/workspace/project-mission-peak/dashboard/src/main/webapp/node/node: /lib64/libstdc++.so.6: 
version `CXXABI_1.3.9' not found (required by /data/landun/workspace/project-mission-peak/dashboard/src/main/we
bapp/node/node)
[INFO] /data/landun/workspace/project-mission-peak/dashboard/src/main/webapp/node/node: /lib64/libstdc++.so.6: 
version `GLIBCXX_3.4.21' not found (required by /data/landun/workspace/project-mission-peak/dashboard/src/main/
webapp/node/node)
[INFO] /data/landun/workspace/project-mission-peak/dashboard/src/main/webapp/node/node: /lib64/libc.so.6: versi
on `GLIBC_2.28' not found (required by /data/landun/workspace/project-mission-peak/dashboard/src/main/webapp/no
de/node)
[INFO] /data/landun/workspace/project-mission-peak/dashboard/src/main/webapp/node/node: /lib64/libc.so.6: versi
on `GLIBC_2.25' not found (required by /data/landun/workspace/project-mission-peak/dashboard/src/main/webapp/no
de/node)
```


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1890/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1890,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Ed7aT,incubator-uniffle,2222438035,1890,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-11T09:19:30Z,2024-07-11T09:19:30Z,@yl09099 PTAL.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Ed7aT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1890,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EfEep,incubator-uniffle,2222737321,1890,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-11T11:56:49Z,2024-07-11T11:56:49Z,"Should we support old versions of glibc? If we don't need to support them, we can close this issue.

@yl09099 @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EfEep/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1890,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EfUDe,incubator-uniffle,2222801118,1890,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-07-11T12:25:36Z,2024-07-11T12:25:36Z,"> Should we support old versions of glibc? If we don't need to support them, we can close this issue.
> 
> @yl09099 @jerqi

I prefer not unless it is very necessary.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EfUDe/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1890,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Ek37j,incubator-uniffle,2224258787,1890,NA,yl09099,33595968,,,NA,2024-07-12T01:33:34Z,2024-07-12T01:33:34Z,"> Should we support old versions of glibc? If we don't need to support them, we can close this issue.
> 
> @yl09099 @jerqi

Really not very necessary, some of the main framework in the 8.19.4 version of the outdated, I forgot to change back when I did it, the local installation of node greater than or equal to v20.15.0 high version, or upgrade Python greater than or equal to 3.9 version can compile the past.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Ek37j/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1890,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ElMe5,incubator-uniffle,2224342969,1890,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-12T03:12:49Z,2024-07-12T03:12:49Z,"OK, we don't support old versions of them. Closed.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ElMe5/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1892,https://api.github.com/repos/apache/incubator-uniffle/issues/1892,incubator-uniffle,2404576184,1892,[DOCS] Add a guide document for configuring memory related configs,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-07-12T03:29:39Z,2024-07-12T14:19:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

As described in the title.

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1892/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1894,https://api.github.com/repos/apache/incubator-uniffle/issues/1894,incubator-uniffle,2404831480,1894,[Bug] NPE for shuffle server,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-12T06:10:43Z,2024-07-17T06:13:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

NPE for shuffle server.

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[2024-07-12 11:04:19.255] [epollEventLoopGroup-3-11] [ERROR] ShuffleServerNettyHandler.exceptionCaught - exception caught /x.x.x.x:54999
java.lang.NullPointerException
        at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.handleSendShuffleDataRequest(ShuffleServerNettyHandler.java:108)
        at org.apache.uniffle.server.netty.ShuffleServerNettyHandler.receive(ShuffleServerNettyHandler.java:83)
        at org.apache.uniffle.common.netty.handle.TransportRequestHandler.handle(TransportRequestHandler.java:62)
        at org.apache.uniffle.common.netty.handle.TransportChannelHandler.channelRead(TransportChannelHandler.java:100)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
        at io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:289)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
        at org.apache.uniffle.common.netty.TransportFrameDecoder.channelRead(TransportFrameDecoder.java:81)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)
        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)
        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:801)
        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:501)
        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:399)
        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
        at java.lang.Thread.run(Thread.java:750)
```

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1894/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1895,https://api.github.com/repos/apache/incubator-uniffle/issues/1895,incubator-uniffle,2404835750,1895,[Bug] The dashboard does not start.,yl09099,33595968,,,CLOSED,2024-07-12T06:14:20Z,2024-07-12T07:19:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

#1852 Preconditions.checkArgument(coordinatorServerAddressesMap.isEmpty(), ""No coordinator server address found."");
https://guava.dev/releases/19.0/api/docs/com/google/common/base/Preconditions.html
Reverse judgment.

Exception in thread ""main"" java.lang.IllegalArgumentException: No coordinator server address found.
	at com.google.common.base.Preconditions.checkArgument(Preconditions.java:143)
	at org.apache.uniffle.dashboard.web.proxy.WebProxyServlet.<init>(WebProxyServlet.java:38)
	at org.apache.uniffle.dashboard.web.JettyServerFront.addProxyHandler(JettyServerFront.java:116)
	at org.apache.uniffle.dashboard.web.JettyServerFront.setRootServletHandler(JettyServerFront.java:100)
	at org.apache.uniffle.dashboard.web.JettyServerFront.initialization(JettyServerFront.java:87)
	at org.apache.uniffle.dashboard.web.JettyServerFront.<init>(JettyServerFront.java:64)
	at org.apache.uniffle.dashboard.web.JettyServerFront.main(JettyServerFront.java:76)

### Affects Version(s)

0.10.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1895/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1895,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EnG0c,incubator-uniffle,2224844060,1895,NA,yl09099,33595968,,,NA,2024-07-12T06:16:31Z,2024-07-12T06:16:31Z,@maobaolong @xianjingfeng @rickyma PATL,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6EnG0c/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1895,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Enk1X,incubator-uniffle,2224966999,1895,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-07-12T07:11:51Z,2024-07-12T07:11:51Z,"@yl09099 It's my fault, the condition is wrong, let me fixed it at once.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Enk1X/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1898,https://api.github.com/repos/apache/incubator-uniffle/issues/1898,incubator-uniffle,2405660782,1898,[DOCS] Malloc Recommendation,rickyma,13834479,RickyMa,mhx8888@gmail.com,CLOSED,2024-07-12T13:49:23Z,2024-07-17T18:58:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

_No response_

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1898/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1900,https://api.github.com/repos/apache/incubator-uniffle/issues/1900,incubator-uniffle,2407380844,1900,[Improvement] Resolve DISCLAIMER-WIP / 3rd party sources,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,CLOSED,2024-07-14T11:00:51Z,2024-10-12T22:33:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

This project has to complete the work to review the 3rd party source used.

Additionally, during 0.9.0 release, [it has been highlighted](https://lists.apache.org/thread/zls8z2f982r2cg6xmcnx7qffb6o36t5f) that there is 3rd party source from AWS EMR and Zuston/Riffle. Is there iaSoftware Grant Agreement for https://github.com/zuston/riffle?

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1900/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1900,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6OS5vW,incubator-uniffle,2387319766,1900,NA,pjfanning,11783444,PJ Fanning,,NA,2024-10-02T00:34:25Z,2024-10-02T00:34:25Z,"@EnricoMi @jerqi I was going to review the 0.9.1 RC but I wanted to check the progress of this task first.

You appear to have a standard DISCLAIMER in your git master branch. Your LICENSE and NOTICE in git master branch have no mention of 3rd party source code.

This issue has no documentation to describe why this is the case. I highlighted potential issues related to AWS EMR and Zuston/Riffle. Can you explain if there are no issues and why that is the case?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6OS5vW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1900,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6OTIy9,incubator-uniffle,2387381437,1900,NA,pjfanning,11783444,PJ Fanning,,NA,2024-10-02T00:51:43Z,2024-10-02T00:51:43Z,"This file looks like it needs to be mentioned in your LICENSE:

https://github.com/apache/incubator-uniffle/blob/0bb64739d084be258ad86f70dcb7ab7e13f8777e/rust/experimental/server/src/readable_size.rs#L15
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6OTIy9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1900,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6O9j5P,incubator-uniffle,2398502479,1900,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-10-08T02:06:58Z,2024-10-08T02:06:58Z,"> This file looks like it needs to be mentioned in your LICENSE:
> 
> https://github.com/apache/incubator-uniffle/blob/0bb64739d084be258ad86f70dcb7ab7e13f8777e/rust/experimental/server/src/readable_size.rs#L15

OK, I will add this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6O9j5P/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1900,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6O9k8N,incubator-uniffle,2398506765,1900,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-10-08T02:08:59Z,2024-10-08T02:08:59Z,"> @EnricoMi @jerqi I was going to review the 0.9.1 RC but I wanted to check the progress of this task first.
> 
> You appear to have a standard DISCLAIMER in your git master branch. Your LICENSE and NOTICE in git master branch have no mention of 3rd party source code.
> 
> This issue has no documentation to describe why this is the case. I highlighted potential issues related to AWS EMR and Zuston/Riffle. Can you explain if there are no issues and why that is the case?

The code of two repos is contributed by the same author. Do we need extra explanation in the License file?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6O9k8N/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1900,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6PkiDu,incubator-uniffle,2408718574,1900,NA,pjfanning,11783444,PJ Fanning,,NA,2024-10-12T22:33:05Z,2024-10-12T22:33:05Z,"> > This file looks like it needs to be mentioned in your LICENSE:
> > https://github.com/apache/incubator-uniffle/blob/0bb64739d084be258ad86f70dcb7ab7e13f8777e/rust/experimental/server/src/readable_size.rs#L15
> 
> OK, I will add this.

This may be the the only item that needs to be added to your LICENSE. I have https://github.com/apache/incubator-uniffle/issues/2161 open for this. Uniffle has been in Incubation for more than 2 years and as a result, I am not willing to vote on IPMC release votes for Uniffle any more - at least, until you get the LICENSE info correct.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6PkiDu/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1901,https://api.github.com/repos/apache/incubator-uniffle/issues/1901,incubator-uniffle,2407494705,1901,[FEATURE] Support set JVM Args for each server,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-14T16:02:44Z,2024-07-17T18:54:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

As tittle, Support set JVM Args in rss-env.sh or other way for each server.

### Motivation

More flexible to add more jvm args to each server

### Describe the solution

Add COORDINATOR_JAVA_OPTS, SHUFFLE_SERVER_JAVA_OPTS, DASHBOARD_JAVA_OPTS 

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1901/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1903,https://api.github.com/repos/apache/incubator-uniffle/issues/1903,incubator-uniffle,2407789794,1903,[FEATURE] Add some metrics about shuffle server,kuszz,21366445,kqhzz,kuangqinghuazz@163.com,CLOSED,2024-07-15T03:30:08Z,2024-07-17T18:38:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Add some metrics about shuffle

### Motivation

We already have TOTAL_WRITE_DATA metric, but we don't have delete data and file num metrics, add some metrics would be helpful to understand the status of the shuffle server

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1903/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1910,https://api.github.com/repos/apache/incubator-uniffle/issues/1910,incubator-uniffle,2410046572,1910,[Bug] Shuffle server hang due to log4j callAppenders,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-07-16T02:23:15Z,2024-07-17T01:45:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Shuffle server hangs due to the log4j callAppenders

```
""Grpc-485"" #947 daemon prio=5 os_prio=0 cpu=1573643.15ms elapsed=2321982.00s tid=0x00007f8240577800 nid=0x31de10 waiting for monitor entry  [0x00007f81ece53000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at org.apache.log4j.Category.callAppenders(Category.java:204)
        - waiting to lock <0x00007f82dc778c40> (a org.apache.log4j.spi.RootLogger)
        at org.apache.log4j.Category.forcedLog(Category.java:384)
        at org.apache.log4j.Category.log(Category.java:810)
        at org.slf4j.impl.Reload4jLoggerAdapter.info(Reload4jLoggerAdapter.java:347)
        at org.apache.uniffle.server.ShuffleServerGrpcService.reportShuffleResult(ShuffleServerGrpcService.java:493)
        at org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1134)
        at io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
        at io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
        at io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
        at io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:352)
        at io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:866)
        at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
        at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@11.0.4/ThreadPoolExecutor.java:1128)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@11.0.4/ThreadPoolExecutor.java:628)
        at java.lang.Thread.run(java.base@11.0.4/Thread.java:834)
```

From the log4j document, we should not print out the method name into the log4j properties.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1910/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1912,https://api.github.com/repos/apache/incubator-uniffle/issues/1912,incubator-uniffle,2410113513,1912,[Improvement] ShuffleBlockInfo.getSize can be optimized when enabling Netty using off-heap memory,rickyma,13834479,RickyMa,mhx8888@gmail.com,OPEN,2024-07-16T03:25:40Z,2025-01-09T06:22:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

As the title says, we use off-heap memory when enabling Netty, so there is no need to add the metadata size of fields.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1912/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1912,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZqOiG,incubator-uniffle,2577983622,1912,NA,cchung100m,6762509,Neo Chien,,NA,2025-01-08T15:38:26Z,2025-01-08T15:38:26Z,"Hi @rickyma 

Based on my understanding of the description, we need to modify the following part from `sbi.getSize()` to `sbi.getLength()`. Please help to confirm my understanding, thank you. 😄 

https://github.com/apache/incubator-uniffle/blob/3ea5c2c780b1cb8cf01e63ecd82b5c2410c2ac49/client-spark/common/src/main/java/org/apache/spark/shuffle/writer/WriteBufferManager.java#L514

https://github.com/apache/incubator-uniffle/blob/3ea5c2c780b1cb8cf01e63ecd82b5c2410c2ac49/internal-client/src/main/java/org/apache/uniffle/client/impl/grpc/ShuffleServerGrpcClient.java#L555

https://github.com/apache/incubator-uniffle/blob/3ea5c2c780b1cb8cf01e63ecd82b5c2410c2ac49/internal-client/src/main/java/org/apache/uniffle/client/impl/grpc/ShuffleServerGrpcNettyClient.java#L145

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZqOiG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1912,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZvHHX,incubator-uniffle,2579263959,1912,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2025-01-09T06:22:09Z,2025-01-09T06:22:09Z,It's been a long time. I don't know if the code has already been optimized by @maobaolong in some other way.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZvHHX/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1917,https://api.github.com/repos/apache/incubator-uniffle/issues/1917,incubator-uniffle,2412800939,1917,[Bug] Memory may leak when handling SendShuffleDataRequest,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-17T06:48:22Z,2024-08-16T08:25:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Memory may leak when handling SendShuffleDataRequest.
The method `handleSendShuffleDataRequest` return too early before releasing resources (Netty buffers and memory metrics).

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1917/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1917,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IrWcS,incubator-uniffle,2293065490,1917,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-08-16T08:25:29Z,2024-08-16T08:25:29Z,"This issue depends on #1915, but #1915 modified proto. The minor version should not modify the proto, remove this from 0.9.1 milestone.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IrWcS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1924,https://api.github.com/repos/apache/incubator-uniffle/issues/1924,incubator-uniffle,2415088694,1924,"[FEATURE] Add conf, metrics and stacks link in dashboard",kuszz,21366445,kqhzz,kuangqinghuazz@163.com,CLOSED,2024-07-18T02:44:01Z,2024-07-22T02:08:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We can get conf/metrics/stacks of coordinator/server

### Motivation

Enhance dashboard capabilities

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1924/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1928,https://api.github.com/repos/apache/incubator-uniffle/issues/1928,incubator-uniffle,2415841958,1928,[Flaky Test] Fix flaky test speculate fail tasks.,zhengchenyu,10381583,zhengchenyu,,OPEN,2024-07-18T09:26:14Z,2024-07-18T09:29:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

I found the ci test 'speculate fail tasks' always fail because of timeout. We can increase the timeout period appropriately.

### Actions URL

 https://github.com/apache/incubator-uniffle/actions/runs/9984972371/job/27604021459.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1928/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1930,https://api.github.com/repos/apache/incubator-uniffle/issues/1930,incubator-uniffle,2416303095,1930,[Bug] ClearResource thread memory double release exception,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-18T13:00:38Z,2024-08-22T17:47:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

<img width=""1162"" alt=""image"" src=""https://github.com/user-attachments/assets/486f84d8-9404-47b1-a1c0-c3aa84ce2aa1"">


### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[2024-07-16 23:01:44.207] [clearResourceThread] [ERROR] ShuffleTaskManager.lambda$new$0 - Exception happened when clearing resource for expired application for appId: application_1703049085550_16029583_1721141940549
io.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1
        at io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:83)
        at io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:148)
        at io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:101)
        at io.netty.buffer.WrappedByteBuf.release(WrappedByteBuf.java:1037)
        at io.netty.buffer.SimpleLeakAwareByteBuf.release(SimpleLeakAwareByteBuf.java:102)
        at io.netty.buffer.AdvancedLeakAwareByteBuf.release(AdvancedLeakAwareByteBuf.java:942)
        at org.apache.uniffle.server.buffer.ShuffleBufferWithSkipList.lambda$release$2(ShuffleBufferWithSkipList.java:115)
        at java.lang.Iterable.forEach(Iterable.java:75)
        at org.apache.uniffle.server.buffer.ShuffleBufferWithSkipList.release(ShuffleBufferWithSkipList.java:115)
        at org.apache.uniffle.server.buffer.ShuffleBufferManager.removeBufferByShuffleId(ShuffleBufferManager.java:721)
        at org.apache.uniffle.server.buffer.ShuffleBufferManager.removeBuffer(ShuffleBufferManager.java:371)
        at org.apache.uniffle.server.ShuffleTaskManager.removeResources(ShuffleTaskManager.java:850)
        at org.apache.uniffle.server.ShuffleTaskManager.lambda$new$0(ShuffleTaskManager.java:190)
        at java.lang.Thread.run(Thread.java:750)
```
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1930/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1932,https://api.github.com/repos/apache/incubator-uniffle/issues/1932,incubator-uniffle,2416457565,1932,[Bug] Shall we resolve the memory forget release or double release issue by a framework?,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-07-18T13:50:05Z,2024-07-18T13:50:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

During these day, we found a bundle of memory related issue, some are memory leak, some are double release, these make us confusing.

And we have a discussion between our teammate, an idea is that we should decouple rpc thread and memory release thread by a blocking queue, leverage this queue, let's say it `releaseEventQueue`, rpc threads could be memory release event producer, and memory release thread poll the `releaseEventQueue` and release the memory, by this, we can make sure release memory within one thread, double release behavior can be detected and avoid.

Any thoughts?

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1932/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1934,https://api.github.com/repos/apache/incubator-uniffle/issues/1934,incubator-uniffle,2417577615,1934,[FEATURE] Browse logs file and contents of shuffle server in the dashboard,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-18T23:52:48Z,2024-07-19T08:06:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Display the log contents and browse the log files for each shuffle server in dashboard pages.

### Motivation

With this feature, we can see log of each node easily and conveniently

### Describe the solution

We need to get log list and log content of each server through dashboard WebProxyServlet, instead of access the server directly, since we cannot talk to server node directly in our production environment.

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1934/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1934,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6FZN_y,incubator-uniffle,2237980658,1934,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-19T02:53:30Z,2024-07-19T02:53:30Z,Duplicated: https://github.com/apache/incubator-uniffle/issues/1623,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6FZN_y/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1934,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Fbl9Z,incubator-uniffle,2238603097,1934,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-07-19T08:06:10Z,2024-07-19T08:06:10Z,"@rickyma As this is duplicated, close it","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Fbl9Z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1936,https://api.github.com/repos/apache/incubator-uniffle/issues/1936,incubator-uniffle,2420818866,1936,[FEATURE] Shuffle Server RPC Audit Logging Enabled,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-20T10:47:09Z,2024-07-23T12:08:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Shuffle server log the audit from rpc.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1936/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1938,https://api.github.com/repos/apache/incubator-uniffle/issues/1938,incubator-uniffle,2421460992,1938,[Improvement] Use ShuffleSegment to replace BufferSegment and FileBasedShuffleSegment,wankunde,3626747,wankun,wankun@apache.org,OPEN,2024-07-21T15:18:06Z,2024-07-21T15:18:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Now the BufferSegment class and FileBasedShuffleSegment class both six fields, represents a segment.
```java
  private long blockId;
  private long offset;
  private int length;
  private int uncompressLength;
  private long crc;
  private long taskAttemptId;
```
To add a new ShuffleSegment to replace these two class can make the code easier to maintain.
 

### How should we improve?

To simplify the code.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1938/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1941,https://api.github.com/repos/apache/incubator-uniffle/issues/1941,incubator-uniffle,2422432322,1941,[Umbrella] Display detailed information about an application,xianjingfeng,11752250,,,OPEN,2024-07-22T09:46:02Z,2024-08-02T06:56:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Currently we can't know the detailed information of the applications, such as the amount of shuffle data for each partition, the amount of data written to disk, and how much memory is occupied, etc. This information will help us find server problems and help us find unreasonable jobs.

### Task list

- [ ] #1942
- [ ] #1943 
- [ ] #1944 
- [x] #2000 

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1941/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1942,https://api.github.com/repos/apache/incubator-uniffle/issues/1942,incubator-uniffle,2422443196,1942,[Subtask] Add REST api for fetching detailed information of applications in shuffle server side,xianjingfeng,11752250,,,OPEN,2024-07-22T09:51:18Z,2024-07-22T09:51:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Add REST api for fetching detailed information of applications in shuffle server side

### Parent issue

#1941

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1942/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1943,https://api.github.com/repos/apache/incubator-uniffle/issues/1943,incubator-uniffle,2422446611,1943,[Subtask] Add REST api for fetching detailed information of applications in coordinator side,xianjingfeng,11752250,,,OPEN,2024-07-22T09:52:58Z,2024-07-22T09:52:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Add REST api for fetching detailed information of applications in coordinator side

### Parent issue

#1941

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1943/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1944,https://api.github.com/repos/apache/incubator-uniffle/issues/1944,incubator-uniffle,2422450646,1944,[Subtask] Display detailed application information in the front-end,xianjingfeng,11752250,,,OPEN,2024-07-22T09:54:56Z,2024-07-22T09:54:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Display detailed application information in the front-end

### Parent issue

#1941

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1944/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1945,https://api.github.com/repos/apache/incubator-uniffle/issues/1945,incubator-uniffle,2424463650,1945,[Improvement] Release preAllocatedBuffer when unregisterShuffleByAppId request,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-07-23T07:23:01Z,2024-07-27T04:44:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Release memory when unregisterShuffleByAppId invoked, rather than release it by `checkResource` background thread.

```
[2024-07-23 15:16:14.233] succeeded=true        allowed=true    cmd=unregisterShuffleByAppId    statusCode=SUCCESS      appId=application_1703049085550_16568008_1721718824735  shuffleId=-1    executionTimeUs=96     args:{null}
[2024-07-23 15:18:28.153] [checkResource-0] [WARN] ShuffleTaskManager - Remove expired preAllocatedBuffer[id=24467] that required by app: application_1703049085550_16568008_1721718824735
[2024-07-23 15:18:28.153] [checkResource-0] [WARN] ShuffleTaskManager - Remove expired preAllocatedBuffer[id=24468] that required by app: application_1703049085550_16568008_1721718824735
```

### How should we improve?

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1945/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1947,https://api.github.com/repos/apache/incubator-uniffle/issues/1947,incubator-uniffle,2426806108,1947,[FEATURE] Support authentication for decommission interface,xianjingfeng,11752250,,,CLOSED,2024-07-24T07:28:53Z,2024-07-26T03:16:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support authentication for some rest interface

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1947/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1949,https://api.github.com/repos/apache/incubator-uniffle/issues/1949,incubator-uniffle,2426883250,1949,[Umbrella] Support authentication for some rest interface,xianjingfeng,11752250,,,OPEN,2024-07-24T08:10:40Z,2024-07-29T06:53:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Currently, the rest interfaces don't have authentication. This is unsafe for some rest interfaces, such as some modifying configuration-related interfaces.

### Task list

- [x] #1947 
- [ ] #1978 

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1949/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1949,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6F8Uuz,incubator-uniffle,2247183283,1949,NA,xianjingfeng,11752250,,,NA,2024-07-24T08:13:21Z,2024-07-24T08:13:21Z,@yl09099 @rickyma @jerqi PTAL,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6F8Uuz/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1954,https://api.github.com/repos/apache/incubator-uniffle/issues/1954,incubator-uniffle,2429140582,1954,[Bug] [#1927] The introduction of serverType causes all NPE except GET requests.,yl09099,33595968,,,CLOSED,2024-07-25T06:35:14Z,2024-07-31T09:14:18Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

1. #1927 This PR, in addition to the GET request, the rest of the request should report a null pointer exception.
2. Instead of using the OptionsAPI approach, we should use Vue3's CompositionAPI.
3. If the Coordinator URL does not exist, you should not return a random Coordinator URL. Instead, you should return an exception to the front-end.

### Affects Version(s)

0.10.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1954/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1954,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GFav7,incubator-uniffle,2249567227,1954,NA,yl09099,33595968,,,NA,2024-07-25T06:36:48Z,2024-07-25T06:36:48Z,@kuszz @maobaolong cc.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GFav7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1954,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GGKLd,incubator-uniffle,2249761501,1954,NA,kuszz,21366445,kqhzz,kuangqinghuazz@163.com,NA,2024-07-25T08:29:10Z,2024-07-25T08:29:10Z,"> @kuszz @maobaolong cc.

@yl09099 Sorry, I have submit a PR to fix this bug, but I don't understand the describe 2 and 3","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GGKLd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1954,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GOtvF,incubator-uniffle,2252004293,1954,NA,yl09099,33595968,,,NA,2024-07-26T05:31:36Z,2024-07-26T05:31:36Z,"> > @kuszz @maobaolong cc.
> 
> @yl09099 Sorry, I have submit a PR to fix this bug, but I don't understand the describe 2 and 3

Let me fix it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GOtvF/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1956,https://api.github.com/repos/apache/incubator-uniffle/issues/1956,incubator-uniffle,2429441916,1956,[Bug] All grpc thread hang due to the disk corruption,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-07-25T09:08:40Z,2024-08-16T08:19:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In our production environment, there was a shuffle-server hang, that is blocked on the LocalFileDeleteHandler which held the app's write lock and then all grpc threads were blocked.

And the root cause is the disk broken.

![image](https://github.com/user-attachments/assets/7fab7834-6804-4db5-8038-1dade6058575)


### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1956/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1956,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IrTvw,incubator-uniffle,2293054448,1956,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-08-16T08:19:50Z,2024-08-16T08:19:50Z,"app lock is introduced by #1593, not merged to branch-0.9, remove from 0.9.1 milestone.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IrTvw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1959,https://api.github.com/repos/apache/incubator-uniffle/issues/1959,incubator-uniffle,2429642556,1959,[Improvement] Decouple script and config,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-25T10:45:43Z,2024-07-30T02:37:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

- Scripts in the `bin` directory should be immutable and driven by configurations.
- We can store `conf` in our config server, but maintain scripts in git repository.

### How should we improve?

Do refactor and abstract the environment variables to let user have ability to custom the jvm args.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1959/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1961,https://api.github.com/repos/apache/incubator-uniffle/issues/1961,incubator-uniffle,2430080765,1961,[Bug] local class incompatible: stream classdesc serialVersionUID xxx,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-25T14:11:54Z,2024-07-26T07:10:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug


Spark report this error. This show that the two client version are different

```
 Job aborted due to stage failure: Task 1 in stage 0.0 failed 4 times, most recent failure: Lost task 1.3 in stage 0.0 (TID 29) (XXX executor 6): java.io.InvalidClassException: org.apache.spark.shuffle.RssShuffleHandle; local class incompatible: stream classdesc serialVersionUID = -484592647199665992, local class serialVersionUID = -5519528926859572710
	at java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:699)
	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:2005)
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1852)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2186)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1669)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2431)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2355)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2213)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1669)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2431)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2355)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2213)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1669)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:503)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:461)
	at org.apache.spark.serializer.JavaDeserializationStream.readObject(JavaSerializer.scala:87)
	at org.apache.spark.serializer.JavaSerializerInstance.deserialize(JavaSerializer.scala:129)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:85)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)
	at org.apache.spark.scheduler.Task.run(Task.scala:136)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1556)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1961/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1966,https://api.github.com/repos/apache/incubator-uniffle/issues/1966,incubator-uniffle,2431549305,1966,[Improvement] Move rss-env.sh to conf folder,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-26T06:49:34Z,2024-07-26T06:57:51Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Move the rss-env.sh into conf folder as it is a part of config

### How should we improve?

Just move it.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1966/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1967,https://api.github.com/repos/apache/incubator-uniffle/issues/1967,incubator-uniffle,2431611599,1967,[#1401] feat(dashboard): execluded list deletion function.,yl09099,33595968,,,CLOSED,2024-07-26T07:30:08Z,2024-07-31T10:54:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Delete the blacklist of the shuffle server in the dashboard.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1967/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1967,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GuIFc,incubator-uniffle,2260238684,1967,NA,yl09099,33595968,,,NA,2024-07-31T10:54:38Z,2024-07-31T10:54:38Z,"This feature should be included in issue #1401, which should be closed.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GuIFc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1968,https://api.github.com/repos/apache/incubator-uniffle/issues/1968,incubator-uniffle,2431613549,1968,[FEATURE] Coordinator or zk/etcd as config server to maintain all cluster and client common conf,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-07-26T07:31:17Z,2024-07-26T07:31:17Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

All cluster get config from one config center.

### Motivation

It can be easy to maintain config.

### Describe the solution

During all server startup period, sync config from coordinator/zk/etcd and apply to it configmap. Start a background thread to sync config coordinator/zk/etcd periodically and store the config hash or version as fingerprint.

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1968/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1972,https://api.github.com/repos/apache/incubator-uniffle/issues/1972,incubator-uniffle,2433912446,1972,[Bug] leakShuffleDataChecker could remove shuffle data belong to new coming app,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-28T12:37:52Z,2024-08-29T09:33:49Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When checkAndClearLeakedShuffleData invoked, but a new app flushed during this gap, but this appId do not exist in the copied `appIds` set, the data can be removed accidentially.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1972/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1973,https://api.github.com/repos/apache/incubator-uniffle/issues/1973,incubator-uniffle,2433919664,1973,[Improvement] Refactor metrics system to reduce periodically report metrics heavy behavior,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-28T12:55:00Z,2024-08-14T12:39:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The Metrics System of current uniffle, have to set metrics before get metrics, so we have two disadvantage

1. We have to set metrics value every time.

`NettyDirectMemoryTracker` is a bad case which have to set gaugeUsedDirectMemorySizeByNetty gaugeUsedDirectMemorySizeByGrpcNetty and gaugeUsedDirectMemorySize every 10 sec by default.

2. We cannot measure the current size of collection accurately, it is complex and easy-to-wrong.
Bad case is `gaugeEventQueueSize`, we can get the size by `flushQueue.size()`, but we have to `gaugeEventQueueSize.inc()` and `gaugeEventQueueSize.des()`.

### How should we improve?

Reference the Alluxio Metrics system. `MetricsSystem.registerGaugeIfAbsent(MetricKey.CLIENT_CACHE_PAGES.getName(), mPages::size);`. We can calc the metric value by the given lambda.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1973/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1977,https://api.github.com/repos/apache/incubator-uniffle/issues/1977,incubator-uniffle,2434330994,1977,[Improvement] (dashboard): Add version and git commit id in dashboard,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-07-29T02:44:08Z,2024-08-01T06:33:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

From the dashboard UI, I can't find usage information to tell if the module has been upgraded and quickly locate the problem.

### How should we improve?

In the dashboard UI, add VERSION and Git commit Id information, which can tell us about the code branch.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1977/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1977,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GZg2Z,incubator-uniffle,2254835097,1977,NA,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,NA,2024-07-29T02:45:03Z,2024-07-29T02:45:03Z,#1964 ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GZg2Z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1978,https://api.github.com/repos/apache/incubator-uniffle/issues/1978,incubator-uniffle,2434599280,1978,[Subtask] Support login function in dashboard module,xianjingfeng,11752250,,,OPEN,2024-07-29T06:51:09Z,2024-07-31T03:20:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

We have supported authentication in some interfaces in coordinator in #1948.
In the future, we will support request these interfaces through the dashboard module.
So I think we should add a login page.

I think this can be achieved like this:
1.Add a interface for login authentication in coordinator.
2.If the authentication is passed, Save the authentication credentials to the session in dashboard module
3.Put the credentials in the header each time request the coordinator.

### Parent issue

#1949

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1978/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1978,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GacP6,incubator-uniffle,2255078394,1978,NA,xianjingfeng,11752250,,,NA,2024-07-29T06:51:42Z,2024-07-29T06:51:42Z,@yl09099 @jerqi cc,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GacP6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1978,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GrjEO,incubator-uniffle,2259562766,1978,NA,yl09099,33595968,,,NA,2024-07-31T03:20:55Z,2024-07-31T03:20:55Z,"> @yl09099 @jerqi cc

As we discussed last time, we can do this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GrjEO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1980,https://api.github.com/repos/apache/incubator-uniffle/issues/1980,incubator-uniffle,2434772773,1980,[FEATURE] Support rpc audit log for coordinator,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-29T08:22:23Z,2024-08-01T02:55:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support rpc audit log for coordinator to audit the rpc operation.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1980/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1982,https://api.github.com/repos/apache/incubator-uniffle/issues/1982,incubator-uniffle,2434886540,1982,[Bug] java.lang.NoSuchMethodError: java.nio.ByteBuffer.position(I)Ljava/nio/ByteBuffer,xianjingfeng,11752250,,,CLOSED,2024-07-29T09:16:10Z,2024-08-15T07:13:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

https://github.com/apache/incubator-gluten/actions/runs/10005893363/job/27659899781?pr=6484
https://www.morling.dev/blog/bytebuffer-and-the-dreaded-nosuchmethoderror/

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

```logtalk
Error Source: RUNTIME
Error Code: INVALID_STATE
Reason: Operator::getOutput failed for [operator: ValueStream, plan node ID: 0]: Error during calling Java code from native code: java.lang.NoSuchMethodError: java.nio.ByteBuffer.position(I)Ljava/nio/ByteBuffer;
	at org.apache.uniffle.common.util.ChecksumUtils.getCrc32(ChecksumUtils.java:50)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:242)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:307)
	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
```


### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1982/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1984,https://api.github.com/repos/apache/incubator-uniffle/issues/1984,incubator-uniffle,2436981553,1984,[FEATURE] Client send sparkConf through registerApplicationInfo rpc to Coordinator,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-07-30T06:10:10Z,2024-07-31T09:10:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We can let client send sparkConf to coordinator to show more context information about this application.

### Motivation

Insight and know what application are running and being served by RSS cluster.

### Describe the solution

1. Create a util method like this.

```java
  public static Map<String, String> sparkConfToMap(SparkConf sparkConf) {
    Map<String, String> map = new HashMap<>();

    for (Tuple2<String, String> tuple : sparkConf.getAll()) {
      String key = tuple._1;
      map.put(key, tuple._2);
    }

    return map;
  }
```
2. Extends the ApplicationInfoRequest
```protobuf
message ApplicationInfoRequest {
  string appId = 1;
  string user = 2;
  // new added
  map<string, string> properties = 3;
}
```
3. Other efforts related, finally display a column `conf` within application page.


### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1984/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1984,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Gj4jZ,incubator-uniffle,2257553625,1984,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-07-30T06:18:24Z,2024-07-30T06:18:24Z,Application information should be displayed in the Spark history server.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Gj4jZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1984,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GkqqU,incubator-uniffle,2257758868,1984,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-07-30T08:20:21Z,2024-07-30T08:20:21Z,"@jerqi Sorry for that I do not explain more about the motivation.

- Motivation
I want to get the application relevant upstream trigger, in our scenacrio, it is livy, the upstream of livy is supersql and then is `us`.

If I have `sparkConf`, I can get these information by

```
usp.param=20240315170727772_20240726000000
spark.app.name=livy-session-23219-decb9ee5-a499-469a-b8ed-e23605e8efbf
spark.livy.supersql.session_id=decb9ee5-a499-469a-b8ed-e23605e8efbf
spark.org.apache.hadoop.yarn.server.webproxy.amfilter.AmIpFilter.param.PROXY_URI_BASES=http://xxxx/xxx
```

Base on these, we can get more context and know well about this job, we could dig the reason of failure or under performance. 

Besides, we can get more useful information to help us for issue defeat.
- `spark.sql.warehouse.dir` to check the cluster performance.
- `java version` to check whether the java version is expected.
- `spark.internal.preload.jars` to check whether the client jar is expected.
- `classpath`  to check whether the client jar is correct.
- `user.name` to get the actually user name
- `spark.rss.*` to check the effected config about uniffle.
- `spark.app.attempt.id` to know the attempt time
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GkqqU/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1985,https://api.github.com/repos/apache/incubator-uniffle/issues/1985,incubator-uniffle,2437585294,1985,[Bug] The server page of dashboard cannot display server info when refresh the page,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-07-30T11:18:33Z,2024-08-01T02:58:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

We have to click the other group e.g. decommission nodes and then click active nodes button, the server list can be displayed.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1985/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1985,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GmBmo,incubator-uniffle,2258114984,1985,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-07-30T11:22:00Z,2024-07-30T11:22:00Z,@yl09099 Would you like to take a look at this issue? ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GmBmo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1985,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GrisP,incubator-uniffle,2259561231,1985,NA,yl09099,33595968,,,NA,2024-07-31T03:19:06Z,2024-07-31T03:19:06Z,"> @yl09099 Would you like to take a look at this issue?

I'll take care of it. Give it to me.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GrisP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1987,https://api.github.com/repos/apache/incubator-uniffle/issues/1987,incubator-uniffle,2439022609,1987,[Bug] [TEZ] Application may get stuck when exception occurs.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-07-31T03:17:02Z,2024-08-20T07:51:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I found that when exception occurs before the upstream task is notified successfully after sending the event, the application may get stuck. Because the downstream will get more event which include the failed task, and the check logic of allEventsReceived is whether numInput(partition * task number) is equal pathToIdentifierMap + skippedInputCounter which is generated from event. Since a failed task may also send an event, pathToIdentifierMap + skippedInputCounter  may be greater than numInputs, and the loop may not catch an equal case, hence get stuck.

This is low probability bug. To increase the probability of recurrence, we can add below code after https://github.com/apache/tez/blob/c745edfbbaeaaccd3f07d6cc2fd0d8ee88c7ef6f/tez-runtime-internals/src/main/java/org/apache/tez/runtime/LogicalIOProcessorRuntimeTask.java#L426

```
      if (new Random().nextInt(1000) > tezConf.getInt(""tez.random.throw.before.done"", 990)) {
        Thread.sleep(tezConf.getInt(""tez.sleep.before.throw"", 1000));
        throw new RuntimeException(""throw exception after send event and before done!"");
      }
```

After random throw, will reproduce this bug.

How to fix?
In fact, we use allEventsReceived to determine whether all upstream tasks are completed, but allEventsReceived may be abnormal due to multiple events occurring in multiple attempts for the same task. So we need to count the number of tasks, do not count the duplicate task attempts.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1987/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1987,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6I5Zv1,incubator-uniffle,2296749045,1987,NA,lifeSo,9440617,Qing,1169158401@qq.com,NA,2024-08-19T14:41:18Z,2024-08-19T14:41:18Z,"In generic situation, the unusual problem will not appear.
Could you describle more detail about when it will occor or what exception was encountered .
@zhengchenyu 
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6I5Zv1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1987,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6I-8ds,incubator-uniffle,2298201964,1987,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-08-20T07:51:26Z,2024-08-20T07:51:26Z,"@lifeSo 
In our production environment, the colleague responsible for deployment made an operation error and forgot to stop nm before updating the package, which resulted to class not found exeception. Because may nms were updated, the probability is higher. In fact, any exception was throw before send success event to am and after send dme to am, will trigger this bug.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6I-8ds/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1988,https://api.github.com/repos/apache/incubator-uniffle/issues/1988,incubator-uniffle,2439239069,1988,[FEATURE] Add mock data to the Dashboard front end.,yl09099,33595968,,,CLOSED,2024-07-31T06:28:50Z,2024-07-31T06:29:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

When the Dashboard front-end development needs to show some effects, it is necessary to start the backend to provide the corresponding interface to see the effect. After the mock data is added, you can see the page effect by intercepting the network request and directly using the mock data of the front-end.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1988/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1990,https://api.github.com/repos/apache/incubator-uniffle/issues/1990,incubator-uniffle,2439260989,1990,[Improvement] introduce Lombok,xianjingfeng,11752250,,,CLOSED,2024-07-31T06:43:18Z,2024-08-02T03:00:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

[Lombok](https://projectlombok.org/) is a java library that automatically plugs into your editor and build tools, spicing up your java.
Never write another getter or equals method again, with one annotation your class has a fully featured builder, Automate your logging variables, and much more. 

As the front-end functions become more and more, we will defined more an more vo(View Object) class. And Lombok can reduce the amount of code in this project.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1990/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1993,https://api.github.com/repos/apache/incubator-uniffle/issues/1993,incubator-uniffle,2439528780,1993,[FEATURE] Introduce swagger to support restapi,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-07-31T09:07:00Z,2024-07-31T09:21:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

This swagger can help to execute get\post request on browser.

<img width=""1713"" alt=""image"" src=""https://github.com/user-attachments/assets/3384d9d1-3a0f-4819-ae05-c3c8a9797a07"">



### Motivation

Easy to test and use rest api

### Describe the solution

Introduce swagger. Reference https://issues.apache.org/jira/browse/CELEBORN-1317

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1993/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1993,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GtVTR,incubator-uniffle,2260030673,1993,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-07-31T09:09:41Z,2024-07-31T09:09:41Z,You don't have to upload the screenshot. It's full of Chinese. You should use English.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GtVTR/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/1993,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GtcYI,incubator-uniffle,2260059656,1993,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-07-31T09:21:45Z,2024-07-31T09:21:45Z,"@rickyma Sorry, I change another screenshot without any additional text","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6GtcYI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/1994,https://api.github.com/repos/apache/incubator-uniffle/issues/1994,incubator-uniffle,2439818101,1994,[Improvement] Add Netty support for TEZ tasks in Uniffle,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2024-07-31T11:29:45Z,2024-08-06T08:30:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, Uniffle does not support the use of Netty for TEZ tasks. This issue aims to add support for using Netty with TEZ tasks in Uniffle.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/1994/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2000,https://api.github.com/repos/apache/incubator-uniffle/issues/2000,incubator-uniffle,2441629506,2000,[Subtask] Report HTTP port of Shuffle Server to the coordinator ,xianjingfeng,11752250,,,CLOSED,2024-08-01T06:48:32Z,2024-08-02T06:56:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Report HTTP port of Shuffle Server to the coordinator 

### Parent issue

#1941

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2000/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2000,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6G_IZY,incubator-uniffle,2264696408,2000,NA,xianjingfeng,11752250,,,NA,2024-08-02T06:56:55Z,2024-08-02T06:56:55Z,This feature has already been done,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6G_IZY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2002,https://api.github.com/repos/apache/incubator-uniffle/issues/2002,incubator-uniffle,2443824136,2002,[Bug] [dashboard] Add exclude node not work,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-08-02T02:01:19Z,2024-08-14T12:22:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

<img width=""336"" alt=""image"" src=""https://github.com/user-attachments/assets/2335aed7-433d-4677-bc0e-11e553ce82a5"">

<img width=""1294"" alt=""image"" src=""https://github.com/user-attachments/assets/806511ba-0748-4b5d-9f2c-de6dda1e3dee"">

There are not `requestServerType` and `targetAddress` in headers.

<img width=""2027"" alt=""image"" src=""https://github.com/user-attachments/assets/1e45bf9d-4294-421c-9e40-ddbceebfb9b1"">


### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
`dashboard.log`


[2024-08-02 10:00:27.002] [DashboardServer-47] [WARN] ServletHandler - /api/server/addExcludeNodes
java.lang.IllegalArgumentException: Invalid URI host: null (authority: null)
	at org.eclipse.jetty.client.HttpClient.checkHost(HttpClient.java:487)
	at org.eclipse.jetty.client.HttpClient.newHttpRequest(HttpClient.java:472)
	at org.eclipse.jetty.client.HttpClient.newRequest(HttpClient.java:430)
	at org.eclipse.jetty.client.HttpClient.newRequest(HttpClient.java:419)
	at org.eclipse.jetty.proxy.ProxyServlet.service(ProxyServlet.java:80)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)
	at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:848)
	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:584)
	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)
	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)
	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)
	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)
	at org.eclipse.jetty.server.handler.HandlerList.handle(HandlerList.java:52)
	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)
	at org.eclipse.jetty.server.Server.handle(Server.java:539)
	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:333)
	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)
	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:283)
	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:108)
	at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)
	at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:833)
```
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2002/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2002,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6G91qT,incubator-uniffle,2264357523,2002,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-08-02T02:01:58Z,2024-08-02T02:01:58Z,@yl09099 Would you like to take a look at this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6G91qT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2003,https://api.github.com/repos/apache/incubator-uniffle/issues/2003,incubator-uniffle,2443928467,2003,Unify `ShuffleManageClient`  config `rss.client.rpc.timeout.ms` and `rss.rpc.client.type.grpc.timeout`,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2024-08-02T03:34:12Z,2024-08-02T12:29:18Z," Should we unify `rss.client.rpc.timeout.ms` and `rss.rpc.client.type.grpc.timeout`?

_Originally posted by @rickyma in https://github.com/apache/incubator-uniffle/pull/1838#discussion_r1691575535_
            ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2003/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2006,https://api.github.com/repos/apache/incubator-uniffle/issues/2006,incubator-uniffle,2444004608,2006,[Flaky Test] org.apache.uniffle.test.GetReaderTest,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-08-02T04:25:58Z,2024-08-02T04:26:17Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test


Error:  Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 4.589 s <<< FAILURE! - in org.apache.uniffle.test.GetReaderTest
Error:  test  Time elapsed: 3.726 s  <<< FAILURE!
org.opentest4j.AssertionFailedError: expected: <2> but was: <0>
	at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
	at org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)
	at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)
	at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:527)
	at org.apache.uniffle.test.GetReaderTest.test(GetReaderTest.java:171)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)

### Actions URL


https://github.com/apache/incubator-uniffle/pull/2005

https://github.com/apache/incubator-uniffle/actions/runs/10209746228/job/28248239028?pr=2005

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2006/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2015,https://api.github.com/repos/apache/incubator-uniffle/issues/2015,incubator-uniffle,2450045340,2015,[Improvement] Support Netty for MR integration test,qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2024-08-06T06:22:19Z,2024-10-21T06:33:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

As mentioned in #1856, the integration tests for MapReduce tasks currently run only in gRPC mode. We need to extend our test coverage to include Netty.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2015/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2017,https://api.github.com/repos/apache/incubator-uniffle/issues/2017,incubator-uniffle,2450199119,2017,[Improvement] Support config to exclude verbose operation from rpc audit log,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-08-06T07:51:58Z,2024-08-09T03:17:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

upport configs to specify a list of operation name to be an exclude list, when audit rpc call to audit log, check whether the operations contained in this exclude list, if so, ignore it.

### How should we improve?

For example, appheartbeat and heartbeat from node are verbose and waste disk space. As we don't know who want to specify another operation to exclude, so I defined this as a list type config.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2017/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2017,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6HuUJc,incubator-uniffle,2277065308,2017,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-08-09T03:17:00Z,2024-08-09T03:17:00Z,@zuston Thanks for your review!,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6HuUJc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2018,https://api.github.com/repos/apache/incubator-uniffle/issues/2018,incubator-uniffle,2450357991,2018,[DOCS] Add Troubleshooting log documents,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-08-06T09:08:26Z,2024-08-12T07:46:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

_No response_

### Affects Version(s)

master

### Improving the documentation

Describe how to do troubleshooting, it contains how to use server storage audit log, server rpc audit log and coordinator audit log.

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2018/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2020,https://api.github.com/repos/apache/incubator-uniffle/issues/2020,incubator-uniffle,2453060290,2020,[Bug] org.apache.uniffle.common.exception.RssException: There isn't enough shuffle servers,GoodJeek,25895974,,lupeijie2008@126.com,OPEN,2024-08-07T09:50:10Z,2024-09-11T06:54:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```
_[2	at java.lang.Thread.run(Thread.java:750)
[2024-08-07 17:44:49.453] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:44:59.453] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:45:09.440] [ApplicationManager-0] [INFO] ApplicationManager.statusCheck - Start to check status for 0 applications.
[2024-08-07 17:45:09.452] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:45:19.453] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:45:29.453] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:45:39.440] [ApplicationManager-0] [INFO] ApplicationManager.statusCheck - Start to check status for 0 applications.
[2024-08-07 17:45:39.452] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:45:48.579] [Grpc-8] [INFO] CoordinatorGrpcService.getShuffleAssignments - Request of getShuffleAssignments for appId[spark-f958a7892647495a8e01ae93384cf382_1723023715224], shuffleId[0], partitionNum[1],  partitionNumPerRange[1], replica[1], requiredTags[[ss_v4, GRPC]], requiredShuffleServerNumber[-1],faultyServerIds[0]
[2024-08-07 17:45:48.580] [Grpc-8] [ERROR] CoordinatorGrpcService.getShuffleAssignments - Errors on getting shuffle assignments for app: spark-f958a7892647495a8e01ae93384cf382_1723023715224, shuffleId: 0, partitionNum: 1, partitionNumPerRange: 1, replica: 1, requiredTags: [ss_v4, GRPC]
org.apache.uniffle.common.exception.RssException: There isn't enough shuffle servers
	at org.apache.uniffle.coordinator.strategy.assignment.PartitionBalanceAssignmentStrategy.assign(PartitionBalanceAssignmentStrategy.java:138)
	at org.apache.uniffle.coordinator.CoordinatorGrpcService.getShuffleAssignments(CoordinatorGrpcService.java:139)
	at org.apache.uniffle.proto.CoordinatorServerGrpc$MethodHandlers.invoke(CoordinatorServerGrpc.java:1032)
	at io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
	at io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
	at io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
	at io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:351)
	at io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:861)
	at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
	at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
[2024-08-07 17:45:49.453] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:45:59.453] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:46:09.440] [ApplicationManager-0] [INFO] ApplicationManager.statusCheck - Start to check status for 0 applications.
[2024-08-07 17:46:09.452] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:46:19.453] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]
[2024-08-07 17:46:29.453] [SimpleClusterManager-0] [INFO] SimpleClusterManager.nodesCheck - Alive servers number: 3, ids: [10.42.1.0-19997, 10.42.0.0-19997, 10.42.3.0-19997]

```


### Uniffle Engine Log Output

```logtalk
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]
[2024-08-07 17:34:00.924] [main] [INFO] ShuffleServer.main - Start to init shuffle server using config /root/rss-0.9.0-hadoop2.8/conf/server.conf
[2024-08-07 17:34:00.956] [main] [INFO] RssUtils.getPropertiesFromFile - Load config from /root/rss-0.9.0-hadoop2.8/conf/server.conf
[2024-08-07 17:34:01.006] [main] [INFO] RssUtils.getHostIp - ip fe80:0:0:0:ecee:eeff:feee:eeee%calibf4c7ca0288 was filtered, because it don't have effective broadcast address
[2024-08-07 17:34:01.006] [main] [INFO] RssUtils.getHostIp - ip fe80:0:0:0:ecee:eeff:feee:eeee%cali7d3a14c3162 was filtered, because it don't have effective broadcast address
[2024-08-07 17:34:01.006] [main] [INFO] RssUtils.getHostIp - ip fe80:0:0:0:ecee:eeff:feee:eeee%calib1845bcbf52 was filtered, because it don't have effective broadcast address
[2024-08-07 17:34:01.007] [main] [INFO] RssUtils.getHostIp - ip fe80:0:0:0:ecee:eeff:feee:eeee%cali62d5012223a was filtered, because it don't have effective broadcast address
[2024-08-07 17:34:01.007] [main] [INFO] RssUtils.getHostIp - ip fe80:0:0:0:ecee:eeff:feee:eeee%calif391f1f84e0 was filtered, because it don't have effective broadcast address
[2024-08-07 17:34:01.007] [main] [INFO] RssUtils.getHostIp - ip fe80:0:0:0:80c1:c3ff:fe9b:3992%flannel.1 was filtered, because it don't have effective broadcast address
[2024-08-07 17:34:01.008] [org.apache.uniffle.common.util.JvmPauseMonitor$Monitor@59402b8f] [INFO] JvmPauseMonitor.run - Starting JVM pause monitor
[2024-08-07 17:34:01.008] [main] [INFO] RssUtils.getHostIp - ip 10.42.3.0 was candidate, if there is no better choice, we will choose it
[2024-08-07 17:34:01.008] [main] [INFO] RssUtils.getHostIp - ip fe80:0:0:0:d604:e6ff:fe4f:16ea%bond0 was filtered, because it don't have effective broadcast address
[2024-08-07 17:34:01.009] [main] [INFO] RssUtils.getHostIp - ip 10.39.215.220 was filtered, because it's not first effect site local address
[2024-08-07 17:34:01.013] [main] [INFO] ShuffleServer.initServerTags - Server tags: [ss_v5, GRPC]
[2024-08-07 17:34:01.031] [main] [INFO] log.initialized - Logging initialized @2319ms
[2024-08-07 17:34:01.112] [main] [INFO] ShuffleServer.registerMetrics - Register metrics
[2024-08-07 17:34:01.168] [main] [INFO] RPCMetrics.<init> - Init summary observe thread pool, core size:2, max size:20, keep alive time:60
[2024-08-07 17:34:01.175] [main] [INFO] RPCMetrics.<init> - Init summary observe thread pool, core size:2, max size:20, keep alive time:60
[2024-08-07 17:34:01.600] [main] [INFO] LocalStorageManager.<init> - Succeed to initialize storage paths: [/storage/disk2/shuffledata, /storage/disk3/shuffledata, /storage/disk4/shuffledata, /storage/disk5/shuffledata]
[2024-08-07 17:34:01.608] [main] [INFO] CoordinatorClientFactory.createCoordinatorClient - Start to create coordinator clients from 10.39.215.218:19999
[2024-08-07 17:34:02.000] [main] [INFO] CoordinatorGrpcClient.<init> - Created CoordinatorGrpcClient, host:10.39.215.218, port:19999, maxRetryAttempts:3, usePlaintext:true
[2024-08-07 17:34:02.001] [main] [INFO] CoordinatorClientFactory.createCoordinatorClient - Add coordinator client Coordinator grpc client ref to 10.39.215.218:19999
[2024-08-07 17:34:02.004] [main] [INFO] CoordinatorClientFactory.createCoordinatorClient - Finish create coordinator clients Coordinator grpc client ref to 10.39.215.218:19999
[2024-08-07 17:34:02.057] [main] [INFO] DefaultFlushEventHandler.createFlushEventExecutor - CreateFlushPool, poolSize:10, keepAliveTime:5, queueSize:2147483647
[2024-08-07 17:34:02.058] [main] [INFO] DefaultFlushEventHandler.createFlushEventExecutor - CreateFlushPool, poolSize:5, keepAliveTime:5, queueSize:2147483647
[2024-08-07 17:34:02.061] [main] [INFO] ShuffleBufferManager.<init> - Init shuffle buffer manager with capacity: 42949672960, read buffer capacity: 21474836480.
[2024-08-07 17:34:02.103] [main] [INFO] TopNShuffleDataSizeOfAppCalcTask.start - TopNShuffleDataSizeOfAppCalcTask start schedule.
[2024-08-07 17:34:02.121] [main] [INFO] Server.doStart - jetty-9.3.24.v20180605, build timestamp: 2018-06-06T01:11:56+08:00, git hash: 84205aa28f11a4f31f2a3b86d1bba2cc8ab69827
[2024-08-07 17:34:02.156] [main] [INFO] ContextHandler.doStart - Started o.e.j.s.ServletContextHandler@3113a37{/,null,AVAILABLE}
[2024-08-07 17:34:02.176] [main] [INFO] AbstractConnector.doStart - Started ServerConnector@68f644d1{HTTP/1.1,[http/1.1]}{0.0.0.0:19996}
[2024-08-07 17:34:02.176] [main] [INFO] Server.doStart - Started @3466ms
[2024-08-07 17:34:02.176] [main] [INFO] JettyServer.start - Jetty http server started, listening on port 19996
[2024-08-07 17:34:02.516] [main] [INFO] GrpcServer.startOnPort - Grpc server started, configured port: 19997, listening on 19997.
[2024-08-07 17:34:02.516] [main] [INFO] ShuffleServer.start - Start to shuffle server with id 10.42.3.0-19997
[2024-08-07 17:34:02.518] [main] [INFO] RegisterHeartBeat.startHeartBeat - Start heartbeat to coordinator 10.39.215.218:19999 after 10000ms and interval is 10000ms
[2024-08-07 17:34:02.520] [main] [INFO] NettyDirectMemoryTracker.start - Start report direct memory usage to MetricSystem after 10000ms and interval is 10000ms
[2024-08-07 17:34:02.522] [main] [INFO] ShuffleServer.start - Shuffle server start successfully!
```


### Uniffle Server Configurations

```yaml
rss.rpc.server.port 19999
rss.jetty.http.port 19998
rss.coordinator.server.heartbeat.timeout 30000
rss.coordinator.app.expired 60000
rss.coordinator.shuffle.nodes.max 3
#rss.coordinator.exclude.nodes.file.path file:///xxx
rss.coordinator.select.partition.strategy CONTINUOUS
rss.coordinator.dynamicClientConf.enabled false
rss.coordinator.exclude.nodes.file.path /root/rss-0.9.0-hadoop2.8/conf/exclude_nodes
```


### Uniffle Engine Configurations

```yaml
rss.rpc.server.port 19997
rss.jetty.http.port 19996
rss.storage.basePath /storage/disk2/shuffledata,/storage/disk3/shuffledata,/storage/disk4/shuffledata,/storage/disk5/shuffledata
rss.storage.type MEMORY_LOCALFILE
rss.coordinator.quorum 10.39.215.218:19999
rss.server.buffer.capacity 40gb
rss.server.read.buffer.capacity 20gb
rss.server.flush.thread.alive 5
rss.server.flush.localfile.threadPool.size 10
rss.server.flush.hadoop.threadPool.size 60
rss.server.disk.capacity 1t
rss.server.single.buffer.flush.enabled true
rss.server.single.buffer.flush.threshold 128m

rss.server.heartbeat.interval 10000
rss.rpc.message.max.size 1073741824
rss.server.preAllocation.expired 120000
rss.server.commit.timeout 600000
rss.server.app.expired.withoutHeartbeat 120000
```


### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2020/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2020,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LpGvj,incubator-uniffle,2342808547,2020,NA,ChenRussell,23331896,chenrui,,NA,2024-09-11T06:54:06Z,2024-09-11T06:54:06Z,"Your client version is ss_v4, the server version is ss_v5, you should update you client jar","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LpGvj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2021,https://api.github.com/repos/apache/incubator-uniffle/issues/2021,incubator-uniffle,2454739509,2021,[Subtask] move the rest-client from cli module to common module,xianjingfeng,11752250,,,OPEN,2024-08-08T02:26:25Z,2024-08-08T02:26:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

The coordinator module need the rest-client too, So move the rest client from cli module to common module.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/1941

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2021/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2025,https://api.github.com/repos/apache/incubator-uniffle/issues/2025,incubator-uniffle,2456959376,2025,[Improvement] Fix typo issue as a batch,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-08-09T02:11:53Z,2024-08-14T06:36:34Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

There are typo issues within uniffle, it is normal, but we should fix them.

But if we fix typo issue within many commits, it can be noisy, so I propose to fix them as batch as possible.

Welcome to reply the typo issue here, and I will fix it together.

After this, I hope introduce a spell checker ci check(I don't know how to accomplish it)

### How should we improve?

- @return The option' value class -> remove '
- some of the interfaces --> some  interfaces
- more then one -> more than one
- allows to reduce tasks
- we creates -》 we create
- is enable -> is enabled
- LIST_SPILTTER -> LIST_SPLITTER
- ""], blockid["" -> ""], blockId[""
- reourcePackages -> resourcePackages
- RSS_DATA_TRANFER_POOL_SIZE_DEFAULT_VALUE -> RSS_DATA_TRANSFER_POOL_SIZE_DEFAULT_VALUE
- configration -> configuration
- wasDecomissioning -> wasDecommissioning
- wasDecomissioned -> wasDecommissioned
- ...

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2025/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2030,https://api.github.com/repos/apache/incubator-uniffle/issues/2030,incubator-uniffle,2458827205,2030,[Bug] spark on yarn throws NoClassDefFoundError ,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-08-10T00:50:54Z,2024-09-20T03:37:30Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Information from @zhengchenyu 

```
Exception in thread ""main"" java.lang.NoClassDefFoundError: org/apache/uniffle/shaded/javax/xml/stream/XMLStreamException
	at org.apache.spark.deploy.SparkHadoopUtil$.newConfiguration(SparkHadoopUtil.scala:426)
	at org.apache.spark.deploy.SparkSubmit.$anonfun$prepareSubmitEnvironment$2(SparkSubmit.scala:342)
	at scala.Option.getOrElse(Option.scala:189)
	at org.apache.spark.deploy.SparkSubmit.prepareSubmitEnvironment(SparkSubmit.scala:342)
	at org.apache.spark.deploy.SparkSubmit.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:871)
	at org.apache.spark.deploy.SparkSubmit.doRunMain$1(SparkSubmit.scala:180)
	at org.apache.spark.deploy.SparkSubmit.submit(SparkSubmit.scala:203)
	at org.apache.spark.deploy.SparkSubmit.doSubmit(SparkSubmit.scala:90)
	at org.apache.spark.deploy.SparkSubmit$$anon$2.doSubmit(SparkSubmit.scala:1007)
	at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:1016)
	at org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)
Caused by: java.lang.ClassNotFoundException: org.apache.uniffle.shaded.javax.xml.stream.XMLStreamException
	at java.net.URLClassLoader.findClass(URLClassLoader.java:382)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:418)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:355)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:351)
	... 11 more
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

```logtalk
Exception in thread ""main"" java.lang.NoClassDefFoundError: org/apache/uniffle/shaded/javax/xml/stream/XMLStreamException
  at org.apache.spark.deploy.yarn.ApplicationMaster$.main(ApplicationMaster.scala:858)
  at org.apache.spark.deploy.yarn.ExecutorLauncher$.main(ApplicationMaster.scala:921)
  at org.apache.spark.deploy.yarn.ExecutorLauncher.main(ApplicationMaster.scala)
Caused by: java.lang.ClassNotFoundException: org.apache.uniffle.shaded.javax.xml.stream.XMLStreamException
  at java.net.URLClassLoader.findClass(URLClassLoader.java:382)
  at java.lang.ClassLoader.loadClass(ClassLoader.java:418)
  at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:355)
  at java.lang.ClassLoader.loadClass(ClassLoader.java:351)
  ... 3 more
```
```


### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2030/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6H1asQ,incubator-uniffle,2278927120,2030,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-08-10T01:29:13Z,2024-08-10T01:29:13Z,"The Configuration of hadoop-2.8 does not import XMLStreamException, but hadoop-3.2 does. So it seems that this problem only occurs when using hadoop-3.2.
When I remove the relocation for javax, job works.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6H1asQ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6H1gip,incubator-uniffle,2278951081,2030,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-08-10T02:49:40Z,2024-08-10T02:49:40Z,"@zhengchenyu Thanks for your extra information, I decompile the spark rss shaded client jar, and find that there are no `javax/xml/stream/**` within fat jar, but relocated by shaded plugins.

<img width=""628"" alt=""image"" src=""https://github.com/user-attachments/assets/15b7a135-9086-4f3b-9c94-c3d45cfbb815"">

I believe this is the root cause of this issue.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6H1gip/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IFslo,incubator-uniffle,2283194728,2030,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-08-12T06:27:35Z,2024-08-12T06:27:35Z,"When I remote the relocation for javax, job works. But I see the docker ci still fail for branch-0.9. When I revert pr 1878, docker ci works.

I am now setting up a docker ci environment on my server to see why docker ci fails

docker ci fail link: https://github.com/apache/incubator-uniffle/actions/runs/10314743478/job/28631204182","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IFslo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2030,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IGOIy,incubator-uniffle,2283332146,2030,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-08-12T08:02:46Z,2024-08-12T08:02:46Z,"I have set up a docker ci environment, and add some debug log, found these error.

```
java.lang.NoClassDefFoundError: org/apache/uniffle/shaded/org/apache/commons/collections/CollectionUtils
 at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.genServerToBlocks(ShuffleWriteClientImpl.java:281)
 at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.sendShuffleData(ShuffleWriteClientImpl.java:339)
 at org.apache.spark.shuffle.writer.DataPusher.lambda$send$3(DataPusher.java:96)
 at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(Unknown Source)
 at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
 at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
 at java.base/java.lang.Thread.run(Unknown Source)
Caused by: java.lang.ClassNotFoundException: org.apache.uniffle.shaded.org.apache.commons.collections.CollectionUtils
 at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(Unknown Source)
 at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(Unknown Source)
 at java.base/java.lang.ClassLoader.loadClass(Unknown Source)
 ... 7 more
```

The reason is that in branch-0.9 dose not upgrade commons-collections to 4.4, so use collections3 by spark dependency.
But pr 1878 relocation ""org.apache"" to ""${rss.shade.packageName}.org.apache"". collections3 is spark package does not relocation. so throw java.lang.NoClassDefFoundError. 

If uniffle calls a class that is not explicitly specified in the uniffle pom file, it may be dependent on a dependent framework (spark or mr or tez). At this time, if this class is relocated, the relocated class cannot be found.

For me, At least branch-0.9 revert pr 1878 is required.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6IGOIy/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2035,https://api.github.com/repos/apache/incubator-uniffle/issues/2035,incubator-uniffle,2462348124,2035,"[Improvement] Fix CentOS 7 ""Cannot find a valid baseurl for repo"" error.",qijiale76,21970289,"QI, Jiale",qijiale76@foxmail.com,CLOSED,2024-08-13T04:15:15Z,2024-08-23T09:08:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The current Dockerfile fails to build due to CentOS 7 reaching EOL and its mirrors being moved to the vault. This issue updates the Dockerfile to resolve the ""Cannot find a valid baseurl for repo"" error.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2035/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2039,https://api.github.com/repos/apache/incubator-uniffle/issues/2039,incubator-uniffle,2462772574,2039,[Bug] Docker image build script with Hadoop3.2 does not work with Netty and Epoll,EnricoMi,44700269,Enrico Minack,github@enrico.minack.dev,OPEN,2024-08-13T08:48:10Z,2024-08-13T08:48:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Building a docker image via `deploy/kubernetes/docker/build.sh --hadoop-version 3.2.4` and using that with Netty and Epoll fails because the image contains the Hadoop binaries, which contain a different `netty-all` jar then the RSS shuffle server.

This can be fixed by
- either not include the Hadoop binaries in the Docker image
- or by downgrading Netty version to match the version contained in the Hadoop binaries

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
Exception in thread ""main"" java.lang.UnsatisfiedLinkError: failed to load the required native library
	at io.netty.channel.epoll.Epoll.ensureAvailability(Epoll.java:81)
	at io.netty.channel.epoll.EpollEventLoop.<clinit>(EpollEventLoop.java:57)
	at io.netty.channel.epoll.EpollEventLoopGroup.newChild(EpollEventLoopGroup.java:189)
	at io.netty.channel.epoll.EpollEventLoopGroup.newChild(EpollEventLoopGroup.java:37)
	at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:84)
	at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:60)
	at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:49)
	at io.netty.channel.MultithreadEventLoopGroup.<init>(MultithreadEventLoopGroup.java:59)
	at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:117)
	at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:104)
	at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:81)
	at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:57)
	at org.apache.uniffle.server.netty.StreamServer.<init>(StreamServer.java:88)
	at org.apache.uniffle.server.ShuffleServer.initialization(ShuffleServer.java:300)
	at org.apache.uniffle.server.ShuffleServer.<init>(ShuffleServer.java:113)
	at org.apache.uniffle.server.ShuffleServer.main(ShuffleServer.java:131)
Caused by: java.lang.ExceptionInInitializerError
	at io.netty.channel.epoll.Epoll.<clinit>(Epoll.java:40)
	... 15 more
Caused by: java.lang.IllegalStateException: Multiple resources found for 'META-INF/native/libnetty_transport_native_epoll_x86_64.so' with different content: [jar:file:/data/rssadmin/rss/jars/server/netty-transport-native-epoll-4.1.109.Final-linux-x86_64.jar!/META-INF/native/libnetty_transport_native_epoll_x86_64.so, jar:file:/data/rssadmin/hadoop/share/hadoop/hdfs/lib/netty-all-4.1.68.Final.jar!/META-INF/native/libnetty_transport_native_epoll_x86_64.so]
	at io.netty.util.internal.NativeLibraryLoader.getResource(NativeLibraryLoader.java:301)
	at io.netty.util.internal.NativeLibraryLoader.load(NativeLibraryLoader.java:173)
	at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:334)
	at io.netty.channel.epoll.Native.<clinit>(Native.java:96)
	... 16 more
```
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2039/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2043,https://api.github.com/repos/apache/incubator-uniffle/issues/2043,incubator-uniffle,2465166792,2043,[Improvement] Supply a script to check shaded jar which have relocated but not exist class,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-08-14T08:03:57Z,2024-09-21T00:51:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Now we cannot prevent developer using a dependency which have provided scope directly or indirectly, we may relocate a package name something like a.b.c to org.apache.uniffle.shaded.a.b.c, but we could use a class a.b.c.d.MyClass which is in a provided dependency, so it could be relocated to `org.apache.uniffle.shaded.a.b.c.d` too, but this is not what we want, the MyClass should be provided out of uniffle.

If we do not find and resolve this, we could encounter a ClassNotFound Exception, so developer have to do some efforts to defeat this issue, maybe we can add a `<execlude>a/b/c/d/**/*</execlude>` to the configuration of shaded plugin.

So this issue introduce a way to check and find the relocated but not exist class within shaded jar, developer can find the missing list and add it to exclude if check failed.

### How should we improve?

We should provide a high-quality shaded jar to user which rare to encounter ClassNotFound and MethodNotDef issue to user.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!

### Apporach

- script
```shell
#!/bin/bash

# Constants
PROCYON_JAR_URL=""https://github.com/mstrobel/procyon/releases/download/v0.6.0/procyon-decompiler-0.6.0.jar""
PROCYON_JAR_PATH=""/tmp/procyon-decompiler-0.6.0.jar""
DECOMPILE_OUTPUT_DIR=""/tmp/uniffle-shaded-client-decompile""
SHADOWED_CLIENT_IMPORTS_LIST=""$DECOMPILE_OUTPUT_DIR/shaded.list""
SHADOWED_PACKAGE=""org.apache.uniffle.shaded""

# Function to check missing imports
check_missing_imports() {
    if [ ""$#"" -ne 1 ]; then
        echo ""Usage: $0 <input_file>""
        exit 1
    fi

    INPUT_FILE=""$1""

    while IFS= read -r line
    do
        class_path=$(echo ""$line"" | sed -n 's/^import \(.*\);$/\1/p')
        file_path=""${DECOMPILE_OUTPUT_DIR}/${class_path//.//}.java""

        if [ ! -f ""$file_path"" ]; then
            echo ""Missing: $class_path should be at $file_path""
        fi
    done < ""$INPUT_FILE""
}

# Clean up previous runs
clean_up() {
    for file in ""$PROCYON_JAR_PATH"" ""$DECOMPILE_OUTPUT_DIR"" ""$SHADOWED_CLIENT_IMPORTS_LIST""; do
        if [ -e ""$file"" ]; then
            rm -rf ""$file""
        fi
    done
}

# Download Procyon
wget -q ""$PROCYON_JAR_URL"" -O ""$PROCYON_JAR_PATH""

# Decompile uniffle shaded client and find import lines
java -jar ""$PROCYON_JAR_PATH"" ""$1"" -o ""$DECOMPILE_OUTPUT_DIR""
find ""$DECOPILE_OUTPUT_DIR"" -name ""*.java"" -print0 | xargs -0 grep -h ""import $SHADOWED_PACKAGE.*"" | sort | uniq > ""$SHADOWED_CLIENT_IMPORTS_LIST""

# Start check
check_missing_imports ""$SHADOWED_CLIENT_IMPORTS_LIST""
```

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2043/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2044,https://api.github.com/repos/apache/incubator-uniffle/issues/2044,incubator-uniffle,2465394918,2044,[Improvement] Remove console from log4j2.xml.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-08-14T09:53:52Z,2024-08-19T03:13:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In the case of physical machine deployment, logs are directly printing the console after the service is started. This is not necessary. Perhaps console is useful for a k8s deployment, But there is no need to print the log twice.


### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2044/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2046,https://api.github.com/repos/apache/incubator-uniffle/issues/2046,incubator-uniffle,2465786182,2046,Rename `RSS_CLIENT_TYPE` in RssBaseConf to `COORDINATOR_CLIENT_TYPE`,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2024-08-14T13:06:28Z,2024-08-19T03:11:18Z,"              We could rename `RSS_CLIENT_TYPE` in RssBaseConf to `COORDINATOR_CLIENT_TYPE`.

_Originally posted by @xumanbu in https://github.com/apache/incubator-uniffle/pull/2004#discussion_r1701377607_
            ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2046/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2048,https://api.github.com/repos/apache/incubator-uniffle/issues/2048,incubator-uniffle,2467155759,2048,[FEATURE] Display the dashboard information,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-08-15T01:51:18Z,2024-08-22T11:58:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Display the dashboard information in the dashboard home page.

### Motivation

Now, we displayed the information of server\application\coordinator, but not dashboard itself, we cannot get the version and start time of dashboard, so we cannot determine whether we restart/upgrade dashboard successfully.

This is a first step of dashboard page, based on this, we can add more information about dashboard if necessary, e.g. conf\stacks\metrics\logs and so on.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2048/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2052,https://api.github.com/repos/apache/incubator-uniffle/issues/2052,incubator-uniffle,2467493913,2052,[Umbrella] Release 0.9.1,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-08-15T06:25:28Z,2024-12-23T02:41:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)

### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.

### Describe the proposal

Release Apache Uniffle 0.9.1, we would like to release binary package. There are many things to do. First, we should ensure what issues should be included in this version.

### Task list

- [] Tag and release `v0.9.1-rc1`.
    - [x] Backport necessary fixes from `master` to `branch-0.9`.
        - [x] https://github.com/apache/incubator-uniffle/milestone/4
    - [x] Bump project version to `0.9.1` in `branch-0.9`.
    - [x] (GitHub) Tag `v0.9.1-rc1`:
        - https://github.com/apache/incubator-uniffle/releases/tag/v0.9.1-rc1
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.9.1-rc1/`:
        - https://dist.apache.org/repos/dist/dev/incubator/uniffle/0.9.1-rc1/
    - [x] Post release note on [Uniffle website][1]:
    - [x] Vote on dev@uniffle.apache.org
- [] Tag and release `v0.9.1-rc2`.
    - [x] (GitHub) Tag `v0.9.1-rc2`:
        - https://github.com/apache/incubator-uniffle/releases/tag/v0.9.1-rc2
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.9.1-rc2/`:
        - https://dist.apache.org/repos/dist/dev/incubator/uniffle/0.9.1-rc2/
    - [x] Post release note on [Uniffle website][1]:
    - [x] Vote on dev@uniffle.apache.org
    - [x] Vote on general@incubator.apache.org
- [] Tag and release `0.9.1`.
    - [x] (SVN) Move the artifacts under `dev/.../0.9.1-rc1` to `release/.../0.9.1` (by PPMC).
    - [x] (GitHub) Tag `v0.9.1` to `v0.9.1-rc1` and upload the artifacts.
    - [x] Update download link on [Uniffle website][1]:
    - [x] Post an announcement on general@incubator.apache.org

[1]: https://github.com/apache/incubator-uniffle-website

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2052/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2054,https://api.github.com/repos/apache/incubator-uniffle/issues/2054,incubator-uniffle,2468007496,2054,[DOCS] Introduce the client timeout and retry max related config and match scenario,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-08-15T12:59:15Z,2024-08-15T12:59:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

_No response_

### Affects Version(s)

master

### Improving the documentation

Now, we have so many config related to client, part of them are xxx timeout, retryMax, we need a document to show what scenario should use a different config suite.

### Anything else

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2054/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2056,https://api.github.com/repos/apache/incubator-uniffle/issues/2056,incubator-uniffle,2469855820,2056,[Improvement] Add a NONE type to `compression.codec`,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2024-08-16T09:13:00Z,2024-08-20T02:48:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When using uniffle with Gluten, I found it difficult to enable compression only on the native side. Because they both judge whether to enable compression based on `spark.shuffle.compress`, when we enable it, Uniffle always has a default compression, resulting in repeated compression. So I want to add a `NONE` type to `compression.codec`.

### How should we improve?

 Add a `NONE` type to `compression.codec`

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2056/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2060,https://api.github.com/repos/apache/incubator-uniffle/issues/2060,incubator-uniffle,2472701153,2060,[Bug] memory leak when reach memory limit ,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-08-19T07:55:02Z,2024-10-21T08:17:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

memory leak when reach memory limit 

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[2024-08-08 20:49:31.754] [epollEventLoopGroup-3-2] [ERROR] ShuffleServerNettyHandler - exception caught /*:38381
io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 65536 byte(s) of direct memory (used: 17179815063, max: 17179869184)
        at io.netty.util.internal.PlatformDependent.incrementMemoryCounter(PlatformDependent.java:843)
        at io.netty.util.internal.PlatformDependent.allocateDirectNoCleaner(PlatformDependent.java:772)
        at io.netty.buffer.UnpooledUnsafeNoCleanerDirectByteBuf.allocateDirect(UnpooledUnsafeNoCleanerDirectByteBuf.java:30)
        at io.netty.buffer.UnpooledByteBufAllocator$InstrumentedUnpooledUnsafeNoCleanerDirectByteBuf.allocateDirect(UnpooledByteBufAllocator.java:186)
        at io.netty.buffer.UnpooledDirectByteBuf.<init>(UnpooledDirectByteBuf.java:64)        at io.netty.buffer.UnpooledUnsafeDirectByteBuf.<init>(UnpooledUnsafeDirectByteBuf.java:41)
        at io.netty.buffer.UnpooledUnsafeNoCleanerDirectByteBuf.<init>(UnpooledUnsafeNoCleanerDirectByteBuf.java:25)
        at io.netty.buffer.UnpooledByteBufAllocator$InstrumentedUnpooledUnsafeNoCleanerDirectByteBuf.<init>(UnpooledByteBufAllocator.java:181)
        at io.netty.buffer.UnpooledByteBufAllocator.newDirectBuffer(UnpooledByteBufAllocator.java:91)
        at io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:188)
        at io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:179)
        at io.netty.channel.unix.PreferredDirectByteBufAllocator.ioBuffer(PreferredDirectByteBufAllocator.java:53)
        at io.netty.channel.DefaultMaxMessagesRecvByteBufAllocator$MaxMessageHandle.allocate(DefaultMaxMessagesRecvByteBufAllocator.java:120)
        at io.netty.channel.epoll.EpollRecvByteAllocatorHandle.allocate(EpollRecvByteAllocatorHandle.java:75)
        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:786)
        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:501)
        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:399)
        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
        at java.lang.Thread.run(Thread.java:750)
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2060/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2061,https://api.github.com/repos/apache/incubator-uniffle/issues/2061,incubator-uniffle,2472704581,2061,[Bug] netty memory leak when removeBuffer and cacheShuffleData happen concurrent,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-08-19T07:56:36Z,2024-10-15T03:57:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

netty memory leak when removeBuffer and cacheShuffleData happen concurrent

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2061/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2062,https://api.github.com/repos/apache/incubator-uniffle/issues/2062,incubator-uniffle,2472829882,2062,[FEATURE] Display more detailed information for application in dashboard ui.,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,OPEN,2024-08-19T08:56:39Z,2024-10-21T08:01:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Show detailed info for application in dashboard ui.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2062/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2064,https://api.github.com/repos/apache/incubator-uniffle/issues/2064,incubator-uniffle,2473069447,2064,[Umbrella] Fix UTs to use random port instead of constant port to avoid port in used,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-08-19T10:55:40Z,2025-01-03T07:32:41Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Run UTs may encounter port already bind exception if your test node run another uniffle or process with same port.

We can use random port instead of constant port.

### Task list

- [x] #2065
- [x] #2068

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2064/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2064,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZHA6L,incubator-uniffle,2568752779,2064,NA,cchung100m,6762509,Neo Chien,,NA,2025-01-03T06:34:51Z,2025-01-03T06:34:51Z,"Hi @maobaolong 

Thanks for pointing out these issues and submitting a PR to correct them. Should we close this ticket if all issues had fixed?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZHA6L/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2064,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZHLkj,incubator-uniffle,2568796451,2064,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2025-01-03T07:32:40Z,2025-01-03T07:32:40Z,"In fact there are still some issue about this, but I have no bandwidth on this, you can feel free to close or left it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZHLkj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2065,https://api.github.com/repos/apache/incubator-uniffle/issues/2065,incubator-uniffle,2473071393,2065,[Subtask] Fix QuorumTest to use random port,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-08-19T10:56:36Z,2024-09-11T11:09:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Fix QuorumTest to use random port

### Parent issue

#2064

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2065/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2068,https://api.github.com/repos/apache/incubator-uniffle/issues/2068,incubator-uniffle,2474578786,2068,[Subtask] Fix JettyServerTest to use random port,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-08-20T02:16:33Z,2024-08-28T06:17:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

Use random port for test instead of constant port to avoid port in use while executing UTs.

### Parent issue

https://github.com/apache/incubator-uniffle/issues/2064

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2068/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2069,https://api.github.com/repos/apache/incubator-uniffle/issues/2069,incubator-uniffle,2474613897,2069,[Improvement] `NoOpCodec.decompress` should not reset the position and limit of dest buffer,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2024-08-20T02:58:10Z,2024-08-20T03:59:33Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Remove reset dest buffer position and limit in decompress method of NoOpCodec

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2069/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2073,https://api.github.com/repos/apache/incubator-uniffle/issues/2073,incubator-uniffle,2477608461,2073,[Bug] The flush event is directly dropped when there is no write permission for the disk,xianjingfeng,11752250,,,CLOSED,2024-08-21T09:58:10Z,2024-09-02T09:37:15Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The flush event is directly dropped when there is no write permission for the disk

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
[2024-08-21 01:36:54.139] [LocalFileFlushEventThreadPool-43] [ERROR] DefaultFlushEventHandler.handleEventAndUpdateMetrics - Unexpected exceptions happened when handling the flush
 event: ShuffleDataFlushEvent: eventId=50758, appId=application_1710412492003_60669985_1724174489876, shuffleId=2, startPartition=1722, endPartition=1722, retryTimes=0, underStor
age=LocalStorage, isPended=false, ownedByHugePartition=true, due to
org.apache.uniffle.common.exception.RssException: Failed to create shuffle folder: /HDATA/3/rssdata2/application_1710412492003_60669985_1724174489876/2/1722-1722
Caused by: java.nio.file.AccessDeniedException: /HDATA/3/rssdata2/
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2073/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2076,https://api.github.com/repos/apache/incubator-uniffle/issues/2076,incubator-uniffle,2479644828,2076,[FEATURE] Add NettyMemoryMetrics for netty client and server,xumanbu,9135743,xumanbu,manbu.feng@163.com,OPEN,2024-08-22T02:39:20Z,2024-08-22T12:01:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We should include `NettyMemoryMetrics` to enhance memory metrics for `PooledByteBufAllocator`. https://github.com/apache/spark/blob/master/common/network-common/src/main/java/org/apache/spark/network/util/NettyMemoryMetrics.java

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2076/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2076,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JW9AG,incubator-uniffle,2304495622,2076,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-08-22T12:01:28Z,2024-08-22T12:01:28Z,Sounds good. ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JW9AG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2077,https://api.github.com/repos/apache/incubator-uniffle/issues/2077,incubator-uniffle,2479858837,2077,[Improvement] Use a fixed java version in the release scripts,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2024-08-22T05:15:42Z,2024-08-22T08:05:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The following error was found when executing integration tests in Gluten:

```
Caused by: org.apache.gluten.exception.GlutenException: Exception: VeloxRuntimeError
Error Source: RUNTIME
Error Code: INVALID_STATE
Reason: Operator::getOutput failed for [operator: ValueStream, plan node ID: 0]: Error during calling Java code from native code: java.lang.NoSuchMethodError: java.nio.ByteBuffer.position(I)Ljava/nio/ByteBuffer;
	at org.apache.uniffle.common.util.ChecksumUtils.getCrc32(ChecksumUtils.java:50)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:242)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:307)
	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
	at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
	at scala.collection.convert.Wrappers$IteratorWrapper.hasNext(Wrappers.scala:32)
	at org.apache.gluten.vectorized.GeneralInIterator.hasNext(GeneralInIterator.java:31)
	at org.apache.gluten.vectorized.ColumnarBatchOutIterator.nativeHasNext(Native Method)
	at org.apache.gluten.vectorized.ColumnarBatchOutIterator.hasNextInternal(ColumnarBatchOutIterator.java:61)
	at org.apache.gluten.vectorized.GeneralOutIterator.hasNext(GeneralOutIterator.java:37)
	at scala.collection.convert.Wrappers$JIteratorWrapper.hasNext(Wrappers.scala:45)
	at org.apache.gluten.utils.iterator.IteratorsV1$InvocationFlowProtection.hasNext(IteratorsV1.scala:159)
	at org.apache.gluten.utils.iterator.IteratorsV1$IteratorCompleter.hasNext(IteratorsV1.scala:71)
	at org.apache.gluten.utils.iterator.IteratorsV1$PayloadCloser.hasNext(IteratorsV1.scala:37)
	at org.apache.gluten.utils.iterator.IteratorsV1$LifeTimeAccumulator.hasNext(IteratorsV1.scala:100)
	at scala.collection.Iterator.isEmpty(Iterator.scala:387)
	at scala.collection.Iterator.isEmpty$(Iterator.scala:387)
	at org.apache.gluten.utils.iterator.IteratorsV1$LifeTimeAccumulator.isEmpty(IteratorsV1.scala:90)
	at org.apache.gluten.execution.VeloxColumnarToRowExec$.toRowIterator(VeloxColumnarToRowExec.scala:124)
	at org.apache.gluten.execution.VeloxColumnarToRowExec.$anonfun$doExecuteInternal$1(VeloxColumnarToRowExec.scala:79)
	at org.apache.spark.rdd.RDD.$anonfun$mapPartitions$2(RDD.scala:863)
	at org.apache.spark.rdd.RDD.$anonfun$mapPartitions$2$adapted(RDD.scala:863)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:337)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
	at org.apache.spark.scheduler.Task.run(Task.scala:131)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:506)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1491)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:509)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
```

`java.lang.NoSuchMethodError: java.nio.ByteBuffer.position(I)Ljava/nio/ByteBuffer;` is because uniffle 0.9.0 was released using `JDK11` for compilation and push, , and JDK8 was used in gluten CI.

So we can check and use a fixed java version in the release scripts.

### How should we improve?

Check if JDK8 is used for compilation in release scripts

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2077/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2077,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JUUQO,incubator-uniffle,2303804430,2077,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-08-22T05:17:06Z,2024-08-22T05:17:06Z,Similar to https://github.com/apache/kyuubi/pull/5308,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JUUQO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2077,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JVNUf,incubator-uniffle,2304038175,2077,NA,wForget,17894939,Zhen Wang,wangzhen@apache.org,NA,2024-08-22T08:05:32Z,2024-08-22T08:05:32Z,Duplicate #1982,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JVNUf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2081,https://api.github.com/repos/apache/incubator-uniffle/issues/2081,incubator-uniffle,2480634087,2081,[Improvement] Independent rust based shuffle server project,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-08-22T12:12:47Z,2024-09-18T09:30:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

I hope the rust based shuffle-server could be as a independent project, like the paimon-rust? I don't hope the rust CI/release blocked the master branch development. BTW, the independent project will speed up the release and development.

BTW, I think I will devote this in the next months. I'm always optimizing this in my forked branch.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2081/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2081,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JXCok,incubator-uniffle,2304518692,2081,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-08-22T12:13:02Z,2024-08-22T12:13:02Z,cc @jerqi @advancedxy . ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JXCok/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2081,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JX1_n,incubator-uniffle,2304729063,2081,NA,advancedxy,807537,,,NA,2024-08-22T13:51:17Z,2024-08-22T13:51:17Z,"I'm slightly prefer to keep rust code in this repo but have no objection to move it to an independent project.
However, if you want to move it to a independent project, I think you should sent a discuss thread to the dev mail list and go through the donation(/ip clearance) process? I'm not sure.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6JX1_n/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2081,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L_1Le,incubator-uniffle,2348765918,2081,NA,Xuanwo,5351546,Xuanwo,github@xuanwo.io,NA,2024-09-13T11:47:38Z,2024-09-13T11:47:38Z,"> However, if you want to move it to a independent project, I think you should sent a discuss thread to the dev mail list and go through the donation(/ip clearance) process? I'm not sure.

The `rust/experimental/server` folder currently exists in `incubator-uniffle`, so I believe we don't need the IP clearance process. What we need to discuss is whether to split it into another project. A natural choice might be `incubator-uniffle-rust-server`. We can discuss this on the dev list.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L_1Le/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2081,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MinFB,incubator-uniffle,2357883201,2081,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-09-18T08:53:57Z,2024-09-18T08:53:57Z,"> > However, if you want to move it to a independent project, I think you should sent a discuss thread to the dev mail list and go through the donation(/ip clearance) process? I'm not sure.
> 
> The `rust/experimental/server` folder currently exists in `incubator-uniffle`, so I believe we don't need the IP clearance process. What we need to discuss is whether to split it into another project. A natural choice might be `incubator-uniffle-rust-server`. We can discuss this on the dev list.

Thanks for your attension about this sub project, the initial motivation of separation is to speed up the whole development of rust-based server. WDYT about this seperation @jerqi @advancedxy .

> A natural choice might be incubator-uniffle-rust-server. We can discuss this on the dev list.

The project name is OK for me. If OK for other PMCs, I think I could discuss this in the mail list","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MinFB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2081,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Mi2uW,incubator-uniffle,2357947286,2081,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-09-18T09:23:06Z,2024-09-18T09:23:06Z,"> > > However, if you want to move it to a independent project, I think you should sent a discuss thread to the dev mail list and go through the donation(/ip clearance) process? I'm not sure.
> > 
> > 
> > The `rust/experimental/server` folder currently exists in `incubator-uniffle`, so I believe we don't need the IP clearance process. What we need to discuss is whether to split it into another project. A natural choice might be `incubator-uniffle-rust-server`. We can discuss this on the dev list.
> 
> Thanks for your attension about this sub project, the initial motivation of separation is to speed up the whole development of rust-based server. WDYT about this seperation @jerqi @advancedxy .
> 
> > A natural choice might be incubator-uniffle-rust-server. We can discuss this on the dev list.
> 
> The project name is OK for me. If OK for other PMCs, I think I could discuss this in the mail list

Why will the separation speed up the whole development? The other separation projects will rely different release lifecycles.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Mi2uW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2081,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Mi6ar,incubator-uniffle,2357962411,2081,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-09-18T09:30:09Z,2024-09-18T09:30:09Z,"I hope I could get the push/merge privillege for the independent sub-project, that will make me to speed up the commit/develop for me","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Mi6ar/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,incubator-uniffle,2480663311,2082,[Bug]  spark executor task error when reading shuffle data when using  java open jdk11,ChenRussell,23331896,chenrui,,OPEN,2024-08-22T12:27:20Z,2024-12-13T07:36:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I use **openjdk 11** in spark image, and I get errors when spark task reading shuffle data from uniffle server, here is the executor task error log:
![image](https://github.com/user-attachments/assets/a9d49e20-50a4-4c8f-8873-e9329b6fa744)


### Affects Version(s)

0.9.0

### Uniffle Server Log Output

```logtalk
no error message
```


### Uniffle Engine Log Output

```logtalk
java.lang.reflect.InvocationTargetException
    at java.base/jdk.internal.reflect.GeneratedMethodAccessor24.invoke(Unknown Source)
    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
    at java.base/java.lang.reflect.Method.invoke(Unknown Source)
    at org.apache.uniffle.io.netty.util.internal.CleanerJava9.freeDirectBuffer(CleanerJava9.java:88)
    at org.apache.uniffle.io.netty.util.internal.PlatformDependent.freeDirectBuffer(PlatformDependent.java:521)
    at org.apache.uniffle.common.util.RssUtils.releaseByteBuffer(RssUtils.java:414)
    at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:314)
    at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:216)
    at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
    at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
    at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:307)
    at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
    at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
    at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage2.hashAgg_doAggregateWithKeys_0$(Unknown Source)
    at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage2.processNext(Unknown Source)
    at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)
    at org.apache.spark.sql.execution.WholeStageCodegenEvaluatorFactory$WholeStageCodegenPartitionEvaluator$$anon$1.hasNext(WholeStageCodegenEvaluatorFactory.scala:43)
    at scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
    at scala.collection.Iterator.isEmpty(Iterator.scala:387)
    at scala.collection.Iterator.isEmpty$(Iterator.scala:387)
    at scala.collection.AbstractIterator.isEmpty(Iterator.scala:1431)
    at scala.collection.TraversableOnce.nonEmpty(TraversableOnce.scala:143)
    at scala.collection.TraversableOnce.nonEmpty$(TraversableOnce.scala:143)
    at scala.collection.AbstractIterator.nonEmpty(Iterator.scala:1431)
    at org.apache.spark.rdd.RDD.$anonfun$takeOrdered$2(RDD.scala:1559)
    at org.apache.spark.rdd.RDD.$anonfun$takeOrdered$2$adapted(RDD.scala:1558)
    at org.apache.spark.rdd.RDD.$anonfun$mapPartitionsWithIndex$2(RDD.scala:910)
    at org.apache.spark.rdd.RDD.$anonfun$mapPartitionsWithIndex$2$adapted(RDD.scala:910)
    at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
    at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
    at org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
    at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:93)
    at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
    at org.apache.spark.scheduler.Task.run(Task.scala:141)
    at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
    at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
    at org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
    at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
    at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
    at java.base/java.lang.Thread.run(Unknown Source)
    Suppressed: org.apache.spark.util.TaskCompletionListenerException: null

Previous exception in task: null
    java.base/jdk.internal.reflect.GeneratedMethodAccessor24.invoke(Unknown Source)
    java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
    java.base/java.lang.reflect.Method.invoke(Unknown Source)
    org.apache.uniffle.io.netty.util.internal.CleanerJava9.freeDirectBuffer(CleanerJava9.java:88)
    org.apache.uniffle.io.netty.util.internal.PlatformDependent.freeDirectBuffer(PlatformDependent.java:521)
    org.apache.uniffle.common.util.RssUtils.releaseByteBuffer(RssUtils.java:414)
    org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:314)
    org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:216)
    org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115)
    org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31)
    org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:307)
    org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37)
    scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
    org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage2.hashAgg_doAggregateWithKeys_0$(Unknown Source)
    org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage2.processNext(Unknown Source)
    org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)
    org.apache.spark.sql.execution.WholeStageCodegenEvaluatorFactory$WholeStageCodegenPartitionEvaluator$$anon$1.hasNext(WholeStageCodegenEvaluatorFactory.scala:43)
    scala.collection.Iterator$$anon$10.hasNext(Iterator.scala:460)
    scala.collection.Iterator.isEmpty(Iterator.scala:387)
    scala.collection.Iterator.isEmpty$(Iterator.scala:387)
    scala.collection.AbstractIterator.isEmpty(Iterator.scala:1431)
    scala.collection.TraversableOnce.nonEmpty(TraversableOnce.scala:143)
    scala.collection.TraversableOnce.nonEmpty$(TraversableOnce.scala:143)
    scala.collection.AbstractIterator.nonEmpty(Iterator.scala:1431)
    org.apache.spark.rdd.RDD.$anonfun$takeOrdered$2(RDD.scala:1559)
    org.apache.spark.rdd.RDD.$anonfun$takeOrdered$2$adapted(RDD.scala:1558)
    org.apache.spark.rdd.RDD.$anonfun$mapPartitionsWithIndex$2(RDD.scala:910)
    org.apache.spark.rdd.RDD.$anonfun$mapPartitionsWithIndex$2$adapted(RDD.scala:910)
    org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
    org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:367)
    org.apache.spark.rdd.RDD.iterator(RDD.scala:331)
    org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:93)
    org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:166)
    org.apache.spark.scheduler.Task.run(Task.scala:141)
    org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$4(Executor.scala:620)
    org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally(SparkErrorUtils.scala:64)
    org.apache.spark.util.SparkErrorUtils.tryWithSafeFinally$(SparkErrorUtils.scala:61)
    org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:94)
    org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:623)
    java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
    java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
    java.base/java.lang.Thread.run(Unknown Source)
        at org.apache.spark.TaskContextImpl.invokeListeners(TaskContextImpl.scala:254)
        at org.apache.spark.TaskContextImpl.invokeTaskCompletionListeners(TaskContextImpl.scala:144)
        at org.apache.spark.TaskContextImpl.markTaskCompleted(TaskContextImpl.scala:137)
        at org.apache.spark.TaskContext.runTaskWithListeners(TaskContext.scala:177)
        ... 9 more
        Suppressed: java.lang.reflect.InvocationTargetException
            at java.base/jdk.internal.reflect.GeneratedMethodAccessor24.invoke(Unknown Source)
            at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
            at java.base/java.lang.reflect.Method.invoke(Unknown Source)
            at org.apache.uniffle.io.netty.util.internal.CleanerJava9.freeDirectBuffer(CleanerJava9.java:88)
            at org.apache.uniffle.io.netty.util.internal.PlatformDependent.freeDirectBuffer(PlatformDependent.java:521)
            at org.apache.uniffle.common.util.RssUtils.releaseByteBuffer(RssUtils.java:414)
            at org.apache.uniffle.client.impl.ShuffleReadClientImpl.close(ShuffleReadClientImpl.java:335)
            at org.apache.spark.shuffle.reader.RssShuffleDataIterator.cleanup(RssShuffleDataIterator.java:217)
            at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.lambda$new$0(RssShuffleReader.java:284)
            at scala.Function0.apply$mcV$sp(Function0.scala:39)
            at org.apache.spark.util.CompletionIterator$$anon$1.completion(CompletionIterator.scala:47)
            at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.lambda$new$1(RssShuffleReader.java:296)
            at org.apache.spark.TaskContextImpl.$anonfun$invokeTaskCompletionListeners$1(TaskContextImpl.scala:144)
            at org.apache.spark.TaskContextImpl.$anonfun$invokeTaskCompletionListeners$1$adapted(TaskContextImpl.scala:144)
            at org.apache.spark.TaskContextImpl.invokeListeners(TaskContextImpl.scala:199)
            ... 12 more
        Caused by: java.lang.IllegalArgumentException: duplicate or slice
            at jdk.unsupported/sun.misc.Unsafe.invokeCleaner(Unknown Source)
            ... 27 more
Caused by: java.lang.IllegalArgumentException: duplicate or slice
    at jdk.unsupported/sun.misc.Unsafe.invokeCleaner(Unknown Source)
    ... 42 more
```


### Uniffle Server Configurations

```yaml
rss.rpc.server.type GRPC_NETTY
...
```


### Uniffle Engine Configurations

```yaml
spark.rss.client.type=GRPC_NETTY
spark.rss.client.netty.io.mode=EPOLL
spark.rss.storage.type=MEMORY_LOCALFILE
...
```


### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2082/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Kz0YG,incubator-uniffle,2328839686,2082,NA,ChenRussell,23331896,chenrui,,NA,2024-09-04T12:23:15Z,2024-09-04T12:23:15Z,@rickyma @jerqi Does the client side support jdk11?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Kz0YG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6K7EWi,incubator-uniffle,2330740130,2082,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-09-05T06:50:38Z,2024-09-05T06:50:38Z,"> @rickyma @jerqi Does the client side support jdk11?

We didn't test it. From the error, it seems that we don't use proper method to release memory for JDK11.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6K7EWi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6K7bh8,incubator-uniffle,2330835068,2082,NA,ChenRussell,23331896,chenrui,,NA,2024-09-05T07:44:51Z,2024-09-05T07:44:51Z,"> > @rickyma @jerqi Does the client side support jdk11?
> 
> We didn't test it. From the error, it seems that we don't use proper method to release memory for JDK11.

How should I fix this error for JDK11?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6K7bh8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6K8LoW,incubator-uniffle,2331032086,2082,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-09-05T09:23:13Z,2024-09-05T09:23:13Z,@rickyma Do you have any suggestion?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6K8LoW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LAjyY,incubator-uniffle,2332179608,2082,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-09-05T16:33:38Z,2024-09-05T16:33:38Z,I've no idea. Could you please test this case using JDK 11? @maobaolong ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LAjyY/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LEXqZ,incubator-uniffle,2333178521,2082,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-06T03:44:46Z,2024-09-06T03:44:46Z,"@rickyma We use jdk8 for all RSS cluster and client, so we did not encounter this issue for production env.

But I did a test on JDK11 just konw, this issue reproduced.

```
➜  spark.mbl bin/spark-shell  --master  spark://localhost:7077  --deploy-mode client  --conf spark.shuffle.manager=org.apache.spark.shuffle.RssShuffleManager --conf spark.rss.coordinator.quorum=localhost:19999  --conf spark.rss.storage.type=LOCALFILE --conf spark.serializer=org.apache.spark.serializer.KryoSerializer --conf spark.rss.test.mode.enable=true --conf spark.rss.client.type=GRPC_NETTY --conf spark.sql.shuffle.partitions=1  -i test.scala  
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/data/softwares/spark.mbl/jars/log4j-slf4j-impl-2.17.2.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/data/softwares/hadoop-3.3.1/share/hadoop/common/lib/slf4j-log4j12-1.7.30.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]
24/09/06 11:41:40 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Setting default log level to ""WARN"".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
24/09/06 11:41:46 WARN RssSparkShuffleUtils: Empty conf items
Spark context Web UI available at http://localhost:4040
Spark context available as 'sc' (master = spark://localhost:7077, app id = app-20240906114147-0002).
Spark session available as 'spark'.
24/09/06 11:41:57 WARN TaskSetManager: Lost task 0.0 in stage 1.0 (TID 2) (localhost executor 0): java.lang.reflect.InvocationTargetException
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:566)
        at org.apache.uniffle.shaded.io.netty.util.internal.CleanerJava9.freeDirectBuffer(CleanerJava9.java:88)
        at org.apache.uniffle.shaded.io.netty.util.internal.PlatformDependent.freeDirectBuffer(PlatformDependent.java:521)
        at org.apache.uniffle.common.util.RssUtils.releaseByteBuffer(RssUtils.java:422)
        at org.apache.uniffle.client.impl.ShuffleReadClientImpl.close(ShuffleReadClientImpl.java:335)
        at org.apache.spark.shuffle.reader.RssShuffleDataIterator.cleanup(RssShuffleDataIterator.java:218)
        at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.lambda$new$0(RssShuffleReader.java:293)
        at org.apache.spark.shuffle.FunctionUtils$1.apply(FunctionUtils.java:33)
        at scala.Function0.apply$mcV$sp(Function0.scala:39)
        at org.apache.spark.util.CompletionIterator$$anon$1.completion(CompletionIterator.scala:47)
        at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:36)
        at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:316)
        at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
        at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
        at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:186)
        at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
        at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365)
        at org.apache.spark.rdd.RDD.iterator(RDD.scala:329)
        at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
        at org.apache.spark.scheduler.Task.run(Task.scala:136)
        at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548)
        at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1548)
        at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        at java.base/java.lang.Thread.run(Thread.java:829)
Caused by: java.lang.IllegalArgumentException: duplicate or slice
        at jdk.unsupported/sun.misc.Unsafe.invokeCleaner(Unsafe.java:1238)
        ... 29 more

24/09/06 11:41:58 ERROR TaskSetManager: Task 0 in stage 1.0 failed 4 times; aborting job
org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 1.0 failed 4 times, most recent failure: Lost task 0.3 in stage 1.0 (TID 8) (9.134.219.180 executor 0): java.lang.reflect.InvocationTargetException
        at java.base/jdk.internal.reflect.GeneratedMethodAccessor18.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:566)
        at org.apache.uniffle.shaded.io.netty.util.internal.CleanerJava9.freeDirectBuffer(CleanerJava9.java:88)
        at org.apache.uniffle.shaded.io.netty.util.internal.PlatformDependent.freeDirectBuffer(PlatformDependent.java:521)
        at org.apache.uniffle.common.util.RssUtils.releaseByteBuffer(RssUtils.java:422)
        at org.apache.uniffle.client.impl.ShuffleReadClientImpl.close(ShuffleReadClientImpl.java:335)
        at org.apache.spark.shuffle.reader.RssShuffleDataIterator.cleanup(RssShuffleDataIterator.java:218)
        at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.lambda$new$0(RssShuffleReader.java:293)
        at org.apache.spark.shuffle.FunctionUtils$1.apply(FunctionUtils.java:33)
        at scala.Function0.apply$mcV$sp(Function0.scala:39)
        at org.apache.spark.util.CompletionIterator$$anon$1.completion(CompletionIterator.scala:47)
        at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:36)
        at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:316)
        at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
        at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
        at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:186)
        at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
        at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365)
        at org.apache.spark.rdd.RDD.iterator(RDD.scala:329)
        at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
        at org.apache.spark.scheduler.Task.run(Task.scala:136)
        at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548)
        at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1548)
        at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        at java.base/java.lang.Thread.run(Thread.java:829)
Caused by: java.lang.IllegalArgumentException: duplicate or slice
        at jdk.unsupported/sun.misc.Unsafe.invokeCleaner(Unsafe.java:1238)
        ... 28 more

Driver stacktrace:
  at org.apache.spark.scheduler.DAGScheduler.failJobAndIndependentStages(DAGScheduler.scala:2687)
  at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2(DAGScheduler.scala:2623)
  at org.apache.spark.scheduler.DAGScheduler.$anonfun$abortStage$2$adapted(DAGScheduler.scala:2622)
  at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)
  at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)
  at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)
  at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:2622)
  at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1(DAGScheduler.scala:1182)
  at org.apache.spark.scheduler.DAGScheduler.$anonfun$handleTaskSetFailed$1$adapted(DAGScheduler.scala:1182)
  at scala.Option.foreach(Option.scala:407)
  at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:1182)
  at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:2880)
  at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2822)
  at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2811)
  at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49)
  at org.apache.spark.scheduler.DAGScheduler.runJob(DAGScheduler.scala:952)
  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2349)
  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2370)
  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2389)
  at org.apache.spark.SparkContext.runJob(SparkContext.scala:2414)
  at org.apache.spark.rdd.RDD.$anonfun$collect$1(RDD.scala:1021)
  at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
  at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:112)
  at org.apache.spark.rdd.RDD.withScope(RDD.scala:406)
  at org.apache.spark.rdd.RDD.collect(RDD.scala:1020)
  ... 65 elided
Caused by: java.lang.reflect.InvocationTargetException: java.lang.IllegalArgumentException: duplicate or slice
  at java.base/jdk.internal.reflect.GeneratedMethodAccessor18.invoke(Unknown Source)
  at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
  at java.base/java.lang.reflect.Method.invoke(Method.java:566)
  at org.apache.uniffle.shaded.io.netty.util.internal.CleanerJava9.freeDirectBuffer(CleanerJava9.java:88)
  at org.apache.uniffle.shaded.io.netty.util.internal.PlatformDependent.freeDirectBuffer(PlatformDependent.java:521)
  at org.apache.uniffle.common.util.RssUtils.releaseByteBuffer(RssUtils.java:422)
  at org.apache.uniffle.client.impl.ShuffleReadClientImpl.close(ShuffleReadClientImpl.java:335)
  at org.apache.spark.shuffle.reader.RssShuffleDataIterator.cleanup(RssShuffleDataIterator.java:218)
  at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.lambda$new$0(RssShuffleReader.java:293)
  at org.apache.spark.shuffle.FunctionUtils$1.apply(FunctionUtils.java:33)
  at scala.Function0.apply$mcV$sp(Function0.scala:39)
  at org.apache.spark.util.CompletionIterator$$anon$1.completion(CompletionIterator.scala:47)
  at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:36)
  at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:316)
  at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:155)
  at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
  at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:186)
  at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:106)
  at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365)
  at org.apache.spark.rdd.RDD.iterator(RDD.scala:329)
  at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
  at org.apache.spark.scheduler.Task.run(Task.scala:136)
  at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548)
  at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1548)
  at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551)
  at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
  at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
  at java.base/java.lang.Thread.run(Thread.java:829)
Caused by: java.lang.IllegalArgumentException: duplicate or slice
  at jdk.unsupported/sun.misc.Unsafe.invokeCleaner(Unsafe.java:1238)
  ... 28 more
```

- test.scala

```scala
val data = sc.parallelize(Seq((""A"", 1), (""B"", 2), (""C"", 3), (""A"", 4), (""B"", 5), (""A"", 6), (""A"", 7),(""A"", 7), (""A"", 7), (""A"", 7), (""A"", 7), (""A"", 7), (""A"", 7), (""A"", 7), (""A"", 7), (""A"", 7), (""A"", 7), (""A"", 7), (""A"", 7)));
val result = data.reduceByKey(_ + _);
result.collect().foreach(println);
System.exit(0);
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LEXqZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LElnj,incubator-uniffle,2333235683,2082,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-09-06T04:59:50Z,2024-09-06T04:59:50Z,Could you help to solve this? It will block people from using JDK 11. @maobaolong ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LElnj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Loevk,incubator-uniffle,2342644708,2082,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-11T05:18:26Z,2024-09-11T05:18:26Z,@rickyma @ChenRussell JDK11 cannot works with uniffle client for now.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Loevk/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Lo6sd,incubator-uniffle,2342759197,2082,NA,ChenRussell,23331896,chenrui,,NA,2024-09-11T06:33:29Z,2024-09-11T06:33:29Z,"> @rickyma @ChenRussell JDK8 cannot works with uniffle client for now.

Do you mean JDK11?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Lo6sd/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Lp07t,incubator-uniffle,2342997741,2082,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-11T08:31:18Z,2024-09-11T08:31:18Z,"> Do you mean JDK11?

Sorry for the mistake, yeah, i mean JDK11, I got this conclusion from the community meeting.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Lp07t/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Ssrdp,incubator-uniffle,2461185897,2082,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-11-07T02:26:55Z,2024-11-07T02:26:55Z,@advancedxy @LuciferYang Do you have any suggestion about this issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Ssrdp/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Sv1WB,incubator-uniffle,2462012801,2082,NA,advancedxy,807537,,,NA,2024-11-07T11:37:35Z,2024-11-07T11:37:35Z,"Based on the stack trace, It seems that RSS is releasing a slice or a duplicate, which might indicate a bigger problem and needs some further investigation.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Sv1WB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6SwUy7,incubator-uniffle,2462141627,2082,NA,liorregev,2955289,Lior Regev,lioregev@gmail.com,NA,2024-11-07T12:41:32Z,2024-11-07T12:41:32Z,"I've been running into the same issue.
After searching around online I found [this](https://github.com/classgraph/classgraph/blob/latest/src/main/java/nonapi/io/github/classgraph/utils/FileUtils.java#L680). And while it seems like a dirty hack, that project is wide-spread enough to hopefully catch this sort of thing.
I replaced [RssUtils.java:426](https://github.com/apache/incubator-uniffle/blob/master/common/src/main/java/org/apache/uniffle/common/util/RssUtils.java#L425) with the following, and it works:
```try {
  PlatformDependent.freeDirectBuffer(byteBuffer);
} catch (Throwable e) {
  Throwable cause = e.getCause();

  if (!(cause instanceof IllegalArgumentException)) {
    throw e;
  }
  // Buffer is duplicate or slice
}
```
Not sure how to check for memory leaks right now though.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6SwUy7/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6SyJNm,incubator-uniffle,2462618470,2082,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2024-11-07T16:04:13Z,2024-11-07T16:04:13Z,@ChenRussell  Have you tried `--add-opens java.base/jdk.internal.ref=ALL-UNNAMED -Dio.netty.tryReflectionSetAccessible=true`,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6SyJNm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6S2Cvm,incubator-uniffle,2463640550,2082,NA,ChenRussell,23331896,chenrui,,NA,2024-11-08T02:37:15Z,2024-11-08T02:37:15Z,"> @ChenRussell Have you tried `--add-opens java.base/jdk.internal.ref=ALL-UNNAMED -Dio.netty.tryReflectionSetAccessible=true`

Yes, I have tried, that's not working, it's not the accessible problem, it can access the reflection method","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6S2Cvm/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6S2FIl,incubator-uniffle,2463650341,2082,NA,LuciferYang,1475305,YangJie,yangjie01@baidu.com,NA,2024-11-08T02:47:53Z,2024-11-08T02:47:53Z,"@ChenRussell Got it ~ Is there an existing unit test (UT) that can reproduce this issue? Java 8 uses `CleanerJava6`, while Java 9+ uses `CleanerJava9`, and there are some differences in the code implementation. It would be easier to identify the root cause if there is a UT that can reproduce it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6S2FIl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6S2F7A,incubator-uniffle,2463653568,2082,NA,ChenRussell,23331896,chenrui,,NA,2024-11-08T02:50:49Z,2024-11-08T02:50:49Z,"> @ChenRussell Got it ~ Is there an existing unit test (UT) that can reproduce this issue? Java 8 uses `CleanerJava6`, while Java 9+ uses `CleanerJava9`, and there are some differences in the code implementation. It would be easier to identify the root cause if there is a UT that can reproduce it.

You can use this https://github.com/apache/incubator-uniffle/issues/2082#issuecomment-2333178521 to reproduce this issue.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6S2F7A/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WpJgc,incubator-uniffle,2527369244,2082,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2024-12-09T09:22:21Z,2024-12-09T09:22:21Z,"> Based on the stack trace, It seems that RSS is releasing a slice or a duplicate, which might indicate a bigger problem and needs some further investigation.

agree. The root cause is that ByteBuffer#attachment is unexpectedly null.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WpJgc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WpL24,incubator-uniffle,2527378872,2082,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2024-12-09T09:25:29Z,2024-12-09T09:25:29Z,"> > Based on the stack trace, It seems that RSS is releasing a slice or a duplicate, which might indicate a bigger problem and needs some further investigation.
> 
> agree. The root cause is that ByteBuffer#attachment is unexpectedly null.

Can we assess if `ByteBuffer#attachment` is non-null before releasing memory as a temporary fix?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WpL24/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Wz4z8,incubator-uniffle,2530184444,2082,NA,dingshun3016,21172339,,,NA,2024-12-10T03:34:24Z,2024-12-10T03:34:24Z,"Similar problems arise here, such as [ARTEMIS-2131](https://issues.apache.org/jira/browse/ARTEMIS-2131) [2378](https://github.com/apache/activemq-artemis/pull/2378) [WFLY-11026](https://issues.redhat.com/browse/WFLY-11026) , We can refer to it","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Wz4z8/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6XH30t,incubator-uniffle,2535423277,2082,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2024-12-11T10:14:32Z,2024-12-11T10:14:32Z,"It seems to be caused by this code, a result byteBuf will be a silced ByteBuf, but a silced Buffer `byteBuffer = byteBuf.nioBuffer()` not support release. @advancedxy @ChenRussell 
 https://github.com/apache/incubator-uniffle/blob/b7c9ca59b1413fa480fa0cfec666e9d15d77dcf9/common/src/main/java/org/apache/uniffle/common/netty/TransportFrameDecoder.java#L179","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6XH30t/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2082,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6XcUwL,incubator-uniffle,2540784651,2082,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-13T07:36:10Z,2024-12-13T07:36:10Z,"Maybe we could remove
```
    if (readBuffer != null) {
      RssUtils.releaseByteBuffer(readBuffer);
    }
```
Because we have released the ByteBuf
```
    if (sdr != null) {
      sdr.release();
      // We set sdr to null here to prevent IllegalReferenceCountException that could occur
      // if sdr.release() is called multiple times in the close() method,
      // when an exception is thrown by clientReadHandler.readShuffleData().
      sdr = null;
    }
```
![image](https://github.com/user-attachments/assets/f091c560-ff09-4cec-a4d0-d461f341434d)

cc @rickyma @maobaolong @leixm WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6XcUwL/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2083,https://api.github.com/repos/apache/incubator-uniffle/issues/2083,incubator-uniffle,2482423486,2083,[Improvement] Quickly delete local or HDFS data at the shuffleId level.,yl09099,33595968,,,OPEN,2024-08-23T06:37:32Z,2024-08-23T06:37:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

At the shuffleId level, data on the local or HDFS needs to be deleted synchronously. In some scenarios, the deletion time needs to be shortened. You can rename folders and delete them asynchronously.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2083/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2086,https://api.github.com/repos/apache/incubator-uniffle/issues/2086,incubator-uniffle,2485805156,2086,[FEATURE] Rss partition sliced store,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-08-26T03:46:52Z,2024-11-07T06:10:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

RSS store partition divided by `slice`, default to `10GB`.

### Motivation

Avoid a single extremely huge partition waste whole node/disk io.

### Describe the solution

RSS store partition divided by `slice`, default to `10GB`, then a 21G partition can stored to 3 slice.

### Additional context

https://docs.google.com/document/d/1R9LcPIkmWml0aD3rQbhKgO9qWBSE9NknRCyhljC09Uw/edit?usp=sharing

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2086/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2087,https://api.github.com/repos/apache/incubator-uniffle/issues/2087,incubator-uniffle,2491216563,2087,[FEATURE] Support closing leader election of webhook of rss-operartor ,wangao1236,12544973,jasonawang,908622977@qq.com,CLOSED,2024-08-28T06:48:41Z,2024-09-04T06:50:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

We need to add a flag to disable leader election in scenarios where the webhook is a single replica.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2087/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2090,https://api.github.com/repos/apache/incubator-uniffle/issues/2090,incubator-uniffle,2496538613,2090,[Bug] java.util.ConcurrentModificationException 	at java.util.LinkedList$LLSpliterator.forEachRemaining,xianjingfeng,11752250,,,CLOSED,2024-08-30T08:08:47Z,2024-09-03T06:48:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```
org.apache.uniffle.common.exception.RssException: java.util.ConcurrentModificationException
	at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:265)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)
	at org.apache.spark.scheduler.Task.run(Task.scala:131)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:506)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1462)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:509)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.util.ConcurrentModificationException
	at java.util.LinkedList$LLSpliterator.forEachRemaining(LinkedList.java:1239)
	at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580)
	at java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:270)
	at java.util.concurrent.ConcurrentHashMap$ValueSpliterator.forEachRemaining(ConcurrentHashMap.java:3566)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
	at org.apache.uniffle.client.impl.FailedBlockSendTracker.getFaultyShuffleServers(FailedBlockSendTracker.java:83)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.hasAnyBlockFailure(RssShuffleWriter.java:467)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.checkDataIfAnyFailure(RssShuffleWriter.java:454)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.checkBlockSendResult(RssShuffleWriter.java:414)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.writeImpl(RssShuffleWriter.java:304)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:259)

```

### Affects Version(s)

master/0.9.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2090/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2092,https://api.github.com/repos/apache/incubator-uniffle/issues/2092,incubator-uniffle,2500169301,2092,[Improvement] Avoid copying direct memory when flushing data.,zhengchenyu,10381583,zhengchenyu,,OPEN,2024-09-02T07:03:20Z,2024-11-16T13:59:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

When flush data to local disk, will copy data. See code below:

https://github.com/apache/incubator-uniffle/blob/0f9d9bcb5648c95051c9f8c4831943f126d463b9/storage/src/main/java/org/apache/uniffle/storage/handler/impl/LocalFileWriteHandler.java#L106

In fact, we can direct write ByteBuffer to file channel. For netty mode, the ByteBuffer is DirectByteBuffer, will avoid copy the memory.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2092/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2092,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KhW8-,incubator-uniffle,2324000574,2092,NA,xianjingfeng,11752250,,,NA,2024-09-02T07:23:44Z,2024-09-02T07:23:44Z,Similar issue: #1613,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KhW8-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2092,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KhZXW,incubator-uniffle,2324010454,2092,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-09-02T07:28:43Z,2024-09-02T07:28:43Z,"> Similar issue: #1613

I do not notice that pr. I will try to test and check to see if the problem described in #1613 occurs
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KhZXW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2092,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2qUx,incubator-uniffle,2480579889,2092,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-11-16T13:59:20Z,2024-11-16T13:59:20Z,@zhengchenyu Have you reproduced that issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6T2qUx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2094,https://api.github.com/repos/apache/incubator-uniffle/issues/2094,incubator-uniffle,2502176639,2094,[FEATURE] Add retry for coordinator client,kuszz,21366445,kqhzz,kuangqinghuazz@163.com,CLOSED,2024-09-03T07:54:40Z,2024-09-09T11:18:09Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Add retry for coordinator client api

### Motivation

Now we only have retry on accessCluster and getShuffleAssignments, if coordinator crash when another coordinator restart, the shuffle task would be fail

### Describe the solution

Add retry for coordinator client api

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2094/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2096,https://api.github.com/repos/apache/incubator-uniffle/issues/2096,incubator-uniffle,2502411331,2096,[Bug] Direct memory is used too much due to each GrpcClient create one allocator.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-09-03T09:45:16Z,2024-09-05T09:09:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When client use grpc mode, the client's direct memory will OOM. See this log:

```
io.grpc.netty.shaded.io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 4194304 byte(s) of direct memory (used: 2671771927, max: 2673344512)}  
```

I do not find any memory leak. But I found that after #1773, each GrpcClient create one allocator. And I log the usage of each allocator, get these log:

```
2024-09-03 17:09:45,518 [INFO] [client-data-transfer-44] |grpc.ShuffleServerGrpcClient|: ZCY DEBUG: after sendShuffleData use direct memory: 2671771927
2024-09-03 17:09:45,518 [INFO] [client-data-transfer-15] |grpc.ShuffleServerGrpcClient|: ZCY DEBUG: show allocators: allocator#224559456, used heap memory0, used direct memory306184192
allocator#503616849, used heap memory0, used direct memory306184192
allocator#1415064557, used heap memory0, used direct memory297795584
allocator#365979975, used heap memory0, used direct memory289406976
allocator#1677896677, used heap memory0, used direct memory297795584
allocator#1728835395, used heap memory0, used direct memory289406976
allocator#1028869817, used heap memory0, used direct memory297795584
allocator#2116109610, used heap memory0, used direct memory293601280
allocator#1354539648, used heap memory0, used direct memory293601280
total memory: heap=0direct=2671771648
```

Obviously, the excessive memory usage is caused by creating an allocator for each GrpcClient. Before #1773, all GrpcClient functions use the same instance: PooledByteBufAllocator.DEFAULT.

Here we need a static allocator.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2096/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2096,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KpTup,incubator-uniffle,2326084521,2096,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-09-03T09:48:08Z,2024-09-03T09:48:08Z,@rickyma Could you take a look?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KpTup/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2096,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KpXcg,incubator-uniffle,2326099744,2096,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-09-03T09:55:22Z,2024-09-03T09:55:22Z,"In fact, in grpc mode, we use grpc to send buffer. So this problem is easier to find in grpc mode.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KpXcg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2096,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KqFtO,incubator-uniffle,2326289230,2096,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-09-03T11:31:59Z,2024-09-03T11:31:59Z,"You can do this refer to https://github.com/apache/incubator-uniffle/pull/1803.

The gRPC mode is no longer recommended due to https://github.com/apache/incubator-uniffle/issues/1651.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KqFtO/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2096,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KqNKl,incubator-uniffle,2326319781,2096,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-09-03T11:49:02Z,2024-09-03T11:49:02Z,"> You can do this refer to #1803.

#1803 is about netty client. The problem in this issue is about grpc client, this allocator is builded in grpc client. I do not think we should refer to #1803.

Even though grpc mode is not recommended, we still need solve this problem. For example, some feature( for example: remote merge) is not support netty for now.

","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KqNKl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2096,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KqQ4V,incubator-uniffle,2326334997,2096,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-09-03T11:55:08Z,2024-09-03T11:55:08Z,"gRPC also uses Netty by default. What I mean is that you can refer to some of the methods in this PR, such as the naming of `getSharedAllocator` and so on. It's important to maintain unity in naming and structure within the same project.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KqQ4V/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2096,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KyZAP,incubator-uniffle,2328465423,2096,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-09-04T10:14:49Z,2024-09-04T10:14:49Z,"> [#2096] fix: Direct memory is used too much due to each GrpcClient create one allocator. #2098

OK, I got it. Try to use similar structure.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6KyZAP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2099,https://api.github.com/repos/apache/incubator-uniffle/issues/2099,incubator-uniffle,2502826233,2099,[Improvement] Support launch multi servers on local by intellij idea,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-09-03T13:01:21Z,2024-09-03T13:01:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Start multi-servers by intellij idea

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2099/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2101,https://api.github.com/repos/apache/incubator-uniffle/issues/2101,incubator-uniffle,2512963606,2101,[Bug] Fixed the UT null pointer of RpcClientRetryTest.,yl09099,33595968,,,CLOSED,2024-09-09T05:45:40Z,2024-09-09T06:11:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In The UT of RpcClientRetryTest, a null pointer error is reported, mainly because the shuffle block is not brushed to disk. When BlockData is read from LOCALFILE, ByteBuffer calls the getByteBuffer() method null pointer.

in org.apache.uniffle.test.RpcClientRetryTest
Error:  testRpcRetryLogic{StorageType}[2]  Time elapsed: 0.099 s  <<< ERROR!
java.lang.NullPointerException
	at org.apache.uniffle.client.TestUtils.validateResult(TestUtils.java:42)
	at org.apache.uniffle.test.ShuffleReadWriteBase.validateResult(ShuffleReadWriteBase.java:133)
	at org.apache.uniffle.test.RpcClientRetryTest.testRpcRetryLogic(RpcClientRetryTest.java:205)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)

### Affects Version(s)

0.10.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2101/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2103,https://api.github.com/repos/apache/incubator-uniffle/issues/2103,incubator-uniffle,2515526153,2103,"[Bug] When flush block and getInMemoryShuffleData occur together, may cause data reading errors.",zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-09-10T06:29:59Z,2024-09-10T11:14:49Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When flush block and getInMemoryShuffleData occur together, may cause data reading errors. Because there may be two threads reading data at the same time, and the readIndex of ByteBuf will be inconsistent. 

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2103/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2105,https://api.github.com/repos/apache/incubator-uniffle/issues/2105,incubator-uniffle,2515579924,2105,[Bug] Duplicated blockId cause ShuffleServer memory leak in netty mode.,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-09-10T07:01:12Z,2024-09-13T06:25:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Duplicated blockId cause ShuffleServer memory leak in netty mode.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2105/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2105,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LyEuZ,incubator-uniffle,2345159577,2105,NA,xianjingfeng,11752250,,,NA,2024-09-12T02:49:00Z,2024-09-12T02:49:00Z,Similar issue:#926,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LyEuZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2107,https://api.github.com/repos/apache/incubator-uniffle/issues/2107,incubator-uniffle,2518376241,2107,[Improvement] Optimize the configuration of the number of threads of Netty client,xianjingfeng,11752250,,,CLOSED,2024-09-11T03:32:17Z,2024-09-18T09:38:39Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, Uniffle client will create an `EventLoopGroup` for each shuffle server, which is named `workerGroup`. And the default number of the threads of `workerGroup` is `availableProcessors` and it can be changed by `rss.client.netty.client.threads`. And each thread of  `workerGroup`  will create an `EventExecutor`, which will occur lots of memory.

https://github.com/apache/incubator-uniffle/blob/d170004a32418a32536aa792b198dfd714b5ea8c/common/src/main/java/org/apache/uniffle/common/netty/client/TransportClientFactory.java#L88

But the param `rss.client.netty.client.connections.per.peer`, which with 2 as the default value, will determine the max threads will be used  in `workerGroup`. So, many threads are useless in the default configuration.
https://github.com/apache/incubator-uniffle/blob/d170004a32418a32536aa792b198dfd714b5ea8c/common/src/main/java/org/apache/uniffle/common/netty/client/TransportClientFactory.java#L127-L133


### How should we improve?

Remove `rss.client.netty.client.threads` and make `rss.client.netty.client.connections.per.peer` as the param of the thread number of `workerGroup`.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2107/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2107,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LoJjT,incubator-uniffle,2342557907,2107,NA,xianjingfeng,11752250,,,NA,2024-09-11T03:42:19Z,2024-09-11T03:42:19Z,@zuston @xumanbu @rickyma @jerqi  cc,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LoJjT/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2107,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LoJ3d,incubator-uniffle,2342559197,2107,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-09-11T03:44:06Z,2024-09-11T03:44:06Z,Sounds good,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6LoJ3d/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2111,https://api.github.com/repos/apache/incubator-uniffle/issues/2111,incubator-uniffle,2518879316,2111,[Improvement] cleanup shuffle server client when unregister shuffle,xianjingfeng,11752250,,,OPEN,2024-09-11T07:51:39Z,2024-09-11T07:51:40Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Cleanup shuffle server client when unregister shuffle.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2111/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2116,https://api.github.com/repos/apache/incubator-uniffle/issues/2116,incubator-uniffle,2521644426,2116,[Improvement] Whether to use jdk cleaner for netty.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-09-12T07:58:21Z,2024-09-13T00:53:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Initially, under k8s deployment, that is jdk11, I found used_direct_memory_size was always -2.

I found debug log `[main] [DEBUG] PlatformDependent0.<clinit> - direct buffer constructor: unavailable`. It means we will use DirectByteBuffer constructor with cleaner, then means that `Netty will not enforce max memory, and instead will defer to JDK.`

I search the code, found that netty have two ways:

## (1) use jdk cleaner
* Netty will not limit the memory.
* We should use `-XX:MaxDirectMemorySize` to limit DirectByteBuffer. If the limit is reached, GC is triggered.
* We should use metric: `jvm_buffer_pool_used_bytes{pool=""direct""}`

## (2) do not use jdk cleaner
* Netty will limit memory with `io.netty.maxDirectMemory`. If the limit is reached, will throw exception.
* We can also use `-XX:MaxDirectMemorySize` to limit DirectByteBuffer, but the usage should be very low. I think there are no need to limit.
* We should use metrics: `used_direct_memory_size`

> BTW, the native memory used in FileOuputStream can not be limited and monitored. We should avoid that.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2116/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2116,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Lzyt9,incubator-uniffle,2345610109,2116,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-09-12T08:29:34Z,2024-09-12T08:29:34Z,@maobaolong @rickyma ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Lzyt9/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2116,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L3pi0,incubator-uniffle,2346621108,2116,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-09-12T15:32:38Z,2024-09-12T15:32:38Z,"The test shows that (1) and (2) are the same. When the limit is reached, the server will be stuck. Personally think that (1) or (2) it doesn't matter, suggest not to max direct limit, but via `rss.server.buffer.capacity` limit. So end this nonsense.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L3pi0/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2116,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L76Li,incubator-uniffle,2347737826,2116,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-13T00:53:37Z,2024-09-13T00:53:37Z,"@jerqi @zhengchenyu In practice, we set both `MaxDirectMemorySize` and `rss.server.buffer.capacity`, and `MaxDirectMemorySize` is larger than `rss.server.buffer.capacity`.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L76Li/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2117,https://api.github.com/repos/apache/incubator-uniffle/issues/2117,incubator-uniffle,2523746209,2117,[FEATURE] Introduce Introduce bufferPool related metrics(block/buffer/shuffle count) to measure the heap cost by buffer pool,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-09-13T02:29:00Z,2024-09-26T06:47:46Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Introduce block count, buffer count, shuffle count metrics in buffer pool metrics

### Motivation

 measure the heap cost by buffer pool.

### Describe the solution

get block count, buffer count, shuffle count from buffer pool and cached the result in 2 minutes to decrease the compute cost

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2117/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,incubator-uniffle,2524180989,2119,[Bug] Duplicate blockId causes shuffle Server network to be full.,yl09099,33595968,,,CLOSED,2024-09-13T08:13:58Z,2024-09-26T06:40:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

In Netty mode, if BlockId is duplicated, GetInMemoryShuffleData loops through the same BlockId, causing the single Shuffle Server machine network to be full and the Spark Application to be jammed.
The following is a log of reading the duplicate BlockId：
![image](https://github.com/user-attachments/assets/b89f8da9-cf89-40b2-bdf3-ac744062275e)



### Affects Version(s)

0.10.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2119/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L-JYh,incubator-uniffle,2348324385,2119,NA,yl09099,33595968,,,NA,2024-09-13T08:17:53Z,2024-09-13T08:17:53Z,@zuston @maobaolong @jerqi @xianjingfeng Have you encountered this problem when using it?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L-JYh/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L-QBf,incubator-uniffle,2348351583,2119,NA,yl09099,33595968,,,NA,2024-09-13T08:28:19Z,2024-09-13T08:28:19Z,"In ShuffleServer,using ShuffleBufferWithLinkedList, Should the ShuffleBufferWithLinkedList class List Change to Set?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L-QBf/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L-6DI,incubator-uniffle,2348523720,2119,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-09-13T09:48:16Z,2024-09-13T09:48:16Z,"> In ShuffleServer,using ShuffleBufferWithLinkedList, Should the ShuffleBufferWithLinkedList class List Change to Set?

BlockId should guanratee not change the order.
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L-6DI/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L_AmV,incubator-uniffle,2348550549,2119,NA,yl09099,33595968,,,NA,2024-09-13T10:00:27Z,2024-09-13T10:00:27Z,"> > In ShuffleServer,using ShuffleBufferWithLinkedList, Should the ShuffleBufferWithLinkedList class List Change to Set?
> 
> BlockId should guanratee not change the order.

I can't figure out what caused BlockId to repeat, I thought it was a client timeout at first, but I checked all the logs and there was no timeout.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6L_AmV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MHfYs,incubator-uniffle,2350773804,2119,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-14T01:46:43Z,2024-09-14T01:46:43Z,@lwllvyb Is it similar with our issue?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MHfYs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MHhk3,incubator-uniffle,2350782775,2119,NA,xianjingfeng,11752250,,,NA,2024-09-14T02:03:53Z,2024-09-14T02:03:53Z,"> In ShuffleServer,using ShuffleBufferWithLinkedList, Should the ShuffleBufferWithLinkedList class List Change to Set?

You can try `ShuffleBufferWithSkipList`","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MHhk3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MHoBx,incubator-uniffle,2350809201,2119,NA,yl09099,33595968,,,NA,2024-09-14T03:18:23Z,2024-09-14T03:18:23Z,"> > In ShuffleServer,using ShuffleBufferWithLinkedList, Should the ShuffleBufferWithLinkedList class List Change to Set?
> 
> BlockId should guanratee not change the order.

Using LinkedHashSet ensures both de-duplication and order.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MHoBx/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MHpB2,incubator-uniffle,2350813302,2119,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-09-14T03:33:17Z,2024-09-14T03:33:17Z,"> > > In ShuffleServer,using ShuffleBufferWithLinkedList, Should the ShuffleBufferWithLinkedList class List Change to Set?
> > 
> > 
> > BlockId should guanratee not change the order.
> 
> Using LinkedHashSet ensures both de-duplication and order.

Could you paste some more information about this? If it can ensure them, it's ok.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MHpB2/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2119,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MVp71,incubator-uniffle,2354487029,2119,NA,yl09099,33595968,,,NA,2024-09-17T04:35:00Z,2024-09-17T04:35:00Z,"Hash table and linked list implementation of the Set interface, with predictable iteration order. This implementation differs from HashSet in that it maintains a doubly-linked list running through all of its entries. This linked list defines the iteration ordering, which is the order in which elements were inserted into the set (insertion-order). Note that insertion order is not affected if an element is re-inserted into the set. (An element e is reinserted into a set s if s.add(e) is invoked when s.contains(e) would return true immediately prior to the invocation.)
https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashSet.html ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6MVp71/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2120,https://api.github.com/repos/apache/incubator-uniffle/issues/2120,incubator-uniffle,2526053476,2120,[Improvement] Support get the reconfigured config item,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-09-14T07:36:52Z,2024-09-18T11:45:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Support get the reconfigured config item

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2120/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2125,https://api.github.com/repos/apache/incubator-uniffle/issues/2125,incubator-uniffle,2531265265,2125,[FEATURE] Introduce thread pool manager for measure the status,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-09-17T14:05:35Z,2024-10-09T03:49:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Introduce thread pool manager

### Motivation

To measure the status of each thread pool.

### Describe the solution

Add metrics by the thread pool manager.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2125/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2130,https://api.github.com/repos/apache/incubator-uniffle/issues/2130,incubator-uniffle,2535570292,2130,[Bug] Potential huge partition limit invalid when flushing is slow,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-09-19T07:51:37Z,2024-09-20T05:20:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I found the huge partition limit of memory used will be invalid when flushing is slow. 
When checking the limit of huge partition, it will use the buffer's staging size to check that will not consider the in flush data size, this is wrong

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2130/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2136,https://api.github.com/repos/apache/incubator-uniffle/issues/2136,incubator-uniffle,2542927922,2136,[FEATURE] Support update conf from rest api,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-09-23T14:59:03Z,2024-11-06T05:23:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Provide a way to update conf dynamically by rest api.

### Motivation

For test purpose or some production scenario, we need to dynamically update conf through rest api.

For example.
- Need to enable audit log if necessary, disable auditlog if we concern about performance impact.
- Sometime, the config file is not easy to modified, in our production, we have to run a deploy workflow even for a config change only request.
- It really convenience for developer to update some config for test purpose, something like to dynamic enable to output some internal objects value.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2136/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2139,https://api.github.com/repos/apache/incubator-uniffle/issues/2139,incubator-uniffle,2544216591,2139,[FEATURE] should we support jdk21,xumanbu,9135743,xumanbu,manbu.feng@163.com,OPEN,2024-09-24T03:47:38Z,2024-09-24T03:47:38Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

The main feature of JDK 21 is reducing thread overhead with virtual threads. We use several thread pools on the server side, like Netty, gRPC, and Flush. Is it necessary to carry out optimization diagnostics for JDK 21?

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2139/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2140,https://api.github.com/repos/apache/incubator-uniffle/issues/2140,incubator-uniffle,2544695469,2140,[Bug] Occasionally grpc memory leaks occur.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-09-24T08:17:23Z,2024-09-24T08:20:21Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Occasionally grpc memory leaks occur. Maybe I set io.netty.leakDetection.level=PARANOID for test, the probability increases.

```
[2024-09-24 15:26:39.479] [grpc-default-worker-ELG-1-85] [ERROR] ResourceLeakDetector.reportTracedLeak - LEAK: ByteBuf.release() was not called before it's garbage-collected. See https://netty.io/wiki/reference-counted-objects.html for more information.
Recent access records:
Created at:
 io.grpc.netty.shaded.io.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:402)
 io.grpc.netty.shaded.io.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:188)
 io.grpc.netty.shaded.io.netty.buffer.AbstractByteBufAllocator.buffer(AbstractByteBufAllocator.java:124)
 io.grpc.netty.shaded.io.grpc.netty.NettyWritableBufferAllocator.allocate(NettyWritableBufferAllocator.java:51)
  
 io.grpc.internal.MessageFramer.writeUncompressed(MessageFramer.java:172)
 io.grpc.internal.MessageFramer.writePayload(MessageFramer.java:143)
 io.grpc.internal.AbstractStream.writeMessage(AbstractStream.java:66)
 io.grpc.internal.ServerCallImpl.sendMessageInternal(ServerCallImpl.java:168)
 io.grpc.internal.ServerCallImpl.sendMessage(ServerCallImpl.java:152)
 io.grpc.ForwardingServerCall.sendMessage(ForwardingServerCall.java:32)
 io.grpc.stub.ServerCalls$ServerCallStreamObserverImpl.onNext(ServerCalls.java:380)
 org.apache.uniffle.server.ShuffleServerGrpcService.unregisterShuffle(ShuffleServerGrpcService.java:157)
 org.apache.uniffle.proto.ShuffleServerGrpc$MethodHandlers.invoke(ShuffleServerGrpc.java:1144)
 io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
 io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
 io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
 io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:356)
 io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:861)
 io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
 io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
 java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
 java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
 java.base/java.lang.Thread.run(Thread.java:829)
```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2140/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2140,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6NTFqt,incubator-uniffle,2370591405,2140,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-09-24T08:20:16Z,2024-09-24T08:20:16Z,It seems grpc bug.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6NTFqt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2140,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6NTFtS,incubator-uniffle,2370591570,2140,NA,zhengchenyu,10381583,zhengchenyu,,NA,2024-09-24T08:20:21Z,2024-09-24T08:20:21Z,"Sorry, @rickyma have mentioned in https://github.com/grpc/grpc-java/issues/11115. ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6NTFtS/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2145,https://api.github.com/repos/apache/incubator-uniffle/issues/2145,incubator-uniffle,2547129016,2145,[FEATURE] The server-side supports choosing Netty's ByteBufAllocator ,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-09-25T07:04:17Z,2024-09-29T03:06:37Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In server side, we use unpooled allocator. In fact, the server is more suitable for using pooled ByteBuf, which can effectively reduce memory fragmentation. As work do in #1767, Let's add config to choose ByteBufAllocator.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2145/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2148,https://api.github.com/repos/apache/incubator-uniffle/issues/2148,incubator-uniffle,2549688567,2148,[Improvement] Rename the ShuffleBufferWithLinkedList to DefaultShuffleBuffer,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-09-26T06:58:12Z,2024-09-26T06:58:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

In #2124, the ShuffleBufferWithLinkedList has change the linkedlist data structure, so change its name to DefaultShuffleBuffer

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2148/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2152,https://api.github.com/repos/apache/incubator-uniffle/issues/2152,incubator-uniffle,2550770410,2152,[FEATURE] Support refresh page of dashboard,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-09-26T14:28:36Z,2024-11-11T12:00:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support remember the selected coordinator after refresh page

### Motivation

Now when I refresh the page, the current coordinator will reset to the first one, we want to use one dashboard to show all cluster information, so the list would be many item each one is a coordinator address, when I choose one, and refresh the page, the selected coordinator change to the first one, which is not expected.

### Describe the solution

Using cookies to store the selected address address.

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2152/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2152,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6NsFt-,incubator-uniffle,2377145214,2152,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-09-26T14:30:54Z,2024-09-26T14:30:54Z,"I'm not familiar with the VUE, hope some contributor will take this.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6NsFt-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2152,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6SalFw,incubator-uniffle,2456441200,2152,NA,kuszz,21366445,kqhzz,kuangqinghuazz@163.com,NA,2024-11-05T07:38:27Z,2024-11-05T07:38:27Z,I will do something for this,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6SalFw/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2153,https://api.github.com/repos/apache/incubator-uniffle/issues/2153,incubator-uniffle,2552161257,2153,[Improvement] Fix requestShuffleAssignment in RssShuffleManagerBase,kuszz,21366445,kqhzz,kuangqinghuazz@163.com,CLOSED,2024-09-27T06:59:55Z,2024-10-17T02:31:26Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

RssShuffleManagerBase.getShuffleAssignments and registerShuffleServers should in one retry

### How should we improve?

Modify RssShuffleManagerBase, let getShuffleAssignments and registerShuffleServers in one retry, and fix some code style problem

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2153/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2154,https://api.github.com/repos/apache/incubator-uniffle/issues/2154,incubator-uniffle,2552395603,2154,[Bug] Correct the data length and buffer size related metrics and log,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-09-27T08:59:31Z,2024-10-17T02:02:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

There are two concept in Uniffle, `size` and `length`, one measure the memory cost, another measure the data size.

But after go through the existing code, I found that we use incorrect of them.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2154/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2157,https://api.github.com/repos/apache/incubator-uniffle/issues/2157,incubator-uniffle,2553982525,2157,[Flaky Test] AccessClusterTest,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-09-28T03:29:35Z,2024-09-28T03:29:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

AccessClusterTest

### Actions URL

x

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2157/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2158,https://api.github.com/repos/apache/incubator-uniffle/issues/2158,incubator-uniffle,2554256960,2158,[FEATURE] Introduce reconfigure listener to support update more config,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-09-28T14:22:20Z,2024-10-06T02:43:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Introduce reconfigure listener to support update more config

### Motivation

Base on this, we can support reconfig a config item which used in high concurrency scenario, get the cached new config value but updated it when config changed.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2158/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2161,https://api.github.com/repos/apache/incubator-uniffle/issues/2161,incubator-uniffle,2560467601,2161,[Bug] incorrect license - must acknowledge tikv/raft-engine,pjfanning,11783444,PJ Fanning,,CLOSED,2024-10-02T00:55:20Z,2024-11-04T09:45:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Your LICENSE is not correct. Your source repo has code that was copied from another repo.

https://github.com/apache/incubator-uniffle/blob/0bb64739d084be258ad86f70dcb7ab7e13f8777e/rust/experimental/server/src/readable_size.rs#L15

You need to include the details of this project's LICENSE in your LICENSE - including its copyright.


### Affects Version(s)

all

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2161/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2162,https://api.github.com/repos/apache/incubator-uniffle/issues/2162,incubator-uniffle,2574609778,2162,[Bug] Reading from hdfs file fails with writing hdfs file concurrent.,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,OPEN,2024-10-09T02:58:55Z,2024-10-10T03:08:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When the shuffle stage finished, some blocks in server are being written to hdfs file, which will cause the client reading ops to fail.

**The client reading ops log**:
```
[21:08:05:679] [Executor task launch worker for task 881.1 in stage 53.0 (TID 104635)] INFO  org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcNettyClient.getShuffleData:365 - GetShuffleData from x.x.x.x:17000 for appId[application_1716779728283_4017333_1718628854483], shuffleId[0], partitionId[881] cost 20 ms
[21:08:05:727] [Executor task launch worker for task 881.1 in stage 53.0 (TID 104635)] INFO  org.apache.uniffle.storage.handler.impl.HadoopClientReadHandler.init:156 - Find index file for shuffleId[0], partitionId[881] hdfs://xxx/rss/application_1716779728283_4017333_1718628854483/0/881-881/x.x.x.x-19977-17000_0_0.index
[21:08:05:746] [Executor task launch worker for task 881.1 in stage 53.0 (TID 104635)] WARN  org.apache.uniffle.storage.handler.impl.HadoopClientReadHandler.init:180 - Can't create ShuffleReaderHandler for hdfs://xxx/rss/application_1716779728283_4017333_1718628854483/0/881-881/x.x.x.x-19977-17000_0_0
org.apache.hadoop.hdfs.CannotObtainBlockLengthException: Cannot obtain block length for LocatedBlock{BP-1774150831-*-1647590905164:blk_26758443966_26343060354; getBlockSize()=4552; corrupt=false; offset=3623878656; locs=[DatanodeInfoWithStorage[*:9003,DS-af1dba43-5751-4bed-bea6-6050b3929bb4,DISK], DatanodeInfoWithStorage[*:9003,DS-d13fe05a-c894-4dc6-a2ec-2e43aae096c2,DISK]]} of /rss/application_1716779728283_4017333_1718628854483/0/881-881/*-19977-17000_0_0.data
	at org.apache.hadoop.hdfs.DFSInputStream.readBlockLength(DFSInputStream.java:455) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.hdfs.DFSInputStream.getLastBlockLength(DFSInputStream.java:364) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.hdfs.DFSInputStream.fetchLocatedBlocksAndGetLastBlockLength(DFSInputStream.java:345) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.hdfs.DFSInputStream.openInfo(DFSInputStream.java:242) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.hdfs.DFSInputStream.<init>(DFSInputStream.java:208) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.hdfs.DFSClient.openInternal(DFSClient.java:1159) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.hdfs.DFSClient.open(DFSClient.java:1122) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.hdfs.DistributedFileSystem$4.doCall(DistributedFileSystem.java:341) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.hdfs.DistributedFileSystem$4.doCall(DistributedFileSystem.java:337) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81) ~[hadoop-common-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.hdfs.DistributedFileSystem.open(DistributedFileSystem.java:349) ~[hadoop-hdfs-client-3.2.1-tq-0.2.7.jar:?]
	at org.apache.hadoop.fs.FileSystem.open(FileSystem.java:929) ~[hadoop-common-3.2.1-tq-0.2.7.jar:?]
	at org.apache.uniffle.storage.handler.impl.HadoopFileReader.createStream(HadoopFileReader.java:58) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.storage.handler.impl.HadoopFileReader.<init>(HadoopFileReader.java:46) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.storage.handler.impl.HadoopShuffleReadHandler.createHadoopReader(HadoopShuffleReadHandler.java:231) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.storage.handler.impl.HadoopShuffleReadHandler.<init>(HadoopShuffleReadHandler.java:75) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.storage.handler.impl.HadoopClientReadHandler.init(HadoopClientReadHandler.java:165) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.storage.handler.impl.HadoopClientReadHandler.readShuffleData(HadoopClientReadHandler.java:199) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:134) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:308) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:216) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:115) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.spark.util.CompletionIterator.hasNext(CompletionIterator.scala:31) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.shuffle.reader.RssShuffleReader$MultiPartitionIterator.hasNext(RssShuffleReader.java:312) ~[rss-client-spark3-shaded-0.9.0-SNAPSHOT.jar:?]
	at org.apache.spark.InterruptibleIterator.hasNext(InterruptibleIterator.scala:37) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at scala.collection.Iterator$anon$10.hasNext(Iterator.scala:460) ~[scala-library-2.12.15.jar:?]
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage17.sort_addToSorter_0$(Unknown Source) ~[?:?]
	at org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage17.processNext(Unknown Source) ~[?:?]
	at org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43) ~[spark-sql_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.sql.execution.WholeStageCodegenExec$anon$1.hasNext(WholeStageCodegenExec.scala:760) ~[spark-sql_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.sql.execution.RowIteratorFromScala.advanceNext(RowIterator.scala:82) ~[spark-catalyst_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.sql.execution.joins.SortMergeJoinScanner.advancedBufferedToRowWithNullFreeJoinKey(SortMergeJoinExec.scala:1469) ~[spark-sql_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.sql.execution.joins.SortMergeJoinScanner.<init>(SortMergeJoinExec.scala:1329) ~[spark-sql_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.sql.execution.joins.SortMergeJoinExec.$anonfun$doExecute$1(SortMergeJoinExec.scala:229) ~[spark-sql_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.rdd.ZippedPartitionsRDD2.compute(ZippedPartitionsRDD.scala:89) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:329) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:329) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:365) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:329) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.scheduler.Task.run(Task.scala:136) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1556) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_392]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_392]
	at java.lang.Thread.run(Thread.java:750) ~[?:1.8.0_392]
```
**The write op log in server**
```
[2024-06-17 20:29:42.723] [DataStreamer for file /rss/application_1716779728283_4013066_1718626469818/0/846-846/*-19977-17000_0_0.data block BP-1774150831-*-1647590905164:blk_26757305915_26340993839] [WARN] DataStreamer.handleBadDatanode - Error Recovery for BP-1774150831-*-1647590905164:blk_26757305915_26340993839 in pipeline [DatanodeInfoWithStorage[*:9003,DS-18c43763-c3c5-49be-ae1e-69e5d762ff9e,DISK], DatanodeInfoWithStorage[*:9003,DS-52eddd2a-84d4-449b-832f-4c670349dac1,DISK]]: datanode 0(DatanodeInfoWithStorage[*:9003,DS-18c43763-c3c5-49be-ae1e-69e5d762ff9e,DISK]) is bad.
[2024-06-17 20:29:52.259] [Grpc-1212] [INFO] ShuffleServerGrpcService.appHeartbeat - Get heartbeat from application_1716779728283_4013066_1718626469818
[2024-06-17 20:29:59.384] [DataStreamer for file /rss/application_1716779728283_4013066_1718626469818/0/840-840/*-19977-17000_0_0.data block BP-1774150831-*-1647590905164:blk_26757307918_26340996470] [INFO] DataStreamer.createBlockOutputStream - Exception in createBlockOutputStream blk_26757307918_26340996470
java.net.SocketTimeoutException: 20000 millis timeout while waiting for channel to be ready for read. ch : java.nio.channels.SocketChannel[connected local=/*:50760 remote=/*:9003]
        at org.apache.hadoop.net.SocketIOWithTimeout.doIO(SocketIOWithTimeout.java:164)
        at org.apache.hadoop.net.SocketInputStream.read(SocketInputStream.java:161)
        at org.apache.hadoop.net.SocketInputStream.read(SocketInputStream.java:131)
        at org.apache.hadoop.net.SocketInputStream.read(SocketInputStream.java:118)
        at java.io.FilterInputStream.read(FilterInputStream.java:83)
        at java.io.FilterInputStream.read(FilterInputStream.java:83)
        at org.apache.hadoop.hdfs.protocolPB.PBHelperClient.vintPrefixed(PBHelperClient.java:459)
        at org.apache.hadoop.hdfs.DataStreamer.createBlockOutputStream(DataStreamer.java:1776)
        at org.apache.hadoop.hdfs.DataStreamer.setupPipelineInternal(DataStreamer.java:1513)
        at org.apache.hadoop.hdfs.DataStreamer.setupPipelineForAppendOrRecovery(DataStreamer.java:1487)
        at org.apache.hadoop.hdfs.DataStreamer.processDatanodeOrExternalError(DataStreamer.java:1262)
        at org.apache.hadoop.hdfs.DataStreamer.run(DataStreamer.java:673)
[2024-06-17 20:30:00.824] [HadoopFlushEventThreadPool-9] [WARN] SingleStorageManager.write - Exception happened when write data for ShuffleDataFlushEvent: eventId=8342, appId=application_1716779728283_4013066_1718626469818, shuffleId=0, startPartition=840, endPartition=840, retryTimes=0, underStorage=HadoopStorage, isPended=false, ownedByHugePartition=false, try again
java.lang.IllegalArgumentException: Self-suppression not permitted
        at java.lang.Throwable.addSuppressed(Throwable.java:1072)
        at org.apache.uniffle.storage.handler.impl.HadoopShuffleWriteHandler.write(HadoopShuffleWriteHandler.java:147)
        at org.apache.uniffle.storage.handler.impl.PooledHadoopShuffleWriteHandler.write(PooledHadoopShuffleWriteHandler.java:122)
        at org.apache.uniffle.server.storage.SingleStorageManager.write(SingleStorageManager.java:59)
        at org.apache.uniffle.server.storage.HybridStorageManager.write(HybridStorageManager.java:130)
        at org.apache.uniffle.server.ShuffleFlushManager.processFlushEvent(ShuffleFlushManager.java:165)
        at org.apache.uniffle.server.DefaultFlushEventHandler.handleEventAndUpdateMetrics(DefaultFlushEventHandler.java:97)
        at org.apache.uniffle.server.DefaultFlushEventHandler.lambda$dispatchEvent$0(DefaultFlushEventHandler.java:219)
        at java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1640)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:750)
Caused by: java.io.IOException: All datanodes [DatanodeInfoWithStorage[*:9003,DS-52eddd2a-84d4-449b-832f-4c670349dac1,DISK]] are bad. Aborting...
        at org.apache.hadoop.hdfs.DataStreamer.handleBadDatanode(DataStreamer.java:1567)
        at org.apache.hadoop.hdfs.DataStreamer.setupPipelineInternal(DataStreamer.java:1501)
        at org.apache.hadoop.hdfs.DataStreamer.setupPipelineForAppendOrRecovery(DataStreamer.java:1487)
        at org.apache.hadoop.hdfs.DataStreamer.processDatanodeOrExternalError(DataStreamer.java:1262)
        at org.apache.hadoop.hdfs.DataStreamer.run(DataStreamer.java:673)
[2024-06-17 20:30:01.831] [FallBackFlushEventThreadPool-0] [WARN] HadoopShuffleWriteHandler.write - Write failed with 2786 blocks for *-19977-17000_0_0
org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdfs.protocol.AlreadyBeingCreatedException): Failed to APPEND_FILE /rss/application_1716779728283_4013066_1718626469818/0/840-840/*-19977-17000_0_0.data for DFSClient_NONMAPREDUCE_-1504047525_40 on * because DFSClient_NONMAPREDUCE_-1504047525_40 is already the current lease holder.
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.recoverLeaseInternal(FSNamesystem.java:2633)
        at org.apache.hadoop.hdfs.server.namenode.FSDirAppendOp.appendFile(FSDirAppendOp.java:122)
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.appendFile(FSNamesystem.java:2717)
        at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.append(NameNodeRpcServer.java:880)
        at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.append(ClientNamenodeProtocolServerSideTranslatorPB.java:351)
        at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)
        at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:529)
        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1073)
        at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1039)
        at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:963)
        at java.base/java.security.AccessController.doPrivileged(Native Method)
        at java.base/javax.security.auth.Subject.doAs(Subject.java:423)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:2065)
        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:3047)

```

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2162/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2162,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6PHzAK,incubator-uniffle,2401185802,2162,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-10-09T03:15:52Z,2024-10-09T03:15:52Z,What's your solution?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6PHzAK/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2162,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6PRhKa,incubator-uniffle,2403734170,2162,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-10-10T01:48:49Z,2024-10-10T01:48:49Z,Pleae attach your doc here @lwllvyb ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6PRhKa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2162,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6PR88u,incubator-uniffle,2403847982,2162,NA,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,NA,2024-10-10T03:08:11Z,2024-10-10T03:08:11Z,"https://docs.google.com/document/d/1Lb2D1FsZISXSKJO1WjyRJN2ymu_xiOFcVmKmYkoNmpQ/edit#heading=h.deydo9nszbc
I can add more details if necessary. @jerqi ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6PR88u/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2163,https://api.github.com/repos/apache/incubator-uniffle/issues/2163,incubator-uniffle,2575232775,2163,[Bug] Client was stuck when reading data in the memory of shufle server,dingshun3016,21172339,,,CLOSED,2024-10-09T08:43:38Z,2024-10-11T07:40:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The rss client was stuck when reading data in the memory of shufle server. From the container log, it can be seen that the task kept reading the block id `17595256313552` repeatedly

```
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 26 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 10 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 15 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 11 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 26 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 29 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 28 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 32 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 13 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 17 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 8 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 9 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 6 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 28 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 21 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 17 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 54 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 38 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 13 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 6 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 23 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 40 ms
24/10/09 04:54:29 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 21 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 26 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 4 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 7 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 5 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 56 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 64 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 4 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 5 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 50 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 9 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 20 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 16 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 59 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 5 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 18 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 37 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 7 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 5 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 5 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 6 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 16 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 5 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 6 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 5 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 5 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 7 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 19 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 24 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 8 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 24 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 33 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 69 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 58 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 63 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 17 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 15 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 6 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 35 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 23 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 12 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 25 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 17 ms
24/10/09 04:54:30 INFO [Executor task launch worker for task 22297] ShuffleServerGrpcNettyClient: GetInMemoryShuffleData from x.x.x.x:49999 for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366], lastBlockId[17595256313552] cost 27 ms
```

### Affects Version(s)

master

### Uniffle Server Log Output

```
[2024-10-09 04:54:00,652] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,653] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,654] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,655] [INFO] [nioEventLoopGroup-3-108] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,656] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,657] [INFO] [nioEventLoopGroup-3-108] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,659] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,660] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 1 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,661] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 1 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,662] [INFO] [nioEventLoopGroup-3-108] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,663] [INFO] [nioEventLoopGroup-3-108] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,665] [INFO] [nioEventLoopGroup-3-108] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,667] [INFO] [nioEventLoopGroup-3-108] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,668] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,670] [INFO] [nioEventLoopGroup-3-108] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 1 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,671] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,672] [INFO] [nioEventLoopGroup-3-357] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,673] [INFO] [nioEventLoopGroup-3-108] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
[2024-10-09 04:54:00,674] [INFO] [nioEventLoopGroup-3-108] [ShuffleServerNettyHandler] [operationComplete] >>> Successfully executed getMemoryShuffleData for appId[application_1726223638693_2862755_897411780-5594985], shuffleId[1], partitionId[366]. Took 0 ms and retrieved 539573 bytes of data
```
### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2163/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2164,https://api.github.com/repos/apache/incubator-uniffle/issues/2164,incubator-uniffle,2575589888,2164,[Improvement] Keep encoded size of block consistent between client and server,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-10-09T11:05:48Z,2024-10-09T11:05:48Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Keep the client side `ShuffleBlockInfo#getSize` and server side `ShufflePartitionedBlock#getSize` with the consistent `encoded header length`.

### How should we improve?

Client send the `encoded header length` to the server, then server use the received `encoded header length` for compute the `getSize` method.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2164/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2165,https://api.github.com/repos/apache/incubator-uniffle/issues/2165,incubator-uniffle,2577395279,2165,[Bug] Fix the exception caused by repeated unregister shuffle in tez tasks,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-10-10T02:48:44Z,2024-10-12T03:48:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Tez task throw exception like this:

```
2024-10-10 10:35:00,391 [ERROR] [AMShutdownThread] |app.RssDAGAppMaster|: Failed to release Rss resources.
java.lang.IllegalArgumentException
        at java.util.concurrent.ThreadPoolExecutor.<init>(ThreadPoolExecutor.java:1314)
        at java.util.concurrent.ThreadPoolExecutor.<init>(ThreadPoolExecutor.java:1237)
        at java.util.concurrent.Executors.newFixedThreadPool(Executors.java:151)
        at org.apache.uniffle.common.util.ThreadUtils.getDaemonFixedThreadPool(ThreadUtils.java:79)
        at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.unregisterShuffle(ShuffleWriteClientImpl.java:1036)
        at org.apache.tez.dag.app.TezRemoteShuffleManager.unregisterShuffle(TezRemoteShuffleManager.java:122)
        at org.apache.tez.dag.app.TezRemoteShuffleManager.shutdown(TezRemoteShuffleManager.java:115)
        at org.apache.tez.dag.app.RssDAGAppMaster.releaseRssResources(RssDAGAppMaster.java:307)
        at org.apache.tez.dag.app.RssDAGAppMaster.serviceStop(RssDAGAppMaster.java:283)
        at org.apache.hadoop.service.AbstractService.stop(AbstractService.java:220)
        at org.apache.tez.dag.app.DAGAppMaster$DAGAppMasterShutdownHandler$AMShutdownRunnable.run(DAGAppMaster.java:979)
        at java.lang.Thread.run(Thread.java:748)
```

It is not critical bug. In fact, this bug did not cause any negative effects. In fact, there are two way to unregister shuffle:
* (1) unregister shuffle by shuffle id
* (2) unregister shuffle by app id
(1) takes effect when stage or dag is completed. (2) take effect when app is finished.

For tez app, when dag is completed, will call (1). When app is finished, will call (2). But when we call (2), all shuffleServerInfoMap have been removed when call (1), and the pool size of executorService is 0, then throw IllegalArgumentException.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2165/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2169,https://api.github.com/repos/apache/incubator-uniffle/issues/2169,incubator-uniffle,2581708350,2169,[FEATURE] Support dynamic update thread pool,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-10-11T15:56:45Z,2024-10-16T03:26:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support dynamic update thread pool

### Motivation

For tuning purpose, we should update the core pool size or maximum pool size frequency to tuning the best performance, this will take us into a busy labor work, most time, we change config file and restart cluster.

With this feature, you can update the thread pool anytime by send  a rest api post request.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2169/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2171,https://api.github.com/repos/apache/incubator-uniffle/issues/2171,incubator-uniffle,2582414267,2171,[Improvement] [remote merge] remove cached block for partition.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-10-12T02:15:28Z,2024-10-18T07:10:13Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

I introduce cachedblockMap and mergedBlockMap in org.apache.uniffle.server.merge.Partition. It is used to get blocks quickly by map like data structure. Why I introduce this? Because blocks in ShuffleBuffer is linked list before. But after #1763, blocks in ShuffleBufferWithSkipList have been map like data structure. So remove cached block, and save memory. So after this, only ShuffleBufferWithSkipList is supported in remote merge mode.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2171/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2173,https://api.github.com/repos/apache/incubator-uniffle/issues/2173,incubator-uniffle,2582444014,2173,[FEATURE] [remote merge] support netty for remote merge.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-10-12T03:21:15Z,2024-10-22T12:23:10Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

support netty for remote merge.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2173/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2174,https://api.github.com/repos/apache/incubator-uniffle/issues/2174,incubator-uniffle,2582444671,2174,[FEATURE] [remote merge] Add metric for sorted api.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-10-12T03:22:54Z,2024-10-23T13:02:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

getSortedShuffleData was introduced by remote merge, need add metrics.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2174/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2178,https://api.github.com/repos/apache/incubator-uniffle/issues/2178,incubator-uniffle,2586226112,2178,[Flaky Test] org.apache.uniffle.test.RepartitionWithHadoopHybridStorageRssTest,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-10-14T14:31:56Z,2024-10-15T13:36:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
Error:  Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 33.57 s <<< FAILURE! - in org.apache.uniffle.test.RepartitionWithHadoopHybridStorageRssTest
Error:  resultCompareTest  Time elapsed: 30.338 s  <<< ERROR!
org.apache.spark.SparkException: 
Job aborted due to stage failure: Task 2 in stage 2.0 failed 1 times, most recent failure: Lost task 2.0 in stage 2.0 (TID 11, localhost, executor driver): org.apache.uniffle.common.exception.RssFetchFailedException: Failed to read shuffle data from HOT handler
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:124)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.read(ShuffleReadClientImpl.java:308)
	at org.apache.uniffle.client.impl.ShuffleReadClientImpl.readShuffleBlockData(ShuffleReadClientImpl.java:216)
	at org.apache.spark.shuffle.reader.RssShuffleDataIterator.hasNext(RssShuffleDataIterator.java:116)
	at org.apache.spark.util.collection.ExternalAppendOnlyMap.insertAll(ExternalAppendOnlyMap.scala:153)
	at org.apache.spark.Aggregator.combineCombinersByKey(Aggregator.scala:50)
	at org.apache.spark.shuffle.reader.RssShuffleReader.read(RssShuffleReader.java:228)
	at org.apache.spark.rdd.ShuffledRDD.compute(ShuffledRDD.scala:105)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:49)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:49)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:87)
	at org.apache.spark.scheduler.Task.run(Task.scala:109)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:345)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:750)
Caused by: io.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1
	at io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:83)
	at io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:148)
	at io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:101)
	at org.apache.uniffle.common.netty.buffer.NettyManagedBuffer.release(NettyManagedBuffer.java:59)
	at org.apache.uniffle.common.ShuffleIndexResult.release(ShuffleIndexResult.java:77)
	at org.apache.uniffle.storage.handler.impl.DataSkippableReadHandler.readShuffleData(DataSkippableReadHandler.java:82)
	at org.apache.uniffle.storage.handler.impl.ComposedClientReadHandler.readShuffleData(ComposedClientReadHandler.java:113)
	... 21 more
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/11327963829/job/31500140879?pr=2176

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2178/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2178,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6P3jWo,incubator-uniffle,2413704616,2178,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-10-15T11:53:37Z,2024-10-15T11:53:37Z,Duplicated: https://github.com/apache/incubator-uniffle/issues/1628,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6P3jWo/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2178,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6P4dFM,incubator-uniffle,2413941068,2178,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-10-15T13:36:08Z,2024-10-15T13:36:08Z,"@rickyma Thanks you for your remind, close this as this is duplicated.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6P4dFM/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2181,https://api.github.com/repos/apache/incubator-uniffle/issues/2181,incubator-uniffle,2587747274,2181,[Improvement] Replace ShuffleBlockInfo with ShufflePartitionedBlock in the server with netty mode.,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-10-15T06:12:08Z,2024-10-31T06:37:52Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

On the server side of the netty mode, when the server receives the sendShuffleData message, it decodes it into an unnecessary ShuffleBlockInfo and then converts it to ShufflePartitionedBlock in handleSendShuffleDataRequest. 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2181/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2188,https://api.github.com/repos/apache/incubator-uniffle/issues/2188,incubator-uniffle,2590467001,2188,[Bug] The same heartbeat is missed while the heartbeat RPC takes a long time.,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2024-10-16T03:10:25Z,2024-12-19T04:00:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug


We've added some new nodes to our production environment, and sometimes these nodes experience RPC timeouts (that's a separate issue). This can cause a lot of tasks to fail, and the reason for the failures is that some nodes haven't received heartbeats for a long time, leading to the app data being cleared from the server.

We found that there's a bit of an issue with the `timeoutMs` in `ShuffleWriteClientImpl#sendAppHeartbeat` method. The `timeoutMs` for per RPC is similar to the `timeoutMs of `ThreadUtils#executeTasks` for all servers RPC execute, and the logic here is flawed.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2188/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2190,https://api.github.com/repos/apache/incubator-uniffle/issues/2190,incubator-uniffle,2590485468,2190,[FEATURE] Add support about setting extra java properties in client side,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-10-16T03:24:12Z,2024-10-16T05:41:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In rss client side, it's necessary to set the extra java options by the config options, like the spark conf:     `spark.executor.extraJavaOptions`.

For example, I want to set the `io.grpc.netty.shaded.io.netty.eventLoopThreads` to avoid too much threads, in current codebase, I have to set it by the spark side javaOptions. This is not easy to make all jobs applied of this option. 

Samely, if we have the `rss.extra.JavaSystemProperties` config, this could be applied and controlled by the rss side rather than spark service.


### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2190/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2190,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6P-9r-,incubator-uniffle,2415647486,2190,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-10-16T03:24:24Z,2024-10-16T03:24:24Z,cc @maobaolong ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6P-9r-/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2192,https://api.github.com/repos/apache/incubator-uniffle/issues/2192,incubator-uniffle,2591046827,2192,[Improvement] Set rss.enabled to true in RssShuffleManager,wForget,17894939,Zhen Wang,wangzhen@apache.org,CLOSED,2024-10-16T08:15:58Z,2024-10-16T08:47:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Currently, uniffle determines whether reliable storage is supported based on `rss.enable` configuration and shuffle manager class.

https://github.com/apache/incubator-uniffle/blob/a36261296b05d72e4a774d9c9555cc12b922be97/client-spark/spark3/src/main/java/org/apache/spark/shuffle/RssShuffleDriverComponents.java#L37-L42

This makes RssShuffleManager subclasses like UniffleShuffleManager in gluten not be considered to support reliable storage, causing DRA to not work, see https://github.com/apache/incubator-gluten/issues/7559 .

Can we set `rss.enabled` to true in `RssShuffleManager`?

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2192/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2194,https://api.github.com/repos/apache/incubator-uniffle/issues/2194,incubator-uniffle,2593285368,2194,[Subtask] how to enter into uniffle wechat？The previous WeChat account has become invalid，Could some one send the group WeChat QR code again,echomyecho,10241833,,,OPEN,2024-10-16T23:54:01Z,2024-10-21T11:34:23Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the subtask

ow to enter into uniffle wechat？

### Parent issue

how to enter into uniffle wechat？

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2194/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2194,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6QoDg6,incubator-uniffle,2426419258,2194,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-10-21T11:34:22Z,2024-10-21T11:34:22Z,"![1501729510439_ pic](https://github.com/user-attachments/assets/a1d1f61a-4616-4d4a-998d-e37ef489dd6b)
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6QoDg6/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2197,https://api.github.com/repos/apache/incubator-uniffle/issues/2197,incubator-uniffle,2596376599,2197,[Improvement] Support reg app conf to server and avoid update committed/cached blockIds bitmap,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-10-18T04:31:50Z,2024-10-29T12:41:05Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Avoid update committed/cached blockIds bitmap while storage type is with memory.

### How should we improve?

Reg app conf to server so that sever can check whether the client use a storage type with memory, if so, server do not update the cachedBlockIds and committedBlockIds bitmap to reduce the cpu useage.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2197/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2198,https://api.github.com/repos/apache/incubator-uniffle/issues/2198,incubator-uniffle,2596590397,2198,[Improvement] reduce the redundant appId info for partitionKey in AbstractStorage,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-10-18T06:46:53Z,2024-10-24T03:32:12Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

There are three private variables in AbstractStorage that use partitionKey as the key for the internal Map.  
PartitionKey uses the redundant appId info which is already the first key of the three private variables .

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2198/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2200,https://api.github.com/repos/apache/incubator-uniffle/issues/2200,incubator-uniffle,2596643868,2200,[DOCS] [remote merge] Add document for remote merge.,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-10-18T07:11:16Z,2024-10-24T10:16:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

_No response_

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2200/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2201,https://api.github.com/repos/apache/incubator-uniffle/issues/2201,incubator-uniffle,2597060032,2201,[Improvement] Remove the ShuffleBlockInfo used in the communication between client and server via handleSendShuffleDataRequest.,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,OPEN,2024-10-18T09:57:56Z,2024-10-18T11:39:32Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

1. Remove the ShuffleBlockInfo used in the communication between client and server via handleSendShuffleDataRequest.
2. The code `byteBuf.writeInt(shuffleBlockInfo.getLength());` in  encodeShuffleBlockInfo is redundant, because the block data length has been encoded in `shuffleBlockInfo.copyDataTo(byteBuf)` 

Related PR: #2181 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2201/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2203,https://api.github.com/repos/apache/incubator-uniffle/issues/2203,incubator-uniffle,2598715477,2203,[FEATURE] Add write file quantity info for application. ,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-10-19T03:55:24Z,2024-10-23T11:44:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Add write file quantity info for application. 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2203/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2205,https://api.github.com/repos/apache/incubator-uniffle/issues/2205,incubator-uniffle,2598716596,2205,[FEATURE] Display version and gitCommitId in one column,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-10-19T03:57:29Z,2024-10-21T11:28:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Display version and gitCommitId in one column

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2205/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2207,https://api.github.com/repos/apache/incubator-uniffle/issues/2207,incubator-uniffle,2598718476,2207,[FEATURE] Add the write information of appinfo in Shuflle Server heartbeat,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-10-19T04:00:03Z,2024-10-21T11:35:28Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Add the write information of appinfo in Shuflle Server heartbeat

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2207/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2209,https://api.github.com/repos/apache/incubator-uniffle/issues/2209,incubator-uniffle,2598882343,2209,[FEATURE] Support config buffer size for LocalFileWriter,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-10-19T08:01:56Z,2024-10-21T10:14:22Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Support config buffer size for LocalFileWriter

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2209/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2211,https://api.github.com/repos/apache/incubator-uniffle/issues/2211,incubator-uniffle,2601229143,2211,[FEATURE] Display the write infomartion of application in dashboard ,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-10-21T03:52:24Z,2024-10-23T11:45:44Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Display the write infomartion of application in dashboard 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2211/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2212,https://api.github.com/repos/apache/incubator-uniffle/issues/2212,incubator-uniffle,2601318729,2212,[Improvement] Avoid send BlockIdLayout for each GetShuffleResultRequest and GetShuffleResultForMultiPartRequest,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-10-21T04:50:59Z,2024-10-21T04:50:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Avoid send BlockIdLayout for each GetShuffleResultRequest and GetShuffleResultForMultiPartRequest

### How should we improve?

Store the BlockIdLayout for current application to the server side.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2212/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2219,https://api.github.com/repos/apache/incubator-uniffle/issues/2219,incubator-uniffle,2608583947,2219,[FEATURE] Bitmap in shuffle server contains multiple partitions' blocks causing performance issues.,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-10-23T13:19:25Z,2024-11-18T06:16:22Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In our internal clusters, we found the shuffle server performance will decrease because the bitmap contains multiple partitions' blocks.
Although we can use `rss.client.bitmap.splitNum` to split the bitmap, there will still be multiple partitions sharing the bitmap. Concurrent access the bitmap will cause performance degradation.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2219/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2222,https://api.github.com/repos/apache/incubator-uniffle/issues/2222,incubator-uniffle,2617058982,2222,[FEATURE] Introduce LocalFileWriterFactory and LocalFileNioWriter implementation,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-10-28T01:37:15Z,2024-10-29T00:50:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Abstract a LocalFileWriterFactory responsible for create variety of implementation for LocalFileWriter. And create a `LocalFileNioWriter` implementation which use nio direct byte buffer write to file channel directly without any byte array create and copy.

### Motivation

Avoid a huge number/size of objects created by LocalFileWriter

<img width=""2294"" alt=""企业微信截图_e937475c-1294-4782-a0f0-1f62081d67e9"" src=""https://github.com/user-attachments/assets/8a42327a-eece-4b44-ad60-14c0dfa30c33"">

<img width=""2283"" alt=""企业微信截图_c9f4d29b-b779-42b2-8203-6b73d65e04e9"" src=""https://github.com/user-attachments/assets/329eceb2-593b-4b9b-9abf-8ae3056b1438"">


### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2222/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2229,https://api.github.com/repos/apache/incubator-uniffle/issues/2229,incubator-uniffle,2628140630,2229,[FEATURE] Display the partitionId by segment style,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-11-01T01:52:48Z,2024-11-06T10:54:49Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Display the partitionId by segment style

Something like this `[1,100],[200,300]`

### Motivation

This is a part of log from rss client.
```
[15:11:04:242] [client-data-transfer-37] INFO  org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.requirePreAllocation:366 - Can't require buffer for appId: application_1703049085550_23144576_1729060670042, shuffleId: 2, partitionIds: [11371, 11372, 11373, 11374, 11375, 11376, 11377, 11378, 11379, 11380, 11381, 11382, 11383, 11384, 11385, 11386, 11387, 11388, 11389, 11390, 11391, 11392, 11393, 11394, 11395, 11396, 11397, 11398, 11399, 11400, 11401, 11402, 11403, 11404, 11405, 11406, 11407, 11408, 11409, 11410, 11411, 11412, 11413, 11414, 11415, 11416, 11417, 11418, 11419, 11420, 11421, 11422, 11423, 11424, 11425, 11426, 11427, 11428, 11429, 11430, 11431, 11432, 11433, 11434, 11435, 11436, 11437, 11438, 11439, 11440, 11441, 11442, 11443, 11444, 11445, 11446, 11447, 11448, 11449, 11450, 11451, 11452, 11453, 11454, 11455, 11456, 11457, 11458, 11459, 11460, 11461, 11462, 11463, 11464, 11465, 11466, 11467, 11468, 11469, 11470, 11471, 11472, 11473, 11474, 11475, 11476, 11477, 11478, 11479, 11480, 11481, 11482, 11483, 11484, 11485, 11486, 11487, 11488, 11489, 11490, 11491, 11492, 11493, 11494, 11495, 11496, 11497, 11498, 11499, 11500, 11501, 11502, 11503, 11504, 11505, 11506, 11507, 11508, 11509, 11510, 11511, 11512, 11513, 11514, 11515, 11516, 11517, 11518, 11519, 11520, 11521, 11522, 11523, 11524, 11525, 11526, 11527, 11528, 11529, 11530, 11531, 11532, 11533, 11534, 11535, 11536, 11537, 11538, 11539, 11540, 11541, 11542, 11543, 11544, 11545, 11546, 11547, 11548, 11549, 11550, 11551, 11552, 11553, 11554, 11555, 11556, 11557, 11558, 11559, 11560, 11561, 11562, 11563, 11564, 11565, 11566, 11567, 11568, 11569, 11570, 11571, 11572, 11573, 11574, 11575, 11576, 11577, 11578, 11579, 11580, 11581, 11582, 11583, 11584, 11585, 11586, 11587, 11588, 11589, 11590, 11591, 11592, 11593, 11594, 11595, 11596, 11597, 11598, 11599, 11600, 11601, 11602, 11603, 11604, 11605, 11606, 11607, 11608, 11609, 11610, 11611, 11612, 11613, 11614, 11615, 11616, 11617, 11618, 11619, 11620, 11621, 11622, 11623, 11624, 11625, 11626, 11627, 11628, 11629, 11630, 11631, 11632, 11633, 11634, 11635, 11636, 11637, 11638, 11639, 11640, 11641, 11642, 11643, 11644, 11645, 11646, 11647, 11648, 11649, 11650, 11651, 11652, 11653, 11654, 11655, 11656, 11657, 11658, 11659, 11660, 11661, 11662, 11663, 11664, 11665, 11666, 11667, 11668, 11669, 11670, 11671, 11672, 11673, 11674, 11675, 11676, 11677, 11678, 11679, 11680, 11681, 11682, 11683, 11684, 11685, 11686, 11687, 11688, 11689, 11690, 11691, 11692, 11693, 11694, 11695, 11696, 11697, 11698, 11699, 11700, 11701, 11702, 11703, 11704, 11705, 11706, 11707, 11708, 11709, 11710, 11711, 11712, 11713, 11714, 11715, 11716, 11717, 11718, 11719, 11720, 11721, 11722, 11723, 11724, 11725, 11726, 11727, 11728, 11729, 11730, 11731, 11732, 11733, 11734, 11735, 11736, 11737, 11738, 11739, 11740, 11741, 11742, 11743, 11744, 11745, 11746, 11747, 11748, 11749, 11750, 11751, 11752, 11753, 11754, 11755, 11756, 11757, 11758, 11759, 11760, 11761, 11762, 11763, 11764, 11765, 11766, 11767, 11768, 11769, 11770, 11771, 11772, 11773, 11774, 11775, 11776, 11777, 11778, 11779, 11780, 11781, 11782, 11783, 11784, 11785, 11786, 11787, 11788, 11789, 11790, 11791, 11792, 11793, 11794, 11795, 11796, 11797, 11798, 11799, 11800, 11801, 11802, 11803, 11804, 11805, 11806, 11807, 11808, 11809, 11810, 11811, 11812, 11813, 11814, 11815, 11816, 11817, 11818, 11819, 11820, 11821, 11822, 11823, 11824, 11825, 11826, 11827, 11828, 11829, 11830, 11831, 11832, 11833, 11834, 11835, 11836, 11837, 11838, 11839, 11840, 11841, 11842, 11843, 11844, 11845, 11846, 11847, 11848, 11849, 11850, 11851, 11852, 11853, 11854, 11855, 11856, 11857, 11858, 11859, 11860, 11861, 11862, 11863, 11864, 11865, 11866, 11867, 11868, 11869, 11870, 11871, 11872, 11873, 11874, 11875, 11876, 11877, 11878, 11879, 11880, 11881, 11882, 11883, 11884, 11885, 11886, 11887, 11888, 11889, 11890, 11891, 11892, 11893, 11894, 11895, 11896, 11897, 11898, 11899, 11900, 11901, 11902, 11903, 11904, 11905, 11906, 11907, 11908, 11909, 11910, 11911, 11912, 11913, 11914, 11915, 11916, 11917, 11918, 11919, 11920, 11921, 11922, 11923, 11924, 11925, 11926, 11927, 11928, 11929, 11930, 11931, 11932, 11933, 11934, 11935, 11936, 11937, 11938, 11939, 11940, 11941, 11942, 11943, 11944, 11945, 11946, 11947, 11948, 11949, 11950, 11951, 11952, 11953, 11954, 11955, 11956, 11957, 11958, 11959, 11960, 11961, 11962, 11963, 11964, 11965, 11966, 11967, 11968, 11969, 11970, 11971, 11972, 11973, 11974, 11975, 11976, 11977, 11978, 11979, 11980, 11981, 11982, 11983, 11984, 11985, 11986, 11987, 11988, 11989, 11990, 11991, 11992, 11993, 11994, 11995, 11996, 11997, 11998, 11999, 12000, 12001, 12002, 12003, 12004, 12005, 12006, 12007, 12008, 12009, 12010, 12011, 12012, 12013, 12014, 12015, 12016, 12017, 12018, 12019, 12020, 12021, 12022, 12023, 12024, 12025, 12026, 12027, 12028, 12029, 12030, 12031, 12032, 12033, 12034, 12035, 12036, 12037, 12038, 12039, 12040, 12041, 12042, 12043, 12044, 12045, 12046, 12047, 12048, 12049, 12050, 12051, 12052, 12053, 12054, 12055, 12056, 12057, 12058, 12059, 12060, 12061, 12062, 12063, 12064, 12065, 12066, 12067, 12068, 12069, 12070, 12071, 12072, 12073, 12074, 12075, 12076, 12077, 12078, 12079] with 25121140 bytes from XXX:19977 due to NO_BUFFER, sleep and try[2] again

```

### Describe the solution

We can only output `[11371,12079]` instead of the above long text.

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2229/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2241,https://api.github.com/repos/apache/incubator-uniffle/issues/2241,incubator-uniffle,2648268649,2241,[Bug] Potential app level dead lock when flush buffer or removing resources in shuffle-server side,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-11-11T06:04:19Z,2024-11-19T03:49:25Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When removing resources, the app level lock will be required. But this is not expected with its execution time, especially in the disk corruption or HDFS unstable.

![image](https://github.com/user-attachments/assets/f0033e7c-6f8a-45ed-85f5-f58d4c7a0508)

I found shuffle-server will hang when the disk is corrupted, this is caused by this app level lock when removing resources. Once the disk corrupted, the any IO operations are hang, and then the lock will not be released.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2241/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2241,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6TE3Yi,incubator-uniffle,2467526178,2241,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-11-11T08:30:01Z,2024-11-11T08:30:01Z,"In current stage, for reducing effect of corrupted directory, I will introduce the extra config option to mark server unhealthy once its dir corrupted.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6TE3Yi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2241,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6TFGQs,incubator-uniffle,2467587116,2241,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-11-11T08:59:30Z,2024-11-11T08:59:30Z,#1958 has fixed the partial bug about removing resources.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6TFGQs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2241,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6TFmUi,incubator-uniffle,2467718434,2241,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2024-11-11T09:59:40Z,2024-11-11T09:59:40Z,"In DefaultFlushEventHandler, I will introduce the dedicated thread pool for every local disk to eliminate interference. cc @xianjingfeng ","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6TFmUi/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2242,https://api.github.com/repos/apache/incubator-uniffle/issues/2242,incubator-uniffle,2648286262,2242,[FEATURE] Split one huge event into multi small events to improve HDFS flush performance ,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2024-11-11T06:15:31Z,2024-11-11T06:15:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

In current codebase, for huge partition, before it marked as huge partition,it will be reserved in the memory if having enough capacity. But when it is marked as huge partition, then it should be flushed into the HDFS, if this is specified.

In this first flushing process of this huge partition, it sometimes will be large, especially with the huge buffer capacity. And this  will be slow because it is a huge flush event, which is not benifited from the concurrency hdfs partition writing mechanism.
And it will occupy memory space before this flush is finished, and will make the client backpressure.

From this point, the smaller flush event is better for shuffle-server throughout. But the local IO hope the big flush data buffer, which is a trade off.

Anyway, the huge partition huge flush event splited into multi small events to improve writing performance is useful. 

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2242/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2243,https://api.github.com/repos/apache/incubator-uniffle/issues/2243,incubator-uniffle,2648308611,2243,[Improvement] Unexpected exception when flushing buffer due to disk corruption,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-11-11T06:30:54Z,2024-11-11T07:14:42Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

The flush thread will hang when disk is corrupted.

Let's use the following ways to solve/find this bug.

1. Record the event flushing hang time
2. Too long flush operation should be dropped 

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2243/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2251,https://api.github.com/repos/apache/incubator-uniffle/issues/2251,incubator-uniffle,2664340145,2251,[Bug] Wrong disk used space while config multiply dirs in one mount point,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-11-16T13:26:50Z,2024-11-18T12:14:07Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

LocalStorageManager#getStorageInfo return wrong used space of the disk if there are more than one dirs configured to one disk.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2251/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2257,https://api.github.com/repos/apache/incubator-uniffle/issues/2257,incubator-uniffle,2670638773,2257,[FEATURE] Coordinator supports EstimateDiskSpaceQuotaManager,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2024-11-19T03:49:35Z,2024-11-19T03:49:35Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Spark Job configures its estimate disk space in its Spark configurations. Uniffle pass the estimate disk space to the coordinator. If the disk space exceeds the limitation of disk space, coordinator will reject the Spark Job.
More code you can see `AbstractAccessChecker` to add a new access checker in the coordinator code. 
For Spark client, you can see `DelegationRssShuffleManager`.

### Motivation

Avoid large jobs concurrently running.

### Describe the solution

Add a new access checker class.

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2257/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2259,https://api.github.com/repos/apache/incubator-uniffle/issues/2259,incubator-uniffle,2685452683,2259,[Bug] The private variable dataLength of ShuffleBufferWithLinkedList not be cleared after toFlushEvent.,lwllvyb,9214716,leewish,mr.liwenlong@outlook.com,CLOSED,2024-11-23T05:50:18Z,2024-11-25T06:03:27Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The private variable dataLength of ShuffleBufferWithLinkedList not be cleared after toFlushEvent.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2259/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2261,https://api.github.com/repos/apache/incubator-uniffle/issues/2261,incubator-uniffle,2689141102,2261,[FEATURE] Introduce a common BannedManager to ban the found bad application,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-11-25T04:56:58Z,2024-11-25T04:56:58Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Provide a common way to banned an app to fallback to SORT shuffle manager. The app id can be extracted from a specific spark conf.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2261/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2262,https://api.github.com/repos/apache/incubator-uniffle/issues/2262,incubator-uniffle,2689471001,2262,[Improvement] Improve metrics performance by cache Thread info reporter,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-11-25T07:02:57Z,2024-11-25T07:02:57Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

<img width=""2050"" alt=""image"" src=""https://github.com/user-attachments/assets/2220e4a3-8971-4157-8ca9-53ea0341c0b7"">


### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2262/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2263,https://api.github.com/repos/apache/incubator-uniffle/issues/2263,incubator-uniffle,2690208171,2263,[DOCS] Introduce MultiPartLocalStorageManager,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-11-25T10:42:53Z,2024-11-25T10:42:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

_No response_

### Affects Version(s)

master

### Improving the documentation

_No response_

### Anything else

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2263/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2269,https://api.github.com/repos/apache/incubator-uniffle/issues/2269,incubator-uniffle,2712212319,2269,[Bug] Client do not honor CANCEL interrupt exception while reportShuffleResult cause duplicated blockIds,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-12-02T14:47:05Z,2025-01-04T06:23:53Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Client continue to reportShuffleResult even interrupted by caller. this can cause server received duplicated reportShufflerResult rpc which harm for server cpu.

It should better to stop retrying and throw RssException.

### Affects Version(s)

master

### Uniffle Server Log Output

```logtalk
- Server.log

[2024-11-29 02:43:02.906] [Grpc-311] [WARN] ShuffleServerGrpcService - Existing 300 duplicated blockIds on blockId report for appId: application_1729849261128_3823937_1732816526781, shuffleId: 6
```

- Server Rpc audit log
```
[2024-11-29 02:43:02.893] appId application_1729849261128_3823937_1732816526781 cmd=reportShuffleResult argstaskAttemptId=16897, bitmapNum=10, partitionToBlockIdsSize=300
```


<img width=""1601"" alt=""image"" src=""https://github.com/user-attachments/assets/2e2a774e-64bf-4178-9e12-93ee433384e7"">
```


### Uniffle Engine Log Output

```logtalk
spark.log


[02:42:51:164] [Executor task launch worker for task 2112.1 in stage 9.0 (TID 54359)] INFO  org.apache.spark.shuffle.writer.RssShuffleWriter.<init>:193 - RssShuffle start write taskAttemptId[16897] data with RssHandle[appId application_1729849261128_3823937_1732816526781, shuffleId 6].

[02:42:56:731] [Executor task launch worker for task 2112.1 in stage 9.0 (TID 54359)] INFO  org.apache.spark.shuffle.writer.WriteBufferManager.clear:365 - Flush total buffer for shuffleId[6] with allocated[134217728], dataSize[113121456], memoryUsed[124038144], number of blocks[6000], flush ratio[1.0]
[02:42:59:230] [dispatcher-Executor] INFO  org.apache.spark.executor.Executor.logInfo:61 - Executor is trying to kill task 2112.1 in stage 9.0 (TID 54359), reason: another attempt succeeded

[02:43:03:205] [Executor task launch worker for task 2112.1 in stage 9.0 (TID 54359)] WARN  org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.doReportShuffleResult:797 - Report shuffle result to host[192.168.1.100], port[19977] failed, try again, retryNum[100]
org.apache.uniffle.shaded.io.grpc.StatusRuntimeException: CANCELLED: Thread interrupted
	at org.apache.uniffle.shaded.io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCalls.java:268) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.uniffle.shaded.io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:249) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.uniffle.shaded.io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:167) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.uniffle.proto.ShuffleServerGrpc$ShuffleServerBlockingStub.reportShuffleResult(ShuffleServerGrpc.java:814) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.doReportShuffleResult(ShuffleServerGrpcClient.java:793) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.reportShuffleResult(ShuffleServerGrpcClient.java:762) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.reportShuffleResult(ShuffleWriteClientImpl.java:724) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.spark.shuffle.writer.RssShuffleWriter.stop(RssShuffleWriter.java:778) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:60) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.scheduler.Task.run(Task.scala:136) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:548) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1556) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:551) ~[spark-core_2.12-3.3.1.jar:3.3.1]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_392]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_392]
	at java.lang.Thread.run(Thread.java:750) ~[?:1.8.0_392]
Caused by: java.lang.InterruptedException
	at org.apache.uniffle.shaded.io.grpc.stub.ClientCalls$ThreadlessExecutor.throwIfInterrupted(ClientCalls.java:750) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.uniffle.shaded.io.grpc.stub.ClientCalls$ThreadlessExecutor.waitAndDrain(ClientCalls.java:711) ~[rss-client-spark3-shaded.jar:?]
	at org.apache.uniffle.shaded.io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:159) ~[rss-client-spark3-shaded.jar:?]
	... 15 more
[02:43:03:206] [Executor task launch worker for task 2112.1 in stage 9.0 (TID 54359)] WARN  org.apache.uniffle.client.impl.ShuffleWriteClientImpl.reportShuffleResult:747 - Report shuffle result is failed to ShuffleServerInfo{host[192.168.1.100], grpc port[19977], netty port[17000]} for appId[application_1729849261128_3823937_1732816526781], shuffleId[6]
[02:43:03:208] [Executor task launch worker for task 2112.1 in stage 9.0 (TID 54359)] WARN  org.apache.spark.memory.ExecutionMemoryPool.logWarning:73 - Internal error: release called on 10179584 bytes but task only has 0 bytes of memory from the on-heap execution pool
[02:43:03:208] [Executor task launch worker for task 2112.1 in stage 9.0 (TID 54359)] INFO  org.apache.spark.executor.Executor.logInfo:61 - Executor interrupted and killed task 2112.1 in stage 9.0 (TID 54359), reason: another attempt succeeded
```
```


### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2269/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2273,https://api.github.com/repos/apache/incubator-uniffle/issues/2273,incubator-uniffle,2717553338,2273,[Flaky Test] Throw an  io.netty.util.IllegalReferenceCountException,jerqi,8159038,roryqi,roryqi@apache.org,OPEN,2024-12-04T12:10:57Z,2024-12-05T09:45:47Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

Caused by: io.netty.util.IllegalReferenceCountException: refCnt: 0
	at io.netty.buffer.AbstractByteBuf.ensureAccessible(AbstractByteBuf.java:1454)
	at io.netty.buffer.AbstractByteBuf.checkIndex(AbstractByteBuf.java:1383)
	at io.netty.buffer.PooledByteBuf.duplicateInternalNioBuffer(PooledByteBuf.java:196)
	at io.netty.buffer.PooledByteBuf.nioBuffer(PooledByteBuf.java:213)
	at io.netty.buffer.AbstractByteBuf.nioBuffer(AbstractByteBuf.java:1231)
	at org.apache.uniffle.common.netty.buffer.NettyManagedBuffer.nioByteBuffer(NettyManagedBuffer.java:48)
	at org.apache.uniffle.common.ShuffleIndexResult.getIndexData(ShuffleIndexResult.java:84)

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/12158115239/attempts/1

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2273/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WCTXg,incubator-uniffle,2517186016,2273,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-04T12:15:28Z,2024-12-04T12:15:28Z,"Maybe we shouldn't use PooledByteBuf. Because we will release the memory after we used the memory. You can see https://github.com/apache/incubator-uniffle/blob/28475fced12f5a4b79152d146ead1917982f44b9/storage/src/main/java/org/apache/uniffle/storage/handler/impl/DataSkippableReadHandler.java#L82

cc @maobaolong @advancedxy @rickyma @LuciferYang  WDYT?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WCTXg/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WJFfl,incubator-uniffle,2518964197,2273,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-12-05T02:40:23Z,2024-12-05T02:40:23Z,"Users can choose whatever kind of bytebuf they want:
client: https://github.com/apache/incubator-uniffle/issues/1767
server: https://github.com/apache/incubator-uniffle/issues/2145

We basically will release every bytebuf, but it does not mean that we don't need PooledByteBuf.
We use PooledByteBuf to reduce the number of interactions with the operating system for memory allocation and deallocation. This helps to avoid potential issues such as abnormal growth of RSS (Resident Set Size) memory, which might occur due to frequent and inefficient memory management (especially when using glibc, that's why we recommend using [mimalloc](https://github.com/apache/incubator-uniffle/blob/master/docs/server_guide.md#malloc-recommendation)).","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WJFfl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WJN9Z,incubator-uniffle,2518998873,2273,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-05T03:15:57Z,2024-12-05T03:15:57Z,"> Users can choose whatever kind of bytebuf they want: client: #1767 server: #2145
> 
> We basically will release every bytebuf, but it does not mean that we don't need PooledByteBuf. We use PooledByteBuf to reduce the number of interactions with the operating system for memory allocation and deallocation. This helps to avoid potential issues such as abnormal growth of RSS (Resident Set Size) memory, which might occur due to frequent and inefficient memory management (especially when using glibc, that's why we recommend using [mimalloc](https://github.com/apache/incubator-uniffle/blob/master/docs/server_guide.md#malloc-recommendation)).

But it will throw a ref count exception in our UT. I suspect that we released a reused bytebuf in the ByteBuf pool.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WJN9Z/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WKgIZ,incubator-uniffle,2519335449,2273,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-12-05T06:41:17Z,2024-12-05T06:41:17Z,"I didn't look into the code carefully. I suppose this should be a bug. @maobaolong 

Similar to https://github.com/apache/incubator-uniffle/issues/1628?","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WKgIZ/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WL6-S,incubator-uniffle,2519707538,2273,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-05T09:14:15Z,2024-12-05T09:14:15Z,"> I didn't look into the code carefully. I suppose this should be a bug. @maobaolong
> 
> Similar to #1628?

Yes, they are similar.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WL6-S/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2273,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WMNLr,incubator-uniffle,2519782123,2273,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-05T09:45:44Z,2024-12-05T09:45:44Z,"I suspect that the issue is caused by `TransportFrameDecoder`
```
  @Override
  public void handlerRemoved(ChannelHandlerContext ctx) throws Exception {
    // Release all buffers that are still in our ownership.
    // Doing this in handlerRemoved(...) guarantees that this will happen in all cases:
    //     - When the Channel becomes inactive
    //     - When the decoder is removed from the ChannelPipeline
    for (ByteBuf b : buffers) {
      b.release();
    }
    buffers.clear();
    headerBuf.release();
    super.handlerRemoved(ctx);
  }
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WMNLr/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2274,https://api.github.com/repos/apache/incubator-uniffle/issues/2274,incubator-uniffle,2719772359,2274,[Improvement] Unnecessary memory copy,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2024-12-05T08:51:36Z,2024-12-05T09:09:16Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?
![image](https://github.com/user-attachments/assets/13592c7c-4575-4b97-a8b4-403b248e7e86)


### How should we improve?

If we use direct memory, maybe we should remove `getData`.

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2274/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2275,https://api.github.com/repos/apache/incubator-uniffle/issues/2275,incubator-uniffle,2719780518,2275,[Improvement] We should use `buffer` method instead `heapBuffer`,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2024-12-05T08:55:33Z,2025-01-15T06:56:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?
Spark code use buffer instead `heapBuffer`.

![image](https://github.com/user-attachments/assets/0c96f14a-bd14-4d98-be11-625f3f23d35e)


### How should we improve?

We should use `buffer` method instead `heapBuffer`

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2275/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2275,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WLv-H,incubator-uniffle,2519662471,2275,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-05T08:55:44Z,2024-12-05T08:55:44Z,cc @maobaolong @rickyma ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WLv-H/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2275,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WZoJs,incubator-uniffle,2523300460,2275,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-12-06T13:52:06Z,2024-12-06T13:52:06Z,I think it should be `ByteBuf header = ctx.alloc().directBuffer(headerLength);` ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6WZoJs/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2275,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Wb8U4,incubator-uniffle,2523907384,2275,NA,rickyma,13834479,RickyMa,mhx8888@gmail.com,NA,2024-12-06T18:24:26Z,2024-12-06T18:24:26Z,"We can use DirectBuffer, but we need to release the bytebuf manually.
The length of the header is not large, so it is acceptable to use HeapBuffer.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Wb8U4/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2275,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6aezMj,incubator-uniffle,2591765283,2275,NA,cchung100m,6762509,Neo Chien,,NA,2025-01-15T06:42:11Z,2025-01-15T06:42:11Z,"It seems like that we decide to keep the current design here, right? If yes, we  can close this issue now.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6aezMj/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2275,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ae3mq,incubator-uniffle,2591783338,2275,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2025-01-15T06:56:58Z,2025-01-15T06:56:58Z,"> It seems like that we decide to keep the current design here, right? If yes, we can close this issue now.

OK, I closed it.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ae3mq/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2278,https://api.github.com/repos/apache/incubator-uniffle/issues/2278,incubator-uniffle,2725225329,2278,[Improvement] org.apache.spark.serializer.JavaSerializer does not support object relocation.,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-12-08T12:59:04Z,2024-12-08T12:59:04Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

```
24/10/24 21:14:00 ERROR ApplicationMaster: User class threw exception: java.lang.IllegalArgumentException: Can't use serialized shuffle for shuffleId: 0, because the serializer: org.apache.spark.serializer.JavaSerializer does not support object relocation.
```

### How should we improve?

Support reject JavaSerializer earlier and use sort shuffleManager instead.

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2278/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2279,https://api.github.com/repos/apache/incubator-uniffle/issues/2279,incubator-uniffle,2725263090,2279,[Improvement] The upstream rewrite is triggered when the read stage fails.,yl09099,33595968,,,CLOSED,2024-12-08T14:04:53Z,2024-12-20T06:40:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

If the current Reader fails to obtain Shuffle data, it does not trigger the upstream Stage to rewrite the data. If a Shuffle Server fails, it does not trigger Stage retry.

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2279/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2282,https://api.github.com/repos/apache/incubator-uniffle/issues/2282,incubator-uniffle,2728787135,2282,[Bug] Invalid invoking in the DelegationRssShuffleManager#getReader,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-12-10T02:32:59Z,2024-12-11T01:30:20Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

```java
try {
      reader =
          (ShuffleReader<K, C>)
              delegate
                  .getClass()
                  .getDeclaredMethod(
                      ""getReader"",
                      ShuffleHandle.class,
                      int.class,
                      int.class,
                      int.class,
                      int.class,
                      TaskContext.class,
                      ShuffleReadMetricsReporter.class)
                  .invoke(
                      handle,
                      startMapIndex,
                      endMapIndex,
                      startPartition,
                      endPartition,
                      context,
                      metrics);
    } catch (Exception e) {
      throw new RssException(e);
    }
```

The delegation object is not propogated into the invoke method.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2282/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2284,https://api.github.com/repos/apache/incubator-uniffle/issues/2284,incubator-uniffle,2729390913,2284,[Bug] Reallocating ShuffleServer functionality during the write phase takes up a lot of Driver memory.,yl09099,33595968,,,OPEN,2024-12-10T08:31:11Z,2024-12-10T08:31:11Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When the Executor obtains the ShuffleHandleInfo object from the Driver, if the number of writers and readers is too large (the number of partitions is too large), the ShuffleServer function is reassigned during the write failure phase. GRPC thread ShuffleHandleInfo converted to RPC message, causing a large memory footprint, resulting in Driver crash.

### Affects Version(s)

0.10.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2284/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2288,https://api.github.com/repos/apache/incubator-uniffle/issues/2288,incubator-uniffle,2734589910,2288,"[FEATURE] Add node info in excludeNode page, remove ExcludeNodeList.vue",kuszz,21366445,kqhzz,kuangqinghuazz@163.com,CLOSED,2024-12-12T02:51:52Z,2024-12-18T02:06:56Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Show nodeInfo in excludeNode page


### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2288/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2290,https://api.github.com/repos/apache/incubator-uniffle/issues/2290,incubator-uniffle,2741195530,2290,[Bug] Fail to build the Centos image,jerqi,8159038,roryqi,roryqi@apache.org,CLOSED,2024-12-16T03:00:16Z,2024-12-16T05:33:45Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I failed to build the Centos image. It lacks which command.

### Affects Version(s)

master/1.10.0

### Uniffle Server Log Output

```logtalk
Fail to build centos image
```


### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2290/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2292,https://api.github.com/repos/apache/incubator-uniffle/issues/2292,incubator-uniffle,2741411331,2292,[Bug] Potenial hang when HadoopShuffleWriteHandler initialization failure in PooledHadoopShuffleWriteHandler,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-12-16T05:58:15Z,2024-12-17T03:25:14Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

When encountering the HadoopShuffleWriteHandler initialization failure like permission or other causes, the PooledHadoopShuffleWriteHandler#write will be hang due to the incorrect initialization flag, this will make shuffle-server out of service.

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2292/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2294,https://api.github.com/repos/apache/incubator-uniffle/issues/2294,incubator-uniffle,2741832946,2294,[Bug] [client] Memory leak may in `WriteBufferManager`,xumanbu,9135743,xumanbu,manbu.feng@163.com,CLOSED,2024-12-16T09:31:53Z,2024-12-18T13:32:54Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug


A task failed due to insufficient executor memory, yet the allocated bytes for the task is 0 after one executor executed many tasks.

The error log below may be unexpected since `spark.executor.cores` is set to 1.
```
org.apache.uniffle.common.exception.RssException: 
Can't get memory to cache shuffle data,
request[16777216], got[0], WriteBufferManager allocated[0] task used[0]. It may be caused by shuffle server is full of data or consider to optimize 'spark.executor.memory', 'spark.rss.writer.buffer.spill.size'.
```

### Affects Version(s)

0.10

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

```logtalk
24/12/13 14:05:46 INFO [Executor task launch worker for task 19059] ComposedClientReadHandler: Client read 157 blocks from [ShuffleServerInfo{host[10.xx], grpc port[xx], netty port[xx]}], Consumed[ hot:0 warm:157 cold:0 frozen:0 ], Skipped[ hot:0 warm:0 cold:0 frozen:0 ]
24/12/13 14:05:46 INFO [Executor task launch worker for task 19059] ComposedClientReadHandler: Client read 699687660 bytes from [ShuffleServerInfo{host[10.xxx], grc port[xx], netty port[xx]}], Consumed[ hot:0 warm:699687660 cold:0 frozen:0 ], Skipped[ hot:0 warm:0 cold:0 frozen:0 ]
24/12/13 14:05:46 INFO [Executor task launch worker for task 19059] ComposedClientReadHandler: Client read 2161016354 uncompressed bytes from [ShuffleServerInfo{host[10.xx], grpc port[xx], netty port[49999]}], Consumed[ hot:0 warm:2161016354 cold:0 frozen:0 ], Skipped[ hot:0 warm:0 cold:0 frozen:0 ]
24/12/13 14:05:46 INFO [Executor task launch worker for task 19059] RssShuffleDataIterator: Fetch 699687660 bytes cost 26210 ms and 4 ms to serialize, 568 ms to decompress with unCompressionLength[2161016354]
24/12/13 14:05:46 INFO [Executor task launch worker for task 19059] WriteBufferManager: Can't get memory for now, sleep and try[0] again, request[16777216], got[0] less than 193484
24/12/13 14:05:49 INFO [Executor task launch worker for task 19059] WriteBufferManager: Can't get memory for now, sleep and try[1] again, request[16777216], got[0] less than 193484
24/12/13 14:05:52 INFO [Executor task launch worker for task 19059] WriteBufferManager: Can't get memory for now, sleep and try[2] again, request[16777216], got[0] less than 193484
24/12/13 14:05:55 INFO [Executor task launch worker for task 19059] WriteBufferManager: Can't get memory for now, sleep and try[3] again, request[16777216], got[0] less than 193484
.......
24/12/13 15:05:45 INFO [Executor task launch worker for task 19059] WriteBufferManager: Can't get memory for now, sleep and try[1199] again, request[16777216], got[0] less than 193484
24/12/13 15:05:48 INFO [Executor task launch worker for task 19059] WriteBufferManager: Can't get memory for now, sleep and try[1200] again, request[16777216], got[0] less than 193484
24/12/13 15:05:51 ERROR [Executor task launch worker for task 19059] WriteBufferManager: Can't get memory to cache shuffle data, request[16777216], got[0], WriteBufferManager allocated[0] task used[0]. It may be caused by shuffle server is full of data or consider to optimize 'spark.executor.memory', 'spark.rss.writer.buffer.spill.size'.
24/12/13 15:05:51 ERROR [Executor task launch worker for task 19059] Executor: Exception in task 18962.0 in stage 3.0 (TID 19059)
org.apache.uniffle.common.exception.RssException: Can't get memory to cache shuffle data, request[16777216], got[0], WriteBufferManager allocated[0] task used[0]. It may be caused by shuffle server is full of data or consider to optimize 'spark.executor.memory', 'spark.rss.writer.buffer.spill.size'.
	at org.apache.spark.shuffle.writer.WriteBufferManager.requestExecutorMemory(WriteBufferManager.java:462)
	at org.apache.spark.shuffle.writer.WriteBufferManager.requestMemory(WriteBufferManager.java:420)
	at org.apache.spark.shuffle.writer.WriteBufferManager.insertIntoBuffer(WriteBufferManager.java:265)
	at org.apache.spark.shuffle.writer.WriteBufferManager.addPartitionData(WriteBufferManager.java:205)
	at org.apache.spark.shuffle.writer.WriteBufferManager.addRecord(WriteBufferManager.java:317)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.writeImpl(RssShuffleWriter.java:303)
	at org.apache.spark.shuffle.writer.RssShuffleWriter.write(RssShuffleWriter.java:272)
	at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:59)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)
	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)
	at org.apache.spark.scheduler.Task.run(Task.scala:135)
	at org.apache.spark.executor.Executor$TaskRunner.$anonfun$runWithUgi$3(Executor.scala:462)
	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1381)
	at org.apache.spark.executor.Executor$TaskRunner.runWithUgi(Executor.scala:465)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:394)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
```


### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2294/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2294,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YElZ1,incubator-uniffle,2551338613,2294,NA,xumanbu,9135743,xumanbu,manbu.feng@163.com,NA,2024-12-18T13:32:52Z,2024-12-18T13:32:52Z,"Positioning through a log the execution memory is not used by `WriteBufferManager`. 

However, when you find an improved item, when you do not apply for memory, we need to print more Spark executor memory information to facilitate positioning problems like this case.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YElZ1/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2295,https://api.github.com/repos/apache/incubator-uniffle/issues/2295,incubator-uniffle,2742994631,2295,[DOCS] Errors in https://uniffle.apache.org/download/,sebbASF,16689231,Sebb,,CLOSED,2024-12-16T17:36:05Z,2024-12-17T15:37:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Which parts of the documentation do you think need improvement?

https://uniffle.apache.org/download/ contains several errors

### Affects Version(s)

N/A

### Improving the documentation

Under Apache Uniffle 0.9.0:

https://downloads.apache.org/ncubator/uniffle/0.9.0/apache-uniffle-0.9.0-incubating-src.tar.gz.sha512
should be
https://downloads.apache.org/incubator/uniffle/0.9.0/apache-uniffle-0.9.0-incubating-src.tar.gz.sha512

Under Apache Uniffle 0.7.0:

 https://downloads.apache.org/incubator/uniffle/0.7.1/apache-uniffle-0.7.0-incubating-src.tar.gz.sha512
should be
 https://downloads.apache.org/incubator/uniffle/0.7.0/apache-uniffle-0.7.0-incubating-src.tar.gz.sha512

https://downloads.apache.org/incubator/uniffle/0.7.0/apache-uniffle-0.7.0-incubating-src.tar.gz.asc
should be
https://downloads.apache.org/incubator/uniffle/0.7.1/apache-uniffle-0.7.0-incubating-src.tar.gz.asc

### Anything else

N/A

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2295/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2295,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6X1YPH,incubator-uniffle,2547352519,2295,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-17T02:13:32Z,2024-12-17T02:13:32Z,"OK, I will correct this. Thanks for you.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6X1YPH/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2295,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6X1a63,incubator-uniffle,2547363511,2295,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-17T02:24:17Z,2024-12-17T02:24:17Z,"I fixed this in the commit https://github.com/apache/incubator-uniffle-website/commit/1fa39292c50b0215074b615f8d2b201dd21fcf21
I will close this issue, thank you again.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6X1a63/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2295,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6X61WD,incubator-uniffle,2548782467,2295,NA,sebbASF,16689231,Sebb,,NA,2024-12-17T15:37:00Z,2024-12-17T15:37:00Z,Thanks for the very prompt attention to this,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6X61WD/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2296,https://api.github.com/repos/apache/incubator-uniffle/issues/2296,incubator-uniffle,2744931863,2296,[Bug] In the Spark3 getMapSizesByExecutorId can lead to loss of data.,yl09099,33595968,,,CLOSED,2024-12-17T13:21:09Z,2024-12-19T09:18:08Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

Rss RssShuffleManager getExpectedTasksByExecutorId method in reflection calls Spark3 getMapSizesByExecutorId method.Will call getPushBasedShuffleMapSizesByExecutorId method.
`override def getPushBasedShuffleMapSizesByExecutorId(
                      shuffleId: Int,
                      startMapIndex: Int,
                      endMapIndex: Int,
                      startPartition: Int,
                      endPartition: Int): MapSizesByExecutorId = {
                    logDebug(s""Fetching outputs for shuffle $shuffleId"")
                    val (mapOutputStatuses, mergedOutputStatuses) = getStatuses(shuffleId, conf)
                    try {
                      val actualEndMapIndex =
                        if (endMapIndex == Int.MaxValue) mapOutputStatuses.length else endMapIndex
                      logDebug(s""Convert map statuses for shuffle $shuffleId, "" +
                        s""mappers $startMapIndex-$actualEndMapIndex, partitions $startPartition-$endPartition"")
                      MapOutputTracker.convertMapStatuses(
                        shuffleId, startPartition, endPartition, mapOutputStatuses, startMapIndex,
                          actualEndMapIndex, Option(mergedOutputStatuses))
                    } catch {
                      case e: MetadataFetchFailedException =>
                        // We experienced a fetch failure so our mapStatuses cache is outdated; clear it:
                        mapStatuses.clear()
                        mergeStatuses.clear()
                        throw e
                    }
                  }`
                  
MetadataFetchFailedException is a FetchFailed abnormalities, will trigger Stage Retry, cleared mapStatuses and mergeStatuses here, however, when Retry will lose data.

### Affects Version(s)

0.10.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2296/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2296,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YLiXa,incubator-uniffle,2553161178,2296,NA,yl09099,33595968,,,NA,2024-12-19T09:18:07Z,2024-12-19T09:18:07Z,This is not where the bug is triggered and needs to be closed.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YLiXa/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2298,https://api.github.com/repos/apache/incubator-uniffle/issues/2298,incubator-uniffle,2746606553,2298,[Bug] Incorrect grpc metric of grpc_get_local_shuffle_data_process_latency,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-12-18T02:46:11Z,2024-12-18T03:53:50Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

As title described

### Affects Version(s)

master

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2298/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2300,https://api.github.com/repos/apache/incubator-uniffle/issues/2300,incubator-uniffle,2749110081,2300,[Bug] Long tail tasks in the Write Stage retry phase results in data loss.,yl09099,33595968,,,OPEN,2024-12-19T02:33:14Z,2024-12-19T08:42:43Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

During the Write Stage retry phase, the MapOutputTrackerMaster clears the MapStatus corresponding to the shuffleId on the Driver side. However, when a large number of partitions are encountered, the MapStatus may not be completely cleared. Retry at the Stage, the task becomes less, resulting in data loss. At present, I encountered a 40000 Partition, resulting in data loss.
Below is a screenshot of my problem：
![image](https://github.com/user-attachments/assets/433e9712-5b3c-448b-a21c-c6aabfb79e8b)


### Affects Version(s)

0.10.0

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2300/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2300,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YJluG,incubator-uniffle,2552650630,2300,NA,yl09099,33595968,,,NA,2024-12-19T02:34:40Z,2024-12-19T02:34:40Z,@rickyma @jerqi @maobaolong @zuston @advancedxy Please help to look at this problem.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YJluG/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2300,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YLRJV,incubator-uniffle,2553090645,2300,NA,yl09099,33595968,,,NA,2024-12-19T08:42:42Z,2024-12-19T08:42:42Z,"This is mainly because the long-tail task before the Stage retries, resulting in data loss.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YLRJV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2303,https://api.github.com/repos/apache/incubator-uniffle/issues/2303,incubator-uniffle,2755105426,2303,[Umbrella] Release 0.9.2,zhengchenyu,10381583,zhengchenyu,,CLOSED,2024-12-23T03:03:24Z,2025-01-09T03:24:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues) and found no similar issues.


### Describe the proposal

Release Apache Uniffle 0.9.2, we would like to release binary package. There are many things to do. First, we should ensure what issues should be included in this version.

### Task list

- [] Tag and release `v0.9.2-rc1`.
    - [x] Backport necessary fixes from `master` to `branch-0.9`.
    - [x] Bump project version to `0.9.2` in `branch-0.9`.
    - [x] (GitHub) Tag `v0.9.2-rc1`:
        - https://github.com/apache/incubator-uniffle/releases/tag/v0.9.2-rc1
    - [x] (SVN) Upload tarball, checksum and signature to `.../0.9.2-rc1/`:
        - https://dist.apache.org/repos/dist/dev/incubator/uniffle/0.9.2-rc1/
    - [x] Post release note on [Uniffle website][1]:
    - [x] Vote on dev@uniffle.apache.org
- [x] Tag and release `0.9.2`.
    - [x] (SVN) Move the artifacts under `dev/.../0.9.2-rc1` to `release/.../0.9.2` (by PPMC).
    - [x] (GitHub) Tag `v0.9.2` to `v0.9.2-rc1` and upload the artifacts.
    - [x] Update download link on [Uniffle website][1]:
    - [x] Post an announcement on general@incubator.apache.org


### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2303/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2304,https://api.github.com/repos/apache/incubator-uniffle/issues/2304,incubator-uniffle,2759793949,2304,[Bug] uniffle notice only mentions 2022 - it should include up to 2024 (and soon 2025),pjfanning,11783444,PJ Fanning,,CLOSED,2024-12-26T13:44:18Z,2024-12-27T12:55:06Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

https://github.com/apache/incubator-uniffle/blob/master/NOTICE

It is important to keep the years up to date in the NOTICE

### Affects Version(s)

master & 0.9.2-rc1

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2304/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2305,https://api.github.com/repos/apache/incubator-uniffle/issues/2305,incubator-uniffle,2759799198,2305,[Bug] LICENSE should have PingCap copyright,pjfanning,11783444,PJ Fanning,,CLOSED,2024-12-26T13:49:43Z,2024-12-30T06:10:31Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

https://github.com/tikv/raft-engine?tab=readme-ov-file#license includes


Copyright (c) 2017-present, PingCAP, Inc. Released under the Apache 2.0 license. See [LICENSE](https://github.com/tikv/raft-engine/blob/master/LICENSE) for details.


### Affects Version(s)

master & 0.9.2-rc1

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2305/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2306,https://api.github.com/repos/apache/incubator-uniffle/issues/2306,incubator-uniffle,2759822657,2306,[Bug] NOTICE-BINARY has 2 copies of the Jackson notice,pjfanning,11783444,PJ Fanning,,CLOSED,2024-12-26T14:14:28Z,2024-12-30T06:11:02Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

The section starting with:
```
# Jackson JSON processor
```
appears twice.

* https://github.com/apache/incubator-uniffle/blob/master/NOTICE-binary#L122
* https://github.com/apache/incubator-uniffle/blob/master/NOTICE-binary#L204


### Affects Version(s)

master & 0.9.2-rc1

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2306/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2307,https://api.github.com/repos/apache/incubator-uniffle/issues/2307,incubator-uniffle,2759846743,2307,[Bug] LICENSE-binary is missing lots of jars and we don't know if they have problematic licenses,pjfanning,11783444,PJ Fanning,,CLOSED,2024-12-26T14:40:36Z,2024-12-31T10:53:01Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

https://github.com/apache/incubator-uniffle/blob/master/LICENSE-binary has lots of jars listed but the list is far from complete.
I got this list from the 0.9.2-rc1 bin tar.gz.

Could you also various Apache licensed jars in alphabetic order? In existing LICENSE-binary, there is a jetty dependency listed away from all the other jetty dependencies (1 example but there could be more).

```
rss-0.9.2-hadoop2.8 % find . -name ""*.jar""      
./jars/coordinator/perfmark-api-0.26.0.jar
./jars/coordinator/annotations-4.1.1.4.jar
./jars/coordinator/grpc-stub-1.61.1.jar
./jars/coordinator/netty-codec-stomp-4.1.106.Final.jar
./jars/coordinator/netty-transport-native-kqueue-4.1.106.Final-osx-x86_64.jar
./jars/coordinator/netty-codec-smtp-4.1.106.Final.jar
./jars/coordinator/animal-sniffer-annotations-1.23.jar
./jars/coordinator/slf4j-api-1.7.36.jar
./jars/coordinator/jetty-server-9.3.24.v20180605.jar
./jars/coordinator/grpc-api-1.61.1.jar
./jars/coordinator/jetty-util-9.3.24.v20180605.jar
./jars/coordinator/rss-proto-0.9.2.jar
./jars/coordinator/RoaringBitmap-0.9.15.jar
./jars/coordinator/netty-all-4.1.106.Final.jar
./jars/coordinator/proto-google-common-protos-2.29.0.jar
./jars/coordinator/jetty-io-9.3.24.v20180605.jar
./jars/coordinator/javax.annotation-api-1.3.2.jar
./jars/coordinator/j2objc-annotations-2.8.jar
./jars/coordinator/snakeyaml-2.2.jar
./jars/coordinator/picocli-4.5.2.jar
./jars/coordinator/netty-handler-4.1.106.Final.jar
./jars/coordinator/activation-1.1.1.jar
./jars/coordinator/grpc-context-1.61.1.jar
./jars/coordinator/netty-codec-dns-4.1.106.Final.jar
./jars/coordinator/netty-codec-redis-4.1.106.Final.jar
./jars/coordinator/jackson-core-2.10.0.jar
./jars/coordinator/javassist-3.25.0-GA.jar
./jars/coordinator/netty-transport-native-epoll-4.1.106.Final-linux-riscv64.jar
./jars/coordinator/netty-common-4.1.106.Final.jar
./jars/coordinator/netty-codec-haproxy-4.1.106.Final.jar
./jars/coordinator/gson-2.10.1.jar
./jars/coordinator/netty-buffer-4.1.106.Final.jar
./jars/coordinator/netty-resolver-dns-native-macos-4.1.106.Final-osx-x86_64.jar
./jars/coordinator/rss-internal-client-0.9.2.jar
./jars/coordinator/javax.servlet-api-3.1.0.jar
./jars/coordinator/netty-codec-xml-4.1.106.Final.jar
./jars/coordinator/hbase-shaded-jersey-4.1.4.jar
./jars/coordinator/netty-transport-4.1.106.Final.jar
./jars/coordinator/netty-handler-ssl-ocsp-4.1.106.Final.jar
./jars/coordinator/netty-handler-proxy-4.1.106.Final.jar
./jars/coordinator/netty-codec-socks-4.1.106.Final.jar
./jars/coordinator/netty-transport-classes-epoll-4.1.106.Final.jar
./jars/coordinator/simpleclient_jetty-0.9.0.jar
./jars/coordinator/grpc-util-1.61.1.jar
./jars/coordinator/failureaccess-1.0.1.jar
./jars/coordinator/netty-codec-mqtt-4.1.106.Final.jar
./jars/coordinator/shims-0.9.15.jar
./jars/coordinator/simpleclient_common-0.9.0.jar
./jars/coordinator/netty-codec-http-4.1.106.Final.jar
./jars/coordinator/checker-qual-3.37.0.jar
./jars/coordinator/netty-transport-rxtx-4.1.106.Final.jar
./jars/coordinator/jaxb-api-2.3.0.jar
./jars/coordinator/jetty-security-9.3.24.v20180605.jar
./jars/coordinator/netty-codec-4.1.106.Final.jar
./jars/coordinator/netty-transport-classes-kqueue-4.1.106.Final.jar
./jars/coordinator/netty-transport-native-unix-common-4.1.106.Final.jar
./jars/coordinator/error_prone_annotations-2.23.0.jar
./jars/coordinator/simpleclient-0.9.0.jar
./jars/coordinator/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar
./jars/coordinator/protobuf-java-3.25.1.jar
./jars/coordinator/grpc-protobuf-lite-1.61.1.jar
./jars/coordinator/jakarta.inject-2.6.1.jar
./jars/coordinator/grpc-protobuf-1.61.1.jar
./jars/coordinator/rss-common-0.9.2.jar
./jars/coordinator/netty-resolver-4.1.106.Final.jar
./jars/coordinator/netty-resolver-dns-4.1.106.Final.jar
./jars/coordinator/simpleclient_pushgateway-0.9.0.jar
./jars/coordinator/simpleclient_httpserver-0.9.0.jar
./jars/coordinator/jetty-proxy-9.3.24.v20180605.jar
./jars/coordinator/jetty-http-9.3.24.v20180605.jar
./jars/coordinator/coordinator-0.9.2.jar
./jars/coordinator/netty-transport-native-epoll-4.1.106.Final-linux-x86_64.jar
./jars/coordinator/grpc-core-1.61.1.jar
./jars/coordinator/log4j-api-2.23.0.jar
./jars/coordinator/netty-transport-sctp-4.1.106.Final.jar
./jars/coordinator/guava-32.1.3-jre.jar
./jars/coordinator/jakarta.annotation-api-1.3.5.jar
./jars/coordinator/jetty-client-9.3.24.v20180605.jar
./jars/coordinator/simpleclient_servlet-0.9.0.jar
./jars/coordinator/lz4-1.3.0.jar
./jars/coordinator/netty-codec-http2-4.1.106.Final.jar
./jars/coordinator/netty-codec-memcache-4.1.106.Final.jar
./jars/coordinator/netty-transport-udt-4.1.106.Final.jar
./jars/coordinator/simpleclient_hotspot-0.9.0.jar
./jars/coordinator/jsr305-3.0.2.jar
./jars/coordinator/commons-lang3-3.10.jar
./jars/coordinator/jetty-servlet-9.3.24.v20180605.jar
./jars/coordinator/netty-resolver-dns-classes-macos-4.1.106.Final.jar
./jars/coordinator/netty-transport-native-kqueue-4.1.106.Final-osx-aarch_64.jar
./jars/coordinator/jakarta.validation-api-2.0.2.jar
./jars/coordinator/netty-resolver-dns-native-macos-4.1.106.Final-osx-aarch_64.jar
./jars/coordinator/grpc-netty-shaded-1.61.1.jar
./jars/coordinator/jackson-annotations-2.10.0.jar
./jars/coordinator/log4j-core-2.23.0.jar
./jars/coordinator/jackson-databind-2.10.0.jar
./jars/coordinator/protobuf-java-util-3.25.1.jar
./jars/coordinator/netty-transport-native-epoll-4.1.106.Final-linux-aarch_64.jar
./jars/coordinator/log4j-slf4j-impl-2.23.0.jar
./jars/server/perfmark-api-0.26.0.jar
./jars/server/annotations-4.1.1.4.jar
./jars/server/grpc-stub-1.61.1.jar
./jars/server/netty-codec-stomp-4.1.106.Final.jar
./jars/server/netty-transport-native-kqueue-4.1.106.Final-osx-x86_64.jar
./jars/server/netty-codec-smtp-4.1.106.Final.jar
./jars/server/animal-sniffer-annotations-1.23.jar
./jars/server/slf4j-api-1.7.36.jar
./jars/server/jetty-server-9.3.24.v20180605.jar
./jars/server/grpc-api-1.61.1.jar
./jars/server/jetty-util-9.3.24.v20180605.jar
./jars/server/shuffle-server-0.9.2.jar
./jars/server/rss-proto-0.9.2.jar
./jars/server/RoaringBitmap-0.9.15.jar
./jars/server/netty-all-4.1.106.Final.jar
./jars/server/proto-google-common-protos-2.29.0.jar
./jars/server/jetty-io-9.3.24.v20180605.jar
./jars/server/javax.annotation-api-1.3.2.jar
./jars/server/j2objc-annotations-2.8.jar
./jars/server/picocli-4.5.2.jar
./jars/server/netty-handler-4.1.106.Final.jar
./jars/server/activation-1.1.1.jar
./jars/server/grpc-context-1.61.1.jar
./jars/server/netty-codec-dns-4.1.106.Final.jar
./jars/server/netty-codec-redis-4.1.106.Final.jar
./jars/server/jackson-core-2.10.0.jar
./jars/server/javassist-3.25.0-GA.jar
./jars/server/netty-transport-native-epoll-4.1.106.Final-linux-riscv64.jar
./jars/server/netty-common-4.1.106.Final.jar
./jars/server/netty-codec-haproxy-4.1.106.Final.jar
./jars/server/gson-2.10.1.jar
./jars/server/netty-buffer-4.1.106.Final.jar
./jars/server/netty-resolver-dns-native-macos-4.1.106.Final-osx-x86_64.jar
./jars/server/rss-internal-client-0.9.2.jar
./jars/server/javax.servlet-api-3.1.0.jar
./jars/server/netty-codec-xml-4.1.106.Final.jar
./jars/server/hbase-shaded-jersey-4.1.4.jar
./jars/server/netty-transport-4.1.106.Final.jar
./jars/server/netty-handler-ssl-ocsp-4.1.106.Final.jar
./jars/server/netty-handler-proxy-4.1.106.Final.jar
./jars/server/netty-codec-socks-4.1.106.Final.jar
./jars/server/netty-transport-classes-epoll-4.1.106.Final.jar
./jars/server/simpleclient_jetty-0.9.0.jar
./jars/server/grpc-util-1.61.1.jar
./jars/server/failureaccess-1.0.1.jar
./jars/server/netty-codec-mqtt-4.1.106.Final.jar
./jars/server/shims-0.9.15.jar
./jars/server/simpleclient_common-0.9.0.jar
./jars/server/netty-codec-http-4.1.106.Final.jar
./jars/server/checker-qual-3.37.0.jar
./jars/server/netty-transport-rxtx-4.1.106.Final.jar
./jars/server/jaxb-api-2.3.0.jar
./jars/server/jetty-security-9.3.24.v20180605.jar
./jars/server/netty-codec-4.1.106.Final.jar
./jars/server/netty-transport-classes-kqueue-4.1.106.Final.jar
./jars/server/netty-transport-native-unix-common-4.1.106.Final.jar
./jars/server/error_prone_annotations-2.23.0.jar
./jars/server/simpleclient-0.9.0.jar
./jars/server/shuffle-storage-0.9.2.jar
./jars/server/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar
./jars/server/protobuf-java-3.25.1.jar
./jars/server/grpc-protobuf-lite-1.61.1.jar
./jars/server/jakarta.inject-2.6.1.jar
./jars/server/grpc-protobuf-1.61.1.jar
./jars/server/rss-common-0.9.2.jar
./jars/server/netty-resolver-4.1.106.Final.jar
./jars/server/netty-resolver-dns-4.1.106.Final.jar
./jars/server/simpleclient_pushgateway-0.9.0.jar
./jars/server/simpleclient_httpserver-0.9.0.jar
./jars/server/jetty-proxy-9.3.24.v20180605.jar
./jars/server/commons-collections-3.2.2.jar
./jars/server/jetty-http-9.3.24.v20180605.jar
./jars/server/netty-transport-native-epoll-4.1.106.Final-linux-x86_64.jar
./jars/server/grpc-core-1.61.1.jar
./jars/server/log4j-api-2.23.0.jar
./jars/server/netty-transport-sctp-4.1.106.Final.jar
./jars/server/guava-32.1.3-jre.jar
./jars/server/jakarta.annotation-api-1.3.5.jar
./jars/server/jetty-client-9.3.24.v20180605.jar
./jars/server/simpleclient_servlet-0.9.0.jar
./jars/server/lz4-1.3.0.jar
./jars/server/netty-codec-http2-4.1.106.Final.jar
./jars/server/netty-codec-memcache-4.1.106.Final.jar
./jars/server/netty-transport-udt-4.1.106.Final.jar
./jars/server/simpleclient_hotspot-0.9.0.jar
./jars/server/jsr305-3.0.2.jar
./jars/server/commons-lang3-3.10.jar
./jars/server/jetty-servlet-9.3.24.v20180605.jar
./jars/server/netty-resolver-dns-classes-macos-4.1.106.Final.jar
./jars/server/netty-transport-native-kqueue-4.1.106.Final-osx-aarch_64.jar
./jars/server/jakarta.validation-api-2.0.2.jar
./jars/server/netty-resolver-dns-native-macos-4.1.106.Final-osx-aarch_64.jar
./jars/server/grpc-netty-shaded-1.61.1.jar
./jars/server/jackson-annotations-2.10.0.jar
./jars/server/log4j-core-2.23.0.jar
./jars/server/jackson-databind-2.10.0.jar
./jars/server/protobuf-java-util-3.25.1.jar
./jars/server/netty-transport-native-epoll-4.1.106.Final-linux-aarch_64.jar
./jars/server/log4j-slf4j-impl-2.23.0.jar
./jars/cli/perfmark-api-0.26.0.jar
./jars/cli/annotations-4.1.1.4.jar
./jars/cli/grpc-stub-1.61.1.jar
./jars/cli/commons-logging-1.2.jar
./jars/cli/netty-codec-stomp-4.1.106.Final.jar
./jars/cli/netty-transport-native-kqueue-4.1.106.Final-osx-x86_64.jar
./jars/cli/netty-codec-smtp-4.1.106.Final.jar
./jars/cli/animal-sniffer-annotations-1.23.jar
./jars/cli/slf4j-api-1.7.36.jar
./jars/cli/jetty-server-9.3.24.v20180605.jar
./jars/cli/grpc-api-1.61.1.jar
./jars/cli/jetty-util-9.3.24.v20180605.jar
./jars/cli/cli-0.9.2.jar
./jars/cli/rss-proto-0.9.2.jar
./jars/cli/RoaringBitmap-0.9.15.jar
./jars/cli/netty-all-4.1.106.Final.jar
./jars/cli/proto-google-common-protos-2.29.0.jar
./jars/cli/jetty-io-9.3.24.v20180605.jar
./jars/cli/javax.annotation-api-1.3.2.jar
./jars/cli/j2objc-annotations-2.8.jar
./jars/cli/picocli-4.5.2.jar
./jars/cli/netty-handler-4.1.106.Final.jar
./jars/cli/commons-cli-1.5.0.jar
./jars/cli/activation-1.1.1.jar
./jars/cli/grpc-context-1.61.1.jar
./jars/cli/netty-codec-dns-4.1.106.Final.jar
./jars/cli/netty-codec-redis-4.1.106.Final.jar
./jars/cli/jackson-core-2.10.0.jar
./jars/cli/javassist-3.25.0-GA.jar
./jars/cli/netty-transport-native-epoll-4.1.106.Final-linux-riscv64.jar
./jars/cli/netty-common-4.1.106.Final.jar
./jars/cli/netty-codec-haproxy-4.1.106.Final.jar
./jars/cli/gson-2.10.1.jar
./jars/cli/netty-buffer-4.1.106.Final.jar
./jars/cli/netty-resolver-dns-native-macos-4.1.106.Final-osx-x86_64.jar
./jars/cli/rss-internal-client-0.9.2.jar
./jars/cli/javax.servlet-api-3.1.0.jar
./jars/cli/netty-codec-xml-4.1.106.Final.jar
./jars/cli/hbase-shaded-jersey-4.1.4.jar
./jars/cli/netty-transport-4.1.106.Final.jar
./jars/cli/netty-handler-ssl-ocsp-4.1.106.Final.jar
./jars/cli/netty-handler-proxy-4.1.106.Final.jar
./jars/cli/netty-codec-socks-4.1.106.Final.jar
./jars/cli/netty-transport-classes-epoll-4.1.106.Final.jar
./jars/cli/simpleclient_jetty-0.9.0.jar
./jars/cli/grpc-util-1.61.1.jar
./jars/cli/httpclient-4.5.3.jar
./jars/cli/failureaccess-1.0.1.jar
./jars/cli/netty-codec-mqtt-4.1.106.Final.jar
./jars/cli/commons-codec-1.9.jar
./jars/cli/shims-0.9.15.jar
./jars/cli/simpleclient_common-0.9.0.jar
./jars/cli/netty-codec-http-4.1.106.Final.jar
./jars/cli/checker-qual-3.37.0.jar
./jars/cli/netty-transport-rxtx-4.1.106.Final.jar
./jars/cli/jaxb-api-2.3.0.jar
./jars/cli/jetty-security-9.3.24.v20180605.jar
./jars/cli/netty-codec-4.1.106.Final.jar
./jars/cli/netty-transport-classes-kqueue-4.1.106.Final.jar
./jars/cli/netty-transport-native-unix-common-4.1.106.Final.jar
./jars/cli/error_prone_annotations-2.23.0.jar
./jars/cli/simpleclient-0.9.0.jar
./jars/cli/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar
./jars/cli/protobuf-java-3.25.1.jar
./jars/cli/grpc-protobuf-lite-1.61.1.jar
./jars/cli/jakarta.inject-2.6.1.jar
./jars/cli/grpc-protobuf-1.61.1.jar
./jars/cli/rss-common-0.9.2.jar
./jars/cli/netty-resolver-4.1.106.Final.jar
./jars/cli/netty-resolver-dns-4.1.106.Final.jar
./jars/cli/simpleclient_pushgateway-0.9.0.jar
./jars/cli/simpleclient_httpserver-0.9.0.jar
./jars/cli/jetty-proxy-9.3.24.v20180605.jar
./jars/cli/jetty-http-9.3.24.v20180605.jar
./jars/cli/netty-transport-native-epoll-4.1.106.Final-linux-x86_64.jar
./jars/cli/grpc-core-1.61.1.jar
./jars/cli/log4j-api-2.23.0.jar
./jars/cli/netty-transport-sctp-4.1.106.Final.jar
./jars/cli/guava-32.1.3-jre.jar
./jars/cli/jakarta.annotation-api-1.3.5.jar
./jars/cli/jetty-client-9.3.24.v20180605.jar
./jars/cli/simpleclient_servlet-0.9.0.jar
./jars/cli/lz4-1.3.0.jar
./jars/cli/netty-codec-http2-4.1.106.Final.jar
./jars/cli/httpcore-4.4.6.jar
./jars/cli/netty-codec-memcache-4.1.106.Final.jar
./jars/cli/netty-transport-udt-4.1.106.Final.jar
./jars/cli/simpleclient_hotspot-0.9.0.jar
./jars/cli/jsr305-3.0.2.jar
./jars/cli/commons-lang3-3.10.jar
./jars/cli/jetty-servlet-9.3.24.v20180605.jar
./jars/cli/netty-resolver-dns-classes-macos-4.1.106.Final.jar
./jars/cli/netty-transport-native-kqueue-4.1.106.Final-osx-aarch_64.jar
./jars/cli/jakarta.validation-api-2.0.2.jar
./jars/cli/netty-resolver-dns-native-macos-4.1.106.Final-osx-aarch_64.jar
./jars/cli/grpc-netty-shaded-1.61.1.jar
./jars/cli/jackson-annotations-2.10.0.jar
./jars/cli/log4j-core-2.23.0.jar
./jars/cli/jackson-databind-2.10.0.jar
./jars/cli/protobuf-java-util-3.25.1.jar
./jars/cli/netty-transport-native-epoll-4.1.106.Final-linux-aarch_64.jar
./jars/cli/log4j-slf4j-impl-2.23.0.jar
./jars/dashboard/perfmark-api-0.26.0.jar
./jars/dashboard/annotations-4.1.1.4.jar
./jars/dashboard/grpc-stub-1.61.1.jar
./jars/dashboard/netty-codec-stomp-4.1.106.Final.jar
./jars/dashboard/netty-transport-native-kqueue-4.1.106.Final-osx-x86_64.jar
./jars/dashboard/netty-codec-smtp-4.1.106.Final.jar
./jars/dashboard/animal-sniffer-annotations-1.23.jar
./jars/dashboard/slf4j-api-1.7.36.jar
./jars/dashboard/jetty-server-9.3.24.v20180605.jar
./jars/dashboard/grpc-api-1.61.1.jar
./jars/dashboard/jetty-util-9.3.24.v20180605.jar
./jars/dashboard/rss-proto-0.9.2.jar
./jars/dashboard/RoaringBitmap-0.9.15.jar
./jars/dashboard/netty-all-4.1.106.Final.jar
./jars/dashboard/proto-google-common-protos-2.29.0.jar
./jars/dashboard/jetty-io-9.3.24.v20180605.jar
./jars/dashboard/javax.annotation-api-1.3.2.jar
./jars/dashboard/j2objc-annotations-2.8.jar
./jars/dashboard/picocli-4.5.2.jar
./jars/dashboard/netty-handler-4.1.106.Final.jar
./jars/dashboard/activation-1.1.1.jar
./jars/dashboard/grpc-context-1.61.1.jar
./jars/dashboard/netty-codec-dns-4.1.106.Final.jar
./jars/dashboard/netty-codec-redis-4.1.106.Final.jar
./jars/dashboard/jackson-core-2.10.0.jar
./jars/dashboard/javassist-3.25.0-GA.jar
./jars/dashboard/netty-transport-native-epoll-4.1.106.Final-linux-riscv64.jar
./jars/dashboard/netty-common-4.1.106.Final.jar
./jars/dashboard/netty-codec-haproxy-4.1.106.Final.jar
./jars/dashboard/gson-2.10.1.jar
./jars/dashboard/netty-buffer-4.1.106.Final.jar
./jars/dashboard/netty-resolver-dns-native-macos-4.1.106.Final-osx-x86_64.jar
./jars/dashboard/javax.servlet-api-3.1.0.jar
./jars/dashboard/netty-codec-xml-4.1.106.Final.jar
./jars/dashboard/hbase-shaded-jersey-4.1.4.jar
./jars/dashboard/netty-transport-4.1.106.Final.jar
./jars/dashboard/netty-handler-ssl-ocsp-4.1.106.Final.jar
./jars/dashboard/netty-handler-proxy-4.1.106.Final.jar
./jars/dashboard/netty-codec-socks-4.1.106.Final.jar
./jars/dashboard/netty-transport-classes-epoll-4.1.106.Final.jar
./jars/dashboard/simpleclient_jetty-0.9.0.jar
./jars/dashboard/grpc-util-1.61.1.jar
./jars/dashboard/failureaccess-1.0.1.jar
./jars/dashboard/netty-codec-mqtt-4.1.106.Final.jar
./jars/dashboard/shims-0.9.15.jar
./jars/dashboard/simpleclient_common-0.9.0.jar
./jars/dashboard/netty-codec-http-4.1.106.Final.jar
./jars/dashboard/checker-qual-3.37.0.jar
./jars/dashboard/netty-transport-rxtx-4.1.106.Final.jar
./jars/dashboard/jaxb-api-2.3.0.jar
./jars/dashboard/jetty-security-9.3.24.v20180605.jar
./jars/dashboard/netty-codec-4.1.106.Final.jar
./jars/dashboard/netty-transport-classes-kqueue-4.1.106.Final.jar
./jars/dashboard/netty-transport-native-unix-common-4.1.106.Final.jar
./jars/dashboard/error_prone_annotations-2.23.0.jar
./jars/dashboard/simpleclient-0.9.0.jar
./jars/dashboard/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar
./jars/dashboard/protobuf-java-3.25.1.jar
./jars/dashboard/grpc-protobuf-lite-1.61.1.jar
./jars/dashboard/jakarta.inject-2.6.1.jar
./jars/dashboard/grpc-protobuf-1.61.1.jar
./jars/dashboard/rss-common-0.9.2.jar
./jars/dashboard/netty-resolver-4.1.106.Final.jar
./jars/dashboard/netty-resolver-dns-4.1.106.Final.jar
./jars/dashboard/simpleclient_pushgateway-0.9.0.jar
./jars/dashboard/simpleclient_httpserver-0.9.0.jar
./jars/dashboard/jetty-proxy-9.3.24.v20180605.jar
./jars/dashboard/jetty-http-9.3.24.v20180605.jar
./jars/dashboard/netty-transport-native-epoll-4.1.106.Final-linux-x86_64.jar
./jars/dashboard/grpc-core-1.61.1.jar
./jars/dashboard/log4j-api-2.23.0.jar
./jars/dashboard/netty-transport-sctp-4.1.106.Final.jar
./jars/dashboard/guava-32.1.3-jre.jar
./jars/dashboard/jakarta.annotation-api-1.3.5.jar
./jars/dashboard/jetty-client-9.3.24.v20180605.jar
./jars/dashboard/simpleclient_servlet-0.9.0.jar
./jars/dashboard/lz4-1.3.0.jar
./jars/dashboard/netty-codec-http2-4.1.106.Final.jar
./jars/dashboard/dashboard-0.9.2.jar
./jars/dashboard/netty-codec-memcache-4.1.106.Final.jar
./jars/dashboard/netty-transport-udt-4.1.106.Final.jar
./jars/dashboard/simpleclient_hotspot-0.9.0.jar
./jars/dashboard/jsr305-3.0.2.jar
./jars/dashboard/commons-lang3-3.10.jar
./jars/dashboard/jetty-servlet-9.3.24.v20180605.jar
./jars/dashboard/netty-resolver-dns-classes-macos-4.1.106.Final.jar
./jars/dashboard/netty-transport-native-kqueue-4.1.106.Final-osx-aarch_64.jar
./jars/dashboard/jakarta.validation-api-2.0.2.jar
./jars/dashboard/netty-resolver-dns-native-macos-4.1.106.Final-osx-aarch_64.jar
./jars/dashboard/grpc-netty-shaded-1.61.1.jar
./jars/dashboard/jackson-annotations-2.10.0.jar
./jars/dashboard/log4j-core-2.23.0.jar
./jars/dashboard/jackson-databind-2.10.0.jar
./jars/dashboard/protobuf-java-util-3.25.1.jar
./jars/dashboard/netty-transport-native-epoll-4.1.106.Final-linux-aarch_64.jar
./jars/dashboard/log4j-slf4j-impl-2.23.0.jar
./jars/client/mr/rss-client-mr-0.9.2-shaded.jar
./jars/client/tez/rss-client-tez-0.9.2-shaded.jar
./jars/client/spark3/rss-client-spark3-shaded-0.9.2.jar
./jars/client/spark2/rss-client-spark2-shaded-0.9.2.jar
```

### Affects Version(s)

master & 0.9.2-rc1

### Uniffle Server Log Output

_No response_

### Uniffle Engine Log Output

_No response_

### Uniffle Server Configurations

_No response_

### Uniffle Engine Configurations

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2307/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2307,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YzSSl,incubator-uniffle,2563581093,2307,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-27T10:58:22Z,2024-12-27T10:58:22Z,"find . -name ""*.jar"" | xargs basename | sort | uniq  

```
RoaringBitmap-0.9.15.jar                     Line 242
activation-1.1.1.jar                                 Line 295
animal-sniffer-annotations-1.23.jar    Line 274
annotations-4.1.1.4.jar                          Line 289
checker-qual-3.37.0.jar                        Line 275
cli-0.9.2.jar                                            Our project jar 
commons-cli-1.5.0.jar                           Line 215
commons-codec-1.9.jar                       No have
commons-collections-3.2.2.jar           No have
commons-lang3-3.10.jar                      Line 208
commons-logging-1.2.jar                     No have
coordinator-0.9.2.jar                             Our project jar
dashboard-0.9.2.jar                              Our project jar
error_prone_annotations-2.23.0.jar    Line 226
failureaccess-1.0.1.jar                           Line 220
grpc-api-1.61.1.jar                                 Line 234
grpc-context-1.61.1.jar                         Line 233
grpc-core-1.61.1.jar                              Line 232
grpc-netty-shaded-1.61.1.jar               Line 229
grpc-protobuf-1.61.1.jar                       Line 230
grpc-protobuf-lite-1.61.1.jar                Line 235
grpc-stub-1.61.1.jar                              Line 231
grpc-util-1.61.1.jar                                Not have
gson-2.10.1.jar                                      Line 245
guava-32.1.3-jre.jar                             Line 218
hbase-shaded-jersey-4.1.4.jar           Line 301
httpclient-4.5.3.jar                               Line 216
httpcore-4.4.6.jar                                Not have
j2objc-annotations-2.8.jar                  Line 246
jackson-annotations-2.10.0.jar          Line 221
jackson-core-2.10.0.jar                       Line 222
jackson-databind-2.10.0.jar                Line 223
jakarta.annotation-api-1.3.5.jar          Line 299
jakarta.inject-2.6.1.jar                          Line 300
jakarta.validation-api-2.0.2.jar            Line 250
javassist-3.25.0-GA.jar                        Line 248
javax.annotation-api-1.3.2.jar              Line 289
javax.servlet-api-3.1.0.jar                    Line 288
jaxb-api-2.3.0.jar                                  Line 294
jetty-client-9.3.24.v20180605.jar       Line 209
jetty-http-9.3.24.v20180605.jar          Line 212
jetty-io-9.3.24.v20180605.jar              Line 213
jetty-proxy-9.3.24.v20180605.jar        Not have
jetty-security-9.3.24.v20180605.jar    Line 214
jetty-server-9.3.24.v20180605.jar       Line 209
jetty-servlet-9.3.24.v20180605.jar      Line 210
jetty-util-9.3.24.v20180605.jar             Line 211
jsr305-3.0.2.jar                                      Line 249
listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar Line 219
log4j-api-2.23.0.jar                                Not have 
log4j-core-2.23.0.jar                             Not have
log4j-slf4j-impl-2.23.0.jar                     Not have
lz4-1.3.0.jar Line 217
netty-all-4.1.106.Final.jar                       Line 227
netty-buffer-4.1.106.Final.jar                Not have
netty-codec-4.1.106.Final.jar                Not have
netty-codec-dns-4.1.106.Final.jar        Not have
netty-codec-haproxy-4.1.106.Final.jar Not have
netty-codec-http-4.1.106.Final.jar        Not have
netty-codec-http2-4.1.106.Final.jar      Not have
netty-codec-memcache-4.1.106.Final.jar  Not have
netty-codec-mqtt-4.1.106.Final.jar             Not have
netty-codec-redis-4.1.106.Final.jar            Not have
netty-codec-smtp-4.1.106.Final.jar            Not have
netty-codec-socks-4.1.106.Final.jar          Not have
netty-codec-stomp-4.1.106.Final.jar          Not have
netty-codec-xml-4.1.106.Final.jar              Not have
netty-common-4.1.106.Final.jar                  Not have
netty-handler-4.1.106.Final.jar                   Not have
netty-handler-proxy-4.1.106.Final.jar         Not have
netty-handler-ssl-ocsp-4.1.106.Final.jar    Not have
netty-resolver-4.1.106.Final.jar                    Not have
netty-resolver-dns-4.1.106.Final.jar            Not have
netty-resolver-dns-classes-macos-4.1.106.Final.jar Not have
netty-resolver-dns-native-macos-4.1.106.Final-osx-aarch_64.jar Not have
netty-resolver-dns-native-macos-4.1.106.Final-osx-x86_64.jar Not have
netty-transport-4.1.106.Final.jar                  Not have
netty-transport-classes-epoll-4.1.106.Final.jar                    Not have
netty-transport-classes-kqueue-4.1.106.Final.jar                 Not have
netty-transport-native-epoll-4.1.106.Final-linux-aarch_64.jar Not have
netty-transport-native-epoll-4.1.106.Final-linux-riscv64.jar Not have
netty-transport-native-epoll-4.1.106.Final-linux-x86_64.jar Not have
netty-transport-native-kqueue-4.1.106.Final-osx-aarch_64.jar Not have
netty-transport-native-kqueue-4.1.106.Final-osx-x86_64.jar Not have
netty-transport-native-unix-common-4.1.106.Final.jar Not have
netty-transport-rxtx-4.1.106.Final.jar Not have
netty-transport-sctp-4.1.106.Final.jar Not have
netty-transport-udt-4.1.106.Final.jar Not have
perfmark-api-0.26.0.jar Not have
picocli-4.5.2.jar Line 225
proto-google-common-protos-2.29.0.jar Line 247
protobuf-java-3.25.1.jar Line 266
protobuf-java-util-3.25.1.jar Line 267
rss-client-mr-0.9.2-shaded.jar Our project jar
rss-client-spark2-shaded-0.9.2.jar Our project jar
rss-client-spark3-shaded-0.9.2.jar Our project jar
rss-client-tez-0.9.2-shaded.jar Our project jar
rss-common-0.9.2.jar Our project jar
rss-internal-client-0.9.2.jar Our project jar
rss-proto-0.9.2.jar Our project jar
shims-0.9.15.jar Line 243
shuffle-server-0.9.2.jar Our project jar
shuffle-storage-0.9.2.jar Our project jar
simpleclient-0.9.0.jar Line 236
simpleclient_common-0.9.0.jar Not have
simpleclient_hotspot-0.9.0.jar Line 237
simpleclient_httpserver-0.9.0.jar Line 238
simpleclient_jetty-0.9.0.jar Line 239
simpleclient_pushgateway-0.9.0.jar Line 240
simpleclient_servlet-0.9.0.jar Line 241
slf4j-api-1.7.36.jar Line 272
snakeyaml-2.2.jar Line 251
```
","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YzSSl/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2307,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YzSbt,incubator-uniffle,2563581677,2307,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-27T10:59:07Z,2024-12-27T10:59:07Z,I will add the jars which we don't have in License-binary.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6YzSbt/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2307,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Yzgqc,incubator-uniffle,2563639964,2307,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-27T12:08:54Z,2024-12-27T12:08:54Z,"In the new License-binary
```
RoaringBitmap-0.9.15.jar                         291Line         
activation-1.1.1.jar                                     337Line
animal-sniffer-annotations-1.23.jar        316Line
annotations-4.1.1.4.jar                              212Line
checker-qual-3.37.0.jar                            317Line
cli-0.9.2.jar                                                Our project jar
commons-cli-1.5.0.jar                               221Line
commons-codec-1.9.jar                            222Line
commons-collections-3.2.2.jar                223Line
commons-lang3-3.10.jar                           276Line
commons-logging-1.2.jar                          224Line
coordinator-0.9.2.jar                                  Our project jar
dashboard-0.9.2.jar                                   Our project jar
error_prone_annotations-2.23.0.jar         216Line
failureaccess-1.0.1.jar                                217Line
grpc-api-1.61.1.jar                                      226Line
grpc-context-1.61.1.jar                               227Line
grpc-core-1.61.1.jar                                    228Line
grpc-netty-shaded-1.61.1.jar                     229Line
grpc-protobuf-1.61.1.jar                             230Line
grpc-protobuf-lite-1.61.1.jar                      231Line
grpc-stub-1.61.1.jar                                    232Line
grpc-util-1.61.1.jar                                       233Line
gson-2.10.1.jar                                             215Line
guava-32.1.3-jre.jar                                     217Line
hbase-shaded-jersey-4.1.4.jar                   343Line
httpclient-4.5.3.jar                                       277Line
httpcore-4.4.6.jar                                         278Line
j2objc-annotations-2.8.jar                           220Line
jackson-annotations-2.10.0.jar                    208Line
jackson-core-2.10.0.jar                                 209Line
jackson-databind-2.10.0.jar                         210Line
jakarta.annotation-api-1.3.5.jar                    341Line
jakarta.inject-2.6.1.jar                                    274Line
jakarta.validation-api-2.0.2.jar                      273Line
javassist-3.25.0-GA.jar                                  290Line
javax.annotation-api-1.3.2.jar                        331Line
javax.servlet-api-3.1.0.jar                              330Line
jaxb-api-2.3.0.jar                                            336Line
jetty-client-9.3.24.v20180605.jar                 282Line
jetty-http-9.3.24.v20180605.jar                    283Line
jetty-io-9.3.24.v20180605.jar                        284Line
jetty-proxy-9.3.24.v20180605.jar                  285Line
jetty-security-9.3.24.v20180605.jar              286Line
jetty-server-9.3.24.v20180605.jar                 287Line
jetty-servlet-9.3.24.v20180605.jar                288Line
jetty-util-9.3.24.v20180605.jar                       289Line
jsr305-3.0.2.jar                                                 214Line
listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar 219Line
log4j-api-2.23.0.jar                                          279Line
log4j-core-2.23.0.jar                                        280Line
log4j-slf4j-impl-2.23.0.jar                                281Line
lz4-1.3.0.jar                                                        275Line
netty-all-4.1.106.Final.jar                                  234Line
netty-buffer-4.1.106.Final.jar                            235Line
netty-codec-4.1.106.Final.jar                           236Line
netty-codec-dns-4.1.106.Final.jar                    237Line
netty-codec-haproxy-4.1.106.Final.jar             238Line
netty-codec-http-4.1.106.Final.jar                   239Line
netty-codec-http2-4.1.106.Final.jar                 240Line
netty-codec-memcache-4.1.106.Final.jar        241Line
netty-codec-mqtt-4.1.106.Final.jar                  242Line
netty-codec-redis-4.1.106.Final.jar                  243Line
netty-codec-smtp-4.1.106.Final.jar                  244Line
netty-codec-socks-4.1.106.Final.jar                 245Line
netty-codec-stomp-4.1.106.Final.jar                246Line
netty-codec-xml-4.1.106.Final.jar                     247Line
netty-common-4.1.106.Final.jar                        248Line
netty-handler-4.1.106.Final.jar                          249Line
netty-handler-proxy-4.1.106.Final.jar               250Line
netty-handler-ssl-ocsp-4.1.106.Final.jar          251Line
netty-resolver-4.1.106.Final.jar                          252Line
netty-resolver-dns-4.1.106.Final.jar                  253Line
netty-resolver-dns-classes-macos-4.1.106.Final.jar 254Line
netty-resolver-dns-native-macos-4.1.106.Final-osx-aarch_64.jar 255Line
netty-resolver-dns-native-macos-4.1.106.Final-osx-x86_64.jar.    255Line
netty-transport-4.1.106.Final.jar                      256Line
netty-transport-classes-epoll-4.1.106.Final.jar  257Line
netty-transport-classes-kqueue-4.1.106.Final.jar  258Line
netty-transport-native-epoll-4.1.106.Final-linux-aarch_64.jar 259Line
netty-transport-native-epoll-4.1.106.Final-linux-riscv64.jar 259Line
netty-transport-native-epoll-4.1.106.Final-linux-x86_64.jar 259Line
netty-transport-native-kqueue-4.1.106.Final-osx-aarch_64.jar 260Line
netty-transport-native-kqueue-4.1.106.Final-osx-x86_64.jar 260Line
netty-transport-native-unix-common-4.1.106.Final.jar 261Line
netty-transport-rxtx-4.1.106.Final.jar                    262Line
netty-transport-sctp-4.1.106.Final.jar                   263Line
netty-transport-udt-4.1.106.Final.jar                     264Line
perfmark-api-0.26.0.jar                                          265Line
picocli-4.5.2.jar                                                        225Line
proto-google-common-protos-2.29.0.jar             213Line
protobuf-java-3.25.1.jar                                          308Line
protobuf-java-util-3.25.1.jar                                   309Line
rss-client-mr-0.9.2-shaded.jar                               Our project jar
rss-client-spark2-shaded-0.9.2.jar                        Our project jar
rss-client-spark3-shaded-0.9.2.jar                       Our project jar
rss-client-tez-0.9.2-shaded.jar                              Our project jar
rss-common-0.9.2.jar                                             Our project jar
rss-internal-client-0.9.2.jar                                    Our project jar
rss-proto-0.9.2.jar.                                                  Our project jar
shims-0.9.15.jar                                                      Line292   
shuffle-server-0.9.2.jar                                          Our project jar
shuffle-storage-0.9.2.jar                                         Our project jar
simpleclient-0.9.0.jar                                                Line266
simpleclient_common-0.9.0.jar                              Line267
simpleclient_hotspot-0.9.0.jar                           Line268
simpleclient_httpserver-0.9.0.jar                          Line269
simpleclient_jetty-0.9.0.jar                                   Line270
simpleclient_pushgateway-0.9.0.jar                    Line271
simpleclient_servlet-0.9.0.jar                               Line272
slf4j-api-1.7.36.jar                                                  Line314
snakeyaml-2.2.jar                                                   Line294
```","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Yzgqc/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2308,https://api.github.com/repos/apache/incubator-uniffle/issues/2308,incubator-uniffle,2760669181,2308,[Improvement] More detailed and clear logs on reading failure for FileSegmentManagedBuffer,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2024-12-27T09:58:53Z,2025-01-03T03:49:29Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

![image](https://github.com/user-attachments/assets/c9e6305e-46a7-4b83-809b-e7aebd022bcc)

From this log, I haven't found any useful info. So refactor this part

### How should we improve?

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2308/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2315,https://api.github.com/repos/apache/incubator-uniffle/issues/2315,incubator-uniffle,2763184862,2315,[FEATURE] Introduce a mock client to mock send shuffle data request for testing server performance,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2024-12-30T13:05:26Z,2025-01-03T03:10:22Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

As title, introduce a mock client to mock send shuffle data request for testing server performance.

### Motivation

In a production environment, there can be over 30,000 concurrent connections to a single server, and sending data from a single machine makes it difficult to reach performance bottlenecks. Therefore, a distributed task is needed, running in a relatively large resource pool. Currently, the feasible solutions are on Yarn and on Kubernetes. Since Spark runs on Yarn, using the on Yarn solution would be more convenient.

### Describe the solution

<img width=""739"" alt=""image"" src=""https://github.com/user-attachments/assets/5a21361a-ed4f-47c2-aeaa-e0fc9f772e0f"" />


### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2315/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2315,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Y6e0j,incubator-uniffle,2565467427,2315,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2024-12-30T13:12:03Z,2024-12-30T13:12:03Z,Actually there are many tools to do this like GroupByTest  in the Spark example and TeraSort.,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Y6e0j/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2315,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Y8uFP,incubator-uniffle,2566054223,2315,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2024-12-31T01:19:20Z,2024-12-31T01:19:20Z,"@jerqi Thanks for your suggestion, the motivation of this issue aimed to supply an `uniffle-client-level` mock to test uniffle-client to uniffle-server as a benchmark.

I can easily and explicitly to specific `shuffleCount`, `partitionCount`, `blockCount`, `blockSize`, then test the performance of shuffle-server under these arguments.

After that, we can give a benchmark result under different arguments to show the corresponding arguments.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6Y8uFP/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2317,https://api.github.com/repos/apache/incubator-uniffle/issues/2317,incubator-uniffle,2763870377,2317,[FEATURE] Introduce Uniffle Server Flush Benchmark,maobaolong,17329931,maobaolong,307499405@qq.com,OPEN,2024-12-31T02:02:36Z,2024-12-31T02:02:36Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Supply a benchmark to tune and report the server flush performance.

### Motivation

Focus to test the flush performance.

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2317/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2333,https://api.github.com/repos/apache/incubator-uniffle/issues/2333,incubator-uniffle,2774066981,2333,[Flaky Test] QuorumTest#case6,maobaolong,17329931,maobaolong,307499405@qq.com,CLOSED,2025-01-08T02:00:23Z,2025-01-26T04:12:59Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the flaky test

```
io.grpc.StatusRuntimeException: DEADLINE_EXCEEDED: CallOptions deadline exceeded after 0.199879617s. Name resolution delay 0.000051994 seconds. [closed=[], open=[[buffered_nanos=227683823, remote_addr=10.1.0.30/10.1.0.30:61368]]]
	at io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCalls.java:268)
	at io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:249)
	at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:167)
	at org.apache.uniffle.proto.ShuffleServerGrpc$ShuffleServerBlockingStub.registerShuffle(ShuffleServerGrpc.java:850)
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.doRegisterShuffle(ShuffleServerGrpcClient.java:230)
	at org.apache.uniffle.client.impl.grpc.ShuffleServerGrpcClient.registerShuffle(ShuffleServerGrpcClient.java:486)
	at org.apache.uniffle.client.impl.ShuffleWriteClientImpl.registerShuffle(ShuffleWriteClientImpl.java:604)
	at org.apache.uniffle.client.api.ShuffleWriteClient.registerShuffle(ShuffleWriteClient.java:67)
	at org.apache.uniffle.test.QuorumTest.registerShuffleServer(QuorumTest.java:364)
	at org.apache.uniffle.test.QuorumTest.case6(QuorumTest.java:685)
```

### Actions URL

https://github.com/apache/incubator-uniffle/actions/runs/12662533116/job/35287600543

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2333/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZkyV3,incubator-uniffle,2576557431,2333,NA,maobaolong,17329931,maobaolong,307499405@qq.com,NA,2025-01-08T02:01:09Z,2025-01-08T02:01:09Z,Is there any body can help to fix this flaky test?,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6ZkyV3/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2333,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6aNvrV,incubator-uniffle,2587294421,2333,NA,cchung100m,6762509,Neo Chien,,NA,2025-01-13T14:44:05Z,2025-01-13T14:44:05Z,"Hi @maobaolong 

Thanks for pointing out the noteworthy event. Do you think we should extend the value for the timeout setting here?

https://github.com/apache/incubator-uniffle/blob/51b009ae3a7c0fd4bfabc1b9a52d2895e5dbe350/integration-test/common/src/test/java/org/apache/uniffle/test/QuorumTest.java#L723","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6aNvrV/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2335,https://api.github.com/repos/apache/incubator-uniffle/issues/2335,incubator-uniffle,2780090563,2335,[Improvement] Fix the warning:   Parameter `systemProperties` is deprecated: Use `systemPropertyVariables` instead.,cchung100m,6762509,Neo Chien,,CLOSED,2025-01-10T12:36:06Z,2025-01-14T02:36:24Z,"### Code of Conduct

- [X] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [X] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

<img width=""775"" alt=""image"" src=""https://github.com/user-attachments/assets/0977b8bb-d8b7-4634-b475-47177f42d490"" />


### How should we improve?

Replace the `systemProperties` with `systemPropertyVariables` in the pom.xml

### Are you willing to submit PR?

- [X] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2335/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2338,https://api.github.com/repos/apache/incubator-uniffle/issues/2338,incubator-uniffle,2785248727,2338,[Bug] Uniffle metrics showing 0 value for most of the metrics,BaluDontu,22899615,Balu Dontu,bdontu@vmware.com,CLOSED,2025-01-13T20:04:57Z,2025-01-13T20:44:57Z,"### Code of Conduct

- [x] #2339


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the bug

I have setup the uniffle on a Kubernetes namespace.

However, looking at the metrics for the remote shuffle server, I see most of the metrics show 0 value.

`
kubectl port-forward rss-shuffle-server-rss-full-restart-demo-20 19996:19996 -n rss`

On looking for the metrics values on http://localhost:19996/metrics, I see most of the metrics have a value 0.

 ```
 ""name"": ""read_memory_data_thread_num"",
      ""labelNames"": [
        ""tags""
      ],
      ""labelValues"": [
        ""GRPC_NETTY,ss_v5""
      ],
      ""value"": 0.0,
      ""timestampMs"": null
    },
    {
      ""name"": ""Grpc_RejectCount"",
      ""labelNames"": [
        ""tags""
      ],
      ""labelValues"": [
        ""GRPC_NETTY,ss_v5""
      ],
      ""value"": 0.0,
      ""timestampMs"": null
    },
    {
      ""name"": ""JvmPauseMonitorInfoTimeExceeded"",
      ""labelNames"": [
        ""tags""
      ],
      ""labelValues"": [
        ""GRPC_NETTY,ss_v5""
      ],
      ""value"": 0.0,
      ""timestampMs"": null
    },
    {
      ""name"": ""total_read_data"",
      ""labelNames"": [
        ""tags""
      ],
      ""labelValues"": [
        ""GRPC_NETTY,ss_v5""
      ],
      ""value"": 0.0,
      ""timestampMs"": null
    },
```

### Affects Version(s)

branch-0.10

### Uniffle Server Log Output

```logtalk

```

### Uniffle Engine Log Output

```logtalk

```

### Uniffle Server Configurations

```yaml

```

### Uniffle Engine Configurations

```yaml

```

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2338/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2339,https://api.github.com/repos/apache/incubator-uniffle/issues/2339,incubator-uniffle,2785251972,2339,I agree to follow this project's Code of Conduct,BaluDontu,22899615,Balu Dontu,bdontu@vmware.com,CLOSED,2025-01-13T20:06:00Z,2025-01-13T20:06:16Z,,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2339/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2343,https://api.github.com/repos/apache/incubator-uniffle/issues/2343,incubator-uniffle,2788630720,2343,[Improvement] Fix the warning:  Discovered module-info.class. Shading will break its strong encapsulation.,cchung100m,6762509,Neo Chien,,CLOSED,2025-01-15T01:26:28Z,2025-01-17T07:20:41Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

![Image](https://github.com/user-attachments/assets/49328c85-a887-45a2-9623-5a3ff85188a7)

### How should we improve?

Add the `module-info.class` into the `excludes` in pom.xml

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2343/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2344,https://api.github.com/repos/apache/incubator-uniffle/issues/2344,incubator-uniffle,2791600091,2344,[FEATURE] Introduce the disk buffer in WriteBufferManager for low memory executor in spark uniffle client,zuston,8609142,Junfan Zhang,zuston@apache.org,OPEN,2025-01-16T03:21:41Z,2025-01-17T02:31:57Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

I found some jobs failed due to the failure of memory requiring in low memory spark task executor. For this case, we may introduce the disk buffer to slow down the memory requirement.

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2344/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2344,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6auTRB,incubator-uniffle,2595828801,2344,NA,zuston,8609142,Junfan Zhang,zuston@apache.org,NA,2025-01-16T14:10:21Z,2025-01-16T14:10:21Z,cc @jerqi @maobaolong @xianjingfeng ,"{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6auTRB/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
comment,https://api.github.com/repos/apache/incubator-uniffle/issues/2344,https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6az8IW,incubator-uniffle,2597306902,2344,NA,jerqi,8159038,roryqi,roryqi@apache.org,NA,2025-01-17T02:31:50Z,2025-01-17T02:31:50Z,"> cc [@jerqi](https://github.com/jerqi) [@maobaolong](https://github.com/maobaolong) [@xianjingfeng](https://github.com/xianjingfeng)

It seems ok for me if this optimization is optional.","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/comments/IC_kwDOHg_tSM6az8IW/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2346,https://api.github.com/repos/apache/incubator-uniffle/issues/2346,incubator-uniffle,2796809060,2346,[Improvement] Fix the warning: delete(Path) in FileSystem has been deprecated,cchung100m,6762509,Neo Chien,,CLOSED,2025-01-18T07:00:25Z,2025-01-22T03:26:36Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

<img width=""1010"" alt=""Image"" src=""https://github.com/user-attachments/assets/4cc46d4b-703a-416d-8dd8-de9a1b1a00b0"" />

### How should we improve?

Call ` hadoopFileSystem.delete(tmpHadoopPath, true);` instead of `hadoopFileSystem.delete(hadoopPath);`

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2346/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2349,https://api.github.com/repos/apache/incubator-uniffle/issues/2349,incubator-uniffle,2806372312,2349,[Improvement] Fix the warning: unchecked method invocation: method put in interface Map is applied to given types,cchung100m,6762509,Neo Chien,,CLOSED,2025-01-23T09:25:15Z,2025-01-26T09:03:03Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

![Image](https://github.com/user-attachments/assets/99b3a6e4-acb9-47fe-b6a2-e9d0a13c99a9)

### How should we improve?

TBD

### Are you willing to submit PR?

- [ ] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2349/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2350,https://api.github.com/repos/apache/incubator-uniffle/issues/2350,incubator-uniffle,2808767079,2350,[Improvement] Add metrics of active/lost server number for coordinator,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2025-01-24T07:43:46Z,2025-01-26T06:37:56Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

Add metrics of active/lost server number for coordinator

### How should we improve?

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2350/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2353,https://api.github.com/repos/apache/incubator-uniffle/issues/2353,incubator-uniffle,2810906997,2353,[Improvement] Fix the warning: unchecked method invocation: method `sendCachedBuffer` in class RMRecordsReader.RecordsCombiner is applied to given types,cchung100m,6762509,Neo Chien,,OPEN,2025-01-25T10:15:35Z,2025-01-25T10:15:47Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

<img width=""1064"" alt=""Image"" src=""https://github.com/user-attachments/assets/a70ddc8a-3675-457b-a347-2005daa6923f"" />

### How should we improve?

TBD

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2353/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2354,https://api.github.com/repos/apache/incubator-uniffle/issues/2354,incubator-uniffle,2812181226,2354,[FEATURE] Explicitly grpc client thread pool number,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2025-01-27T06:25:15Z,2025-01-31T11:44:21Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

Explicitly grpc client thread pool number

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2354/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2356,https://api.github.com/repos/apache/incubator-uniffle/issues/2356,incubator-uniffle,2822442521,2356,[Improvement] Fix the warning: unchecked call to put(E) as a member of the raw type `RMRecordsReader.Queue`,cchung100m,6762509,Neo Chien,,OPEN,2025-01-31T04:53:52Z,2025-01-31T04:53:52Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### What would you like to be improved?

<img width=""1063"" alt=""Image"" src=""https://github.com/user-attachments/assets/ec847f62-4998-4361-9a8b-d66f4ddcf9a5"" />

### How should we improve?

TBD

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2356/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
issue,https://api.github.com/repos/apache/incubator-uniffle/issues/2362,https://api.github.com/repos/apache/incubator-uniffle/issues/2362,incubator-uniffle,2837637049,2362,[FEATURE] Support zstd parallel compression,zuston,8609142,Junfan Zhang,zuston@apache.org,CLOSED,2025-02-07T09:10:37Z,2025-02-08T07:20:05Z,"### Code of Conduct

- [x] I agree to follow this project's [Code of Conduct](https://www.apache.org/foundation/policies/conduct)


### Search before asking

- [x] I have searched in the [issues](https://github.com/apache/incubator-uniffle/issues?q=is%3Aissue) and found no similar issues.


### Describe the feature

I found the most part of write time is the zstd compression time. Let's introduce the zstd parallel compression mechanism.
Please refer to: https://github.com/luben/zstd-jni/blob/adb1ea240d01e9a96b17b20f950f5b823ce56e2c/src/test/scala/Perf.scala#L186

### Motivation

_No response_

### Describe the solution

_No response_

### Additional context

_No response_

### Are you willing to submit PR?

- [x] Yes I am willing to submit a PR!","{""url"": ""https://api.github.com/repos/apache/incubator-uniffle/issues/2362/reactions"", ""total_count"": 0, ""+1"": 0, ""-1"": 0, ""laugh"": 0, ""hooray"": 0, ""confused"": 0, ""heart"": 0, ""rocket"": 0, ""eyes"": 0}"
